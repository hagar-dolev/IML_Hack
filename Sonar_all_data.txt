/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

const fbjs = require('eslint-config-fbjs');

// enforces copyright header and @format directive to be present in every file
const pattern = /^\*\n \* Copyright 20\d{2}-present Facebook\.\n \* This source code is licensed under the MIT license found in the\n \* LICENSE file in the root directory of this source tree\.\n \* @format\n./;

module.exports = {
  extends: 'fbjs',
  plugins: [...fbjs.plugins, 'header', 'prettier'],
  rules: {
    // disable rules from eslint-config-fbjs
    'react/react-in-jsx-scope': 0, // not needed with our metro implementation
    'no-new': 0, // new keyword needed e.g. new Notification
    'no-catch-shadow': 0, // only relevant for IE8 and below
    'no-bitwise': 0, // bitwise operations needed in some places
    'consistent-return': 0,
    'max-len': 0, // let's take prettier take care of this
    indent: 0, // let's take prettier take care of this

    // additional rules for this project
    'header/header': [2, 'block', {pattern}],
    'prettier/prettier': [2, 'fb', '@format'],
  },
};
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.sonar.android;

import android.content.Context;
import android.net.wifi.WifiInfo;
import android.net.wifi.WifiManager;
import android.os.Build;
import com.facebook.sonar.core.SonarClient;

public final class AndroidSonarClient {
  private static boolean sIsInitialized = false;
  private static SonarThread sSonarThread;

  public static synchronized SonarClient getInstance(Context context) {
    if (!sIsInitialized) {
      sSonarThread = new SonarThread();
      sSonarThread.start();

      final Context app = context.getApplicationContext();
      SonarClientImpl.init(
          sSonarThread.getEventBase(),
          getServerHost(app),
          "Android",
          getFriendlyDeviceName(),
          getId(),
          getRunningAppName(app),
          getPackageName(app),
          context.getFilesDir().getAbsolutePath());
      sIsInitialized = true;
    }
    return SonarClientImpl.getInstance();
  }

  static boolean isRunningOnGenymotion() {
    return Build.FINGERPRINT.contains("vbox");
  }

  static boolean isRunningOnStockEmulator() {
    return Build.FINGERPRINT.contains("generic") && !Build.FINGERPRINT.contains("vbox");
  }

  static String getId() {
    return Build.SERIAL;
  }

  static String getFriendlyDeviceName() {
    if (isRunningOnGenymotion()) {
      // Genymotion already has a friendly name by default
      return Build.MODEL;
    } else {
      return Build.MODEL + " - " + Build.VERSION.RELEASE + " - API " + Build.VERSION.SDK_INT;
    }
  }

  static String getServerHost(Context context) {
    if (isRunningOnStockEmulator()) {
      return "10.0.2.2";
    } else if (isRunningOnGenymotion()) {
      // This is hand-wavy but works on but ipv4 and ipv6 genymotion
      final WifiManager wifi = (WifiManager) context.getSystemService(Context.WIFI_SERVICE);
      final WifiInfo info = wifi.getConnectionInfo();
      final int ip = info.getIpAddress();
      return String.format("%d.%d.%d.2", (ip & 0xff), (ip >> 8 & 0xff), (ip >> 16 & 0xff));
    } else {
      // Running on physical device. Sonar desktop will run `adb reverse tcp:8088 tcp:8088`
      return "localhost";
    }
  }

  static String getRunningAppName(Context context) {
    return context.getApplicationInfo().loadLabel(context.getPackageManager()).toString();
  }

  static String getPackageName(Context context) {
    return context.getPackageName();
  }
}
/*
 *  Copyright (c) 2004-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.sonar.android;

import com.facebook.jni.HybridClassBase;
import com.facebook.proguard.annotations.DoNotStrip;
import com.facebook.soloader.SoLoader;
import com.facebook.sonar.BuildConfig;

@DoNotStrip
class EventBase extends HybridClassBase {
  static {
    if (BuildConfig.IS_INTERNAL_BUILD) {
      SoLoader.loadLibrary("sonar");
    }
  }

  EventBase() {
    initHybrid();
  }

  @DoNotStrip
  native void loopForever();

  @DoNotStrip
  private native void initHybrid();
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.sonar.android;

import com.facebook.jni.HybridData;
import com.facebook.proguard.annotations.DoNotStrip;
import com.facebook.soloader.SoLoader;
import com.facebook.sonar.BuildConfig;
import com.facebook.sonar.core.SonarClient;
import com.facebook.sonar.core.SonarPlugin;

@DoNotStrip
class SonarClientImpl implements SonarClient {
  static {
    if (BuildConfig.IS_INTERNAL_BUILD) {
      SoLoader.loadLibrary("sonar");
    }
  }

  private final HybridData mHybridData;

  private SonarClientImpl(HybridData hd) {
    mHybridData = hd;
  }

  public static native void init(
      EventBase eventBase,
      String host,
      String os,
      String device,
      String deviceId,
      String app,
      String appId,
      String privateAppDirectory);

  public static native SonarClientImpl getInstance();

  @Override
  public native void addPlugin(SonarPlugin plugin);

  @Override
  public native <T extends SonarPlugin> T getPlugin(String id);

  @Override
  public native void removePlugin(SonarPlugin plugin);

  @Override
  public native void start();

  @Override
  public native void stop();
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.sonar.android;

import com.facebook.jni.HybridData;
import com.facebook.proguard.annotations.DoNotStrip;
import com.facebook.soloader.SoLoader;
import com.facebook.sonar.BuildConfig;
import com.facebook.sonar.core.SonarArray;
import com.facebook.sonar.core.SonarConnection;
import com.facebook.sonar.core.SonarObject;
import com.facebook.sonar.core.SonarReceiver;

@DoNotStrip
class SonarConnectionImpl implements SonarConnection {
  static {
    if (BuildConfig.IS_INTERNAL_BUILD) {
      SoLoader.loadLibrary("sonar");
    }
  }

  private final HybridData mHybridData;

  private SonarConnectionImpl(HybridData hd) {
    mHybridData = hd;
  }

  @Override
  public void send(String method, SonarObject params) {
    sendObject(method, params);
  }

  @Override
  public void send(String method, SonarArray params) {
    sendArray(method, params);
  }

  public native void sendObject(String method, SonarObject params);

  public native void sendArray(String method, SonarArray params);

  @Override
  public native void reportError(Throwable throwable);

  @Override
  public native void receive(String method, SonarReceiver receiver);
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.sonar.android;

import com.facebook.jni.HybridData;
import com.facebook.proguard.annotations.DoNotStrip;
import com.facebook.soloader.SoLoader;
import com.facebook.sonar.BuildConfig;
import com.facebook.sonar.core.SonarArray;
import com.facebook.sonar.core.SonarObject;
import com.facebook.sonar.core.SonarResponder;

@DoNotStrip
class SonarResponderImpl implements SonarResponder {
  static {
    if (BuildConfig.IS_INTERNAL_BUILD) {
      SoLoader.loadLibrary("sonar");
    }
  }

  private final HybridData mHybridData;

  private SonarResponderImpl(HybridData hd) {
    mHybridData = hd;
  }

  @Override
  public void success(SonarObject params) {
    successObject(params);
  }

  @Override
  public void success(SonarArray params) {
    successArray(params);
  }

  @Override
  public void success() {
    successObject(new SonarObject.Builder().build());
  }

  public native void successObject(SonarObject response);

  public native void successArray(SonarArray response);

  @Override
  public native void error(SonarObject response);
}
/*
 *  Copyright (c) 2004-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.sonar.android;

import android.os.Process;
import javax.annotation.Nullable;

class SonarThread extends Thread {
  private @Nullable EventBase mEventBase;

  SonarThread() {
    super("SonarEventBaseThread");
  }

  @Override
  public void run() {
    Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);
    synchronized (this) {
      try {
        mEventBase = new EventBase();
      } finally {
        notifyAll();
      }
    }

    mEventBase.loopForever();
  }

  synchronized EventBase getEventBase() {
    while (mEventBase == null) {
      try {
        wait();
      } catch (InterruptedException e) {
        // ignore
      }
    }
    return mEventBase;
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.sonar.android.utils;

import android.app.ActivityManager;
import android.content.Context;
import com.facebook.sonar.BuildConfig;
import java.util.List;

public final class SonarUtils {

  private SonarUtils() {}

  public static boolean shouldEnableSonar(Context context) {
    return BuildConfig.IS_INTERNAL_BUILD && !isEndToEndTest() && isMainProcess(context);
  }

  private static boolean isEndToEndTest() {
    final String value = System.getenv("BUDDY_SONAR_DISABLED");
    if (value == null || value.length() == 0) {
      return false;
    }

    try {
      return Boolean.parseBoolean(value);
    } catch (NumberFormatException e) {
      return false;
    }
  }

  private static boolean isMainProcess(Context context) {
    final int pid = android.os.Process.myPid();
    final ActivityManager manager =
        (ActivityManager) context.getSystemService(Context.ACTIVITY_SERVICE);
    final List<ActivityManager.RunningAppProcessInfo> infoList = manager.getRunningAppProcesses();

    String processName = null;
    if (infoList != null) {
      for (ActivityManager.RunningAppProcessInfo info : infoList) {
        if (info.pid == pid) {
          processName = info.processName;
          break;
        }
      }
    }

    return context.getPackageName().equals(processName);
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.sonar.core;

public abstract class ErrorReportingRunnable implements Runnable {

  private final SonarConnection mConnection;

  public ErrorReportingRunnable(SonarConnection connection) {
    mConnection = connection;
  }

  @Override
  public final void run() {
    try {
      runOrThrow();
    } catch (Exception e) {
      if (mConnection != null) {
        mConnection.reportError(e);
      }
    } finally {
      doFinally();
    }
  }

  protected void doFinally() {}

  protected abstract void runOrThrow() throws Exception;
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.sonar.core;

import java.util.ArrayList;
import java.util.List;
import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

public class SonarArray {
  final JSONArray mJson;

  SonarArray(JSONArray json) {
    mJson = (json != null ? json : new JSONArray());
  }

  SonarArray(String json) {
    try {
      mJson = new JSONArray(json);
    } catch (JSONException e) {
      throw new RuntimeException(e);
    }
  }

  public SonarDynamic getDynamic(int index) {
    return new SonarDynamic(mJson.opt(index));
  }

  public String getString(int index) {
    return mJson.optString(index);
  }

  public int getInt(int index) {
    return mJson.optInt(index);
  }

  public long getLong(int index) {
    return mJson.optLong(index);
  }

  public float getFloat(int index) {
    return (float) mJson.optDouble(index);
  }

  public double getDouble(int index) {
    return mJson.optDouble(index);
  }

  public boolean getBoolean(int index) {
    return mJson.optBoolean(index);
  }

  public SonarObject getObject(int index) {
    final Object o = mJson.opt(index);
    return new SonarObject((JSONObject) o);
  }

  public SonarArray getArray(int index) {
    final Object o = mJson.opt(index);
    return new SonarArray((JSONArray) o);
  }

  public int length() {
    return mJson.length();
  }

  public List<String> toStringList() {
    final int length = length();
    final List<String> list = new ArrayList<>(length);
    for (int i = 0; i < length; i++) {
      list.add(getString(i));
    }
    return list;
  }

  public String toJsonString() {
    return toString();
  }

  @Override
  public String toString() {
    return mJson.toString();
  }

  @Override
  public boolean equals(Object o) {
    return mJson.toString().equals(o.toString());
  }

  @Override
  public int hashCode() {
    return mJson.hashCode();
  }

  public static class Builder {
    private final JSONArray mJson;

    public Builder() {
      mJson = new JSONArray();
    }

    public Builder put(String s) {
      mJson.put(s);
      return this;
    }

    public Builder put(Integer i) {
      mJson.put(i);
      return this;
    }

    public Builder put(Long l) {
      mJson.put(l);
      return this;
    }

    public Builder put(Float f) {
      mJson.put(Float.isNaN(f) ? null : f);
      return this;
    }

    public Builder put(Double d) {
      mJson.put(Double.isNaN(d) ? null : d);
      return this;
    }

    public Builder put(Boolean b) {
      mJson.put(b);
      return this;
    }

    public Builder put(SonarValue v) {
      return put(v.toSonarObject());
    }

    public Builder put(SonarArray a) {
      mJson.put(a == null ? null : a.mJson);
      return this;
    }

    public Builder put(SonarArray.Builder b) {
      return put(b.build());
    }

    public Builder put(SonarObject o) {
      mJson.put(o == null ? null : o.mJson);
      return this;
    }

    public Builder put(SonarObject.Builder b) {
      return put(b.build());
    }

    public SonarArray build() {
      return new SonarArray(mJson);
    }
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.sonar.core;

public interface SonarClient {
  void addPlugin(SonarPlugin plugin);

  <T extends SonarPlugin> T getPlugin(String id);

  void removePlugin(SonarPlugin plugin);

  void start();

  void stop();
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.sonar.core;

/**
 * A connection between a SonarPlugin and the desktop Sonar application. Register request handlers
 * to respond to calls made by the desktop application or directly send messages to the desktop
 * application.
 */
public interface SonarConnection {

  /**
   * Call a remote method on the Sonar desktop application, passing an optional JSON object as a
   * parameter.
   */
  void send(String method, SonarObject params);

  /**
   * Call a remote method on the Sonar desktop application, passing an optional JSON array as a
   * parameter.
   */
  void send(String method, SonarArray params);

  /** Report client error */
  void reportError(Throwable throwable);

  /**
   * Register a receiver for a remote method call issued by the Sonar desktop application. The
   * SonarReceiver is passed a responder to respond back to the desktop application.
   */
  void receive(String method, SonarReceiver receiver);
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.sonar.core;

import javax.annotation.Nullable;
import org.json.JSONArray;
import org.json.JSONObject;

public class SonarDynamic {
  private final Object mObject;

  public SonarDynamic(Object object) {
    mObject = object;
  }

  public @Nullable String asString() {
    if (mObject == null) {
      return null;
    }
    return mObject.toString();
  }

  public int asInt() {
    if (mObject == null) {
      return 0;
    }
    if (mObject instanceof Integer) {
      return (Integer) mObject;
    }
    if (mObject instanceof Long) {
      return ((Long) mObject).intValue();
    }
    if (mObject instanceof Float) {
      return ((Float) mObject).intValue();
    }
    if (mObject instanceof Double) {
      return ((Double) mObject).intValue();
    }
    return 0;
  }

  public long asLong() {
    if (mObject == null) {
      return 0;
    }
    if (mObject instanceof Integer) {
      return (Integer) mObject;
    }
    if (mObject instanceof Long) {
      return (Long) mObject;
    }
    if (mObject instanceof Float) {
      return ((Float) mObject).longValue();
    }
    if (mObject instanceof Double) {
      return ((Double) mObject).longValue();
    }
    return 0;
  }

  public float asFloat() {
    if (mObject == null) {
      return 0;
    }
    if (mObject instanceof Integer) {
      return (Integer) mObject;
    }
    if (mObject instanceof Long) {
      return (Long) mObject;
    }
    if (mObject instanceof Float) {
      return (Float) mObject;
    }
    if (mObject instanceof Double) {
      return ((Double) mObject).floatValue();
    }
    return 0;
  }

  public double asDouble() {
    if (mObject == null) {
      return 0;
    }
    if (mObject instanceof Integer) {
      return (Integer) mObject;
    }
    if (mObject instanceof Long) {
      return (Long) mObject;
    }
    if (mObject instanceof Float) {
      return (Float) mObject;
    }
    if (mObject instanceof Double) {
      return (Double) mObject;
    }
    return 0;
  }

  public boolean asBoolean() {
    if (mObject == null) {
      return false;
    }
    return (Boolean) mObject;
  }

  public SonarObject asObject() {
    if (mObject instanceof JSONObject) {
      return new SonarObject((JSONObject) mObject);
    }
    return (SonarObject) mObject;
  }

  public SonarArray asArray() {
    if (mObject instanceof JSONArray) {
      return new SonarArray((JSONArray) mObject);
    }
    return (SonarArray) mObject;
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.sonar.core;

import java.util.Arrays;
import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

public class SonarObject {
  final JSONObject mJson;

  public SonarObject(JSONObject json) {
    mJson = (json != null ? json : new JSONObject());
  }

  public SonarObject(String json) {
    try {
      mJson = new JSONObject(json);
    } catch (JSONException e) {
      throw new RuntimeException(e);
    }
  }

  public SonarDynamic getDynamic(String name) {
    return new SonarDynamic(mJson.opt(name));
  }

  public String getString(String name) {
    if (mJson.isNull(name)) {
      return null;
    }
    return mJson.optString(name);
  }

  public int getInt(String name) {
    return mJson.optInt(name);
  }

  public long getLong(String name) {
    return mJson.optLong(name);
  }

  public float getFloat(String name) {
    return (float) mJson.optDouble(name);
  }

  public double getDouble(String name) {
    return mJson.optDouble(name);
  }

  public boolean getBoolean(String name) {
    return mJson.optBoolean(name);
  }

  public SonarObject getObject(String name) {
    final Object o = mJson.opt(name);
    return new SonarObject((JSONObject) o);
  }

  public SonarArray getArray(String name) {
    final Object o = mJson.opt(name);
    return new SonarArray((JSONArray) o);
  }

  public boolean contains(String name) {
    return mJson.has(name);
  }

  public String toJsonString() {
    return toString();
  }

  @Override
  public String toString() {
    return mJson.toString();
  }

  @Override
  public boolean equals(Object o) {
    return mJson.toString().equals(o.toString());
  }

  @Override
  public int hashCode() {
    return mJson.hashCode();
  }

  public static class Builder {
    private final JSONObject mJson;

    public Builder() {
      mJson = new JSONObject();
    }

    public Builder put(String name, Object obj) {
      if (obj == null) {
        return put(name, (String) null);
      } else if (obj instanceof Integer) {
        return put(name, (Integer) obj);
      } else if (obj instanceof Long) {
        return put(name, (Long) obj);
      } else if (obj instanceof Float) {
        return put(name, (Float) obj);
      } else if (obj instanceof Double) {
        return put(name, (Double) obj);
      } else if (obj instanceof String) {
        return put(name, (String) obj);
      } else if (obj instanceof Boolean) {
        return put(name, (Boolean) obj);
      } else if (obj instanceof Object[]) {
        return put(name, Arrays.deepToString((Object[]) obj));
      } else if (obj instanceof SonarObject) {
        return put(name, (SonarObject) obj);
      } else if (obj instanceof SonarObject.Builder) {
        return put(name, (SonarObject.Builder) obj);
      } else if (obj instanceof SonarArray) {
        return put(name, (SonarArray) obj);
      } else if (obj instanceof SonarArray.Builder) {
        return put(name, (SonarArray.Builder) obj);
      } else if (obj instanceof SonarValue) {
        return put(name, ((SonarValue) obj).toSonarObject());
      } else {
        return put(name, obj.toString());
      }
    }

    public Builder put(String name, String s) {
      try {
        mJson.put(name, s);
      } catch (JSONException e) {
        throw new RuntimeException(e);
      }
      return this;
    }

    public Builder put(String name, Integer i) {
      try {
        mJson.put(name, i);
      } catch (JSONException e) {
        throw new RuntimeException(e);
      }
      return this;
    }

    public Builder put(String name, Long l) {
      try {
        mJson.put(name, l);
      } catch (JSONException e) {
        throw new RuntimeException(e);
      }
      return this;
    }

    public Builder put(String name, Float f) {
      try {
        mJson.put(name, Float.isNaN(f) ? null : f);
      } catch (JSONException e) {
        throw new RuntimeException(e);
      }
      return this;
    }

    public Builder put(String name, Double d) {
      try {
        mJson.put(name, Double.isNaN(d) ? null : d);
      } catch (JSONException e) {
        throw new RuntimeException(e);
      }
      return this;
    }

    public Builder put(String name, Boolean b) {
      try {
        mJson.put(name, b);
      } catch (JSONException e) {
        throw new RuntimeException(e);
      }
      return this;
    }

    public Builder put(String name, SonarValue v) {
      return put(name, v.toSonarObject());
    }

    public Builder put(String name, SonarArray a) {
      try {
        mJson.put(name, a == null ? null : a.mJson);
      } catch (JSONException e) {
        throw new RuntimeException(e);
      }
      return this;
    }

    public Builder put(String name, SonarArray.Builder b) {
      return put(name, b.build());
    }

    public Builder put(String name, SonarObject o) {
      try {
        mJson.put(name, o == null ? null : o.mJson);
      } catch (JSONException e) {
        throw new RuntimeException(e);
      }
      return this;
    }

    public Builder put(String name, SonarObject.Builder b) {
      return put(name, b.build());
    }

    public SonarObject build() {
      return new SonarObject(mJson);
    }
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.sonar.core;

/**
 * A SonarPlugin is an object which exposes an API to the Desktop Sonar application. When a
 * connection is established the plugin is given a SonarConnection on which it can register request
 * handlers and send messages. When the SonarConnection is invalid onDisconnect is called. onConnect
 * may be called again on the same plugin object if Sonar re-connects, this will provide a new
 * SonarConnection, do not attempt to re-use the previous connection.
 */
public interface SonarPlugin {

  /**
   * @return The id of this plugin. This is the namespace which Sonar desktop plugins will call
   *     methods on to route them to your plugin. This should match the id specified in your React
   *     plugin.
   */
  String getId();

  /**
   * Called when a connection has been established. The connection passed to this method is valid
   * until {@link SonarPlugin#onDisconnect()} is called.
   */
  void onConnect(SonarConnection connection) throws Exception;

  /**
   * Called when the connection passed to {@link SonarPlugin#onConnect(SonarConnection)} is no
   * longer valid. Do not try to use the connection in or after this method has been called.
   */
  void onDisconnect() throws Exception;
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.sonar.core;

/**
 * A receiver of a remote method call issued by the Sonar desktop application. If the given
 * responder is present it means the Sonar desktop application is expecting a response.
 */
public interface SonarReceiver {

  /**
   * Reciver for a request sent from the Sonar desktop client.
   *
   * @param params Optional set of parameters sent with the request.
   * @param responder Optional responder for request. Some requests don't warrant a response
   *     through. In this case the request should be made from the desktop using send() instead of
   *     call().
   */
  void onReceive(SonarObject params, SonarResponder responder) throws Exception;
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.sonar.core;

/**
 * SonarResponder is used to asyncronously response to a messaged recieved from the Sonar desktop
 * app. The Sonar Responder will automatically wrap the response in an approriate object depending
 * on if it is an error or not.
 */
public interface SonarResponder {

  /** Deliver a successful response to the Sonar desktop app. */
  void success(SonarObject response);

  /** Deliver a successful response to the Sonar desktop app. */
  void success(SonarArray response);

  /** Deliver a successful response to the Sonar desktop app. */
  void success();

  /** Inform the Sonar desktop app of an error in handling the request. */
  void error(SonarObject response);
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.sonar.core;

public interface SonarValue {
  SonarObject toSonarObject();
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.sonar.plugins.common;

import com.facebook.sonar.core.SonarConnection;
import com.facebook.sonar.core.SonarObject;
import com.facebook.sonar.core.SonarPlugin;
import javax.annotation.Nullable;

/**
 * Sonar plugin that keeps events in a buffer until a connection is available.
 *
 * <p>In order to send data to the {@link SonarConnection}, use {@link #send(String, SonarObject)}
 * instead of {@link SonarConnection#send(String, SonarObject)}.
 */
public abstract class BufferingSonarPlugin implements SonarPlugin {

  private static final int BUFFER_SIZE = 500;

  private @Nullable RingBuffer<CachedSonarEvent> mEventQueue;
  private @Nullable SonarConnection mConnection;

  @Override
  public synchronized void onConnect(SonarConnection connection) {
    mConnection = connection;

    sendBufferedEvents();
  }

  @Override
  public synchronized void onDisconnect() {
    mConnection = null;
  }

  public synchronized SonarConnection getConnection() {
    return mConnection;
  }

  public synchronized boolean isConnected() {
    return mConnection != null;
  }

  public synchronized void send(String method, SonarObject sonarObject) {
    if (mEventQueue == null) {
      mEventQueue = new RingBuffer<>(BUFFER_SIZE);
    }
    mEventQueue.enqueue(new CachedSonarEvent(method, sonarObject));
    if (mConnection != null) {
      mConnection.send(method, sonarObject);
    }
  }

  private synchronized void sendBufferedEvents() {
    if (mEventQueue != null && mConnection != null) {
      for (CachedSonarEvent cachedSonarEvent : mEventQueue.asList()) {
        mConnection.send(cachedSonarEvent.method, cachedSonarEvent.sonarObject);
      }
    }
  }

  private static class CachedSonarEvent {
    final String method;
    final SonarObject sonarObject;

    private CachedSonarEvent(String method, SonarObject sonarObject) {
      this.method = method;
      this.sonarObject = sonarObject;
    }
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.sonar.plugins.common;

import android.os.Handler;
import android.os.Looper;
import com.facebook.sonar.core.ErrorReportingRunnable;
import com.facebook.sonar.core.SonarConnection;
import com.facebook.sonar.core.SonarObject;
import com.facebook.sonar.core.SonarReceiver;
import com.facebook.sonar.core.SonarResponder;

public abstract class MainThreadSonarReceiver implements SonarReceiver {

  public MainThreadSonarReceiver(SonarConnection connection) {
    this.mConnection = connection;
  }

  private final SonarConnection mConnection;
  private final Handler mHandler = new Handler(Looper.getMainLooper());

  @Override
  public final void onReceive(final SonarObject params, final SonarResponder responder) {
    mHandler.post(
        new ErrorReportingRunnable(mConnection) {
          @Override
          public void runOrThrow() throws Exception {
            onReceiveOnMainThread(params, responder);
          }
        });
  }

  public abstract void onReceiveOnMainThread(SonarObject params, SonarResponder responder)
      throws Exception;
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.sonar.plugins.common;

import java.util.LinkedList;
import java.util.List;

final class RingBuffer<T> {
  final int mBufferSize;
  final List<T> mBuffer = new LinkedList<>();

  RingBuffer(int bufferSize) {
    mBufferSize = bufferSize;
  }

  void enqueue(T item) {
    if (mBuffer.size() >= mBufferSize) {
      mBuffer.remove(0);
    }
    mBuffer.add(item);
  }

  List<T> asList() {
    return mBuffer;
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.sonar.plugins.console;

import com.facebook.sonar.core.SonarConnection;
import com.facebook.sonar.core.SonarPlugin;
import com.facebook.sonar.plugins.console.iface.ConsoleCommandReceiver;

public class ConsoleSonarPlugin implements SonarPlugin {

  private final JavascriptEnvironment mJavascriptEnvironment;
  private JavascriptSession mJavascriptSession;

  public ConsoleSonarPlugin(JavascriptEnvironment jsEnvironment) {
    this.mJavascriptEnvironment = jsEnvironment;
  }

  @Override
  public String getId() {
    return "Console";
  }

  @Override
  public void onConnect(SonarConnection connection) throws Exception {
    ConsoleCommandReceiver.listenForCommands(connection, mJavascriptEnvironment);
  }

  public void onDisconnect() throws Exception {
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.sonar.plugins.console;

import com.facebook.sonar.plugins.console.iface.ScriptingEnvironment;
import java.util.HashMap;
import java.util.Map;
import org.mozilla.javascript.Context;
import org.mozilla.javascript.ContextFactory;

public class JavascriptEnvironment implements ScriptingEnvironment {

  private final Map<String, Object> mBoundVariables;
  private final ContextFactory mContextFactory;

  public JavascriptEnvironment() {
    mBoundVariables = new HashMap<>();
    mContextFactory =
        new ContextFactory() {
          @Override
          public boolean hasFeature(Context cx, int featureIndex) {
            return featureIndex == Context.FEATURE_ENHANCED_JAVA_ACCESS;
          }
        };
  }

  @Override
  public JavascriptSession startSession() {
    return new JavascriptSession(mContextFactory, mBoundVariables);
  }

  /**
   * Method for other plugins to register objects to a name, so that they can be accessed in all
   * console sessions.
   *
   * @param name The variable name to bind the object to.
   * @param object The reference to bind.
   */
  @Override
  public void registerGlobalObject(String name, Object object) {
    if (mBoundVariables.containsKey(name)) {
      throw new IllegalStateException(
          String.format(
              "Variable %s is already reserved for %s", name, mBoundVariables.get(name)));
    }
    mBoundVariables.put(name, object);
  }

  @Override
  public boolean isEnabled() {
    return true;
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.sonar.plugins.console;

import com.facebook.sonar.plugins.console.iface.ScriptingSession;
import java.io.Closeable;
import java.util.Map;
import java.util.concurrent.atomic.AtomicInteger;
import org.json.JSONException;
import org.json.JSONObject;
import org.json.JSONTokener;
import org.mozilla.javascript.Context;
import org.mozilla.javascript.ContextFactory;
import org.mozilla.javascript.Function;
import org.mozilla.javascript.NativeJSON;
import org.mozilla.javascript.NativeJavaMethod;
import org.mozilla.javascript.NativeJavaObject;
import org.mozilla.javascript.Scriptable;
import org.mozilla.javascript.ScriptableObject;
import org.mozilla.javascript.Undefined;

public class JavascriptSession implements Closeable, ScriptingSession {

  private static final String TYPE = "type";
  private static final String VALUE = "value";
  public static final String JSON = "json";
  private final Context mContext;
  private final ContextFactory mContextFactory;
  private final Scriptable mScope;
  private final AtomicInteger lineNumber = new AtomicInteger(0);

  JavascriptSession(ContextFactory contextFactory, Map<String, Object> globals) {
    mContextFactory = contextFactory;
    mContext = contextFactory.enterContext();

    // Interpreted mode, or it will produce Dalvik incompatible bytecode.
    mContext.setOptimizationLevel(-1);
    mScope = mContext.initStandardObjects();

    for (Map.Entry<String, Object> entry : globals.entrySet()) {
      final Object value = entry.getValue();

      if (value instanceof Number || value instanceof String) {
        ScriptableObject.putConstProperty(mScope, entry.getKey(), entry.getValue());
      } else {
        // Calling java methods in the VM produces objects wrapped in NativeJava*.
        // So passing in wrapped objects keeps them consistent.
        ScriptableObject.putConstProperty(
            mScope,
            entry.getKey(),
            new NativeJavaObject(mScope, entry.getValue(), entry.getValue().getClass()));
      }
    }
  }

  @Override
  public JSONObject evaluateCommand(String userScript) throws JSONException {
    return evaluateCommand(userScript, mScope);
  }

  @Override
  public JSONObject evaluateCommand(String userScript, Object context) throws JSONException {
    Scriptable scope = new NativeJavaObject(mScope, context, context.getClass());
    return evaluateCommand(userScript, scope);
  }

  private JSONObject evaluateCommand(String command, Scriptable scope) throws JSONException {
    try {
      // This may be called by any thread, and contexts have to be entered in the current thread
      // before being used, so enter/exit every time.
      mContextFactory.enterContext();
      return toJson(
          mContext.evaluateString(
              scope, command, "sonar-console", lineNumber.incrementAndGet(), null));
    } finally {
      Context.exit();
    }
  }

  private JSONObject toJson(Object result) throws JSONException {

    if (result instanceof String) {
      return new JSONObject().put(TYPE, JSON).put(VALUE, result);
    }

    if (result instanceof Class) {
      return new JSONObject().put(TYPE, "class").put(VALUE, ((Class) result).getName());
    }

    if (result instanceof NativeJavaObject
        && ((NativeJavaObject) result).unwrap() instanceof String) {
      return new JSONObject().put(TYPE, JSON).put(VALUE, ((NativeJavaObject) result).unwrap());
    }

    if (result instanceof NativeJavaObject
        && ((NativeJavaObject) result).unwrap() instanceof Class) {
      return new JSONObject()
          .put(TYPE, "class")
          .put(VALUE, ((NativeJavaObject) result).unwrap().toString());
    }

    if (result instanceof NativeJavaObject) {
      final JSONObject o = new JSONObject();
      o.put("toString", ((NativeJavaObject) result).unwrap().toString());
      for (Object id : ((NativeJavaObject) result).getIds()) {
        if (id instanceof String) {
          final String name = (String) id;
          final Object value = ((NativeJavaObject) result).get(name, (NativeJavaObject) result);
          if (value != null && value instanceof NativeJavaMethod) {
            continue;
          }
          final String valueString = value == null ? null : safeUnwrap(value).toString();
          o.put(name, valueString);
        }
      }
      return new JSONObject().put(TYPE, "javaObject").put(VALUE, o);
    }

    if (result instanceof NativeJavaMethod) {
      final JSONObject o = new JSONObject();
      o.put(TYPE, "method");
      o.put("name", ((NativeJavaMethod) result).getFunctionName());
      return o;
    }

    if (result == null || result instanceof Undefined) {
      return new JSONObject().put(TYPE, "null");
    }

    if (result instanceof Function) {
      final JSONObject o = new JSONObject();
      o.put(TYPE, "function");
      o.put(VALUE, Context.toString(result));
      return o;
    }

    if (result instanceof ScriptableObject) {
      return new JSONObject()
          .put(TYPE, JSON)
          .put(
              VALUE,
              new JSONTokener(NativeJSON.stringify(mContext, mScope, result, null, null).toString())
                  .nextValue());
    }

    if (result instanceof Number) {
      return new JSONObject().put(TYPE, JSON).put(VALUE, result);
    }

    return new JSONObject().put(TYPE, "unknown").put(VALUE, result.toString());
  }

  @Override
  public void close() {
    Context.exit();
  }

  private static Object safeUnwrap(Object o) {
    if (o instanceof NativeJavaObject) {
      return ((NativeJavaObject) o).unwrap();
    }
    return o;
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.sonar.plugins.console.iface;

import android.support.annotation.Nullable;
import com.facebook.sonar.core.SonarConnection;
import com.facebook.sonar.core.SonarObject;
import com.facebook.sonar.core.SonarReceiver;
import com.facebook.sonar.core.SonarResponder;
import com.facebook.sonar.plugins.common.MainThreadSonarReceiver;
import org.json.JSONObject;

/**
 * Convenience class for adding console execution to a Sonar Plugin. Calling {@link
 * ConsoleCommandReceiver#listenForCommands(SonarConnection, ScriptingEnvironment, ContextProvider)}
 * will add the necessary listeners for responding to command execution calls.
 */
public class ConsoleCommandReceiver {

  /**
   * Incoming command execution calls may reference a context ID that means something to your
   * plugin. Implement {@link ContextProvider} to provide a mapping from context ID to java object.
   * This will allow your sonar plugin to control the execution context of the command.
   */
  public interface ContextProvider {
    @Nullable
    Object getObjectForId(String id);
  }

  public static void listenForCommands(
      final SonarConnection connection,
      final ScriptingEnvironment scriptingEnvironment,
      final ContextProvider contextProvider) {

    final ScriptingSession session = scriptingEnvironment.startSession();
    final SonarReceiver executeCommandReceiver =
        new MainThreadSonarReceiver(connection) {
          @Override
          public void onReceiveOnMainThread(SonarObject params, SonarResponder responder)
              throws Exception {
            final String command = params.getString("command");
            final String contextObjectId = params.getString("context");
            final Object contextObject = contextProvider.getObjectForId(contextObjectId);
            try {
              JSONObject o =
                  contextObject == null
                      ? session.evaluateCommand(command)
                      : session.evaluateCommand(command, contextObject);
              responder.success(new SonarObject(o));
            } catch (Exception e) {
              responder.error(new SonarObject.Builder().put("message", e.getMessage()).build());
            }
          }
        };
    final SonarReceiver isEnabledReceiver =
        new SonarReceiver() {
          @Override
          public void onReceive(SonarObject params, SonarResponder responder) throws Exception {
            responder.success(
                new SonarObject.Builder()
                    .put("isEnabled", scriptingEnvironment.isEnabled())
                    .build());
          }
        };

    connection.receive("executeCommand", executeCommandReceiver);
    connection.receive("isConsoleEnabled", isEnabledReceiver);
  }

  public static void listenForCommands(
      SonarConnection connection, ScriptingEnvironment scriptingEnvironment) {
    listenForCommands(connection, scriptingEnvironment, nullContextProvider);
  }

  private static final ContextProvider nullContextProvider =
      new ContextProvider() {
        @Override
        @Nullable
        public Object getObjectForId(String id) {
          return null;
        }
      };
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.sonar.plugins.console.iface;

import org.json.JSONException;
import org.json.JSONObject;

public class NullScriptingEnvironment implements ScriptingEnvironment {

  @Override
  public ScriptingSession startSession() {
    return new NoOpScriptingSession();
  }

  @Override
  public void registerGlobalObject(String name, Object object) {}

  static class NoOpScriptingSession implements ScriptingSession {

    @Override
    public JSONObject evaluateCommand(String userScript) throws JSONException {
      throw new UnsupportedOperationException("Console plugin not enabled in this app");
    }

    @Override
    public JSONObject evaluateCommand(String userScript, Object context) throws JSONException {
      return evaluateCommand(userScript);
    }

    @Override
    public void close() {}
  }

  @Override
  public boolean isEnabled() {
    return false;
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.sonar.plugins.console.iface;

public interface ScriptingEnvironment {

  ScriptingSession startSession();

  void registerGlobalObject(String name, Object object);

  boolean isEnabled();
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.sonar.plugins.console.iface;

import org.json.JSONException;
import org.json.JSONObject;

public interface ScriptingSession {

  JSONObject evaluateCommand(String userScript) throws JSONException;

  JSONObject evaluateCommand(String userScript, Object context) throws JSONException;

  void close();
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

package com.facebook.sonar.plugins.inspector;

import android.app.Activity;
import android.app.Application;
import android.os.Bundle;
import android.os.Handler;
import android.os.Looper;
import android.view.View;
import com.facebook.sonar.plugins.inspector.descriptors.utils.AndroidRootResolver;
import com.facebook.sonar.plugins.inspector.descriptors.utils.AndroidRootResolver.Root;
import java.lang.ref.WeakReference;
import java.util.ArrayList;
import java.util.Collections;
import java.util.Iterator;
import java.util.List;

public class ApplicationWrapper implements Application.ActivityLifecycleCallbacks {

  public interface ActivityStackChangedListener {
    void onActivityStackChanged(List<Activity> stack);
  }

  private final Application mApplication;
  private final AndroidRootResolver mAndroidRootsResolver;
  private final List<WeakReference<Activity>> mActivities;
  private final Handler mHandler;
  private ActivityStackChangedListener mListener;

  public ApplicationWrapper(Application application) {
    mApplication = application;
    mAndroidRootsResolver = new AndroidRootResolver();
    mApplication.registerActivityLifecycleCallbacks(this);
    mActivities = new ArrayList<>();
    mHandler = new Handler(Looper.getMainLooper());
  }

  @Override
  public void onActivityCreated(Activity activity, Bundle savedInstanceState) {
    mActivities.add(new WeakReference<>(activity));
    notifyListener();
  }

  @Override
  public void onActivityStarted(Activity activity) {}

  @Override
  public void onActivityResumed(Activity activity) {}

  @Override
  public void onActivityPaused(Activity activity) {
    if (activity.isFinishing()) {
      final Iterator<WeakReference<Activity>> activityIterator = mActivities.iterator();

      while (activityIterator.hasNext()) {
        if (activityIterator.next().get() == activity) {
          activityIterator.remove();
        }
      }

      notifyListener();
    }
  }

  @Override
  public void onActivityStopped(Activity activity) {}

  @Override
  public void onActivitySaveInstanceState(Activity activity, Bundle outState) {}

  @Override
  public void onActivityDestroyed(Activity activity) {}

  private void notifyListener() {
    if (mListener != null) {
      mListener.onActivityStackChanged(getActivityStack());
    }
  }

  public void setListener(ActivityStackChangedListener listener) {
    mListener = listener;
  }

  public Application getApplication() {
    return mApplication;
  }

  public List<Activity> getActivityStack() {
    final List<Activity> activities = new ArrayList<>(mActivities.size());
    final Iterator<WeakReference<Activity>> activityIterator = mActivities.iterator();

    while (activityIterator.hasNext()) {
      final Activity activity = activityIterator.next().get();
      if (activity == null) {
        activityIterator.remove();
      } else {
        activities.add(activity);
      }
    }

    return activities;
  }

  public List<View> getViewRoots() {
    final List<Root> roots = mAndroidRootsResolver.listActiveRoots();
    if (roots == null) {
      return Collections.EMPTY_LIST;
    }

    final List<View> viewRoots = new ArrayList<>(roots.size());
    for (Root root : roots) {
      viewRoots.add(root.view);
    }

    return viewRoots;
  }

  public void postDelayed(Runnable r, long delayMillis) {
    mHandler.postDelayed(r, delayMillis);
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

package com.facebook.sonar.plugins.inspector;

import android.graphics.Canvas;
import android.graphics.Color;
import android.graphics.ColorFilter;
import android.graphics.Paint;
import android.graphics.PixelFormat;
import android.graphics.Rect;
import android.graphics.Region;
import android.graphics.drawable.Drawable;
import android.text.TextPaint;
import javax.annotation.Nullable;

public class BoundsDrawable extends Drawable {
  public static final int COLOR_HIGHLIGHT_CONTENT = 0x888875c5;
  public static final int COLOR_HIGHLIGHT_PADDING = 0x889dd185;
  public static final int COLOR_HIGHLIGHT_MARGIN = 0x88f7b77b;
  private static @Nullable BoundsDrawable sInstance;

  private final TextPaint mTextPaint;
  private final Paint mMarginPaint;
  private final Paint mPaddingPaint;
  private final Paint mContentPaint;
  private final Rect mWorkRect;
  private final Rect mMarginBounds;
  private final Rect mPaddingBounds;
  private final Rect mContentBounds;

  private final int mStrokeWidth;
  private final float mAscentOffset;
  private final float mDensity;

  public static BoundsDrawable getInstance(
      float density, Rect marginBounds, Rect paddingBounds, Rect contentBounds) {
    final BoundsDrawable drawable = getInstance(density);
    drawable.setBounds(marginBounds, paddingBounds, contentBounds);
    return drawable;
  }

  public static BoundsDrawable getInstance(float density) {
    if (sInstance == null) {
      sInstance = new BoundsDrawable(density);
    }
    return sInstance;
  }

  private BoundsDrawable(float density) {
    mWorkRect = new Rect();
    mMarginBounds = new Rect();
    mPaddingBounds = new Rect();
    mContentBounds = new Rect();

    mDensity = density;

    mTextPaint = new TextPaint();
    mTextPaint.setAntiAlias(true);
    mTextPaint.setTextAlign(Paint.Align.CENTER);
    mTextPaint.setTextSize(dpToPx(8f));
    mAscentOffset = -mTextPaint.ascent() / 2f;
    mStrokeWidth = dpToPx(2f);

    mPaddingPaint = new Paint();
    mPaddingPaint.setStyle(Paint.Style.FILL);
    mPaddingPaint.setColor(COLOR_HIGHLIGHT_PADDING);

    mContentPaint = new Paint();
    mContentPaint.setStyle(Paint.Style.FILL);
    mContentPaint.setColor(COLOR_HIGHLIGHT_CONTENT);

    mMarginPaint = new Paint();
    mMarginPaint.setStyle(Paint.Style.FILL);
    mMarginPaint.setColor(COLOR_HIGHLIGHT_MARGIN);
  }

  public void setBounds(Rect marginBounds, Rect paddingBounds, Rect contentBounds) {
    mMarginBounds.set(marginBounds);
    mPaddingBounds.set(paddingBounds);
    mContentBounds.set(contentBounds);
    setBounds(marginBounds);
  }

  @Override
  public void draw(Canvas canvas) {
    canvas.drawRect(mContentBounds, mContentPaint);

    int saveCount = canvas.save();
    canvas.clipRect(mContentBounds, Region.Op.DIFFERENCE);
    canvas.drawRect(mPaddingBounds, mPaddingPaint);
    canvas.restoreToCount(saveCount);

    saveCount = canvas.save();
    canvas.clipRect(mPaddingBounds, Region.Op.DIFFERENCE);
    canvas.drawRect(mMarginBounds, mMarginPaint);
    canvas.restoreToCount(saveCount);

    drawBoundsDimensions(canvas, mContentBounds);

    // Disabled for now since Sonar doesn't support options too well at this point in time.
    // Once options are supported, we should re-enable the calls below
    // drawCardinalDimensionsBetween(canvas, mContentBounds, mPaddingBounds);
    // drawCardinalDimensionsBetween(canvas, mPaddingBounds, mMarginBounds);
  }

  @Override
  public void setAlpha(int alpha) {
    // No-op
  }

  @Override
  public void setColorFilter(ColorFilter colorFilter) {
    // No-op
  }

  @Override
  public int getOpacity() {
    return PixelFormat.TRANSLUCENT;
  }

  private void drawCardinalDimensionsBetween(Canvas canvas, Rect inner, Rect outer) {
    mWorkRect.set(inner);
    mWorkRect.left = outer.left;
    mWorkRect.right = inner.left;
    drawBoundsDimension(canvas, mWorkRect, mWorkRect.width());
    mWorkRect.left = inner.right;
    mWorkRect.right = outer.right;
    drawBoundsDimension(canvas, mWorkRect, mWorkRect.width());
    mWorkRect.set(outer);
    mWorkRect.bottom = inner.top;
    drawBoundsDimension(canvas, mWorkRect, mWorkRect.height());
    mWorkRect.bottom = outer.bottom;
    mWorkRect.top = inner.bottom;
    drawBoundsDimension(canvas, mWorkRect, mWorkRect.height());
  }

  private void drawBoundsDimension(Canvas canvas, Rect bounds, int value) {
    if (value <= 0) {
      return;
    }
    int saveCount = canvas.save();
    canvas.translate(bounds.centerX(), bounds.centerY());
    drawOutlinedText(canvas, value + "px");
    canvas.restoreToCount(saveCount);
  }

  private void drawBoundsDimensions(Canvas canvas, Rect bounds) {
    int saveCount = canvas.save();
    canvas.translate(bounds.centerX(), bounds.centerY());
    drawOutlinedText(canvas, bounds.width() + "px  \u00D7  " + bounds.height() + "px");
    canvas.restoreToCount(saveCount);
  }

  private void drawOutlinedText(Canvas canvas, String text) {
    mTextPaint.setColor(Color.BLACK);
    mTextPaint.setStrokeWidth(mStrokeWidth);
    mTextPaint.setStyle(Paint.Style.STROKE);
    canvas.drawText(text, 0f, mAscentOffset, mTextPaint);

    mTextPaint.setColor(Color.WHITE);
    mTextPaint.setStrokeWidth(0f);
    mTextPaint.setStyle(Paint.Style.FILL);
    canvas.drawText(text, 0f, mAscentOffset, mTextPaint);
  }

  private int dpToPx(float dp) {
    return (int) (dp * mDensity);
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

package com.facebook.sonar.plugins.inspector;

import android.app.Activity;
import android.app.Dialog;
import android.graphics.drawable.Drawable;
import android.view.View;
import android.view.ViewGroup;
import android.view.Window;
import android.widget.TextView;
import com.facebook.sonar.core.SonarConnection;
import com.facebook.sonar.plugins.inspector.descriptors.ActivityDescriptor;
import com.facebook.sonar.plugins.inspector.descriptors.ApplicationDescriptor;
import com.facebook.sonar.plugins.inspector.descriptors.DialogDescriptor;
import com.facebook.sonar.plugins.inspector.descriptors.DialogFragmentDescriptor;
import com.facebook.sonar.plugins.inspector.descriptors.DrawableDescriptor;
import com.facebook.sonar.plugins.inspector.descriptors.FragmentDescriptor;
import com.facebook.sonar.plugins.inspector.descriptors.ObjectDescriptor;
import com.facebook.sonar.plugins.inspector.descriptors.SupportDialogFragmentDescriptor;
import com.facebook.sonar.plugins.inspector.descriptors.SupportFragmentDescriptor;
import com.facebook.sonar.plugins.inspector.descriptors.TextViewDescriptor;
import com.facebook.sonar.plugins.inspector.descriptors.ViewDescriptor;
import com.facebook.sonar.plugins.inspector.descriptors.ViewGroupDescriptor;
import com.facebook.sonar.plugins.inspector.descriptors.WindowDescriptor;
import java.util.HashMap;
import java.util.Map;

/**
 * A mapping from classes to the object use to describe instances of a class. When looking for a
 * descriptor to describe an object this classs will traverse the object's class hierarchy until it
 * finds a matching descriptor instance.
 */
public class DescriptorMapping {
  private Map<Class<?>, NodeDescriptor<?>> mMapping = new HashMap<>();

  /**
   * @return A DescriptorMapping initialized with default descriptors for java and Android classes.
   */
  public static DescriptorMapping withDefaults() {
    final DescriptorMapping mapping = new DescriptorMapping();
    mapping.register(Object.class, new ObjectDescriptor());
    mapping.register(ApplicationWrapper.class, new ApplicationDescriptor());
    mapping.register(Activity.class, new ActivityDescriptor());
    mapping.register(Window.class, new WindowDescriptor());
    mapping.register(ViewGroup.class, new ViewGroupDescriptor());
    mapping.register(View.class, new ViewDescriptor());
    mapping.register(TextView.class, new TextViewDescriptor());
    mapping.register(Drawable.class, new DrawableDescriptor());
    mapping.register(Dialog.class, new DialogDescriptor());
    mapping.register(android.app.Fragment.class, new FragmentDescriptor());
    mapping.register(android.support.v4.app.Fragment.class, new SupportFragmentDescriptor());
    mapping.register(android.app.DialogFragment.class, new DialogFragmentDescriptor());
    mapping.register(
        android.support.v4.app.DialogFragment.class, new SupportDialogFragmentDescriptor());
    return mapping;
  }

  /** Register a descriptor for a given class. */
  public <T> void register(Class<T> clazz, NodeDescriptor<T> descriptor) {
    mMapping.put(clazz, descriptor);
  }

  NodeDescriptor<?> descriptorForClass(Class<?> clazz) {
    while (!mMapping.containsKey(clazz)) {
      clazz = clazz.getSuperclass();
    }
    return mMapping.get(clazz);
  }

  void onConnect(SonarConnection connection) {
    for (NodeDescriptor descriptor : mMapping.values()) {
      descriptor.setConnection(connection);
      descriptor.setDescriptorMapping(this);
    }
  }

  void onDisconnect() {
    for (NodeDescriptor descriptor : mMapping.values()) {
      descriptor.setConnection(null);
    }
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

package com.facebook.sonar.plugins.inspector;

/** Marker interface to identify nodes which should not be traversed. */
public interface HiddenNode {}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

package com.facebook.sonar.plugins.inspector;

import android.graphics.Rect;
import android.graphics.drawable.Drawable;
import android.os.Build;
import android.view.View;

/**
 * A singleton instance of a overlay drawable used for highlighting node bounds. See {@link
 * NodeDescriptor#setHighlighted(Object, boolean)}.
 */
public class HighlightedOverlay {
  private static final boolean VIEW_OVERLAY_SUPPORT =
      Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN_MR2;

  /**
   * Highlights a particular view with its content bounds, padding and margin dimensions
   *
   * @param targetView The view to apply the highlight on
   * @param margin A {@link Rect} containing the margin values
   * @param padding A {@link Rect} containing the padding values
   * @param contentBounds The {@link Rect} bounds of the content, which includes padding
   */
  public static void setHighlighted(
      View targetView, Rect margin, Rect padding, Rect contentBounds) {
    if (!VIEW_OVERLAY_SUPPORT) {
      return;
    }

    contentBounds.set(
        contentBounds.left + padding.left,
        contentBounds.top + padding.top,
        contentBounds.right - padding.right,
        contentBounds.bottom - padding.bottom);

    padding = enclose(padding, contentBounds);
    margin = enclose(margin, padding);

    final float density = targetView.getContext().getResources().getDisplayMetrics().density;
    final Drawable overlay = BoundsDrawable.getInstance(density, margin, padding, contentBounds);
    targetView.getOverlay().add(overlay);
  }

  public static void removeHighlight(View targetView) {
    if (!VIEW_OVERLAY_SUPPORT) {
      return;
    }

    final float density = targetView.getContext().getResources().getDisplayMetrics().density;
    final Drawable overlay = BoundsDrawable.getInstance(density);
    targetView.getOverlay().remove(overlay);
  }

  private static Rect enclose(Rect parent, Rect child) {
    return new Rect(
        child.left - parent.left,
        child.top - parent.top,
        child.right + parent.right,
        child.bottom + parent.bottom);
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

package com.facebook.sonar.plugins.inspector;

import android.app.Application;
import android.content.Context;
import android.view.MotionEvent;
import android.view.View;
import android.view.ViewGroup;
import com.facebook.sonar.core.ErrorReportingRunnable;
import com.facebook.sonar.core.SonarArray;
import com.facebook.sonar.core.SonarConnection;
import com.facebook.sonar.core.SonarDynamic;
import com.facebook.sonar.core.SonarObject;
import com.facebook.sonar.core.SonarPlugin;
import com.facebook.sonar.core.SonarReceiver;
import com.facebook.sonar.core.SonarResponder;
import com.facebook.sonar.plugins.common.MainThreadSonarReceiver;
import com.facebook.sonar.plugins.console.iface.ConsoleCommandReceiver;
import com.facebook.sonar.plugins.console.iface.NullScriptingEnvironment;
import com.facebook.sonar.plugins.console.iface.ScriptingEnvironment;
import java.util.ArrayList;
import java.util.List;
import javax.annotation.Nullable;

public class InspectorSonarPlugin implements SonarPlugin {

  private ApplicationWrapper mApplication;
  private DescriptorMapping mDescriptorMapping;
  private ObjectTracker mObjectTracker;
  private ScriptingEnvironment mScriptingEnvironment;
  private String mHighlightedId;
  private TouchOverlayView mTouchOverlay;
  private SonarConnection mConnection;

  public InspectorSonarPlugin(
      Context context,
      DescriptorMapping descriptorMapping,
      ScriptingEnvironment scriptingEnvironment) {
    this(
        new ApplicationWrapper((Application) context.getApplicationContext()),
        descriptorMapping,
        scriptingEnvironment);
  }

  public InspectorSonarPlugin(Context context, DescriptorMapping descriptorMapping) {
    this(context, descriptorMapping, new NullScriptingEnvironment());
  }

  // Package visible for testing
  InspectorSonarPlugin(
      ApplicationWrapper wrapper,
      DescriptorMapping descriptorMapping,
      ScriptingEnvironment scriptingEnvironment) {
    mDescriptorMapping = descriptorMapping;

    mObjectTracker = new ObjectTracker();
    mApplication = wrapper;
    mScriptingEnvironment = scriptingEnvironment;
  }

  @Override
  public String getId() {
    return "Inspector";
  }

  @Override
  public void onConnect(SonarConnection connection) throws Exception {
    mConnection = connection;
    mDescriptorMapping.onConnect(connection);

    ConsoleCommandReceiver.listenForCommands(
        connection,
        mScriptingEnvironment,
        new ConsoleCommandReceiver.ContextProvider() {
          @Override
          @Nullable
          public Object getObjectForId(String id) {
            return mObjectTracker.get(id);
          }
        });
    connection.receive("getRoot", mGetRoot);
    connection.receive("getNodes", mGetNodes);
    connection.receive("setData", mSetData);
    connection.receive("setHighlighted", mSetHighlighted);
    connection.receive("setSearchActive", mSetSearchActive);
    connection.receive("getSearchResults", mGetSearchResults);
  }

  @Override
  public void onDisconnect() throws Exception {
    if (mHighlightedId != null) {
      setHighlighted(mHighlightedId, false);
      mHighlightedId = null;
    }

    mObjectTracker.clear();
    mDescriptorMapping.onDisconnect();
    mConnection = null;
  }

  final SonarReceiver mGetRoot =
      new MainThreadSonarReceiver(mConnection) {
        @Override
        public void onReceiveOnMainThread(SonarObject params, SonarResponder responder)
            throws Exception {
          responder.success(getNode(trackObject(mApplication)));
        }
      };

  final SonarReceiver mGetNodes =
      new MainThreadSonarReceiver(mConnection) {
        @Override
        public void onReceiveOnMainThread(final SonarObject params, final SonarResponder responder)
            throws Exception {
          final SonarArray ids = params.getArray("ids");
          final SonarArray.Builder result = new SonarArray.Builder();

          for (int i = 0, count = ids.length(); i < count; i++) {
            final String id = ids.getString(i);
            final SonarObject node = getNode(id);
            if (node != null) {
              result.put(node);
            } else {
              responder.error(
                  new SonarObject.Builder()
                      .put("message", "No node with given id")
                      .put("id", id)
                      .build());
              return;
            }
          }

          responder.success(new SonarObject.Builder().put("elements", result).build());
        }
      };

  final SonarReceiver mSetData =
      new MainThreadSonarReceiver(mConnection) {
        @Override
        public void onReceiveOnMainThread(final SonarObject params, SonarResponder responder)
            throws Exception {
          final String nodeId = params.getString("id");
          final SonarArray keyPath = params.getArray("path");
          final SonarDynamic value = params.getDynamic("value");

          final Object obj = mObjectTracker.get(nodeId);
          if (obj == null) {
            return;
          }

          final NodeDescriptor<Object> descriptor = descriptorForObject(obj);
          if (descriptor == null) {
            return;
          }

          final int count = keyPath.length();
          final String[] path = new String[count];
          for (int i = 0; i < count; i++) {
            path[i] = keyPath.getString(i);
          }

          descriptor.setValue(obj, path, value);
        }
      };

  final SonarReceiver mSetHighlighted =
      new MainThreadSonarReceiver(mConnection) {
        @Override
        public void onReceiveOnMainThread(final SonarObject params, SonarResponder responder)
            throws Exception {
          final String nodeId = params.getString("id");

          if (mHighlightedId != null) {
            setHighlighted(mHighlightedId, false);
          }

          if (nodeId != null) {
            setHighlighted(nodeId, true);
          }

          mHighlightedId = nodeId;
        }
      };

  final SonarReceiver mSetSearchActive =
      new MainThreadSonarReceiver(mConnection) {
        @Override
        public void onReceiveOnMainThread(final SonarObject params, SonarResponder responder)
            throws Exception {
          final boolean active = params.getBoolean("active");
          final List<View> roots = mApplication.getViewRoots();

          ViewGroup root = null;
          for (int i = roots.size() - 1; i >= 0; i--) {
            if (roots.get(i) instanceof ViewGroup) {
              root = (ViewGroup) roots.get(i);
              break;
            }
          }

          if (root != null) {
            if (active) {
              mTouchOverlay = new TouchOverlayView(root.getContext());
              root.addView(mTouchOverlay);
              root.bringChildToFront(mTouchOverlay);
            } else {
              root.removeView(mTouchOverlay);
              mTouchOverlay = null;
            }
          }
        }
      };

  final SonarReceiver mGetSearchResults =
      new MainThreadSonarReceiver(mConnection) {
        @Override
        public void onReceiveOnMainThread(SonarObject params, SonarResponder responder)
            throws Exception {
          final String query = params.getString("query");
          final SearchResultNode matchTree = searchTree(query.toLowerCase(), mApplication);
          final SonarObject results = matchTree == null ? null : matchTree.toSonarObject();
          final SonarObject response =
              new SonarObject.Builder().put("results", results).put("query", query).build();
          responder.success(response);
        }
      };

  class TouchOverlayView extends View implements HiddenNode {
    public TouchOverlayView(Context context) {
      super(context);
      setBackgroundColor(BoundsDrawable.COLOR_HIGHLIGHT_CONTENT);
    }

    @Override
    public boolean onTouchEvent(final MotionEvent event) {
      if (event.getAction() != MotionEvent.ACTION_UP) {
        return true;
      }

      new ErrorReportingRunnable(mConnection) {
        @Override
        public void runOrThrow() throws Exception {
          hitTest((int) event.getX(), (int) event.getY());
        }
      }.run();

      return true;
    }
  }

  void hitTest(final int touchX, final int touchY) throws Exception {
    final SonarArray.Builder path = new SonarArray.Builder();
    path.put(trackObject(mApplication));

    final Touch touch =
        new Touch() {
          int x = touchX;
          int y = touchY;
          Object node = mApplication;

          @Override
          public void finish() {
            mConnection.send("select", new SonarObject.Builder().put("path", path).build());
          }

          @Override
          public void continueWithOffset(
              final int childIndex, final int offsetX, final int offsetY) {
            final Touch touch = this;

            new ErrorReportingRunnable(mConnection) {
              @Override
              protected void runOrThrow() throws Exception {
                x -= offsetX;
                y -= offsetY;

                node = assertNotNull(descriptorForObject(node).getChildAt(node, childIndex));
                path.put(trackObject(node));

                final NodeDescriptor<Object> descriptor = descriptorForObject(node);
                descriptor.hitTest(node, touch);
              }
            }.run();
          }

          @Override
          public boolean containedIn(int l, int t, int r, int b) {
            return x >= l && x <= r && y >= t && y <= b;
          }
        };

    final NodeDescriptor<Object> descriptor = descriptorForObject(mApplication);
    descriptor.hitTest(mApplication, touch);
  }

  private void setHighlighted(final String id, final boolean highlighted) throws Exception {
    final Object obj = mObjectTracker.get(id);
    if (obj == null) {
      return;
    }

    final NodeDescriptor<Object> descriptor = descriptorForObject(obj);
    if (descriptor == null) {
      return;
    }

    descriptor.setHighlighted(obj, highlighted);
  }

  public SearchResultNode searchTree(String query, Object obj) throws Exception {
    final NodeDescriptor descriptor = descriptorForObject(obj);
    List<SearchResultNode> childTrees = null;
    boolean isMatch = descriptor.matches(query, obj);

    for (int i = 0; i < descriptor.getChildCount(obj); i++) {
      Object child = descriptor.getChildAt(obj, i);
      SearchResultNode childNode = searchTree(query, child);
      if (childNode != null) {
        if (childTrees == null) {
          childTrees = new ArrayList<>();
        }
        childTrees.add(childNode);
      }
    }

    if (isMatch || childTrees != null) {
      final String id = trackObject(obj);
      return new SearchResultNode(id, isMatch, getNode(id), childTrees);
    }
    return null;
  }

  private @Nullable SonarObject getNode(String id) throws Exception {
    final Object obj = mObjectTracker.get(id);
    if (obj == null) {
      return null;
    }

    final NodeDescriptor<Object> descriptor = descriptorForObject(obj);
    if (descriptor == null) {
      return null;
    }

    final SonarArray.Builder children = new SonarArray.Builder();
    new ErrorReportingRunnable(mConnection) {
      @Override
      protected void runOrThrow() throws Exception {
        for (int i = 0, count = descriptor.getChildCount(obj); i < count; i++) {
          final Object child = assertNotNull(descriptor.getChildAt(obj, i));
          children.put(trackObject(child));
        }
      }
    }.run();

    final SonarObject.Builder data = new SonarObject.Builder();
    new ErrorReportingRunnable(mConnection) {
      @Override
      protected void runOrThrow() throws Exception {
        for (Named<SonarObject> props : descriptor.getData(obj)) {
          data.put(props.getName(), props.getValue());
        }
      }
    }.run();

    final SonarArray.Builder attributes = new SonarArray.Builder();
    new ErrorReportingRunnable(mConnection) {
      @Override
      protected void runOrThrow() throws Exception {
        for (Named<String> attribute : descriptor.getAttributes(obj)) {
          attributes.put(
              new SonarObject.Builder()
                  .put("name", attribute.getName())
                  .put("value", attribute.getValue())
                  .build());
        }
      }
    }.run();

    return new SonarObject.Builder()
        .put("id", descriptor.getId(obj))
        .put("name", descriptor.getName(obj))
        .put("data", data)
        .put("children", children)
        .put("attributes", attributes)
        .put("decoration", descriptor.getDecoration(obj))
        .build();
  }

  private String trackObject(Object obj) throws Exception {
    final NodeDescriptor<Object> descriptor = descriptorForObject(obj);
    final String id = descriptor.getId(obj);
    final Object curr = mObjectTracker.get(id);
    if (obj != curr) {
      mObjectTracker.put(id, obj);
      descriptor.init(obj);
    }
    return id;
  }

  private NodeDescriptor<Object> descriptorForObject(Object obj) {
    final Class c = assertNotNull(obj).getClass();
    return (NodeDescriptor<Object>) mDescriptorMapping.descriptorForClass(c);
  }

  private static Object assertNotNull(@Nullable Object o) {
    if (o == null) {
      throw new AssertionError("Unexpected null value");
    }
    return o;
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

package com.facebook.sonar.plugins.inspector;

import com.facebook.sonar.core.SonarObject;
import com.facebook.sonar.core.SonarValue;

public class InspectorValue<T> implements SonarValue {

  /**
   * Descrive the type of data this value contains. This will influence how values are parsed and
   * displayed by the Sonar desktop app. For example colors will be parse as integers and displayed
   * using hex values and be editable using a color picker.
   *
   * <p>Do not extends this list of types without adding support for the type in the desktop
   * Inspector.
   */
  public static class Type<T> {

    public static final Type Auto = new Type<>("auto");
    public static final Type<String> Text = new Type<>("text");
    public static final Type<Number> Number = new Type<>("number");
    public static final Type<Boolean> Boolean = new Type<>("boolean");
    public static final Type<String> Enum = new Type<>("enum");
    public static final Type<Integer> Color = new Type<>("color");

    private final String mName;

    Type(String name) {
      mName = name;
    }

    @Override
    public String toString() {
      return mName;
    }
  }

  final Type<T> mType;
  final T mValue;
  final boolean mMutable;

  private InspectorValue(Type<T> type, T value, boolean mutable) {
    mType = type;
    mValue = value;
    mMutable = mutable;
  }

  public static <T> InspectorValue<T> mutable(Type<T> type, T value) {
    return new InspectorValue<>(type, value, true);
  }

  public static <T> InspectorValue<T> immutable(Type<T> type, T value) {
    return new InspectorValue<>(type, value, false);
  }

  public static InspectorValue mutable(Object value) {
    return new InspectorValue<>(Type.Auto, value, true);
  }

  public static InspectorValue immutable(Object value) {
    return new InspectorValue<>(Type.Auto, value, false);
  }

  @Override
  public SonarObject toSonarObject() {
    return new SonarObject.Builder()
        .put("__type__", mType)
        .put("__mutable__", mMutable)
        .put("value", mValue)
        .build();
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

package com.facebook.sonar.plugins.inspector;

public class Named<ValueType> {
  private final String mName;
  private final ValueType mValue;

  public Named(String name, ValueType value) {
    mName = name;
    mValue = value;
  }

  public String getName() {
    return mName;
  }

  public ValueType getValue() {
    return mValue;
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

package com.facebook.sonar.plugins.inspector;

import com.facebook.sonar.core.SonarArray;
import com.facebook.sonar.core.SonarConnection;
import com.facebook.sonar.core.SonarDynamic;
import com.facebook.sonar.core.SonarObject;
import java.util.List;

/**
 * A NodeDescriptor is an object which known how to expose an Object of type T to the ew Inspector.
 * This class is the extension point for the Sonar inspector plugin and is how custom classes and
 * data can be exposed to the inspector.
 */
public abstract class NodeDescriptor<T> {
  private SonarConnection mConnection;
  private DescriptorMapping mDescriptorMapping;

  void setConnection(SonarConnection connection) {
    mConnection = connection;
  }

  void setDescriptorMapping(DescriptorMapping descriptorMapping) {
    mDescriptorMapping = descriptorMapping;
  }

  /**
   * @return The descriptor for a given class. This is useful for when a descriptor wants to
   *     delegate parts of its implementation to another descriptor, say the super class of the
   *     object it describes. This is highly encouraged instead of subclassing another descriptor
   *     class.
   */
  protected final NodeDescriptor<?> descriptorForClass(Class<?> clazz) {
    return mDescriptorMapping.descriptorForClass(clazz);
  }

  /**
   * Invalidate a node. This tells Sonar that this node is no longer valid and its properties and/or
   * children have changed. This will trigger Sonar to re-query this node getting any new data.
   */
  protected final void invalidate(final T node) {
    if (mConnection != null) {
      new ErrorReportingRunnable() {
        @Override
        protected void runOrThrow() throws Exception {
          SonarArray array =
              new SonarArray.Builder()
                  .put(new SonarObject.Builder().put("id", getId(node)).build())
                  .build();
          SonarObject params = new SonarObject.Builder().put("nodes", array).build();
          mConnection.send("invalidate", params);
        }
      }.run();
    }
  }

  protected final boolean connected() {
    return mConnection != null;
  }

  protected abstract class ErrorReportingRunnable
      extends com.facebook.sonar.core.ErrorReportingRunnable {
    public ErrorReportingRunnable() {
      super(mConnection);
    }
  }

  /**
   * Initialize a node. This implementation usually consists of setting up listeners to know when to
   * call {@link NodeDescriptor#invalidate(Object)}.
   */
  public abstract void init(T node) throws Exception;

  /**
   * A globally unique ID used to identify a node in a hierarchy. If your node does not have a
   * globally unique ID it is fine to rely on {@link System#identityHashCode(Object)}.
   */
  public abstract String getId(T node) throws Exception;

  /**
   * The name used to identify this node in the inspector. Does not need to be unique. A good
   * default is to use the class name of the node.
   */
  public abstract String getName(T node) throws Exception;

  /** @return The number of children this node exposes in the inspector. */
  public abstract int getChildCount(T node) throws Exception;

  /** @return The child at index. */
  public abstract Object getChildAt(T node, int index) throws Exception;

  /**
   * Get the data to show for this node in the sidebar of the inspector. The object will be showen
   * in order and with a header matching the given name.
   */
  public abstract List<Named<SonarObject>> getData(T node) throws Exception;

  /**
   * Set a value on the provided node at the given path. The path will match a key path in the data
   * provided by {@link this#getData(Object)} and the value will be of the same type as the value
   * mathcing that path in the returned object.
   */
  public abstract void setValue(T node, String[] path, SonarDynamic value) throws Exception;

  /**
   * Get the attributes for this node. This is a list of read-only string:string mapping which show
   * up inline in the elements inspector. See {@link Named} for more information.
   */
  public abstract List<Named<String>> getAttributes(T node) throws Exception;

  /**
   * Highlight this node. Use {@link HighlightedOverlay} if possible. This is used to highlight a
   * node which is selected in the inspector. The plugin automatically takes care of de-selecting
   * the previously highlighted node.
   */
  public abstract void setHighlighted(T node, boolean selected) throws Exception;

  /**
   * Perform hit testing on the given node. Either continue the search in a child with {@link
   * Touch#continueWithOffset(int, int, int)} or finish the hit testing on this node with {@link
   * Touch#finish()}
   */
  public abstract void hitTest(T node, Touch touch) throws Exception;

  /**
   * @return A string indicating how this element should be decorated. Check with the Sonar desktop
   *     app to see what values are supported.
   */
  public abstract String getDecoration(T node) throws Exception;

  /**
   * Test this node against a given query to see if it matches. This is used for finding search
   * results.
   */
  public abstract boolean matches(String query, T node) throws Exception;
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

package com.facebook.sonar.plugins.inspector;

import java.lang.ref.WeakReference;
import java.util.HashMap;
import java.util.Map;
import javax.annotation.Nullable;

class ObjectTracker {
  private final Map<String, WeakReference<Object>> mObjects = new HashMap<>();

  void put(String id, Object obj) {
    mObjects.put(id, new WeakReference<>(obj));
  }

  @Nullable
  Object get(String id) {
    final WeakReference<Object> weakObj = mObjects.get(id);
    if (weakObj == null) {
      return null;
    }

    final Object obj = weakObj.get();
    if (obj == null) {
      mObjects.remove(id);
    }

    return obj;
  }

  void clear() {
    mObjects.clear();
  }

  boolean contains(String id) {
    return mObjects.containsKey(id);
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

package com.facebook.sonar.plugins.inspector;

import android.support.annotation.Nullable;
import com.facebook.sonar.core.SonarArray;
import com.facebook.sonar.core.SonarObject;
import java.util.List;

public class SearchResultNode {

  private final String id;
  private final boolean isMatch;
  private final SonarObject element;
  @Nullable
  private final List<SearchResultNode> children;

  SearchResultNode(
      String id, boolean isMatch, SonarObject element, @Nullable List<SearchResultNode> children) {
    this.id = id;
    this.isMatch = isMatch;
    this.element = element;
    this.children = children;
  }

  SonarObject toSonarObject() {
    final SonarArray childArray;
    if (children != null) {
      final SonarArray.Builder builder = new SonarArray.Builder();
      for (SearchResultNode child : children) {
        builder.put(child.toSonarObject());
      }
      childArray = builder.build();
    } else {
      childArray = null;
    }

    return new SonarObject.Builder()
        .put("id", this.id)
        .put("isMatch", this.isMatch)
        .put("element", this.element)
        .put("children", childArray)
        .build();
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

package com.facebook.sonar.plugins.inspector;

public abstract class SelfRegisteringNodeDescriptor<T> extends NodeDescriptor<T> {

  public abstract void register(DescriptorMapping descriptorMapping);
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

package com.facebook.sonar.plugins.inspector;

/**
 * Used to collect the path from the root node to the node at point [x, y]. This is used for
 * creating a node path to the targeting node from the root when performing hit testing.
 */
public interface Touch {

  /**
   * Call this when the path has reached its destination. This should be called from the descriptor
   * which described the leaf node containing [x, y].
   */
  void finish();

  /**
   * Continue hit testing in child at the given index. Offseting the touch location to the child's
   * coordinate system.
   */
  void continueWithOffset(int childIndex, int offsetX, int offsetY);

  /** @return Whether or not this Touch is contained within the provided bounds. */
  boolean containedIn(int l, int t, int r, int b);
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

package com.facebook.sonar.plugins.inspector.descriptors;

import android.app.Activity;
import android.view.Window;
import com.facebook.sonar.core.SonarDynamic;
import com.facebook.sonar.core.SonarObject;
import com.facebook.sonar.plugins.inspector.Named;
import com.facebook.sonar.plugins.inspector.NodeDescriptor;
import com.facebook.sonar.plugins.inspector.Touch;
import com.facebook.stetho.common.android.FragmentActivityAccessor;
import com.facebook.stetho.common.android.FragmentCompat;
import com.facebook.stetho.common.android.FragmentManagerAccessor;
import java.util.ArrayList;
import java.util.Collections;
import java.util.List;
import javax.annotation.Nullable;

public class ActivityDescriptor extends NodeDescriptor<Activity> {

  @Override
  public void init(Activity node) {}

  @Override
  public String getId(Activity node) {
    return Integer.toString(System.identityHashCode(node));
  }

  @Override
  public String getName(Activity node) {
    return node.getClass().getSimpleName();
  }

  @Override
  public int getChildCount(Activity node) {
    return (node.getWindow() != null ? 1 : 0)
        + getDialogFragments(FragmentCompat.getSupportLibInstance(), node).size()
        + getDialogFragments(FragmentCompat.getFrameworkInstance(), node).size();
  }

  @Override
  public Object getChildAt(Activity node, int index) {
    if (node.getWindow() != null) {
      if (index == 0) {
        return node.getWindow();
      } else {
        index--;
      }
    }

    final List dialogs = getDialogFragments(FragmentCompat.getSupportLibInstance(), node);
    if (index < dialogs.size()) {
      return dialogs.get(index);
    } else {
      final List supportDialogs = getDialogFragments(FragmentCompat.getFrameworkInstance(), node);
      return supportDialogs.get(index - dialogs.size());
    }
  }

  @Override
  public List<Named<SonarObject>> getData(Activity node) {
    return Collections.EMPTY_LIST;
  }

  @Override
  public void setValue(Activity node, String[] path, SonarDynamic value) throws Exception {}

  @Override
  public List<Named<String>> getAttributes(Activity node) {
    return Collections.EMPTY_LIST;
  }

  @Override
  public void setHighlighted(Activity node, boolean selected) throws Exception {
    final NodeDescriptor descriptor = descriptorForClass(Window.class);
    descriptor.setHighlighted(node.getWindow(), selected);
  }

  @Override
  public void hitTest(Activity node, Touch touch) {
    touch.continueWithOffset(0, 0, 0);
  }

  @Override
  public @Nullable String getDecoration(Activity obj) {
    return null;
  }

  @Override
  public boolean matches(String query, Activity node) throws Exception {
    NodeDescriptor descriptor = descriptorForClass(Object.class);
    return descriptor.matches(query, node);
  }

  private static List<Object> getDialogFragments(FragmentCompat compat, Activity activity) {
    if (compat == null || !compat.getFragmentActivityClass().isInstance(activity)) {
      return Collections.EMPTY_LIST;
    }

    FragmentActivityAccessor activityAccessor = compat.forFragmentActivity();
    Object fragmentManager = activityAccessor.getFragmentManager(activity);
    if (fragmentManager == null) {
      return Collections.EMPTY_LIST;
    }

    FragmentManagerAccessor fragmentManagerAccessor = compat.forFragmentManager();
    List<Object> addedFragments = fragmentManagerAccessor.getAddedFragments(fragmentManager);
    if (addedFragments == null) {
      return Collections.EMPTY_LIST;
    }

    final List<Object> dialogFragments = new ArrayList<>();
    for (int i = 0, N = addedFragments.size(); i < N; ++i) {
      final Object fragment = addedFragments.get(i);
      if (compat.getDialogFragmentClass().isInstance(fragment)) {
        dialogFragments.add(fragment);
      }
    }

    return dialogFragments;
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

package com.facebook.sonar.plugins.inspector.descriptors;

import android.app.Activity;
import android.view.View;
import android.view.ViewGroup;
import com.facebook.sonar.core.SonarDynamic;
import com.facebook.sonar.core.SonarObject;
import com.facebook.sonar.plugins.inspector.ApplicationWrapper;
import com.facebook.sonar.plugins.inspector.Named;
import com.facebook.sonar.plugins.inspector.NodeDescriptor;
import com.facebook.sonar.plugins.inspector.Touch;
import java.util.Collections;
import java.util.List;
import javax.annotation.Nullable;

public class ApplicationDescriptor extends NodeDescriptor<ApplicationWrapper> {

  private class NodeKey {
    private int[] mKey;

    boolean set(ApplicationWrapper node) {
      final List<View> roots = node.getViewRoots();
      final int childCount = roots.size();
      final int[] key = new int[childCount];

      for (int i = 0; i < childCount; i++) {
        final View child = roots.get(i);
        key[i] = System.identityHashCode(child);
      }

      boolean changed = false;
      if (mKey == null) {
        changed = true;
      } else if (mKey.length != key.length) {
        changed = true;
      } else {
        for (int i = 0; i < childCount; i++) {
          if (mKey[i] != key[i]) {
            changed = true;
            break;
          }
        }
      }

      mKey = key;
      return changed;
    }
  }

  @Override
  public void init(final ApplicationWrapper node) {
    node.setListener(
        new ApplicationWrapper.ActivityStackChangedListener() {
          @Override
          public void onActivityStackChanged(List<Activity> stack) {
            invalidate(node);
          }
        });

    final NodeKey key = new NodeKey();
    final Runnable maybeInvalidate =
        new NodeDescriptor.ErrorReportingRunnable() {
          @Override
          public void runOrThrow() throws Exception {
            if (connected()) {
              if (key.set(node)) {
                invalidate(node);
              }
              node.postDelayed(this, 1000);
            }
          }
        };

    node.postDelayed(maybeInvalidate, 1000);
  }

  @Override
  public String getId(ApplicationWrapper node) {
    return node.getApplication().getPackageName();
  }

  @Override
  public String getName(ApplicationWrapper node) {
    return node.getApplication().getPackageName();
  }

  @Override
  public int getChildCount(ApplicationWrapper node) {
    return node.getViewRoots().size();
  }

  @Override
  public Object getChildAt(ApplicationWrapper node, int index) {
    final View view = node.getViewRoots().get(index);

    for (Activity activity : node.getActivityStack()) {
      if (activity.getWindow().getDecorView() == view) {
        return activity;
      }
    }

    return view;
  }

  @Override
  public List<Named<SonarObject>> getData(ApplicationWrapper node) {
    return Collections.EMPTY_LIST;
  }

  @Override
  public void setValue(ApplicationWrapper node, String[] path, SonarDynamic value) {}

  @Override
  public List<Named<String>> getAttributes(ApplicationWrapper node) {
    return Collections.EMPTY_LIST;
  }

  @Override
  public void setHighlighted(ApplicationWrapper node, boolean selected) throws Exception {
    final int childCount = getChildCount(node);
    if (childCount > 0) {
      final Object topChild = getChildAt(node, childCount - 1);
      final NodeDescriptor descriptor = descriptorForClass(topChild.getClass());
      descriptor.setHighlighted(topChild, selected);
    }
  }

  @Override
  public void hitTest(ApplicationWrapper node, Touch touch) {
    final int childCount = getChildCount(node);

    for (int i = childCount - 1; i >= 0; i--) {
      final Object child = getChildAt(node, i);
      if (child instanceof Activity || child instanceof ViewGroup) {
        touch.continueWithOffset(i, 0, 0);
        return;
      }
    }

    touch.finish();
  }

  @Override
  public @Nullable String getDecoration(ApplicationWrapper obj) {
    return null;
  }

  @Override
  public boolean matches(String query, ApplicationWrapper node) throws Exception {
    NodeDescriptor descriptor = descriptorForClass(Object.class);
    return descriptor.matches(query, node);
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

package com.facebook.sonar.plugins.inspector.descriptors;

import android.app.Dialog;
import android.view.Window;
import com.facebook.sonar.core.SonarDynamic;
import com.facebook.sonar.core.SonarObject;
import com.facebook.sonar.plugins.inspector.Named;
import com.facebook.sonar.plugins.inspector.NodeDescriptor;
import com.facebook.sonar.plugins.inspector.Touch;
import java.util.Collections;
import java.util.List;
import javax.annotation.Nullable;

public class DialogDescriptor extends NodeDescriptor<Dialog> {

  @Override
  public void init(Dialog node) {}

  @Override
  public String getId(Dialog node) {
    return Integer.toString(System.identityHashCode(node));
  }

  @Override
  public String getName(Dialog node) {
    return node.getClass().getSimpleName();
  }

  @Override
  public int getChildCount(Dialog node) {
    return node.getWindow() == null ? 0 : 1;
  }

  @Override
  public Object getChildAt(Dialog node, int index) {
    return node.getWindow();
  }

  @Override
  public List<Named<SonarObject>> getData(Dialog node) {
    return Collections.EMPTY_LIST;
  }

  @Override
  public void setValue(Dialog node, String[] path, SonarDynamic value) {}

  @Override
  public List<Named<String>> getAttributes(Dialog node) {
    return Collections.EMPTY_LIST;
  }

  @Override
  public void setHighlighted(Dialog node, boolean selected) throws Exception {
    final NodeDescriptor descriptor = descriptorForClass(Window.class);
    descriptor.setHighlighted(node.getWindow(), selected);
  }

  @Override
  public void hitTest(Dialog node, Touch touch) {
    touch.continueWithOffset(0, 0, 0);
  }

  @Override
  public @Nullable String getDecoration(Dialog obj) {
    return null;
  }

  @Override
  public boolean matches(String query, Dialog node) throws Exception {
    NodeDescriptor descriptor = descriptorForClass(Object.class);
    return descriptor.matches(query, node);
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

package com.facebook.sonar.plugins.inspector.descriptors;

import android.app.Dialog;
import android.app.DialogFragment;
import android.app.Fragment;
import com.facebook.sonar.core.SonarDynamic;
import com.facebook.sonar.core.SonarObject;
import com.facebook.sonar.plugins.inspector.Named;
import com.facebook.sonar.plugins.inspector.NodeDescriptor;
import com.facebook.sonar.plugins.inspector.Touch;
import java.util.List;
import javax.annotation.Nullable;

public class DialogFragmentDescriptor extends NodeDescriptor<DialogFragment> {

  @Override
  public void init(DialogFragment node) {}

  @Override
  public String getId(DialogFragment node) throws Exception {
    final NodeDescriptor descriptor = descriptorForClass(Fragment.class);
    return descriptor.getId(node);
  }

  @Override
  public String getName(DialogFragment node) throws Exception {
    final NodeDescriptor descriptor = descriptorForClass(Fragment.class);
    return descriptor.getName(node);
  }

  @Override
  public int getChildCount(DialogFragment node) {
    return node.getDialog() == null ? 0 : 1;
  }

  @Override
  public Object getChildAt(DialogFragment node, int index) {
    return node.getDialog();
  }

  @Override
  public List<Named<SonarObject>> getData(DialogFragment node) throws Exception {
    final NodeDescriptor descriptor = descriptorForClass(Fragment.class);
    return descriptor.getData(node);
  }

  @Override
  public void setValue(DialogFragment node, String[] path, SonarDynamic value) throws Exception {
    final NodeDescriptor descriptor = descriptorForClass(Fragment.class);
    descriptor.setValue(node, path, value);
  }

  @Override
  public List<Named<String>> getAttributes(DialogFragment node) throws Exception {
    final NodeDescriptor descriptor = descriptorForClass(Fragment.class);
    return descriptor.getAttributes(node);
  }

  @Override
  public void setHighlighted(DialogFragment node, boolean selected) throws Exception {
    final NodeDescriptor descriptor = descriptorForClass(Dialog.class);
    if (node.getDialog() != null) {
      descriptor.setHighlighted(node.getDialog(), selected);
    }
  }

  @Override
  public void hitTest(DialogFragment node, Touch touch) {
    touch.continueWithOffset(0, 0, 0);
  }

  @Override
  public @Nullable String getDecoration(DialogFragment obj) {
    return null;
  }

  @Override
  public boolean matches(String query, DialogFragment node) throws Exception {
    NodeDescriptor descriptor = descriptorForClass(Object.class);
    return descriptor.matches(query, node);
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

package com.facebook.sonar.plugins.inspector.descriptors;

import android.graphics.Rect;
import android.graphics.drawable.Drawable;
import android.os.Build;
import android.view.View;
import com.facebook.sonar.core.SonarDynamic;
import com.facebook.sonar.core.SonarObject;
import com.facebook.sonar.plugins.inspector.HighlightedOverlay;
import com.facebook.sonar.plugins.inspector.InspectorValue;
import com.facebook.sonar.plugins.inspector.Named;
import com.facebook.sonar.plugins.inspector.NodeDescriptor;
import com.facebook.sonar.plugins.inspector.Touch;
import java.util.Arrays;
import java.util.Collections;
import java.util.List;
import javax.annotation.Nullable;

public class DrawableDescriptor extends NodeDescriptor<Drawable> {

  @Override
  public void init(Drawable node) {}

  @Override
  public String getId(Drawable node) {
    return Integer.toString(System.identityHashCode(node));
  }

  @Override
  public String getName(Drawable node) {
    return node.getClass().getSimpleName();
  }

  @Override
  public int getChildCount(Drawable node) {
    return 0;
  }

  @Override
  public @Nullable Object getChildAt(Drawable node, int index) {
    return null;
  }

  @Override
  public List<Named<SonarObject>> getData(Drawable node) {
    final SonarObject.Builder props = new SonarObject.Builder();
    final Rect bounds = node.getBounds();

    props.put("left", InspectorValue.mutable(bounds.left));
    props.put("top", InspectorValue.mutable(bounds.top));
    props.put("right", InspectorValue.mutable(bounds.right));
    props.put("bottom", InspectorValue.mutable(bounds.bottom));

    if (hasAlphaSupport()) {
      props.put("alpha", InspectorValue.mutable(node.getAlpha()));
    }

    return Arrays.asList(new Named<>("Drawable", props.build()));
  }

  @Override
  public void setValue(Drawable node, String[] path, SonarDynamic value) {
    final Rect bounds = node.getBounds();

    switch (path[0]) {
      case "Drawable":
        switch (path[1]) {
          case "left":
            bounds.left = value.asInt();
            node.setBounds(bounds);
            break;
          case "top":
            bounds.top = value.asInt();
            node.setBounds(bounds);
            break;
          case "right":
            bounds.right = value.asInt();
            node.setBounds(bounds);
            break;
          case "bottom":
            bounds.bottom = value.asInt();
            node.setBounds(bounds);
            break;
          case "alpha":
            node.setAlpha(value.asInt());
            break;
        }
        break;
    }
  }

  private static boolean hasAlphaSupport() {
    return Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT;
  }

  @Override
  public List<Named<String>> getAttributes(Drawable node) {
    return Collections.EMPTY_LIST;
  }

  @Override
  public void setHighlighted(Drawable node, boolean selected) {
    // Ensure we handle wrapping drawable
    Drawable.Callback callbacks = node.getCallback();
    while (callbacks instanceof Drawable) {
      callbacks = ((Drawable) callbacks).getCallback();
    }

    if (!(callbacks instanceof View)) {
      return;
    }

    final View callbackView = (View) callbacks;
    if (selected) {
      final Rect zero = new Rect();
      final Rect bounds = node.getBounds();
      HighlightedOverlay.setHighlighted(callbackView, zero, zero, bounds);
    } else {
      HighlightedOverlay.removeHighlight(callbackView);
    }
  }

  @Override
  public void hitTest(Drawable node, Touch touch) {
    touch.finish();
  }

  @Override
  public @Nullable String getDecoration(Drawable obj) {
    return null;
  }

  @Override
  public boolean matches(String query, Drawable node) throws Exception {
    NodeDescriptor descriptor = descriptorForClass(Object.class);
    return descriptor.matches(query, node);
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

package com.facebook.sonar.plugins.inspector.descriptors;

import android.app.Fragment;
import android.os.Bundle;
import android.view.View;
import com.facebook.sonar.core.SonarDynamic;
import com.facebook.sonar.core.SonarObject;
import com.facebook.sonar.plugins.inspector.Named;
import com.facebook.sonar.plugins.inspector.NodeDescriptor;
import com.facebook.sonar.plugins.inspector.Touch;
import com.facebook.stetho.common.android.ResourcesUtil;
import java.util.Arrays;
import java.util.Collections;
import java.util.List;
import javax.annotation.Nullable;

public class FragmentDescriptor extends NodeDescriptor<Fragment> {

  @Override
  public void init(Fragment node) {}

  @Override
  public String getId(Fragment node) {
    return Integer.toString(System.identityHashCode(node));
  }

  @Override
  public String getName(Fragment node) {
    return node.getClass().getSimpleName();
  }

  @Override
  public int getChildCount(Fragment node) {
    return node.getView() == null ? 0 : 1;
  }

  @Override
  public Object getChildAt(Fragment node, int index) {
    return node.getView();
  }

  @Override
  public List<Named<SonarObject>> getData(Fragment node) {
    final Bundle args = node.getArguments();
    if (args == null || args.isEmpty()) {
      return Collections.EMPTY_LIST;
    }

    final SonarObject.Builder bundle = new SonarObject.Builder();

    for (String key : args.keySet()) {
      bundle.put(key, args.get(key));
    }

    return Arrays.asList(new Named<>("Arguments", bundle.build()));
  }

  @Override
  public void setValue(Fragment node, String[] path, SonarDynamic value) {}

  @Override
  public List<Named<String>> getAttributes(Fragment node) {
    final String resourceId = getResourceId(node);

    if (resourceId == null) {
      return Collections.EMPTY_LIST;
    }

    return Arrays.asList(new Named<>("id", resourceId));
  }

  @Nullable
  private static String getResourceId(Fragment node) {
    final int id = node.getId();

    if (id == View.NO_ID || node.getHost() == null) {
      return null;
    }

    return ResourcesUtil.getIdStringQuietly(node.getContext(), node.getResources(), id);
  }

  @Override
  public void setHighlighted(Fragment node, boolean selected) throws Exception {
    if (node.getView() == null) {
      return;
    }

    final NodeDescriptor descriptor = descriptorForClass(View.class);
    descriptor.setHighlighted(node.getView(), selected);
  }

  @Override
  public void hitTest(Fragment node, Touch touch) {
    touch.continueWithOffset(0, 0, 0);
  }

  @Override
  public @Nullable String getDecoration(Fragment obj) {
    return null;
  }

  @Override
  public boolean matches(String query, Fragment node) throws Exception {
    final String resourceId = getResourceId(node);

    if (resourceId != null) {
      if (resourceId.toLowerCase().contains(query)) {
        return true;
      }
    }

    final NodeDescriptor objectDescriptor = descriptorForClass(Object.class);
    return objectDescriptor.matches(query, node);
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

package com.facebook.sonar.plugins.inspector.descriptors;

import com.facebook.sonar.core.SonarDynamic;
import com.facebook.sonar.core.SonarObject;
import com.facebook.sonar.plugins.inspector.Named;
import com.facebook.sonar.plugins.inspector.NodeDescriptor;
import com.facebook.sonar.plugins.inspector.Touch;
import java.util.Collections;
import java.util.List;
import javax.annotation.Nullable;

public class ObjectDescriptor extends NodeDescriptor<Object> {

  @Override
  public void init(Object node) {}

  @Override
  public String getId(Object node) {
    return Integer.toString(System.identityHashCode(node));
  }

  @Override
  public String getName(Object node) {
    return node.getClass().getName();
  }

  @Override
  public int getChildCount(Object node) {
    return 0;
  }

  @Override
  public @Nullable Object getChildAt(Object node, int index) {
    return null;
  }

  @Override
  public List<Named<SonarObject>> getData(Object node) {
    return Collections.EMPTY_LIST;
  }

  @Override
  public void setValue(Object node, String[] path, SonarDynamic value) {}

  @Override
  public List<Named<String>> getAttributes(Object node) {
    return Collections.EMPTY_LIST;
  }

  @Override
  public void setHighlighted(Object node, boolean selected) {}

  @Override
  public void hitTest(Object node, Touch touch) {
    touch.finish();
  }

  @Override
  public @Nullable String getDecoration(Object obj) {
    return null;
  }

  @Override
  public boolean matches(String query, Object node) throws Exception {
    final NodeDescriptor descriptor = descriptorForClass(node.getClass());
    final List<Named<String>> attributes = descriptor.getAttributes(node);
    for (Named<String> namedString : attributes) {
      if (namedString.getName().equals("id")) {
        if (namedString.getValue().toLowerCase().contains(query)) {
          return true;
        }
      }
    }

    return descriptor.getName(node).toLowerCase().contains(query);
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

package com.facebook.sonar.plugins.inspector.descriptors;

import android.app.Dialog;
import android.support.v4.app.DialogFragment;
import android.support.v4.app.Fragment;
import com.facebook.sonar.core.SonarDynamic;
import com.facebook.sonar.core.SonarObject;
import com.facebook.sonar.plugins.inspector.Named;
import com.facebook.sonar.plugins.inspector.NodeDescriptor;
import com.facebook.sonar.plugins.inspector.Touch;
import java.util.List;
import javax.annotation.Nullable;

public class SupportDialogFragmentDescriptor extends NodeDescriptor<DialogFragment> {

  @Override
  public void init(DialogFragment node) {}

  @Override
  public String getId(DialogFragment node) throws Exception {
    final NodeDescriptor descriptor = descriptorForClass(Fragment.class);
    return descriptor.getId(node);
  }

  @Override
  public String getName(DialogFragment node) throws Exception {
    final NodeDescriptor descriptor = descriptorForClass(Fragment.class);
    return descriptor.getName(node);
  }

  @Override
  public int getChildCount(DialogFragment node) {
    return node.getDialog() == null ? 0 : 1;
  }

  @Override
  public Object getChildAt(DialogFragment node, int index) {
    return node.getDialog();
  }

  @Override
  public List<Named<SonarObject>> getData(DialogFragment node) throws Exception {
    final NodeDescriptor descriptor = descriptorForClass(Fragment.class);
    return descriptor.getData(node);
  }

  @Override
  public void setValue(DialogFragment node, String[] path, SonarDynamic value) throws Exception {
    final NodeDescriptor descriptor = descriptorForClass(Fragment.class);
    descriptor.setValue(node, path, value);
  }

  @Override
  public List<Named<String>> getAttributes(DialogFragment node) throws Exception {
    final NodeDescriptor descriptor = descriptorForClass(Fragment.class);
    return descriptor.getAttributes(node);
  }

  @Override
  public void setHighlighted(DialogFragment node, boolean selected) throws Exception {
    final NodeDescriptor descriptor = descriptorForClass(Dialog.class);
    if (node.getDialog() != null) {
      descriptor.setHighlighted(node.getDialog(), selected);
    }
  }

  @Override
  public void hitTest(DialogFragment node, Touch touch) {
    touch.continueWithOffset(0, 0, 0);
  }

  @Override
  public @Nullable String getDecoration(DialogFragment obj) {
    return null;
  }

  @Override
  public boolean matches(String query, DialogFragment node) throws Exception {
    final NodeDescriptor descriptor = descriptorForClass(Object.class);
    return descriptor.matches(query, node);
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

package com.facebook.sonar.plugins.inspector.descriptors;

import android.os.Bundle;
import android.support.v4.app.Fragment;
import android.view.View;
import com.facebook.sonar.core.SonarDynamic;
import com.facebook.sonar.core.SonarObject;
import com.facebook.sonar.plugins.inspector.Named;
import com.facebook.sonar.plugins.inspector.NodeDescriptor;
import com.facebook.sonar.plugins.inspector.Touch;
import com.facebook.stetho.common.android.ResourcesUtil;
import java.util.Arrays;
import java.util.Collections;
import java.util.List;
import javax.annotation.Nullable;

public class SupportFragmentDescriptor extends NodeDescriptor<Fragment> {

  @Override
  public void init(Fragment node) {}

  @Override
  public String getId(Fragment node) {
    return Integer.toString(System.identityHashCode(node));
  }

  @Override
  public String getName(Fragment node) {
    return node.getClass().getSimpleName();
  }

  @Override
  public int getChildCount(Fragment node) {
    return node.getView() == null ? 0 : 1;
  }

  @Override
  public @Nullable Object getChildAt(Fragment node, int index) {
    return node.getView();
  }

  @Override
  public List<Named<SonarObject>> getData(Fragment node) {
    final Bundle args = node.getArguments();
    if (args == null || args.isEmpty()) {
      return Collections.EMPTY_LIST;
    }

    final SonarObject.Builder bundle = new SonarObject.Builder();

    for (String key : args.keySet()) {
      bundle.put(key, args.get(key));
    }

    return Arrays.asList(new Named<>("Arguments", bundle.build()));
  }

  @Override
  public void setValue(Fragment node, String[] path, SonarDynamic value) {}

  @Override
  public List<Named<String>> getAttributes(Fragment node) {
    final int id = node.getId();
    if (id == View.NO_ID || node.getHost() == null) {
      return Collections.EMPTY_LIST;
    }

    return Arrays.asList(
        new Named<>(
            "id", ResourcesUtil.getIdStringQuietly(node.getContext(), node.getResources(), id)));
  }

  @Override
  public void setHighlighted(Fragment node, boolean selected) throws Exception {
    if (node.getView() == null) {
      return;
    }

    final NodeDescriptor descriptor = descriptorForClass(View.class);
    descriptor.setHighlighted(node.getView(), selected);
  }

  @Override
  public void hitTest(Fragment node, Touch touch) {
    touch.continueWithOffset(0, 0, 0);
  }

  @Override
  public @Nullable String getDecoration(Fragment obj) {
    return null;
  }

  @Override
  public boolean matches(String query, Fragment node) throws Exception {
    final NodeDescriptor descriptor = descriptorForClass(Object.class);
    return descriptor.matches(query, node);
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

package com.facebook.sonar.plugins.inspector.descriptors;

import static com.facebook.sonar.plugins.inspector.InspectorValue.Type.Color;
import static com.facebook.sonar.plugins.inspector.InspectorValue.Type.Number;
import static com.facebook.sonar.plugins.inspector.InspectorValue.Type.Text;

import android.view.View;
import android.widget.TextView;
import com.facebook.sonar.core.SonarDynamic;
import com.facebook.sonar.core.SonarObject;
import com.facebook.sonar.plugins.inspector.InspectorValue;
import com.facebook.sonar.plugins.inspector.Named;
import com.facebook.sonar.plugins.inspector.NodeDescriptor;
import com.facebook.sonar.plugins.inspector.Touch;
import java.util.ArrayList;
import java.util.List;
import javax.annotation.Nullable;

public class TextViewDescriptor extends NodeDescriptor<TextView> {

  @Override
  public void init(TextView node) throws Exception {
    final NodeDescriptor descriptor = descriptorForClass(View.class);
    descriptor.init(node);
  }

  @Override
  public String getId(TextView node) throws Exception {
    final NodeDescriptor descriptor = descriptorForClass(View.class);
    return descriptor.getId(node);
  }

  @Override
  public String getName(TextView node) throws Exception {
    final NodeDescriptor descriptor = descriptorForClass(View.class);
    return descriptor.getName(node);
  }

  @Override
  public int getChildCount(TextView node) {
    return 0;
  }

  @Override
  public @Nullable Object getChildAt(TextView node, int index) {
    return null;
  }

  @Override
  public List<Named<SonarObject>> getData(TextView node) throws Exception {
    final List<Named<SonarObject>> props = new ArrayList<>();
    final NodeDescriptor descriptor = descriptorForClass(View.class);

    props.add(
        0,
        new Named<>(
            "TextView",
            new SonarObject.Builder()
                .put("text", InspectorValue.mutable(Text, node.getText().toString()))
                .put(
                    "textColor",
                    InspectorValue.mutable(Color, node.getTextColors().getDefaultColor()))
                .put("textSize", InspectorValue.mutable(Number, node.getTextSize()))
                .build()));

    props.addAll(descriptor.getData(node));

    return props;
  }

  @Override
  public void setValue(TextView node, String[] path, SonarDynamic value) throws Exception {
    switch (path[0]) {
      case "TextView":
        switch (path[1]) {
          case "text":
            node.setText(value.asString());
            break;
          case "textColor":
            node.setTextColor(value.asInt());
            break;
          case "textSize":
            node.setTextSize(value.asInt());
            break;
        }
        break;
      default:
        final NodeDescriptor descriptor = descriptorForClass(View.class);
        descriptor.setValue(node, path, value);
        break;
    }
    invalidate(node);
  }

  @Override
  public List<Named<String>> getAttributes(TextView node) throws Exception {
    final NodeDescriptor descriptor = descriptorForClass(View.class);
    return descriptor.getAttributes(node);
  }

  @Override
  public void setHighlighted(TextView node, boolean selected) throws Exception {
    final NodeDescriptor descriptor = descriptorForClass(View.class);
    descriptor.setHighlighted(node, selected);
  }

  @Override
  public void hitTest(TextView node, Touch touch) throws Exception {
    final NodeDescriptor descriptor = descriptorForClass(View.class);
    descriptor.hitTest(node, touch);
  }

  @Override
  public @Nullable String getDecoration(TextView node) throws Exception {
    final NodeDescriptor descriptor = descriptorForClass(View.class);
    return descriptor.getDecoration(node);
  }

  @Override
  public boolean matches(String query, TextView node) throws Exception {
    final NodeDescriptor descriptor = descriptorForClass(Object.class);
    return descriptor.matches(query, node);
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

package com.facebook.sonar.plugins.inspector.descriptors;

import static com.facebook.sonar.plugins.inspector.InspectorValue.Type.Color;
import static com.facebook.sonar.plugins.inspector.InspectorValue.Type.Enum;

import android.annotation.TargetApi;
import android.graphics.Rect;
import android.graphics.drawable.ColorDrawable;
import android.graphics.drawable.Drawable;
import android.os.Build;
import android.support.v4.view.MarginLayoutParamsCompat;
import android.support.v4.view.ViewCompat;
import android.util.SparseArray;
import android.view.Gravity;
import android.view.View;
import android.view.View.OnClickListener;
import android.view.ViewGroup;
import android.view.ViewGroup.LayoutParams;
import android.view.ViewGroup.MarginLayoutParams;
import android.view.ViewParent;
import android.widget.FrameLayout;
import android.widget.LinearLayout;
import com.facebook.sonar.core.SonarDynamic;
import com.facebook.sonar.core.SonarObject;
import com.facebook.sonar.plugins.inspector.HighlightedOverlay;
import com.facebook.sonar.plugins.inspector.InspectorValue;
import com.facebook.sonar.plugins.inspector.Named;
import com.facebook.sonar.plugins.inspector.NodeDescriptor;
import com.facebook.sonar.plugins.inspector.Touch;
import com.facebook.sonar.plugins.inspector.descriptors.utils.AccessibilityUtil;
import com.facebook.sonar.plugins.inspector.descriptors.utils.EnumMapping;
import com.facebook.stetho.common.android.ResourcesUtil;
import java.lang.reflect.Field;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import javax.annotation.Nullable;

public class ViewDescriptor extends NodeDescriptor<View> {

  private static Field sKeyedTagsField;
  private static Field sListenerInfoField;
  private static Field sOnClickListenerField;

  static {
    try {
      sKeyedTagsField = View.class.getDeclaredField("mKeyedTags");
      sKeyedTagsField.setAccessible(true);

      sListenerInfoField = View.class.getDeclaredField("mListenerInfo");
      sListenerInfoField.setAccessible(true);

      final String viewInfoClassName = View.class.getName() + "$ListenerInfo";
      sOnClickListenerField = Class.forName(viewInfoClassName).getDeclaredField("mOnClickListener");
      sOnClickListenerField.setAccessible(true);
    } catch (Exception ignored) {
    }
  }

  @Override
  public void init(final View node) {}

  @Override
  public String getId(View node) {
    return Integer.toString(System.identityHashCode(node));
  }

  @Override
  public String getName(View node) {
    return node.getClass().getSimpleName();
  }

  @Override
  public int getChildCount(View node) {
    return 0;
  }

  @Override
  public @Nullable Object getChildAt(View node, int index) {
    return null;
  }

  @Override
  public List<Named<SonarObject>> getData(View node) {
    final SonarObject.Builder viewProps =
        new SonarObject.Builder()
            .put("height", InspectorValue.mutable(node.getHeight()))
            .put("width", InspectorValue.mutable(node.getWidth()))
            .put("alpha", InspectorValue.mutable(node.getAlpha()))
            .put("visibility", sVisibilityMapping.get(node.getVisibility()))
            .put("background", fromDrawable(node.getBackground()))
            .put("tag", InspectorValue.mutable(node.getTag()))
            .put("keyedTags", getTags(node))
            .put("layoutParams", getLayoutParams(node))
            .put(
                "state",
                new SonarObject.Builder()
                    .put("enabled", InspectorValue.mutable(node.isEnabled()))
                    .put("activated", InspectorValue.mutable(node.isActivated()))
                    .put("focused", node.isFocused())
                    .put("selected", InspectorValue.mutable(node.isSelected())))
            .put(
                "bounds",
                new SonarObject.Builder()
                    .put("left", InspectorValue.mutable(node.getLeft()))
                    .put("right", InspectorValue.mutable(node.getRight()))
                    .put("top", InspectorValue.mutable(node.getTop()))
                    .put("bottom", InspectorValue.mutable(node.getBottom())))
            .put(
                "padding",
                new SonarObject.Builder()
                    .put("left", InspectorValue.mutable(node.getPaddingLeft()))
                    .put("top", InspectorValue.mutable(node.getPaddingTop()))
                    .put("right", InspectorValue.mutable(node.getPaddingRight()))
                    .put("bottom", InspectorValue.mutable(node.getPaddingBottom())))
            .put(
                "rotation",
                new SonarObject.Builder()
                    .put("x", InspectorValue.mutable(node.getRotationX()))
                    .put("y", InspectorValue.mutable(node.getRotationY()))
                    .put("z", InspectorValue.mutable(node.getRotation())))
            .put(
                "scale",
                new SonarObject.Builder()
                    .put("x", InspectorValue.mutable(node.getScaleX()))
                    .put("y", InspectorValue.mutable(node.getScaleY())))
            .put(
                "pivot",
                new SonarObject.Builder()
                    .put("x", InspectorValue.mutable(node.getPivotX()))
                    .put("y", InspectorValue.mutable(node.getPivotY())));

    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN_MR1) {
      viewProps
          .put("layoutDirection", sLayoutDirectionMapping.get(node.getLayoutDirection()))
          .put("textDirection", sTextDirectionMapping.get(node.getTextDirection()))
          .put("textAlignment", sTextAlignmentMapping.get(node.getTextAlignment()));
    }

    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {
      viewProps.put("elevation", InspectorValue.mutable(node.getElevation()));
    }

    SonarObject.Builder translation =
        new SonarObject.Builder()
            .put("x", InspectorValue.mutable(node.getTranslationX()))
            .put("y", InspectorValue.mutable(node.getTranslationY()));
    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {
      translation.put("z", InspectorValue.mutable(node.getTranslationZ()));
    }
    viewProps.put("translation", translation);

    SonarObject.Builder position =
        new SonarObject.Builder()
            .put("x", InspectorValue.mutable(node.getX()))
            .put("y", InspectorValue.mutable(node.getY()));
    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP_MR1) {
      position.put("z", InspectorValue.mutable(node.getZ()));
    }
    viewProps.put("position", position);

    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.M) {
      viewProps.put("foreground", fromDrawable(node.getForeground()));
    }

    return Arrays.asList(
        new Named<>("View", viewProps.build()),
        new Named<>("Accessibility", getAccessibilityData(node)));
  }

  private static SonarObject getAccessibilityData(View view) {
    final SonarObject.Builder accessibilityProps = new SonarObject.Builder();

    // This needs to be an empty string to be mutable. See t20470623.
    CharSequence contentDescription =
        view.getContentDescription() != null ? view.getContentDescription() : "";
    accessibilityProps.put("content-description", InspectorValue.mutable(contentDescription));
    accessibilityProps.put("focusable", InspectorValue.mutable(view.isFocusable()));
    accessibilityProps.put("node-info", AccessibilityUtil.getAccessibilityNodeInfoProperties(view));

    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN) {
      accessibilityProps.put(
          "important-for-accessibility",
          AccessibilityUtil.sImportantForAccessibilityMapping.get(
              view.getImportantForAccessibility()));
    }

    AccessibilityUtil.addTalkbackProperties(accessibilityProps, view);

    return accessibilityProps.build();
  }

  @TargetApi(Build.VERSION_CODES.JELLY_BEAN_MR1)
  @Override
  public void setValue(View node, String[] path, SonarDynamic value) {
    if (path[0].equals("Accessibility")) {
      setAccessibilityValue(node, path, value);
    }

    if (!path[0].equals("View")) {
      return;
    }

    switch (path[1]) {
      case "elevation":
        node.setElevation(value.asFloat());
        break;
      case "alpha":
        node.setAlpha(value.asFloat());
        break;
      case "visibility":
        node.setVisibility(sVisibilityMapping.get(value.asString()));
        break;
      case "layoutParams":
        setLayoutParams(node, Arrays.copyOfRange(path, 1, path.length), value);
        break;
      case "layoutDirection":
        node.setLayoutDirection(sLayoutDirectionMapping.get(value.asString()));
        break;
      case "textDirection":
        node.setTextDirection(sTextDirectionMapping.get(value.asString()));
        break;
      case "textAlignment":
        node.setTextAlignment(sTextAlignmentMapping.get(value.asString()));
        break;
      case "background":
        node.setBackground(new ColorDrawable(value.asInt()));
        break;
      case "foreground":
        node.setForeground(new ColorDrawable(value.asInt()));
        break;
      case "state":
        switch (path[2]) {
          case "enabled":
            node.setEnabled(value.asBoolean());
            break;
          case "activated":
            node.setActivated(value.asBoolean());
            break;
          case "selected":
            node.setSelected(value.asBoolean());
            break;
        }
        break;
      case "bounds":
        switch (path[2]) {
          case "left":
            node.setLeft(value.asInt());
            break;
          case "top":
            node.setTop(value.asInt());
            break;
          case "right":
            node.setRight(value.asInt());
            break;
          case "bottom":
            node.setBottom(value.asInt());
            break;
        }
        break;
      case "padding":
        switch (path[2]) {
          case "left":
            node.setPadding(
                value.asInt(),
                node.getPaddingTop(),
                node.getPaddingRight(),
                node.getPaddingBottom());
            break;
          case "top":
            node.setPadding(
                node.getPaddingLeft(),
                value.asInt(),
                node.getPaddingRight(),
                node.getPaddingBottom());
            break;
          case "right":
            node.setPadding(
                node.getPaddingLeft(),
                node.getPaddingTop(),
                value.asInt(),
                node.getPaddingBottom());
            break;
          case "bottom":
            node.setPadding(
                node.getPaddingLeft(), node.getPaddingTop(), node.getPaddingRight(), value.asInt());
            break;
        }
        break;
      case "rotation":
        switch (path[2]) {
          case "x":
            node.setRotationX(value.asFloat());
            break;
          case "y":
            node.setRotationY(value.asFloat());
            break;
          case "z":
            node.setRotation(value.asFloat());
            break;
        }
        break;
      case "translation":
        switch (path[2]) {
          case "x":
            node.setTranslationX(value.asFloat());
            break;
          case "y":
            node.setTranslationY(value.asFloat());
            break;
          case "z":
            node.setTranslationZ(value.asFloat());
            break;
        }
        break;
      case "position":
        switch (path[2]) {
          case "x":
            node.setX(value.asFloat());
            break;
          case "y":
            node.setY(value.asFloat());
            break;
          case "z":
            node.setZ(value.asFloat());
            break;
        }
        break;
      case "scale":
        switch (path[2]) {
          case "x":
            node.setScaleX(value.asFloat());
            break;
          case "y":
            node.setScaleY(value.asFloat());
            break;
        }
        break;
      case "pivot":
        switch (path[2]) {
          case "x":
            node.setPivotY(value.asFloat());
            break;
          case "y":
            node.setPivotX(value.asFloat());
            break;
        }
        break;
      case "width":
        LayoutParams lpw = node.getLayoutParams();
        lpw.width = value.asInt();
        node.setLayoutParams(lpw);
        break;
      case "height":
        LayoutParams lph = node.getLayoutParams();
        lph.height = value.asInt();
        node.setLayoutParams(lph);
        break;
    }

    invalidate(node);
  }

  private void setAccessibilityValue(View node, String[] path, SonarDynamic value) {
    switch (path[1]) {
      case "focusable":
        node.setFocusable(value.asBoolean());
        break;
      case "important-for-accessibility":
        node.setImportantForAccessibility(
            AccessibilityUtil.sImportantForAccessibilityMapping.get(value.asString()));
        break;
      case "content-description":
        node.setContentDescription(value.asString());
        break;
    }
    invalidate(node);
  }

  @Override
  public List<Named<String>> getAttributes(View node) throws Exception {
    final List<Named<String>> attributes = new ArrayList<>();

    final String resourceId = getResourceId(node);
    if (resourceId != null) {
      attributes.add(new Named<>("id", resourceId));
    }

    if (sListenerInfoField != null && sOnClickListenerField != null) {
      final Object listenerInfo = sListenerInfoField.get(node);
      if (listenerInfo != null) {
        final OnClickListener clickListener =
            (OnClickListener) sOnClickListenerField.get(listenerInfo);
        if (clickListener != null) {
          attributes.add(new Named<>("onClick", clickListener.getClass().getName()));
        }
      }
    }

    return attributes;
  }

  @Nullable
  private static String getResourceId(View node) {
    final int id = node.getId();

    if (id == View.NO_ID) {
      return null;
    }

    return ResourcesUtil.getIdStringQuietly(node.getContext(), node.getResources(), id);
  }

  @Override
  public void setHighlighted(View node, boolean selected) {
    // We need to figure out whether the given View has a parent View since margins are not
    // included within a View's bounds. So, in order to display the margin values for a particular
    // view, we need to apply an overlay on its parent rather than itself.
    final View targetView;
    final ViewParent parent = node.getParent();
    if (parent instanceof View) {
      targetView = (View) parent;
    } else {
      targetView = node;
    }

    if (!selected) {
      HighlightedOverlay.removeHighlight(targetView);
      return;
    }

    final Rect padding =
        new Rect(
            ViewCompat.getPaddingStart(node),
            node.getPaddingTop(),
            ViewCompat.getPaddingEnd(node),
            node.getPaddingBottom());

    final Rect margin;
    final ViewGroup.LayoutParams params = node.getLayoutParams();
    if (params instanceof ViewGroup.MarginLayoutParams) {
      final ViewGroup.MarginLayoutParams marginParams = (ViewGroup.MarginLayoutParams) params;
      margin =
          new Rect(
              MarginLayoutParamsCompat.getMarginStart(marginParams),
              marginParams.topMargin,
              MarginLayoutParamsCompat.getMarginEnd(marginParams),
              marginParams.bottomMargin);
    } else {
      margin = new Rect();
    }

    final int left = node.getLeft();
    final int top = node.getTop();
    final Rect contentBounds = new Rect(left, top, left + node.getWidth(), top + node.getHeight());
    if (targetView == node) {
      // If the View doesn't have a parent View that we're applying the overlay to, then
      // we need to ensure that it is aligned to 0, 0, rather than its relative location to its
      // parent
      contentBounds.offset(-left, -top);
    }

    HighlightedOverlay.setHighlighted(targetView, margin, padding, contentBounds);
  }

  @Override
  public void hitTest(View node, Touch touch) {
    touch.finish();
  }

  @Override
  public @Nullable String getDecoration(View obj) {
    return null;
  }

  @Override
  public boolean matches(String query, View node) throws Exception {
    final String resourceId = getResourceId(node);

    if (resourceId != null && resourceId.toLowerCase().contains(query)) {
      return true;
    }

    final NodeDescriptor objectDescriptor = descriptorForClass(Object.class);
    return objectDescriptor.matches(query, node);
  }

  private SonarObject getTags(final View node) {
    final SonarObject.Builder tags = new SonarObject.Builder();
    if (sKeyedTagsField == null) {
      return tags.build();
    }

    new ErrorReportingRunnable() {
      @Override
      protected void runOrThrow() throws Exception {
        final SparseArray keyedTags = (SparseArray) sKeyedTagsField.get(node);
        if (keyedTags != null) {
          for (int i = 0, count = keyedTags.size(); i < count; i++) {
            final String id =
                ResourcesUtil.getIdStringQuietly(
                    node.getContext(), node.getResources(), keyedTags.keyAt(i));
            tags.put(id, keyedTags.valueAt(i));
          }
        }
      }
    }.run();

    return tags.build();
  }

  private static InspectorValue fromDrawable(Drawable d) {
    if (d instanceof ColorDrawable) {
      return InspectorValue.mutable(Color, ((ColorDrawable) d).getColor());
    }
    return InspectorValue.mutable(Color, 0);
  }

  private static SonarObject getLayoutParams(View node) {
    final LayoutParams layoutParams = node.getLayoutParams();
    final SonarObject.Builder params = new SonarObject.Builder();

    params.put("width", fromSize(layoutParams.width));
    params.put("height", fromSize(layoutParams.height));

    if (layoutParams instanceof MarginLayoutParams) {
      final MarginLayoutParams marginLayoutParams = (MarginLayoutParams) layoutParams;
      params.put(
          "margin",
          new SonarObject.Builder()
              .put("left", InspectorValue.mutable(marginLayoutParams.leftMargin))
              .put("top", InspectorValue.mutable(marginLayoutParams.topMargin))
              .put("right", InspectorValue.mutable(marginLayoutParams.rightMargin))
              .put("bottom", InspectorValue.mutable(marginLayoutParams.bottomMargin)));
    }

    if (layoutParams instanceof FrameLayout.LayoutParams) {
      final FrameLayout.LayoutParams frameLayoutParams = (FrameLayout.LayoutParams) layoutParams;
      params.put("gravity", sGravityMapping.get(frameLayoutParams.gravity));
    }

    if (layoutParams instanceof LinearLayout.LayoutParams) {
      final LinearLayout.LayoutParams linearLayoutParams = (LinearLayout.LayoutParams) layoutParams;
      params
          .put("weight", InspectorValue.mutable(linearLayoutParams.weight))
          .put("gravity", sGravityMapping.get(linearLayoutParams.gravity));
    }

    return params.build();
  }

  private void setLayoutParams(View node, String[] path, SonarDynamic value) {
    final LayoutParams params = node.getLayoutParams();

    switch (path[0]) {
      case "width":
        params.width = toSize(value.asString());
        break;
      case "height":
        params.height = toSize(value.asString());
        break;
      case "weight":
        final LinearLayout.LayoutParams linearParams = (LinearLayout.LayoutParams) params;
        linearParams.weight = value.asFloat();
        break;
    }

    if (params instanceof MarginLayoutParams) {
      final MarginLayoutParams marginParams = (MarginLayoutParams) params;

      switch (path[0]) {
        case "margin":
          switch (path[1]) {
            case "left":
              marginParams.leftMargin = value.asInt();
              break;
            case "top":
              marginParams.topMargin = value.asInt();
              break;
            case "right":
              marginParams.rightMargin = value.asInt();
              break;
            case "bottom":
              marginParams.bottomMargin = value.asInt();
              break;
          }
          break;
      }
    }

    if (params instanceof FrameLayout.LayoutParams) {
      final FrameLayout.LayoutParams frameLayoutParams = (FrameLayout.LayoutParams) params;

      switch (path[0]) {
        case "gravity":
          frameLayoutParams.gravity = sGravityMapping.get(value.asString());
          break;
      }
    }

    if (params instanceof LinearLayout.LayoutParams) {
      final LinearLayout.LayoutParams linearParams = (LinearLayout.LayoutParams) params;

      switch (path[0]) {
        case "weight":
          linearParams.weight = value.asFloat();
          break;
        case "gravity":
          linearParams.gravity = sGravityMapping.get(value.asString());
          break;
      }
    }

    node.setLayoutParams(params);
  }

  private static InspectorValue fromSize(int size) {
    switch (size) {
      case LayoutParams.WRAP_CONTENT:
        return InspectorValue.mutable(Enum, "WRAP_CONTENT");
      case LayoutParams.MATCH_PARENT:
        return InspectorValue.mutable(Enum, "MATCH_PARENT");
      default:
        return InspectorValue.mutable(Enum, Integer.toString(size));
    }
  }

  private static int toSize(String size) {
    switch (size) {
      case "WRAP_CONTENT":
        return LayoutParams.WRAP_CONTENT;
      case "MATCH_PARENT":
        return LayoutParams.MATCH_PARENT;
      default:
        return Integer.parseInt(size);
    }
  }

  private static final EnumMapping sVisibilityMapping =
      new EnumMapping("VISIBLE") {
        {
          put("VISIBLE", View.VISIBLE);
          put("INVISIBLE", View.INVISIBLE);
          put("GONE", View.GONE);
        }
      };

  private static final EnumMapping sLayoutDirectionMapping =
      new EnumMapping("LAYOUT_DIRECTION_INHERIT") {
        {
          put("LAYOUT_DIRECTION_INHERIT", View.LAYOUT_DIRECTION_INHERIT);
          put("LAYOUT_DIRECTION_LOCALE", View.LAYOUT_DIRECTION_LOCALE);
          put("LAYOUT_DIRECTION_LTR", View.LAYOUT_DIRECTION_LTR);
          put("LAYOUT_DIRECTION_RTL", View.LAYOUT_DIRECTION_RTL);
        }
      };

  private static final EnumMapping sTextDirectionMapping =
      new EnumMapping("TEXT_DIRECTION_INHERIT") {
        {
          put("TEXT_DIRECTION_INHERIT", View.TEXT_DIRECTION_INHERIT);
          put("TEXT_DIRECTION_FIRST_STRONG", View.TEXT_DIRECTION_FIRST_STRONG);
          put("TEXT_DIRECTION_ANY_RTL", View.TEXT_DIRECTION_ANY_RTL);
          put("TEXT_DIRECTION_LTR", View.TEXT_DIRECTION_LTR);
          put("TEXT_DIRECTION_RTL", View.TEXT_DIRECTION_RTL);
          put("TEXT_DIRECTION_LOCALE", View.TEXT_DIRECTION_LOCALE);
          put("TEXT_DIRECTION_FIRST_STRONG_LTR", View.TEXT_DIRECTION_FIRST_STRONG_LTR);
          put("TEXT_DIRECTION_FIRST_STRONG_RTL", View.TEXT_DIRECTION_FIRST_STRONG_RTL);
        }
      };

  private static final EnumMapping sTextAlignmentMapping =
      new EnumMapping("TEXT_ALIGNMENT_INHERIT") {
        {
          put("TEXT_ALIGNMENT_INHERIT", View.TEXT_ALIGNMENT_INHERIT);
          put("TEXT_ALIGNMENT_GRAVITY", View.TEXT_ALIGNMENT_GRAVITY);
          put("TEXT_ALIGNMENT_TEXT_START", View.TEXT_ALIGNMENT_TEXT_START);
          put("TEXT_ALIGNMENT_TEXT_END", View.TEXT_ALIGNMENT_TEXT_END);
          put("TEXT_ALIGNMENT_CENTER", View.TEXT_ALIGNMENT_CENTER);
          put("TEXT_ALIGNMENT_VIEW_START", View.TEXT_ALIGNMENT_VIEW_START);
          put("TEXT_ALIGNMENT_VIEW_END", View.TEXT_ALIGNMENT_VIEW_END);
        }
      };

  private static final EnumMapping sGravityMapping =
      new EnumMapping("NO_GRAVITY") {
        {
          put("NO_GRAVITY", Gravity.NO_GRAVITY);
          put("LEFT", Gravity.LEFT);
          put("TOP", Gravity.TOP);
          put("RIGHT", Gravity.RIGHT);
          put("BOTTOM", Gravity.BOTTOM);
          put("CENTER", Gravity.CENTER);
          put("CENTER_VERTICAL", Gravity.CENTER_VERTICAL);
          put("FILL_VERTICAL", Gravity.FILL_VERTICAL);
          put("CENTER_HORIZONTAL", Gravity.CENTER_HORIZONTAL);
          put("FILL_HORIZONTAL", Gravity.FILL_HORIZONTAL);
        }
      };
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

package com.facebook.sonar.plugins.inspector.descriptors;

import static android.support.v4.view.ViewGroupCompat.LAYOUT_MODE_CLIP_BOUNDS;
import static android.support.v4.view.ViewGroupCompat.LAYOUT_MODE_OPTICAL_BOUNDS;
import static com.facebook.sonar.plugins.inspector.InspectorValue.Type.Boolean;
import static com.facebook.sonar.plugins.inspector.InspectorValue.Type.Enum;

import android.os.Build;
import android.view.View;
import android.view.ViewGroup;
import com.facebook.sonar.R;
import com.facebook.sonar.core.SonarDynamic;
import com.facebook.sonar.core.SonarObject;
import com.facebook.sonar.plugins.inspector.HiddenNode;
import com.facebook.sonar.plugins.inspector.InspectorValue;
import com.facebook.sonar.plugins.inspector.Named;
import com.facebook.sonar.plugins.inspector.NodeDescriptor;
import com.facebook.sonar.plugins.inspector.Touch;
import com.facebook.stetho.common.android.FragmentCompatUtil;
import java.util.ArrayList;
import java.util.List;
import javax.annotation.Nullable;

public class ViewGroupDescriptor extends NodeDescriptor<ViewGroup> {

  private class NodeKey {
    private int[] mKey;

    boolean set(ViewGroup node) {
      final int childCount = node.getChildCount();
      final int[] key = new int[childCount];

      for (int i = 0; i < childCount; i++) {
        final View child = node.getChildAt(i);
        key[i] = System.identityHashCode(child);
      }

      boolean changed = false;
      if (mKey == null) {
        changed = true;
      } else if (mKey.length != key.length) {
        changed = true;
      } else {
        for (int i = 0; i < childCount; i++) {
          if (mKey[i] != key[i]) {
            changed = true;
            break;
          }
        }
      }

      mKey = key;
      return changed;
    }
  }

  @Override
  public void init(final ViewGroup node) {
    final NodeKey key = new NodeKey();

    final Runnable maybeInvalidate =
        new ErrorReportingRunnable() {
          @Override
          public void runOrThrow() throws Exception {
            if (connected()) {
              if (key.set(node)) {
                invalidate(node);
              }

              final boolean hasAttachedToWindow =
                  Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT;
              if (!hasAttachedToWindow || node.isAttachedToWindow()) {
                node.postDelayed(this, 1000);
              }
            }
          }
        };

    node.postDelayed(maybeInvalidate, 1000);
  }

  @Override
  public String getId(ViewGroup node) throws Exception {
    NodeDescriptor descriptor = descriptorForClass(View.class);
    return descriptor.getId(node);
  }

  @Override
  public String getName(ViewGroup node) throws Exception {
    NodeDescriptor descriptor = descriptorForClass(View.class);
    return descriptor.getName(node);
  }

  @Override
  public int getChildCount(ViewGroup node) {
    int childCount = 0;
    for (int i = 0, count = node.getChildCount(); i < count; i++) {
      if (!(node.getChildAt(i) instanceof HiddenNode)) {
        childCount++;
      }
    }
    return childCount;
  }

  @Override
  public @Nullable Object getChildAt(ViewGroup node, int index) {
    for (int i = 0, count = node.getChildCount(); i < count; i++) {
      final View child = node.getChildAt(i);
      if (child instanceof HiddenNode) {
        continue;
      }

      if (i >= index) {
        final Object fragment = getAttachedFragmentForView(child);
        if (fragment != null && !FragmentCompatUtil.isDialogFragment(fragment)) {
          return fragment;
        }

        return child;
      }
    }
    return null;
  }

  @Override
  public List<Named<SonarObject>> getData(ViewGroup node) throws Exception {
    final List<Named<SonarObject>> props = new ArrayList<>();
    final NodeDescriptor descriptor = descriptorForClass(View.class);

    final SonarObject.Builder vgProps = new SonarObject.Builder();

    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN_MR2) {
      vgProps
          .put(
              "layoutMode",
              InspectorValue.mutable(
                  Enum,
                  node.getLayoutMode() == LAYOUT_MODE_CLIP_BOUNDS
                      ? "LAYOUT_MODE_CLIP_BOUNDS"
                      : "LAYOUT_MODE_OPTICAL_BOUNDS"))
          .put("clipChildren", InspectorValue.mutable(Boolean, node.getClipChildren()));
    }

    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {
      vgProps.put("clipToPadding", InspectorValue.mutable(Boolean, node.getClipToPadding()));
    }

    props.add(0, new Named<>("ViewGroup", vgProps.build()));

    props.addAll(descriptor.getData(node));

    return props;
  }

  @Override
  public void setValue(ViewGroup node, String[] path, SonarDynamic value) throws Exception {
    switch (path[0]) {
      case "ViewGroup":
        switch (path[1]) {
          case "layoutMode":
            switch (value.asString()) {
              case "LAYOUT_MODE_CLIP_BOUNDS":
                node.setLayoutMode(LAYOUT_MODE_CLIP_BOUNDS);
                break;
              case "LAYOUT_MODE_OPTICAL_BOUNDS":
                node.setLayoutMode(LAYOUT_MODE_OPTICAL_BOUNDS);
                break;
              default:
                node.setLayoutMode(-1);
                break;
            }
            break;
          case "clipChildren":
            node.setClipChildren(value.asBoolean());
            break;
          case "clipToPadding":
            node.setClipToPadding(value.asBoolean());
            break;
        }
        break;
      default:
        final NodeDescriptor descriptor = descriptorForClass(View.class);
        descriptor.setValue(node, path, value);
        break;
    }
    invalidate(node);
  }

  @Override
  public List<Named<String>> getAttributes(ViewGroup node) throws Exception {
    final NodeDescriptor descriptor = descriptorForClass(View.class);
    return descriptor.getAttributes(node);
  }

  @Override
  public void setHighlighted(ViewGroup node, boolean selected) throws Exception {
    final NodeDescriptor descriptor = descriptorForClass(View.class);
    descriptor.setHighlighted(node, selected);
  }

  @Override
  public void hitTest(ViewGroup node, Touch touch) {
    for (int i = node.getChildCount() - 1; i >= 0; i--) {
      final View child = node.getChildAt(i);
      if (child instanceof HiddenNode
          || child.getVisibility() != View.VISIBLE
          || shouldSkip(child)) {
        continue;
      }

      final int scrollX = node.getScrollX();
      final int scrollY = node.getScrollY();

      final int left = (child.getLeft() + (int) child.getTranslationX()) - scrollX;
      final int top = (child.getTop() + (int) child.getTranslationY()) - scrollY;
      final int right = (child.getRight() + (int) child.getTranslationX()) - scrollX;
      final int bottom = (child.getBottom() + (int) child.getTranslationY()) - scrollY;

      final boolean hit = touch.containedIn(left, top, right, bottom);

      if (hit) {
        touch.continueWithOffset(i, left, top);
        return;
      }
    }

    touch.finish();
  }

  private static boolean shouldSkip(View view) {
    Object tag = view.getTag(R.id.sonar_skip_view_traversal);
    if (!(tag instanceof Boolean)) {
      return false;
    }

    return (Boolean) tag;
  }

  @Override
  public @Nullable String getDecoration(ViewGroup obj) {
    return null;
  }

  @Override
  public boolean matches(String query, ViewGroup node) throws Exception {
    final NodeDescriptor descriptor = descriptorForClass(Object.class);
    return descriptor.matches(query, node);
  }

  private static Object getAttachedFragmentForView(View v) {
    try {
      final Object fragment = FragmentCompatUtil.findFragmentForView(v);
      boolean added = false;
      if (fragment instanceof android.app.Fragment) {
        added = ((android.app.Fragment) fragment).isAdded();
      } else if (fragment instanceof android.support.v4.app.Fragment) {
        added = ((android.support.v4.app.Fragment) fragment).isAdded();
      }

      return added ? fragment : null;
    } catch (RuntimeException e) {
      return null;
    }
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

package com.facebook.sonar.plugins.inspector.descriptors;

import android.view.View;
import android.view.Window;
import com.facebook.sonar.core.SonarDynamic;
import com.facebook.sonar.core.SonarObject;
import com.facebook.sonar.plugins.inspector.Named;
import com.facebook.sonar.plugins.inspector.NodeDescriptor;
import com.facebook.sonar.plugins.inspector.Touch;
import java.util.Collections;
import java.util.List;
import javax.annotation.Nullable;

public class WindowDescriptor extends NodeDescriptor<Window> {

  @Override
  public void init(Window node) {}

  @Override
  public String getId(Window node) {
    return Integer.toString(System.identityHashCode(node));
  }

  @Override
  public String getName(Window node) {
    return node.getClass().getSimpleName();
  }

  @Override
  public int getChildCount(Window node) {
    return 1;
  }

  @Override
  public Object getChildAt(Window node, int index) {
    return node.getDecorView();
  }

  @Override
  public List<Named<SonarObject>> getData(Window node) {
    return Collections.EMPTY_LIST;
  }

  @Override
  public void setValue(Window node, String[] path, SonarDynamic value) {}

  @Override
  public List<Named<String>> getAttributes(Window node) {
    return Collections.EMPTY_LIST;
  }

  @Override
  public void setHighlighted(Window node, boolean selected) throws Exception {
    final NodeDescriptor descriptor = descriptorForClass(View.class);
    descriptor.setHighlighted(node.getDecorView(), selected);
  }

  @Override
  public void hitTest(Window node, Touch touch) {
    touch.continueWithOffset(0, 0, 0);
  }

  @Override
  public @Nullable String getDecoration(Window obj) {
    return null;
  }

  @Override
  public boolean matches(String query, Window node) throws Exception {
    final NodeDescriptor descriptor = descriptorForClass(Object.class);
    return descriptor.matches(query, node);
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.sonar.plugins.inspector.descriptors.utils;

import android.graphics.Rect;
import android.support.v4.view.ViewCompat;
import android.support.v4.view.accessibility.AccessibilityNodeInfoCompat;
import android.text.TextUtils;
import android.view.View;
import android.view.ViewGroup;
import android.view.ViewParent;
import com.facebook.sonar.plugins.inspector.descriptors.utils.AccessibilityRoleUtil.AccessibilityRole;
import java.util.List;
import javax.annotation.Nullable;

/**
 * This class provides utility methods for determining certain accessibility properties of {@link
 * View}s and {@link AccessibilityNodeInfoCompat}s. It is porting some of the checks from {@link
 * com.googlecode.eyesfree.utils.AccessibilityNodeInfoUtils}, but has stripped many features which
 * are unnecessary here.
 */
public class AccessibilityEvaluationUtil {

  private AccessibilityEvaluationUtil() {}

  /**
   * Returns whether the specified node has text or a content description.
   *
   * @param node The node to check.
   * @return {@code true} if the node has text.
   */
  public static boolean hasText(@Nullable AccessibilityNodeInfoCompat node) {
    return node != null
        && node.getCollectionInfo() == null
        && (!TextUtils.isEmpty(node.getText()) || !TextUtils.isEmpty(node.getContentDescription()));
  }

  /**
   * Returns whether the supplied {@link View} and {@link AccessibilityNodeInfoCompat} would produce
   * spoken feedback if it were accessibility focused. NOTE: not all speaking nodes are focusable.
   *
   * @param view The {@link View} to evaluate
   * @param node The {@link AccessibilityNodeInfoCompat} to evaluate
   * @return {@code true} if it meets the criterion for producing spoken feedback
   */
  public static boolean isSpeakingNode(
      @Nullable AccessibilityNodeInfoCompat node, @Nullable View view) {
    if (node == null || view == null) {
      return false;
    }

    final int important = ViewCompat.getImportantForAccessibility(view);
    if (important == ViewCompat.IMPORTANT_FOR_ACCESSIBILITY_NO_HIDE_DESCENDANTS
        || (important == ViewCompat.IMPORTANT_FOR_ACCESSIBILITY_NO && node.getChildCount() <= 0)) {
      return false;
    }

    return node.isCheckable() || hasText(node) || hasNonActionableSpeakingDescendants(node, view);
  }

  /**
   * Determines if the supplied {@link View} and {@link AccessibilityNodeInfoCompat} has any
   * children which are not independently accessibility focusable and also have a spoken
   * description.
   *
   * <p>NOTE: Accessibility services will include these children's descriptions in the closest
   * focusable ancestor.
   *
   * @param view The {@link View} to evaluate
   * @param node The {@link AccessibilityNodeInfoCompat} to evaluate
   * @return {@code true} if it has any non-actionable speaking descendants within its subtree
   */
  public static boolean hasNonActionableSpeakingDescendants(
      @Nullable AccessibilityNodeInfoCompat node, @Nullable View view) {

    if (node == null || view == null || !(view instanceof ViewGroup)) {
      return false;
    }

    final ViewGroup viewGroup = (ViewGroup) view;
    for (int i = 0, count = viewGroup.getChildCount(); i < count; i++) {
      final View childView = viewGroup.getChildAt(i);

      if (childView == null) {
        continue;
      }

      final AccessibilityNodeInfoCompat childNode = AccessibilityNodeInfoCompat.obtain();
      try {
        ViewCompat.onInitializeAccessibilityNodeInfo(childView, childNode);

        if (!node.isVisibleToUser()) {
          continue;
        }

        if (isAccessibilityFocusable(childNode, childView)) {
          continue;
        }

        if (isSpeakingNode(childNode, childView)) {
          return true;
        }
      } finally {
        if (childNode != null) {
          childNode.recycle();
        }
      }
    }

    return false;
  }

  /**
   * Determines if the provided {@link View} and {@link AccessibilityNodeInfoCompat} meet the
   * criteria for gaining accessibility focus.
   *
   * <p>Note: this is evaluating general focusability by accessibility services, and does not mean
   * this view will be guaranteed to be focused by specific services such as Talkback. For Talkback
   * focusability, see {@link #isTalkbackFocusable(View)}
   *
   * @param view The {@link View} to evaluate
   * @param node The {@link AccessibilityNodeInfoCompat} to evaluate
   * @return {@code true} if it is possible to gain accessibility focus
   */
  public static boolean isAccessibilityFocusable(
      @Nullable AccessibilityNodeInfoCompat node, @Nullable View view) {
    if (node == null || view == null) {
      return false;
    }

    // Never focus invisible nodes.
    if (!node.isVisibleToUser()) {
      return false;
    }

    // Always focus "actionable" nodes.
    if (isActionableForAccessibility(node)) {
      return true;
    }

    // only focus top-level list items with non-actionable speaking children.
    return isTopLevelScrollItem(node, view) && isSpeakingNode(node, view);
  }

  /**
   * Determines whether the provided {@link View} and {@link AccessibilityNodeInfoCompat} is a
   * top-level item in a scrollable container.
   *
   * @param view The {@link View} to evaluate
   * @param node The {@link AccessibilityNodeInfoCompat} to evaluate
   * @return {@code true} if it is a top-level item in a scrollable container.
   */
  public static boolean isTopLevelScrollItem(
      @Nullable AccessibilityNodeInfoCompat node, @Nullable View view) {
    if (node == null || view == null) {
      return false;
    }

    final View parent = (View) ViewCompat.getParentForAccessibility(view);
    if (parent == null) {
      return false;
    }

    if (node.isScrollable()) {
      return true;
    }

    final List actionList = node.getActionList();
    if (actionList.contains(AccessibilityNodeInfoCompat.ACTION_SCROLL_FORWARD)
        || actionList.contains(AccessibilityNodeInfoCompat.ACTION_SCROLL_BACKWARD)) {
      return true;
    }

    // Top-level items in a scrolling pager are actually two levels down since the first
    // level items in pagers are the pages themselves.
    View grandparent = (View) ViewCompat.getParentForAccessibility(parent);
    if (grandparent != null
        && AccessibilityRoleUtil.getRole(grandparent) == AccessibilityRole.PAGER) {
      return true;
    }

    AccessibilityRole parentRole = AccessibilityRoleUtil.getRole(parent);
    return parentRole == AccessibilityRole.LIST
        || parentRole == AccessibilityRole.GRID
        || parentRole == AccessibilityRole.SCROLL_VIEW
        || parentRole == AccessibilityRole.HORIZONTAL_SCROLL_VIEW;
  }

  /**
   * Returns whether a node is actionable. That is, the node supports one of {@link
   * AccessibilityNodeInfoCompat#isClickable()}, {@link AccessibilityNodeInfoCompat#isFocusable()},
   * or {@link AccessibilityNodeInfoCompat#isLongClickable()}.
   *
   * @param node The {@link AccessibilityNodeInfoCompat} to evaluate
   * @return {@code true} if node is actionable.
   */
  public static boolean isActionableForAccessibility(@Nullable AccessibilityNodeInfoCompat node) {
    if (node == null) {
      return false;
    }

    if (node.isClickable() || node.isLongClickable() || node.isFocusable()) {
      return true;
    }

    final List actionList = node.getActionList();
    return actionList.contains(AccessibilityNodeInfoCompat.ACTION_CLICK)
        || actionList.contains(AccessibilityNodeInfoCompat.ACTION_LONG_CLICK)
        || actionList.contains(AccessibilityNodeInfoCompat.ACTION_FOCUS);
  }

  /**
   * Determines if any of the provided {@link View}'s and {@link AccessibilityNodeInfoCompat}'s
   * ancestors can receive accessibility focus
   *
   * @param view The {@link View} to evaluate
   * @param node The {@link AccessibilityNodeInfoCompat} to evaluate
   * @return {@code true} if an ancestor of may receive accessibility focus
   */
  public static boolean hasFocusableAncestor(
      @Nullable AccessibilityNodeInfoCompat node, @Nullable View view) {
    if (node == null || view == null) {
      return false;
    }

    final ViewParent parentView = ViewCompat.getParentForAccessibility(view);
    if (!(parentView instanceof View)) {
      return false;
    }

    final AccessibilityNodeInfoCompat parentNode = AccessibilityNodeInfoCompat.obtain();
    try {
      ViewCompat.onInitializeAccessibilityNodeInfo((View) parentView, parentNode);
      if (parentNode == null) {
        return false;
      }

      if (hasEqualBoundsToViewRoot(parentNode, (View) parentView)
          && parentNode.getChildCount() > 0) {
        return false;
      }

      if (isAccessibilityFocusable(parentNode, (View) parentView)) {
        return true;
      }

      if (hasFocusableAncestor(parentNode, (View) parentView)) {
        return true;
      }
    } finally {
      parentNode.recycle();
    }
    return false;
  }

  /**
   * Returns whether a one given view is a descendant of another.
   *
   * @param view The {@link View} to evaluate
   * @param potentialAncestor The potential ancestor {@link View}
   * @return {@code true} if view is a descendant of potentialAncestor
   */
  private static boolean viewIsDescendant(View view, View potentialAncestor) {
    ViewParent parent = view.getParent();
    while (parent != null) {
      if (parent == potentialAncestor) {
        return true;
      }
      parent = parent.getParent();
    }

    return false;
  }

  /**
   * Returns whether a View has the same size and position as its View Root.
   *
   * @param view The {@link View} to evaluate
   * @return {@code true} if view has equal bounds
   */
  public static boolean hasEqualBoundsToViewRoot(AccessibilityNodeInfoCompat node, View view) {
    AndroidRootResolver rootResolver = new AndroidRootResolver();
    List<AndroidRootResolver.Root> roots = rootResolver.listActiveRoots();
    if (roots != null) {
      for (AndroidRootResolver.Root root : roots) {
        if (view == root.view) {
          return true;
        }

        if (viewIsDescendant(view, root.view)) {
          Rect nodeBounds = new Rect();
          node.getBoundsInScreen(nodeBounds);

          Rect viewRootBounds = new Rect();
          viewRootBounds.set(
              root.param.x,
              root.param.y,
              root.param.width + root.param.x,
              root.param.height + root.param.y);

          return nodeBounds.equals(viewRootBounds);
        }
      }
    }
    return false;
  }

  /**
   * Returns whether a given {@link View} will be focusable by Google's TalkBack screen reader.
   *
   * @param view The {@link View} to evaluate.
   * @return {@code boolean} if the view will be ignored by TalkBack.
   */
  public static boolean isTalkbackFocusable(View view) {
    if (view == null) {
      return false;
    }

    final int important = ViewCompat.getImportantForAccessibility(view);
    if (important == ViewCompat.IMPORTANT_FOR_ACCESSIBILITY_NO
        || important == ViewCompat.IMPORTANT_FOR_ACCESSIBILITY_NO_HIDE_DESCENDANTS) {
      return false;
    }

    // Go all the way up the tree to make sure no parent has hidden its descendants
    ViewParent parent = view.getParent();
    while (parent instanceof View) {
      if (ViewCompat.getImportantForAccessibility((View) parent)
          == ViewCompat.IMPORTANT_FOR_ACCESSIBILITY_NO_HIDE_DESCENDANTS) {
        return false;
      }
      parent = parent.getParent();
    }

    final AccessibilityNodeInfoCompat node = ViewAccessibilityHelper.createNodeInfoFromView(view);
    if (node == null) {
      return false;
    }

    // Non-leaf nodes identical in size to their View Root should not be focusable.
    if (hasEqualBoundsToViewRoot(node, view) && node.getChildCount() > 0) {
      return false;
    }

    try {
      if (!node.isVisibleToUser()) {
        return false;
      }

      if (isAccessibilityFocusable(node, view)) {
        if (node.getChildCount() <= 0) {
          // Leaves that are accessibility focusable are never ignored, even if they don't have a
          // speakable description
          return true;
        } else if (isSpeakingNode(node, view)) {
          // Node is focusable and has something to speak
          return true;
        }

        // Node is focusable and has nothing to speak
        return false;
      }

      // if view is not accessibility focusable, it needs to have text and no focusable ancestors.
      if (!hasText(node)) {
        return false;
      }

      if (!hasFocusableAncestor(node, view)) {
        return true;
      }

      return false;
    } finally {
      node.recycle();
    }
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

package com.facebook.sonar.plugins.inspector.descriptors.utils;

import android.support.v4.view.ViewCompat;
import android.support.v4.view.accessibility.AccessibilityNodeInfoCompat;
import android.view.View;
import android.view.accessibility.AccessibilityNodeInfo;
import javax.annotation.Nullable;

/**
 * Utility class that handles the addition of a "role" for accessibility to either a View or
 * AccessibilityNodeInfo.
 */
public class AccessibilityRoleUtil {

  /**
   * These roles are defined by Google's TalkBack screen reader, and this list should be kept up to
   * date with their implementation. Details can be seen in their source code here:
   *
   * <p>https://github.com/google/talkback/blob/master/utils/src/main/java/Role.java
   */
  public enum AccessibilityRole {
    NONE(null),
    BUTTON("android.widget.Button"),
    CHECK_BOX("android.widget.CompoundButton"),
    DROP_DOWN_LIST("android.widget.Spinner"),
    EDIT_TEXT("android.widget.EditText"),
    GRID("android.widget.GridView"),
    IMAGE("android.widget.ImageView"),
    IMAGE_BUTTON("android.widget.ImageView"),
    LIST("android.widget.AbsListView"),
    PAGER("android.support.v4.view.ViewPager"),
    RADIO_BUTTON("android.widget.RadioButton"),
    SEEK_CONTROL("android.widget.SeekBar"),
    SWITCH("android.widget.Switch"),
    TAB_BAR("android.widget.TabWidget"),
    TOGGLE_BUTTON("android.widget.ToggleButton"),
    VIEW_GROUP("android.view.ViewGroup"),
    WEB_VIEW("android.webkit.WebView"),
    CHECKED_TEXT_VIEW("android.widget.CheckedTextView"),
    PROGRESS_BAR("android.widget.ProgressBar"),
    ACTION_BAR_TAB("android.app.ActionBar$Tab"),
    DRAWER_LAYOUT("android.support.v4.widget.DrawerLayout"),
    SLIDING_DRAWER("android.widget.SlidingDrawer"),
    ICON_MENU("com.android.internal.view.menu.IconMenuView"),
    TOAST("android.widget.Toast$TN"),
    DATE_PICKER_DIALOG("android.app.DatePickerDialog"),
    TIME_PICKER_DIALOG("android.app.TimePickerDialog"),
    DATE_PICKER("android.widget.DatePicker"),
    TIME_PICKER("android.widget.TimePicker"),
    NUMBER_PICKER("android.widget.NumberPicker"),
    SCROLL_VIEW("android.widget.ScrollView"),
    HORIZONTAL_SCROLL_VIEW("android.widget.HorizontalScrollView"),
    KEYBOARD_KEY("android.inputmethodservice.Keyboard$Key");

    @Nullable private final String mValue;

    AccessibilityRole(String type) {
      mValue = type;
    }

    @Nullable
    public String getValue() {
      return mValue;
    }

    public static AccessibilityRole fromValue(String value) {
      for (AccessibilityRole role : AccessibilityRole.values()) {
        if (role.getValue() != null && role.getValue().equals(value)) {
          return role;
        }
      }
      return AccessibilityRole.NONE;
    }
  }

  private AccessibilityRoleUtil() {
    // No instances
  }

  public static AccessibilityRole getRole(View view) {
    AccessibilityNodeInfoCompat nodeInfo = AccessibilityNodeInfoCompat.obtain();
    ViewCompat.onInitializeAccessibilityNodeInfo(view, nodeInfo);
    AccessibilityRole role = getRole(nodeInfo);
    nodeInfo.recycle();
    return role;
  }

  public static AccessibilityRole getRole(AccessibilityNodeInfo nodeInfo) {
    return getRole(new AccessibilityNodeInfoCompat(nodeInfo));
  }

  public static AccessibilityRole getRole(AccessibilityNodeInfoCompat nodeInfo) {
    AccessibilityRole role = AccessibilityRole.fromValue((String) nodeInfo.getClassName());
    if (role.equals(AccessibilityRole.IMAGE_BUTTON) || role.equals(AccessibilityRole.IMAGE)) {
      return nodeInfo.isClickable() ? AccessibilityRole.IMAGE_BUTTON : AccessibilityRole.IMAGE;
    }

    if (role.equals(AccessibilityRole.NONE)) {
      AccessibilityNodeInfoCompat.CollectionInfoCompat collection = nodeInfo.getCollectionInfo();
      if (collection != null) {
        // RecyclerView will be classified as a list or grid.
        if (collection.getRowCount() > 1 && collection.getColumnCount() > 1) {
          return AccessibilityRole.GRID;
        } else {
          return AccessibilityRole.LIST;
        }
      }
    }

    return role;
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

package com.facebook.sonar.plugins.inspector.descriptors.utils;

import static android.content.Context.ACCESSIBILITY_SERVICE;

import android.content.Context;
import android.graphics.Rect;
import android.os.Build;
import android.support.v4.view.ViewCompat;
import android.support.v4.view.accessibility.AccessibilityNodeInfoCompat;
import android.text.TextUtils;
import android.view.View;
import android.view.ViewGroup;
import android.view.ViewParent;
import android.view.accessibility.AccessibilityManager;
import android.widget.EditText;
import com.facebook.sonar.core.SonarArray;
import com.facebook.sonar.core.SonarObject;
import javax.annotation.Nullable;

/**
 * This class provides utility methods for determining certain accessibility properties of {@link
 * View}s and {@link AccessibilityNodeInfoCompat}s. It is porting some of the checks from {@link
 * com.googlecode.eyesfree.utils.AccessibilityNodeInfoUtils}, but has stripped many features which
 * are unnecessary here.
 */
public final class AccessibilityUtil {
  private AccessibilityUtil() {}

  public static final EnumMapping sAccessibilityActionMapping =
      new EnumMapping("UNKNOWN") {
        {
          put("FOCUS", AccessibilityNodeInfoCompat.ACTION_FOCUS);
          put("CLEAR_FOCUS", AccessibilityNodeInfoCompat.ACTION_CLEAR_FOCUS);
          put("SELECT", AccessibilityNodeInfoCompat.ACTION_SELECT);
          put("CLEAR_SELECTION", AccessibilityNodeInfoCompat.ACTION_CLEAR_SELECTION);
          put("CLICK", AccessibilityNodeInfoCompat.ACTION_CLICK);
          put("LONG_CLICK", AccessibilityNodeInfoCompat.ACTION_LONG_CLICK);
          put("ACCESSIBILITY_FOCUS", AccessibilityNodeInfoCompat.ACTION_ACCESSIBILITY_FOCUS);
          put(
              "CLEAR_ACCESSIBILITY_FOCUS",
              AccessibilityNodeInfoCompat.ACTION_CLEAR_ACCESSIBILITY_FOCUS);
          put(
              "NEXT_AT_MOVEMENT_GRANULARITY",
              AccessibilityNodeInfoCompat.ACTION_NEXT_AT_MOVEMENT_GRANULARITY);
          put(
              "PREVIOUS_AT_MOVEMENT_GRANULARITY",
              AccessibilityNodeInfoCompat.ACTION_PREVIOUS_AT_MOVEMENT_GRANULARITY);
          put("NEXT_HTML_ELEMENT", AccessibilityNodeInfoCompat.ACTION_NEXT_HTML_ELEMENT);
          put("PREVIOUS_HTML_ELEMENT", AccessibilityNodeInfoCompat.ACTION_PREVIOUS_HTML_ELEMENT);
          put("SCROLL_FORWARD", AccessibilityNodeInfoCompat.ACTION_SCROLL_FORWARD);
          put("SCROLL_BACKWARD", AccessibilityNodeInfoCompat.ACTION_SCROLL_BACKWARD);
          put("CUT", AccessibilityNodeInfoCompat.ACTION_CUT);
          put("COPY", AccessibilityNodeInfoCompat.ACTION_COPY);
          put("PASTE", AccessibilityNodeInfoCompat.ACTION_PASTE);
          put("SET_SELECTION", AccessibilityNodeInfoCompat.ACTION_SET_SELECTION);
          put("SET_SELECTION", AccessibilityNodeInfoCompat.ACTION_SET_SELECTION);
          put("EXPAND", AccessibilityNodeInfoCompat.ACTION_EXPAND);
          put("COLLAPSE", AccessibilityNodeInfoCompat.ACTION_COLLAPSE);
          put("DISMISS", AccessibilityNodeInfoCompat.ACTION_DISMISS);
          put("SET_TEXT", AccessibilityNodeInfoCompat.ACTION_SET_TEXT);
        }
      };

  public static final EnumMapping sImportantForAccessibilityMapping =
      new EnumMapping("AUTO") {
        {
          put("AUTO", View.IMPORTANT_FOR_ACCESSIBILITY_AUTO);
          put("NO", View.IMPORTANT_FOR_ACCESSIBILITY_NO);
          put("YES", View.IMPORTANT_FOR_ACCESSIBILITY_YES);
          put("NO_HIDE_DESCENDANTS", View.IMPORTANT_FOR_ACCESSIBILITY_NO_HIDE_DESCENDANTS);
        }
      };

  /**
   * Given a {@link Context}, determine if any accessibility service is running.
   *
   * @param context The {@link Context} used to get the {@link AccessibilityManager}.
   * @return {@code true} if an accessibility service is currently running.
   */
  public static boolean isAccessibilityEnabled(Context context) {
    return ((AccessibilityManager) context.getSystemService(ACCESSIBILITY_SERVICE)).isEnabled();
  }

  /**
   * Returns a sentence describing why a given {@link View} will be ignored by Google's TalkBack
   * screen reader.
   *
   * @param view The {@link View} to evaluate.
   * @return {@code String} describing why a {@link View} is ignored.
   */
  public static String getTalkbackIgnoredReasons(View view) {
    final int important = ViewCompat.getImportantForAccessibility(view);

    if (important == ViewCompat.IMPORTANT_FOR_ACCESSIBILITY_NO) {
      return "View has importantForAccessibility set to 'NO'.";
    }

    if (important == ViewCompat.IMPORTANT_FOR_ACCESSIBILITY_NO_HIDE_DESCENDANTS) {
      return "View has importantForAccessibility set to 'NO_HIDE_DESCENDANTS'.";
    }

    ViewParent parent = view.getParent();
    while (parent instanceof View) {
      if (ViewCompat.getImportantForAccessibility((View) parent)
          == ViewCompat.IMPORTANT_FOR_ACCESSIBILITY_NO_HIDE_DESCENDANTS) {
        return "An ancestor View has importantForAccessibility set to 'NO_HIDE_DESCENDANTS'.";
      }
      parent = parent.getParent();
    }

    final AccessibilityNodeInfoCompat node = ViewAccessibilityHelper.createNodeInfoFromView(view);
    if (node == null) {
      return "AccessibilityNodeInfo cannot be found.";
    }

    try {
      if (AccessibilityEvaluationUtil.hasEqualBoundsToViewRoot(node, view)) {
        return "View has the same dimensions as the View Root.";
      }

      if (!node.isVisibleToUser()) {
        return "View is not visible.";
      }

      if (AccessibilityEvaluationUtil.isAccessibilityFocusable(node, view)) {
        return "View is actionable, but has no description.";
      }

      if (AccessibilityEvaluationUtil.hasText(node)) {
        return "View is not actionable, and an ancestor View has co-opted its description.";
      }

      return "View is not actionable and has no description.";
    } finally {
      node.recycle();
    }
  }

  /**
   * Returns a sentence describing why a given {@link View} will be focusable by Google's TalkBack
   * screen reader.
   *
   * @param view The {@link View} to evaluate.
   * @return {@code String} describing why a {@link View} is focusable.
   */
  @Nullable
  public static String getTalkbackFocusableReasons(View view) {
    final AccessibilityNodeInfoCompat node = ViewAccessibilityHelper.createNodeInfoFromView(view);
    if (node == null) {
      return null;
    }
    try {
      final boolean hasText = AccessibilityEvaluationUtil.hasText(node);
      final boolean isCheckable = node.isCheckable();
      final boolean hasNonActionableSpeakingDescendants =
          AccessibilityEvaluationUtil.hasNonActionableSpeakingDescendants(node, view);

      if (AccessibilityEvaluationUtil.isActionableForAccessibility(node)) {
        if (node.getChildCount() <= 0) {
          return "View is actionable and has no children.";
        } else if (hasText) {
          return "View is actionable and has a description.";
        } else if (isCheckable) {
          return "View is actionable and checkable.";
        } else if (hasNonActionableSpeakingDescendants) {
          return "View is actionable and has non-actionable descendants with descriptions.";
        }
      }

      if (AccessibilityEvaluationUtil.isTopLevelScrollItem(node, view)) {
        if (hasText) {
          return "View is a direct child of a scrollable container and has a description.";
        } else if (isCheckable) {
          return "View is a direct child of a scrollable container and is checkable.";
        } else if (hasNonActionableSpeakingDescendants) {
          return "View is a direct child of a scrollable container and has non-actionable "
              + "descendants with descriptions.";
        }
      }

      if (hasText) {
        return "View has a description and is not actionable, but has no actionable ancestor.";
      }

      return null;
    } finally {
      node.recycle();
    }
  }

  /**
   * Creates the text that Gogole's TalkBack screen reader will read aloud for a given {@link View}.
   * This may be any combination of the {@link View}'s {@code text}, {@code contentDescription}, and
   * the {@code text} and {@code contentDescription} of any ancestor {@link View}.
   *
   * <p>Note: This string does not include any additional semantic information that Talkback will
   * read, such as "Button", or "disabled".
   *
   * @param view The {@link View} to evaluate.
   * @return {@code String} describing why a {@link View} is focusable.
   */
  @Nullable
  public static CharSequence getTalkbackDescription(View view) {
    final AccessibilityNodeInfoCompat node = ViewAccessibilityHelper.createNodeInfoFromView(view);
    if (node == null) {
      return null;
    }
    try {
      final CharSequence contentDescription = node.getContentDescription();
      final CharSequence nodeText = node.getText();

      final boolean hasNodeText = !TextUtils.isEmpty(nodeText);
      final boolean isEditText = view instanceof EditText;

      // EditText's prioritize their own text content over a contentDescription
      if (!TextUtils.isEmpty(contentDescription) && (!isEditText || !hasNodeText)) {
        return contentDescription;
      }

      if (hasNodeText) {
        return nodeText;
      }

      // If there are child views and no contentDescription the text of all non-focusable children,
      // comma separated, becomes the description.
      if (view instanceof ViewGroup) {
        final StringBuilder concatChildDescription = new StringBuilder();
        final String separator = ", ";
        final ViewGroup viewGroup = (ViewGroup) view;

        for (int i = 0, count = viewGroup.getChildCount(); i < count; i++) {
          final View child = viewGroup.getChildAt(i);

          final AccessibilityNodeInfoCompat childNodeInfo = AccessibilityNodeInfoCompat.obtain();
          ViewCompat.onInitializeAccessibilityNodeInfo(child, childNodeInfo);

          CharSequence childNodeDescription = null;
          if (AccessibilityEvaluationUtil.isSpeakingNode(childNodeInfo, child)
              && !AccessibilityEvaluationUtil.isAccessibilityFocusable(childNodeInfo, child)) {
            childNodeDescription = getTalkbackDescription(child);
          }

          if (!TextUtils.isEmpty(childNodeDescription)) {
            if (concatChildDescription.length() > 0) {
              concatChildDescription.append(separator);
            }
            concatChildDescription.append(childNodeDescription);
          }
          childNodeInfo.recycle();
        }

        return concatChildDescription.length() > 0 ? concatChildDescription.toString() : null;
      }

      return null;
    } finally {
      node.recycle();
    }
  }

  /**
   * Creates a {@link SonarObject} of useful properties of AccessibilityNodeInfo, to be shown in the
   * Sonar Layout Inspector. All properties are immutable since they are all derived from various
   * {@link View} properties.
   *
   * @param view The {@link View} to derive the AccessibilityNodeInfo properties from.
   * @return {@link SonarObject} containing the properties.
   */
  @Nullable
  public static SonarObject getAccessibilityNodeInfoProperties(View view) {
    final AccessibilityNodeInfoCompat nodeInfo =
        ViewAccessibilityHelper.createNodeInfoFromView(view);
    if (nodeInfo == null) {
      return null;
    }

    final SonarObject.Builder nodeInfoProps = new SonarObject.Builder();
    final Rect bounds = new Rect();

    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {
      final SonarArray.Builder actionsArrayBuilder = new SonarArray.Builder();
      for (AccessibilityNodeInfoCompat.AccessibilityActionCompat action :
          nodeInfo.getActionList()) {
        final String actionLabel = (String) action.getLabel();
        if (actionLabel != null) {
          actionsArrayBuilder.put(actionLabel);
        } else {
          actionsArrayBuilder.put(
              AccessibilityUtil.sAccessibilityActionMapping.get(action.getId(), false));
        }
      }
      nodeInfoProps.put("actions", actionsArrayBuilder.build());
    }

    nodeInfoProps
        .put("clickable", nodeInfo.isClickable())
        .put("content-description", nodeInfo.getContentDescription())
        .put("text", nodeInfo.getText())
        .put("focused", nodeInfo.isAccessibilityFocused())
        .put("long-clickable", nodeInfo.isLongClickable())
        .put("focusable", nodeInfo.isFocusable());

    nodeInfo.getBoundsInParent(bounds);
    nodeInfoProps.put(
        "parent-bounds",
        new SonarObject.Builder()
            .put("width", bounds.width())
            .put("height", bounds.height())
            .put("top", bounds.top)
            .put("left", bounds.left)
            .put("bottom", bounds.bottom)
            .put("right", bounds.right));

    nodeInfo.getBoundsInScreen(bounds);
    nodeInfoProps.put(
        "screen-bounds",
        new SonarObject.Builder()
            .put("width", bounds.width())
            .put("height", bounds.height())
            .put("top", bounds.top)
            .put("left", bounds.left)
            .put("bottom", bounds.bottom)
            .put("right", bounds.right));

    nodeInfo.recycle();

    return nodeInfoProps.build();
  }

  /**
   * Modifies a {@link SonarObject.Builder} to add Talkback-specific Accessibiltiy properties to be
   * shown in the Sonar Layout Inspector.
   *
   * @param props The {@link SonarObject.Builder} to add the properties to.
   * @param view The {@link View} to derive the properties from.
   */
  public static void addTalkbackProperties(SonarObject.Builder props, View view) {
    if (!AccessibilityEvaluationUtil.isTalkbackFocusable(view)) {
      props
          .put("talkback-ignored", true)
          .put("talkback-ignored-reasons", getTalkbackIgnoredReasons(view));
    } else {
      props
          .put("talkback-focusable", true)
          .put("talkback-focusable-reasons", getTalkbackFocusableReasons(view))
          .put("talkback-description", getTalkbackDescription(view));
    }
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

package com.facebook.sonar.plugins.inspector.descriptors.utils;

import static android.view.WindowManager.LayoutParams;

import android.os.Build;
import android.view.View;
import java.lang.reflect.Field;
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import javax.annotation.Nullable;

public final class AndroidRootResolver {

  private static final String WINDOW_MANAGER_IMPL_CLAZZ = "android.view.WindowManagerImpl";
  private static final String WINDOW_MANAGER_GLOBAL_CLAZZ = "android.view.WindowManagerGlobal";
  private static final String VIEWS_FIELD = "mViews";
  private static final String WINDOW_PARAMS_FIELD = "mParams";
  private static final String GET_DEFAULT_IMPL = "getDefault";
  private static final String GET_GLOBAL_INSTANCE = "getInstance";

  private boolean initialized;
  private Object windowManagerObj;
  private Field viewsField;
  private Field paramsField;

  public static class Root {
    public final View view;
    public final LayoutParams param;

    private Root(View view, LayoutParams param) {
      this.view = view;
      this.param = param;
    }
  }

  public @Nullable List<Root> listActiveRoots() {
    if (!initialized) {
      initialize();
    }

    if (null == windowManagerObj) {
      return null;
    }

    if (null == viewsField) {
      return null;
    }
    if (null == paramsField) {
      return null;
    }

    List<View> views = null;
    List<LayoutParams> params = null;

    try {
      if (Build.VERSION.SDK_INT < 19) {
        views = Arrays.asList((View[]) viewsField.get(windowManagerObj));
        params = Arrays.asList((LayoutParams[]) paramsField.get(windowManagerObj));
      } else {
        views = (List<View>) viewsField.get(windowManagerObj);
        params = (List<LayoutParams>) paramsField.get(windowManagerObj);
      }
    } catch (RuntimeException | IllegalAccessException re) {
      return null;
    }

    List<Root> roots = new ArrayList<>();
    for (int i = 0, stop = views.size(); i < stop; i++) {
      roots.add(new Root(views.get(i), params.get(i)));
    }
    return roots;
  }

  private void initialize() {
    initialized = true;
    String accessClass =
        Build.VERSION.SDK_INT > 16 ? WINDOW_MANAGER_GLOBAL_CLAZZ : WINDOW_MANAGER_IMPL_CLAZZ;
    String instanceMethod = Build.VERSION.SDK_INT > 16 ? GET_GLOBAL_INSTANCE : GET_DEFAULT_IMPL;

    try {
      Class<?> clazz = Class.forName(accessClass);
      Method getMethod = clazz.getMethod(instanceMethod);
      windowManagerObj = getMethod.invoke(null);
      viewsField = clazz.getDeclaredField(VIEWS_FIELD);
      viewsField.setAccessible(true);
      paramsField = clazz.getDeclaredField(WINDOW_PARAMS_FIELD);
      paramsField.setAccessible(true);
    } catch (InvocationTargetException | IllegalAccessException | RuntimeException | NoSuchMethodException | NoSuchFieldException | ClassNotFoundException ignored) {
    }
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

package com.facebook.sonar.plugins.inspector.descriptors.utils;

import static com.facebook.sonar.plugins.inspector.InspectorValue.Type.Enum;

import android.support.v4.util.SimpleArrayMap;
import com.facebook.sonar.plugins.inspector.InspectorValue;

public class EnumMapping {
  private final SimpleArrayMap<String, Integer> mMapping = new SimpleArrayMap<>();
  private final String mDefaultKey;

  public EnumMapping(String defaultKey) {
    mDefaultKey = defaultKey;
  }

  public void put(String s, int i) {
    mMapping.put(s, i);
  }

  public InspectorValue get(final int i) {
    return get(i, true);
  }

  public InspectorValue get(final int i, final boolean mutable) {
    for (int ii = 0, count = mMapping.size(); ii < count; ii++) {
      if (mMapping.valueAt(ii) == i) {
        return mutable
            ? InspectorValue.mutable(Enum, mMapping.keyAt(ii))
            : InspectorValue.immutable(Enum, mMapping.keyAt(ii));
      }
    }
    return mutable
        ? InspectorValue.mutable(Enum, mDefaultKey)
        : InspectorValue.immutable(Enum, mDefaultKey);
  }

  public int get(String s) {
    if (mMapping.containsKey(s)) {
      return mMapping.get(s);
    }
    return mMapping.get(mDefaultKey);
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

package com.facebook.sonar.plugins.inspector.descriptors.utils;

import android.support.v4.view.ViewCompat;
import android.support.v4.view.accessibility.AccessibilityNodeInfoCompat;
import android.view.View;
import javax.annotation.Nullable;

/** Class that helps with accessibility by providing useful methods. */
public final class ViewAccessibilityHelper {

  /**
   * Creates and returns an {@link AccessibilityNodeInfoCompat} from the the provided {@link View}.
   * Note: This does not handle recycling of the {@link AccessibilityNodeInfoCompat}.
   *
   * @param view The {@link View} to create the {@link AccessibilityNodeInfoCompat} from.
   * @return {@link AccessibilityNodeInfoCompat}
   */
  @Nullable
  public static AccessibilityNodeInfoCompat createNodeInfoFromView(View view) {
    if (view == null) {
      return null;
    }

    final AccessibilityNodeInfoCompat nodeInfo = AccessibilityNodeInfoCompat.obtain();

    // For some unknown reason, Android seems to occasionally throw a NPE from
    // onInitializeAccessibilityNodeInfo.
    try {
      ViewCompat.onInitializeAccessibilityNodeInfo(view, nodeInfo);
    } catch (NullPointerException e) {
      if (nodeInfo != null) {
        nodeInfo.recycle();
      }
      return null;
    }

    return nodeInfo;
  }

}
// Copyright 2004-present Facebook. All Rights Reserved.

package com.facebook.litho.sonar;

import static com.facebook.litho.annotations.ImportantForAccessibility.IMPORTANT_FOR_ACCESSIBILITY_NO;
import static com.facebook.litho.annotations.ImportantForAccessibility.IMPORTANT_FOR_ACCESSIBILITY_NO_HIDE_DESCENDANTS;
import static com.facebook.sonar.plugins.inspector.InspectorValue.Type.Color;
import static com.facebook.sonar.plugins.inspector.InspectorValue.Type.Enum;
import static com.facebook.sonar.plugins.inspector.InspectorValue.Type.Number;

import android.graphics.Rect;
import android.graphics.drawable.ColorDrawable;
import android.graphics.drawable.Drawable;
import android.support.v4.util.Pair;
import android.view.View;
import com.facebook.litho.Component;
import com.facebook.litho.ComponentContext;
import com.facebook.litho.ComponentLifecycle;
import com.facebook.litho.DebugComponent;
import com.facebook.litho.DebugLayoutNode;
import com.facebook.litho.EventHandler;
import com.facebook.litho.LithoView;
import com.facebook.litho.annotations.Prop;
import com.facebook.litho.annotations.State;
import com.facebook.litho.reference.Reference;
import com.facebook.sonar.core.SonarDynamic;
import com.facebook.sonar.core.SonarObject;
import com.facebook.sonar.plugins.inspector.HighlightedOverlay;
import com.facebook.sonar.plugins.inspector.InspectorValue;
import com.facebook.sonar.plugins.inspector.Named;
import com.facebook.sonar.plugins.inspector.NodeDescriptor;
import com.facebook.sonar.plugins.inspector.Touch;
import com.facebook.sonar.plugins.inspector.descriptors.ObjectDescriptor;
import com.facebook.sonar.plugins.inspector.descriptors.utils.AccessibilityUtil;
import com.facebook.yoga.YogaAlign;
import com.facebook.yoga.YogaDirection;
import com.facebook.yoga.YogaEdge;
import com.facebook.yoga.YogaFlexDirection;
import com.facebook.yoga.YogaJustify;
import com.facebook.yoga.YogaPositionType;
import com.facebook.yoga.YogaValue;
import java.lang.reflect.Field;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import javax.annotation.Nullable;

public class DebugComponentDescriptor extends NodeDescriptor<DebugComponent> {

  private Map<String, List<Pair<String[], SonarDynamic>>> mOverrides = new HashMap<>();
  private DebugComponent.Overrider mOverrider =
      new DebugComponent.Overrider() {
        @Override
        public void applyComponentOverrides(String key, Component component) {
          final List<Pair<String[], SonarDynamic>> overrides = mOverrides.get(key);
          if (overrides == null) {
            return;
          }

          for (Pair<String[], SonarDynamic> override : overrides) {
            if (override.first[0].equals("Props")) {
              applyReflectiveOverride(component, override.first[1], override.second);
            }
          }
        }

        @Override
        public void applyStateOverrides(
            String key, ComponentLifecycle.StateContainer stateContainer) {
          final List<Pair<String[], SonarDynamic>> overrides = mOverrides.get(key);
          if (overrides == null) {
            return;
          }

          for (Pair<String[], SonarDynamic> override : overrides) {
            if (override.first[0].equals("State")) {
              applyReflectiveOverride(stateContainer, override.first[1], override.second);
            }
          }
        }

        @Override
        public void applyLayoutOverrides(String key, DebugLayoutNode node) {
          final List<Pair<String[], SonarDynamic>> overrides = mOverrides.get(key);
          if (overrides == null) {
            return;
          }

          for (Pair<String[], SonarDynamic> override : overrides) {
            if (override.first[0].equals("Layout")) {
              try {
                applyLayoutOverride(
                    node,
                    Arrays.copyOfRange(override.first, 1, override.first.length),
                    override.second);
              } catch (Exception ignored) {
              }
            } else if (override.first[0].equals("Accessibility")) {
              applyAccessibilityOverride(node, override.first[1], override.second);
            }
          }
        }
      };

  @Override
  public void init(DebugComponent node) {
    // We rely on the LithoView being invalidated when a component hierarchy changes.
  }

  @Override
  public String getId(DebugComponent node) {
    return node.getGlobalKey();
  }

  @Override
  public String getName(DebugComponent node) throws Exception {
    NodeDescriptor componentDescriptor = descriptorForClass(node.getComponent().getClass());
    if (componentDescriptor.getClass() != ObjectDescriptor.class) {
      return componentDescriptor.getName(node.getComponent());
    }
    return node.getComponent().getSimpleName();
  }

  @Override
  public int getChildCount(DebugComponent node) {
    if (node.getMountedView() != null || node.getMountedDrawable() != null) {
      return 1;
    } else {
      return node.getChildComponents().size();
    }
  }

  @Override
  public Object getChildAt(DebugComponent node, int index) {
    final View mountedView = node.getMountedView();
    final Drawable mountedDrawable = node.getMountedDrawable();

    if (mountedView != null) {
      return mountedView;
    } else if (mountedDrawable != null) {
      return mountedDrawable;
    } else {
      return node.getChildComponents().get(index);
    }
  }

  @Override
  public List<Named<SonarObject>> getData(DebugComponent node) throws Exception {
    NodeDescriptor componentDescriptor = descriptorForClass(node.getComponent().getClass());
    if (componentDescriptor.getClass() != ObjectDescriptor.class) {
      return componentDescriptor.getData(node.getComponent());
    }

    final List<Named<SonarObject>> data = new ArrayList<>();

    final SonarObject layoutData = getLayoutData(node);
    if (layoutData != null) {
      data.add(new Named<>("Layout", layoutData));
    }

    final SonarObject propData = getPropData(node);
    if (propData != null) {
      data.add(new Named<>("Props", propData));
    }

    final SonarObject stateData = getStateData(node);
    if (stateData != null) {
      data.add(new Named<>("State", stateData));
    }

    final SonarObject accessibilityData = getAccessibilityData(node);
    if (accessibilityData != null) {
      data.add(new Named<>("Accessibility", accessibilityData));
    }

    return data;
  }

  @Nullable
  private static SonarObject getLayoutData(DebugComponent node) {
    final DebugLayoutNode layout = node.getLayoutNode();
    if (layout == null) {
      return null;
    }

    final SonarObject.Builder data = new SonarObject.Builder();
    data.put("background", fromReference(node.getContext(), layout.getBackground()));
    data.put("foreground", fromDrawable(layout.getForeground()));

    data.put("direction", InspectorValue.mutable(Enum, layout.getLayoutDirection().toString()));
    data.put("flex-direction", InspectorValue.mutable(Enum, layout.getFlexDirection().toString()));
    data.put(
        "justify-content", InspectorValue.mutable(Enum, layout.getJustifyContent().toString()));
    data.put("align-items", InspectorValue.mutable(Enum, layout.getAlignItems().toString()));
    data.put("align-self", InspectorValue.mutable(Enum, layout.getAlignSelf().toString()));
    data.put("align-content", InspectorValue.mutable(Enum, layout.getAlignContent().toString()));
    data.put("position-type", InspectorValue.mutable(Enum, layout.getPositionType().toString()));

    data.put("flex-grow", fromFloat(layout.getFlexGrow()));
    data.put("flex-shrink", fromFloat(layout.getFlexShrink()));
    data.put("flex-basis", fromYogaValue(layout.getFlexBasis()));

    data.put("width", fromYogaValue(layout.getWidth()));
    data.put("min-width", fromYogaValue(layout.getMinWidth()));
    data.put("max-width", fromYogaValue(layout.getMaxWidth()));

    data.put("height", fromYogaValue(layout.getHeight()));
    data.put("min-height", fromYogaValue(layout.getMinHeight()));
    data.put("max-height", fromYogaValue(layout.getMaxHeight()));

    data.put("aspect-ratio", fromFloat(layout.getAspectRatio()));

    data.put(
        "margin",
        new SonarObject.Builder()
            .put("left", fromYogaValue(layout.getMargin(YogaEdge.LEFT)))
            .put("top", fromYogaValue(layout.getMargin(YogaEdge.TOP)))
            .put("right", fromYogaValue(layout.getMargin(YogaEdge.RIGHT)))
            .put("bottom", fromYogaValue(layout.getMargin(YogaEdge.BOTTOM)))
            .put("start", fromYogaValue(layout.getMargin(YogaEdge.START)))
            .put("end", fromYogaValue(layout.getMargin(YogaEdge.END)))
            .put("horizontal", fromYogaValue(layout.getMargin(YogaEdge.HORIZONTAL)))
            .put("vertical", fromYogaValue(layout.getMargin(YogaEdge.VERTICAL)))
            .put("all", fromYogaValue(layout.getMargin(YogaEdge.ALL))));

    data.put(
        "padding",
        new SonarObject.Builder()
            .put("left", fromYogaValue(layout.getPadding(YogaEdge.LEFT)))
            .put("top", fromYogaValue(layout.getPadding(YogaEdge.TOP)))
            .put("right", fromYogaValue(layout.getPadding(YogaEdge.RIGHT)))
            .put("bottom", fromYogaValue(layout.getPadding(YogaEdge.BOTTOM)))
            .put("start", fromYogaValue(layout.getPadding(YogaEdge.START)))
            .put("end", fromYogaValue(layout.getPadding(YogaEdge.END)))
            .put("horizontal", fromYogaValue(layout.getPadding(YogaEdge.HORIZONTAL)))
            .put("vertical", fromYogaValue(layout.getPadding(YogaEdge.VERTICAL)))
            .put("all", fromYogaValue(layout.getPadding(YogaEdge.ALL))));

    data.put(
        "border",
        new SonarObject.Builder()
            .put("left", fromFloat(layout.getBorderWidth(YogaEdge.LEFT)))
            .put("top", fromFloat(layout.getBorderWidth(YogaEdge.TOP)))
            .put("right", fromFloat(layout.getBorderWidth(YogaEdge.RIGHT)))
            .put("bottom", fromFloat(layout.getBorderWidth(YogaEdge.BOTTOM)))
            .put("start", fromFloat(layout.getBorderWidth(YogaEdge.START)))
            .put("end", fromFloat(layout.getBorderWidth(YogaEdge.END)))
            .put("horizontal", fromFloat(layout.getBorderWidth(YogaEdge.HORIZONTAL)))
            .put("vertical", fromFloat(layout.getBorderWidth(YogaEdge.VERTICAL)))
            .put("all", fromFloat(layout.getBorderWidth(YogaEdge.ALL))));

    data.put(
        "position",
        new SonarObject.Builder()
            .put("left", fromYogaValue(layout.getPosition(YogaEdge.LEFT)))
            .put("top", fromYogaValue(layout.getPosition(YogaEdge.TOP)))
            .put("right", fromYogaValue(layout.getPosition(YogaEdge.RIGHT)))
            .put("bottom", fromYogaValue(layout.getPosition(YogaEdge.BOTTOM)))
            .put("start", fromYogaValue(layout.getPosition(YogaEdge.START)))
            .put("end", fromYogaValue(layout.getPosition(YogaEdge.END)))
            .put("horizontal", fromYogaValue(layout.getPosition(YogaEdge.HORIZONTAL)))
            .put("vertical", fromYogaValue(layout.getPosition(YogaEdge.VERTICAL)))
            .put("all", fromYogaValue(layout.getPosition(YogaEdge.ALL))));

    return data.build();
  }

  @Nullable
  private static SonarObject getPropData(DebugComponent node) {
    if (node.isInternalComponent()) {
      return null;
    }

    final Component component = node.getComponent();
    final SonarObject.Builder props = new SonarObject.Builder();

    boolean hasProps = false;
    for (Field f : component.getClass().getDeclaredFields()) {
      try {
        f.setAccessible(true);

        final Prop annotation = f.getAnnotation(Prop.class);
        if (annotation != null) {
          switch (annotation.resType()) {
            case COLOR:
              props.put(f.getName(), fromColor((Integer) f.get(component)));
              break;
            case DRAWABLE:
              props.put(f.getName(), fromDrawable((Drawable) f.get(component)));
              break;
            default:
              if (f.get(component) != null
                  && PropWithDescription.class.isAssignableFrom(f.get(component).getClass())) {
                final Object description =
                    ((PropWithDescription) f.get(component))
                        .getSonarLayoutInspectorPropDescription();
                // Treat the description as immutable for now, because it's a "translation" of the
                // actual prop,
                // mutating them is not going to change the original prop.
                if (description instanceof Map<?, ?>) {
                  final Map<?, ?> descriptionMap = (Map<?, ?>) description;
                  for (Map.Entry<?, ?> entry : descriptionMap.entrySet()) {
                    props.put(
                        entry.getKey().toString(), InspectorValue.immutable(entry.getValue()));
                  }
                } else {
                  props.put(f.getName(), InspectorValue.immutable(description));
                }
              } else {
                if (isTypeMutable(f.getType())) {
                  props.put(f.getName(), InspectorValue.mutable(f.get(component)));
                } else {
                  props.put(f.getName(), InspectorValue.immutable(f.get(component)));
                }
              }
              break;
          }
          hasProps = true;
        }
      } catch (Exception ignored) {
      }
    }

    return hasProps ? props.build() : null;
  }

  @Nullable
  private static SonarObject getStateData(DebugComponent node) {
    if (node.isInternalComponent()) {
      return null;
    }

    final ComponentLifecycle.StateContainer stateContainer = node.getStateContainer();
    if (stateContainer == null) {
      return null;
    }

    final SonarObject.Builder state = new SonarObject.Builder();

    boolean hasState = false;
    for (Field f : stateContainer.getClass().getDeclaredFields()) {
      try {
        f.setAccessible(true);

        final State annotation = f.getAnnotation(State.class);
        if (annotation != null) {
          if (isTypeMutable(f.getType())) {
            state.put(f.getName(), InspectorValue.mutable(f.get(stateContainer)));
          } else {
            state.put(f.getName(), InspectorValue.immutable(f.get(stateContainer)));
          }
          hasState = true;
        }
      } catch (Exception ignored) {
      }
    }

    return hasState ? state.build() : null;
  }

  private static boolean isTypeMutable(Class<?> type) {
    if (type == int.class || type == Integer.class) {
      return true;
    } else if (type == long.class || type == Long.class) {
      return true;
    } else if (type == float.class || type == Float.class) {
      return true;
    } else if (type == double.class || type == Double.class) {
      return true;
    } else if (type == boolean.class || type == Boolean.class) {
      return true;
    } else if (type.isAssignableFrom(String.class)) {
      return true;
    }
    return false;
  }

  @Nullable
  private static SonarObject getAccessibilityData(DebugComponent node) {
    final DebugLayoutNode layout = node.getLayoutNode();
    if (layout == null) {
      return null;
    }

    final View hostView = node.getComponentHost();
    final SonarObject.Builder accessibilityProps = new SonarObject.Builder();

    // This needs to be an empty string to be mutable. See t20470623.
    final CharSequence contentDescription =
        layout.getContentDescription() != null ? layout.getContentDescription() : "";
    accessibilityProps.put("content-description", InspectorValue.mutable(contentDescription));
    accessibilityProps.put("focusable", InspectorValue.mutable(layout.getFocusable()));
    accessibilityProps.put(
        "important-for-accessibility",
        AccessibilityUtil.sImportantForAccessibilityMapping.get(
            layout.getImportantForAccessibility()));

    // No host view exists, so this component is inherently not accessible.  Add the reason why this
    // is the case and then return.
    if (hostView == node.getLithoView() || hostView == null) {
      final int importantForAccessibility = layout.getImportantForAccessibility();
      final boolean isAccessibilityEnabled =
          AccessibilityUtil.isAccessibilityEnabled(node.getContext());
      String ignoredReason;

      if (!isAccessibilityEnabled) {
        ignoredReason = "No accessibility service is running.";
      } else if (importantForAccessibility == IMPORTANT_FOR_ACCESSIBILITY_NO) {
        ignoredReason = "Component has importantForAccessibility set to NO.";
      } else if (importantForAccessibility == IMPORTANT_FOR_ACCESSIBILITY_NO_HIDE_DESCENDANTS) {
        ignoredReason = "Component has importantForAccessibility set to NO_HIDE_DESCENDANTS.";
      } else {
        ignoredReason = "Component does not have content, or accessibility handlers.";
      }

      accessibilityProps.put("talkback-ignored", true);
      accessibilityProps.put("talkback-ignored-reasons", ignoredReason);

      return accessibilityProps.build();
    }

    accessibilityProps.put(
        "node-info", AccessibilityUtil.getAccessibilityNodeInfoProperties(hostView));
    AccessibilityUtil.addTalkbackProperties(accessibilityProps, hostView);

    return accessibilityProps.build();
  }

  @Override
  public void setValue(DebugComponent node, String[] path, SonarDynamic value) {
    List<Pair<String[], SonarDynamic>> overrides = mOverrides.get(node.getGlobalKey());
    if (overrides == null) {
      overrides = new ArrayList<>();
      mOverrides.put(node.getGlobalKey(), overrides);
    }
    overrides.add(new Pair<>(path, value));

    node.setOverrider(mOverrider);
    node.rerender();
  }

  @Override
  public List<Named<String>> getAttributes(DebugComponent node) {
    final List<Named<String>> attributes = new ArrayList<>();
    final String key = node.getKey();
    final String testKey = node.getTestKey();

    if (key != null && key.trim().length() > 0) {
      attributes.add(new Named<>("key", key));
    }

    if (testKey != null && testKey.trim().length() > 0) {
      attributes.add(new Named<>("testKey", testKey));
    }

    return attributes;
  }

  @Override
  public void setHighlighted(DebugComponent node, boolean selected) {
    final LithoView lithoView = node.getLithoView();
    if (lithoView == null) {
      return;
    }

    if (!selected) {
      HighlightedOverlay.removeHighlight(lithoView);
      return;
    }

    final DebugLayoutNode layout = node.getLayoutNode();
    final boolean hasNode = layout != null;
    final Rect margin;
    if (!node.isRoot()) {
      margin =
          new Rect(
              hasNode ? (int) layout.getResultMargin(YogaEdge.START) : 0,
              hasNode ? (int) layout.getResultMargin(YogaEdge.TOP) : 0,
              hasNode ? (int) layout.getResultMargin(YogaEdge.END) : 0,
              hasNode ? (int) layout.getResultMargin(YogaEdge.BOTTOM) : 0);
    } else {
      // Margin not applied if you're at the root
      margin = new Rect();
    }

    final Rect padding =
        new Rect(
            hasNode ? (int) layout.getResultPadding(YogaEdge.START) : 0,
            hasNode ? (int) layout.getResultPadding(YogaEdge.TOP) : 0,
            hasNode ? (int) layout.getResultPadding(YogaEdge.END) : 0,
            hasNode ? (int) layout.getResultPadding(YogaEdge.BOTTOM) : 0);

    final Rect contentBounds = node.getBoundsInLithoView();
    HighlightedOverlay.setHighlighted(lithoView, margin, padding, contentBounds);
  }

  @Override
  public void hitTest(DebugComponent node, Touch touch) {
    for (int i = getChildCount(node) - 1; i >= 0; i--) {
      final Object child = getChildAt(node, i);
      if (child instanceof DebugComponent) {
        final DebugComponent componentChild = (DebugComponent) child;
        final Rect bounds = componentChild.getBounds();

        if (touch.containedIn(bounds.left, bounds.top, bounds.right, bounds.bottom)) {
          touch.continueWithOffset(i, bounds.left, bounds.top);
          return;
        }
      } else if (child instanceof View || child instanceof Drawable) {
        // Components can only mount one view or drawable and its bounds are the same as the
        // hosting component.
        touch.continueWithOffset(i, 0, 0);
        return;
      }
    }

    touch.finish();
  }

  @Override
  public String getDecoration(DebugComponent node) throws Exception {
    if (node.getComponent() != null) {
      NodeDescriptor componentDescriptor = descriptorForClass(node.getComponent().getClass());
      if (componentDescriptor.getClass() != ObjectDescriptor.class) {
        return componentDescriptor.getDecoration(node.getComponent());
      }
    }
    return "litho";
  }

  @Override
  public boolean matches(String query, DebugComponent node) throws Exception {
    NodeDescriptor descriptor = descriptorForClass(Object.class);
    return descriptor.matches(query, node);
  }

  private static void applyAccessibilityOverride(
      DebugLayoutNode node, String key, SonarDynamic value) {
    switch (key) {
      case "focusable":
        node.setFocusable(value.asBoolean());
        break;
      case "important-for-accessibility":
        node.setImportantForAccessibility(
            AccessibilityUtil.sImportantForAccessibilityMapping.get(value.asString()));
        break;
      case "content-description":
        node.setContentDescription(value.asString());
        break;
    }
  }

  private static void applyLayoutOverride(DebugLayoutNode node, String[] path, SonarDynamic value) {
    switch (path[0]) {
      case "background":
        node.setBackgroundColor(value.asInt());
        break;
      case "foreground":
        node.setForegroundColor(value.asInt());
        break;
      case "direction":
        node.setLayoutDirection(YogaDirection.valueOf(value.asString().toUpperCase()));
        break;
      case "flex-direction":
        node.setFlexDirection(YogaFlexDirection.valueOf(value.asString().toUpperCase()));
        break;
      case "justify-content":
        node.setJustifyContent(YogaJustify.valueOf(value.asString().toUpperCase()));
        break;
      case "align-items":
        node.setAlignItems(YogaAlign.valueOf(value.asString().toUpperCase()));
        break;
      case "align-self":
        node.setAlignSelf(YogaAlign.valueOf(value.asString().toUpperCase()));
        break;
      case "align-content":
        node.setAlignContent(YogaAlign.valueOf(value.asString().toUpperCase()));
        break;
      case "position-type":
        node.setPositionType(YogaPositionType.valueOf(value.asString().toUpperCase()));
        break;
      case "flex-grow":
        node.setFlexGrow(value.asFloat());
        break;
      case "flex-shrink":
        node.setFlexShrink(value.asFloat());
        break;
      case "flex-basis":
        node.setFlexBasis(YogaValue.parse(value.asString()));
        break;
      case "width":
        node.setWidth(YogaValue.parse(value.asString()));
        break;
      case "min-width":
        node.setMinWidth(YogaValue.parse(value.asString()));
        break;
      case "max-width":
        node.setMaxWidth(YogaValue.parse(value.asString()));
        break;
      case "height":
        node.setHeight(YogaValue.parse(value.asString()));
        break;
      case "min-height":
        node.setMinHeight(YogaValue.parse(value.asString()));
        break;
      case "max-height":
        node.setMaxHeight(YogaValue.parse(value.asString()));
        break;
      case "aspect-ratio":
        node.setAspectRatio(value.asFloat());
        break;
      case "margin":
        node.setMargin(edgeFromString(path[1]), YogaValue.parse(value.asString()));
        break;
      case "padding":
        node.setPadding(edgeFromString(path[1]), YogaValue.parse(value.asString()));
        break;
      case "border":
        node.setBorderWidth(edgeFromString(path[1]), value.asFloat());
        break;
      case "position":
        node.setPosition(edgeFromString(path[1]), YogaValue.parse(value.asString()));
        break;
    }
  }

  private static YogaEdge edgeFromString(String s) {
    return YogaEdge.valueOf(s.toUpperCase());
  }

  private static void applyReflectiveOverride(Object o, String key, SonarDynamic dynamic) {
    try {
      final Field field = o.getClass().getDeclaredField(key);
      field.setAccessible(true);

      final Class type = field.getType();

      Object value = null;
      if (type == int.class || type == Integer.class) {
        value = dynamic.asInt();
      } else if (type == long.class || type == Long.class) {
        value = dynamic.asLong();
      } else if (type == float.class || type == Float.class) {
        value = dynamic.asFloat();
      } else if (type == double.class || type == Double.class) {
        value = dynamic.asDouble();
      } else if (type == boolean.class || type == Boolean.class) {
        value = dynamic.asBoolean();
      } else if (type.isAssignableFrom(String.class)) {
        value = dynamic.asString();
      }

      if (value != null) {
        field.set(o, value);
      }
    } catch (Exception ignored) {
    }
  }

  private static InspectorValue fromDrawable(Drawable d) {
    if (d instanceof ColorDrawable) {
      return InspectorValue.mutable(Color, ((ColorDrawable) d).getColor());
    }
    return InspectorValue.mutable(Color, 0);
  }

  private static <T extends Drawable> InspectorValue fromReference(
      ComponentContext c, Reference<T> r) {
    if (r == null) {
      return fromDrawable(null);
    }

    final T d = Reference.acquire(c, r);
    final InspectorValue v = fromDrawable(d);
    Reference.release(c, d, r);
    return v;
  }

  private static InspectorValue fromFloat(float f) {
    if (Float.isNaN(f)) {
      return InspectorValue.mutable(Enum, "undefined");
    }
    return InspectorValue.mutable(Number, f);
  }

  private static InspectorValue fromYogaValue(YogaValue v) {
    // TODO add support for Type.Dimension or similar
    return InspectorValue.mutable(Enum, v.toString());
  }

  private static InspectorValue fromColor(int color) {
    return InspectorValue.mutable(Color, color);
  }
}
// Copyright 2004-present Facebook. All Rights Reserved.

package com.facebook.litho.sonar;

import com.facebook.litho.DebugComponent;
import com.facebook.litho.LithoView;
import com.facebook.sonar.plugins.inspector.DescriptorMapping;

public final class LithoSonarDescriptors {

  public static void add(DescriptorMapping descriptorMapping) {
    descriptorMapping.register(LithoView.class, new LithoViewDescriptor());
    descriptorMapping.register(DebugComponent.class, new DebugComponentDescriptor());
  }
}
// Copyright 2004-present Facebook. All Rights Reserved.

package com.facebook.litho.sonar;

import android.graphics.Rect;
import android.view.ViewGroup;
import com.facebook.litho.DebugComponent;
import com.facebook.litho.LithoView;
import com.facebook.sonar.core.SonarDynamic;
import com.facebook.sonar.core.SonarObject;
import com.facebook.sonar.plugins.inspector.Named;
import com.facebook.sonar.plugins.inspector.NodeDescriptor;
import com.facebook.sonar.plugins.inspector.Touch;
import java.util.ArrayList;
import java.util.List;

public class LithoViewDescriptor extends NodeDescriptor<LithoView> {

  @Override
  public void init(LithoView node) throws Exception {
    node.setOnDirtyMountListener(
        new LithoView.OnDirtyMountListener() {
          @Override
          public void onDirtyMount(LithoView view) {
            invalidate(view);
          }
        });
  }

  @Override
  public String getId(LithoView node) throws Exception {
    final NodeDescriptor descriptor = descriptorForClass(ViewGroup.class);
    return descriptor.getId(node);
  }

  @Override
  public String getName(LithoView node) throws Exception {
    final NodeDescriptor descriptor = descriptorForClass(ViewGroup.class);
    return descriptor.getName(node);
  }

  @Override
  public int getChildCount(LithoView node) {
    return DebugComponent.getRootInstance(node) == null ? 0 : 1;
  }

  @Override
  public Object getChildAt(LithoView node, int index) {
    return DebugComponent.getRootInstance(node);
  }

  @Override
  public List<Named<SonarObject>> getData(LithoView node) throws Exception {
    final List<Named<SonarObject>> props = new ArrayList<>();
    final NodeDescriptor descriptor = descriptorForClass(ViewGroup.class);
    final Rect mountedBounds = node.getPreviousMountBounds();

    props.add(
        0,
        new Named<>(
            "LithoView",
            new SonarObject.Builder()
                .put(
                    "mountbounds",
                    new SonarObject.Builder()
                        .put("left", mountedBounds.left)
                        .put("top", mountedBounds.top)
                        .put("right", mountedBounds.right)
                        .put("bottom", mountedBounds.bottom))
                .build()));

    props.addAll(descriptor.getData(node));

    return props;
  }

  @Override
  public void setValue(LithoView node, String[] path, SonarDynamic value) throws Exception {
    final NodeDescriptor descriptor = descriptorForClass(ViewGroup.class);
    descriptor.setValue(node, path, value);
  }

  @Override
  public List<Named<String>> getAttributes(LithoView node) throws Exception {
    final NodeDescriptor descriptor = descriptorForClass(ViewGroup.class);
    return descriptor.getAttributes(node);
  }

  @Override
  public void setHighlighted(LithoView node, boolean selected) throws Exception {
    final NodeDescriptor descriptor = descriptorForClass(ViewGroup.class);
    descriptor.setHighlighted(node, selected);
  }

  @Override
  public void hitTest(LithoView node, Touch touch) {
    touch.continueWithOffset(0, 0, 0);
  }

  @Override
  public String getDecoration(LithoView node) throws Exception {
    final NodeDescriptor descriptor = descriptorForClass(ViewGroup.class);
    return descriptor.getDecoration(node);
  }

  @Override
  public boolean matches(String query, LithoView node) throws Exception {
    NodeDescriptor descriptor = descriptorForClass(Object.class);
    return descriptor.matches(query, node);
  }
}
// Copyright 2004-present Facebook. All Rights Reserved.

package com.facebook.litho.sonar;

public interface PropWithDescription {

  Object getSonarLayoutInspectorPropDescription();
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

package com.facebook.sonar.plugins.network;

import java.util.ArrayList;
import java.util.List;

public interface NetworkReporter {
  void reportRequest(RequestInfo requestInfo);

  void reportResponse(ResponseInfo responseInfo);

  public class Header {
    public final String name;
    public final String value;

    public Header(final String name, final String value) {
      this.name = name;
      this.value = value;
    }

    @Override
    public String toString() {
      return "Header{" + name + ": " + value + "}";
    }
  }

  public class RequestInfo {
    public String requestId;
    public long timeStamp;
    public List<Header> headers = new ArrayList<>();
    public String method;
    public String uri;
    public byte[] body;

    public Header getFirstHeader(final String name) {
      for (Header header : headers) {
        if (name.equalsIgnoreCase(header.name)) {
          return header;
        }
      }
      return null;
    }
  }

  public class ResponseInfo {
    public String requestId;
    public long timeStamp;
    public int statusCode;
    public String statusReason;
    public List<Header> headers = new ArrayList<>();
    public byte[] body;

    public Header getFirstHeader(final String name) {
      for (Header header : headers) {
        if (name.equalsIgnoreCase(header.name)) {
          return header;
        }
      }
      return null;
    }
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

package com.facebook.sonar.plugins.network;

import com.facebook.sonar.plugins.network.NetworkReporter.ResponseInfo;

public interface NetworkResponseFormatter {

  interface OnCompletionListener {
    void onCompletion(String json);
  }

  boolean shouldFormat(ResponseInfo response);

  void format(ResponseInfo response, OnCompletionListener onCompletionListener);
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

package com.facebook.sonar.plugins.network;

import android.util.Base64;
import com.facebook.sonar.core.ErrorReportingRunnable;
import com.facebook.sonar.core.SonarArray;
import com.facebook.sonar.core.SonarObject;
import com.facebook.sonar.plugins.common.BufferingSonarPlugin;
import java.util.List;

public class NetworkSonarPlugin extends BufferingSonarPlugin implements NetworkReporter {
  public static final String ID = "Network";

  private final List<NetworkResponseFormatter> mFormatters;

  public NetworkSonarPlugin() {
    this(null);
  }

  public NetworkSonarPlugin(List<NetworkResponseFormatter> formatters) {
    this.mFormatters = formatters;
  }

  @Override
  public String getId() {
    return ID;
  }

  @Override
  public void reportRequest(RequestInfo requestInfo) {
    final SonarObject request =
        new SonarObject.Builder()
            .put("id", requestInfo.requestId)
            .put("timestamp", requestInfo.timeStamp)
            .put("method", requestInfo.method)
            .put("url", requestInfo.uri)
            .put("headers", toSonarObject(requestInfo.headers))
            .put("data", toBase64(requestInfo.body))
            .build();

    send("newRequest", request);
  }

  @Override
  public void reportResponse(final ResponseInfo responseInfo) {
    final Runnable job =
        new ErrorReportingRunnable(getConnection()) {
          @Override
          protected void runOrThrow() throws Exception {
            if (shouldStripResponseBody(responseInfo)) {
              responseInfo.body = null;
            }

            final SonarObject response =
                new SonarObject.Builder()
                    .put("id", responseInfo.requestId)
                    .put("timestamp", responseInfo.timeStamp)
                    .put("status", responseInfo.statusCode)
                    .put("reason", responseInfo.statusReason)
                    .put("headers", toSonarObject(responseInfo.headers))
                    .put("data", toBase64(responseInfo.body))
                    .build();

            send("newResponse", response);
          }
        };

    if (mFormatters != null) {
      for (NetworkResponseFormatter formatter : mFormatters) {
        if (formatter.shouldFormat(responseInfo)) {
          formatter.format(
              responseInfo,
              new NetworkResponseFormatter.OnCompletionListener() {
                @Override
                public void onCompletion(final String json) {
                  responseInfo.body = json.getBytes();
                  job.run();
                }
              });
          return;
        }
      }
    }

    job.run();
  }

  private String toBase64(byte[] bytes) {
    if (bytes == null) {
      return null;
    }
    return new String(Base64.encode(bytes, Base64.DEFAULT));
  }

  private SonarArray toSonarObject(List<Header> headers) {
    final SonarArray.Builder list = new SonarArray.Builder();

    for (Header header : headers) {
      list.put(new SonarObject.Builder().put("key", header.name).put("value", header.value));
    }

    return list.build();
  }

  private static boolean shouldStripResponseBody(ResponseInfo responseInfo) {
    final Header contentType = responseInfo.getFirstHeader("content-type");
    if (contentType == null) {
      return false;
    }

    return contentType.value.contains("image/")
        || contentType.value.contains("video/")
        || contentType.value.contains("application/zip");
  }
}
// Copyright 2004-present Facebook. All Rights Reserved.
package com.facebook.sonar.plugins.network;

import android.util.Log;
import com.facebook.sonar.plugins.network.NetworkReporter.RequestInfo;
import com.facebook.sonar.plugins.network.NetworkReporter.ResponseInfo;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;
import java.util.Random;
import java.util.Set;
import javax.annotation.Nullable;
import okhttp3.Headers;
import okhttp3.Interceptor;
import okhttp3.Request;
import okhttp3.Response;
import okhttp3.ResponseBody;
import okio.Buffer;

public class SonarOkhttpInterceptor implements Interceptor {

  public @Nullable NetworkSonarPlugin plugin;

  public SonarOkhttpInterceptor() {
    this.plugin = null;
  }

  public SonarOkhttpInterceptor(NetworkSonarPlugin plugin) {
    this.plugin = plugin;
  }

  @Override
  public Response intercept(Interceptor.Chain chain) throws IOException {
    Request request = chain.request();
    int randInt = randInt(1, Integer.MAX_VALUE);
    plugin.reportRequest(convertRequest(request, randInt));
    Response response = chain.proceed(request);
    ResponseBody body = response.body();
    ResponseInfo responseInfo = convertResponse(response, body, randInt);
    plugin.reportResponse(responseInfo);
    // Creating new response as can't used response.body() more than once
    return response
        .newBuilder()
        .body(ResponseBody.create(body.contentType(), responseInfo.body))
        .build();
  }

  private static byte[] bodyToByteArray(final Request request) {

    try {
      final Request copy = request.newBuilder().build();
      final Buffer buffer = new Buffer();
      copy.body().writeTo(buffer);
      return buffer.readByteArray();
    } catch (final IOException e) {
      return e.getMessage().getBytes();
    }
  }

  private RequestInfo convertRequest(Request request, int identifier) {
    List<NetworkReporter.Header> headers = convertHeader(request.headers());
    RequestInfo info = new RequestInfo();
    info.requestId = String.valueOf(identifier);
    info.timeStamp = System.currentTimeMillis();
    info.headers = headers;
    info.method = request.method();
    info.uri = request.url().toString();
    if (request.body() != null) {
      info.body = bodyToByteArray(request);
    }

    return info;
  }

  private ResponseInfo convertResponse(Response response, ResponseBody body, int identifier) {

    List<NetworkReporter.Header> headers = convertHeader(response.headers());
    ResponseInfo info = new ResponseInfo();
    info.requestId = String.valueOf(identifier);
    info.timeStamp = response.receivedResponseAtMillis();
    info.statusCode = response.code();
    info.headers = headers;
    try {
      info.body = body.bytes();
    } catch (IOException e) {
      Log.e("Sonar", e.toString());
    }
    return info;
  }

  private List<NetworkReporter.Header> convertHeader(Headers headers) {
    List<NetworkReporter.Header> list = new ArrayList<>();

    Set<String> keys = headers.names();
    for (String key : keys) {
      list.add(new NetworkReporter.Header(key, headers.get(key)));
    }
    return list;
  }

  private int randInt(int min, int max) {
    Random rand = new Random();
    int randomNum = rand.nextInt((max - min) + 1) + min;
    return randomNum;
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

package com.facebook.sonar.plugins.sharedpreferences;

import static android.content.Context.MODE_PRIVATE;

import android.content.Context;
import android.content.SharedPreferences;
import com.facebook.sonar.core.SonarConnection;
import com.facebook.sonar.core.SonarObject;
import com.facebook.sonar.core.SonarPlugin;
import com.facebook.sonar.core.SonarReceiver;
import com.facebook.sonar.core.SonarResponder;
import java.util.Map;

public class SharedPreferencesSonarPlugin implements SonarPlugin {

  private SonarConnection mConnection;
  private final SharedPreferences mSharedPreferences;

  public SharedPreferencesSonarPlugin(Context context) {
    mSharedPreferences = context.getSharedPreferences(context.getPackageName(), MODE_PRIVATE);

    mSharedPreferences.registerOnSharedPreferenceChangeListener(
        new SharedPreferences.OnSharedPreferenceChangeListener() {
          @Override
          public void onSharedPreferenceChanged(SharedPreferences sharedPreferences, String key) {
            if (mConnection != null) {
              mConnection.send(
                  "sharedPreferencesChange",
                  new SonarObject.Builder()
                      .put("name", key)
                      .put("deleted", !mSharedPreferences.contains(key))
                      .put("time", System.currentTimeMillis())
                      .put("value", mSharedPreferences.getAll().get(key))
                      .build());
            }
          }
        });
  }

  @Override
  public String getId() {
    return "Preferences";
  }

  private SonarObject getSharedPreferencesObject() {
    final SonarObject.Builder builder = new SonarObject.Builder();
    final Map<String, ?> map = mSharedPreferences.getAll();

    for (Map.Entry<String, ?> entry : map.entrySet()) {
      final Object val = entry.getValue();
      builder.put(entry.getKey(), val);
    }

    return builder.build();
  }

  @Override
  public void onConnect(SonarConnection connection) {
    mConnection = connection;

    connection.receive(
        "getSharedPreferences",
        new SonarReceiver() {
          @Override
          public void onReceive(SonarObject params, SonarResponder responder) {
            responder.success(getSharedPreferencesObject());
          }
        });

    connection.receive(
        "setSharedPreference",
        new SonarReceiver() {
          @Override
          public void onReceive(SonarObject params, SonarResponder responder)
              throws IllegalArgumentException {

            String preferenceName = params.getString("preferenceName");
            Object originalValue = mSharedPreferences.getAll().get(preferenceName);
            SharedPreferences.Editor editor = mSharedPreferences.edit();

            if (originalValue instanceof Boolean) {
              editor.putBoolean(preferenceName, params.getBoolean("preferenceValue"));
            } else if (originalValue instanceof Long) {
              editor.putLong(preferenceName, params.getLong("preferenceValue"));
            } else if (originalValue instanceof Integer) {
              editor.putInt(preferenceName, params.getInt("preferenceValue"));
            } else if (originalValue instanceof Float) {
              editor.putFloat(preferenceName, params.getFloat("preferenceValue"));
            } else if (originalValue instanceof String) {
              editor.putString(preferenceName, params.getString("preferenceValue"));
            } else {
              throw new IllegalArgumentException("Type not supported: " + preferenceName);
            }

            editor.apply();

            responder.success(getSharedPreferencesObject());
          }
        });
  }

  @Override
  public void onDisconnect() {
    mConnection = null;
  }
}
// Copyright 2004-present Facebook. All Rights Reserved.

package com.facebook.sonar.sample;

import android.os.Bundle;
import android.support.v7.app.AppCompatActivity;
import com.facebook.litho.ComponentContext;
import com.facebook.litho.LithoView;

public class MainActivity extends AppCompatActivity {

  @Override
  protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);

    final ComponentContext c = new ComponentContext(this);
    setContentView(
        LithoView.create(
            c,
            RootComponent.create(c).build()));
  }
}
// Copyright 2004-present Facebook. All Rights Reserved.

package com.facebook.sonar.sample;

import com.facebook.litho.Column;
import com.facebook.litho.Component;
import com.facebook.litho.ComponentContext;
import com.facebook.litho.annotations.LayoutSpec;
import com.facebook.litho.annotations.OnCreateLayout;
import com.facebook.litho.widget.Text;
import okhttp3.Request;
import okhttp3.Response;
import okhttp3.RequestBody;
import okhttp3.FormBody;
import okhttp3.FormBody.Builder;
import okhttp3.OkHttpClient;
import okhttp3.Call;
import okhttp3.Callback;
import com.facebook.litho.ClickEvent;
import android.util.Log;
import java.io.IOException;
import com.facebook.litho.annotations.OnEvent;

@LayoutSpec
public class RootComponentSpec {

  @OnCreateLayout
  static Component onCreateLayout(ComponentContext c) {
    return Column.create(c)
        .child(
            Text.create(c)
                .text("Tap to hit get request")
                .key("1")
                .textSizeSp(20)
                .clickHandler(RootComponent.hitGetRequest(c)))
        .child(
            Text.create(c)
                .text("Tap to hit post request")
                .key("2")
                .textSizeSp(20)
                .clickHandler(RootComponent.hitPostRequest(c)))
        .child(
            Text.create(c)
                .text("I m just a text")
                .key("3")
                .textSizeSp(20))
        .build();
  }

@OnEvent(ClickEvent.class)
  static void hitGetRequest(ComponentContext c) {

        Request request = new Request.Builder()
            .url("https://api.github.com/repos/facebook/yoga")
            .get()
            .build();
       SonarSampleApplication.okhttpClient.newCall(request).enqueue(new Callback() {
           @Override
           public void onFailure(Call call, IOException e) {
               e.printStackTrace();
               Log.d("Sonar", e.getMessage());
           }

           @Override
           public void onResponse(Call call, Response response) throws IOException {
               if (response.isSuccessful()) {
                   Log.d("Sonar", response.body().string());
               } else {
               Log.d("Sonar", "not successful");
           }
       }
   });
  }

  @OnEvent(ClickEvent.class)
  static void hitPostRequest(ComponentContext c) {

      RequestBody formBody = new FormBody.Builder()
              .add("app", "Sonar")
              .add("remarks", "Its awesome")
              .build();

        Request request = new Request.Builder()
            .url("https://demo9512366.mockable.io/SonarPost")
            .post(formBody)
            .build();

       SonarSampleApplication.okhttpClient.newCall(request).enqueue(new Callback() {
           @Override
           public void onFailure(Call call, IOException e) {
               e.printStackTrace();
               Log.d("Sonar", e.getMessage());
           }

           @Override
           public void onResponse(Call call, Response response) throws IOException {
               if (response.isSuccessful()) {
                   Log.d("Sonar", response.body().string());
               } else {
               Log.d("Sonar", "not successful");
               }
           }
   });
  }
}
// Copyright 2004-present Facebook. All Rights Reserved.

package com.facebook.sonar.sample;

import android.app.Application;
import android.net.Network;
import android.support.annotation.Nullable;
import java.util.ArrayList;
import java.util.List;
import com.facebook.litho.sonar.LithoSonarDescriptors;
import com.facebook.soloader.SoLoader;
import com.facebook.sonar.android.utils.SonarUtils;
import com.facebook.sonar.android.AndroidSonarClient;
import com.facebook.sonar.core.SonarClient;
import com.facebook.sonar.plugins.inspector.DescriptorMapping;
import com.facebook.sonar.plugins.inspector.InspectorSonarPlugin;
import com.facebook.sonar.plugins.network.NetworkSonarPlugin;
import com.facebook.sonar.plugins.network.SonarOkhttpInterceptor;
import com.facebook.sonar.plugins.network.NetworkResponseFormatter;
import okhttp3.OkHttpClient;
import java.util.concurrent.TimeUnit;

public class SonarSampleApplication extends Application {

  static public OkHttpClient okhttpClient;

  @Override
  public void onCreate() {
    super.onCreate();
    SoLoader.init(this, false);

    final SonarClient client = AndroidSonarClient.getInstance(this);
    final DescriptorMapping descriptorMapping = DescriptorMapping.withDefaults();

    NetworkSonarPlugin networkPlugin = new NetworkSonarPlugin();
    SonarOkhttpInterceptor interceptor = new SonarOkhttpInterceptor(networkPlugin);

    okhttpClient = new OkHttpClient.Builder()
    .addNetworkInterceptor(interceptor)
    .connectTimeout(60, TimeUnit.SECONDS)
    .readTimeout(60, TimeUnit.SECONDS)
    .writeTimeout(10, TimeUnit.MINUTES)
    .build();

    LithoSonarDescriptors.add(descriptorMapping);
    client.addPlugin(new InspectorSonarPlugin(this, descriptorMapping));
    client.addPlugin(networkPlugin);
    client.start();
}
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.sonar.testing;

import com.facebook.sonar.core.SonarArray;
import com.facebook.sonar.core.SonarConnection;
import com.facebook.sonar.core.SonarObject;
import com.facebook.sonar.core.SonarReceiver;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

public class SonarConnectionMock implements SonarConnection {
  public final Map<String, SonarReceiver> receivers = new HashMap<>();
  public final Map<String, List<Object>> sent = new HashMap<>();

  @Override
  public void send(String method, SonarObject params) {
    final List<Object> paramList;
    if (sent.containsKey(method)) {
      paramList = sent.get(method);
    } else {
      paramList = new ArrayList<>();
      sent.put(method, paramList);
    }

    paramList.add(params);
  }

  @Override
  public void send(String method, SonarArray params) {
    final List<Object> paramList;
    if (sent.containsKey(method)) {
      paramList = sent.get(method);
    } else {
      paramList = new ArrayList<>();
      sent.put(method, paramList);
    }

    paramList.add(params);
  }

  @Override
  public void reportError(Throwable throwable) {}

  @Override
  public void receive(String method, SonarReceiver receiver) {
    receivers.put(method, receiver);
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.sonar.testing;

import com.facebook.sonar.core.SonarArray;
import com.facebook.sonar.core.SonarObject;
import com.facebook.sonar.core.SonarResponder;
import java.util.LinkedList;
import java.util.List;

public class SonarResponderMock implements SonarResponder {
  public final List<Object> successes = new LinkedList<>();
  public final List<SonarObject> errors = new LinkedList<>();

  @Override
  public void success(SonarObject response) {
    successes.add(response);
  }

  @Override
  public void success(SonarArray response) {
    successes.add(response);
  }

  @Override
  public void success() {
    successes.add(new SonarObject.Builder().build());
  }

  @Override
  public void error(SonarObject response) {
    errors.add(response);
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.sonar.plugins.console;

import static org.hamcrest.CoreMatchers.hasItem;
import static org.hamcrest.MatcherAssert.assertThat;

import com.facebook.sonar.core.SonarObject;
import com.facebook.sonar.testing.SonarConnectionMock;
import com.facebook.sonar.testing.SonarResponderMock;
import com.facebook.testing.robolectric.v3.WithTestDefaultsRunner;
import org.junit.Before;
import org.junit.Test;
import org.junit.runner.RunWith;

@RunWith(WithTestDefaultsRunner.class)
public class ConsoleSonarPluginTest {

  SonarConnectionMock connection;
  SonarResponderMock responder;

  @Before
  public void setup() throws Exception {
    JavascriptEnvironment jsEnvironment = new JavascriptEnvironment();
    final ConsoleSonarPlugin plugin = new ConsoleSonarPlugin(jsEnvironment);
    connection = new SonarConnectionMock();
    responder = new SonarResponderMock();
    plugin.onConnect(connection);
  }

  @Test
  public void simpleExpressionShouldEvaluateCorrectly() throws Exception {

    receiveScript("2 + 2");
    assertThat(
        responder.successes,
        hasItem(new SonarObject.Builder().put("value", 4).put("type", "json").build()));
  }

  private void receiveScript(String a) throws Exception {
    SonarObject getValue = new SonarObject.Builder().put("command", a).build();
    connection.receivers.get("executeCommand").onReceive(getValue, responder);
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.sonar.plugins.console;

import static org.junit.Assert.assertEquals;

import com.facebook.testing.robolectric.v3.WithTestDefaultsRunner;
import com.google.common.collect.ImmutableMap;
import java.util.Collections;
import java.util.HashMap;
import org.json.JSONObject;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.mozilla.javascript.ContextFactory;

@RunWith(WithTestDefaultsRunner.class)
public class JavascriptSessionTest {

  ContextFactory mContextFactory = new ContextFactory();

  @Test
  public void testSimpleExpressionsEvaluate() throws Exception {
    JavascriptSession session =
        new JavascriptSession(mContextFactory, Collections.<String, Object>emptyMap());
    JSONObject json = session.evaluateCommand("2+2-1");
    assertEquals(3, json.getInt("value"));
  }

  @Test
  public void testStatePersistsBetweenCommands() throws Exception {
    JavascriptSession session =
        new JavascriptSession(mContextFactory, Collections.<String, Object>emptyMap());
    session.evaluateCommand("var x = 10;");
    JSONObject json = session.evaluateCommand("x");
    assertEquals(10, json.getInt("value"));
  }

  @Test
  public void testVariablesGetBoundCorrectly() throws Exception {
    JavascriptSession session =
        new JavascriptSession(
            mContextFactory,
            ImmutableMap.<String, Object>of(
                "a", 2,
                "b", 2));
    JSONObject json = session.evaluateCommand("a+b");
    assertEquals("json", json.getString("type"));
    assertEquals(4, json.getInt("value"));
  }

  @Test
  public void testNumberEvaluation() throws Exception {
    assertEquals(4, evaluateWithNoGlobals("4").getInt("value"));
  }

  @Test
  public void testStringEvaluation() throws Exception {
    assertEquals("hello", evaluateWithNoGlobals("\"hello\"").getString("value"));
  }

  @Test
  public void testJavaObjectEvaluation() throws Exception {
    JavascriptSession session =
        new JavascriptSession(
            mContextFactory,
            ImmutableMap.<String, Object>of("object", new HashMap<String, String>()));
    JSONObject json = session.evaluateCommand("object");
    assertEquals("javaObject", json.getString("type"));
    assertEquals("{}", json.getJSONObject("value").getString("toString"));
  }

  @Test
  public void testJavaMethodEvaluation() throws Exception {
    JavascriptSession session =
        new JavascriptSession(
            mContextFactory,
            ImmutableMap.<String, Object>of("object", new HashMap<String, String>()));
    JSONObject json = session.evaluateCommand("object.get");
    assertEquals("method", json.getString("type"));
  }

  @Test
  public void testJsFunctionEvaluation() throws Exception {
    JSONObject json = evaluateWithNoGlobals("function() {}");
    assertEquals("function", json.getString("type"));
    assertEquals("function(){}", removeWhitespace(json.getString("value")));
  }

  @Test
  public void testNullEvaluation() throws Exception {
    assertEquals("null", evaluateWithNoGlobals("null").getString("type"));
    assertEquals("null", evaluateWithNoGlobals("undefined").getString("type"));
  }

  private static String removeWhitespace(String input) {
    return input.replaceAll("\\s", "");
  }

  private JSONObject evaluateWithNoGlobals(String input) throws Exception {
    JavascriptSession session =
        new JavascriptSession(mContextFactory, new HashMap<String, Object>());
    return session.evaluateCommand(input);
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.sonar.plugins.inspector;

import static org.hamcrest.CoreMatchers.equalTo;
import static org.hamcrest.MatcherAssert.assertThat;

import android.app.Activity;
import android.app.Application;
import android.app.Application.ActivityLifecycleCallbacks;
import android.os.Bundle;
import com.facebook.testing.robolectric.v3.WithTestDefaultsRunner;
import org.junit.Before;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.mockito.Mockito;
import org.mockito.invocation.InvocationOnMock;
import org.mockito.stubbing.Answer;

@RunWith(WithTestDefaultsRunner.class)
public class ApplicationWrapperTest {

  private ApplicationWrapper mWrapper;
  private ActivityLifecycleCallbacks mCallbacks;

  @Before
  public void setup() {
    final Application app = Mockito.mock(Application.class);
    Mockito.doAnswer(
            new Answer() {
              @Override
              public Object answer(InvocationOnMock invocation) throws Throwable {
                mCallbacks = (ActivityLifecycleCallbacks) invocation.getArguments()[0];
                return null;
              }
            })
        .when(app)
        .registerActivityLifecycleCallbacks(Mockito.any(ActivityLifecycleCallbacks.class));

    mWrapper = new ApplicationWrapper(app);
  }

  @Test
  public void testActivityCreated() {
    final Activity activity1 = Mockito.mock(Activity.class);
    mCallbacks.onActivityCreated(activity1, Mockito.mock(Bundle.class));

    final Activity activity2 = Mockito.mock(Activity.class);
    mCallbacks.onActivityCreated(activity2, Mockito.mock(Bundle.class));

    assertThat(mWrapper.getActivityStack().size(), equalTo(2));
    assertThat(mWrapper.getActivityStack().get(0), equalTo(activity1));
    assertThat(mWrapper.getActivityStack().get(1), equalTo(activity2));
  }

  @Test
  public void testActivityPaused() {
    final Activity activity1 = Mockito.mock(Activity.class);
    mCallbacks.onActivityCreated(activity1, Mockito.mock(Bundle.class));

    final Activity activity2 = Mockito.mock(Activity.class);
    mCallbacks.onActivityCreated(activity2, Mockito.mock(Bundle.class));

    mCallbacks.onActivityPaused(activity2);

    assertThat(mWrapper.getActivityStack().size(), equalTo(2));
    assertThat(mWrapper.getActivityStack().get(0), equalTo(activity1));
    assertThat(mWrapper.getActivityStack().get(1), equalTo(activity2));
  }

  @Test
  public void testFinishingActivityPaused() {
    final Activity activity1 = Mockito.mock(Activity.class);
    mCallbacks.onActivityCreated(activity1, Mockito.mock(Bundle.class));

    final Activity activity2 = Mockito.mock(Activity.class);
    mCallbacks.onActivityCreated(activity2, Mockito.mock(Bundle.class));

    Mockito.when(activity2.isFinishing()).thenReturn(true);
    mCallbacks.onActivityPaused(activity2);

    assertThat(mWrapper.getActivityStack().size(), equalTo(1));
    assertThat(mWrapper.getActivityStack().get(0), equalTo(activity1));
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.sonar.plugins.inspector;

import static org.hamcrest.CoreMatchers.equalTo;
import static org.hamcrest.MatcherAssert.assertThat;

import com.facebook.sonar.core.SonarConnection;
import com.facebook.sonar.core.SonarDynamic;
import com.facebook.sonar.core.SonarObject;
import com.facebook.sonar.testing.SonarConnectionMock;
import com.facebook.testing.robolectric.v3.WithTestDefaultsRunner;
import java.util.List;
import org.junit.Test;
import org.junit.runner.RunWith;

@RunWith(WithTestDefaultsRunner.class)
public class DescriptorMappingTest {

  private class TestClass {}

  private class TestSubClass extends TestClass {}

  private class TestDescriptor<T> extends NodeDescriptor<T> {
    @Override
    public void init(T node) {}

    @Override
    public String getId(T node) {
      return null;
    }

    @Override
    public String getName(T node) {
      return null;
    }

    @Override
    public int getChildCount(T node) {
      return 0;
    }

    @Override
    public T getChildAt(T node, int index) {
      return null;
    }

    @Override
    public List<Named<SonarObject>> getData(T node) {
      return null;
    }

    @Override
    public void setValue(T node, String[] path, SonarDynamic value) throws Exception {}

    @Override
    public List<Named<String>> getAttributes(T node) {
      return null;
    }

    @Override
    public void setHighlighted(T node, boolean selected) {}

    @Override
    public void hitTest(T node, Touch touch) {}

    @Override
    public String getDecoration(T obj) {
      return null;
    }

    @Override
    public boolean matches(String query, T obj) {
      return false;
    }
  }

  @Test
  public void testDescriptorForRegisteredClass() {
    final DescriptorMapping descriptorMapping = new DescriptorMapping();
    final NodeDescriptor descriptor1 = new TestDescriptor<>();
    final NodeDescriptor descriptor2 = new TestDescriptor<>();

    descriptorMapping.register(TestClass.class, descriptor1);
    descriptorMapping.register(TestSubClass.class, descriptor2);

    assertThat(descriptorMapping.descriptorForClass(TestSubClass.class), equalTo(descriptor2));
  }

  @Test
  public void testDescriptorForRegisteredSuperClass() {
    final DescriptorMapping descriptorMapping = new DescriptorMapping();
    final NodeDescriptor descriptor = new TestDescriptor<>();

    descriptorMapping.register(TestClass.class, descriptor);

    assertThat(descriptorMapping.descriptorForClass(TestSubClass.class), equalTo(descriptor));
  }

  @Test
  public void testOnConnect() {
    final DescriptorMapping descriptorMapping = new DescriptorMapping();
    final NodeDescriptor descriptor = new TestDescriptor<>();
    descriptorMapping.register(TestClass.class, descriptor);

    final SonarConnection connection = new SonarConnectionMock();
    descriptorMapping.onConnect(connection);

    assertThat(descriptor.connected(), equalTo(true));
  }

  @Test
  public void testOnDisconnect() {
    final DescriptorMapping descriptorMapping = new DescriptorMapping();
    final NodeDescriptor descriptor = new TestDescriptor<>();
    descriptorMapping.register(TestClass.class, descriptor);

    final SonarConnection connection = new SonarConnectionMock();
    descriptorMapping.onConnect(connection);
    descriptorMapping.onDisconnect();

    assertThat(descriptor.connected(), equalTo(false));
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.sonar.plugins.inspector;

import static org.hamcrest.CoreMatchers.equalTo;
import static org.hamcrest.CoreMatchers.hasItem;
import static org.hamcrest.MatcherAssert.assertThat;

import android.app.Application;
import android.graphics.Rect;
import android.view.View;
import android.view.ViewGroup;
import android.widget.FrameLayout;
import com.facebook.sonar.core.SonarArray;
import com.facebook.sonar.core.SonarConnection;
import com.facebook.sonar.core.SonarDynamic;
import com.facebook.sonar.core.SonarObject;
import com.facebook.sonar.plugins.console.iface.NullScriptingEnvironment;
import com.facebook.sonar.plugins.console.iface.ScriptingEnvironment;
import com.facebook.sonar.plugins.inspector.InspectorSonarPlugin.TouchOverlayView;
import com.facebook.sonar.plugins.inspector.descriptors.ApplicationDescriptor;
import com.facebook.sonar.testing.SonarConnectionMock;
import com.facebook.sonar.testing.SonarResponderMock;
import com.facebook.testing.robolectric.v3.WithTestDefaultsRunner;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collections;
import java.util.List;
import org.junit.Before;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.mockito.Mockito;
import org.robolectric.RuntimeEnvironment;

@RunWith(WithTestDefaultsRunner.class)
public class InspectorSonarPluginTest {

  private MockApplicationDescriptor mApplicationDescriptor;
  private DescriptorMapping mDescriptorMapping;
  private ApplicationWrapper mApp;
  private ScriptingEnvironment mScriptingEnvironment;

  @Before
  public void setup() {
    final Application app = Mockito.spy(RuntimeEnvironment.application);
    Mockito.when(app.getApplicationContext()).thenReturn(app);
    Mockito.when(app.getPackageName()).thenReturn("com.facebook.sonar");

    mDescriptorMapping = new DescriptorMapping();
    mApplicationDescriptor = new MockApplicationDescriptor();
    mDescriptorMapping.register(ApplicationWrapper.class, mApplicationDescriptor);
    mDescriptorMapping.register(TestNode.class, new TestNodeDescriptor());
    mScriptingEnvironment = new NullScriptingEnvironment();
    mApp = Mockito.spy(new ApplicationWrapper(app));
  }

  @Test
  public void testOnConnect() throws Exception {
    final InspectorSonarPlugin plugin =
        new InspectorSonarPlugin(mApp, mDescriptorMapping, mScriptingEnvironment);
    final SonarConnection connection = new SonarConnectionMock();

    plugin.onConnect(connection);
    assertThat(mApplicationDescriptor.connected(), equalTo(true));
  }

  @Test
  public void testOnDisconnect() throws Exception {
    final InspectorSonarPlugin plugin =
        new InspectorSonarPlugin(mApp, mDescriptorMapping, mScriptingEnvironment);
    final SonarConnection connection = new SonarConnectionMock();

    plugin.onConnect(connection);
    plugin.onDisconnect();
    assertThat(mApplicationDescriptor.connected(), equalTo(false));
  }

  @Test
  public void testGetRoot() throws Exception {
    final InspectorSonarPlugin plugin =
        new InspectorSonarPlugin(mApp, mDescriptorMapping, mScriptingEnvironment);
    final SonarResponderMock responder = new SonarResponderMock();
    final SonarConnectionMock connection = new SonarConnectionMock();
    plugin.onConnect(connection);

    final TestNode root = new TestNode();
    root.id = "test";
    mApplicationDescriptor.root = root;
    plugin.mGetRoot.onReceive(null, responder);

    assertThat(
        responder.successes,
        hasItem(
            new SonarObject.Builder()
                .put("id", "com.facebook.sonar")
                .put("name", "com.facebook.sonar")
                .put("data", new SonarObject.Builder())
                .put("children", new SonarArray.Builder().put("test"))
                .put("attributes", new SonarArray.Builder())
                .put("decoration", (String) null)
                .build()));
  }

  @Test
  public void testGetNodes() throws Exception {
    final InspectorSonarPlugin plugin =
        new InspectorSonarPlugin(mApp, mDescriptorMapping, mScriptingEnvironment);
    final SonarResponderMock responder = new SonarResponderMock();
    final SonarConnectionMock connection = new SonarConnectionMock();
    plugin.onConnect(connection);

    final TestNode root = new TestNode();
    root.id = "test";
    root.name = "test";
    mApplicationDescriptor.root = root;

    plugin.mGetRoot.onReceive(null, responder);
    plugin.mGetNodes.onReceive(
        new SonarObject.Builder().put("ids", new SonarArray.Builder().put("test")).build(),
        responder);

    assertThat(
        responder.successes,
        hasItem(
            new SonarObject.Builder()
                .put(
                    "elements",
                    new SonarArray.Builder()
                        .put(
                            new SonarObject.Builder()
                                .put("id", "test")
                                .put("name", "test")
                                .put("data", new SonarObject.Builder())
                                .put("children", new SonarArray.Builder())
                                .put("attributes", new SonarArray.Builder())
                                .put("decoration", (String) null)))
                .build()));
  }

  @Test
  public void testGetNodesThatDontExist() throws Exception {
    final InspectorSonarPlugin plugin =
        new InspectorSonarPlugin(mApp, mDescriptorMapping, mScriptingEnvironment);
    final SonarResponderMock responder = new SonarResponderMock();
    final SonarConnectionMock connection = new SonarConnectionMock();
    plugin.onConnect(connection);

    final TestNode root = new TestNode();
    root.id = "test";
    mApplicationDescriptor.root = root;

    plugin.mGetRoot.onReceive(null, responder);
    plugin.mGetNodes.onReceive(
        new SonarObject.Builder().put("ids", new SonarArray.Builder().put("notest")).build(),
        responder);

    assertThat(
        responder.errors,
        hasItem(
            new SonarObject.Builder()
                .put("message", "No node with given id")
                .put("id", "notest")
                .build()));
  }

  @Test
  public void testSetData() throws Exception {
    final InspectorSonarPlugin plugin =
        new InspectorSonarPlugin(mApp, mDescriptorMapping, mScriptingEnvironment);
    final SonarConnectionMock connection = new SonarConnectionMock();
    final SonarResponderMock responder = new SonarResponderMock();
    plugin.onConnect(connection);

    final TestNode root = new TestNode();
    root.id = "test";
    root.data = new SonarObject.Builder().put("prop", "value").build();

    mApplicationDescriptor.root = root;

    plugin.mGetRoot.onReceive(null, responder);
    plugin.mSetData.onReceive(
        new SonarObject.Builder()
            .put("id", "test")
            .put("path", new SonarArray.Builder().put("data"))
            .put("value", new SonarObject.Builder().put("prop", "updated_value"))
            .build(),
        responder);

    assertThat(root.data.getString("prop"), equalTo("updated_value"));
    assertThat(
        connection.sent.get("invalidate"),
        hasItem(
            new SonarObject.Builder()
                .put(
                    "nodes",
                    new SonarArray.Builder()
                        .put(new SonarObject.Builder().put("id", "test").build())
                        .build())
                .build()));
  }

  @Test
  public void testSetHighlighted() throws Exception {
    final InspectorSonarPlugin plugin =
        new InspectorSonarPlugin(mApp, mDescriptorMapping, mScriptingEnvironment);
    final SonarConnectionMock connection = new SonarConnectionMock();
    final SonarResponderMock responder = new SonarResponderMock();
    plugin.onConnect(connection);

    final TestNode root = new TestNode();
    root.id = "test";
    mApplicationDescriptor.root = root;

    plugin.mGetRoot.onReceive(null, responder);
    plugin.mSetHighlighted.onReceive(
        new SonarObject.Builder().put("id", "com.facebook.sonar").build(), responder);

    assertThat(mApplicationDescriptor.highlighted, equalTo(true));

    plugin.mSetHighlighted.onReceive(
        new SonarObject.Builder().put("id", "test").build(), responder);

    assertThat(mApplicationDescriptor.highlighted, equalTo(false));
    assertThat(root.highlighted, equalTo(true));

    plugin.onDisconnect();

    assertThat(root.highlighted, equalTo(false));
  }

  @Test
  public void testHitTest() throws Exception {
    final InspectorSonarPlugin plugin =
        new InspectorSonarPlugin(mApp, mDescriptorMapping, mScriptingEnvironment);
    final SonarConnectionMock connection = new SonarConnectionMock();
    plugin.onConnect(connection);

    final TestNode one = new TestNode();
    one.id = "1";
    one.bounds.set(5, 5, 20, 20);

    final TestNode two = new TestNode();
    two.id = "2";
    two.bounds.set(20, 20, 100, 100);

    final TestNode three = new TestNode();
    three.id = "3";
    three.bounds.set(0, 0, 20, 20);

    final TestNode root = new TestNode();
    root.id = "test";
    root.children.add(one);
    root.children.add(two);
    root.children.add(three);
    mApplicationDescriptor.root = root;

    plugin.hitTest(10, 10);

    assertThat(
        connection.sent.get("select"),
        hasItem(
            new SonarObject.Builder()
                .put(
                    "path", new SonarArray.Builder().put("com.facebook.sonar").put("test").put("3"))
                .build()));
  }

  @Test
  public void testSetSearchActive() throws Exception {
    final InspectorSonarPlugin plugin =
        new InspectorSonarPlugin(mApp, mDescriptorMapping, mScriptingEnvironment);
    final SonarConnectionMock connection = new SonarConnectionMock();
    final SonarResponderMock responder = new SonarResponderMock();
    plugin.onConnect(connection);

    final ViewGroup decorView = Mockito.spy(new FrameLayout(mApp.getApplication()));
    Mockito.when(mApp.getViewRoots()).thenReturn(Arrays.<View>asList(decorView));

    plugin.mSetSearchActive.onReceive(
        new SonarObject.Builder().put("active", true).build(), responder);

    Mockito.verify(decorView, Mockito.times(1)).addView(Mockito.any(TouchOverlayView.class));

    plugin.mSetSearchActive.onReceive(
        new SonarObject.Builder().put("active", false).build(), responder);

    Mockito.verify(decorView, Mockito.times(1)).removeView(Mockito.any(TouchOverlayView.class));
  }

  @Test(expected = AssertionError.class)
  public void testNullChildThrows() throws Exception {
    final InspectorSonarPlugin plugin =
        new InspectorSonarPlugin(mApp, mDescriptorMapping, mScriptingEnvironment);
    final SonarResponderMock responder = new SonarResponderMock();
    final SonarConnectionMock connection = new SonarConnectionMock();
    plugin.onConnect(connection);

    final TestNode root = new TestNode();
    root.id = "test";
    root.name = "test";
    root.children = new ArrayList<>();
    root.children.add(null);
    mApplicationDescriptor.root = root;

    plugin.mGetRoot.onReceive(null, responder);
    plugin.mGetNodes.onReceive(
        new SonarObject.Builder().put("ids", new SonarArray.Builder().put("test")).build(),
        responder);
  }

  private class TestNode {
    String id;
    String name;
    List<TestNode> children = new ArrayList<>();
    SonarObject data;
    List<Named<String>> atttributes = new ArrayList<>();
    String decoration;
    boolean highlighted;
    Rect bounds = new Rect();
  }

  private class TestNodeDescriptor extends NodeDescriptor<TestNode> {

    @Override
    public void init(TestNode node) {}

    @Override
    public String getId(TestNode node) {
      return node.id;
    }

    @Override
    public String getName(TestNode node) {
      return node.name;
    }

    @Override
    public int getChildCount(TestNode node) {
      return node.children.size();
    }

    @Override
    public Object getChildAt(TestNode node, int index) {
      return node.children.get(index);
    }

    @Override
    public List<Named<SonarObject>> getData(TestNode node) {
      return Collections.singletonList(new Named<>("data", node.data));
    }

    @Override
    public void setValue(TestNode node, String[] path, SonarDynamic value) throws Exception {
      if (path[0].equals("data")) {
        node.data = value.asObject();
      }
      invalidate(node);
    }

    @Override
    public List<Named<String>> getAttributes(TestNode node) {
      return node.atttributes;
    }

    @Override
    public void setHighlighted(TestNode node, boolean selected) {
      node.highlighted = selected;
    }

    @Override
    public void hitTest(TestNode node, Touch touch) {
      for (int i = node.children.size() - 1; i >= 0; i--) {
        final TestNode child = node.children.get(i);
        final Rect bounds = child.bounds;
        if (touch.containedIn(bounds.left, bounds.top, bounds.right, bounds.bottom)) {
          touch.continueWithOffset(i, bounds.left, bounds.top);
          return;
        }
      }

      touch.finish();
    }

    @Override
    public String getDecoration(TestNode node) {
      return node.decoration;
    }

    @Override
    public boolean matches(String query, TestNode node) {
      return getName(node).contains(query);
    }
  }

  private class MockApplicationDescriptor extends ApplicationDescriptor {
    TestNode root;
    boolean highlighted;

    @Override
    public int getChildCount(ApplicationWrapper node) {
      return 1;
    }

    @Override
    public Object getChildAt(ApplicationWrapper node, int index) {
      return root;
    }

    @Override
    public void setHighlighted(ApplicationWrapper node, boolean selected) {
      highlighted = selected;
    }

    @Override
    public void hitTest(ApplicationWrapper node, Touch touch) {
      touch.continueWithOffset(0, 0, 0);
    }
  }
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.sonar.plugins.inspector.descriptors;

import static android.view.View.MeasureSpec.EXACTLY;
import static android.view.View.MeasureSpec.makeMeasureSpec;
import static org.mockito.Matchers.any;

import android.view.View;
import android.view.ViewGroup;
import android.widget.FrameLayout;
import com.facebook.sonar.plugins.inspector.Touch;
import com.facebook.testing.robolectric.v3.WithTestDefaultsRunner;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.mockito.Mockito;
import org.robolectric.RuntimeEnvironment;

@RunWith(WithTestDefaultsRunner.class)
public class ViewGroupDescriptorTest {

  @Test
  public void testHitTestVisibleChild() {
    final ViewGroupDescriptor descriptor = new ViewGroupDescriptor();

    final ViewGroup root = new FrameLayout(RuntimeEnvironment.application);
    final View child = new View(RuntimeEnvironment.application);
    root.addView(child);

    root.measure(makeMeasureSpec(100, EXACTLY), makeMeasureSpec(100, EXACTLY));
    root.layout(0, 0, 100, 100);

    final Touch touch = Mockito.mock(Touch.class);
    Mockito.when(touch.containedIn(any(int.class), any(int.class), any(int.class), any(int.class)))
        .thenReturn(true);
    descriptor.hitTest(root, touch);
    Mockito.verify(touch, Mockito.times(1)).continueWithOffset(0, 0, 0);
  }

  @Test
  public void testHitTestInvisibleChild() {
    final ViewGroupDescriptor descriptor = new ViewGroupDescriptor();

    final ViewGroup root = new FrameLayout(RuntimeEnvironment.application);
    final View child = new View(RuntimeEnvironment.application);
    child.setVisibility(View.GONE);
    root.addView(child);

    root.measure(makeMeasureSpec(100, EXACTLY), makeMeasureSpec(100, EXACTLY));
    root.layout(0, 0, 100, 100);

    final Touch touch = Mockito.mock(Touch.class);
    Mockito.when(touch.containedIn(any(int.class), any(int.class), any(int.class), any(int.class)))
        .thenReturn(true);
    descriptor.hitTest(root, touch);
    Mockito.verify(touch, Mockito.times(1)).finish();
  }
}
/* src/config.h.  Generated from config.h.in by configure.  */
/* src/config.h.in.  Generated from configure.ac by autoheader.  */

/* define if glog doesn't use RTTI */
#define DISABLE_RTTI 1

/* Namespace for Google classes */
#define GOOGLE_NAMESPACE google

/* Define if you have the `dladdr' function */
#define HAVE_DLADDR 1

/* Define to 1 if you have the <dlfcn.h> header file. */
#define HAVE_DLFCN_H 1

/* Define to 1 if you have the <execinfo.h> header file. */
/* #undef HAVE_EXECINFO_H */

/* Define if you have the `fcntl' function */
#define HAVE_FCNTL 1

/* Define to 1 if you have the <glob.h> header file. */
/* #undef HAVE_GLOB_H */

/* Define to 1 if you have the <inttypes.h> header file. */
#define HAVE_INTTYPES_H 1

/* Define to 1 if you have the `pthread' library (-lpthread). */
/* #undef HAVE_LIBPTHREAD */

/* Define to 1 if you have the <libunwind.h> header file. */
/* #undef HAVE_LIBUNWIND_H */

/* define if you have google gflags library */
/* #undef HAVE_LIB_GFLAGS */

/* define if you have google gmock library */
/* #undef HAVE_LIB_GMOCK */

/* define if you have google gtest library */
/* #undef HAVE_LIB_GTEST */

/* define if you have libunwind */
/* #undef HAVE_LIB_UNWIND */

/* Define to 1 if you have the <memory.h> header file. */
#define HAVE_MEMORY_H 1

/* define if the compiler implements namespaces */
#define HAVE_NAMESPACES 1

/* Define if you have POSIX threads libraries and header files. */
#define HAVE_PTHREAD 1

/* Define to 1 if you have the <pwd.h> header file. */
#define HAVE_PWD_H 1

/* define if the compiler implements pthread_rwlock_* */
#define HAVE_RWLOCK 1

/* Define if you have the `sigaltstack' function */
#define HAVE_SIGALTSTACK 1

/* Define to 1 if you have the <stdint.h> header file. */
#define HAVE_STDINT_H 1

/* Define to 1 if you have the <stdlib.h> header file. */
#define HAVE_STDLIB_H 1

/* Define to 1 if you have the <strings.h> header file. */
#define HAVE_STRINGS_H 1

/* Define to 1 if you have the <string.h> header file. */
#define HAVE_STRING_H 1

/* Define to 1 if you have the <syscall.h> header file. */
/* #undef HAVE_SYSCALL_H */

/* Define to 1 if you have the <syslog.h> header file. */
#define HAVE_SYSLOG_H 1

/* Define to 1 if you have the <sys/stat.h> header file. */
#define HAVE_SYS_STAT_H 1

/* Define to 1 if you have the <sys/syscall.h> header file. */
#define HAVE_SYS_SYSCALL_H 1

/* Define to 1 if you have the <sys/time.h> header file. */
#define HAVE_SYS_TIME_H 1

/* Define to 1 if you have the <sys/types.h> header file. */
#define HAVE_SYS_TYPES_H 1

/* Define to 1 if you have the <sys/ucontext.h> header file. */
/* #undef HAVE_SYS_UCONTEXT_H */

/* Define to 1 if you have the <sys/utsname.h> header file. */
#define HAVE_SYS_UTSNAME_H 1

/* Define to 1 if you have the <ucontext.h> header file. */
/* #undef HAVE_UCONTEXT_H */

/* Define to 1 if you have the <unistd.h> header file. */
#define HAVE_UNISTD_H 1

/* Define to 1 if you have the <unwind.h> header file. */
#define HAVE_UNWIND_H 1

/* define if the compiler supports using expression for operator */
#define HAVE_USING_OPERATOR 1

/* define if your compiler has __attribute__ */
#define HAVE___ATTRIBUTE__ 1

/* define if your compiler has __builtin_expect */
#define HAVE___BUILTIN_EXPECT 1

/* define if your compiler has __sync_val_compare_and_swap */
#define HAVE___SYNC_VAL_COMPARE_AND_SWAP 1

/* Define to the sub-directory in which libtool stores uninstalled libraries.
   */
#define LT_OBJDIR ".libs/"

/* Name of package */
#define PACKAGE "glog"

/* Define to the address where bug reports for this package should be sent. */
#define PACKAGE_BUGREPORT "opensource@google.com"

/* Define to the full name of this package. */
#define PACKAGE_NAME "glog"

/* Define to the full name and version of this package. */
#define PACKAGE_STRING "glog 0.3.3"

/* Define to the one symbol short name of this package. */
#define PACKAGE_TARNAME "glog"

/* Define to the home page for this package. */
#define PACKAGE_URL ""

/* Define to the version of this package. */
#define PACKAGE_VERSION "0.3.3"

/* How to access the PC from a struct ucontext */
/* #undef PC_FROM_UCONTEXT */

/* Define to necessary symbol if this constant uses a non-standard name on
   your system. */
/* #undef PTHREAD_CREATE_JOINABLE */

/* The size of `void *', as computed by sizeof. */
#define SIZEOF_VOID_P 4

/* Define to 1 if you have the ANSI C header files. */
/* #undef STDC_HEADERS */

/* the namespace where STL code like vector<> is defined */
#define STL_NAMESPACE std

/* location of source code */
#define TEST_SRC_DIR "."

/* Version number of package */
#define VERSION "0.3.3"

/* Stops putting the code inside the Google namespace */
#define _END_GOOGLE_NAMESPACE_ }

/* Puts following code inside the Google namespace */
#define _START_GOOGLE_NAMESPACE_ namespace google {


/* TODO(vjn/dreiss): revisit these when use the android-21 (or newer) NDK platform. */
#undef HAVE_SYSCALL_H
#undef HAVE_SYS_SYSCALL_H
#undef OS_LINUX
#undef OS_MACOSX
// Copyright (c) 1999, Google Inc.
// All rights reserved.
//
// Redistribution and use in source and binary forms, with or without
// modification, are permitted provided that the following conditions are
// met:
//
//     * Redistributions of source code must retain the above copyright
// notice, this list of conditions and the following disclaimer.
//     * Redistributions in binary form must reproduce the above
// copyright notice, this list of conditions and the following disclaimer
// in the documentation and/or other materials provided with the
// distribution.
//     * Neither the name of Google Inc. nor the names of its
// contributors may be used to endorse or promote products derived from
// this software without specific prior written permission.
//
// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
// "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
// OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
// LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
// DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
// THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

#define _GNU_SOURCE 1 // needed for O_NOFOLLOW and pread()/pwrite()

#include "utilities.h"

#include <algorithm>
#include <assert.h>
#include <iomanip>
#include <string>
#ifdef HAVE_UNISTD_H
# include <unistd.h>  // For _exit.
#endif
#include <climits>
#include <sys/types.h>
#include <sys/stat.h>
#ifdef HAVE_SYS_UTSNAME_H
# include <sys/utsname.h>  // For uname.
#endif
#include <fcntl.h>
#include <cstdio>
#include <iostream>
#include <stdarg.h>
#include <stdlib.h>
#ifdef HAVE_PWD_H
# include <pwd.h>
#endif
#ifdef HAVE_SYSLOG_H
# include <syslog.h>
#endif
#include <vector>
#include <errno.h>                   // for errno
#include <sstream>
#include "base/commandlineflags.h"        // to get the program name
#include "glog/logging.h"
#include "glog/raw_logging.h"
#include "base/googleinit.h"

#ifdef HAVE_STACKTRACE
# include "stacktrace.h"
#endif

using std::string;
using std::vector;
using std::setw;
using std::setfill;
using std::hex;
using std::dec;
using std::min;
using std::ostream;
using std::ostringstream;

using std::FILE;
using std::fwrite;
using std::fclose;
using std::fflush;
using std::fprintf;
using std::perror;

#ifdef __QNX__
using std::fdopen;
#endif

#ifdef _WIN32
#define fdopen _fdopen
#endif

// There is no thread annotation support.
#define EXCLUSIVE_LOCKS_REQUIRED(mu)

static bool BoolFromEnv(const char *varname, bool defval) {
  const char* const valstr = getenv(varname);
  if (!valstr) {
    return defval;
  }
  return memchr("tTyY1\0", valstr[0], 6) != NULL;
}

GLOG_DEFINE_bool(logtostderr, BoolFromEnv("GOOGLE_LOGTOSTDERR", false),
                 "log messages go to stderr instead of logfiles");
GLOG_DEFINE_bool(alsologtostderr, BoolFromEnv("GOOGLE_ALSOLOGTOSTDERR", false),
                 "log messages go to stderr in addition to logfiles");
GLOG_DEFINE_bool(colorlogtostderr, false,
                 "color messages logged to stderr (if supported by terminal)");
#ifdef OS_LINUX
GLOG_DEFINE_bool(drop_log_memory, true, "Drop in-memory buffers of log contents. "
                 "Logs can grow very quickly and they are rarely read before they "
                 "need to be evicted from memory. Instead, drop them from memory "
                 "as soon as they are flushed to disk.");
_START_GOOGLE_NAMESPACE_
namespace logging {
static const int64 kPageSize = getpagesize();
}
_END_GOOGLE_NAMESPACE_
#endif

// By default, errors (including fatal errors) get logged to stderr as
// well as the file.
//
// The default is ERROR instead of FATAL so that users can see problems
// when they run a program without having to look in another file.
DEFINE_int32(stderrthreshold,
             GOOGLE_NAMESPACE::GLOG_ERROR,
             "log messages at or above this level are copied to stderr in "
             "addition to logfiles.  This flag obsoletes --alsologtostderr.");

GLOG_DEFINE_string(alsologtoemail, "",
                   "log messages go to these email addresses "
                   "in addition to logfiles");
GLOG_DEFINE_bool(log_prefix, true,
                 "Prepend the log prefix to the start of each log line");
GLOG_DEFINE_int32(minloglevel, 0, "Messages logged at a lower level than this don't "
                  "actually get logged anywhere");
GLOG_DEFINE_int32(logbuflevel, 0,
                  "Buffer log messages logged at this level or lower"
                  " (-1 means don't buffer; 0 means buffer INFO only;"
                  " ...)");
GLOG_DEFINE_int32(logbufsecs, 30,
                  "Buffer log messages for at most this many seconds");
GLOG_DEFINE_int32(logemaillevel, 999,
                  "Email log messages logged at this level or higher"
                  " (0 means email all; 3 means email FATAL only;"
                  " ...)");
GLOG_DEFINE_string(logmailer, "/bin/mail",
                   "Mailer used to send logging email");

// Compute the default value for --log_dir
static const char* DefaultLogDir() {
  const char* env;
  env = getenv("GOOGLE_LOG_DIR");
  if (env != NULL && env[0] != '\0') {
    return env;
  }
  env = getenv("TEST_TMPDIR");
  if (env != NULL && env[0] != '\0') {
    return env;
  }
  return "";
}

GLOG_DEFINE_int32(logfile_mode, 0664, "Log file mode/permissions.");

GLOG_DEFINE_string(log_dir, DefaultLogDir(),
                   "If specified, logfiles are written into this directory instead "
                   "of the default logging directory.");
GLOG_DEFINE_string(log_link, "", "Put additional links to the log "
                   "files in this directory");

GLOG_DEFINE_int32(max_log_size, 1800,
                  "approx. maximum log file size (in MB). A value of 0 will "
                  "be silently overridden to 1.");

GLOG_DEFINE_bool(stop_logging_if_full_disk, false,
                 "Stop attempting to log to disk if the disk is full.");

GLOG_DEFINE_string(log_backtrace_at, "",
                   "Emit a backtrace when logging at file:linenum.");

// TODO(hamaji): consider windows
#define PATH_SEPARATOR '/'

#ifndef HAVE_PREAD
#if defined(OS_WINDOWS)
#include <BaseTsd.h>
#define ssize_t SSIZE_T
#endif
ssize_t pread(int fd, void* buf, size_t count, off_t offset) {
  off_t orig_offset = lseek(fd, 0, SEEK_CUR);
  if (orig_offset == (off_t)-1)
    return -1;
  if (lseek(fd, offset, SEEK_CUR) == (off_t)-1)
    return -1;
  ssize_t len = read(fd, buf, count);
  if (len < 0)
    return len;
  if (lseek(fd, orig_offset, SEEK_SET) == (off_t)-1)
    return -1;
  return len;
}
#endif  // !HAVE_PREAD

#ifndef HAVE_PWRITE
static ssize_t pwrite(int fd, void* buf, size_t count, off_t offset) {
  off_t orig_offset = lseek(fd, 0, SEEK_CUR);
  if (orig_offset == (off_t)-1)
    return -1;
  if (lseek(fd, offset, SEEK_CUR) == (off_t)-1)
    return -1;
  ssize_t len = write(fd, buf, count);
  if (len < 0)
    return len;
  if (lseek(fd, orig_offset, SEEK_SET) == (off_t)-1)
    return -1;
  return len;
}
#endif  // !HAVE_PWRITE

static void GetHostName(string* hostname) {
#if defined(HAVE_SYS_UTSNAME_H)
  struct utsname buf;
  if (0 != uname(&buf)) {
    // ensure null termination on failure
    *buf.nodename = '\0';
  }
  *hostname = buf.nodename;
#elif defined(OS_WINDOWS)
  char buf[MAX_COMPUTERNAME_LENGTH + 1];
  DWORD len = MAX_COMPUTERNAME_LENGTH + 1;
  if (GetComputerNameA(buf, &len)) {
    *hostname = buf;
  } else {
    hostname->clear();
  }
#else
# warning There is no way to retrieve the host name.
  *hostname = "(unknown)";
#endif
}

// Returns true iff terminal supports using colors in output.
static bool TerminalSupportsColor() {
  bool term_supports_color = false;
#ifdef OS_WINDOWS
  // on Windows TERM variable is usually not set, but the console does
  // support colors.
  term_supports_color = true;
#else
  // On non-Windows platforms, we rely on the TERM variable.
  const char* const term = getenv("TERM");
  if (term != NULL && term[0] != '\0') {
    term_supports_color =
      !strcmp(term, "xterm") ||
      !strcmp(term, "xterm-color") ||
      !strcmp(term, "xterm-256color") ||
      !strcmp(term, "screen-256color") ||
      !strcmp(term, "screen") ||
      !strcmp(term, "linux") ||
      !strcmp(term, "cygwin");
  }
#endif
  return term_supports_color;
}

_START_GOOGLE_NAMESPACE_

enum GLogColor {
  COLOR_DEFAULT,
  COLOR_RED,
  COLOR_GREEN,
  COLOR_YELLOW
};

static GLogColor SeverityToColor(LogSeverity severity) {
  assert(severity >= 0 && severity < NUM_SEVERITIES);
  GLogColor color = COLOR_DEFAULT;
  switch (severity) {
  case GLOG_INFO:
    color = COLOR_DEFAULT;
    break;
  case GLOG_WARNING:
    color = COLOR_YELLOW;
    break;
  case GLOG_ERROR:
  case GLOG_FATAL:
    color = COLOR_RED;
    break;
  default:
    // should never get here.
    assert(false);
  }
  return color;
}

#ifdef OS_WINDOWS

// Returns the character attribute for the given color.
WORD GetColorAttribute(GLogColor color) {
  switch (color) {
    case COLOR_RED:    return FOREGROUND_RED;
    case COLOR_GREEN:  return FOREGROUND_GREEN;
    case COLOR_YELLOW: return FOREGROUND_RED | FOREGROUND_GREEN;
    default:           return 0;
  }
}

#else

// Returns the ANSI color code for the given color.
const char* GetAnsiColorCode(GLogColor color) {
  switch (color) {
  case COLOR_RED:     return "1";
  case COLOR_GREEN:   return "2";
  case COLOR_YELLOW:  return "3";
  case COLOR_DEFAULT:  return "";
  };
  return NULL; // stop warning about return type.
}

#endif  // OS_WINDOWS

// Safely get max_log_size, overriding to 1 if it somehow gets defined as 0
static int32 MaxLogSize() {
  return (FLAGS_max_log_size > 0 ? FLAGS_max_log_size : 1);
}

// An arbitrary limit on the length of a single log message.  This
// is so that streaming can be done more efficiently.
const size_t LogMessage::kMaxLogMessageLen = 30000;

struct LogMessage::LogMessageData  {
  LogMessageData();

  int preserved_errno_;      // preserved errno
  // Buffer space; contains complete message text.
  char message_text_[LogMessage::kMaxLogMessageLen+1];
  LogStream stream_;
  char severity_;      // What level is this LogMessage logged at?
  int line_;                 // line number where logging call is.
  void (LogMessage::*send_method_)();  // Call this in destructor to send
  union {  // At most one of these is used: union to keep the size low.
    LogSink* sink_;             // NULL or sink to send message to
    std::vector<std::string>* outvec_; // NULL or vector to push message onto
    std::string* message_;             // NULL or string to write message into
  };
  time_t timestamp_;            // Time of creation of LogMessage
  struct ::tm tm_time_;         // Time of creation of LogMessage
  size_t num_prefix_chars_;     // # of chars of prefix in this message
  size_t num_chars_to_log_;     // # of chars of msg to send to log
  size_t num_chars_to_syslog_;  // # of chars of msg to send to syslog
  const char* basename_;        // basename of file that called LOG
  const char* fullname_;        // fullname of file that called LOG
  bool has_been_flushed_;       // false => data has not been flushed
  bool first_fatal_;            // true => this was first fatal msg

 private:
  LogMessageData(const LogMessageData&);
  void operator=(const LogMessageData&);
};

// A mutex that allows only one thread to log at a time, to keep things from
// getting jumbled.  Some other very uncommon logging operations (like
// changing the destination file for log messages of a given severity) also
// lock this mutex.  Please be sure that anybody who might possibly need to
// lock it does so.
static Mutex log_mutex;

// Number of messages sent at each severity.  Under log_mutex.
int64 LogMessage::num_messages_[NUM_SEVERITIES] = {0, 0, 0, 0};

// Globally disable log writing (if disk is full)
static bool stop_writing = false;

const char*const LogSeverityNames[NUM_SEVERITIES] = {
  "INFO", "WARNING", "ERROR", "FATAL"
};

// Has the user called SetExitOnDFatal(true)?
static bool exit_on_dfatal = true;

const char* GetLogSeverityName(LogSeverity severity) {
  return LogSeverityNames[severity];
}

static bool SendEmailInternal(const char*dest, const char *subject,
                              const char*body, bool use_logging);

base::Logger::~Logger() {
}

namespace {

// Encapsulates all file-system related state
class LogFileObject : public base::Logger {
 public:
  LogFileObject(LogSeverity severity, const char* base_filename);
  ~LogFileObject();

  virtual void Write(bool force_flush, // Should we force a flush here?
                     time_t timestamp,  // Timestamp for this entry
                     const char* message,
                     int message_len);

  // Configuration options
  void SetBasename(const char* basename);
  void SetExtension(const char* ext);
  void SetSymlinkBasename(const char* symlink_basename);

  // Normal flushing routine
  virtual void Flush();

  // It is the actual file length for the system loggers,
  // i.e., INFO, ERROR, etc.
  virtual uint32 LogSize() {
    MutexLock l(&lock_);
    return file_length_;
  }

  // Internal flush routine.  Exposed so that FlushLogFilesUnsafe()
  // can avoid grabbing a lock.  Usually Flush() calls it after
  // acquiring lock_.
  void FlushUnlocked();

 private:
  static const uint32 kRolloverAttemptFrequency = 0x20;

  Mutex lock_;
  bool base_filename_selected_;
  string base_filename_;
  string symlink_basename_;
  string filename_extension_;     // option users can specify (eg to add port#)
  FILE* file_;
  LogSeverity severity_;
  uint32 bytes_since_flush_;
  uint32 file_length_;
  unsigned int rollover_attempt_;
  int64 next_flush_time_;         // cycle count at which to flush log

  // Actually create a logfile using the value of base_filename_ and the
  // supplied argument time_pid_string
  // REQUIRES: lock_ is held
  bool CreateLogfile(const string& time_pid_string);
};

}  // namespace

class LogDestination {
 public:
  friend class LogMessage;
  friend void ReprintFatalMessage();
  friend base::Logger* base::GetLogger(LogSeverity);
  friend void base::SetLogger(LogSeverity, base::Logger*);

  // These methods are just forwarded to by their global versions.
  static void SetLogDestination(LogSeverity severity,
				const char* base_filename);
  static void SetLogSymlink(LogSeverity severity,
                            const char* symlink_basename);
  static void AddLogSink(LogSink *destination);
  static void RemoveLogSink(LogSink *destination);
  static void SetLogFilenameExtension(const char* filename_extension);
  static void SetStderrLogging(LogSeverity min_severity);
  static void SetEmailLogging(LogSeverity min_severity, const char* addresses);
  static void LogToStderr();
  // Flush all log files that are at least at the given severity level
  static void FlushLogFiles(int min_severity);
  static void FlushLogFilesUnsafe(int min_severity);

  // we set the maximum size of our packet to be 1400, the logic being
  // to prevent fragmentation.
  // Really this number is arbitrary.
  static const int kNetworkBytes = 1400;

  static const string& hostname();
  static const bool& terminal_supports_color() {
    return terminal_supports_color_;
  }

  static void DeleteLogDestinations();

 private:
  LogDestination(LogSeverity severity, const char* base_filename);
  ~LogDestination() { }

  // Take a log message of a particular severity and log it to stderr
  // iff it's of a high enough severity to deserve it.
  static void MaybeLogToStderr(LogSeverity severity, const char* message,
			       size_t len);

  // Take a log message of a particular severity and log it to email
  // iff it's of a high enough severity to deserve it.
  static void MaybeLogToEmail(LogSeverity severity, const char* message,
			      size_t len);
  // Take a log message of a particular severity and log it to a file
  // iff the base filename is not "" (which means "don't log to me")
  static void MaybeLogToLogfile(LogSeverity severity,
                                time_t timestamp,
				const char* message, size_t len);
  // Take a log message of a particular severity and log it to the file
  // for that severity and also for all files with severity less than
  // this severity.
  static void LogToAllLogfiles(LogSeverity severity,
                               time_t timestamp,
                               const char* message, size_t len);

  // Send logging info to all registered sinks.
  static void LogToSinks(LogSeverity severity,
                         const char *full_filename,
                         const char *base_filename,
                         int line,
                         const struct ::tm* tm_time,
                         const char* message,
                         size_t message_len);

  // Wait for all registered sinks via WaitTillSent
  // including the optional one in "data".
  static void WaitForSinks(LogMessage::LogMessageData* data);

  static LogDestination* log_destination(LogSeverity severity);

  LogFileObject fileobject_;
  base::Logger* logger_;      // Either &fileobject_, or wrapper around it

  static LogDestination* log_destinations_[NUM_SEVERITIES];
  static LogSeverity email_logging_severity_;
  static string addresses_;
  static string hostname_;
  static bool terminal_supports_color_;

  // arbitrary global logging destinations.
  static vector<LogSink*>* sinks_;

  // Protects the vector sinks_,
  // but not the LogSink objects its elements reference.
  static Mutex sink_mutex_;

  // Disallow
  LogDestination(const LogDestination&);
  LogDestination& operator=(const LogDestination&);
};

// Errors do not get logged to email by default.
LogSeverity LogDestination::email_logging_severity_ = 99999;

string LogDestination::addresses_;
string LogDestination::hostname_;

vector<LogSink*>* LogDestination::sinks_ = NULL;
Mutex LogDestination::sink_mutex_;
bool LogDestination::terminal_supports_color_ = TerminalSupportsColor();

/* static */
const string& LogDestination::hostname() {
  if (hostname_.empty()) {
    GetHostName(&hostname_);
    if (hostname_.empty()) {
      hostname_ = "(unknown)";
    }
  }
  return hostname_;
}

LogDestination::LogDestination(LogSeverity severity,
                               const char* base_filename)
  : fileobject_(severity, base_filename),
    logger_(&fileobject_) {
}

inline void LogDestination::FlushLogFilesUnsafe(int min_severity) {
  // assume we have the log_mutex or we simply don't care
  // about it
  for (int i = min_severity; i < NUM_SEVERITIES; i++) {
    LogDestination* log = log_destinations_[i];
    if (log != NULL) {
      // Flush the base fileobject_ logger directly instead of going
      // through any wrappers to reduce chance of deadlock.
      log->fileobject_.FlushUnlocked();
    }
  }
}

inline void LogDestination::FlushLogFiles(int min_severity) {
  // Prevent any subtle race conditions by wrapping a mutex lock around
  // all this stuff.
  MutexLock l(&log_mutex);
  for (int i = min_severity; i < NUM_SEVERITIES; i++) {
    LogDestination* log = log_destination(i);
    if (log != NULL) {
      log->logger_->Flush();
    }
  }
}

inline void LogDestination::SetLogDestination(LogSeverity severity,
					      const char* base_filename) {
  assert(severity >= 0 && severity < NUM_SEVERITIES);
  // Prevent any subtle race conditions by wrapping a mutex lock around
  // all this stuff.
  MutexLock l(&log_mutex);
  log_destination(severity)->fileobject_.SetBasename(base_filename);
}

inline void LogDestination::SetLogSymlink(LogSeverity severity,
                                          const char* symlink_basename) {
  CHECK_GE(severity, 0);
  CHECK_LT(severity, NUM_SEVERITIES);
  MutexLock l(&log_mutex);
  log_destination(severity)->fileobject_.SetSymlinkBasename(symlink_basename);
}

inline void LogDestination::AddLogSink(LogSink *destination) {
  // Prevent any subtle race conditions by wrapping a mutex lock around
  // all this stuff.
  MutexLock l(&sink_mutex_);
  if (!sinks_)  sinks_ = new vector<LogSink*>;
  sinks_->push_back(destination);
}

inline void LogDestination::RemoveLogSink(LogSink *destination) {
  // Prevent any subtle race conditions by wrapping a mutex lock around
  // all this stuff.
  MutexLock l(&sink_mutex_);
  // This doesn't keep the sinks in order, but who cares?
  if (sinks_) {
    for (int i = sinks_->size() - 1; i >= 0; i--) {
      if ((*sinks_)[i] == destination) {
        (*sinks_)[i] = (*sinks_)[sinks_->size() - 1];
        sinks_->pop_back();
        break;
      }
    }
  }
}

inline void LogDestination::SetLogFilenameExtension(const char* ext) {
  // Prevent any subtle race conditions by wrapping a mutex lock around
  // all this stuff.
  MutexLock l(&log_mutex);
  for ( int severity = 0; severity < NUM_SEVERITIES; ++severity ) {
    log_destination(severity)->fileobject_.SetExtension(ext);
  }
}

inline void LogDestination::SetStderrLogging(LogSeverity min_severity) {
  assert(min_severity >= 0 && min_severity < NUM_SEVERITIES);
  // Prevent any subtle race conditions by wrapping a mutex lock around
  // all this stuff.
  MutexLock l(&log_mutex);
  FLAGS_stderrthreshold = min_severity;
}

inline void LogDestination::LogToStderr() {
  // *Don't* put this stuff in a mutex lock, since SetStderrLogging &
  // SetLogDestination already do the locking!
  SetStderrLogging(0);            // thus everything is "also" logged to stderr
  for ( int i = 0; i < NUM_SEVERITIES; ++i ) {
    SetLogDestination(i, "");     // "" turns off logging to a logfile
  }
}

inline void LogDestination::SetEmailLogging(LogSeverity min_severity,
					    const char* addresses) {
  assert(min_severity >= 0 && min_severity < NUM_SEVERITIES);
  // Prevent any subtle race conditions by wrapping a mutex lock around
  // all this stuff.
  MutexLock l(&log_mutex);
  LogDestination::email_logging_severity_ = min_severity;
  LogDestination::addresses_ = addresses;
}

static void ColoredWriteToStderr(LogSeverity severity,
                                 const char* message, size_t len) {
  const GLogColor color =
      (LogDestination::terminal_supports_color() && FLAGS_colorlogtostderr) ?
      SeverityToColor(severity) : COLOR_DEFAULT;

  // Avoid using cerr from this module since we may get called during
  // exit code, and cerr may be partially or fully destroyed by then.
  if (COLOR_DEFAULT == color) {
    fwrite(message, len, 1, stderr);
    return;
  }
#ifdef OS_WINDOWS
  const HANDLE stderr_handle = GetStdHandle(STD_ERROR_HANDLE);

  // Gets the current text color.
  CONSOLE_SCREEN_BUFFER_INFO buffer_info;
  GetConsoleScreenBufferInfo(stderr_handle, &buffer_info);
  const WORD old_color_attrs = buffer_info.wAttributes;

  // We need to flush the stream buffers into the console before each
  // SetConsoleTextAttribute call lest it affect the text that is already
  // printed but has not yet reached the console.
  fflush(stderr);
  SetConsoleTextAttribute(stderr_handle,
                          GetColorAttribute(color) | FOREGROUND_INTENSITY);
  fwrite(message, len, 1, stderr);
  fflush(stderr);
  // Restores the text color.
  SetConsoleTextAttribute(stderr_handle, old_color_attrs);
#else
  fprintf(stderr, "\033[0;3%sm", GetAnsiColorCode(color));
  fwrite(message, len, 1, stderr);
  fprintf(stderr, "\033[m");  // Resets the terminal to default.
#endif  // OS_WINDOWS
}

static void WriteToStderr(const char* message, size_t len) {
  // Avoid using cerr from this module since we may get called during
  // exit code, and cerr may be partially or fully destroyed by then.
  fwrite(message, len, 1, stderr);
}

inline void LogDestination::MaybeLogToStderr(LogSeverity severity,
					     const char* message, size_t len) {
  if ((severity >= FLAGS_stderrthreshold) || FLAGS_alsologtostderr) {
    ColoredWriteToStderr(severity, message, len);
#ifdef OS_WINDOWS
    // On Windows, also output to the debugger
    ::OutputDebugStringA(string(message,len).c_str());
#endif
  }
}


inline void LogDestination::MaybeLogToEmail(LogSeverity severity,
					    const char* message, size_t len) {
  if (severity >= email_logging_severity_ ||
      severity >= FLAGS_logemaillevel) {
    string to(FLAGS_alsologtoemail);
    if (!addresses_.empty()) {
      if (!to.empty()) {
        to += ",";
      }
      to += addresses_;
    }
    const string subject(string("[LOG] ") + LogSeverityNames[severity] + ": " +
                         glog_internal_namespace_::ProgramInvocationShortName());
    string body(hostname());
    body += "\n\n";
    body.append(message, len);

    // should NOT use SendEmail().  The caller of this function holds the
    // log_mutex and SendEmail() calls LOG/VLOG which will block trying to
    // acquire the log_mutex object.  Use SendEmailInternal() and set
    // use_logging to false.
    SendEmailInternal(to.c_str(), subject.c_str(), body.c_str(), false);
  }
}


inline void LogDestination::MaybeLogToLogfile(LogSeverity severity,
                                              time_t timestamp,
					      const char* message,
					      size_t len) {
  const bool should_flush = severity > FLAGS_logbuflevel;
  LogDestination* destination = log_destination(severity);
  destination->logger_->Write(should_flush, timestamp, message, len);
}

inline void LogDestination::LogToAllLogfiles(LogSeverity severity,
                                             time_t timestamp,
                                             const char* message,
                                             size_t len) {

  if ( FLAGS_logtostderr ) {           // global flag: never log to file
    ColoredWriteToStderr(severity, message, len);
  } else {
    for (int i = severity; i >= 0; --i)
      LogDestination::MaybeLogToLogfile(i, timestamp, message, len);
  }
}

inline void LogDestination::LogToSinks(LogSeverity severity,
                                       const char *full_filename,
                                       const char *base_filename,
                                       int line,
                                       const struct ::tm* tm_time,
                                       const char* message,
                                       size_t message_len) {
  ReaderMutexLock l(&sink_mutex_);
  if (sinks_) {
    for (int i = sinks_->size() - 1; i >= 0; i--) {
      (*sinks_)[i]->send(severity, full_filename, base_filename,
                         line, tm_time, message, message_len);
    }
  }
}

inline void LogDestination::WaitForSinks(LogMessage::LogMessageData* data) {
  ReaderMutexLock l(&sink_mutex_);
  if (sinks_) {
    for (int i = sinks_->size() - 1; i >= 0; i--) {
      (*sinks_)[i]->WaitTillSent();
    }
  }
  const bool send_to_sink =
      (data->send_method_ == &LogMessage::SendToSink) ||
      (data->send_method_ == &LogMessage::SendToSinkAndLog);
  if (send_to_sink && data->sink_ != NULL) {
    data->sink_->WaitTillSent();
  }
}

LogDestination* LogDestination::log_destinations_[NUM_SEVERITIES];

inline LogDestination* LogDestination::log_destination(LogSeverity severity) {
  assert(severity >=0 && severity < NUM_SEVERITIES);
  if (!log_destinations_[severity]) {
    log_destinations_[severity] = new LogDestination(severity, NULL);
  }
  return log_destinations_[severity];
}

void LogDestination::DeleteLogDestinations() {
  for (int severity = 0; severity < NUM_SEVERITIES; ++severity) {
    delete log_destinations_[severity];
    log_destinations_[severity] = NULL;
  }
  MutexLock l(&sink_mutex_);
  delete sinks_;
  sinks_ = NULL;
}

namespace {

LogFileObject::LogFileObject(LogSeverity severity,
                             const char* base_filename)
  : base_filename_selected_(base_filename != NULL),
    base_filename_((base_filename != NULL) ? base_filename : ""),
    symlink_basename_(glog_internal_namespace_::ProgramInvocationShortName()),
    filename_extension_(),
    file_(NULL),
    severity_(severity),
    bytes_since_flush_(0),
    file_length_(0),
    rollover_attempt_(kRolloverAttemptFrequency-1),
    next_flush_time_(0) {
  assert(severity >= 0);
  assert(severity < NUM_SEVERITIES);
}

LogFileObject::~LogFileObject() {
  MutexLock l(&lock_);
  if (file_ != NULL) {
    fclose(file_);
    file_ = NULL;
  }
}

void LogFileObject::SetBasename(const char* basename) {
  MutexLock l(&lock_);
  base_filename_selected_ = true;
  if (base_filename_ != basename) {
    // Get rid of old log file since we are changing names
    if (file_ != NULL) {
      fclose(file_);
      file_ = NULL;
      rollover_attempt_ = kRolloverAttemptFrequency-1;
    }
    base_filename_ = basename;
  }
}

void LogFileObject::SetExtension(const char* ext) {
  MutexLock l(&lock_);
  if (filename_extension_ != ext) {
    // Get rid of old log file since we are changing names
    if (file_ != NULL) {
      fclose(file_);
      file_ = NULL;
      rollover_attempt_ = kRolloverAttemptFrequency-1;
    }
    filename_extension_ = ext;
  }
}

void LogFileObject::SetSymlinkBasename(const char* symlink_basename) {
  MutexLock l(&lock_);
  symlink_basename_ = symlink_basename;
}

void LogFileObject::Flush() {
  MutexLock l(&lock_);
  FlushUnlocked();
}

void LogFileObject::FlushUnlocked(){
  if (file_ != NULL) {
    fflush(file_);
    bytes_since_flush_ = 0;
  }
  // Figure out when we are due for another flush.
  const int64 next = (FLAGS_logbufsecs
                      * static_cast<int64>(1000000));  // in usec
  next_flush_time_ = CycleClock_Now() + UsecToCycles(next);
}

bool LogFileObject::CreateLogfile(const string& time_pid_string) {
  string string_filename = base_filename_+filename_extension_+
                           time_pid_string;
  const char* filename = string_filename.c_str();
  int fd = open(filename, O_WRONLY | O_CREAT | O_EXCL, FLAGS_logfile_mode);
  if (fd == -1) return false;
#ifdef HAVE_FCNTL
  // Mark the file close-on-exec. We don't really care if this fails
  fcntl(fd, F_SETFD, FD_CLOEXEC);
#endif

  file_ = fdopen(fd, "a");  // Make a FILE*.
  if (file_ == NULL) {  // Man, we're screwed!
    close(fd);
    unlink(filename);  // Erase the half-baked evidence: an unusable log file
    return false;
  }

  // We try to create a symlink called <program_name>.<severity>,
  // which is easier to use.  (Every time we create a new logfile,
  // we destroy the old symlink and create a new one, so it always
  // points to the latest logfile.)  If it fails, we're sad but it's
  // no error.
  if (!symlink_basename_.empty()) {
    // take directory from filename
    const char* slash = strrchr(filename, PATH_SEPARATOR);
    const string linkname =
      symlink_basename_ + '.' + LogSeverityNames[severity_];
    string linkpath;
    if ( slash ) linkpath = string(filename, slash-filename+1);  // get dirname
    linkpath += linkname;
    unlink(linkpath.c_str());                    // delete old one if it exists

#if defined(OS_WINDOWS)
    // TODO(hamaji): Create lnk file on Windows?
#elif defined(HAVE_UNISTD_H)
    // We must have unistd.h.
    // Make the symlink be relative (in the same dir) so that if the
    // entire log directory gets relocated the link is still valid.
    const char *linkdest = slash ? (slash + 1) : filename;
    if (symlink(linkdest, linkpath.c_str()) != 0) {
      // silently ignore failures
    }

    // Make an additional link to the log file in a place specified by
    // FLAGS_log_link, if indicated
    if (!FLAGS_log_link.empty()) {
      linkpath = FLAGS_log_link + "/" + linkname;
      unlink(linkpath.c_str());                  // delete old one if it exists
      if (symlink(filename, linkpath.c_str()) != 0) {
        // silently ignore failures
      }
    }
#endif
  }

  return true;  // Everything worked
}

void LogFileObject::Write(bool force_flush,
                          time_t timestamp,
                          const char* message,
                          int message_len) {
  MutexLock l(&lock_);

  // We don't log if the base_name_ is "" (which means "don't write")
  if (base_filename_selected_ && base_filename_.empty()) {
    return;
  }

  if (static_cast<int>(file_length_ >> 20) >= MaxLogSize() ||
      PidHasChanged()) {
    if (file_ != NULL) fclose(file_);
    file_ = NULL;
    file_length_ = bytes_since_flush_ = 0;
    rollover_attempt_ = kRolloverAttemptFrequency-1;
  }

  // If there's no destination file, make one before outputting
  if (file_ == NULL) {
    // Try to rollover the log file every 32 log messages.  The only time
    // this could matter would be when we have trouble creating the log
    // file.  If that happens, we'll lose lots of log messages, of course!
    if (++rollover_attempt_ != kRolloverAttemptFrequency) return;
    rollover_attempt_ = 0;

    struct ::tm tm_time;
    localtime_r(&timestamp, &tm_time);

    // The logfile's filename will have the date/time & pid in it
    ostringstream time_pid_stream;
    time_pid_stream.fill('0');
    time_pid_stream << 1900+tm_time.tm_year
                    << setw(2) << 1+tm_time.tm_mon
                    << setw(2) << tm_time.tm_mday
                    << '-'
                    << setw(2) << tm_time.tm_hour
                    << setw(2) << tm_time.tm_min
                    << setw(2) << tm_time.tm_sec
                    << '.'
                    << GetMainThreadPid();
    const string& time_pid_string = time_pid_stream.str();

    if (base_filename_selected_) {
      if (!CreateLogfile(time_pid_string)) {
        perror("Could not create log file");
        fprintf(stderr, "COULD NOT CREATE LOGFILE '%s'!\n",
                time_pid_string.c_str());
        return;
      }
    } else {
      // If no base filename for logs of this severity has been set, use a
      // default base filename of
      // "<program name>.<hostname>.<user name>.log.<severity level>.".  So
      // logfiles will have names like
      // webserver.examplehost.root.log.INFO.19990817-150000.4354, where
      // 19990817 is a date (1999 August 17), 150000 is a time (15:00:00),
      // and 4354 is the pid of the logging process.  The date & time reflect
      // when the file was created for output.
      //
      // Where does the file get put?  Successively try the directories
      // "/tmp", and "."
      string stripped_filename(
          glog_internal_namespace_::ProgramInvocationShortName());
      string hostname;
      GetHostName(&hostname);

      string uidname = MyUserName();
      // We should not call CHECK() here because this function can be
      // called after holding on to log_mutex. We don't want to
      // attempt to hold on to the same mutex, and get into a
      // deadlock. Simply use a name like invalid-user.
      if (uidname.empty()) uidname = "invalid-user";

      stripped_filename = stripped_filename+'.'+hostname+'.'
                          +uidname+".log."
                          +LogSeverityNames[severity_]+'.';
      // We're going to (potentially) try to put logs in several different dirs
      const vector<string> & log_dirs = GetLoggingDirectories();

      // Go through the list of dirs, and try to create the log file in each
      // until we succeed or run out of options
      bool success = false;
      for (vector<string>::const_iterator dir = log_dirs.begin();
           dir != log_dirs.end();
           ++dir) {
        base_filename_ = *dir + "/" + stripped_filename;
        if ( CreateLogfile(time_pid_string) ) {
          success = true;
          break;
        }
      }
      // If we never succeeded, we have to give up
      if ( success == false ) {
        perror("Could not create logging file");
        fprintf(stderr, "COULD NOT CREATE A LOGGINGFILE %s!",
                time_pid_string.c_str());
        return;
      }
    }

    // Write a header message into the log file
    ostringstream file_header_stream;
    file_header_stream.fill('0');
    file_header_stream << "Log file created at: "
                       << 1900+tm_time.tm_year << '/'
                       << setw(2) << 1+tm_time.tm_mon << '/'
                       << setw(2) << tm_time.tm_mday
                       << ' '
                       << setw(2) << tm_time.tm_hour << ':'
                       << setw(2) << tm_time.tm_min << ':'
                       << setw(2) << tm_time.tm_sec << '\n'
                       << "Running on machine: "
                       << LogDestination::hostname() << '\n'
                       << "Log line format: [IWEF]mmdd hh:mm:ss.uuuuuu "
                       << "threadid file:line] msg" << '\n';
    const string& file_header_string = file_header_stream.str();

    const int header_len = file_header_string.size();
    fwrite(file_header_string.data(), 1, header_len, file_);
    file_length_ += header_len;
    bytes_since_flush_ += header_len;
  }

  // Write to LOG file
  if ( !stop_writing ) {
    // fwrite() doesn't return an error when the disk is full, for
    // messages that are less than 4096 bytes. When the disk is full,
    // it returns the message length for messages that are less than
    // 4096 bytes. fwrite() returns 4096 for message lengths that are
    // greater than 4096, thereby indicating an error.
    errno = 0;
    fwrite(message, 1, message_len, file_);
    if ( FLAGS_stop_logging_if_full_disk &&
         errno == ENOSPC ) {  // disk full, stop writing to disk
      stop_writing = true;  // until the disk is
      return;
    } else {
      file_length_ += message_len;
      bytes_since_flush_ += message_len;
    }
  } else {
    if ( CycleClock_Now() >= next_flush_time_ )
      stop_writing = false;  // check to see if disk has free space.
    return;  // no need to flush
  }

  // See important msgs *now*.  Also, flush logs at least every 10^6 chars,
  // or every "FLAGS_logbufsecs" seconds.
  if ( force_flush ||
       (bytes_since_flush_ >= 1000000) ||
       (CycleClock_Now() >= next_flush_time_) ) {
    FlushUnlocked();
#ifdef OS_LINUX
    if (FLAGS_drop_log_memory) {
      if (file_length_ >= logging::kPageSize) {
        // don't evict the most recent page
        uint32 len = file_length_ & ~(logging::kPageSize - 1);
        posix_fadvise(fileno(file_), 0, len, POSIX_FADV_DONTNEED);
      }
    }
#endif
  }
}

}  // namespace


// Static log data space to avoid alloc failures in a LOG(FATAL)
//
// Since multiple threads may call LOG(FATAL), and we want to preserve
// the data from the first call, we allocate two sets of space.  One
// for exclusive use by the first thread, and one for shared use by
// all other threads.
static Mutex fatal_msg_lock;
static CrashReason crash_reason;
static bool fatal_msg_exclusive = true;
static LogMessage::LogMessageData fatal_msg_data_exclusive;
static LogMessage::LogMessageData fatal_msg_data_shared;

LogMessage::LogMessageData::LogMessageData()
  : stream_(message_text_, LogMessage::kMaxLogMessageLen, 0) {
}

LogMessage::LogMessage(const char* file, int line, LogSeverity severity,
                       int ctr, void (LogMessage::*send_method)())
    : allocated_(NULL) {
  Init(file, line, severity, send_method);
  data_->stream_.set_ctr(ctr);
}

LogMessage::LogMessage(const char* file, int line,
                       const CheckOpString& result)
    : allocated_(NULL) {
  Init(file, line, GLOG_FATAL, &LogMessage::SendToLog);
  stream() << "Check failed: " << (*result.str_) << " ";
}

LogMessage::LogMessage(const char* file, int line)
    : allocated_(NULL) {
  Init(file, line, GLOG_INFO, &LogMessage::SendToLog);
}

LogMessage::LogMessage(const char* file, int line, LogSeverity severity)
    : allocated_(NULL) {
  Init(file, line, severity, &LogMessage::SendToLog);
}

LogMessage::LogMessage(const char* file, int line, LogSeverity severity,
                       LogSink* sink, bool also_send_to_log)
    : allocated_(NULL) {
  Init(file, line, severity, also_send_to_log ? &LogMessage::SendToSinkAndLog :
                                                &LogMessage::SendToSink);
  data_->sink_ = sink;  // override Init()'s setting to NULL
}

LogMessage::LogMessage(const char* file, int line, LogSeverity severity,
                       vector<string> *outvec)
    : allocated_(NULL) {
  Init(file, line, severity, &LogMessage::SaveOrSendToLog);
  data_->outvec_ = outvec; // override Init()'s setting to NULL
}

LogMessage::LogMessage(const char* file, int line, LogSeverity severity,
                       string *message)
    : allocated_(NULL) {
  Init(file, line, severity, &LogMessage::WriteToStringAndLog);
  data_->message_ = message;  // override Init()'s setting to NULL
}

void LogMessage::Init(const char* file,
                      int line,
                      LogSeverity severity,
                      void (LogMessage::*send_method)()) {
  allocated_ = NULL;
  if (severity != GLOG_FATAL || !exit_on_dfatal) {
    allocated_ = new LogMessageData();
    data_ = allocated_;
    data_->first_fatal_ = false;
  } else {
    MutexLock l(&fatal_msg_lock);
    if (fatal_msg_exclusive) {
      fatal_msg_exclusive = false;
      data_ = &fatal_msg_data_exclusive;
      data_->first_fatal_ = true;
    } else {
      data_ = &fatal_msg_data_shared;
      data_->first_fatal_ = false;
    }
  }

  stream().fill('0');
  data_->preserved_errno_ = errno;
  data_->severity_ = severity;
  data_->line_ = line;
  data_->send_method_ = send_method;
  data_->sink_ = NULL;
  data_->outvec_ = NULL;
  WallTime now = WallTime_Now();
  data_->timestamp_ = static_cast<time_t>(now);
  localtime_r(&data_->timestamp_, &data_->tm_time_);
  int usecs = static_cast<int>((now - data_->timestamp_) * 1000000);
  RawLog__SetLastTime(data_->tm_time_, usecs);

  data_->num_chars_to_log_ = 0;
  data_->num_chars_to_syslog_ = 0;
  data_->basename_ = const_basename(file);
  data_->fullname_ = file;
  data_->has_been_flushed_ = false;

  // If specified, prepend a prefix to each line.  For example:
  //    I1018 160715 f5d4fbb0 logging.cc:1153]
  //    (log level, GMT month, date, time, thread_id, file basename, line)
  // We exclude the thread_id for the default thread.
  if (FLAGS_log_prefix && (line != kNoLogPrefix)) {
    stream() << LogSeverityNames[severity][0]
             << setw(2) << 1+data_->tm_time_.tm_mon
             << setw(2) << data_->tm_time_.tm_mday
             << ' '
             << setw(2) << data_->tm_time_.tm_hour  << ':'
             << setw(2) << data_->tm_time_.tm_min   << ':'
             << setw(2) << data_->tm_time_.tm_sec   << "."
             << setw(6) << usecs
             << ' '
             << setfill(' ') << setw(5)
             << static_cast<unsigned int>(GetTID()) << setfill('0')
             << ' '
             << data_->basename_ << ':' << data_->line_ << "] ";
  }
  data_->num_prefix_chars_ = data_->stream_.pcount();

  if (!FLAGS_log_backtrace_at.empty()) {
    char fileline[128];
    snprintf(fileline, sizeof(fileline), "%s:%d", data_->basename_, line);
#ifdef HAVE_STACKTRACE
    if (!strcmp(FLAGS_log_backtrace_at.c_str(), fileline)) {
      string stacktrace;
      DumpStackTraceToString(&stacktrace);
      stream() << " (stacktrace:\n" << stacktrace << ") ";
    }
#endif
  }
}

LogMessage::~LogMessage() {
  Flush();
  delete allocated_;
}

int LogMessage::preserved_errno() const {
  return data_->preserved_errno_;
}

ostream& LogMessage::stream() {
  return data_->stream_;
}

// Flush buffered message, called by the destructor, or any other function
// that needs to synchronize the log.
void LogMessage::Flush() {
  if (data_->has_been_flushed_ || data_->severity_ < FLAGS_minloglevel)
    return;

  data_->num_chars_to_log_ = data_->stream_.pcount();
  data_->num_chars_to_syslog_ =
    data_->num_chars_to_log_ - data_->num_prefix_chars_;

  // Do we need to add a \n to the end of this message?
  bool append_newline =
      (data_->message_text_[data_->num_chars_to_log_-1] != '\n');
  char original_final_char = '\0';

  // If we do need to add a \n, we'll do it by violating the memory of the
  // ostrstream buffer.  This is quick, and we'll make sure to undo our
  // modification before anything else is done with the ostrstream.  It
  // would be preferable not to do things this way, but it seems to be
  // the best way to deal with this.
  if (append_newline) {
    original_final_char = data_->message_text_[data_->num_chars_to_log_];
    data_->message_text_[data_->num_chars_to_log_++] = '\n';
  }

  // Prevent any subtle race conditions by wrapping a mutex lock around
  // the actual logging action per se.
  {
    MutexLock l(&log_mutex);
    (this->*(data_->send_method_))();
    ++num_messages_[static_cast<int>(data_->severity_)];
  }
  LogDestination::WaitForSinks(data_);

  if (append_newline) {
    // Fix the ostrstream back how it was before we screwed with it.
    // It's 99.44% certain that we don't need to worry about doing this.
    data_->message_text_[data_->num_chars_to_log_-1] = original_final_char;
  }

  // If errno was already set before we enter the logging call, we'll
  // set it back to that value when we return from the logging call.
  // It happens often that we log an error message after a syscall
  // failure, which can potentially set the errno to some other
  // values.  We would like to preserve the original errno.
  if (data_->preserved_errno_ != 0) {
    errno = data_->preserved_errno_;
  }

  // Note that this message is now safely logged.  If we're asked to flush
  // again, as a result of destruction, say, we'll do nothing on future calls.
  data_->has_been_flushed_ = true;
}

// Copy of first FATAL log message so that we can print it out again
// after all the stack traces.  To preserve legacy behavior, we don't
// use fatal_msg_data_exclusive.
static time_t fatal_time;
static char fatal_message[256];

void ReprintFatalMessage() {
  if (fatal_message[0]) {
    const int n = strlen(fatal_message);
    if (!FLAGS_logtostderr) {
      // Also write to stderr (don't color to avoid terminal checks)
      WriteToStderr(fatal_message, n);
    }
    LogDestination::LogToAllLogfiles(GLOG_ERROR, fatal_time, fatal_message, n);
  }
}

// L >= log_mutex (callers must hold the log_mutex).
void LogMessage::SendToLog() EXCLUSIVE_LOCKS_REQUIRED(log_mutex) {
  static bool already_warned_before_initgoogle = false;

  log_mutex.AssertHeld();

  RAW_DCHECK(data_->num_chars_to_log_ > 0 &&
             data_->message_text_[data_->num_chars_to_log_-1] == '\n', "");

  // Messages of a given severity get logged to lower severity logs, too

  if (!already_warned_before_initgoogle && !IsGoogleLoggingInitialized()) {
    const char w[] = "WARNING: Logging before InitGoogleLogging() is "
                     "written to STDERR\n";
    WriteToStderr(w, strlen(w));
    already_warned_before_initgoogle = true;
  }

  // global flag: never log to file if set.  Also -- don't log to a
  // file if we haven't parsed the command line flags to get the
  // program name.
  if (FLAGS_logtostderr || !IsGoogleLoggingInitialized()) {
    ColoredWriteToStderr(data_->severity_,
                         data_->message_text_, data_->num_chars_to_log_);

    // this could be protected by a flag if necessary.
    LogDestination::LogToSinks(data_->severity_,
                               data_->fullname_, data_->basename_,
                               data_->line_, &data_->tm_time_,
                               data_->message_text_ + data_->num_prefix_chars_,
                               (data_->num_chars_to_log_ -
                                data_->num_prefix_chars_ - 1));
  } else {

    // log this message to all log files of severity <= severity_
    LogDestination::LogToAllLogfiles(data_->severity_, data_->timestamp_,
                                     data_->message_text_,
                                     data_->num_chars_to_log_);

    LogDestination::MaybeLogToStderr(data_->severity_, data_->message_text_,
                                     data_->num_chars_to_log_);
    LogDestination::MaybeLogToEmail(data_->severity_, data_->message_text_,
                                    data_->num_chars_to_log_);
    LogDestination::LogToSinks(data_->severity_,
                               data_->fullname_, data_->basename_,
                               data_->line_, &data_->tm_time_,
                               data_->message_text_ + data_->num_prefix_chars_,
                               (data_->num_chars_to_log_
                                - data_->num_prefix_chars_ - 1));
    // NOTE: -1 removes trailing \n
  }

  // If we log a FATAL message, flush all the log destinations, then toss
  // a signal for others to catch. We leave the logs in a state that
  // someone else can use them (as long as they flush afterwards)
  if (data_->severity_ == GLOG_FATAL && exit_on_dfatal) {
    if (data_->first_fatal_) {
      // Store crash information so that it is accessible from within signal
      // handlers that may be invoked later.
      RecordCrashReason(&crash_reason);
      SetCrashReason(&crash_reason);

      // Store shortened fatal message for other logs and GWQ status
      const int copy = min<int>(data_->num_chars_to_log_,
                                sizeof(fatal_message)-1);
      memcpy(fatal_message, data_->message_text_, copy);
      fatal_message[copy] = '\0';
      fatal_time = data_->timestamp_;
    }

    if (!FLAGS_logtostderr) {
      for (int i = 0; i < NUM_SEVERITIES; ++i) {
        if ( LogDestination::log_destinations_[i] )
          LogDestination::log_destinations_[i]->logger_->Write(true, 0, "", 0);
      }
    }

    // release the lock that our caller (directly or indirectly)
    // LogMessage::~LogMessage() grabbed so that signal handlers
    // can use the logging facility. Alternately, we could add
    // an entire unsafe logging interface to bypass locking
    // for signal handlers but this seems simpler.
    log_mutex.Unlock();
    LogDestination::WaitForSinks(data_);

    const char* message = "*** Check failure stack trace: ***\n";
    if (write(STDERR_FILENO, message, strlen(message)) < 0) {
      // Ignore errors.
    }
    Fail();
  }
}

void LogMessage::RecordCrashReason(
    glog_internal_namespace_::CrashReason* reason) {
  reason->filename = fatal_msg_data_exclusive.fullname_;
  reason->line_number = fatal_msg_data_exclusive.line_;
  reason->message = fatal_msg_data_exclusive.message_text_ +
                    fatal_msg_data_exclusive.num_prefix_chars_;
#ifdef HAVE_STACKTRACE
  // Retrieve the stack trace, omitting the logging frames that got us here.
  reason->depth = GetStackTrace(reason->stack, ARRAYSIZE(reason->stack), 4);
#else
  reason->depth = 0;
#endif
}

#ifdef HAVE___ATTRIBUTE__
# define ATTRIBUTE_NORETURN __attribute__((noreturn))
#else
# define ATTRIBUTE_NORETURN
#endif

static void logging_fail() ATTRIBUTE_NORETURN;

static void logging_fail() {
#if defined(_DEBUG) && defined(_MSC_VER)
  // When debugging on windows, avoid the obnoxious dialog and make
  // it possible to continue past a LOG(FATAL) in the debugger
  __debugbreak();
#else
  abort();
#endif
}

typedef void (*logging_fail_func_t)() ATTRIBUTE_NORETURN;

GOOGLE_GLOG_DLL_DECL
logging_fail_func_t g_logging_fail_func = &logging_fail;

void InstallFailureFunction(void (*fail_func)()) {
  g_logging_fail_func = (logging_fail_func_t)fail_func;
}

void LogMessage::Fail() {
  g_logging_fail_func();
}

// L >= log_mutex (callers must hold the log_mutex).
void LogMessage::SendToSink() EXCLUSIVE_LOCKS_REQUIRED(log_mutex) {
  if (data_->sink_ != NULL) {
    RAW_DCHECK(data_->num_chars_to_log_ > 0 &&
               data_->message_text_[data_->num_chars_to_log_-1] == '\n', "");
    data_->sink_->send(data_->severity_, data_->fullname_, data_->basename_,
                       data_->line_, &data_->tm_time_,
                       data_->message_text_ + data_->num_prefix_chars_,
                       (data_->num_chars_to_log_ -
                        data_->num_prefix_chars_ - 1));
  }
}

// L >= log_mutex (callers must hold the log_mutex).
void LogMessage::SendToSinkAndLog() EXCLUSIVE_LOCKS_REQUIRED(log_mutex) {
  SendToSink();
  SendToLog();
}

// L >= log_mutex (callers must hold the log_mutex).
void LogMessage::SaveOrSendToLog() EXCLUSIVE_LOCKS_REQUIRED(log_mutex) {
  if (data_->outvec_ != NULL) {
    RAW_DCHECK(data_->num_chars_to_log_ > 0 &&
               data_->message_text_[data_->num_chars_to_log_-1] == '\n', "");
    // Omit prefix of message and trailing newline when recording in outvec_.
    const char *start = data_->message_text_ + data_->num_prefix_chars_;
    int len = data_->num_chars_to_log_ - data_->num_prefix_chars_ - 1;
    data_->outvec_->push_back(string(start, len));
  } else {
    SendToLog();
  }
}

void LogMessage::WriteToStringAndLog() EXCLUSIVE_LOCKS_REQUIRED(log_mutex) {
  if (data_->message_ != NULL) {
    RAW_DCHECK(data_->num_chars_to_log_ > 0 &&
               data_->message_text_[data_->num_chars_to_log_-1] == '\n', "");
    // Omit prefix of message and trailing newline when writing to message_.
    const char *start = data_->message_text_ + data_->num_prefix_chars_;
    int len = data_->num_chars_to_log_ - data_->num_prefix_chars_ - 1;
    data_->message_->assign(start, len);
  }
  SendToLog();
}

// L >= log_mutex (callers must hold the log_mutex).
void LogMessage::SendToSyslogAndLog() {
#ifdef HAVE_SYSLOG_H
  // Before any calls to syslog(), make a single call to openlog()
  static bool openlog_already_called = false;
  if (!openlog_already_called) {
    openlog(glog_internal_namespace_::ProgramInvocationShortName(),
            LOG_CONS | LOG_NDELAY | LOG_PID,
            LOG_USER);
    openlog_already_called = true;
  }

  // This array maps Google severity levels to syslog levels
  const int SEVERITY_TO_LEVEL[] = { LOG_INFO, LOG_WARNING, LOG_ERR, LOG_EMERG };
  syslog(LOG_USER | SEVERITY_TO_LEVEL[static_cast<int>(data_->severity_)], "%.*s",
         int(data_->num_chars_to_syslog_),
         data_->message_text_ + data_->num_prefix_chars_);
  SendToLog();
#else
  LOG(ERROR) << "No syslog support: message=" << data_->message_text_;
#endif
}

base::Logger* base::GetLogger(LogSeverity severity) {
  MutexLock l(&log_mutex);
  return LogDestination::log_destination(severity)->logger_;
}

void base::SetLogger(LogSeverity severity, base::Logger* logger) {
  MutexLock l(&log_mutex);
  LogDestination::log_destination(severity)->logger_ = logger;
}

// L < log_mutex.  Acquires and releases mutex_.
int64 LogMessage::num_messages(int severity) {
  MutexLock l(&log_mutex);
  return num_messages_[severity];
}

// Output the COUNTER value. This is only valid if ostream is a
// LogStream.
ostream& operator<<(ostream &os, const PRIVATE_Counter&) {
#ifdef DISABLE_RTTI
  LogMessage::LogStream *log = static_cast<LogMessage::LogStream*>(&os);
#else
  LogMessage::LogStream *log = dynamic_cast<LogMessage::LogStream*>(&os);
#endif
  CHECK(log && log == log->self())
      << "You must not use COUNTER with non-glog ostream";
  os << log->ctr();
  return os;
}

ErrnoLogMessage::ErrnoLogMessage(const char* file, int line,
                                 LogSeverity severity, int ctr,
                                 void (LogMessage::*send_method)())
    : LogMessage(file, line, severity, ctr, send_method) {
}

ErrnoLogMessage::~ErrnoLogMessage() {
  // Don't access errno directly because it may have been altered
  // while streaming the message.
  stream() << ": " << StrError(preserved_errno()) << " ["
           << preserved_errno() << "]";
}

void FlushLogFiles(LogSeverity min_severity) {
  LogDestination::FlushLogFiles(min_severity);
}

void FlushLogFilesUnsafe(LogSeverity min_severity) {
  LogDestination::FlushLogFilesUnsafe(min_severity);
}

void SetLogDestination(LogSeverity severity, const char* base_filename) {
  LogDestination::SetLogDestination(severity, base_filename);
}

void SetLogSymlink(LogSeverity severity, const char* symlink_basename) {
  LogDestination::SetLogSymlink(severity, symlink_basename);
}

LogSink::~LogSink() {
}

void LogSink::WaitTillSent() {
  // noop default
}

string LogSink::ToString(LogSeverity severity, const char* file, int line,
                         const struct ::tm* tm_time,
                         const char* message, size_t message_len) {
  ostringstream stream(string(message, message_len));
  stream.fill('0');

  // FIXME(jrvb): Updating this to use the correct value for usecs
  // requires changing the signature for both this method and
  // LogSink::send().  This change needs to be done in a separate CL
  // so subclasses of LogSink can be updated at the same time.
  int usecs = 0;

  stream << LogSeverityNames[severity][0]
         << setw(2) << 1+tm_time->tm_mon
         << setw(2) << tm_time->tm_mday
         << ' '
         << setw(2) << tm_time->tm_hour << ':'
         << setw(2) << tm_time->tm_min << ':'
         << setw(2) << tm_time->tm_sec << '.'
         << setw(6) << usecs
         << ' '
         << setfill(' ') << setw(5) << GetTID() << setfill('0')
         << ' '
         << file << ':' << line << "] ";

  stream << string(message, message_len);
  return stream.str();
}

void AddLogSink(LogSink *destination) {
  LogDestination::AddLogSink(destination);
}

void RemoveLogSink(LogSink *destination) {
  LogDestination::RemoveLogSink(destination);
}

void SetLogFilenameExtension(const char* ext) {
  LogDestination::SetLogFilenameExtension(ext);
}

void SetStderrLogging(LogSeverity min_severity) {
  LogDestination::SetStderrLogging(min_severity);
}

void SetEmailLogging(LogSeverity min_severity, const char* addresses) {
  LogDestination::SetEmailLogging(min_severity, addresses);
}

void LogToStderr() {
  LogDestination::LogToStderr();
}

namespace base {
namespace internal {

bool GetExitOnDFatal() {
  MutexLock l(&log_mutex);
  return exit_on_dfatal;
}

// Determines whether we exit the program for a LOG(DFATAL) message in
// debug mode.  It does this by skipping the call to Fail/FailQuietly.
// This is intended for testing only.
//
// This can have some effects on LOG(FATAL) as well.  Failure messages
// are always allocated (rather than sharing a buffer), the crash
// reason is not recorded, the "gwq" status message is not updated,
// and the stack trace is not recorded.  The LOG(FATAL) *will* still
// exit the program.  Since this function is used only in testing,
// these differences are acceptable.
void SetExitOnDFatal(bool value) {
  MutexLock l(&log_mutex);
  exit_on_dfatal = value;
}

}  // namespace internal
}  // namespace base

// use_logging controls whether the logging functions LOG/VLOG are used
// to log errors.  It should be set to false when the caller holds the
// log_mutex.
static bool SendEmailInternal(const char*dest, const char *subject,
                              const char*body, bool use_logging) {
  if (dest && *dest) {
    if ( use_logging ) {
      VLOG(1) << "Trying to send TITLE:" << subject
              << " BODY:" << body << " to " << dest;
    } else {
      fprintf(stderr, "Trying to send TITLE: %s BODY: %s to %s\n",
              subject, body, dest);
    }

    string cmd =
        FLAGS_logmailer + " -s\"" + subject + "\" " + dest;
    FILE* pipe = popen(cmd.c_str(), "w");
    if (pipe != NULL) {
      // Add the body if we have one
      if (body)
        fwrite(body, sizeof(char), strlen(body), pipe);
      bool ok = pclose(pipe) != -1;
      if ( !ok ) {
        if ( use_logging ) {
          LOG(ERROR) << "Problems sending mail to " << dest << ": "
                     << StrError(errno);
        } else {
          fprintf(stderr, "Problems sending mail to %s: %s\n",
                  dest, StrError(errno).c_str());
        }
      }
      return ok;
    } else {
      if ( use_logging ) {
        LOG(ERROR) << "Unable to send mail to " << dest;
      } else {
        fprintf(stderr, "Unable to send mail to %s\n", dest);
      }
    }
  }
  return false;
}

bool SendEmail(const char*dest, const char *subject, const char*body){
  return SendEmailInternal(dest, subject, body, true);
}

static void GetTempDirectories(vector<string>* list) {
  list->clear();
#ifdef OS_WINDOWS
  // On windows we'll try to find a directory in this order:
  //   C:/Documents & Settings/whomever/TEMP (or whatever GetTempPath() is)
  //   C:/TMP/
  //   C:/TEMP/
  //   C:/WINDOWS/ or C:/WINNT/
  //   .
  char tmp[MAX_PATH];
  if (GetTempPathA(MAX_PATH, tmp))
    list->push_back(tmp);
  list->push_back("C:\\tmp\\");
  list->push_back("C:\\temp\\");
#else
  // Directories, in order of preference. If we find a dir that
  // exists, we stop adding other less-preferred dirs
  const char * candidates[] = {
    // Non-null only during unittest/regtest
    getenv("TEST_TMPDIR"),

    // Explicitly-supplied temp dirs
    getenv("TMPDIR"), getenv("TMP"),

    // If all else fails
    "/tmp",
  };

  for (size_t i = 0; i < ARRAYSIZE(candidates); i++) {
    const char *d = candidates[i];
    if (!d) continue;  // Empty env var

    // Make sure we don't surprise anyone who's expecting a '/'
    string dstr = d;
    if (dstr[dstr.size() - 1] != '/') {
      dstr += "/";
    }
    list->push_back(dstr);

    struct stat statbuf;
    if (!stat(d, &statbuf) && S_ISDIR(statbuf.st_mode)) {
      // We found a dir that exists - we're done.
      return;
    }
  }

#endif
}

static vector<string>* logging_directories_list;

const vector<string>& GetLoggingDirectories() {
  // Not strictly thread-safe but we're called early in InitGoogle().
  if (logging_directories_list == NULL) {
    logging_directories_list = new vector<string>;

    if ( !FLAGS_log_dir.empty() ) {
      // A dir was specified, we should use it
      logging_directories_list->push_back(FLAGS_log_dir.c_str());
    } else {
      GetTempDirectories(logging_directories_list);
#ifdef OS_WINDOWS
      char tmp[MAX_PATH];
      if (GetWindowsDirectoryA(tmp, MAX_PATH))
        logging_directories_list->push_back(tmp);
      logging_directories_list->push_back(".\\");
#else
      logging_directories_list->push_back("./");
#endif
    }
  }
  return *logging_directories_list;
}

void TestOnly_ClearLoggingDirectoriesList() {
  fprintf(stderr, "TestOnly_ClearLoggingDirectoriesList should only be "
          "called from test code.\n");
  delete logging_directories_list;
  logging_directories_list = NULL;
}

void GetExistingTempDirectories(vector<string>* list) {
  GetTempDirectories(list);
  vector<string>::iterator i_dir = list->begin();
  while( i_dir != list->end() ) {
    // zero arg to access means test for existence; no constant
    // defined on windows
    if ( access(i_dir->c_str(), 0) ) {
      i_dir = list->erase(i_dir);
    } else {
      ++i_dir;
    }
  }
}

void TruncateLogFile(const char *path, int64 limit, int64 keep) {
#ifdef HAVE_UNISTD_H
  struct stat statbuf;
  const int kCopyBlockSize = 8 << 10;
  char copybuf[kCopyBlockSize];
  int64 read_offset, write_offset;
  // Don't follow symlinks unless they're our own fd symlinks in /proc
  int flags = O_RDWR;
  // TODO(hamaji): Support other environments.
#ifdef OS_LINUX
  const char *procfd_prefix = "/proc/self/fd/";
  if (strncmp(procfd_prefix, path, strlen(procfd_prefix))) flags |= O_NOFOLLOW;
#endif

  int fd = open(path, flags);
  if (fd == -1) {
    if (errno == EFBIG) {
      // The log file in question has got too big for us to open. The
      // real fix for this would be to compile logging.cc (or probably
      // all of base/...) with -D_FILE_OFFSET_BITS=64 but that's
      // rather scary.
      // Instead just truncate the file to something we can manage
      if (truncate(path, 0) == -1) {
        PLOG(ERROR) << "Unable to truncate " << path;
      } else {
        LOG(ERROR) << "Truncated " << path << " due to EFBIG error";
      }
    } else {
      PLOG(ERROR) << "Unable to open " << path;
    }
    return;
  }

  if (fstat(fd, &statbuf) == -1) {
    PLOG(ERROR) << "Unable to fstat()";
    goto out_close_fd;
  }

  // See if the path refers to a regular file bigger than the
  // specified limit
  if (!S_ISREG(statbuf.st_mode)) goto out_close_fd;
  if (statbuf.st_size <= limit)  goto out_close_fd;
  if (statbuf.st_size <= keep) goto out_close_fd;

  // This log file is too large - we need to truncate it
  LOG(INFO) << "Truncating " << path << " to " << keep << " bytes";

  // Copy the last "keep" bytes of the file to the beginning of the file
  read_offset = statbuf.st_size - keep;
  write_offset = 0;
  int bytesin, bytesout;
  while ((bytesin = pread(fd, copybuf, sizeof(copybuf), read_offset)) > 0) {
    bytesout = pwrite(fd, copybuf, bytesin, write_offset);
    if (bytesout == -1) {
      PLOG(ERROR) << "Unable to write to " << path;
      break;
    } else if (bytesout != bytesin) {
      LOG(ERROR) << "Expected to write " << bytesin << ", wrote " << bytesout;
    }
    read_offset += bytesin;
    write_offset += bytesout;
  }
  if (bytesin == -1) PLOG(ERROR) << "Unable to read from " << path;

  // Truncate the remainder of the file. If someone else writes to the
  // end of the file after our last read() above, we lose their latest
  // data. Too bad ...
  if (ftruncate(fd, write_offset) == -1) {
    PLOG(ERROR) << "Unable to truncate " << path;
  }

 out_close_fd:
  close(fd);
#else
  LOG(ERROR) << "No log truncation support.";
#endif
}

void TruncateStdoutStderr() {
#ifdef HAVE_UNISTD_H
  int64 limit = MaxLogSize() << 20;
  int64 keep = 1 << 20;
  TruncateLogFile("/proc/self/fd/1", limit, keep);
  TruncateLogFile("/proc/self/fd/2", limit, keep);
#else
  LOG(ERROR) << "No log truncation support.";
#endif
}


// Helper functions for string comparisons.
#define DEFINE_CHECK_STROP_IMPL(name, func, expected)                   \
  string* Check##func##expected##Impl(const char* s1, const char* s2,   \
                                      const char* names) {              \
    bool equal = s1 == s2 || (s1 && s2 && !func(s1, s2));               \
    if (equal == expected) return NULL;                                 \
    else {                                                              \
      ostringstream ss;                                                 \
      if (!s1) s1 = "";                                                 \
      if (!s2) s2 = "";                                                 \
      ss << #name " failed: " << names << " (" << s1 << " vs. " << s2 << ")"; \
      return new string(ss.str());                                      \
    }                                                                   \
  }
DEFINE_CHECK_STROP_IMPL(CHECK_STREQ, strcmp, true)
DEFINE_CHECK_STROP_IMPL(CHECK_STRNE, strcmp, false)
DEFINE_CHECK_STROP_IMPL(CHECK_STRCASEEQ, strcasecmp, true)
DEFINE_CHECK_STROP_IMPL(CHECK_STRCASENE, strcasecmp, false)
#undef DEFINE_CHECK_STROP_IMPL

int posix_strerror_r(int err, char *buf, size_t len) {
  // Sanity check input parameters
  if (buf == NULL || len <= 0) {
    errno = EINVAL;
    return -1;
  }

  // Reset buf and errno, and try calling whatever version of strerror_r()
  // is implemented by glibc
  buf[0] = '\000';
  int old_errno = errno;
  errno = 0;
  char *rc = reinterpret_cast<char *>(strerror_r(err, buf, len));

  // Both versions set errno on failure
  if (errno) {
    // Should already be there, but better safe than sorry
    buf[0]     = '\000';
    return -1;
  }
  errno = old_errno;

  // POSIX is vague about whether the string will be terminated, although
  // is indirectly implies that typically ERANGE will be returned, instead
  // of truncating the string. This is different from the GNU implementation.
  // We play it safe by always terminating the string explicitly.
  buf[len-1] = '\000';

  // If the function succeeded, we can use its exit code to determine the
  // semantics implemented by glibc
  if (!rc) {
    return 0;
  } else {
    // GNU semantics detected
    if (rc == buf) {
      return 0;
    } else {
      buf[0] = '\000';
#if defined(OS_MACOSX) || defined(OS_FREEBSD) || defined(OS_OPENBSD)
      if (reinterpret_cast<intptr_t>(rc) < sys_nerr) {
        // This means an error on MacOSX or FreeBSD.
        return -1;
      }
#endif
      strncat(buf, rc, len-1);
      return 0;
    }
  }
}

string StrError(int err) {
  char buf[100];
  int rc = posix_strerror_r(err, buf, sizeof(buf));
  if ((rc < 0) || (buf[0] == '\000')) {
    snprintf(buf, sizeof(buf), "Error number %d", err);
  }
  return buf;
}

LogMessageFatal::LogMessageFatal(const char* file, int line) :
    LogMessage(file, line, GLOG_FATAL) {}

LogMessageFatal::LogMessageFatal(const char* file, int line,
                                 const CheckOpString& result) :
    LogMessage(file, line, result) {}

LogMessageFatal::~LogMessageFatal() {
    Flush();
    LogMessage::Fail();
}

namespace base {

CheckOpMessageBuilder::CheckOpMessageBuilder(const char *exprtext)
    : stream_(new ostringstream) {
  *stream_ << exprtext << " (";
}

CheckOpMessageBuilder::~CheckOpMessageBuilder() {
  delete stream_;
}

ostream* CheckOpMessageBuilder::ForVar2() {
  *stream_ << " vs. ";
  return stream_;
}

string* CheckOpMessageBuilder::NewString() {
  *stream_ << ")";
  return new string(stream_->str());
}

}  // namespace base

template <>
void MakeCheckOpValueString(std::ostream* os, const char& v) {
  if (v >= 32 && v <= 126) {
    (*os) << "'" << v << "'";
  } else {
    (*os) << "char value " << (short)v;
  }
}

template <>
void MakeCheckOpValueString(std::ostream* os, const signed char& v) {
  if (v >= 32 && v <= 126) {
    (*os) << "'" << v << "'";
  } else {
    (*os) << "signed char value " << (short)v;
  }
}

template <>
void MakeCheckOpValueString(std::ostream* os, const unsigned char& v) {
  if (v >= 32 && v <= 126) {
    (*os) << "'" << v << "'";
  } else {
    (*os) << "unsigned char value " << (unsigned short)v;
  }
}

void InitGoogleLogging(const char* argv0) {
  glog_internal_namespace_::InitGoogleLoggingUtilities(argv0);
}

void ShutdownGoogleLogging() {
  glog_internal_namespace_::ShutdownGoogleLoggingUtilities();
  LogDestination::DeleteLogDestinations();
  delete logging_directories_list;
  logging_directories_list = NULL;
}

_END_GOOGLE_NAMESPACE_
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

type Electron$BrowserWindow = any;
type Electron$NativeImage = any;

type Electron$MenuRoles =
  | 'undo'
  | 'redo'
  | 'cut'
  | 'copy'
  | 'paste'
  | 'pasteandmatchstyle'
  | 'selectall'
  | 'delete'
  | 'minimize'
  | 'close'
  | 'quit'
  | 'togglefullscreen' // macOS-only
  | 'about'
  | 'hide'
  | 'hideothers'
  | 'unhide'
  | 'front'
  | 'zoom'
  | 'window'
  | 'help'
  | 'services';

type Electron$MenuType =
  | 'normal'
  | 'separator'
  | 'submenu'
  | 'checkbox'
  | 'radio';

type Electron$MenuItemOptions = {
  click?: (
    menuItem: Electron$MenuItem,
    browserWindow: Object,
    event: Object,
  ) => void,
  role?: Electron$MenuRoles,
  type?: Electron$MenuType,
  label?: string,
  sublabel?: string,
  accelerator?: string,
  icon?: Object,
  enabled?: boolean,
  visible?: boolean,
  checked?: boolean,
  submenu?: Electron$MenuItem | Electron$MenuItemOptions,
  id?: string,
  position?: string,
};

declare class Electron$MenuItem {
  constructor: (options: Electron$MenuItemOptions) => void;
  enabled: boolean;
  visible: boolean;
  checked: boolean;
}

declare class Electron$Menu {
  static setApplicationMenu: (menu: Electron$Menu) => void;
  static getApplicationMenu: () => ?Electron$Menu;
  static sendActionToFirstResponder: (action: string) => void;
  static buildFromTemplate: (
    templates: Array<Electron$MenuItemOptions>,
  ) => Electron$Menu;
  popup: (
    browserWindow: Object,
    x?: number,
    y?: number,
    positioningItem?: number,
  ) => void;
  popup: (x?: number, y?: number, positioningItem?: number) => void;
  append: (menuItem: Electron$MenuItem) => void;
  insert: (pos: number, menuItem: Electron$MenuItem) => void;
  items: Array<Electron$MenuItem>;
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

declare var React: $Exports<'react'>;
// flow-typed signature: 7849d9ce4b390afcfc917a08445a20eb
// flow-typed version: <<STUB>>/adbkit-fb_v2.10.1/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'adbkit-fb'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'adbkit-fb' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'adbkit-fb/lib/adb' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/auth' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/client' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host-serial/forward' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host-serial/getdevicepath' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host-serial/getserialno' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host-serial/getstate' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host-serial/listforwards' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host-serial/waitfordevice' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host-transport/clear' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host-transport/framebuffer' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host-transport/getfeatures' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host-transport/getpackages' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host-transport/getproperties' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host-transport/install' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host-transport/isinstalled' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host-transport/listreverses' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host-transport/local' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host-transport/log' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host-transport/logcat' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host-transport/monkey' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host-transport/reboot' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host-transport/remount' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host-transport/reverse' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host-transport/root' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host-transport/screencap' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host-transport/shell' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host-transport/startactivity' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host-transport/startservice' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host-transport/sync' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host-transport/tcp' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host-transport/tcpip' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host-transport/trackjdwp' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host-transport/uninstall' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host-transport/usb' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host-transport/waitbootcomplete' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host/connect' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host/devices' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host/deviceswithpaths' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host/disconnect' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host/kill' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host/trackdevices' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host/transport' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/command/host/version' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/connection' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/dump' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/framebuffer/rgbtransform' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/keycode' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/linetransform' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/parser' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/proc/stat' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/protocol' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/sync' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/sync/entry' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/sync/pulltransfer' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/sync/pushtransfer' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/sync/stats' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/tcpusb/packet' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/tcpusb/packetreader' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/tcpusb/rollingcounter' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/tcpusb/server' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/tcpusb/service' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/tcpusb/servicemap' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/tcpusb/socket' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/tracker' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/adb/util' {
  declare module.exports: any;
}

declare module 'adbkit-fb/lib/cli' {
  declare module.exports: any;
}

// Filename aliases
declare module 'adbkit-fb/index' {
  declare module.exports: $Exports<'adbkit-fb'>;
}
declare module 'adbkit-fb/index.js' {
  declare module.exports: $Exports<'adbkit-fb'>;
}
declare module 'adbkit-fb/lib/adb.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb'>;
}
declare module 'adbkit-fb/lib/adb/auth.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/auth'>;
}
declare module 'adbkit-fb/lib/adb/client.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/client'>;
}
declare module 'adbkit-fb/lib/adb/command.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command'>;
}
declare module 'adbkit-fb/lib/adb/command/host-serial/forward.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host-serial/forward'>;
}
declare module 'adbkit-fb/lib/adb/command/host-serial/getdevicepath.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host-serial/getdevicepath'>;
}
declare module 'adbkit-fb/lib/adb/command/host-serial/getserialno.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host-serial/getserialno'>;
}
declare module 'adbkit-fb/lib/adb/command/host-serial/getstate.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host-serial/getstate'>;
}
declare module 'adbkit-fb/lib/adb/command/host-serial/listforwards.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host-serial/listforwards'>;
}
declare module 'adbkit-fb/lib/adb/command/host-serial/waitfordevice.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host-serial/waitfordevice'>;
}
declare module 'adbkit-fb/lib/adb/command/host-transport/clear.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host-transport/clear'>;
}
declare module 'adbkit-fb/lib/adb/command/host-transport/framebuffer.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host-transport/framebuffer'>;
}
declare module 'adbkit-fb/lib/adb/command/host-transport/getfeatures.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host-transport/getfeatures'>;
}
declare module 'adbkit-fb/lib/adb/command/host-transport/getpackages.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host-transport/getpackages'>;
}
declare module 'adbkit-fb/lib/adb/command/host-transport/getproperties.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host-transport/getproperties'>;
}
declare module 'adbkit-fb/lib/adb/command/host-transport/install.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host-transport/install'>;
}
declare module 'adbkit-fb/lib/adb/command/host-transport/isinstalled.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host-transport/isinstalled'>;
}
declare module 'adbkit-fb/lib/adb/command/host-transport/listreverses.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host-transport/listreverses'>;
}
declare module 'adbkit-fb/lib/adb/command/host-transport/local.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host-transport/local'>;
}
declare module 'adbkit-fb/lib/adb/command/host-transport/log.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host-transport/log'>;
}
declare module 'adbkit-fb/lib/adb/command/host-transport/logcat.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host-transport/logcat'>;
}
declare module 'adbkit-fb/lib/adb/command/host-transport/monkey.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host-transport/monkey'>;
}
declare module 'adbkit-fb/lib/adb/command/host-transport/reboot.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host-transport/reboot'>;
}
declare module 'adbkit-fb/lib/adb/command/host-transport/remount.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host-transport/remount'>;
}
declare module 'adbkit-fb/lib/adb/command/host-transport/reverse.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host-transport/reverse'>;
}
declare module 'adbkit-fb/lib/adb/command/host-transport/root.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host-transport/root'>;
}
declare module 'adbkit-fb/lib/adb/command/host-transport/screencap.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host-transport/screencap'>;
}
declare module 'adbkit-fb/lib/adb/command/host-transport/shell.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host-transport/shell'>;
}
declare module 'adbkit-fb/lib/adb/command/host-transport/startactivity.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host-transport/startactivity'>;
}
declare module 'adbkit-fb/lib/adb/command/host-transport/startservice.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host-transport/startservice'>;
}
declare module 'adbkit-fb/lib/adb/command/host-transport/sync.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host-transport/sync'>;
}
declare module 'adbkit-fb/lib/adb/command/host-transport/tcp.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host-transport/tcp'>;
}
declare module 'adbkit-fb/lib/adb/command/host-transport/tcpip.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host-transport/tcpip'>;
}
declare module 'adbkit-fb/lib/adb/command/host-transport/trackjdwp.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host-transport/trackjdwp'>;
}
declare module 'adbkit-fb/lib/adb/command/host-transport/uninstall.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host-transport/uninstall'>;
}
declare module 'adbkit-fb/lib/adb/command/host-transport/usb.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host-transport/usb'>;
}
declare module 'adbkit-fb/lib/adb/command/host-transport/waitbootcomplete.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host-transport/waitbootcomplete'>;
}
declare module 'adbkit-fb/lib/adb/command/host/connect.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host/connect'>;
}
declare module 'adbkit-fb/lib/adb/command/host/devices.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host/devices'>;
}
declare module 'adbkit-fb/lib/adb/command/host/deviceswithpaths.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host/deviceswithpaths'>;
}
declare module 'adbkit-fb/lib/adb/command/host/disconnect.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host/disconnect'>;
}
declare module 'adbkit-fb/lib/adb/command/host/kill.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host/kill'>;
}
declare module 'adbkit-fb/lib/adb/command/host/trackdevices.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host/trackdevices'>;
}
declare module 'adbkit-fb/lib/adb/command/host/transport.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host/transport'>;
}
declare module 'adbkit-fb/lib/adb/command/host/version.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/command/host/version'>;
}
declare module 'adbkit-fb/lib/adb/connection.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/connection'>;
}
declare module 'adbkit-fb/lib/adb/dump.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/dump'>;
}
declare module 'adbkit-fb/lib/adb/framebuffer/rgbtransform.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/framebuffer/rgbtransform'>;
}
declare module 'adbkit-fb/lib/adb/keycode.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/keycode'>;
}
declare module 'adbkit-fb/lib/adb/linetransform.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/linetransform'>;
}
declare module 'adbkit-fb/lib/adb/parser.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/parser'>;
}
declare module 'adbkit-fb/lib/adb/proc/stat.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/proc/stat'>;
}
declare module 'adbkit-fb/lib/adb/protocol.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/protocol'>;
}
declare module 'adbkit-fb/lib/adb/sync.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/sync'>;
}
declare module 'adbkit-fb/lib/adb/sync/entry.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/sync/entry'>;
}
declare module 'adbkit-fb/lib/adb/sync/pulltransfer.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/sync/pulltransfer'>;
}
declare module 'adbkit-fb/lib/adb/sync/pushtransfer.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/sync/pushtransfer'>;
}
declare module 'adbkit-fb/lib/adb/sync/stats.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/sync/stats'>;
}
declare module 'adbkit-fb/lib/adb/tcpusb/packet.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/tcpusb/packet'>;
}
declare module 'adbkit-fb/lib/adb/tcpusb/packetreader.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/tcpusb/packetreader'>;
}
declare module 'adbkit-fb/lib/adb/tcpusb/rollingcounter.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/tcpusb/rollingcounter'>;
}
declare module 'adbkit-fb/lib/adb/tcpusb/server.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/tcpusb/server'>;
}
declare module 'adbkit-fb/lib/adb/tcpusb/service.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/tcpusb/service'>;
}
declare module 'adbkit-fb/lib/adb/tcpusb/servicemap.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/tcpusb/servicemap'>;
}
declare module 'adbkit-fb/lib/adb/tcpusb/socket.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/tcpusb/socket'>;
}
declare module 'adbkit-fb/lib/adb/tracker.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/tracker'>;
}
declare module 'adbkit-fb/lib/adb/util.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/adb/util'>;
}
declare module 'adbkit-fb/lib/cli.js' {
  declare module.exports: $Exports<'adbkit-fb/lib/cli'>;
}
// flow-typed signature: 4c4fcc7d39703336b04af263e250bdd1
// flow-typed version: <<STUB>>/adbkit-logcat-fb_v1.1.0/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'adbkit-logcat-fb'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'adbkit-logcat-fb' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'adbkit-logcat-fb/lib/logcat' {
  declare module.exports: any;
}

declare module 'adbkit-logcat-fb/lib/logcat/entry' {
  declare module.exports: any;
}

declare module 'adbkit-logcat-fb/lib/logcat/parser' {
  declare module.exports: any;
}

declare module 'adbkit-logcat-fb/lib/logcat/parser/binary' {
  declare module.exports: any;
}

declare module 'adbkit-logcat-fb/lib/logcat/priority' {
  declare module.exports: any;
}

declare module 'adbkit-logcat-fb/lib/logcat/reader' {
  declare module.exports: any;
}

declare module 'adbkit-logcat-fb/lib/logcat/transform' {
  declare module.exports: any;
}

// Filename aliases
declare module 'adbkit-logcat-fb/index' {
  declare module.exports: $Exports<'adbkit-logcat-fb'>;
}
declare module 'adbkit-logcat-fb/index.js' {
  declare module.exports: $Exports<'adbkit-logcat-fb'>;
}
declare module 'adbkit-logcat-fb/lib/logcat.js' {
  declare module.exports: $Exports<'adbkit-logcat-fb/lib/logcat'>;
}
declare module 'adbkit-logcat-fb/lib/logcat/entry.js' {
  declare module.exports: $Exports<'adbkit-logcat-fb/lib/logcat/entry'>;
}
declare module 'adbkit-logcat-fb/lib/logcat/parser.js' {
  declare module.exports: $Exports<'adbkit-logcat-fb/lib/logcat/parser'>;
}
declare module 'adbkit-logcat-fb/lib/logcat/parser/binary.js' {
  declare module.exports: $Exports<'adbkit-logcat-fb/lib/logcat/parser/binary'>;
}
declare module 'adbkit-logcat-fb/lib/logcat/priority.js' {
  declare module.exports: $Exports<'adbkit-logcat-fb/lib/logcat/priority'>;
}
declare module 'adbkit-logcat-fb/lib/logcat/reader.js' {
  declare module.exports: $Exports<'adbkit-logcat-fb/lib/logcat/reader'>;
}
declare module 'adbkit-logcat-fb/lib/logcat/transform.js' {
  declare module.exports: $Exports<'adbkit-logcat-fb/lib/logcat/transform'>;
}
// flow-typed signature: 0f7f1ee584ef43d0f9403cfe273cc39d
// flow-typed version: <<STUB>>/babel-cli_v7.0.0-alpha.12/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'babel-cli'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'babel-cli' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'babel-cli/bin/babel-doctor' {
  declare module.exports: any;
}

declare module 'babel-cli/bin/babel-external-helpers' {
  declare module.exports: any;
}

declare module 'babel-cli/bin/babel-node' {
  declare module.exports: any;
}

declare module 'babel-cli/bin/babel' {
  declare module.exports: any;
}

declare module 'babel-cli/lib/_babel-node' {
  declare module.exports: any;
}

declare module 'babel-cli/lib/babel-external-helpers' {
  declare module.exports: any;
}

declare module 'babel-cli/lib/babel-node' {
  declare module.exports: any;
}

declare module 'babel-cli/lib/babel/dir' {
  declare module.exports: any;
}

declare module 'babel-cli/lib/babel/file' {
  declare module.exports: any;
}

declare module 'babel-cli/lib/babel/index' {
  declare module.exports: any;
}

declare module 'babel-cli/lib/babel/util' {
  declare module.exports: any;
}

// Filename aliases
declare module 'babel-cli/bin/babel-doctor.js' {
  declare module.exports: $Exports<'babel-cli/bin/babel-doctor'>;
}
declare module 'babel-cli/bin/babel-external-helpers.js' {
  declare module.exports: $Exports<'babel-cli/bin/babel-external-helpers'>;
}
declare module 'babel-cli/bin/babel-node.js' {
  declare module.exports: $Exports<'babel-cli/bin/babel-node'>;
}
declare module 'babel-cli/bin/babel.js' {
  declare module.exports: $Exports<'babel-cli/bin/babel'>;
}
declare module 'babel-cli/index' {
  declare module.exports: $Exports<'babel-cli'>;
}
declare module 'babel-cli/index.js' {
  declare module.exports: $Exports<'babel-cli'>;
}
declare module 'babel-cli/lib/_babel-node.js' {
  declare module.exports: $Exports<'babel-cli/lib/_babel-node'>;
}
declare module 'babel-cli/lib/babel-external-helpers.js' {
  declare module.exports: $Exports<'babel-cli/lib/babel-external-helpers'>;
}
declare module 'babel-cli/lib/babel-node.js' {
  declare module.exports: $Exports<'babel-cli/lib/babel-node'>;
}
declare module 'babel-cli/lib/babel/dir.js' {
  declare module.exports: $Exports<'babel-cli/lib/babel/dir'>;
}
declare module 'babel-cli/lib/babel/file.js' {
  declare module.exports: $Exports<'babel-cli/lib/babel/file'>;
}
declare module 'babel-cli/lib/babel/index.js' {
  declare module.exports: $Exports<'babel-cli/lib/babel/index'>;
}
declare module 'babel-cli/lib/babel/util.js' {
  declare module.exports: $Exports<'babel-cli/lib/babel/util'>;
}
// flow-typed signature: d1d2d301b3f753cb6d40f8ac6d8df8c8
// flow-typed version: <<STUB>>/babel-code-frame_v^6.22.0/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'babel-code-frame'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'babel-code-frame' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'babel-code-frame/lib/index' {
  declare module.exports: any;
}

// Filename aliases
declare module 'babel-code-frame/lib/index.js' {
  declare module.exports: $Exports<'babel-code-frame/lib/index'>;
}
// flow-typed signature: 8f20b8fc8e610a76416674f109b1d8bc
// flow-typed version: <<STUB>>/babel-core_v7.0.0-alpha.12/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'babel-core'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'babel-core' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'babel-core/lib/config/build-config-chain' {
  declare module.exports: any;
}

declare module 'babel-core/lib/config/caching' {
  declare module.exports: any;
}

declare module 'babel-core/lib/config/helpers/environment' {
  declare module.exports: any;
}

declare module 'babel-core/lib/config/index' {
  declare module.exports: any;
}

declare module 'babel-core/lib/config/loading/files/configuration' {
  declare module.exports: any;
}

declare module 'babel-core/lib/config/loading/files/index-browser' {
  declare module.exports: any;
}

declare module 'babel-core/lib/config/loading/files/index' {
  declare module.exports: any;
}

declare module 'babel-core/lib/config/loading/files/plugins' {
  declare module.exports: any;
}

declare module 'babel-core/lib/config/option-manager' {
  declare module.exports: any;
}

declare module 'babel-core/lib/config/plugin' {
  declare module.exports: any;
}

declare module 'babel-core/lib/config/removed' {
  declare module.exports: any;
}

declare module 'babel-core/lib/index' {
  declare module.exports: any;
}

declare module 'babel-core/lib/tools/build-external-helpers' {
  declare module.exports: any;
}

declare module 'babel-core/lib/transformation/file/index' {
  declare module.exports: any;
}

declare module 'babel-core/lib/transformation/file/metadata' {
  declare module.exports: any;
}

declare module 'babel-core/lib/transformation/internal-plugins/block-hoist' {
  declare module.exports: any;
}

declare module 'babel-core/lib/transformation/pipeline' {
  declare module.exports: any;
}

declare module 'babel-core/lib/transformation/plugin-pass' {
  declare module.exports: any;
}

declare module 'babel-core/lib/transformation/store' {
  declare module.exports: any;
}

declare module 'babel-core/register' {
  declare module.exports: any;
}

// Filename aliases
declare module 'babel-core/index' {
  declare module.exports: $Exports<'babel-core'>;
}
declare module 'babel-core/index.js' {
  declare module.exports: $Exports<'babel-core'>;
}
declare module 'babel-core/lib/config/build-config-chain.js' {
  declare module.exports: $Exports<'babel-core/lib/config/build-config-chain'>;
}
declare module 'babel-core/lib/config/caching.js' {
  declare module.exports: $Exports<'babel-core/lib/config/caching'>;
}
declare module 'babel-core/lib/config/helpers/environment.js' {
  declare module.exports: $Exports<'babel-core/lib/config/helpers/environment'>;
}
declare module 'babel-core/lib/config/index.js' {
  declare module.exports: $Exports<'babel-core/lib/config/index'>;
}
declare module 'babel-core/lib/config/loading/files/configuration.js' {
  declare module.exports: $Exports<'babel-core/lib/config/loading/files/configuration'>;
}
declare module 'babel-core/lib/config/loading/files/index-browser.js' {
  declare module.exports: $Exports<'babel-core/lib/config/loading/files/index-browser'>;
}
declare module 'babel-core/lib/config/loading/files/index.js' {
  declare module.exports: $Exports<'babel-core/lib/config/loading/files/index'>;
}
declare module 'babel-core/lib/config/loading/files/plugins.js' {
  declare module.exports: $Exports<'babel-core/lib/config/loading/files/plugins'>;
}
declare module 'babel-core/lib/config/option-manager.js' {
  declare module.exports: $Exports<'babel-core/lib/config/option-manager'>;
}
declare module 'babel-core/lib/config/plugin.js' {
  declare module.exports: $Exports<'babel-core/lib/config/plugin'>;
}
declare module 'babel-core/lib/config/removed.js' {
  declare module.exports: $Exports<'babel-core/lib/config/removed'>;
}
declare module 'babel-core/lib/index.js' {
  declare module.exports: $Exports<'babel-core/lib/index'>;
}
declare module 'babel-core/lib/tools/build-external-helpers.js' {
  declare module.exports: $Exports<'babel-core/lib/tools/build-external-helpers'>;
}
declare module 'babel-core/lib/transformation/file/index.js' {
  declare module.exports: $Exports<'babel-core/lib/transformation/file/index'>;
}
declare module 'babel-core/lib/transformation/file/metadata.js' {
  declare module.exports: $Exports<'babel-core/lib/transformation/file/metadata'>;
}
declare module 'babel-core/lib/transformation/internal-plugins/block-hoist.js' {
  declare module.exports: $Exports<'babel-core/lib/transformation/internal-plugins/block-hoist'>;
}
declare module 'babel-core/lib/transformation/pipeline.js' {
  declare module.exports: $Exports<'babel-core/lib/transformation/pipeline'>;
}
declare module 'babel-core/lib/transformation/plugin-pass.js' {
  declare module.exports: $Exports<'babel-core/lib/transformation/plugin-pass'>;
}
declare module 'babel-core/lib/transformation/store.js' {
  declare module.exports: $Exports<'babel-core/lib/transformation/store'>;
}
declare module 'babel-core/register.js' {
  declare module.exports: $Exports<'babel-core/register'>;
}
// flow-typed signature: 1fb22ed9a932c432e0fdd6cf6450c58e
// flow-typed version: <<STUB>>/babel-eslint_v7.2.3/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'babel-eslint'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'babel-eslint' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'babel-eslint/babylon-to-espree/attachComments' {
  declare module.exports: any;
}

declare module 'babel-eslint/babylon-to-espree/convertComments' {
  declare module.exports: any;
}

declare module 'babel-eslint/babylon-to-espree/convertTemplateType' {
  declare module.exports: any;
}

declare module 'babel-eslint/babylon-to-espree/index' {
  declare module.exports: any;
}

declare module 'babel-eslint/babylon-to-espree/toAST' {
  declare module.exports: any;
}

declare module 'babel-eslint/babylon-to-espree/toToken' {
  declare module.exports: any;
}

declare module 'babel-eslint/babylon-to-espree/toTokens' {
  declare module.exports: any;
}

// Filename aliases
declare module 'babel-eslint/babylon-to-espree/attachComments.js' {
  declare module.exports: $Exports<'babel-eslint/babylon-to-espree/attachComments'>;
}
declare module 'babel-eslint/babylon-to-espree/convertComments.js' {
  declare module.exports: $Exports<'babel-eslint/babylon-to-espree/convertComments'>;
}
declare module 'babel-eslint/babylon-to-espree/convertTemplateType.js' {
  declare module.exports: $Exports<'babel-eslint/babylon-to-espree/convertTemplateType'>;
}
declare module 'babel-eslint/babylon-to-espree/index.js' {
  declare module.exports: $Exports<'babel-eslint/babylon-to-espree/index'>;
}
declare module 'babel-eslint/babylon-to-espree/toAST.js' {
  declare module.exports: $Exports<'babel-eslint/babylon-to-espree/toAST'>;
}
declare module 'babel-eslint/babylon-to-espree/toToken.js' {
  declare module.exports: $Exports<'babel-eslint/babylon-to-espree/toToken'>;
}
declare module 'babel-eslint/babylon-to-espree/toTokens.js' {
  declare module.exports: $Exports<'babel-eslint/babylon-to-espree/toTokens'>;
}
declare module 'babel-eslint/index' {
  declare module.exports: $Exports<'babel-eslint'>;
}
declare module 'babel-eslint/index.js' {
  declare module.exports: $Exports<'babel-eslint'>;
}
// flow-typed signature: 0b1639e0bffdd43bd3a51636725d6b05
// flow-typed version: <<STUB>>/babel-generator_v^6.24.1/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'babel-generator'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'babel-generator' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'babel-generator/lib/buffer' {
  declare module.exports: any;
}

declare module 'babel-generator/lib/generators/base' {
  declare module.exports: any;
}

declare module 'babel-generator/lib/generators/classes' {
  declare module.exports: any;
}

declare module 'babel-generator/lib/generators/expressions' {
  declare module.exports: any;
}

declare module 'babel-generator/lib/generators/flow' {
  declare module.exports: any;
}

declare module 'babel-generator/lib/generators/jsx' {
  declare module.exports: any;
}

declare module 'babel-generator/lib/generators/methods' {
  declare module.exports: any;
}

declare module 'babel-generator/lib/generators/modules' {
  declare module.exports: any;
}

declare module 'babel-generator/lib/generators/statements' {
  declare module.exports: any;
}

declare module 'babel-generator/lib/generators/template-literals' {
  declare module.exports: any;
}

declare module 'babel-generator/lib/generators/types' {
  declare module.exports: any;
}

declare module 'babel-generator/lib/index' {
  declare module.exports: any;
}

declare module 'babel-generator/lib/node/index' {
  declare module.exports: any;
}

declare module 'babel-generator/lib/node/parentheses' {
  declare module.exports: any;
}

declare module 'babel-generator/lib/node/whitespace' {
  declare module.exports: any;
}

declare module 'babel-generator/lib/printer' {
  declare module.exports: any;
}

declare module 'babel-generator/lib/source-map' {
  declare module.exports: any;
}

declare module 'babel-generator/lib/whitespace' {
  declare module.exports: any;
}

// Filename aliases
declare module 'babel-generator/lib/buffer.js' {
  declare module.exports: $Exports<'babel-generator/lib/buffer'>;
}
declare module 'babel-generator/lib/generators/base.js' {
  declare module.exports: $Exports<'babel-generator/lib/generators/base'>;
}
declare module 'babel-generator/lib/generators/classes.js' {
  declare module.exports: $Exports<'babel-generator/lib/generators/classes'>;
}
declare module 'babel-generator/lib/generators/expressions.js' {
  declare module.exports: $Exports<'babel-generator/lib/generators/expressions'>;
}
declare module 'babel-generator/lib/generators/flow.js' {
  declare module.exports: $Exports<'babel-generator/lib/generators/flow'>;
}
declare module 'babel-generator/lib/generators/jsx.js' {
  declare module.exports: $Exports<'babel-generator/lib/generators/jsx'>;
}
declare module 'babel-generator/lib/generators/methods.js' {
  declare module.exports: $Exports<'babel-generator/lib/generators/methods'>;
}
declare module 'babel-generator/lib/generators/modules.js' {
  declare module.exports: $Exports<'babel-generator/lib/generators/modules'>;
}
declare module 'babel-generator/lib/generators/statements.js' {
  declare module.exports: $Exports<'babel-generator/lib/generators/statements'>;
}
declare module 'babel-generator/lib/generators/template-literals.js' {
  declare module.exports: $Exports<'babel-generator/lib/generators/template-literals'>;
}
declare module 'babel-generator/lib/generators/types.js' {
  declare module.exports: $Exports<'babel-generator/lib/generators/types'>;
}
declare module 'babel-generator/lib/index.js' {
  declare module.exports: $Exports<'babel-generator/lib/index'>;
}
declare module 'babel-generator/lib/node/index.js' {
  declare module.exports: $Exports<'babel-generator/lib/node/index'>;
}
declare module 'babel-generator/lib/node/parentheses.js' {
  declare module.exports: $Exports<'babel-generator/lib/node/parentheses'>;
}
declare module 'babel-generator/lib/node/whitespace.js' {
  declare module.exports: $Exports<'babel-generator/lib/node/whitespace'>;
}
declare module 'babel-generator/lib/printer.js' {
  declare module.exports: $Exports<'babel-generator/lib/printer'>;
}
declare module 'babel-generator/lib/source-map.js' {
  declare module.exports: $Exports<'babel-generator/lib/source-map'>;
}
declare module 'babel-generator/lib/whitespace.js' {
  declare module.exports: $Exports<'babel-generator/lib/whitespace'>;
}
// flow-typed signature: b952c89ce390b876119ae568acff43b6
// flow-typed version: <<STUB>>/babel-plugin-transform-class-properties_v7.0.0-alpha.12/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'babel-plugin-transform-class-properties'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'babel-plugin-transform-class-properties' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'babel-plugin-transform-class-properties/lib/index' {
  declare module.exports: any;
}

// Filename aliases
declare module 'babel-plugin-transform-class-properties/lib/index.js' {
  declare module.exports: $Exports<'babel-plugin-transform-class-properties/lib/index'>;
}
// flow-typed signature: 1bad2e410546918dc0e7272dc87e0a34
// flow-typed version: <<STUB>>/babel-plugin-transform-es2015-destructuring_v7.0.0-alpha.12/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'babel-plugin-transform-es2015-destructuring'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'babel-plugin-transform-es2015-destructuring' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'babel-plugin-transform-es2015-destructuring/lib/index' {
  declare module.exports: any;
}

// Filename aliases
declare module 'babel-plugin-transform-es2015-destructuring/lib/index.js' {
  declare module.exports: $Exports<'babel-plugin-transform-es2015-destructuring/lib/index'>;
}
// flow-typed signature: bc928daf5d3cf67f45a4ae5920314b13
// flow-typed version: <<STUB>>/babel-plugin-transform-es2015-modules-commonjs_v7.0.0-alpha.12/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'babel-plugin-transform-es2015-modules-commonjs'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'babel-plugin-transform-es2015-modules-commonjs' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'babel-plugin-transform-es2015-modules-commonjs/lib/index' {
  declare module.exports: any;
}

// Filename aliases
declare module 'babel-plugin-transform-es2015-modules-commonjs/lib/index.js' {
  declare module.exports: $Exports<'babel-plugin-transform-es2015-modules-commonjs/lib/index'>;
}
// flow-typed signature: 8f14e19a39c2bd3974954eea41f59410
// flow-typed version: <<STUB>>/babel-plugin-transform-flow-strip-types_v7.0.0-alpha.12/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'babel-plugin-transform-flow-strip-types'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'babel-plugin-transform-flow-strip-types' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'babel-plugin-transform-flow-strip-types/lib/index' {
  declare module.exports: any;
}

// Filename aliases
declare module 'babel-plugin-transform-flow-strip-types/lib/index.js' {
  declare module.exports: $Exports<'babel-plugin-transform-flow-strip-types/lib/index'>;
}
// flow-typed signature: 529d59fc1e249a090e2a76a3835db876
// flow-typed version: <<STUB>>/babel-plugin-transform-object-rest-spread_v7.0.0-alpha.12/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'babel-plugin-transform-object-rest-spread'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'babel-plugin-transform-object-rest-spread' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'babel-plugin-transform-object-rest-spread/lib/index' {
  declare module.exports: any;
}

// Filename aliases
declare module 'babel-plugin-transform-object-rest-spread/lib/index.js' {
  declare module.exports: $Exports<'babel-plugin-transform-object-rest-spread/lib/index'>;
}
// flow-typed signature: 1daf2e279938e1a1932c392cf775b7dc
// flow-typed version: <<STUB>>/babel-preset-react_v7.0.0-alpha.12/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'babel-preset-react'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'babel-preset-react' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'babel-preset-react/lib/index' {
  declare module.exports: any;
}

// Filename aliases
declare module 'babel-preset-react/lib/index.js' {
  declare module.exports: $Exports<'babel-preset-react/lib/index'>;
}
// flow-typed signature: d1ce10c85f971481323ed89a9b5029e0
// flow-typed version: <<STUB>>/babel-register_v7.0.0-alpha.12/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'babel-register'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'babel-register' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'babel-register/lib/browser' {
  declare module.exports: any;
}

declare module 'babel-register/lib/cache' {
  declare module.exports: any;
}

declare module 'babel-register/lib/node' {
  declare module.exports: any;
}

// Filename aliases
declare module 'babel-register/lib/browser.js' {
  declare module.exports: $Exports<'babel-register/lib/browser'>;
}
declare module 'babel-register/lib/cache.js' {
  declare module.exports: $Exports<'babel-register/lib/cache'>;
}
declare module 'babel-register/lib/node.js' {
  declare module.exports: $Exports<'babel-register/lib/node'>;
}
// flow-typed signature: b39ccdff10eaf6fe22d8bbd6a6415324
// flow-typed version: <<STUB>>/babel-traverse_v7.0.0-alpha.12/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'babel-traverse'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'babel-traverse' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'babel-traverse/lib/cache' {
  declare module.exports: any;
}

declare module 'babel-traverse/lib/context' {
  declare module.exports: any;
}

declare module 'babel-traverse/lib/hub' {
  declare module.exports: any;
}

declare module 'babel-traverse/lib/index' {
  declare module.exports: any;
}

declare module 'babel-traverse/lib/path/ancestry' {
  declare module.exports: any;
}

declare module 'babel-traverse/lib/path/comments' {
  declare module.exports: any;
}

declare module 'babel-traverse/lib/path/context' {
  declare module.exports: any;
}

declare module 'babel-traverse/lib/path/conversion' {
  declare module.exports: any;
}

declare module 'babel-traverse/lib/path/evaluation' {
  declare module.exports: any;
}

declare module 'babel-traverse/lib/path/family' {
  declare module.exports: any;
}

declare module 'babel-traverse/lib/path/index' {
  declare module.exports: any;
}

declare module 'babel-traverse/lib/path/inference/index' {
  declare module.exports: any;
}

declare module 'babel-traverse/lib/path/inference/inferer-reference' {
  declare module.exports: any;
}

declare module 'babel-traverse/lib/path/inference/inferers' {
  declare module.exports: any;
}

declare module 'babel-traverse/lib/path/introspection' {
  declare module.exports: any;
}

declare module 'babel-traverse/lib/path/lib/hoister' {
  declare module.exports: any;
}

declare module 'babel-traverse/lib/path/lib/removal-hooks' {
  declare module.exports: any;
}

declare module 'babel-traverse/lib/path/lib/virtual-types' {
  declare module.exports: any;
}

declare module 'babel-traverse/lib/path/modification' {
  declare module.exports: any;
}

declare module 'babel-traverse/lib/path/removal' {
  declare module.exports: any;
}

declare module 'babel-traverse/lib/path/replacement' {
  declare module.exports: any;
}

declare module 'babel-traverse/lib/scope/binding' {
  declare module.exports: any;
}

declare module 'babel-traverse/lib/scope/index' {
  declare module.exports: any;
}

declare module 'babel-traverse/lib/scope/lib/renamer' {
  declare module.exports: any;
}

declare module 'babel-traverse/lib/visitors' {
  declare module.exports: any;
}

// Filename aliases
declare module 'babel-traverse/lib/cache.js' {
  declare module.exports: $Exports<'babel-traverse/lib/cache'>;
}
declare module 'babel-traverse/lib/context.js' {
  declare module.exports: $Exports<'babel-traverse/lib/context'>;
}
declare module 'babel-traverse/lib/hub.js' {
  declare module.exports: $Exports<'babel-traverse/lib/hub'>;
}
declare module 'babel-traverse/lib/index.js' {
  declare module.exports: $Exports<'babel-traverse/lib/index'>;
}
declare module 'babel-traverse/lib/path/ancestry.js' {
  declare module.exports: $Exports<'babel-traverse/lib/path/ancestry'>;
}
declare module 'babel-traverse/lib/path/comments.js' {
  declare module.exports: $Exports<'babel-traverse/lib/path/comments'>;
}
declare module 'babel-traverse/lib/path/context.js' {
  declare module.exports: $Exports<'babel-traverse/lib/path/context'>;
}
declare module 'babel-traverse/lib/path/conversion.js' {
  declare module.exports: $Exports<'babel-traverse/lib/path/conversion'>;
}
declare module 'babel-traverse/lib/path/evaluation.js' {
  declare module.exports: $Exports<'babel-traverse/lib/path/evaluation'>;
}
declare module 'babel-traverse/lib/path/family.js' {
  declare module.exports: $Exports<'babel-traverse/lib/path/family'>;
}
declare module 'babel-traverse/lib/path/index.js' {
  declare module.exports: $Exports<'babel-traverse/lib/path/index'>;
}
declare module 'babel-traverse/lib/path/inference/index.js' {
  declare module.exports: $Exports<'babel-traverse/lib/path/inference/index'>;
}
declare module 'babel-traverse/lib/path/inference/inferer-reference.js' {
  declare module.exports: $Exports<'babel-traverse/lib/path/inference/inferer-reference'>;
}
declare module 'babel-traverse/lib/path/inference/inferers.js' {
  declare module.exports: $Exports<'babel-traverse/lib/path/inference/inferers'>;
}
declare module 'babel-traverse/lib/path/introspection.js' {
  declare module.exports: $Exports<'babel-traverse/lib/path/introspection'>;
}
declare module 'babel-traverse/lib/path/lib/hoister.js' {
  declare module.exports: $Exports<'babel-traverse/lib/path/lib/hoister'>;
}
declare module 'babel-traverse/lib/path/lib/removal-hooks.js' {
  declare module.exports: $Exports<'babel-traverse/lib/path/lib/removal-hooks'>;
}
declare module 'babel-traverse/lib/path/lib/virtual-types.js' {
  declare module.exports: $Exports<'babel-traverse/lib/path/lib/virtual-types'>;
}
declare module 'babel-traverse/lib/path/modification.js' {
  declare module.exports: $Exports<'babel-traverse/lib/path/modification'>;
}
declare module 'babel-traverse/lib/path/removal.js' {
  declare module.exports: $Exports<'babel-traverse/lib/path/removal'>;
}
declare module 'babel-traverse/lib/path/replacement.js' {
  declare module.exports: $Exports<'babel-traverse/lib/path/replacement'>;
}
declare module 'babel-traverse/lib/scope/binding.js' {
  declare module.exports: $Exports<'babel-traverse/lib/scope/binding'>;
}
declare module 'babel-traverse/lib/scope/index.js' {
  declare module.exports: $Exports<'babel-traverse/lib/scope/index'>;
}
declare module 'babel-traverse/lib/scope/lib/renamer.js' {
  declare module.exports: $Exports<'babel-traverse/lib/scope/lib/renamer'>;
}
declare module 'babel-traverse/lib/visitors.js' {
  declare module.exports: $Exports<'babel-traverse/lib/visitors'>;
}
// flow-typed signature: f472557a9bcea4a046c88cdcdd21ff40
// flow-typed version: <<STUB>>/babylon_v7.0.0-beta.14/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'babylon'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'babylon' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'babylon/bin/babylon' {
  declare module.exports: any;
}

declare module 'babylon/bin/generate-identifier-regex' {
  declare module.exports: any;
}

declare module 'babylon/lib/index' {
  declare module.exports: any;
}

// Filename aliases
declare module 'babylon/bin/babylon.js' {
  declare module.exports: $Exports<'babylon/bin/babylon'>;
}
declare module 'babylon/bin/generate-identifier-regex.js' {
  declare module.exports: $Exports<'babylon/bin/generate-identifier-regex'>;
}
declare module 'babylon/lib/index.js' {
  declare module.exports: $Exports<'babylon/lib/index'>;
}
// flow-typed signature: b1a2d646047879188d7e44cb218212b5
// flow-typed version: b43dff3e0e/chalk_v1.x.x/flow_>=v0.19.x

type $npm$chalk$StyleElement = {
  open: string;
  close: string;
};

type $npm$chalk$Chain = $npm$chalk$Style & (...text: any[]) => string;

type $npm$chalk$Style = {
  // General
  reset: $npm$chalk$Chain;
  bold: $npm$chalk$Chain;
  dim: $npm$chalk$Chain;
  italic: $npm$chalk$Chain;
  underline: $npm$chalk$Chain;
  inverse: $npm$chalk$Chain;
  strikethrough: $npm$chalk$Chain;

  // Text colors
  black: $npm$chalk$Chain;
  red: $npm$chalk$Chain;
  green: $npm$chalk$Chain;
  yellow: $npm$chalk$Chain;
  blue: $npm$chalk$Chain;
  magenta: $npm$chalk$Chain;
  cyan: $npm$chalk$Chain;
  white: $npm$chalk$Chain;
  gray: $npm$chalk$Chain;
  grey: $npm$chalk$Chain;

  // Background colors
  bgBlack: $npm$chalk$Chain;
  bgRed: $npm$chalk$Chain;
  bgGreen: $npm$chalk$Chain;
  bgYellow: $npm$chalk$Chain;
  bgBlue: $npm$chalk$Chain;
  bgMagenta: $npm$chalk$Chain;
  bgCyan: $npm$chalk$Chain;
  bgWhite: $npm$chalk$Chain;
};

type $npm$chalk$StyleMap = {
  // General
  reset: $npm$chalk$StyleElement;
  bold: $npm$chalk$StyleElement;
  dim: $npm$chalk$StyleElement;
  italic: $npm$chalk$StyleElement;
  underline: $npm$chalk$StyleElement;
  inverse: $npm$chalk$StyleElement;
  strikethrough: $npm$chalk$StyleElement;

  // Text colors
  black: $npm$chalk$StyleElement;
  red: $npm$chalk$StyleElement;
  green: $npm$chalk$StyleElement;
  yellow: $npm$chalk$StyleElement;
  blue: $npm$chalk$StyleElement;
  magenta: $npm$chalk$StyleElement;
  cyan: $npm$chalk$StyleElement;
  white: $npm$chalk$StyleElement;
  gray: $npm$chalk$StyleElement;

  // Background colors
  bgBlack: $npm$chalk$StyleElement;
  bgRed: $npm$chalk$StyleElement;
  bgGreen: $npm$chalk$StyleElement;
  bgYellow: $npm$chalk$StyleElement;
  bgBlue: $npm$chalk$StyleElement;
  bgMagenta: $npm$chalk$StyleElement;
  bgCyan: $npm$chalk$StyleElement;
  bgWhite: $npm$chalk$StyleElement;
};

declare module "chalk" {
  declare var enabled: boolean;
  declare var supportsColor: boolean;
  declare var styles: $npm$chalk$StyleMap;

  declare function stripColor(value: string): any;
  declare function hasColor(str: string): boolean;

  // General
  declare var reset: $npm$chalk$Chain;
  declare var bold: $npm$chalk$Chain;
  declare var dim: $npm$chalk$Chain;
  declare var italic: $npm$chalk$Chain;
  declare var underline: $npm$chalk$Chain;
  declare var inverse: $npm$chalk$Chain;
  declare var strikethrough: $npm$chalk$Chain;

  // Text colors
  declare var black: $npm$chalk$Chain;
  declare var red: $npm$chalk$Chain;
  declare var green: $npm$chalk$Chain;
  declare var yellow: $npm$chalk$Chain;
  declare var blue: $npm$chalk$Chain;
  declare var magenta: $npm$chalk$Chain;
  declare var cyan: $npm$chalk$Chain;
  declare var white: $npm$chalk$Chain;
  declare var gray: $npm$chalk$Chain;
  declare var grey: $npm$chalk$Chain;

  // Background colors
  declare var bgBlack: $npm$chalk$Chain;
  declare var bgRed: $npm$chalk$Chain;
  declare var bgGreen: $npm$chalk$Chain;
  declare var bgYellow: $npm$chalk$Chain;
  declare var bgBlue: $npm$chalk$Chain;
  declare var bgMagenta: $npm$chalk$Chain;
  declare var bgCyan: $npm$chalk$Chain;
  declare var bgWhite: $npm$chalk$Chain;
}
// flow-typed signature: 56334b937a6991fded5d2f2312821ccd
// flow-typed version: <<STUB>>/codemirror_v^5.25.0/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'codemirror'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'codemirror' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'codemirror/addon/comment/comment' {
  declare module.exports: any;
}

declare module 'codemirror/addon/comment/continuecomment' {
  declare module.exports: any;
}

declare module 'codemirror/addon/dialog/dialog' {
  declare module.exports: any;
}

declare module 'codemirror/addon/display/autorefresh' {
  declare module.exports: any;
}

declare module 'codemirror/addon/display/fullscreen' {
  declare module.exports: any;
}

declare module 'codemirror/addon/display/panel' {
  declare module.exports: any;
}

declare module 'codemirror/addon/display/placeholder' {
  declare module.exports: any;
}

declare module 'codemirror/addon/display/rulers' {
  declare module.exports: any;
}

declare module 'codemirror/addon/edit/closebrackets' {
  declare module.exports: any;
}

declare module 'codemirror/addon/edit/closetag' {
  declare module.exports: any;
}

declare module 'codemirror/addon/edit/continuelist' {
  declare module.exports: any;
}

declare module 'codemirror/addon/edit/matchbrackets' {
  declare module.exports: any;
}

declare module 'codemirror/addon/edit/matchtags' {
  declare module.exports: any;
}

declare module 'codemirror/addon/edit/trailingspace' {
  declare module.exports: any;
}

declare module 'codemirror/addon/fold/brace-fold' {
  declare module.exports: any;
}

declare module 'codemirror/addon/fold/comment-fold' {
  declare module.exports: any;
}

declare module 'codemirror/addon/fold/foldcode' {
  declare module.exports: any;
}

declare module 'codemirror/addon/fold/foldgutter' {
  declare module.exports: any;
}

declare module 'codemirror/addon/fold/indent-fold' {
  declare module.exports: any;
}

declare module 'codemirror/addon/fold/markdown-fold' {
  declare module.exports: any;
}

declare module 'codemirror/addon/fold/xml-fold' {
  declare module.exports: any;
}

declare module 'codemirror/addon/hint/anyword-hint' {
  declare module.exports: any;
}

declare module 'codemirror/addon/hint/css-hint' {
  declare module.exports: any;
}

declare module 'codemirror/addon/hint/html-hint' {
  declare module.exports: any;
}

declare module 'codemirror/addon/hint/javascript-hint' {
  declare module.exports: any;
}

declare module 'codemirror/addon/hint/show-hint' {
  declare module.exports: any;
}

declare module 'codemirror/addon/hint/sql-hint' {
  declare module.exports: any;
}

declare module 'codemirror/addon/hint/xml-hint' {
  declare module.exports: any;
}

declare module 'codemirror/addon/lint/coffeescript-lint' {
  declare module.exports: any;
}

declare module 'codemirror/addon/lint/css-lint' {
  declare module.exports: any;
}

declare module 'codemirror/addon/lint/html-lint' {
  declare module.exports: any;
}

declare module 'codemirror/addon/lint/javascript-lint' {
  declare module.exports: any;
}

declare module 'codemirror/addon/lint/json-lint' {
  declare module.exports: any;
}

declare module 'codemirror/addon/lint/lint' {
  declare module.exports: any;
}

declare module 'codemirror/addon/lint/yaml-lint' {
  declare module.exports: any;
}

declare module 'codemirror/addon/merge/merge' {
  declare module.exports: any;
}

declare module 'codemirror/addon/mode/loadmode' {
  declare module.exports: any;
}

declare module 'codemirror/addon/mode/multiplex_test' {
  declare module.exports: any;
}

declare module 'codemirror/addon/mode/multiplex' {
  declare module.exports: any;
}

declare module 'codemirror/addon/mode/overlay' {
  declare module.exports: any;
}

declare module 'codemirror/addon/mode/simple' {
  declare module.exports: any;
}

declare module 'codemirror/addon/runmode/colorize' {
  declare module.exports: any;
}

declare module 'codemirror/addon/runmode/runmode-standalone' {
  declare module.exports: any;
}

declare module 'codemirror/addon/runmode/runmode' {
  declare module.exports: any;
}

declare module 'codemirror/addon/runmode/runmode.node' {
  declare module.exports: any;
}

declare module 'codemirror/addon/scroll/annotatescrollbar' {
  declare module.exports: any;
}

declare module 'codemirror/addon/scroll/scrollpastend' {
  declare module.exports: any;
}

declare module 'codemirror/addon/scroll/simplescrollbars' {
  declare module.exports: any;
}

declare module 'codemirror/addon/search/jump-to-line' {
  declare module.exports: any;
}

declare module 'codemirror/addon/search/match-highlighter' {
  declare module.exports: any;
}

declare module 'codemirror/addon/search/matchesonscrollbar' {
  declare module.exports: any;
}

declare module 'codemirror/addon/search/search' {
  declare module.exports: any;
}

declare module 'codemirror/addon/search/searchcursor' {
  declare module.exports: any;
}

declare module 'codemirror/addon/selection/active-line' {
  declare module.exports: any;
}

declare module 'codemirror/addon/selection/mark-selection' {
  declare module.exports: any;
}

declare module 'codemirror/addon/selection/selection-pointer' {
  declare module.exports: any;
}

declare module 'codemirror/addon/tern/tern' {
  declare module.exports: any;
}

declare module 'codemirror/addon/tern/worker' {
  declare module.exports: any;
}

declare module 'codemirror/addon/wrap/hardwrap' {
  declare module.exports: any;
}

declare module 'codemirror/keymap/emacs' {
  declare module.exports: any;
}

declare module 'codemirror/keymap/sublime' {
  declare module.exports: any;
}

declare module 'codemirror/keymap/vim' {
  declare module.exports: any;
}

declare module 'codemirror/lib/codemirror' {
  declare module.exports: any;
}

declare module 'codemirror/mode/apl/apl' {
  declare module.exports: any;
}

declare module 'codemirror/mode/asciiarmor/asciiarmor' {
  declare module.exports: any;
}

declare module 'codemirror/mode/asn.1/asn.1' {
  declare module.exports: any;
}

declare module 'codemirror/mode/asterisk/asterisk' {
  declare module.exports: any;
}

declare module 'codemirror/mode/brainfuck/brainfuck' {
  declare module.exports: any;
}

declare module 'codemirror/mode/clike/clike' {
  declare module.exports: any;
}

declare module 'codemirror/mode/clojure/clojure' {
  declare module.exports: any;
}

declare module 'codemirror/mode/cmake/cmake' {
  declare module.exports: any;
}

declare module 'codemirror/mode/cobol/cobol' {
  declare module.exports: any;
}

declare module 'codemirror/mode/coffeescript/coffeescript' {
  declare module.exports: any;
}

declare module 'codemirror/mode/commonlisp/commonlisp' {
  declare module.exports: any;
}

declare module 'codemirror/mode/crystal/crystal' {
  declare module.exports: any;
}

declare module 'codemirror/mode/css/css' {
  declare module.exports: any;
}

declare module 'codemirror/mode/cypher/cypher' {
  declare module.exports: any;
}

declare module 'codemirror/mode/d/d' {
  declare module.exports: any;
}

declare module 'codemirror/mode/dart/dart' {
  declare module.exports: any;
}

declare module 'codemirror/mode/diff/diff' {
  declare module.exports: any;
}

declare module 'codemirror/mode/django/django' {
  declare module.exports: any;
}

declare module 'codemirror/mode/dockerfile/dockerfile' {
  declare module.exports: any;
}

declare module 'codemirror/mode/dtd/dtd' {
  declare module.exports: any;
}

declare module 'codemirror/mode/dylan/dylan' {
  declare module.exports: any;
}

declare module 'codemirror/mode/ebnf/ebnf' {
  declare module.exports: any;
}

declare module 'codemirror/mode/ecl/ecl' {
  declare module.exports: any;
}

declare module 'codemirror/mode/eiffel/eiffel' {
  declare module.exports: any;
}

declare module 'codemirror/mode/elm/elm' {
  declare module.exports: any;
}

declare module 'codemirror/mode/erlang/erlang' {
  declare module.exports: any;
}

declare module 'codemirror/mode/factor/factor' {
  declare module.exports: any;
}

declare module 'codemirror/mode/fcl/fcl' {
  declare module.exports: any;
}

declare module 'codemirror/mode/forth/forth' {
  declare module.exports: any;
}

declare module 'codemirror/mode/fortran/fortran' {
  declare module.exports: any;
}

declare module 'codemirror/mode/gas/gas' {
  declare module.exports: any;
}

declare module 'codemirror/mode/gfm/gfm' {
  declare module.exports: any;
}

declare module 'codemirror/mode/gherkin/gherkin' {
  declare module.exports: any;
}

declare module 'codemirror/mode/go/go' {
  declare module.exports: any;
}

declare module 'codemirror/mode/groovy/groovy' {
  declare module.exports: any;
}

declare module 'codemirror/mode/haml/haml' {
  declare module.exports: any;
}

declare module 'codemirror/mode/handlebars/handlebars' {
  declare module.exports: any;
}

declare module 'codemirror/mode/haskell-literate/haskell-literate' {
  declare module.exports: any;
}

declare module 'codemirror/mode/haskell/haskell' {
  declare module.exports: any;
}

declare module 'codemirror/mode/haxe/haxe' {
  declare module.exports: any;
}

declare module 'codemirror/mode/htmlembedded/htmlembedded' {
  declare module.exports: any;
}

declare module 'codemirror/mode/htmlmixed/htmlmixed' {
  declare module.exports: any;
}

declare module 'codemirror/mode/http/http' {
  declare module.exports: any;
}

declare module 'codemirror/mode/idl/idl' {
  declare module.exports: any;
}

declare module 'codemirror/mode/javascript/javascript' {
  declare module.exports: any;
}

declare module 'codemirror/mode/jinja2/jinja2' {
  declare module.exports: any;
}

declare module 'codemirror/mode/jsx/jsx' {
  declare module.exports: any;
}

declare module 'codemirror/mode/julia/julia' {
  declare module.exports: any;
}

declare module 'codemirror/mode/livescript/livescript' {
  declare module.exports: any;
}

declare module 'codemirror/mode/lua/lua' {
  declare module.exports: any;
}

declare module 'codemirror/mode/markdown/markdown' {
  declare module.exports: any;
}

declare module 'codemirror/mode/mathematica/mathematica' {
  declare module.exports: any;
}

declare module 'codemirror/mode/mbox/mbox' {
  declare module.exports: any;
}

declare module 'codemirror/mode/meta' {
  declare module.exports: any;
}

declare module 'codemirror/mode/mirc/mirc' {
  declare module.exports: any;
}

declare module 'codemirror/mode/mllike/mllike' {
  declare module.exports: any;
}

declare module 'codemirror/mode/modelica/modelica' {
  declare module.exports: any;
}

declare module 'codemirror/mode/mscgen/mscgen' {
  declare module.exports: any;
}

declare module 'codemirror/mode/mumps/mumps' {
  declare module.exports: any;
}

declare module 'codemirror/mode/nginx/nginx' {
  declare module.exports: any;
}

declare module 'codemirror/mode/nsis/nsis' {
  declare module.exports: any;
}

declare module 'codemirror/mode/ntriples/ntriples' {
  declare module.exports: any;
}

declare module 'codemirror/mode/octave/octave' {
  declare module.exports: any;
}

declare module 'codemirror/mode/oz/oz' {
  declare module.exports: any;
}

declare module 'codemirror/mode/pascal/pascal' {
  declare module.exports: any;
}

declare module 'codemirror/mode/pegjs/pegjs' {
  declare module.exports: any;
}

declare module 'codemirror/mode/perl/perl' {
  declare module.exports: any;
}

declare module 'codemirror/mode/php/php' {
  declare module.exports: any;
}

declare module 'codemirror/mode/pig/pig' {
  declare module.exports: any;
}

declare module 'codemirror/mode/powershell/powershell' {
  declare module.exports: any;
}

declare module 'codemirror/mode/properties/properties' {
  declare module.exports: any;
}

declare module 'codemirror/mode/protobuf/protobuf' {
  declare module.exports: any;
}

declare module 'codemirror/mode/pug/pug' {
  declare module.exports: any;
}

declare module 'codemirror/mode/puppet/puppet' {
  declare module.exports: any;
}

declare module 'codemirror/mode/python/python' {
  declare module.exports: any;
}

declare module 'codemirror/mode/q/q' {
  declare module.exports: any;
}

declare module 'codemirror/mode/r/r' {
  declare module.exports: any;
}

declare module 'codemirror/mode/rpm/rpm' {
  declare module.exports: any;
}

declare module 'codemirror/mode/rst/rst' {
  declare module.exports: any;
}

declare module 'codemirror/mode/ruby/ruby' {
  declare module.exports: any;
}

declare module 'codemirror/mode/rust/rust' {
  declare module.exports: any;
}

declare module 'codemirror/mode/sas/sas' {
  declare module.exports: any;
}

declare module 'codemirror/mode/sass/sass' {
  declare module.exports: any;
}

declare module 'codemirror/mode/scheme/scheme' {
  declare module.exports: any;
}

declare module 'codemirror/mode/shell/shell' {
  declare module.exports: any;
}

declare module 'codemirror/mode/sieve/sieve' {
  declare module.exports: any;
}

declare module 'codemirror/mode/slim/slim' {
  declare module.exports: any;
}

declare module 'codemirror/mode/smalltalk/smalltalk' {
  declare module.exports: any;
}

declare module 'codemirror/mode/smarty/smarty' {
  declare module.exports: any;
}

declare module 'codemirror/mode/solr/solr' {
  declare module.exports: any;
}

declare module 'codemirror/mode/soy/soy' {
  declare module.exports: any;
}

declare module 'codemirror/mode/sparql/sparql' {
  declare module.exports: any;
}

declare module 'codemirror/mode/spreadsheet/spreadsheet' {
  declare module.exports: any;
}

declare module 'codemirror/mode/sql/sql' {
  declare module.exports: any;
}

declare module 'codemirror/mode/stex/stex' {
  declare module.exports: any;
}

declare module 'codemirror/mode/stylus/stylus' {
  declare module.exports: any;
}

declare module 'codemirror/mode/swift/swift' {
  declare module.exports: any;
}

declare module 'codemirror/mode/tcl/tcl' {
  declare module.exports: any;
}

declare module 'codemirror/mode/textile/textile' {
  declare module.exports: any;
}

declare module 'codemirror/mode/tiddlywiki/tiddlywiki' {
  declare module.exports: any;
}

declare module 'codemirror/mode/tiki/tiki' {
  declare module.exports: any;
}

declare module 'codemirror/mode/toml/toml' {
  declare module.exports: any;
}

declare module 'codemirror/mode/tornado/tornado' {
  declare module.exports: any;
}

declare module 'codemirror/mode/troff/troff' {
  declare module.exports: any;
}

declare module 'codemirror/mode/ttcn-cfg/ttcn-cfg' {
  declare module.exports: any;
}

declare module 'codemirror/mode/ttcn/ttcn' {
  declare module.exports: any;
}

declare module 'codemirror/mode/turtle/turtle' {
  declare module.exports: any;
}

declare module 'codemirror/mode/twig/twig' {
  declare module.exports: any;
}

declare module 'codemirror/mode/vb/vb' {
  declare module.exports: any;
}

declare module 'codemirror/mode/vbscript/vbscript' {
  declare module.exports: any;
}

declare module 'codemirror/mode/velocity/velocity' {
  declare module.exports: any;
}

declare module 'codemirror/mode/verilog/verilog' {
  declare module.exports: any;
}

declare module 'codemirror/mode/vhdl/vhdl' {
  declare module.exports: any;
}

declare module 'codemirror/mode/vue/vue' {
  declare module.exports: any;
}

declare module 'codemirror/mode/webidl/webidl' {
  declare module.exports: any;
}

declare module 'codemirror/mode/xml/xml' {
  declare module.exports: any;
}

declare module 'codemirror/mode/xquery/xquery' {
  declare module.exports: any;
}

declare module 'codemirror/mode/yacas/yacas' {
  declare module.exports: any;
}

declare module 'codemirror/mode/yaml-frontmatter/yaml-frontmatter' {
  declare module.exports: any;
}

declare module 'codemirror/mode/yaml/yaml' {
  declare module.exports: any;
}

declare module 'codemirror/mode/z80/z80' {
  declare module.exports: any;
}

declare module 'codemirror/rollup.config' {
  declare module.exports: any;
}

declare module 'codemirror/src/codemirror' {
  declare module.exports: any;
}

declare module 'codemirror/src/display/Display' {
  declare module.exports: any;
}

declare module 'codemirror/src/display/focus' {
  declare module.exports: any;
}

declare module 'codemirror/src/display/gutters' {
  declare module.exports: any;
}

declare module 'codemirror/src/display/highlight_worker' {
  declare module.exports: any;
}

declare module 'codemirror/src/display/line_numbers' {
  declare module.exports: any;
}

declare module 'codemirror/src/display/mode_state' {
  declare module.exports: any;
}

declare module 'codemirror/src/display/operations' {
  declare module.exports: any;
}

declare module 'codemirror/src/display/scroll_events' {
  declare module.exports: any;
}

declare module 'codemirror/src/display/scrollbars' {
  declare module.exports: any;
}

declare module 'codemirror/src/display/scrolling' {
  declare module.exports: any;
}

declare module 'codemirror/src/display/selection' {
  declare module.exports: any;
}

declare module 'codemirror/src/display/update_display' {
  declare module.exports: any;
}

declare module 'codemirror/src/display/update_line' {
  declare module.exports: any;
}

declare module 'codemirror/src/display/update_lines' {
  declare module.exports: any;
}

declare module 'codemirror/src/display/view_tracking' {
  declare module.exports: any;
}

declare module 'codemirror/src/edit/CodeMirror' {
  declare module.exports: any;
}

declare module 'codemirror/src/edit/commands' {
  declare module.exports: any;
}

declare module 'codemirror/src/edit/deleteNearSelection' {
  declare module.exports: any;
}

declare module 'codemirror/src/edit/drop_events' {
  declare module.exports: any;
}

declare module 'codemirror/src/edit/fromTextArea' {
  declare module.exports: any;
}

declare module 'codemirror/src/edit/global_events' {
  declare module.exports: any;
}

declare module 'codemirror/src/edit/key_events' {
  declare module.exports: any;
}

declare module 'codemirror/src/edit/legacy' {
  declare module.exports: any;
}

declare module 'codemirror/src/edit/main' {
  declare module.exports: any;
}

declare module 'codemirror/src/edit/methods' {
  declare module.exports: any;
}

declare module 'codemirror/src/edit/mouse_events' {
  declare module.exports: any;
}

declare module 'codemirror/src/edit/options' {
  declare module.exports: any;
}

declare module 'codemirror/src/edit/utils' {
  declare module.exports: any;
}

declare module 'codemirror/src/input/ContentEditableInput' {
  declare module.exports: any;
}

declare module 'codemirror/src/input/indent' {
  declare module.exports: any;
}

declare module 'codemirror/src/input/input' {
  declare module.exports: any;
}

declare module 'codemirror/src/input/keymap' {
  declare module.exports: any;
}

declare module 'codemirror/src/input/keynames' {
  declare module.exports: any;
}

declare module 'codemirror/src/input/movement' {
  declare module.exports: any;
}

declare module 'codemirror/src/input/TextareaInput' {
  declare module.exports: any;
}

declare module 'codemirror/src/line/highlight' {
  declare module.exports: any;
}

declare module 'codemirror/src/line/line_data' {
  declare module.exports: any;
}

declare module 'codemirror/src/line/pos' {
  declare module.exports: any;
}

declare module 'codemirror/src/line/saw_special_spans' {
  declare module.exports: any;
}

declare module 'codemirror/src/line/spans' {
  declare module.exports: any;
}

declare module 'codemirror/src/line/utils_line' {
  declare module.exports: any;
}

declare module 'codemirror/src/measurement/position_measurement' {
  declare module.exports: any;
}

declare module 'codemirror/src/measurement/widgets' {
  declare module.exports: any;
}

declare module 'codemirror/src/model/change_measurement' {
  declare module.exports: any;
}

declare module 'codemirror/src/model/changes' {
  declare module.exports: any;
}

declare module 'codemirror/src/model/chunk' {
  declare module.exports: any;
}

declare module 'codemirror/src/model/Doc' {
  declare module.exports: any;
}

declare module 'codemirror/src/model/document_data' {
  declare module.exports: any;
}

declare module 'codemirror/src/model/history' {
  declare module.exports: any;
}

declare module 'codemirror/src/model/line_widget' {
  declare module.exports: any;
}

declare module 'codemirror/src/model/mark_text' {
  declare module.exports: any;
}

declare module 'codemirror/src/model/selection_updates' {
  declare module.exports: any;
}

declare module 'codemirror/src/model/selection' {
  declare module.exports: any;
}

declare module 'codemirror/src/modes' {
  declare module.exports: any;
}

declare module 'codemirror/src/util/bidi' {
  declare module.exports: any;
}

declare module 'codemirror/src/util/browser' {
  declare module.exports: any;
}

declare module 'codemirror/src/util/dom' {
  declare module.exports: any;
}

declare module 'codemirror/src/util/event' {
  declare module.exports: any;
}

declare module 'codemirror/src/util/feature_detection' {
  declare module.exports: any;
}

declare module 'codemirror/src/util/misc' {
  declare module.exports: any;
}

declare module 'codemirror/src/util/operation_group' {
  declare module.exports: any;
}

declare module 'codemirror/src/util/StringStream' {
  declare module.exports: any;
}

// Filename aliases
declare module 'codemirror/addon/comment/comment.js' {
  declare module.exports: $Exports<'codemirror/addon/comment/comment'>;
}
declare module 'codemirror/addon/comment/continuecomment.js' {
  declare module.exports: $Exports<'codemirror/addon/comment/continuecomment'>;
}
declare module 'codemirror/addon/dialog/dialog.js' {
  declare module.exports: $Exports<'codemirror/addon/dialog/dialog'>;
}
declare module 'codemirror/addon/display/autorefresh.js' {
  declare module.exports: $Exports<'codemirror/addon/display/autorefresh'>;
}
declare module 'codemirror/addon/display/fullscreen.js' {
  declare module.exports: $Exports<'codemirror/addon/display/fullscreen'>;
}
declare module 'codemirror/addon/display/panel.js' {
  declare module.exports: $Exports<'codemirror/addon/display/panel'>;
}
declare module 'codemirror/addon/display/placeholder.js' {
  declare module.exports: $Exports<'codemirror/addon/display/placeholder'>;
}
declare module 'codemirror/addon/display/rulers.js' {
  declare module.exports: $Exports<'codemirror/addon/display/rulers'>;
}
declare module 'codemirror/addon/edit/closebrackets.js' {
  declare module.exports: $Exports<'codemirror/addon/edit/closebrackets'>;
}
declare module 'codemirror/addon/edit/closetag.js' {
  declare module.exports: $Exports<'codemirror/addon/edit/closetag'>;
}
declare module 'codemirror/addon/edit/continuelist.js' {
  declare module.exports: $Exports<'codemirror/addon/edit/continuelist'>;
}
declare module 'codemirror/addon/edit/matchbrackets.js' {
  declare module.exports: $Exports<'codemirror/addon/edit/matchbrackets'>;
}
declare module 'codemirror/addon/edit/matchtags.js' {
  declare module.exports: $Exports<'codemirror/addon/edit/matchtags'>;
}
declare module 'codemirror/addon/edit/trailingspace.js' {
  declare module.exports: $Exports<'codemirror/addon/edit/trailingspace'>;
}
declare module 'codemirror/addon/fold/brace-fold.js' {
  declare module.exports: $Exports<'codemirror/addon/fold/brace-fold'>;
}
declare module 'codemirror/addon/fold/comment-fold.js' {
  declare module.exports: $Exports<'codemirror/addon/fold/comment-fold'>;
}
declare module 'codemirror/addon/fold/foldcode.js' {
  declare module.exports: $Exports<'codemirror/addon/fold/foldcode'>;
}
declare module 'codemirror/addon/fold/foldgutter.js' {
  declare module.exports: $Exports<'codemirror/addon/fold/foldgutter'>;
}
declare module 'codemirror/addon/fold/indent-fold.js' {
  declare module.exports: $Exports<'codemirror/addon/fold/indent-fold'>;
}
declare module 'codemirror/addon/fold/markdown-fold.js' {
  declare module.exports: $Exports<'codemirror/addon/fold/markdown-fold'>;
}
declare module 'codemirror/addon/fold/xml-fold.js' {
  declare module.exports: $Exports<'codemirror/addon/fold/xml-fold'>;
}
declare module 'codemirror/addon/hint/anyword-hint.js' {
  declare module.exports: $Exports<'codemirror/addon/hint/anyword-hint'>;
}
declare module 'codemirror/addon/hint/css-hint.js' {
  declare module.exports: $Exports<'codemirror/addon/hint/css-hint'>;
}
declare module 'codemirror/addon/hint/html-hint.js' {
  declare module.exports: $Exports<'codemirror/addon/hint/html-hint'>;
}
declare module 'codemirror/addon/hint/javascript-hint.js' {
  declare module.exports: $Exports<'codemirror/addon/hint/javascript-hint'>;
}
declare module 'codemirror/addon/hint/show-hint.js' {
  declare module.exports: $Exports<'codemirror/addon/hint/show-hint'>;
}
declare module 'codemirror/addon/hint/sql-hint.js' {
  declare module.exports: $Exports<'codemirror/addon/hint/sql-hint'>;
}
declare module 'codemirror/addon/hint/xml-hint.js' {
  declare module.exports: $Exports<'codemirror/addon/hint/xml-hint'>;
}
declare module 'codemirror/addon/lint/coffeescript-lint.js' {
  declare module.exports: $Exports<'codemirror/addon/lint/coffeescript-lint'>;
}
declare module 'codemirror/addon/lint/css-lint.js' {
  declare module.exports: $Exports<'codemirror/addon/lint/css-lint'>;
}
declare module 'codemirror/addon/lint/html-lint.js' {
  declare module.exports: $Exports<'codemirror/addon/lint/html-lint'>;
}
declare module 'codemirror/addon/lint/javascript-lint.js' {
  declare module.exports: $Exports<'codemirror/addon/lint/javascript-lint'>;
}
declare module 'codemirror/addon/lint/json-lint.js' {
  declare module.exports: $Exports<'codemirror/addon/lint/json-lint'>;
}
declare module 'codemirror/addon/lint/lint.js' {
  declare module.exports: $Exports<'codemirror/addon/lint/lint'>;
}
declare module 'codemirror/addon/lint/yaml-lint.js' {
  declare module.exports: $Exports<'codemirror/addon/lint/yaml-lint'>;
}
declare module 'codemirror/addon/merge/merge.js' {
  declare module.exports: $Exports<'codemirror/addon/merge/merge'>;
}
declare module 'codemirror/addon/mode/loadmode.js' {
  declare module.exports: $Exports<'codemirror/addon/mode/loadmode'>;
}
declare module 'codemirror/addon/mode/multiplex_test.js' {
  declare module.exports: $Exports<'codemirror/addon/mode/multiplex_test'>;
}
declare module 'codemirror/addon/mode/multiplex.js' {
  declare module.exports: $Exports<'codemirror/addon/mode/multiplex'>;
}
declare module 'codemirror/addon/mode/overlay.js' {
  declare module.exports: $Exports<'codemirror/addon/mode/overlay'>;
}
declare module 'codemirror/addon/mode/simple.js' {
  declare module.exports: $Exports<'codemirror/addon/mode/simple'>;
}
declare module 'codemirror/addon/runmode/colorize.js' {
  declare module.exports: $Exports<'codemirror/addon/runmode/colorize'>;
}
declare module 'codemirror/addon/runmode/runmode-standalone.js' {
  declare module.exports: $Exports<'codemirror/addon/runmode/runmode-standalone'>;
}
declare module 'codemirror/addon/runmode/runmode.js' {
  declare module.exports: $Exports<'codemirror/addon/runmode/runmode'>;
}
declare module 'codemirror/addon/runmode/runmode.node.js' {
  declare module.exports: $Exports<'codemirror/addon/runmode/runmode.node'>;
}
declare module 'codemirror/addon/scroll/annotatescrollbar.js' {
  declare module.exports: $Exports<'codemirror/addon/scroll/annotatescrollbar'>;
}
declare module 'codemirror/addon/scroll/scrollpastend.js' {
  declare module.exports: $Exports<'codemirror/addon/scroll/scrollpastend'>;
}
declare module 'codemirror/addon/scroll/simplescrollbars.js' {
  declare module.exports: $Exports<'codemirror/addon/scroll/simplescrollbars'>;
}
declare module 'codemirror/addon/search/jump-to-line.js' {
  declare module.exports: $Exports<'codemirror/addon/search/jump-to-line'>;
}
declare module 'codemirror/addon/search/match-highlighter.js' {
  declare module.exports: $Exports<'codemirror/addon/search/match-highlighter'>;
}
declare module 'codemirror/addon/search/matchesonscrollbar.js' {
  declare module.exports: $Exports<'codemirror/addon/search/matchesonscrollbar'>;
}
declare module 'codemirror/addon/search/search.js' {
  declare module.exports: $Exports<'codemirror/addon/search/search'>;
}
declare module 'codemirror/addon/search/searchcursor.js' {
  declare module.exports: $Exports<'codemirror/addon/search/searchcursor'>;
}
declare module 'codemirror/addon/selection/active-line.js' {
  declare module.exports: $Exports<'codemirror/addon/selection/active-line'>;
}
declare module 'codemirror/addon/selection/mark-selection.js' {
  declare module.exports: $Exports<'codemirror/addon/selection/mark-selection'>;
}
declare module 'codemirror/addon/selection/selection-pointer.js' {
  declare module.exports: $Exports<'codemirror/addon/selection/selection-pointer'>;
}
declare module 'codemirror/addon/tern/tern.js' {
  declare module.exports: $Exports<'codemirror/addon/tern/tern'>;
}
declare module 'codemirror/addon/tern/worker.js' {
  declare module.exports: $Exports<'codemirror/addon/tern/worker'>;
}
declare module 'codemirror/addon/wrap/hardwrap.js' {
  declare module.exports: $Exports<'codemirror/addon/wrap/hardwrap'>;
}
declare module 'codemirror/keymap/emacs.js' {
  declare module.exports: $Exports<'codemirror/keymap/emacs'>;
}
declare module 'codemirror/keymap/sublime.js' {
  declare module.exports: $Exports<'codemirror/keymap/sublime'>;
}
declare module 'codemirror/keymap/vim.js' {
  declare module.exports: $Exports<'codemirror/keymap/vim'>;
}
declare module 'codemirror/lib/codemirror.js' {
  declare module.exports: $Exports<'codemirror/lib/codemirror'>;
}
declare module 'codemirror/mode/apl/apl.js' {
  declare module.exports: $Exports<'codemirror/mode/apl/apl'>;
}
declare module 'codemirror/mode/asciiarmor/asciiarmor.js' {
  declare module.exports: $Exports<'codemirror/mode/asciiarmor/asciiarmor'>;
}
declare module 'codemirror/mode/asn.1/asn.1.js' {
  declare module.exports: $Exports<'codemirror/mode/asn.1/asn.1'>;
}
declare module 'codemirror/mode/asterisk/asterisk.js' {
  declare module.exports: $Exports<'codemirror/mode/asterisk/asterisk'>;
}
declare module 'codemirror/mode/brainfuck/brainfuck.js' {
  declare module.exports: $Exports<'codemirror/mode/brainfuck/brainfuck'>;
}
declare module 'codemirror/mode/clike/clike.js' {
  declare module.exports: $Exports<'codemirror/mode/clike/clike'>;
}
declare module 'codemirror/mode/clojure/clojure.js' {
  declare module.exports: $Exports<'codemirror/mode/clojure/clojure'>;
}
declare module 'codemirror/mode/cmake/cmake.js' {
  declare module.exports: $Exports<'codemirror/mode/cmake/cmake'>;
}
declare module 'codemirror/mode/cobol/cobol.js' {
  declare module.exports: $Exports<'codemirror/mode/cobol/cobol'>;
}
declare module 'codemirror/mode/coffeescript/coffeescript.js' {
  declare module.exports: $Exports<'codemirror/mode/coffeescript/coffeescript'>;
}
declare module 'codemirror/mode/commonlisp/commonlisp.js' {
  declare module.exports: $Exports<'codemirror/mode/commonlisp/commonlisp'>;
}
declare module 'codemirror/mode/crystal/crystal.js' {
  declare module.exports: $Exports<'codemirror/mode/crystal/crystal'>;
}
declare module 'codemirror/mode/css/css.js' {
  declare module.exports: $Exports<'codemirror/mode/css/css'>;
}
declare module 'codemirror/mode/cypher/cypher.js' {
  declare module.exports: $Exports<'codemirror/mode/cypher/cypher'>;
}
declare module 'codemirror/mode/d/d.js' {
  declare module.exports: $Exports<'codemirror/mode/d/d'>;
}
declare module 'codemirror/mode/dart/dart.js' {
  declare module.exports: $Exports<'codemirror/mode/dart/dart'>;
}
declare module 'codemirror/mode/diff/diff.js' {
  declare module.exports: $Exports<'codemirror/mode/diff/diff'>;
}
declare module 'codemirror/mode/django/django.js' {
  declare module.exports: $Exports<'codemirror/mode/django/django'>;
}
declare module 'codemirror/mode/dockerfile/dockerfile.js' {
  declare module.exports: $Exports<'codemirror/mode/dockerfile/dockerfile'>;
}
declare module 'codemirror/mode/dtd/dtd.js' {
  declare module.exports: $Exports<'codemirror/mode/dtd/dtd'>;
}
declare module 'codemirror/mode/dylan/dylan.js' {
  declare module.exports: $Exports<'codemirror/mode/dylan/dylan'>;
}
declare module 'codemirror/mode/ebnf/ebnf.js' {
  declare module.exports: $Exports<'codemirror/mode/ebnf/ebnf'>;
}
declare module 'codemirror/mode/ecl/ecl.js' {
  declare module.exports: $Exports<'codemirror/mode/ecl/ecl'>;
}
declare module 'codemirror/mode/eiffel/eiffel.js' {
  declare module.exports: $Exports<'codemirror/mode/eiffel/eiffel'>;
}
declare module 'codemirror/mode/elm/elm.js' {
  declare module.exports: $Exports<'codemirror/mode/elm/elm'>;
}
declare module 'codemirror/mode/erlang/erlang.js' {
  declare module.exports: $Exports<'codemirror/mode/erlang/erlang'>;
}
declare module 'codemirror/mode/factor/factor.js' {
  declare module.exports: $Exports<'codemirror/mode/factor/factor'>;
}
declare module 'codemirror/mode/fcl/fcl.js' {
  declare module.exports: $Exports<'codemirror/mode/fcl/fcl'>;
}
declare module 'codemirror/mode/forth/forth.js' {
  declare module.exports: $Exports<'codemirror/mode/forth/forth'>;
}
declare module 'codemirror/mode/fortran/fortran.js' {
  declare module.exports: $Exports<'codemirror/mode/fortran/fortran'>;
}
declare module 'codemirror/mode/gas/gas.js' {
  declare module.exports: $Exports<'codemirror/mode/gas/gas'>;
}
declare module 'codemirror/mode/gfm/gfm.js' {
  declare module.exports: $Exports<'codemirror/mode/gfm/gfm'>;
}
declare module 'codemirror/mode/gherkin/gherkin.js' {
  declare module.exports: $Exports<'codemirror/mode/gherkin/gherkin'>;
}
declare module 'codemirror/mode/go/go.js' {
  declare module.exports: $Exports<'codemirror/mode/go/go'>;
}
declare module 'codemirror/mode/groovy/groovy.js' {
  declare module.exports: $Exports<'codemirror/mode/groovy/groovy'>;
}
declare module 'codemirror/mode/haml/haml.js' {
  declare module.exports: $Exports<'codemirror/mode/haml/haml'>;
}
declare module 'codemirror/mode/handlebars/handlebars.js' {
  declare module.exports: $Exports<'codemirror/mode/handlebars/handlebars'>;
}
declare module 'codemirror/mode/haskell-literate/haskell-literate.js' {
  declare module.exports: $Exports<'codemirror/mode/haskell-literate/haskell-literate'>;
}
declare module 'codemirror/mode/haskell/haskell.js' {
  declare module.exports: $Exports<'codemirror/mode/haskell/haskell'>;
}
declare module 'codemirror/mode/haxe/haxe.js' {
  declare module.exports: $Exports<'codemirror/mode/haxe/haxe'>;
}
declare module 'codemirror/mode/htmlembedded/htmlembedded.js' {
  declare module.exports: $Exports<'codemirror/mode/htmlembedded/htmlembedded'>;
}
declare module 'codemirror/mode/htmlmixed/htmlmixed.js' {
  declare module.exports: $Exports<'codemirror/mode/htmlmixed/htmlmixed'>;
}
declare module 'codemirror/mode/http/http.js' {
  declare module.exports: $Exports<'codemirror/mode/http/http'>;
}
declare module 'codemirror/mode/idl/idl.js' {
  declare module.exports: $Exports<'codemirror/mode/idl/idl'>;
}
declare module 'codemirror/mode/javascript/javascript.js' {
  declare module.exports: $Exports<'codemirror/mode/javascript/javascript'>;
}
declare module 'codemirror/mode/jinja2/jinja2.js' {
  declare module.exports: $Exports<'codemirror/mode/jinja2/jinja2'>;
}
declare module 'codemirror/mode/jsx/jsx.js' {
  declare module.exports: $Exports<'codemirror/mode/jsx/jsx'>;
}
declare module 'codemirror/mode/julia/julia.js' {
  declare module.exports: $Exports<'codemirror/mode/julia/julia'>;
}
declare module 'codemirror/mode/livescript/livescript.js' {
  declare module.exports: $Exports<'codemirror/mode/livescript/livescript'>;
}
declare module 'codemirror/mode/lua/lua.js' {
  declare module.exports: $Exports<'codemirror/mode/lua/lua'>;
}
declare module 'codemirror/mode/markdown/markdown.js' {
  declare module.exports: $Exports<'codemirror/mode/markdown/markdown'>;
}
declare module 'codemirror/mode/mathematica/mathematica.js' {
  declare module.exports: $Exports<'codemirror/mode/mathematica/mathematica'>;
}
declare module 'codemirror/mode/mbox/mbox.js' {
  declare module.exports: $Exports<'codemirror/mode/mbox/mbox'>;
}
declare module 'codemirror/mode/meta.js' {
  declare module.exports: $Exports<'codemirror/mode/meta'>;
}
declare module 'codemirror/mode/mirc/mirc.js' {
  declare module.exports: $Exports<'codemirror/mode/mirc/mirc'>;
}
declare module 'codemirror/mode/mllike/mllike.js' {
  declare module.exports: $Exports<'codemirror/mode/mllike/mllike'>;
}
declare module 'codemirror/mode/modelica/modelica.js' {
  declare module.exports: $Exports<'codemirror/mode/modelica/modelica'>;
}
declare module 'codemirror/mode/mscgen/mscgen.js' {
  declare module.exports: $Exports<'codemirror/mode/mscgen/mscgen'>;
}
declare module 'codemirror/mode/mumps/mumps.js' {
  declare module.exports: $Exports<'codemirror/mode/mumps/mumps'>;
}
declare module 'codemirror/mode/nginx/nginx.js' {
  declare module.exports: $Exports<'codemirror/mode/nginx/nginx'>;
}
declare module 'codemirror/mode/nsis/nsis.js' {
  declare module.exports: $Exports<'codemirror/mode/nsis/nsis'>;
}
declare module 'codemirror/mode/ntriples/ntriples.js' {
  declare module.exports: $Exports<'codemirror/mode/ntriples/ntriples'>;
}
declare module 'codemirror/mode/octave/octave.js' {
  declare module.exports: $Exports<'codemirror/mode/octave/octave'>;
}
declare module 'codemirror/mode/oz/oz.js' {
  declare module.exports: $Exports<'codemirror/mode/oz/oz'>;
}
declare module 'codemirror/mode/pascal/pascal.js' {
  declare module.exports: $Exports<'codemirror/mode/pascal/pascal'>;
}
declare module 'codemirror/mode/pegjs/pegjs.js' {
  declare module.exports: $Exports<'codemirror/mode/pegjs/pegjs'>;
}
declare module 'codemirror/mode/perl/perl.js' {
  declare module.exports: $Exports<'codemirror/mode/perl/perl'>;
}
declare module 'codemirror/mode/php/php.js' {
  declare module.exports: $Exports<'codemirror/mode/php/php'>;
}
declare module 'codemirror/mode/pig/pig.js' {
  declare module.exports: $Exports<'codemirror/mode/pig/pig'>;
}
declare module 'codemirror/mode/powershell/powershell.js' {
  declare module.exports: $Exports<'codemirror/mode/powershell/powershell'>;
}
declare module 'codemirror/mode/properties/properties.js' {
  declare module.exports: $Exports<'codemirror/mode/properties/properties'>;
}
declare module 'codemirror/mode/protobuf/protobuf.js' {
  declare module.exports: $Exports<'codemirror/mode/protobuf/protobuf'>;
}
declare module 'codemirror/mode/pug/pug.js' {
  declare module.exports: $Exports<'codemirror/mode/pug/pug'>;
}
declare module 'codemirror/mode/puppet/puppet.js' {
  declare module.exports: $Exports<'codemirror/mode/puppet/puppet'>;
}
declare module 'codemirror/mode/python/python.js' {
  declare module.exports: $Exports<'codemirror/mode/python/python'>;
}
declare module 'codemirror/mode/q/q.js' {
  declare module.exports: $Exports<'codemirror/mode/q/q'>;
}
declare module 'codemirror/mode/r/r.js' {
  declare module.exports: $Exports<'codemirror/mode/r/r'>;
}
declare module 'codemirror/mode/rpm/rpm.js' {
  declare module.exports: $Exports<'codemirror/mode/rpm/rpm'>;
}
declare module 'codemirror/mode/rst/rst.js' {
  declare module.exports: $Exports<'codemirror/mode/rst/rst'>;
}
declare module 'codemirror/mode/ruby/ruby.js' {
  declare module.exports: $Exports<'codemirror/mode/ruby/ruby'>;
}
declare module 'codemirror/mode/rust/rust.js' {
  declare module.exports: $Exports<'codemirror/mode/rust/rust'>;
}
declare module 'codemirror/mode/sas/sas.js' {
  declare module.exports: $Exports<'codemirror/mode/sas/sas'>;
}
declare module 'codemirror/mode/sass/sass.js' {
  declare module.exports: $Exports<'codemirror/mode/sass/sass'>;
}
declare module 'codemirror/mode/scheme/scheme.js' {
  declare module.exports: $Exports<'codemirror/mode/scheme/scheme'>;
}
declare module 'codemirror/mode/shell/shell.js' {
  declare module.exports: $Exports<'codemirror/mode/shell/shell'>;
}
declare module 'codemirror/mode/sieve/sieve.js' {
  declare module.exports: $Exports<'codemirror/mode/sieve/sieve'>;
}
declare module 'codemirror/mode/slim/slim.js' {
  declare module.exports: $Exports<'codemirror/mode/slim/slim'>;
}
declare module 'codemirror/mode/smalltalk/smalltalk.js' {
  declare module.exports: $Exports<'codemirror/mode/smalltalk/smalltalk'>;
}
declare module 'codemirror/mode/smarty/smarty.js' {
  declare module.exports: $Exports<'codemirror/mode/smarty/smarty'>;
}
declare module 'codemirror/mode/solr/solr.js' {
  declare module.exports: $Exports<'codemirror/mode/solr/solr'>;
}
declare module 'codemirror/mode/soy/soy.js' {
  declare module.exports: $Exports<'codemirror/mode/soy/soy'>;
}
declare module 'codemirror/mode/sparql/sparql.js' {
  declare module.exports: $Exports<'codemirror/mode/sparql/sparql'>;
}
declare module 'codemirror/mode/spreadsheet/spreadsheet.js' {
  declare module.exports: $Exports<'codemirror/mode/spreadsheet/spreadsheet'>;
}
declare module 'codemirror/mode/sql/sql.js' {
  declare module.exports: $Exports<'codemirror/mode/sql/sql'>;
}
declare module 'codemirror/mode/stex/stex.js' {
  declare module.exports: $Exports<'codemirror/mode/stex/stex'>;
}
declare module 'codemirror/mode/stylus/stylus.js' {
  declare module.exports: $Exports<'codemirror/mode/stylus/stylus'>;
}
declare module 'codemirror/mode/swift/swift.js' {
  declare module.exports: $Exports<'codemirror/mode/swift/swift'>;
}
declare module 'codemirror/mode/tcl/tcl.js' {
  declare module.exports: $Exports<'codemirror/mode/tcl/tcl'>;
}
declare module 'codemirror/mode/textile/textile.js' {
  declare module.exports: $Exports<'codemirror/mode/textile/textile'>;
}
declare module 'codemirror/mode/tiddlywiki/tiddlywiki.js' {
  declare module.exports: $Exports<'codemirror/mode/tiddlywiki/tiddlywiki'>;
}
declare module 'codemirror/mode/tiki/tiki.js' {
  declare module.exports: $Exports<'codemirror/mode/tiki/tiki'>;
}
declare module 'codemirror/mode/toml/toml.js' {
  declare module.exports: $Exports<'codemirror/mode/toml/toml'>;
}
declare module 'codemirror/mode/tornado/tornado.js' {
  declare module.exports: $Exports<'codemirror/mode/tornado/tornado'>;
}
declare module 'codemirror/mode/troff/troff.js' {
  declare module.exports: $Exports<'codemirror/mode/troff/troff'>;
}
declare module 'codemirror/mode/ttcn-cfg/ttcn-cfg.js' {
  declare module.exports: $Exports<'codemirror/mode/ttcn-cfg/ttcn-cfg'>;
}
declare module 'codemirror/mode/ttcn/ttcn.js' {
  declare module.exports: $Exports<'codemirror/mode/ttcn/ttcn'>;
}
declare module 'codemirror/mode/turtle/turtle.js' {
  declare module.exports: $Exports<'codemirror/mode/turtle/turtle'>;
}
declare module 'codemirror/mode/twig/twig.js' {
  declare module.exports: $Exports<'codemirror/mode/twig/twig'>;
}
declare module 'codemirror/mode/vb/vb.js' {
  declare module.exports: $Exports<'codemirror/mode/vb/vb'>;
}
declare module 'codemirror/mode/vbscript/vbscript.js' {
  declare module.exports: $Exports<'codemirror/mode/vbscript/vbscript'>;
}
declare module 'codemirror/mode/velocity/velocity.js' {
  declare module.exports: $Exports<'codemirror/mode/velocity/velocity'>;
}
declare module 'codemirror/mode/verilog/verilog.js' {
  declare module.exports: $Exports<'codemirror/mode/verilog/verilog'>;
}
declare module 'codemirror/mode/vhdl/vhdl.js' {
  declare module.exports: $Exports<'codemirror/mode/vhdl/vhdl'>;
}
declare module 'codemirror/mode/vue/vue.js' {
  declare module.exports: $Exports<'codemirror/mode/vue/vue'>;
}
declare module 'codemirror/mode/webidl/webidl.js' {
  declare module.exports: $Exports<'codemirror/mode/webidl/webidl'>;
}
declare module 'codemirror/mode/xml/xml.js' {
  declare module.exports: $Exports<'codemirror/mode/xml/xml'>;
}
declare module 'codemirror/mode/xquery/xquery.js' {
  declare module.exports: $Exports<'codemirror/mode/xquery/xquery'>;
}
declare module 'codemirror/mode/yacas/yacas.js' {
  declare module.exports: $Exports<'codemirror/mode/yacas/yacas'>;
}
declare module 'codemirror/mode/yaml-frontmatter/yaml-frontmatter.js' {
  declare module.exports: $Exports<'codemirror/mode/yaml-frontmatter/yaml-frontmatter'>;
}
declare module 'codemirror/mode/yaml/yaml.js' {
  declare module.exports: $Exports<'codemirror/mode/yaml/yaml'>;
}
declare module 'codemirror/mode/z80/z80.js' {
  declare module.exports: $Exports<'codemirror/mode/z80/z80'>;
}
declare module 'codemirror/rollup.config.js' {
  declare module.exports: $Exports<'codemirror/rollup.config'>;
}
declare module 'codemirror/src/codemirror.js' {
  declare module.exports: $Exports<'codemirror/src/codemirror'>;
}
declare module 'codemirror/src/display/Display.js' {
  declare module.exports: $Exports<'codemirror/src/display/Display'>;
}
declare module 'codemirror/src/display/focus.js' {
  declare module.exports: $Exports<'codemirror/src/display/focus'>;
}
declare module 'codemirror/src/display/gutters.js' {
  declare module.exports: $Exports<'codemirror/src/display/gutters'>;
}
declare module 'codemirror/src/display/highlight_worker.js' {
  declare module.exports: $Exports<'codemirror/src/display/highlight_worker'>;
}
declare module 'codemirror/src/display/line_numbers.js' {
  declare module.exports: $Exports<'codemirror/src/display/line_numbers'>;
}
declare module 'codemirror/src/display/mode_state.js' {
  declare module.exports: $Exports<'codemirror/src/display/mode_state'>;
}
declare module 'codemirror/src/display/operations.js' {
  declare module.exports: $Exports<'codemirror/src/display/operations'>;
}
declare module 'codemirror/src/display/scroll_events.js' {
  declare module.exports: $Exports<'codemirror/src/display/scroll_events'>;
}
declare module 'codemirror/src/display/scrollbars.js' {
  declare module.exports: $Exports<'codemirror/src/display/scrollbars'>;
}
declare module 'codemirror/src/display/scrolling.js' {
  declare module.exports: $Exports<'codemirror/src/display/scrolling'>;
}
declare module 'codemirror/src/display/selection.js' {
  declare module.exports: $Exports<'codemirror/src/display/selection'>;
}
declare module 'codemirror/src/display/update_display.js' {
  declare module.exports: $Exports<'codemirror/src/display/update_display'>;
}
declare module 'codemirror/src/display/update_line.js' {
  declare module.exports: $Exports<'codemirror/src/display/update_line'>;
}
declare module 'codemirror/src/display/update_lines.js' {
  declare module.exports: $Exports<'codemirror/src/display/update_lines'>;
}
declare module 'codemirror/src/display/view_tracking.js' {
  declare module.exports: $Exports<'codemirror/src/display/view_tracking'>;
}
declare module 'codemirror/src/edit/CodeMirror.js' {
  declare module.exports: $Exports<'codemirror/src/edit/CodeMirror'>;
}
declare module 'codemirror/src/edit/commands.js' {
  declare module.exports: $Exports<'codemirror/src/edit/commands'>;
}
declare module 'codemirror/src/edit/deleteNearSelection.js' {
  declare module.exports: $Exports<'codemirror/src/edit/deleteNearSelection'>;
}
declare module 'codemirror/src/edit/drop_events.js' {
  declare module.exports: $Exports<'codemirror/src/edit/drop_events'>;
}
declare module 'codemirror/src/edit/fromTextArea.js' {
  declare module.exports: $Exports<'codemirror/src/edit/fromTextArea'>;
}
declare module 'codemirror/src/edit/global_events.js' {
  declare module.exports: $Exports<'codemirror/src/edit/global_events'>;
}
declare module 'codemirror/src/edit/key_events.js' {
  declare module.exports: $Exports<'codemirror/src/edit/key_events'>;
}
declare module 'codemirror/src/edit/legacy.js' {
  declare module.exports: $Exports<'codemirror/src/edit/legacy'>;
}
declare module 'codemirror/src/edit/main.js' {
  declare module.exports: $Exports<'codemirror/src/edit/main'>;
}
declare module 'codemirror/src/edit/methods.js' {
  declare module.exports: $Exports<'codemirror/src/edit/methods'>;
}
declare module 'codemirror/src/edit/mouse_events.js' {
  declare module.exports: $Exports<'codemirror/src/edit/mouse_events'>;
}
declare module 'codemirror/src/edit/options.js' {
  declare module.exports: $Exports<'codemirror/src/edit/options'>;
}
declare module 'codemirror/src/edit/utils.js' {
  declare module.exports: $Exports<'codemirror/src/edit/utils'>;
}
declare module 'codemirror/src/input/ContentEditableInput.js' {
  declare module.exports: $Exports<'codemirror/src/input/ContentEditableInput'>;
}
declare module 'codemirror/src/input/indent.js' {
  declare module.exports: $Exports<'codemirror/src/input/indent'>;
}
declare module 'codemirror/src/input/input.js' {
  declare module.exports: $Exports<'codemirror/src/input/input'>;
}
declare module 'codemirror/src/input/keymap.js' {
  declare module.exports: $Exports<'codemirror/src/input/keymap'>;
}
declare module 'codemirror/src/input/keynames.js' {
  declare module.exports: $Exports<'codemirror/src/input/keynames'>;
}
declare module 'codemirror/src/input/movement.js' {
  declare module.exports: $Exports<'codemirror/src/input/movement'>;
}
declare module 'codemirror/src/input/TextareaInput.js' {
  declare module.exports: $Exports<'codemirror/src/input/TextareaInput'>;
}
declare module 'codemirror/src/line/highlight.js' {
  declare module.exports: $Exports<'codemirror/src/line/highlight'>;
}
declare module 'codemirror/src/line/line_data.js' {
  declare module.exports: $Exports<'codemirror/src/line/line_data'>;
}
declare module 'codemirror/src/line/pos.js' {
  declare module.exports: $Exports<'codemirror/src/line/pos'>;
}
declare module 'codemirror/src/line/saw_special_spans.js' {
  declare module.exports: $Exports<'codemirror/src/line/saw_special_spans'>;
}
declare module 'codemirror/src/line/spans.js' {
  declare module.exports: $Exports<'codemirror/src/line/spans'>;
}
declare module 'codemirror/src/line/utils_line.js' {
  declare module.exports: $Exports<'codemirror/src/line/utils_line'>;
}
declare module 'codemirror/src/measurement/position_measurement.js' {
  declare module.exports: $Exports<'codemirror/src/measurement/position_measurement'>;
}
declare module 'codemirror/src/measurement/widgets.js' {
  declare module.exports: $Exports<'codemirror/src/measurement/widgets'>;
}
declare module 'codemirror/src/model/change_measurement.js' {
  declare module.exports: $Exports<'codemirror/src/model/change_measurement'>;
}
declare module 'codemirror/src/model/changes.js' {
  declare module.exports: $Exports<'codemirror/src/model/changes'>;
}
declare module 'codemirror/src/model/chunk.js' {
  declare module.exports: $Exports<'codemirror/src/model/chunk'>;
}
declare module 'codemirror/src/model/Doc.js' {
  declare module.exports: $Exports<'codemirror/src/model/Doc'>;
}
declare module 'codemirror/src/model/document_data.js' {
  declare module.exports: $Exports<'codemirror/src/model/document_data'>;
}
declare module 'codemirror/src/model/history.js' {
  declare module.exports: $Exports<'codemirror/src/model/history'>;
}
declare module 'codemirror/src/model/line_widget.js' {
  declare module.exports: $Exports<'codemirror/src/model/line_widget'>;
}
declare module 'codemirror/src/model/mark_text.js' {
  declare module.exports: $Exports<'codemirror/src/model/mark_text'>;
}
declare module 'codemirror/src/model/selection_updates.js' {
  declare module.exports: $Exports<'codemirror/src/model/selection_updates'>;
}
declare module 'codemirror/src/model/selection.js' {
  declare module.exports: $Exports<'codemirror/src/model/selection'>;
}
declare module 'codemirror/src/modes.js' {
  declare module.exports: $Exports<'codemirror/src/modes'>;
}
declare module 'codemirror/src/util/bidi.js' {
  declare module.exports: $Exports<'codemirror/src/util/bidi'>;
}
declare module 'codemirror/src/util/browser.js' {
  declare module.exports: $Exports<'codemirror/src/util/browser'>;
}
declare module 'codemirror/src/util/dom.js' {
  declare module.exports: $Exports<'codemirror/src/util/dom'>;
}
declare module 'codemirror/src/util/event.js' {
  declare module.exports: $Exports<'codemirror/src/util/event'>;
}
declare module 'codemirror/src/util/feature_detection.js' {
  declare module.exports: $Exports<'codemirror/src/util/feature_detection'>;
}
declare module 'codemirror/src/util/misc.js' {
  declare module.exports: $Exports<'codemirror/src/util/misc'>;
}
declare module 'codemirror/src/util/operation_group.js' {
  declare module.exports: $Exports<'codemirror/src/util/operation_group'>;
}
declare module 'codemirror/src/util/StringStream.js' {
  declare module.exports: $Exports<'codemirror/src/util/StringStream'>;
}
// flow-typed signature: b26465a763805506e2f1120d04ab58eb
// flow-typed version: <<STUB>>/dashify_v^0.2.2/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'dashify'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'dashify' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */


// Filename aliases
declare module 'dashify/index' {
  declare module.exports: $Exports<'dashify'>;
}
declare module 'dashify/index.js' {
  declare module.exports: $Exports<'dashify'>;
}
// flow-typed signature: ac858859a846498c06179ada0c8b78a1
// flow-typed version: <<STUB>>/deep-equal_v^1.0.1/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'deep-equal'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'deep-equal' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'deep-equal/example/cmp' {
  declare module.exports: any;
}

declare module 'deep-equal/lib/is_arguments' {
  declare module.exports: any;
}

declare module 'deep-equal/lib/keys' {
  declare module.exports: any;
}

declare module 'deep-equal/test/cmp' {
  declare module.exports: any;
}

// Filename aliases
declare module 'deep-equal/example/cmp.js' {
  declare module.exports: $Exports<'deep-equal/example/cmp'>;
}
declare module 'deep-equal/index' {
  declare module.exports: $Exports<'deep-equal'>;
}
declare module 'deep-equal/index.js' {
  declare module.exports: $Exports<'deep-equal'>;
}
declare module 'deep-equal/lib/is_arguments.js' {
  declare module.exports: $Exports<'deep-equal/lib/is_arguments'>;
}
declare module 'deep-equal/lib/keys.js' {
  declare module.exports: $Exports<'deep-equal/lib/keys'>;
}
declare module 'deep-equal/test/cmp.js' {
  declare module.exports: $Exports<'deep-equal/test/cmp'>;
}
// flow-typed signature: ca3761607eebb8eefa0b0b2cd828537f
// flow-typed version: <<STUB>>/detect-port_v^1.1.1/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'detect-port'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'detect-port' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'detect-port/lib/detect-port' {
  declare module.exports: any;
}

// Filename aliases
declare module 'detect-port/index' {
  declare module.exports: $Exports<'detect-port'>;
}
declare module 'detect-port/index.js' {
  declare module.exports: $Exports<'detect-port'>;
}
declare module 'detect-port/lib/detect-port.js' {
  declare module.exports: $Exports<'detect-port/lib/detect-port'>;
}
// flow-typed signature: 0782c9570706be2268d543150a4f38dc
// flow-typed version: <<STUB>>/electron-builder_v^16.8.3/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'electron-builder'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'electron-builder' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'electron-builder/out/appInfo' {
  declare module.exports: any;
}

declare module 'electron-builder/out/asar' {
  declare module.exports: any;
}

declare module 'electron-builder/out/asarUtil' {
  declare module.exports: any;
}

declare module 'electron-builder/out/builder' {
  declare module.exports: any;
}

declare module 'electron-builder/out/cli/build-cli' {
  declare module.exports: any;
}

declare module 'electron-builder/out/cli/cliOptions' {
  declare module.exports: any;
}

declare module 'electron-builder/out/cli/create-self-signed-cert' {
  declare module.exports: any;
}

declare module 'electron-builder/out/cli/install-app-deps' {
  declare module.exports: any;
}

declare module 'electron-builder/out/cli/node-gyp-rebuild' {
  declare module.exports: any;
}

declare module 'electron-builder/out/codeSign' {
  declare module.exports: any;
}

declare module 'electron-builder/out/errorMessages' {
  declare module.exports: any;
}

declare module 'electron-builder/out/fileMatcher' {
  declare module.exports: any;
}

declare module 'electron-builder/out/fileTransformer' {
  declare module.exports: any;
}

declare module 'electron-builder/out/forge/forge-maker' {
  declare module.exports: any;
}

declare module 'electron-builder/out/index' {
  declare module.exports: any;
}

declare module 'electron-builder/out/linuxPackager' {
  declare module.exports: any;
}

declare module 'electron-builder/out/macPackager' {
  declare module.exports: any;
}

declare module 'electron-builder/out/metadata' {
  declare module.exports: any;
}

declare module 'electron-builder/out/options/linuxOptions' {
  declare module.exports: any;
}

declare module 'electron-builder/out/options/macOptions' {
  declare module.exports: any;
}

declare module 'electron-builder/out/options/winOptions' {
  declare module.exports: any;
}

declare module 'electron-builder/out/packager' {
  declare module.exports: any;
}

declare module 'electron-builder/out/packager/dirPackager' {
  declare module.exports: any;
}

declare module 'electron-builder/out/packager/mac' {
  declare module.exports: any;
}

declare module 'electron-builder/out/packagerApi' {
  declare module.exports: any;
}

declare module 'electron-builder/out/platformPackager' {
  declare module.exports: any;
}

declare module 'electron-builder/out/publish/PublishManager' {
  declare module.exports: any;
}

declare module 'electron-builder/out/readInstalled' {
  declare module.exports: any;
}

declare module 'electron-builder/out/repositoryInfo' {
  declare module.exports: any;
}

declare module 'electron-builder/out/targets/appImage' {
  declare module.exports: any;
}

declare module 'electron-builder/out/targets/appx' {
  declare module.exports: any;
}

declare module 'electron-builder/out/targets/archive' {
  declare module.exports: any;
}

declare module 'electron-builder/out/targets/ArchiveTarget' {
  declare module.exports: any;
}

declare module 'electron-builder/out/targets/dmg' {
  declare module.exports: any;
}

declare module 'electron-builder/out/targets/fpm' {
  declare module.exports: any;
}

declare module 'electron-builder/out/targets/LinuxTargetHelper' {
  declare module.exports: any;
}

declare module 'electron-builder/out/targets/nsis' {
  declare module.exports: any;
}

declare module 'electron-builder/out/targets/pkg' {
  declare module.exports: any;
}

declare module 'electron-builder/out/targets/snap' {
  declare module.exports: any;
}

declare module 'electron-builder/out/targets/targetFactory' {
  declare module.exports: any;
}

declare module 'electron-builder/out/targets/WebInstallerTarget' {
  declare module.exports: any;
}

declare module 'electron-builder/out/util/filter' {
  declare module.exports: any;
}

declare module 'electron-builder/out/util/readPackageJson' {
  declare module.exports: any;
}

declare module 'electron-builder/out/windowsCodeSign' {
  declare module.exports: any;
}

declare module 'electron-builder/out/winPackager' {
  declare module.exports: any;
}

declare module 'electron-builder/out/yarn' {
  declare module.exports: any;
}

// Filename aliases
declare module 'electron-builder/out/appInfo.js' {
  declare module.exports: $Exports<'electron-builder/out/appInfo'>;
}
declare module 'electron-builder/out/asar.js' {
  declare module.exports: $Exports<'electron-builder/out/asar'>;
}
declare module 'electron-builder/out/asarUtil.js' {
  declare module.exports: $Exports<'electron-builder/out/asarUtil'>;
}
declare module 'electron-builder/out/builder.js' {
  declare module.exports: $Exports<'electron-builder/out/builder'>;
}
declare module 'electron-builder/out/cli/build-cli.js' {
  declare module.exports: $Exports<'electron-builder/out/cli/build-cli'>;
}
declare module 'electron-builder/out/cli/cliOptions.js' {
  declare module.exports: $Exports<'electron-builder/out/cli/cliOptions'>;
}
declare module 'electron-builder/out/cli/create-self-signed-cert.js' {
  declare module.exports: $Exports<'electron-builder/out/cli/create-self-signed-cert'>;
}
declare module 'electron-builder/out/cli/install-app-deps.js' {
  declare module.exports: $Exports<'electron-builder/out/cli/install-app-deps'>;
}
declare module 'electron-builder/out/cli/node-gyp-rebuild.js' {
  declare module.exports: $Exports<'electron-builder/out/cli/node-gyp-rebuild'>;
}
declare module 'electron-builder/out/codeSign.js' {
  declare module.exports: $Exports<'electron-builder/out/codeSign'>;
}
declare module 'electron-builder/out/errorMessages.js' {
  declare module.exports: $Exports<'electron-builder/out/errorMessages'>;
}
declare module 'electron-builder/out/fileMatcher.js' {
  declare module.exports: $Exports<'electron-builder/out/fileMatcher'>;
}
declare module 'electron-builder/out/fileTransformer.js' {
  declare module.exports: $Exports<'electron-builder/out/fileTransformer'>;
}
declare module 'electron-builder/out/forge/forge-maker.js' {
  declare module.exports: $Exports<'electron-builder/out/forge/forge-maker'>;
}
declare module 'electron-builder/out/index.js' {
  declare module.exports: $Exports<'electron-builder/out/index'>;
}
declare module 'electron-builder/out/linuxPackager.js' {
  declare module.exports: $Exports<'electron-builder/out/linuxPackager'>;
}
declare module 'electron-builder/out/macPackager.js' {
  declare module.exports: $Exports<'electron-builder/out/macPackager'>;
}
declare module 'electron-builder/out/metadata.js' {
  declare module.exports: $Exports<'electron-builder/out/metadata'>;
}
declare module 'electron-builder/out/options/linuxOptions.js' {
  declare module.exports: $Exports<'electron-builder/out/options/linuxOptions'>;
}
declare module 'electron-builder/out/options/macOptions.js' {
  declare module.exports: $Exports<'electron-builder/out/options/macOptions'>;
}
declare module 'electron-builder/out/options/winOptions.js' {
  declare module.exports: $Exports<'electron-builder/out/options/winOptions'>;
}
declare module 'electron-builder/out/packager.js' {
  declare module.exports: $Exports<'electron-builder/out/packager'>;
}
declare module 'electron-builder/out/packager/dirPackager.js' {
  declare module.exports: $Exports<'electron-builder/out/packager/dirPackager'>;
}
declare module 'electron-builder/out/packager/mac.js' {
  declare module.exports: $Exports<'electron-builder/out/packager/mac'>;
}
declare module 'electron-builder/out/packagerApi.js' {
  declare module.exports: $Exports<'electron-builder/out/packagerApi'>;
}
declare module 'electron-builder/out/platformPackager.js' {
  declare module.exports: $Exports<'electron-builder/out/platformPackager'>;
}
declare module 'electron-builder/out/publish/PublishManager.js' {
  declare module.exports: $Exports<'electron-builder/out/publish/PublishManager'>;
}
declare module 'electron-builder/out/readInstalled.js' {
  declare module.exports: $Exports<'electron-builder/out/readInstalled'>;
}
declare module 'electron-builder/out/repositoryInfo.js' {
  declare module.exports: $Exports<'electron-builder/out/repositoryInfo'>;
}
declare module 'electron-builder/out/targets/appImage.js' {
  declare module.exports: $Exports<'electron-builder/out/targets/appImage'>;
}
declare module 'electron-builder/out/targets/appx.js' {
  declare module.exports: $Exports<'electron-builder/out/targets/appx'>;
}
declare module 'electron-builder/out/targets/archive.js' {
  declare module.exports: $Exports<'electron-builder/out/targets/archive'>;
}
declare module 'electron-builder/out/targets/ArchiveTarget.js' {
  declare module.exports: $Exports<'electron-builder/out/targets/ArchiveTarget'>;
}
declare module 'electron-builder/out/targets/dmg.js' {
  declare module.exports: $Exports<'electron-builder/out/targets/dmg'>;
}
declare module 'electron-builder/out/targets/fpm.js' {
  declare module.exports: $Exports<'electron-builder/out/targets/fpm'>;
}
declare module 'electron-builder/out/targets/LinuxTargetHelper.js' {
  declare module.exports: $Exports<'electron-builder/out/targets/LinuxTargetHelper'>;
}
declare module 'electron-builder/out/targets/nsis.js' {
  declare module.exports: $Exports<'electron-builder/out/targets/nsis'>;
}
declare module 'electron-builder/out/targets/pkg.js' {
  declare module.exports: $Exports<'electron-builder/out/targets/pkg'>;
}
declare module 'electron-builder/out/targets/snap.js' {
  declare module.exports: $Exports<'electron-builder/out/targets/snap'>;
}
declare module 'electron-builder/out/targets/targetFactory.js' {
  declare module.exports: $Exports<'electron-builder/out/targets/targetFactory'>;
}
declare module 'electron-builder/out/targets/WebInstallerTarget.js' {
  declare module.exports: $Exports<'electron-builder/out/targets/WebInstallerTarget'>;
}
declare module 'electron-builder/out/util/filter.js' {
  declare module.exports: $Exports<'electron-builder/out/util/filter'>;
}
declare module 'electron-builder/out/util/readPackageJson.js' {
  declare module.exports: $Exports<'electron-builder/out/util/readPackageJson'>;
}
declare module 'electron-builder/out/windowsCodeSign.js' {
  declare module.exports: $Exports<'electron-builder/out/windowsCodeSign'>;
}
declare module 'electron-builder/out/winPackager.js' {
  declare module.exports: $Exports<'electron-builder/out/winPackager'>;
}
declare module 'electron-builder/out/yarn.js' {
  declare module.exports: $Exports<'electron-builder/out/yarn'>;
}
// flow-typed signature: fce58527cae3f8649ab3ffb72e58090c
// flow-typed version: <<STUB>>/electron-devtools-installer_v^2.2.0/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'electron-devtools-installer'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'electron-devtools-installer' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'electron-devtools-installer/dist/downloadChromeExtension' {
  declare module.exports: any;
}

declare module 'electron-devtools-installer/dist/index' {
  declare module.exports: any;
}

declare module 'electron-devtools-installer/dist/utils' {
  declare module.exports: any;
}

declare module 'electron-devtools-installer/src/downloadChromeExtension' {
  declare module.exports: any;
}

declare module 'electron-devtools-installer/src/index' {
  declare module.exports: any;
}

declare module 'electron-devtools-installer/src/utils' {
  declare module.exports: any;
}

// Filename aliases
declare module 'electron-devtools-installer/dist/downloadChromeExtension.js' {
  declare module.exports: $Exports<'electron-devtools-installer/dist/downloadChromeExtension'>;
}
declare module 'electron-devtools-installer/dist/index.js' {
  declare module.exports: $Exports<'electron-devtools-installer/dist/index'>;
}
declare module 'electron-devtools-installer/dist/utils.js' {
  declare module.exports: $Exports<'electron-devtools-installer/dist/utils'>;
}
declare module 'electron-devtools-installer/src/downloadChromeExtension.js' {
  declare module.exports: $Exports<'electron-devtools-installer/src/downloadChromeExtension'>;
}
declare module 'electron-devtools-installer/src/index.js' {
  declare module.exports: $Exports<'electron-devtools-installer/src/index'>;
}
declare module 'electron-devtools-installer/src/utils.js' {
  declare module.exports: $Exports<'electron-devtools-installer/src/utils'>;
}
// flow-typed signature: 451c88326bb7cc6aa79491d34e1c60b0
// flow-typed version: <<STUB>>/electron_v1.7.3/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'electron'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'electron' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'electron/cli' {
  declare module.exports: any;
}

declare module 'electron/install' {
  declare module.exports: any;
}

declare module 'electron/test/errors' {
  declare module.exports: any;
}

declare module 'electron/test/index' {
  declare module.exports: any;
}

// Filename aliases
declare module 'electron/cli.js' {
  declare module.exports: $Exports<'electron/cli'>;
}
declare module 'electron/index' {
  declare module.exports: $Exports<'electron'>;
}
declare module 'electron/index.js' {
  declare module.exports: $Exports<'electron'>;
}
declare module 'electron/install.js' {
  declare module.exports: $Exports<'electron/install'>;
}
declare module 'electron/test/errors.js' {
  declare module.exports: $Exports<'electron/test/errors'>;
}
declare module 'electron/test/index.js' {
  declare module.exports: $Exports<'electron/test/index'>;
}
// flow-typed signature: 44d1e6a2fb005812ddc1cec21c490caf
// flow-typed version: <<STUB>>/eslint-config-react-app_v^0.6.2/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'eslint-config-react-app'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'eslint-config-react-app' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */


// Filename aliases
declare module 'eslint-config-react-app/index' {
  declare module.exports: $Exports<'eslint-config-react-app'>;
}
declare module 'eslint-config-react-app/index.js' {
  declare module.exports: $Exports<'eslint-config-react-app'>;
}
// flow-typed signature: 01f86fa0dc19e1126195f0bded4a75de
// flow-typed version: <<STUB>>/eslint-plugin-flowtype_v^2.30.4/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'eslint-plugin-flowtype'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'eslint-plugin-flowtype' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'eslint-plugin-flowtype/bin/readmeAssertions' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/index' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/rules/booleanStyle' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/rules/defineFlowType' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/rules/delimiterDangle' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/rules/genericSpacing' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/rules/noDupeKeys' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/rules/noMutableArray' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/rules/noPrimitiveConstructorTypes' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/rules/noTypesMissingFileAnnotation' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/rules/noUnusedExpressions' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/rules/noWeakTypes' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/rules/objectTypeDelimiter' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/rules/requireParameterType' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/rules/requireReturnType' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/rules/requireValidFileAnnotation' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/rules/requireVariableType' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/rules/semi' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/rules/sortKeys' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/rules/spaceAfterTypeColon' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/rules/spaceBeforeGenericBracket' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/rules/spaceBeforeTypeColon' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/rules/typeColonSpacing/evaluateFunctions' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/rules/typeColonSpacing/evaluateObjectTypeIndexer' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/rules/typeColonSpacing/evaluateObjectTypeProperty' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/rules/typeColonSpacing/evaluateReturnType' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/rules/typeColonSpacing/evaluateTypeCastExpression' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/rules/typeColonSpacing/evaluateTypical' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/rules/typeColonSpacing/index' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/rules/typeColonSpacing/reporter' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/rules/typeIdMatch' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/rules/unionIntersectionSpacing' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/rules/useFlowType' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/rules/validSyntax' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/utilities/checkFlowFileAnnotation' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/utilities/fuzzyStringMatch' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/utilities/getParameterName' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/utilities/getTokenAfterParens' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/utilities/getTokenBeforeParens' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/utilities/index' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/utilities/isFlowFile' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/utilities/isFlowFileAnnotation' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/utilities/iterateFunctionNodes' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/utilities/quoteName' {
  declare module.exports: any;
}

declare module 'eslint-plugin-flowtype/dist/utilities/spacingFixers' {
  declare module.exports: any;
}

// Filename aliases
declare module 'eslint-plugin-flowtype/bin/readmeAssertions.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/bin/readmeAssertions'>;
}
declare module 'eslint-plugin-flowtype/dist/index.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/index'>;
}
declare module 'eslint-plugin-flowtype/dist/rules/booleanStyle.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/rules/booleanStyle'>;
}
declare module 'eslint-plugin-flowtype/dist/rules/defineFlowType.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/rules/defineFlowType'>;
}
declare module 'eslint-plugin-flowtype/dist/rules/delimiterDangle.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/rules/delimiterDangle'>;
}
declare module 'eslint-plugin-flowtype/dist/rules/genericSpacing.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/rules/genericSpacing'>;
}
declare module 'eslint-plugin-flowtype/dist/rules/noDupeKeys.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/rules/noDupeKeys'>;
}
declare module 'eslint-plugin-flowtype/dist/rules/noMutableArray.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/rules/noMutableArray'>;
}
declare module 'eslint-plugin-flowtype/dist/rules/noPrimitiveConstructorTypes.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/rules/noPrimitiveConstructorTypes'>;
}
declare module 'eslint-plugin-flowtype/dist/rules/noTypesMissingFileAnnotation.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/rules/noTypesMissingFileAnnotation'>;
}
declare module 'eslint-plugin-flowtype/dist/rules/noUnusedExpressions.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/rules/noUnusedExpressions'>;
}
declare module 'eslint-plugin-flowtype/dist/rules/noWeakTypes.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/rules/noWeakTypes'>;
}
declare module 'eslint-plugin-flowtype/dist/rules/objectTypeDelimiter.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/rules/objectTypeDelimiter'>;
}
declare module 'eslint-plugin-flowtype/dist/rules/requireParameterType.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/rules/requireParameterType'>;
}
declare module 'eslint-plugin-flowtype/dist/rules/requireReturnType.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/rules/requireReturnType'>;
}
declare module 'eslint-plugin-flowtype/dist/rules/requireValidFileAnnotation.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/rules/requireValidFileAnnotation'>;
}
declare module 'eslint-plugin-flowtype/dist/rules/requireVariableType.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/rules/requireVariableType'>;
}
declare module 'eslint-plugin-flowtype/dist/rules/semi.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/rules/semi'>;
}
declare module 'eslint-plugin-flowtype/dist/rules/sortKeys.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/rules/sortKeys'>;
}
declare module 'eslint-plugin-flowtype/dist/rules/spaceAfterTypeColon.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/rules/spaceAfterTypeColon'>;
}
declare module 'eslint-plugin-flowtype/dist/rules/spaceBeforeGenericBracket.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/rules/spaceBeforeGenericBracket'>;
}
declare module 'eslint-plugin-flowtype/dist/rules/spaceBeforeTypeColon.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/rules/spaceBeforeTypeColon'>;
}
declare module 'eslint-plugin-flowtype/dist/rules/typeColonSpacing/evaluateFunctions.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/rules/typeColonSpacing/evaluateFunctions'>;
}
declare module 'eslint-plugin-flowtype/dist/rules/typeColonSpacing/evaluateObjectTypeIndexer.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/rules/typeColonSpacing/evaluateObjectTypeIndexer'>;
}
declare module 'eslint-plugin-flowtype/dist/rules/typeColonSpacing/evaluateObjectTypeProperty.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/rules/typeColonSpacing/evaluateObjectTypeProperty'>;
}
declare module 'eslint-plugin-flowtype/dist/rules/typeColonSpacing/evaluateReturnType.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/rules/typeColonSpacing/evaluateReturnType'>;
}
declare module 'eslint-plugin-flowtype/dist/rules/typeColonSpacing/evaluateTypeCastExpression.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/rules/typeColonSpacing/evaluateTypeCastExpression'>;
}
declare module 'eslint-plugin-flowtype/dist/rules/typeColonSpacing/evaluateTypical.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/rules/typeColonSpacing/evaluateTypical'>;
}
declare module 'eslint-plugin-flowtype/dist/rules/typeColonSpacing/index.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/rules/typeColonSpacing/index'>;
}
declare module 'eslint-plugin-flowtype/dist/rules/typeColonSpacing/reporter.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/rules/typeColonSpacing/reporter'>;
}
declare module 'eslint-plugin-flowtype/dist/rules/typeIdMatch.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/rules/typeIdMatch'>;
}
declare module 'eslint-plugin-flowtype/dist/rules/unionIntersectionSpacing.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/rules/unionIntersectionSpacing'>;
}
declare module 'eslint-plugin-flowtype/dist/rules/useFlowType.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/rules/useFlowType'>;
}
declare module 'eslint-plugin-flowtype/dist/rules/validSyntax.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/rules/validSyntax'>;
}
declare module 'eslint-plugin-flowtype/dist/utilities/checkFlowFileAnnotation.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/utilities/checkFlowFileAnnotation'>;
}
declare module 'eslint-plugin-flowtype/dist/utilities/fuzzyStringMatch.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/utilities/fuzzyStringMatch'>;
}
declare module 'eslint-plugin-flowtype/dist/utilities/getParameterName.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/utilities/getParameterName'>;
}
declare module 'eslint-plugin-flowtype/dist/utilities/getTokenAfterParens.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/utilities/getTokenAfterParens'>;
}
declare module 'eslint-plugin-flowtype/dist/utilities/getTokenBeforeParens.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/utilities/getTokenBeforeParens'>;
}
declare module 'eslint-plugin-flowtype/dist/utilities/index.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/utilities/index'>;
}
declare module 'eslint-plugin-flowtype/dist/utilities/isFlowFile.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/utilities/isFlowFile'>;
}
declare module 'eslint-plugin-flowtype/dist/utilities/isFlowFileAnnotation.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/utilities/isFlowFileAnnotation'>;
}
declare module 'eslint-plugin-flowtype/dist/utilities/iterateFunctionNodes.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/utilities/iterateFunctionNodes'>;
}
declare module 'eslint-plugin-flowtype/dist/utilities/quoteName.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/utilities/quoteName'>;
}
declare module 'eslint-plugin-flowtype/dist/utilities/spacingFixers.js' {
  declare module.exports: $Exports<'eslint-plugin-flowtype/dist/utilities/spacingFixers'>;
}
// flow-typed signature: e6182e793944459234f882bb47d2ba01
// flow-typed version: <<STUB>>/eslint-plugin-import_v^2.2.0/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'eslint-plugin-import'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'eslint-plugin-import' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'eslint-plugin-import/config/electron' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/config/errors' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/config/react-native' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/config/react' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/config/recommended' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/config/stage-0' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/config/warnings' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/lib/core/importType' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/lib/core/staticRequire' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/lib/ExportMap' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/lib/importDeclaration' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/lib/index' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/lib/rules/default' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/lib/rules/export' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/lib/rules/exports-last' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/lib/rules/extensions' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/lib/rules/first' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/lib/rules/imports-first' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/lib/rules/max-dependencies' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/lib/rules/named' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/lib/rules/namespace' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/lib/rules/newline-after-import' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/lib/rules/no-absolute-path' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/lib/rules/no-amd' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/lib/rules/no-anonymous-default-export' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/lib/rules/no-commonjs' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/lib/rules/no-deprecated' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/lib/rules/no-duplicates' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/lib/rules/no-dynamic-require' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/lib/rules/no-extraneous-dependencies' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/lib/rules/no-internal-modules' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/lib/rules/no-mutable-exports' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/lib/rules/no-named-as-default-member' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/lib/rules/no-named-as-default' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/lib/rules/no-named-default' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/lib/rules/no-namespace' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/lib/rules/no-nodejs-modules' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/lib/rules/no-restricted-paths' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/lib/rules/no-unassigned-import' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/lib/rules/no-unresolved' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/lib/rules/no-webpack-loader-syntax' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/lib/rules/order' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/lib/rules/prefer-default-export' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/lib/rules/unambiguous' {
  declare module.exports: any;
}

declare module 'eslint-plugin-import/memo-parser/index' {
  declare module.exports: any;
}

// Filename aliases
declare module 'eslint-plugin-import/config/electron.js' {
  declare module.exports: $Exports<'eslint-plugin-import/config/electron'>;
}
declare module 'eslint-plugin-import/config/errors.js' {
  declare module.exports: $Exports<'eslint-plugin-import/config/errors'>;
}
declare module 'eslint-plugin-import/config/react-native.js' {
  declare module.exports: $Exports<'eslint-plugin-import/config/react-native'>;
}
declare module 'eslint-plugin-import/config/react.js' {
  declare module.exports: $Exports<'eslint-plugin-import/config/react'>;
}
declare module 'eslint-plugin-import/config/recommended.js' {
  declare module.exports: $Exports<'eslint-plugin-import/config/recommended'>;
}
declare module 'eslint-plugin-import/config/stage-0.js' {
  declare module.exports: $Exports<'eslint-plugin-import/config/stage-0'>;
}
declare module 'eslint-plugin-import/config/warnings.js' {
  declare module.exports: $Exports<'eslint-plugin-import/config/warnings'>;
}
declare module 'eslint-plugin-import/lib/core/importType.js' {
  declare module.exports: $Exports<'eslint-plugin-import/lib/core/importType'>;
}
declare module 'eslint-plugin-import/lib/core/staticRequire.js' {
  declare module.exports: $Exports<'eslint-plugin-import/lib/core/staticRequire'>;
}
declare module 'eslint-plugin-import/lib/ExportMap.js' {
  declare module.exports: $Exports<'eslint-plugin-import/lib/ExportMap'>;
}
declare module 'eslint-plugin-import/lib/importDeclaration.js' {
  declare module.exports: $Exports<'eslint-plugin-import/lib/importDeclaration'>;
}
declare module 'eslint-plugin-import/lib/index.js' {
  declare module.exports: $Exports<'eslint-plugin-import/lib/index'>;
}
declare module 'eslint-plugin-import/lib/rules/default.js' {
  declare module.exports: $Exports<'eslint-plugin-import/lib/rules/default'>;
}
declare module 'eslint-plugin-import/lib/rules/export.js' {
  declare module.exports: $Exports<'eslint-plugin-import/lib/rules/export'>;
}
declare module 'eslint-plugin-import/lib/rules/exports-last.js' {
  declare module.exports: $Exports<'eslint-plugin-import/lib/rules/exports-last'>;
}
declare module 'eslint-plugin-import/lib/rules/extensions.js' {
  declare module.exports: $Exports<'eslint-plugin-import/lib/rules/extensions'>;
}
declare module 'eslint-plugin-import/lib/rules/first.js' {
  declare module.exports: $Exports<'eslint-plugin-import/lib/rules/first'>;
}
declare module 'eslint-plugin-import/lib/rules/imports-first.js' {
  declare module.exports: $Exports<'eslint-plugin-import/lib/rules/imports-first'>;
}
declare module 'eslint-plugin-import/lib/rules/max-dependencies.js' {
  declare module.exports: $Exports<'eslint-plugin-import/lib/rules/max-dependencies'>;
}
declare module 'eslint-plugin-import/lib/rules/named.js' {
  declare module.exports: $Exports<'eslint-plugin-import/lib/rules/named'>;
}
declare module 'eslint-plugin-import/lib/rules/namespace.js' {
  declare module.exports: $Exports<'eslint-plugin-import/lib/rules/namespace'>;
}
declare module 'eslint-plugin-import/lib/rules/newline-after-import.js' {
  declare module.exports: $Exports<'eslint-plugin-import/lib/rules/newline-after-import'>;
}
declare module 'eslint-plugin-import/lib/rules/no-absolute-path.js' {
  declare module.exports: $Exports<'eslint-plugin-import/lib/rules/no-absolute-path'>;
}
declare module 'eslint-plugin-import/lib/rules/no-amd.js' {
  declare module.exports: $Exports<'eslint-plugin-import/lib/rules/no-amd'>;
}
declare module 'eslint-plugin-import/lib/rules/no-anonymous-default-export.js' {
  declare module.exports: $Exports<'eslint-plugin-import/lib/rules/no-anonymous-default-export'>;
}
declare module 'eslint-plugin-import/lib/rules/no-commonjs.js' {
  declare module.exports: $Exports<'eslint-plugin-import/lib/rules/no-commonjs'>;
}
declare module 'eslint-plugin-import/lib/rules/no-deprecated.js' {
  declare module.exports: $Exports<'eslint-plugin-import/lib/rules/no-deprecated'>;
}
declare module 'eslint-plugin-import/lib/rules/no-duplicates.js' {
  declare module.exports: $Exports<'eslint-plugin-import/lib/rules/no-duplicates'>;
}
declare module 'eslint-plugin-import/lib/rules/no-dynamic-require.js' {
  declare module.exports: $Exports<'eslint-plugin-import/lib/rules/no-dynamic-require'>;
}
declare module 'eslint-plugin-import/lib/rules/no-extraneous-dependencies.js' {
  declare module.exports: $Exports<'eslint-plugin-import/lib/rules/no-extraneous-dependencies'>;
}
declare module 'eslint-plugin-import/lib/rules/no-internal-modules.js' {
  declare module.exports: $Exports<'eslint-plugin-import/lib/rules/no-internal-modules'>;
}
declare module 'eslint-plugin-import/lib/rules/no-mutable-exports.js' {
  declare module.exports: $Exports<'eslint-plugin-import/lib/rules/no-mutable-exports'>;
}
declare module 'eslint-plugin-import/lib/rules/no-named-as-default-member.js' {
  declare module.exports: $Exports<'eslint-plugin-import/lib/rules/no-named-as-default-member'>;
}
declare module 'eslint-plugin-import/lib/rules/no-named-as-default.js' {
  declare module.exports: $Exports<'eslint-plugin-import/lib/rules/no-named-as-default'>;
}
declare module 'eslint-plugin-import/lib/rules/no-named-default.js' {
  declare module.exports: $Exports<'eslint-plugin-import/lib/rules/no-named-default'>;
}
declare module 'eslint-plugin-import/lib/rules/no-namespace.js' {
  declare module.exports: $Exports<'eslint-plugin-import/lib/rules/no-namespace'>;
}
declare module 'eslint-plugin-import/lib/rules/no-nodejs-modules.js' {
  declare module.exports: $Exports<'eslint-plugin-import/lib/rules/no-nodejs-modules'>;
}
declare module 'eslint-plugin-import/lib/rules/no-restricted-paths.js' {
  declare module.exports: $Exports<'eslint-plugin-import/lib/rules/no-restricted-paths'>;
}
declare module 'eslint-plugin-import/lib/rules/no-unassigned-import.js' {
  declare module.exports: $Exports<'eslint-plugin-import/lib/rules/no-unassigned-import'>;
}
declare module 'eslint-plugin-import/lib/rules/no-unresolved.js' {
  declare module.exports: $Exports<'eslint-plugin-import/lib/rules/no-unresolved'>;
}
declare module 'eslint-plugin-import/lib/rules/no-webpack-loader-syntax.js' {
  declare module.exports: $Exports<'eslint-plugin-import/lib/rules/no-webpack-loader-syntax'>;
}
declare module 'eslint-plugin-import/lib/rules/order.js' {
  declare module.exports: $Exports<'eslint-plugin-import/lib/rules/order'>;
}
declare module 'eslint-plugin-import/lib/rules/prefer-default-export.js' {
  declare module.exports: $Exports<'eslint-plugin-import/lib/rules/prefer-default-export'>;
}
declare module 'eslint-plugin-import/lib/rules/unambiguous.js' {
  declare module.exports: $Exports<'eslint-plugin-import/lib/rules/unambiguous'>;
}
declare module 'eslint-plugin-import/memo-parser/index.js' {
  declare module.exports: $Exports<'eslint-plugin-import/memo-parser/index'>;
}
// flow-typed signature: 8a40d0f5dc4e849acdc08684ab7c532f
// flow-typed version: <<STUB>>/eslint-plugin-jest_v^20.0.1/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'eslint-plugin-jest'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'eslint-plugin-jest' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'eslint-plugin-jest/build/index' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jest/build/rules/no-disabled-tests' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jest/build/rules/no-focused-tests' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jest/build/rules/no-identical-title' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jest/build/rules/types' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jest/build/rules/valid-expect' {
  declare module.exports: any;
}

// Filename aliases
declare module 'eslint-plugin-jest/build/index.js' {
  declare module.exports: $Exports<'eslint-plugin-jest/build/index'>;
}
declare module 'eslint-plugin-jest/build/rules/no-disabled-tests.js' {
  declare module.exports: $Exports<'eslint-plugin-jest/build/rules/no-disabled-tests'>;
}
declare module 'eslint-plugin-jest/build/rules/no-focused-tests.js' {
  declare module.exports: $Exports<'eslint-plugin-jest/build/rules/no-focused-tests'>;
}
declare module 'eslint-plugin-jest/build/rules/no-identical-title.js' {
  declare module.exports: $Exports<'eslint-plugin-jest/build/rules/no-identical-title'>;
}
declare module 'eslint-plugin-jest/build/rules/types.js' {
  declare module.exports: $Exports<'eslint-plugin-jest/build/rules/types'>;
}
declare module 'eslint-plugin-jest/build/rules/valid-expect.js' {
  declare module.exports: $Exports<'eslint-plugin-jest/build/rules/valid-expect'>;
}
// flow-typed signature: 6b61f7970cc96dba334588a5e4980afa
// flow-typed version: <<STUB>>/eslint-plugin-jsx-a11y_v^4.0.0/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'eslint-plugin-jsx-a11y'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'eslint-plugin-jsx-a11y' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'eslint-plugin-jsx-a11y/__mocks__/genInteractives' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__mocks__/IdentifierMock' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__mocks__/JSXAttributeMock' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__mocks__/JSXElementMock' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__mocks__/JSXExpressionContainerMock' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__tests__/__util__/parserOptionsMapper' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__tests__/index-test' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/accessible-emoji-test' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/anchor-has-content-test' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/aria-activedescendant-has-tabindex-test' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/aria-props-test' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/aria-proptypes-test' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/aria-role-test' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/aria-unsupported-elements-test' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/click-events-have-key-events-test' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/heading-has-content-test' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/href-no-hash-test' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/html-has-lang-test' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/iframe-has-title-test' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/img-has-alt-test' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/img-redundant-alt-test' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/label-has-for-test' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/lang-test' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/mouse-events-have-key-events-test' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/no-access-key-test' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/no-autofocus-test' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/no-distracting-elements-test' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/no-onchange-test' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/no-redundant-roles-test' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/no-static-element-interactions-test' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/onclick-has-focus-test' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/onclick-has-role-test' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/role-has-required-aria-props-test' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/role-supports-aria-props-test' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/scope-test' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/tabindex-no-positive-test' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__tests__/src/util/getSuggestion-test' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__tests__/src/util/getTabIndex-test' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__tests__/src/util/isInteractiveElement-test' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__tests__/src/util/isInteractiveRole-test' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__tests__/src/util/parserOptionsMapper-test' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/__tests__/src/util/schemas-test' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/flow/eslint' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/index' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/rules/accessible-emoji' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/rules/anchor-has-content' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/rules/aria-activedescendant-has-tabindex' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/rules/aria-props' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/rules/aria-proptypes' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/rules/aria-role' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/rules/aria-unsupported-elements' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/rules/click-events-have-key-events' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/rules/heading-has-content' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/rules/href-no-hash' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/rules/html-has-lang' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/rules/iframe-has-title' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/rules/img-has-alt' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/rules/img-redundant-alt' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/rules/label-has-for' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/rules/lang' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/rules/mouse-events-have-key-events' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/rules/no-access-key' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/rules/no-autofocus' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/rules/no-distracting-elements' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/rules/no-onchange' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/rules/no-redundant-roles' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/rules/no-static-element-interactions' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/rules/onclick-has-focus' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/rules/onclick-has-role' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/rules/role-has-required-aria-props' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/rules/role-supports-aria-props' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/rules/scope' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/rules/tabindex-no-positive' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/getImplicitRole' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/getSuggestion' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/getTabIndex' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/a' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/area' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/article' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/aside' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/body' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/button' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/datalist' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/details' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/dialog' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/dl' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/form' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/h1' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/h2' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/h3' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/h4' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/h5' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/h6' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/hr' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/img' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/index' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/input' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/li' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/link' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/menu' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/menuitem' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/meter' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/nav' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/ol' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/option' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/output' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/progress' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/section' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/select' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/tbody' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/textarea' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/tfoot' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/thead' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/ul' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/isHiddenFromScreenReader' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/isInteractiveElement' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/isInteractiveRole' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/lib/util/schemas' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/scripts/addRuleToIndex' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/scripts/boilerplate/doc' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/scripts/boilerplate/rule' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/scripts/boilerplate/test' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/scripts/create-rule' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/index' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/rules/accessible-emoji' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/rules/anchor-has-content' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/rules/aria-activedescendant-has-tabindex' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/rules/aria-props' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/rules/aria-proptypes' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/rules/aria-role' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/rules/aria-unsupported-elements' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/rules/click-events-have-key-events' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/rules/heading-has-content' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/rules/href-no-hash' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/rules/html-has-lang' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/rules/iframe-has-title' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/rules/img-has-alt' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/rules/img-redundant-alt' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/rules/label-has-for' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/rules/lang' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/rules/mouse-events-have-key-events' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/rules/no-access-key' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/rules/no-autofocus' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/rules/no-distracting-elements' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/rules/no-onchange' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/rules/no-redundant-roles' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/rules/no-static-element-interactions' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/rules/onclick-has-focus' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/rules/onclick-has-role' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/rules/role-has-required-aria-props' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/rules/role-supports-aria-props' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/rules/scope' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/rules/tabindex-no-positive' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/getImplicitRole' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/getSuggestion' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/getTabIndex' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/a' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/area' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/article' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/aside' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/body' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/button' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/datalist' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/details' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/dialog' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/dl' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/form' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/h1' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/h2' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/h3' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/h4' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/h5' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/h6' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/hr' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/img' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/index' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/input' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/li' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/link' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/menu' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/menuitem' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/meter' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/nav' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/ol' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/option' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/output' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/progress' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/section' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/select' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/tbody' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/textarea' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/tfoot' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/thead' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/ul' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/isHiddenFromScreenReader' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/isInteractiveElement' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/isInteractiveRole' {
  declare module.exports: any;
}

declare module 'eslint-plugin-jsx-a11y/src/util/schemas' {
  declare module.exports: any;
}

// Filename aliases
declare module 'eslint-plugin-jsx-a11y/__mocks__/genInteractives.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__mocks__/genInteractives'>;
}
declare module 'eslint-plugin-jsx-a11y/__mocks__/IdentifierMock.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__mocks__/IdentifierMock'>;
}
declare module 'eslint-plugin-jsx-a11y/__mocks__/JSXAttributeMock.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__mocks__/JSXAttributeMock'>;
}
declare module 'eslint-plugin-jsx-a11y/__mocks__/JSXElementMock.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__mocks__/JSXElementMock'>;
}
declare module 'eslint-plugin-jsx-a11y/__mocks__/JSXExpressionContainerMock.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__mocks__/JSXExpressionContainerMock'>;
}
declare module 'eslint-plugin-jsx-a11y/__tests__/__util__/parserOptionsMapper.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__tests__/__util__/parserOptionsMapper'>;
}
declare module 'eslint-plugin-jsx-a11y/__tests__/index-test.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__tests__/index-test'>;
}
declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/accessible-emoji-test.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__tests__/src/rules/accessible-emoji-test'>;
}
declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/anchor-has-content-test.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__tests__/src/rules/anchor-has-content-test'>;
}
declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/aria-activedescendant-has-tabindex-test.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__tests__/src/rules/aria-activedescendant-has-tabindex-test'>;
}
declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/aria-props-test.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__tests__/src/rules/aria-props-test'>;
}
declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/aria-proptypes-test.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__tests__/src/rules/aria-proptypes-test'>;
}
declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/aria-role-test.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__tests__/src/rules/aria-role-test'>;
}
declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/aria-unsupported-elements-test.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__tests__/src/rules/aria-unsupported-elements-test'>;
}
declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/click-events-have-key-events-test.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__tests__/src/rules/click-events-have-key-events-test'>;
}
declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/heading-has-content-test.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__tests__/src/rules/heading-has-content-test'>;
}
declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/href-no-hash-test.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__tests__/src/rules/href-no-hash-test'>;
}
declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/html-has-lang-test.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__tests__/src/rules/html-has-lang-test'>;
}
declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/iframe-has-title-test.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__tests__/src/rules/iframe-has-title-test'>;
}
declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/img-has-alt-test.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__tests__/src/rules/img-has-alt-test'>;
}
declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/img-redundant-alt-test.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__tests__/src/rules/img-redundant-alt-test'>;
}
declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/label-has-for-test.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__tests__/src/rules/label-has-for-test'>;
}
declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/lang-test.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__tests__/src/rules/lang-test'>;
}
declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/mouse-events-have-key-events-test.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__tests__/src/rules/mouse-events-have-key-events-test'>;
}
declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/no-access-key-test.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__tests__/src/rules/no-access-key-test'>;
}
declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/no-autofocus-test.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__tests__/src/rules/no-autofocus-test'>;
}
declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/no-distracting-elements-test.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__tests__/src/rules/no-distracting-elements-test'>;
}
declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/no-onchange-test.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__tests__/src/rules/no-onchange-test'>;
}
declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/no-redundant-roles-test.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__tests__/src/rules/no-redundant-roles-test'>;
}
declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/no-static-element-interactions-test.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__tests__/src/rules/no-static-element-interactions-test'>;
}
declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/onclick-has-focus-test.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__tests__/src/rules/onclick-has-focus-test'>;
}
declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/onclick-has-role-test.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__tests__/src/rules/onclick-has-role-test'>;
}
declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/role-has-required-aria-props-test.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__tests__/src/rules/role-has-required-aria-props-test'>;
}
declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/role-supports-aria-props-test.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__tests__/src/rules/role-supports-aria-props-test'>;
}
declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/scope-test.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__tests__/src/rules/scope-test'>;
}
declare module 'eslint-plugin-jsx-a11y/__tests__/src/rules/tabindex-no-positive-test.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__tests__/src/rules/tabindex-no-positive-test'>;
}
declare module 'eslint-plugin-jsx-a11y/__tests__/src/util/getSuggestion-test.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__tests__/src/util/getSuggestion-test'>;
}
declare module 'eslint-plugin-jsx-a11y/__tests__/src/util/getTabIndex-test.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__tests__/src/util/getTabIndex-test'>;
}
declare module 'eslint-plugin-jsx-a11y/__tests__/src/util/isInteractiveElement-test.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__tests__/src/util/isInteractiveElement-test'>;
}
declare module 'eslint-plugin-jsx-a11y/__tests__/src/util/isInteractiveRole-test.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__tests__/src/util/isInteractiveRole-test'>;
}
declare module 'eslint-plugin-jsx-a11y/__tests__/src/util/parserOptionsMapper-test.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__tests__/src/util/parserOptionsMapper-test'>;
}
declare module 'eslint-plugin-jsx-a11y/__tests__/src/util/schemas-test.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/__tests__/src/util/schemas-test'>;
}
declare module 'eslint-plugin-jsx-a11y/flow/eslint.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/flow/eslint'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/index.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/index'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/rules/accessible-emoji.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/rules/accessible-emoji'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/rules/anchor-has-content.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/rules/anchor-has-content'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/rules/aria-activedescendant-has-tabindex.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/rules/aria-activedescendant-has-tabindex'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/rules/aria-props.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/rules/aria-props'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/rules/aria-proptypes.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/rules/aria-proptypes'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/rules/aria-role.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/rules/aria-role'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/rules/aria-unsupported-elements.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/rules/aria-unsupported-elements'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/rules/click-events-have-key-events.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/rules/click-events-have-key-events'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/rules/heading-has-content.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/rules/heading-has-content'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/rules/href-no-hash.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/rules/href-no-hash'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/rules/html-has-lang.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/rules/html-has-lang'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/rules/iframe-has-title.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/rules/iframe-has-title'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/rules/img-has-alt.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/rules/img-has-alt'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/rules/img-redundant-alt.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/rules/img-redundant-alt'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/rules/label-has-for.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/rules/label-has-for'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/rules/lang.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/rules/lang'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/rules/mouse-events-have-key-events.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/rules/mouse-events-have-key-events'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/rules/no-access-key.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/rules/no-access-key'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/rules/no-autofocus.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/rules/no-autofocus'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/rules/no-distracting-elements.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/rules/no-distracting-elements'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/rules/no-onchange.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/rules/no-onchange'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/rules/no-redundant-roles.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/rules/no-redundant-roles'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/rules/no-static-element-interactions.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/rules/no-static-element-interactions'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/rules/onclick-has-focus.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/rules/onclick-has-focus'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/rules/onclick-has-role.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/rules/onclick-has-role'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/rules/role-has-required-aria-props.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/rules/role-has-required-aria-props'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/rules/role-supports-aria-props.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/rules/role-supports-aria-props'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/rules/scope.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/rules/scope'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/rules/tabindex-no-positive.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/rules/tabindex-no-positive'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/getImplicitRole.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/getImplicitRole'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/getSuggestion.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/getSuggestion'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/getTabIndex.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/getTabIndex'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/a.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/implicitRoles/a'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/area.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/implicitRoles/area'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/article.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/implicitRoles/article'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/aside.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/implicitRoles/aside'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/body.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/implicitRoles/body'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/button.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/implicitRoles/button'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/datalist.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/implicitRoles/datalist'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/details.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/implicitRoles/details'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/dialog.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/implicitRoles/dialog'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/dl.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/implicitRoles/dl'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/form.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/implicitRoles/form'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/h1.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/implicitRoles/h1'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/h2.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/implicitRoles/h2'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/h3.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/implicitRoles/h3'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/h4.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/implicitRoles/h4'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/h5.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/implicitRoles/h5'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/h6.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/implicitRoles/h6'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/hr.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/implicitRoles/hr'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/img.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/implicitRoles/img'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/index.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/implicitRoles/index'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/input.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/implicitRoles/input'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/li.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/implicitRoles/li'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/link.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/implicitRoles/link'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/menu.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/implicitRoles/menu'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/menuitem.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/implicitRoles/menuitem'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/meter.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/implicitRoles/meter'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/nav.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/implicitRoles/nav'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/ol.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/implicitRoles/ol'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/option.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/implicitRoles/option'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/output.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/implicitRoles/output'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/progress.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/implicitRoles/progress'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/section.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/implicitRoles/section'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/select.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/implicitRoles/select'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/tbody.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/implicitRoles/tbody'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/textarea.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/implicitRoles/textarea'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/tfoot.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/implicitRoles/tfoot'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/thead.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/implicitRoles/thead'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/implicitRoles/ul.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/implicitRoles/ul'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/isHiddenFromScreenReader.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/isHiddenFromScreenReader'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/isInteractiveElement.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/isInteractiveElement'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/isInteractiveRole.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/isInteractiveRole'>;
}
declare module 'eslint-plugin-jsx-a11y/lib/util/schemas.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/lib/util/schemas'>;
}
declare module 'eslint-plugin-jsx-a11y/scripts/addRuleToIndex.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/scripts/addRuleToIndex'>;
}
declare module 'eslint-plugin-jsx-a11y/scripts/boilerplate/doc.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/scripts/boilerplate/doc'>;
}
declare module 'eslint-plugin-jsx-a11y/scripts/boilerplate/rule.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/scripts/boilerplate/rule'>;
}
declare module 'eslint-plugin-jsx-a11y/scripts/boilerplate/test.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/scripts/boilerplate/test'>;
}
declare module 'eslint-plugin-jsx-a11y/scripts/create-rule.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/scripts/create-rule'>;
}
declare module 'eslint-plugin-jsx-a11y/src/index.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/index'>;
}
declare module 'eslint-plugin-jsx-a11y/src/rules/accessible-emoji.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/rules/accessible-emoji'>;
}
declare module 'eslint-plugin-jsx-a11y/src/rules/anchor-has-content.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/rules/anchor-has-content'>;
}
declare module 'eslint-plugin-jsx-a11y/src/rules/aria-activedescendant-has-tabindex.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/rules/aria-activedescendant-has-tabindex'>;
}
declare module 'eslint-plugin-jsx-a11y/src/rules/aria-props.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/rules/aria-props'>;
}
declare module 'eslint-plugin-jsx-a11y/src/rules/aria-proptypes.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/rules/aria-proptypes'>;
}
declare module 'eslint-plugin-jsx-a11y/src/rules/aria-role.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/rules/aria-role'>;
}
declare module 'eslint-plugin-jsx-a11y/src/rules/aria-unsupported-elements.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/rules/aria-unsupported-elements'>;
}
declare module 'eslint-plugin-jsx-a11y/src/rules/click-events-have-key-events.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/rules/click-events-have-key-events'>;
}
declare module 'eslint-plugin-jsx-a11y/src/rules/heading-has-content.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/rules/heading-has-content'>;
}
declare module 'eslint-plugin-jsx-a11y/src/rules/href-no-hash.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/rules/href-no-hash'>;
}
declare module 'eslint-plugin-jsx-a11y/src/rules/html-has-lang.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/rules/html-has-lang'>;
}
declare module 'eslint-plugin-jsx-a11y/src/rules/iframe-has-title.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/rules/iframe-has-title'>;
}
declare module 'eslint-plugin-jsx-a11y/src/rules/img-has-alt.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/rules/img-has-alt'>;
}
declare module 'eslint-plugin-jsx-a11y/src/rules/img-redundant-alt.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/rules/img-redundant-alt'>;
}
declare module 'eslint-plugin-jsx-a11y/src/rules/label-has-for.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/rules/label-has-for'>;
}
declare module 'eslint-plugin-jsx-a11y/src/rules/lang.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/rules/lang'>;
}
declare module 'eslint-plugin-jsx-a11y/src/rules/mouse-events-have-key-events.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/rules/mouse-events-have-key-events'>;
}
declare module 'eslint-plugin-jsx-a11y/src/rules/no-access-key.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/rules/no-access-key'>;
}
declare module 'eslint-plugin-jsx-a11y/src/rules/no-autofocus.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/rules/no-autofocus'>;
}
declare module 'eslint-plugin-jsx-a11y/src/rules/no-distracting-elements.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/rules/no-distracting-elements'>;
}
declare module 'eslint-plugin-jsx-a11y/src/rules/no-onchange.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/rules/no-onchange'>;
}
declare module 'eslint-plugin-jsx-a11y/src/rules/no-redundant-roles.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/rules/no-redundant-roles'>;
}
declare module 'eslint-plugin-jsx-a11y/src/rules/no-static-element-interactions.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/rules/no-static-element-interactions'>;
}
declare module 'eslint-plugin-jsx-a11y/src/rules/onclick-has-focus.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/rules/onclick-has-focus'>;
}
declare module 'eslint-plugin-jsx-a11y/src/rules/onclick-has-role.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/rules/onclick-has-role'>;
}
declare module 'eslint-plugin-jsx-a11y/src/rules/role-has-required-aria-props.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/rules/role-has-required-aria-props'>;
}
declare module 'eslint-plugin-jsx-a11y/src/rules/role-supports-aria-props.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/rules/role-supports-aria-props'>;
}
declare module 'eslint-plugin-jsx-a11y/src/rules/scope.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/rules/scope'>;
}
declare module 'eslint-plugin-jsx-a11y/src/rules/tabindex-no-positive.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/rules/tabindex-no-positive'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/getImplicitRole.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/getImplicitRole'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/getSuggestion.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/getSuggestion'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/getTabIndex.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/getTabIndex'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/a.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/implicitRoles/a'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/area.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/implicitRoles/area'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/article.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/implicitRoles/article'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/aside.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/implicitRoles/aside'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/body.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/implicitRoles/body'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/button.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/implicitRoles/button'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/datalist.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/implicitRoles/datalist'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/details.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/implicitRoles/details'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/dialog.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/implicitRoles/dialog'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/dl.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/implicitRoles/dl'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/form.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/implicitRoles/form'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/h1.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/implicitRoles/h1'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/h2.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/implicitRoles/h2'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/h3.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/implicitRoles/h3'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/h4.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/implicitRoles/h4'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/h5.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/implicitRoles/h5'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/h6.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/implicitRoles/h6'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/hr.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/implicitRoles/hr'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/img.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/implicitRoles/img'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/index.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/implicitRoles/index'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/input.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/implicitRoles/input'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/li.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/implicitRoles/li'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/link.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/implicitRoles/link'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/menu.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/implicitRoles/menu'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/menuitem.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/implicitRoles/menuitem'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/meter.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/implicitRoles/meter'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/nav.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/implicitRoles/nav'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/ol.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/implicitRoles/ol'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/option.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/implicitRoles/option'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/output.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/implicitRoles/output'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/progress.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/implicitRoles/progress'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/section.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/implicitRoles/section'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/select.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/implicitRoles/select'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/tbody.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/implicitRoles/tbody'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/textarea.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/implicitRoles/textarea'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/tfoot.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/implicitRoles/tfoot'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/thead.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/implicitRoles/thead'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/implicitRoles/ul.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/implicitRoles/ul'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/isHiddenFromScreenReader.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/isHiddenFromScreenReader'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/isInteractiveElement.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/isInteractiveElement'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/isInteractiveRole.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/isInteractiveRole'>;
}
declare module 'eslint-plugin-jsx-a11y/src/util/schemas.js' {
  declare module.exports: $Exports<'eslint-plugin-jsx-a11y/src/util/schemas'>;
}
// flow-typed signature: 409c518b379d758c595068e9eefec26b
// flow-typed version: <<STUB>>/eslint-plugin-prettier_v^2.3.1/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'eslint-plugin-prettier'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'eslint-plugin-prettier' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'eslint-plugin-prettier/eslint-plugin-prettier' {
  declare module.exports: any;
}

// Filename aliases
declare module 'eslint-plugin-prettier/eslint-plugin-prettier.js' {
  declare module.exports: $Exports<'eslint-plugin-prettier/eslint-plugin-prettier'>;
}
// flow-typed signature: bcecc715564737f1856994b80c3fff42
// flow-typed version: <<STUB>>/eslint-plugin-prettify_v^1.0.0/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'eslint-plugin-prettify'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'eslint-plugin-prettify' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'eslint-plugin-prettify/no-styles' {
  declare module.exports: any;
}

declare module 'eslint-plugin-prettify/rule' {
  declare module.exports: any;
}

// Filename aliases
declare module 'eslint-plugin-prettify/index' {
  declare module.exports: $Exports<'eslint-plugin-prettify'>;
}
declare module 'eslint-plugin-prettify/index.js' {
  declare module.exports: $Exports<'eslint-plugin-prettify'>;
}
declare module 'eslint-plugin-prettify/no-styles.js' {
  declare module.exports: $Exports<'eslint-plugin-prettify/no-styles'>;
}
declare module 'eslint-plugin-prettify/rule.js' {
  declare module.exports: $Exports<'eslint-plugin-prettify/rule'>;
}
// flow-typed signature: db9fe4d9399695da59af119fe46c104a
// flow-typed version: <<STUB>>/eslint-plugin-react_v^6.10.3/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'eslint-plugin-react'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'eslint-plugin-react' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'eslint-plugin-react/lib/rules/display-name' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/forbid-component-props' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/forbid-elements' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/forbid-foreign-prop-types' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/forbid-prop-types' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/jsx-boolean-value' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/jsx-closing-bracket-location' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/jsx-curly-spacing' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/jsx-equals-spacing' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/jsx-filename-extension' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/jsx-first-prop-new-line' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/jsx-handler-names' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/jsx-indent-props' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/jsx-indent' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/jsx-key' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/jsx-max-props-per-line' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/jsx-no-bind' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/jsx-no-comment-textnodes' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/jsx-no-duplicate-props' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/jsx-no-literals' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/jsx-no-target-blank' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/jsx-no-undef' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/jsx-pascal-case' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/jsx-sort-props' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/jsx-space-before-closing' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/jsx-tag-spacing' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/jsx-uses-react' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/jsx-uses-vars' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/jsx-wrap-multilines' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/no-array-index-key' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/no-children-prop' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/no-comment-textnodes' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/no-danger-with-children' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/no-danger' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/no-deprecated' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/no-did-mount-set-state' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/no-did-update-set-state' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/no-direct-mutation-state' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/no-find-dom-node' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/no-is-mounted' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/no-multi-comp' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/no-render-return-value' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/no-set-state' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/no-string-refs' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/no-unescaped-entities' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/no-unknown-property' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/no-unused-prop-types' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/prefer-es6-class' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/prefer-stateless-function' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/prop-types' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/react-in-jsx-scope' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/require-default-props' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/require-extension' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/require-optimization' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/require-render-return' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/self-closing-comp' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/sort-comp' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/sort-prop-types' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/style-prop-object' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/void-dom-elements-no-children' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/rules/wrap-multilines' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/util/annotations' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/util/Components' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/util/getTokenBeforeClosingBracket' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/util/pragma' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/util/variable' {
  declare module.exports: any;
}

declare module 'eslint-plugin-react/lib/util/version' {
  declare module.exports: any;
}

// Filename aliases
declare module 'eslint-plugin-react/index' {
  declare module.exports: $Exports<'eslint-plugin-react'>;
}
declare module 'eslint-plugin-react/index.js' {
  declare module.exports: $Exports<'eslint-plugin-react'>;
}
declare module 'eslint-plugin-react/lib/rules/display-name.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/display-name'>;
}
declare module 'eslint-plugin-react/lib/rules/forbid-component-props.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/forbid-component-props'>;
}
declare module 'eslint-plugin-react/lib/rules/forbid-elements.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/forbid-elements'>;
}
declare module 'eslint-plugin-react/lib/rules/forbid-foreign-prop-types.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/forbid-foreign-prop-types'>;
}
declare module 'eslint-plugin-react/lib/rules/forbid-prop-types.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/forbid-prop-types'>;
}
declare module 'eslint-plugin-react/lib/rules/jsx-boolean-value.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/jsx-boolean-value'>;
}
declare module 'eslint-plugin-react/lib/rules/jsx-closing-bracket-location.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/jsx-closing-bracket-location'>;
}
declare module 'eslint-plugin-react/lib/rules/jsx-curly-spacing.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/jsx-curly-spacing'>;
}
declare module 'eslint-plugin-react/lib/rules/jsx-equals-spacing.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/jsx-equals-spacing'>;
}
declare module 'eslint-plugin-react/lib/rules/jsx-filename-extension.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/jsx-filename-extension'>;
}
declare module 'eslint-plugin-react/lib/rules/jsx-first-prop-new-line.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/jsx-first-prop-new-line'>;
}
declare module 'eslint-plugin-react/lib/rules/jsx-handler-names.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/jsx-handler-names'>;
}
declare module 'eslint-plugin-react/lib/rules/jsx-indent-props.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/jsx-indent-props'>;
}
declare module 'eslint-plugin-react/lib/rules/jsx-indent.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/jsx-indent'>;
}
declare module 'eslint-plugin-react/lib/rules/jsx-key.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/jsx-key'>;
}
declare module 'eslint-plugin-react/lib/rules/jsx-max-props-per-line.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/jsx-max-props-per-line'>;
}
declare module 'eslint-plugin-react/lib/rules/jsx-no-bind.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/jsx-no-bind'>;
}
declare module 'eslint-plugin-react/lib/rules/jsx-no-comment-textnodes.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/jsx-no-comment-textnodes'>;
}
declare module 'eslint-plugin-react/lib/rules/jsx-no-duplicate-props.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/jsx-no-duplicate-props'>;
}
declare module 'eslint-plugin-react/lib/rules/jsx-no-literals.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/jsx-no-literals'>;
}
declare module 'eslint-plugin-react/lib/rules/jsx-no-target-blank.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/jsx-no-target-blank'>;
}
declare module 'eslint-plugin-react/lib/rules/jsx-no-undef.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/jsx-no-undef'>;
}
declare module 'eslint-plugin-react/lib/rules/jsx-pascal-case.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/jsx-pascal-case'>;
}
declare module 'eslint-plugin-react/lib/rules/jsx-sort-props.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/jsx-sort-props'>;
}
declare module 'eslint-plugin-react/lib/rules/jsx-space-before-closing.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/jsx-space-before-closing'>;
}
declare module 'eslint-plugin-react/lib/rules/jsx-tag-spacing.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/jsx-tag-spacing'>;
}
declare module 'eslint-plugin-react/lib/rules/jsx-uses-react.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/jsx-uses-react'>;
}
declare module 'eslint-plugin-react/lib/rules/jsx-uses-vars.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/jsx-uses-vars'>;
}
declare module 'eslint-plugin-react/lib/rules/jsx-wrap-multilines.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/jsx-wrap-multilines'>;
}
declare module 'eslint-plugin-react/lib/rules/no-array-index-key.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/no-array-index-key'>;
}
declare module 'eslint-plugin-react/lib/rules/no-children-prop.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/no-children-prop'>;
}
declare module 'eslint-plugin-react/lib/rules/no-comment-textnodes.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/no-comment-textnodes'>;
}
declare module 'eslint-plugin-react/lib/rules/no-danger-with-children.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/no-danger-with-children'>;
}
declare module 'eslint-plugin-react/lib/rules/no-danger.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/no-danger'>;
}
declare module 'eslint-plugin-react/lib/rules/no-deprecated.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/no-deprecated'>;
}
declare module 'eslint-plugin-react/lib/rules/no-did-mount-set-state.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/no-did-mount-set-state'>;
}
declare module 'eslint-plugin-react/lib/rules/no-did-update-set-state.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/no-did-update-set-state'>;
}
declare module 'eslint-plugin-react/lib/rules/no-direct-mutation-state.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/no-direct-mutation-state'>;
}
declare module 'eslint-plugin-react/lib/rules/no-find-dom-node.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/no-find-dom-node'>;
}
declare module 'eslint-plugin-react/lib/rules/no-is-mounted.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/no-is-mounted'>;
}
declare module 'eslint-plugin-react/lib/rules/no-multi-comp.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/no-multi-comp'>;
}
declare module 'eslint-plugin-react/lib/rules/no-render-return-value.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/no-render-return-value'>;
}
declare module 'eslint-plugin-react/lib/rules/no-set-state.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/no-set-state'>;
}
declare module 'eslint-plugin-react/lib/rules/no-string-refs.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/no-string-refs'>;
}
declare module 'eslint-plugin-react/lib/rules/no-unescaped-entities.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/no-unescaped-entities'>;
}
declare module 'eslint-plugin-react/lib/rules/no-unknown-property.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/no-unknown-property'>;
}
declare module 'eslint-plugin-react/lib/rules/no-unused-prop-types.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/no-unused-prop-types'>;
}
declare module 'eslint-plugin-react/lib/rules/prefer-es6-class.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/prefer-es6-class'>;
}
declare module 'eslint-plugin-react/lib/rules/prefer-stateless-function.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/prefer-stateless-function'>;
}
declare module 'eslint-plugin-react/lib/rules/prop-types.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/prop-types'>;
}
declare module 'eslint-plugin-react/lib/rules/react-in-jsx-scope.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/react-in-jsx-scope'>;
}
declare module 'eslint-plugin-react/lib/rules/require-default-props.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/require-default-props'>;
}
declare module 'eslint-plugin-react/lib/rules/require-extension.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/require-extension'>;
}
declare module 'eslint-plugin-react/lib/rules/require-optimization.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/require-optimization'>;
}
declare module 'eslint-plugin-react/lib/rules/require-render-return.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/require-render-return'>;
}
declare module 'eslint-plugin-react/lib/rules/self-closing-comp.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/self-closing-comp'>;
}
declare module 'eslint-plugin-react/lib/rules/sort-comp.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/sort-comp'>;
}
declare module 'eslint-plugin-react/lib/rules/sort-prop-types.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/sort-prop-types'>;
}
declare module 'eslint-plugin-react/lib/rules/style-prop-object.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/style-prop-object'>;
}
declare module 'eslint-plugin-react/lib/rules/void-dom-elements-no-children.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/void-dom-elements-no-children'>;
}
declare module 'eslint-plugin-react/lib/rules/wrap-multilines.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/rules/wrap-multilines'>;
}
declare module 'eslint-plugin-react/lib/util/annotations.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/util/annotations'>;
}
declare module 'eslint-plugin-react/lib/util/Components.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/util/Components'>;
}
declare module 'eslint-plugin-react/lib/util/getTokenBeforeClosingBracket.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/util/getTokenBeforeClosingBracket'>;
}
declare module 'eslint-plugin-react/lib/util/pragma.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/util/pragma'>;
}
declare module 'eslint-plugin-react/lib/util/variable.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/util/variable'>;
}
declare module 'eslint-plugin-react/lib/util/version.js' {
  declare module.exports: $Exports<'eslint-plugin-react/lib/util/version'>;
}
// flow-typed signature: 21bb1519e9485a20d45c150ed4f678de
// flow-typed version: <<STUB>>/eslint_v^3.19.0/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'eslint'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'eslint' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'eslint/bin/eslint' {
  declare module.exports: any;
}

declare module 'eslint/conf/cli-options' {
  declare module.exports: any;
}

declare module 'eslint/conf/environments' {
  declare module.exports: any;
}

declare module 'eslint/conf/eslint-all' {
  declare module.exports: any;
}

declare module 'eslint/conf/eslint-recommended' {
  declare module.exports: any;
}

declare module 'eslint/lib/api' {
  declare module.exports: any;
}

declare module 'eslint/lib/ast-utils' {
  declare module.exports: any;
}

declare module 'eslint/lib/cli-engine' {
  declare module.exports: any;
}

declare module 'eslint/lib/cli' {
  declare module.exports: any;
}

declare module 'eslint/lib/code-path-analysis/code-path-analyzer' {
  declare module.exports: any;
}

declare module 'eslint/lib/code-path-analysis/code-path-segment' {
  declare module.exports: any;
}

declare module 'eslint/lib/code-path-analysis/code-path-state' {
  declare module.exports: any;
}

declare module 'eslint/lib/code-path-analysis/code-path' {
  declare module.exports: any;
}

declare module 'eslint/lib/code-path-analysis/debug-helpers' {
  declare module.exports: any;
}

declare module 'eslint/lib/code-path-analysis/fork-context' {
  declare module.exports: any;
}

declare module 'eslint/lib/code-path-analysis/id-generator' {
  declare module.exports: any;
}

declare module 'eslint/lib/config' {
  declare module.exports: any;
}

declare module 'eslint/lib/config/autoconfig' {
  declare module.exports: any;
}

declare module 'eslint/lib/config/config-file' {
  declare module.exports: any;
}

declare module 'eslint/lib/config/config-initializer' {
  declare module.exports: any;
}

declare module 'eslint/lib/config/config-ops' {
  declare module.exports: any;
}

declare module 'eslint/lib/config/config-rule' {
  declare module.exports: any;
}

declare module 'eslint/lib/config/config-validator' {
  declare module.exports: any;
}

declare module 'eslint/lib/config/environments' {
  declare module.exports: any;
}

declare module 'eslint/lib/config/plugins' {
  declare module.exports: any;
}

declare module 'eslint/lib/eslint' {
  declare module.exports: any;
}

declare module 'eslint/lib/file-finder' {
  declare module.exports: any;
}

declare module 'eslint/lib/formatters/checkstyle' {
  declare module.exports: any;
}

declare module 'eslint/lib/formatters/codeframe' {
  declare module.exports: any;
}

declare module 'eslint/lib/formatters/compact' {
  declare module.exports: any;
}

declare module 'eslint/lib/formatters/html' {
  declare module.exports: any;
}

declare module 'eslint/lib/formatters/jslint-xml' {
  declare module.exports: any;
}

declare module 'eslint/lib/formatters/json' {
  declare module.exports: any;
}

declare module 'eslint/lib/formatters/junit' {
  declare module.exports: any;
}

declare module 'eslint/lib/formatters/stylish' {
  declare module.exports: any;
}

declare module 'eslint/lib/formatters/table' {
  declare module.exports: any;
}

declare module 'eslint/lib/formatters/tap' {
  declare module.exports: any;
}

declare module 'eslint/lib/formatters/unix' {
  declare module.exports: any;
}

declare module 'eslint/lib/formatters/visualstudio' {
  declare module.exports: any;
}

declare module 'eslint/lib/ignored-paths' {
  declare module.exports: any;
}

declare module 'eslint/lib/internal-rules/internal-consistent-docs-description' {
  declare module.exports: any;
}

declare module 'eslint/lib/internal-rules/internal-no-invalid-meta' {
  declare module.exports: any;
}

declare module 'eslint/lib/load-rules' {
  declare module.exports: any;
}

declare module 'eslint/lib/logging' {
  declare module.exports: any;
}

declare module 'eslint/lib/options' {
  declare module.exports: any;
}

declare module 'eslint/lib/rule-context' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/accessor-pairs' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/array-bracket-spacing' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/array-callback-return' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/arrow-body-style' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/arrow-parens' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/arrow-spacing' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/block-scoped-var' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/block-spacing' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/brace-style' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/callback-return' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/camelcase' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/capitalized-comments' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/class-methods-use-this' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/comma-dangle' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/comma-spacing' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/comma-style' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/complexity' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/computed-property-spacing' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/consistent-return' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/consistent-this' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/constructor-super' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/curly' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/default-case' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/dot-location' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/dot-notation' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/eol-last' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/eqeqeq' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/func-call-spacing' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/func-name-matching' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/func-names' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/func-style' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/generator-star-spacing' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/global-require' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/guard-for-in' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/handle-callback-err' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/id-blacklist' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/id-length' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/id-match' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/indent' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/init-declarations' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/jsx-quotes' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/key-spacing' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/keyword-spacing' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/line-comment-position' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/linebreak-style' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/lines-around-comment' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/lines-around-directive' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/max-depth' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/max-len' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/max-lines' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/max-nested-callbacks' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/max-params' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/max-statements-per-line' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/max-statements' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/multiline-ternary' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/new-cap' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/new-parens' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/newline-after-var' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/newline-before-return' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/newline-per-chained-call' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-alert' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-array-constructor' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-await-in-loop' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-bitwise' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-caller' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-case-declarations' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-catch-shadow' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-class-assign' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-compare-neg-zero' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-cond-assign' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-confusing-arrow' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-console' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-const-assign' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-constant-condition' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-continue' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-control-regex' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-debugger' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-delete-var' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-div-regex' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-dupe-args' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-dupe-class-members' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-dupe-keys' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-duplicate-case' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-duplicate-imports' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-else-return' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-empty-character-class' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-empty-function' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-empty-pattern' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-empty' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-eq-null' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-eval' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-ex-assign' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-extend-native' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-extra-bind' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-extra-boolean-cast' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-extra-label' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-extra-parens' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-extra-semi' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-fallthrough' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-floating-decimal' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-func-assign' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-global-assign' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-implicit-coercion' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-implicit-globals' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-implied-eval' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-inline-comments' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-inner-declarations' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-invalid-regexp' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-invalid-this' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-irregular-whitespace' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-iterator' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-label-var' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-labels' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-lone-blocks' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-lonely-if' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-loop-func' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-magic-numbers' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-mixed-operators' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-mixed-requires' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-mixed-spaces-and-tabs' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-multi-assign' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-multi-spaces' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-multi-str' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-multiple-empty-lines' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-native-reassign' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-negated-condition' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-negated-in-lhs' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-nested-ternary' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-new-func' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-new-object' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-new-require' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-new-symbol' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-new-wrappers' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-new' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-obj-calls' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-octal-escape' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-octal' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-param-reassign' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-path-concat' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-plusplus' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-process-env' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-process-exit' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-proto' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-prototype-builtins' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-redeclare' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-regex-spaces' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-restricted-globals' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-restricted-imports' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-restricted-modules' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-restricted-properties' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-restricted-syntax' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-return-assign' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-return-await' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-script-url' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-self-assign' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-self-compare' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-sequences' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-shadow-restricted-names' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-shadow' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-spaced-func' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-sparse-arrays' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-sync' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-tabs' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-template-curly-in-string' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-ternary' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-this-before-super' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-throw-literal' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-trailing-spaces' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-undef-init' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-undef' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-undefined' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-underscore-dangle' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-unexpected-multiline' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-unmodified-loop-condition' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-unneeded-ternary' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-unreachable' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-unsafe-finally' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-unsafe-negation' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-unused-expressions' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-unused-labels' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-unused-vars' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-use-before-define' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-useless-call' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-useless-computed-key' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-useless-concat' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-useless-constructor' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-useless-escape' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-useless-rename' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-useless-return' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-var' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-void' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-warning-comments' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-whitespace-before-property' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/no-with' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/nonblock-statement-body-position' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/object-curly-newline' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/object-curly-spacing' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/object-property-newline' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/object-shorthand' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/one-var-declaration-per-line' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/one-var' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/operator-assignment' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/operator-linebreak' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/padded-blocks' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/prefer-arrow-callback' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/prefer-const' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/prefer-destructuring' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/prefer-numeric-literals' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/prefer-promise-reject-errors' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/prefer-reflect' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/prefer-rest-params' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/prefer-spread' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/prefer-template' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/quote-props' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/quotes' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/radix' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/require-await' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/require-jsdoc' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/require-yield' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/rest-spread-spacing' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/semi-spacing' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/semi' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/sort-imports' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/sort-keys' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/sort-vars' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/space-before-blocks' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/space-before-function-paren' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/space-in-parens' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/space-infix-ops' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/space-unary-ops' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/spaced-comment' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/strict' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/symbol-description' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/template-curly-spacing' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/template-tag-spacing' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/unicode-bom' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/use-isnan' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/valid-jsdoc' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/valid-typeof' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/vars-on-top' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/wrap-iife' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/wrap-regex' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/yield-star-spacing' {
  declare module.exports: any;
}

declare module 'eslint/lib/rules/yoda' {
  declare module.exports: any;
}

declare module 'eslint/lib/testers/event-generator-tester' {
  declare module.exports: any;
}

declare module 'eslint/lib/testers/rule-tester' {
  declare module.exports: any;
}

declare module 'eslint/lib/timing' {
  declare module.exports: any;
}

declare module 'eslint/lib/token-store/backward-token-comment-cursor' {
  declare module.exports: any;
}

declare module 'eslint/lib/token-store/backward-token-cursor' {
  declare module.exports: any;
}

declare module 'eslint/lib/token-store/cursor' {
  declare module.exports: any;
}

declare module 'eslint/lib/token-store/cursors' {
  declare module.exports: any;
}

declare module 'eslint/lib/token-store/decorative-cursor' {
  declare module.exports: any;
}

declare module 'eslint/lib/token-store/filter-cursor' {
  declare module.exports: any;
}

declare module 'eslint/lib/token-store/forward-token-comment-cursor' {
  declare module.exports: any;
}

declare module 'eslint/lib/token-store/forward-token-cursor' {
  declare module.exports: any;
}

declare module 'eslint/lib/token-store/index' {
  declare module.exports: any;
}

declare module 'eslint/lib/token-store/limit-cursor' {
  declare module.exports: any;
}

declare module 'eslint/lib/token-store/padded-token-cursor' {
  declare module.exports: any;
}

declare module 'eslint/lib/token-store/skip-cursor' {
  declare module.exports: any;
}

declare module 'eslint/lib/token-store/utils' {
  declare module.exports: any;
}

declare module 'eslint/lib/util/comment-event-generator' {
  declare module.exports: any;
}

declare module 'eslint/lib/util/fix-tracker' {
  declare module.exports: any;
}

declare module 'eslint/lib/util/glob-util' {
  declare module.exports: any;
}

declare module 'eslint/lib/util/glob' {
  declare module.exports: any;
}

declare module 'eslint/lib/util/hash' {
  declare module.exports: any;
}

declare module 'eslint/lib/util/keywords' {
  declare module.exports: any;
}

declare module 'eslint/lib/util/module-resolver' {
  declare module.exports: any;
}

declare module 'eslint/lib/util/node-event-generator' {
  declare module.exports: any;
}

declare module 'eslint/lib/util/npm-util' {
  declare module.exports: any;
}

declare module 'eslint/lib/util/path-util' {
  declare module.exports: any;
}

declare module 'eslint/lib/util/patterns/letters' {
  declare module.exports: any;
}

declare module 'eslint/lib/util/rule-fixer' {
  declare module.exports: any;
}

declare module 'eslint/lib/util/source-code-fixer' {
  declare module.exports: any;
}

declare module 'eslint/lib/util/source-code-util' {
  declare module.exports: any;
}

declare module 'eslint/lib/util/source-code' {
  declare module.exports: any;
}

declare module 'eslint/lib/util/traverser' {
  declare module.exports: any;
}

declare module 'eslint/lib/util/xml-escape' {
  declare module.exports: any;
}

// Filename aliases
declare module 'eslint/bin/eslint.js' {
  declare module.exports: $Exports<'eslint/bin/eslint'>;
}
declare module 'eslint/conf/cli-options.js' {
  declare module.exports: $Exports<'eslint/conf/cli-options'>;
}
declare module 'eslint/conf/environments.js' {
  declare module.exports: $Exports<'eslint/conf/environments'>;
}
declare module 'eslint/conf/eslint-all.js' {
  declare module.exports: $Exports<'eslint/conf/eslint-all'>;
}
declare module 'eslint/conf/eslint-recommended.js' {
  declare module.exports: $Exports<'eslint/conf/eslint-recommended'>;
}
declare module 'eslint/lib/api.js' {
  declare module.exports: $Exports<'eslint/lib/api'>;
}
declare module 'eslint/lib/ast-utils.js' {
  declare module.exports: $Exports<'eslint/lib/ast-utils'>;
}
declare module 'eslint/lib/cli-engine.js' {
  declare module.exports: $Exports<'eslint/lib/cli-engine'>;
}
declare module 'eslint/lib/cli.js' {
  declare module.exports: $Exports<'eslint/lib/cli'>;
}
declare module 'eslint/lib/code-path-analysis/code-path-analyzer.js' {
  declare module.exports: $Exports<'eslint/lib/code-path-analysis/code-path-analyzer'>;
}
declare module 'eslint/lib/code-path-analysis/code-path-segment.js' {
  declare module.exports: $Exports<'eslint/lib/code-path-analysis/code-path-segment'>;
}
declare module 'eslint/lib/code-path-analysis/code-path-state.js' {
  declare module.exports: $Exports<'eslint/lib/code-path-analysis/code-path-state'>;
}
declare module 'eslint/lib/code-path-analysis/code-path.js' {
  declare module.exports: $Exports<'eslint/lib/code-path-analysis/code-path'>;
}
declare module 'eslint/lib/code-path-analysis/debug-helpers.js' {
  declare module.exports: $Exports<'eslint/lib/code-path-analysis/debug-helpers'>;
}
declare module 'eslint/lib/code-path-analysis/fork-context.js' {
  declare module.exports: $Exports<'eslint/lib/code-path-analysis/fork-context'>;
}
declare module 'eslint/lib/code-path-analysis/id-generator.js' {
  declare module.exports: $Exports<'eslint/lib/code-path-analysis/id-generator'>;
}
declare module 'eslint/lib/config.js' {
  declare module.exports: $Exports<'eslint/lib/config'>;
}
declare module 'eslint/lib/config/autoconfig.js' {
  declare module.exports: $Exports<'eslint/lib/config/autoconfig'>;
}
declare module 'eslint/lib/config/config-file.js' {
  declare module.exports: $Exports<'eslint/lib/config/config-file'>;
}
declare module 'eslint/lib/config/config-initializer.js' {
  declare module.exports: $Exports<'eslint/lib/config/config-initializer'>;
}
declare module 'eslint/lib/config/config-ops.js' {
  declare module.exports: $Exports<'eslint/lib/config/config-ops'>;
}
declare module 'eslint/lib/config/config-rule.js' {
  declare module.exports: $Exports<'eslint/lib/config/config-rule'>;
}
declare module 'eslint/lib/config/config-validator.js' {
  declare module.exports: $Exports<'eslint/lib/config/config-validator'>;
}
declare module 'eslint/lib/config/environments.js' {
  declare module.exports: $Exports<'eslint/lib/config/environments'>;
}
declare module 'eslint/lib/config/plugins.js' {
  declare module.exports: $Exports<'eslint/lib/config/plugins'>;
}
declare module 'eslint/lib/eslint.js' {
  declare module.exports: $Exports<'eslint/lib/eslint'>;
}
declare module 'eslint/lib/file-finder.js' {
  declare module.exports: $Exports<'eslint/lib/file-finder'>;
}
declare module 'eslint/lib/formatters/checkstyle.js' {
  declare module.exports: $Exports<'eslint/lib/formatters/checkstyle'>;
}
declare module 'eslint/lib/formatters/codeframe.js' {
  declare module.exports: $Exports<'eslint/lib/formatters/codeframe'>;
}
declare module 'eslint/lib/formatters/compact.js' {
  declare module.exports: $Exports<'eslint/lib/formatters/compact'>;
}
declare module 'eslint/lib/formatters/html.js' {
  declare module.exports: $Exports<'eslint/lib/formatters/html'>;
}
declare module 'eslint/lib/formatters/jslint-xml.js' {
  declare module.exports: $Exports<'eslint/lib/formatters/jslint-xml'>;
}
declare module 'eslint/lib/formatters/json.js' {
  declare module.exports: $Exports<'eslint/lib/formatters/json'>;
}
declare module 'eslint/lib/formatters/junit.js' {
  declare module.exports: $Exports<'eslint/lib/formatters/junit'>;
}
declare module 'eslint/lib/formatters/stylish.js' {
  declare module.exports: $Exports<'eslint/lib/formatters/stylish'>;
}
declare module 'eslint/lib/formatters/table.js' {
  declare module.exports: $Exports<'eslint/lib/formatters/table'>;
}
declare module 'eslint/lib/formatters/tap.js' {
  declare module.exports: $Exports<'eslint/lib/formatters/tap'>;
}
declare module 'eslint/lib/formatters/unix.js' {
  declare module.exports: $Exports<'eslint/lib/formatters/unix'>;
}
declare module 'eslint/lib/formatters/visualstudio.js' {
  declare module.exports: $Exports<'eslint/lib/formatters/visualstudio'>;
}
declare module 'eslint/lib/ignored-paths.js' {
  declare module.exports: $Exports<'eslint/lib/ignored-paths'>;
}
declare module 'eslint/lib/internal-rules/internal-consistent-docs-description.js' {
  declare module.exports: $Exports<'eslint/lib/internal-rules/internal-consistent-docs-description'>;
}
declare module 'eslint/lib/internal-rules/internal-no-invalid-meta.js' {
  declare module.exports: $Exports<'eslint/lib/internal-rules/internal-no-invalid-meta'>;
}
declare module 'eslint/lib/load-rules.js' {
  declare module.exports: $Exports<'eslint/lib/load-rules'>;
}
declare module 'eslint/lib/logging.js' {
  declare module.exports: $Exports<'eslint/lib/logging'>;
}
declare module 'eslint/lib/options.js' {
  declare module.exports: $Exports<'eslint/lib/options'>;
}
declare module 'eslint/lib/rule-context.js' {
  declare module.exports: $Exports<'eslint/lib/rule-context'>;
}
declare module 'eslint/lib/rules.js' {
  declare module.exports: $Exports<'eslint/lib/rules'>;
}
declare module 'eslint/lib/rules/accessor-pairs.js' {
  declare module.exports: $Exports<'eslint/lib/rules/accessor-pairs'>;
}
declare module 'eslint/lib/rules/array-bracket-spacing.js' {
  declare module.exports: $Exports<'eslint/lib/rules/array-bracket-spacing'>;
}
declare module 'eslint/lib/rules/array-callback-return.js' {
  declare module.exports: $Exports<'eslint/lib/rules/array-callback-return'>;
}
declare module 'eslint/lib/rules/arrow-body-style.js' {
  declare module.exports: $Exports<'eslint/lib/rules/arrow-body-style'>;
}
declare module 'eslint/lib/rules/arrow-parens.js' {
  declare module.exports: $Exports<'eslint/lib/rules/arrow-parens'>;
}
declare module 'eslint/lib/rules/arrow-spacing.js' {
  declare module.exports: $Exports<'eslint/lib/rules/arrow-spacing'>;
}
declare module 'eslint/lib/rules/block-scoped-var.js' {
  declare module.exports: $Exports<'eslint/lib/rules/block-scoped-var'>;
}
declare module 'eslint/lib/rules/block-spacing.js' {
  declare module.exports: $Exports<'eslint/lib/rules/block-spacing'>;
}
declare module 'eslint/lib/rules/brace-style.js' {
  declare module.exports: $Exports<'eslint/lib/rules/brace-style'>;
}
declare module 'eslint/lib/rules/callback-return.js' {
  declare module.exports: $Exports<'eslint/lib/rules/callback-return'>;
}
declare module 'eslint/lib/rules/camelcase.js' {
  declare module.exports: $Exports<'eslint/lib/rules/camelcase'>;
}
declare module 'eslint/lib/rules/capitalized-comments.js' {
  declare module.exports: $Exports<'eslint/lib/rules/capitalized-comments'>;
}
declare module 'eslint/lib/rules/class-methods-use-this.js' {
  declare module.exports: $Exports<'eslint/lib/rules/class-methods-use-this'>;
}
declare module 'eslint/lib/rules/comma-dangle.js' {
  declare module.exports: $Exports<'eslint/lib/rules/comma-dangle'>;
}
declare module 'eslint/lib/rules/comma-spacing.js' {
  declare module.exports: $Exports<'eslint/lib/rules/comma-spacing'>;
}
declare module 'eslint/lib/rules/comma-style.js' {
  declare module.exports: $Exports<'eslint/lib/rules/comma-style'>;
}
declare module 'eslint/lib/rules/complexity.js' {
  declare module.exports: $Exports<'eslint/lib/rules/complexity'>;
}
declare module 'eslint/lib/rules/computed-property-spacing.js' {
  declare module.exports: $Exports<'eslint/lib/rules/computed-property-spacing'>;
}
declare module 'eslint/lib/rules/consistent-return.js' {
  declare module.exports: $Exports<'eslint/lib/rules/consistent-return'>;
}
declare module 'eslint/lib/rules/consistent-this.js' {
  declare module.exports: $Exports<'eslint/lib/rules/consistent-this'>;
}
declare module 'eslint/lib/rules/constructor-super.js' {
  declare module.exports: $Exports<'eslint/lib/rules/constructor-super'>;
}
declare module 'eslint/lib/rules/curly.js' {
  declare module.exports: $Exports<'eslint/lib/rules/curly'>;
}
declare module 'eslint/lib/rules/default-case.js' {
  declare module.exports: $Exports<'eslint/lib/rules/default-case'>;
}
declare module 'eslint/lib/rules/dot-location.js' {
  declare module.exports: $Exports<'eslint/lib/rules/dot-location'>;
}
declare module 'eslint/lib/rules/dot-notation.js' {
  declare module.exports: $Exports<'eslint/lib/rules/dot-notation'>;
}
declare module 'eslint/lib/rules/eol-last.js' {
  declare module.exports: $Exports<'eslint/lib/rules/eol-last'>;
}
declare module 'eslint/lib/rules/eqeqeq.js' {
  declare module.exports: $Exports<'eslint/lib/rules/eqeqeq'>;
}
declare module 'eslint/lib/rules/func-call-spacing.js' {
  declare module.exports: $Exports<'eslint/lib/rules/func-call-spacing'>;
}
declare module 'eslint/lib/rules/func-name-matching.js' {
  declare module.exports: $Exports<'eslint/lib/rules/func-name-matching'>;
}
declare module 'eslint/lib/rules/func-names.js' {
  declare module.exports: $Exports<'eslint/lib/rules/func-names'>;
}
declare module 'eslint/lib/rules/func-style.js' {
  declare module.exports: $Exports<'eslint/lib/rules/func-style'>;
}
declare module 'eslint/lib/rules/generator-star-spacing.js' {
  declare module.exports: $Exports<'eslint/lib/rules/generator-star-spacing'>;
}
declare module 'eslint/lib/rules/global-require.js' {
  declare module.exports: $Exports<'eslint/lib/rules/global-require'>;
}
declare module 'eslint/lib/rules/guard-for-in.js' {
  declare module.exports: $Exports<'eslint/lib/rules/guard-for-in'>;
}
declare module 'eslint/lib/rules/handle-callback-err.js' {
  declare module.exports: $Exports<'eslint/lib/rules/handle-callback-err'>;
}
declare module 'eslint/lib/rules/id-blacklist.js' {
  declare module.exports: $Exports<'eslint/lib/rules/id-blacklist'>;
}
declare module 'eslint/lib/rules/id-length.js' {
  declare module.exports: $Exports<'eslint/lib/rules/id-length'>;
}
declare module 'eslint/lib/rules/id-match.js' {
  declare module.exports: $Exports<'eslint/lib/rules/id-match'>;
}
declare module 'eslint/lib/rules/indent.js' {
  declare module.exports: $Exports<'eslint/lib/rules/indent'>;
}
declare module 'eslint/lib/rules/init-declarations.js' {
  declare module.exports: $Exports<'eslint/lib/rules/init-declarations'>;
}
declare module 'eslint/lib/rules/jsx-quotes.js' {
  declare module.exports: $Exports<'eslint/lib/rules/jsx-quotes'>;
}
declare module 'eslint/lib/rules/key-spacing.js' {
  declare module.exports: $Exports<'eslint/lib/rules/key-spacing'>;
}
declare module 'eslint/lib/rules/keyword-spacing.js' {
  declare module.exports: $Exports<'eslint/lib/rules/keyword-spacing'>;
}
declare module 'eslint/lib/rules/line-comment-position.js' {
  declare module.exports: $Exports<'eslint/lib/rules/line-comment-position'>;
}
declare module 'eslint/lib/rules/linebreak-style.js' {
  declare module.exports: $Exports<'eslint/lib/rules/linebreak-style'>;
}
declare module 'eslint/lib/rules/lines-around-comment.js' {
  declare module.exports: $Exports<'eslint/lib/rules/lines-around-comment'>;
}
declare module 'eslint/lib/rules/lines-around-directive.js' {
  declare module.exports: $Exports<'eslint/lib/rules/lines-around-directive'>;
}
declare module 'eslint/lib/rules/max-depth.js' {
  declare module.exports: $Exports<'eslint/lib/rules/max-depth'>;
}
declare module 'eslint/lib/rules/max-len.js' {
  declare module.exports: $Exports<'eslint/lib/rules/max-len'>;
}
declare module 'eslint/lib/rules/max-lines.js' {
  declare module.exports: $Exports<'eslint/lib/rules/max-lines'>;
}
declare module 'eslint/lib/rules/max-nested-callbacks.js' {
  declare module.exports: $Exports<'eslint/lib/rules/max-nested-callbacks'>;
}
declare module 'eslint/lib/rules/max-params.js' {
  declare module.exports: $Exports<'eslint/lib/rules/max-params'>;
}
declare module 'eslint/lib/rules/max-statements-per-line.js' {
  declare module.exports: $Exports<'eslint/lib/rules/max-statements-per-line'>;
}
declare module 'eslint/lib/rules/max-statements.js' {
  declare module.exports: $Exports<'eslint/lib/rules/max-statements'>;
}
declare module 'eslint/lib/rules/multiline-ternary.js' {
  declare module.exports: $Exports<'eslint/lib/rules/multiline-ternary'>;
}
declare module 'eslint/lib/rules/new-cap.js' {
  declare module.exports: $Exports<'eslint/lib/rules/new-cap'>;
}
declare module 'eslint/lib/rules/new-parens.js' {
  declare module.exports: $Exports<'eslint/lib/rules/new-parens'>;
}
declare module 'eslint/lib/rules/newline-after-var.js' {
  declare module.exports: $Exports<'eslint/lib/rules/newline-after-var'>;
}
declare module 'eslint/lib/rules/newline-before-return.js' {
  declare module.exports: $Exports<'eslint/lib/rules/newline-before-return'>;
}
declare module 'eslint/lib/rules/newline-per-chained-call.js' {
  declare module.exports: $Exports<'eslint/lib/rules/newline-per-chained-call'>;
}
declare module 'eslint/lib/rules/no-alert.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-alert'>;
}
declare module 'eslint/lib/rules/no-array-constructor.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-array-constructor'>;
}
declare module 'eslint/lib/rules/no-await-in-loop.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-await-in-loop'>;
}
declare module 'eslint/lib/rules/no-bitwise.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-bitwise'>;
}
declare module 'eslint/lib/rules/no-caller.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-caller'>;
}
declare module 'eslint/lib/rules/no-case-declarations.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-case-declarations'>;
}
declare module 'eslint/lib/rules/no-catch-shadow.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-catch-shadow'>;
}
declare module 'eslint/lib/rules/no-class-assign.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-class-assign'>;
}
declare module 'eslint/lib/rules/no-compare-neg-zero.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-compare-neg-zero'>;
}
declare module 'eslint/lib/rules/no-cond-assign.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-cond-assign'>;
}
declare module 'eslint/lib/rules/no-confusing-arrow.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-confusing-arrow'>;
}
declare module 'eslint/lib/rules/no-console.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-console'>;
}
declare module 'eslint/lib/rules/no-const-assign.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-const-assign'>;
}
declare module 'eslint/lib/rules/no-constant-condition.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-constant-condition'>;
}
declare module 'eslint/lib/rules/no-continue.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-continue'>;
}
declare module 'eslint/lib/rules/no-control-regex.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-control-regex'>;
}
declare module 'eslint/lib/rules/no-debugger.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-debugger'>;
}
declare module 'eslint/lib/rules/no-delete-var.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-delete-var'>;
}
declare module 'eslint/lib/rules/no-div-regex.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-div-regex'>;
}
declare module 'eslint/lib/rules/no-dupe-args.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-dupe-args'>;
}
declare module 'eslint/lib/rules/no-dupe-class-members.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-dupe-class-members'>;
}
declare module 'eslint/lib/rules/no-dupe-keys.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-dupe-keys'>;
}
declare module 'eslint/lib/rules/no-duplicate-case.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-duplicate-case'>;
}
declare module 'eslint/lib/rules/no-duplicate-imports.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-duplicate-imports'>;
}
declare module 'eslint/lib/rules/no-else-return.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-else-return'>;
}
declare module 'eslint/lib/rules/no-empty-character-class.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-empty-character-class'>;
}
declare module 'eslint/lib/rules/no-empty-function.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-empty-function'>;
}
declare module 'eslint/lib/rules/no-empty-pattern.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-empty-pattern'>;
}
declare module 'eslint/lib/rules/no-empty.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-empty'>;
}
declare module 'eslint/lib/rules/no-eq-null.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-eq-null'>;
}
declare module 'eslint/lib/rules/no-eval.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-eval'>;
}
declare module 'eslint/lib/rules/no-ex-assign.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-ex-assign'>;
}
declare module 'eslint/lib/rules/no-extend-native.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-extend-native'>;
}
declare module 'eslint/lib/rules/no-extra-bind.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-extra-bind'>;
}
declare module 'eslint/lib/rules/no-extra-boolean-cast.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-extra-boolean-cast'>;
}
declare module 'eslint/lib/rules/no-extra-label.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-extra-label'>;
}
declare module 'eslint/lib/rules/no-extra-parens.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-extra-parens'>;
}
declare module 'eslint/lib/rules/no-extra-semi.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-extra-semi'>;
}
declare module 'eslint/lib/rules/no-fallthrough.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-fallthrough'>;
}
declare module 'eslint/lib/rules/no-floating-decimal.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-floating-decimal'>;
}
declare module 'eslint/lib/rules/no-func-assign.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-func-assign'>;
}
declare module 'eslint/lib/rules/no-global-assign.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-global-assign'>;
}
declare module 'eslint/lib/rules/no-implicit-coercion.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-implicit-coercion'>;
}
declare module 'eslint/lib/rules/no-implicit-globals.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-implicit-globals'>;
}
declare module 'eslint/lib/rules/no-implied-eval.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-implied-eval'>;
}
declare module 'eslint/lib/rules/no-inline-comments.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-inline-comments'>;
}
declare module 'eslint/lib/rules/no-inner-declarations.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-inner-declarations'>;
}
declare module 'eslint/lib/rules/no-invalid-regexp.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-invalid-regexp'>;
}
declare module 'eslint/lib/rules/no-invalid-this.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-invalid-this'>;
}
declare module 'eslint/lib/rules/no-irregular-whitespace.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-irregular-whitespace'>;
}
declare module 'eslint/lib/rules/no-iterator.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-iterator'>;
}
declare module 'eslint/lib/rules/no-label-var.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-label-var'>;
}
declare module 'eslint/lib/rules/no-labels.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-labels'>;
}
declare module 'eslint/lib/rules/no-lone-blocks.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-lone-blocks'>;
}
declare module 'eslint/lib/rules/no-lonely-if.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-lonely-if'>;
}
declare module 'eslint/lib/rules/no-loop-func.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-loop-func'>;
}
declare module 'eslint/lib/rules/no-magic-numbers.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-magic-numbers'>;
}
declare module 'eslint/lib/rules/no-mixed-operators.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-mixed-operators'>;
}
declare module 'eslint/lib/rules/no-mixed-requires.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-mixed-requires'>;
}
declare module 'eslint/lib/rules/no-mixed-spaces-and-tabs.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-mixed-spaces-and-tabs'>;
}
declare module 'eslint/lib/rules/no-multi-assign.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-multi-assign'>;
}
declare module 'eslint/lib/rules/no-multi-spaces.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-multi-spaces'>;
}
declare module 'eslint/lib/rules/no-multi-str.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-multi-str'>;
}
declare module 'eslint/lib/rules/no-multiple-empty-lines.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-multiple-empty-lines'>;
}
declare module 'eslint/lib/rules/no-native-reassign.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-native-reassign'>;
}
declare module 'eslint/lib/rules/no-negated-condition.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-negated-condition'>;
}
declare module 'eslint/lib/rules/no-negated-in-lhs.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-negated-in-lhs'>;
}
declare module 'eslint/lib/rules/no-nested-ternary.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-nested-ternary'>;
}
declare module 'eslint/lib/rules/no-new-func.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-new-func'>;
}
declare module 'eslint/lib/rules/no-new-object.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-new-object'>;
}
declare module 'eslint/lib/rules/no-new-require.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-new-require'>;
}
declare module 'eslint/lib/rules/no-new-symbol.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-new-symbol'>;
}
declare module 'eslint/lib/rules/no-new-wrappers.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-new-wrappers'>;
}
declare module 'eslint/lib/rules/no-new.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-new'>;
}
declare module 'eslint/lib/rules/no-obj-calls.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-obj-calls'>;
}
declare module 'eslint/lib/rules/no-octal-escape.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-octal-escape'>;
}
declare module 'eslint/lib/rules/no-octal.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-octal'>;
}
declare module 'eslint/lib/rules/no-param-reassign.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-param-reassign'>;
}
declare module 'eslint/lib/rules/no-path-concat.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-path-concat'>;
}
declare module 'eslint/lib/rules/no-plusplus.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-plusplus'>;
}
declare module 'eslint/lib/rules/no-process-env.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-process-env'>;
}
declare module 'eslint/lib/rules/no-process-exit.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-process-exit'>;
}
declare module 'eslint/lib/rules/no-proto.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-proto'>;
}
declare module 'eslint/lib/rules/no-prototype-builtins.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-prototype-builtins'>;
}
declare module 'eslint/lib/rules/no-redeclare.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-redeclare'>;
}
declare module 'eslint/lib/rules/no-regex-spaces.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-regex-spaces'>;
}
declare module 'eslint/lib/rules/no-restricted-globals.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-restricted-globals'>;
}
declare module 'eslint/lib/rules/no-restricted-imports.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-restricted-imports'>;
}
declare module 'eslint/lib/rules/no-restricted-modules.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-restricted-modules'>;
}
declare module 'eslint/lib/rules/no-restricted-properties.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-restricted-properties'>;
}
declare module 'eslint/lib/rules/no-restricted-syntax.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-restricted-syntax'>;
}
declare module 'eslint/lib/rules/no-return-assign.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-return-assign'>;
}
declare module 'eslint/lib/rules/no-return-await.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-return-await'>;
}
declare module 'eslint/lib/rules/no-script-url.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-script-url'>;
}
declare module 'eslint/lib/rules/no-self-assign.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-self-assign'>;
}
declare module 'eslint/lib/rules/no-self-compare.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-self-compare'>;
}
declare module 'eslint/lib/rules/no-sequences.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-sequences'>;
}
declare module 'eslint/lib/rules/no-shadow-restricted-names.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-shadow-restricted-names'>;
}
declare module 'eslint/lib/rules/no-shadow.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-shadow'>;
}
declare module 'eslint/lib/rules/no-spaced-func.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-spaced-func'>;
}
declare module 'eslint/lib/rules/no-sparse-arrays.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-sparse-arrays'>;
}
declare module 'eslint/lib/rules/no-sync.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-sync'>;
}
declare module 'eslint/lib/rules/no-tabs.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-tabs'>;
}
declare module 'eslint/lib/rules/no-template-curly-in-string.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-template-curly-in-string'>;
}
declare module 'eslint/lib/rules/no-ternary.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-ternary'>;
}
declare module 'eslint/lib/rules/no-this-before-super.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-this-before-super'>;
}
declare module 'eslint/lib/rules/no-throw-literal.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-throw-literal'>;
}
declare module 'eslint/lib/rules/no-trailing-spaces.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-trailing-spaces'>;
}
declare module 'eslint/lib/rules/no-undef-init.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-undef-init'>;
}
declare module 'eslint/lib/rules/no-undef.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-undef'>;
}
declare module 'eslint/lib/rules/no-undefined.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-undefined'>;
}
declare module 'eslint/lib/rules/no-underscore-dangle.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-underscore-dangle'>;
}
declare module 'eslint/lib/rules/no-unexpected-multiline.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-unexpected-multiline'>;
}
declare module 'eslint/lib/rules/no-unmodified-loop-condition.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-unmodified-loop-condition'>;
}
declare module 'eslint/lib/rules/no-unneeded-ternary.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-unneeded-ternary'>;
}
declare module 'eslint/lib/rules/no-unreachable.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-unreachable'>;
}
declare module 'eslint/lib/rules/no-unsafe-finally.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-unsafe-finally'>;
}
declare module 'eslint/lib/rules/no-unsafe-negation.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-unsafe-negation'>;
}
declare module 'eslint/lib/rules/no-unused-expressions.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-unused-expressions'>;
}
declare module 'eslint/lib/rules/no-unused-labels.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-unused-labels'>;
}
declare module 'eslint/lib/rules/no-unused-vars.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-unused-vars'>;
}
declare module 'eslint/lib/rules/no-use-before-define.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-use-before-define'>;
}
declare module 'eslint/lib/rules/no-useless-call.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-useless-call'>;
}
declare module 'eslint/lib/rules/no-useless-computed-key.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-useless-computed-key'>;
}
declare module 'eslint/lib/rules/no-useless-concat.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-useless-concat'>;
}
declare module 'eslint/lib/rules/no-useless-constructor.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-useless-constructor'>;
}
declare module 'eslint/lib/rules/no-useless-escape.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-useless-escape'>;
}
declare module 'eslint/lib/rules/no-useless-rename.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-useless-rename'>;
}
declare module 'eslint/lib/rules/no-useless-return.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-useless-return'>;
}
declare module 'eslint/lib/rules/no-var.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-var'>;
}
declare module 'eslint/lib/rules/no-void.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-void'>;
}
declare module 'eslint/lib/rules/no-warning-comments.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-warning-comments'>;
}
declare module 'eslint/lib/rules/no-whitespace-before-property.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-whitespace-before-property'>;
}
declare module 'eslint/lib/rules/no-with.js' {
  declare module.exports: $Exports<'eslint/lib/rules/no-with'>;
}
declare module 'eslint/lib/rules/nonblock-statement-body-position.js' {
  declare module.exports: $Exports<'eslint/lib/rules/nonblock-statement-body-position'>;
}
declare module 'eslint/lib/rules/object-curly-newline.js' {
  declare module.exports: $Exports<'eslint/lib/rules/object-curly-newline'>;
}
declare module 'eslint/lib/rules/object-curly-spacing.js' {
  declare module.exports: $Exports<'eslint/lib/rules/object-curly-spacing'>;
}
declare module 'eslint/lib/rules/object-property-newline.js' {
  declare module.exports: $Exports<'eslint/lib/rules/object-property-newline'>;
}
declare module 'eslint/lib/rules/object-shorthand.js' {
  declare module.exports: $Exports<'eslint/lib/rules/object-shorthand'>;
}
declare module 'eslint/lib/rules/one-var-declaration-per-line.js' {
  declare module.exports: $Exports<'eslint/lib/rules/one-var-declaration-per-line'>;
}
declare module 'eslint/lib/rules/one-var.js' {
  declare module.exports: $Exports<'eslint/lib/rules/one-var'>;
}
declare module 'eslint/lib/rules/operator-assignment.js' {
  declare module.exports: $Exports<'eslint/lib/rules/operator-assignment'>;
}
declare module 'eslint/lib/rules/operator-linebreak.js' {
  declare module.exports: $Exports<'eslint/lib/rules/operator-linebreak'>;
}
declare module 'eslint/lib/rules/padded-blocks.js' {
  declare module.exports: $Exports<'eslint/lib/rules/padded-blocks'>;
}
declare module 'eslint/lib/rules/prefer-arrow-callback.js' {
  declare module.exports: $Exports<'eslint/lib/rules/prefer-arrow-callback'>;
}
declare module 'eslint/lib/rules/prefer-const.js' {
  declare module.exports: $Exports<'eslint/lib/rules/prefer-const'>;
}
declare module 'eslint/lib/rules/prefer-destructuring.js' {
  declare module.exports: $Exports<'eslint/lib/rules/prefer-destructuring'>;
}
declare module 'eslint/lib/rules/prefer-numeric-literals.js' {
  declare module.exports: $Exports<'eslint/lib/rules/prefer-numeric-literals'>;
}
declare module 'eslint/lib/rules/prefer-promise-reject-errors.js' {
  declare module.exports: $Exports<'eslint/lib/rules/prefer-promise-reject-errors'>;
}
declare module 'eslint/lib/rules/prefer-reflect.js' {
  declare module.exports: $Exports<'eslint/lib/rules/prefer-reflect'>;
}
declare module 'eslint/lib/rules/prefer-rest-params.js' {
  declare module.exports: $Exports<'eslint/lib/rules/prefer-rest-params'>;
}
declare module 'eslint/lib/rules/prefer-spread.js' {
  declare module.exports: $Exports<'eslint/lib/rules/prefer-spread'>;
}
declare module 'eslint/lib/rules/prefer-template.js' {
  declare module.exports: $Exports<'eslint/lib/rules/prefer-template'>;
}
declare module 'eslint/lib/rules/quote-props.js' {
  declare module.exports: $Exports<'eslint/lib/rules/quote-props'>;
}
declare module 'eslint/lib/rules/quotes.js' {
  declare module.exports: $Exports<'eslint/lib/rules/quotes'>;
}
declare module 'eslint/lib/rules/radix.js' {
  declare module.exports: $Exports<'eslint/lib/rules/radix'>;
}
declare module 'eslint/lib/rules/require-await.js' {
  declare module.exports: $Exports<'eslint/lib/rules/require-await'>;
}
declare module 'eslint/lib/rules/require-jsdoc.js' {
  declare module.exports: $Exports<'eslint/lib/rules/require-jsdoc'>;
}
declare module 'eslint/lib/rules/require-yield.js' {
  declare module.exports: $Exports<'eslint/lib/rules/require-yield'>;
}
declare module 'eslint/lib/rules/rest-spread-spacing.js' {
  declare module.exports: $Exports<'eslint/lib/rules/rest-spread-spacing'>;
}
declare module 'eslint/lib/rules/semi-spacing.js' {
  declare module.exports: $Exports<'eslint/lib/rules/semi-spacing'>;
}
declare module 'eslint/lib/rules/semi.js' {
  declare module.exports: $Exports<'eslint/lib/rules/semi'>;
}
declare module 'eslint/lib/rules/sort-imports.js' {
  declare module.exports: $Exports<'eslint/lib/rules/sort-imports'>;
}
declare module 'eslint/lib/rules/sort-keys.js' {
  declare module.exports: $Exports<'eslint/lib/rules/sort-keys'>;
}
declare module 'eslint/lib/rules/sort-vars.js' {
  declare module.exports: $Exports<'eslint/lib/rules/sort-vars'>;
}
declare module 'eslint/lib/rules/space-before-blocks.js' {
  declare module.exports: $Exports<'eslint/lib/rules/space-before-blocks'>;
}
declare module 'eslint/lib/rules/space-before-function-paren.js' {
  declare module.exports: $Exports<'eslint/lib/rules/space-before-function-paren'>;
}
declare module 'eslint/lib/rules/space-in-parens.js' {
  declare module.exports: $Exports<'eslint/lib/rules/space-in-parens'>;
}
declare module 'eslint/lib/rules/space-infix-ops.js' {
  declare module.exports: $Exports<'eslint/lib/rules/space-infix-ops'>;
}
declare module 'eslint/lib/rules/space-unary-ops.js' {
  declare module.exports: $Exports<'eslint/lib/rules/space-unary-ops'>;
}
declare module 'eslint/lib/rules/spaced-comment.js' {
  declare module.exports: $Exports<'eslint/lib/rules/spaced-comment'>;
}
declare module 'eslint/lib/rules/strict.js' {
  declare module.exports: $Exports<'eslint/lib/rules/strict'>;
}
declare module 'eslint/lib/rules/symbol-description.js' {
  declare module.exports: $Exports<'eslint/lib/rules/symbol-description'>;
}
declare module 'eslint/lib/rules/template-curly-spacing.js' {
  declare module.exports: $Exports<'eslint/lib/rules/template-curly-spacing'>;
}
declare module 'eslint/lib/rules/template-tag-spacing.js' {
  declare module.exports: $Exports<'eslint/lib/rules/template-tag-spacing'>;
}
declare module 'eslint/lib/rules/unicode-bom.js' {
  declare module.exports: $Exports<'eslint/lib/rules/unicode-bom'>;
}
declare module 'eslint/lib/rules/use-isnan.js' {
  declare module.exports: $Exports<'eslint/lib/rules/use-isnan'>;
}
declare module 'eslint/lib/rules/valid-jsdoc.js' {
  declare module.exports: $Exports<'eslint/lib/rules/valid-jsdoc'>;
}
declare module 'eslint/lib/rules/valid-typeof.js' {
  declare module.exports: $Exports<'eslint/lib/rules/valid-typeof'>;
}
declare module 'eslint/lib/rules/vars-on-top.js' {
  declare module.exports: $Exports<'eslint/lib/rules/vars-on-top'>;
}
declare module 'eslint/lib/rules/wrap-iife.js' {
  declare module.exports: $Exports<'eslint/lib/rules/wrap-iife'>;
}
declare module 'eslint/lib/rules/wrap-regex.js' {
  declare module.exports: $Exports<'eslint/lib/rules/wrap-regex'>;
}
declare module 'eslint/lib/rules/yield-star-spacing.js' {
  declare module.exports: $Exports<'eslint/lib/rules/yield-star-spacing'>;
}
declare module 'eslint/lib/rules/yoda.js' {
  declare module.exports: $Exports<'eslint/lib/rules/yoda'>;
}
declare module 'eslint/lib/testers/event-generator-tester.js' {
  declare module.exports: $Exports<'eslint/lib/testers/event-generator-tester'>;
}
declare module 'eslint/lib/testers/rule-tester.js' {
  declare module.exports: $Exports<'eslint/lib/testers/rule-tester'>;
}
declare module 'eslint/lib/timing.js' {
  declare module.exports: $Exports<'eslint/lib/timing'>;
}
declare module 'eslint/lib/token-store/backward-token-comment-cursor.js' {
  declare module.exports: $Exports<'eslint/lib/token-store/backward-token-comment-cursor'>;
}
declare module 'eslint/lib/token-store/backward-token-cursor.js' {
  declare module.exports: $Exports<'eslint/lib/token-store/backward-token-cursor'>;
}
declare module 'eslint/lib/token-store/cursor.js' {
  declare module.exports: $Exports<'eslint/lib/token-store/cursor'>;
}
declare module 'eslint/lib/token-store/cursors.js' {
  declare module.exports: $Exports<'eslint/lib/token-store/cursors'>;
}
declare module 'eslint/lib/token-store/decorative-cursor.js' {
  declare module.exports: $Exports<'eslint/lib/token-store/decorative-cursor'>;
}
declare module 'eslint/lib/token-store/filter-cursor.js' {
  declare module.exports: $Exports<'eslint/lib/token-store/filter-cursor'>;
}
declare module 'eslint/lib/token-store/forward-token-comment-cursor.js' {
  declare module.exports: $Exports<'eslint/lib/token-store/forward-token-comment-cursor'>;
}
declare module 'eslint/lib/token-store/forward-token-cursor.js' {
  declare module.exports: $Exports<'eslint/lib/token-store/forward-token-cursor'>;
}
declare module 'eslint/lib/token-store/index.js' {
  declare module.exports: $Exports<'eslint/lib/token-store/index'>;
}
declare module 'eslint/lib/token-store/limit-cursor.js' {
  declare module.exports: $Exports<'eslint/lib/token-store/limit-cursor'>;
}
declare module 'eslint/lib/token-store/padded-token-cursor.js' {
  declare module.exports: $Exports<'eslint/lib/token-store/padded-token-cursor'>;
}
declare module 'eslint/lib/token-store/skip-cursor.js' {
  declare module.exports: $Exports<'eslint/lib/token-store/skip-cursor'>;
}
declare module 'eslint/lib/token-store/utils.js' {
  declare module.exports: $Exports<'eslint/lib/token-store/utils'>;
}
declare module 'eslint/lib/util/comment-event-generator.js' {
  declare module.exports: $Exports<'eslint/lib/util/comment-event-generator'>;
}
declare module 'eslint/lib/util/fix-tracker.js' {
  declare module.exports: $Exports<'eslint/lib/util/fix-tracker'>;
}
declare module 'eslint/lib/util/glob-util.js' {
  declare module.exports: $Exports<'eslint/lib/util/glob-util'>;
}
declare module 'eslint/lib/util/glob.js' {
  declare module.exports: $Exports<'eslint/lib/util/glob'>;
}
declare module 'eslint/lib/util/hash.js' {
  declare module.exports: $Exports<'eslint/lib/util/hash'>;
}
declare module 'eslint/lib/util/keywords.js' {
  declare module.exports: $Exports<'eslint/lib/util/keywords'>;
}
declare module 'eslint/lib/util/module-resolver.js' {
  declare module.exports: $Exports<'eslint/lib/util/module-resolver'>;
}
declare module 'eslint/lib/util/node-event-generator.js' {
  declare module.exports: $Exports<'eslint/lib/util/node-event-generator'>;
}
declare module 'eslint/lib/util/npm-util.js' {
  declare module.exports: $Exports<'eslint/lib/util/npm-util'>;
}
declare module 'eslint/lib/util/path-util.js' {
  declare module.exports: $Exports<'eslint/lib/util/path-util'>;
}
declare module 'eslint/lib/util/patterns/letters.js' {
  declare module.exports: $Exports<'eslint/lib/util/patterns/letters'>;
}
declare module 'eslint/lib/util/rule-fixer.js' {
  declare module.exports: $Exports<'eslint/lib/util/rule-fixer'>;
}
declare module 'eslint/lib/util/source-code-fixer.js' {
  declare module.exports: $Exports<'eslint/lib/util/source-code-fixer'>;
}
declare module 'eslint/lib/util/source-code-util.js' {
  declare module.exports: $Exports<'eslint/lib/util/source-code-util'>;
}
declare module 'eslint/lib/util/source-code.js' {
  declare module.exports: $Exports<'eslint/lib/util/source-code'>;
}
declare module 'eslint/lib/util/traverser.js' {
  declare module.exports: $Exports<'eslint/lib/util/traverser'>;
}
declare module 'eslint/lib/util/xml-escape.js' {
  declare module.exports: $Exports<'eslint/lib/util/xml-escape'>;
}
// flow-typed signature: f0e399a136d6e8dc8b1fbdc078e2850c
// flow-typed version: ed397013d1/express_v4.x.x/flow_>=v0.32.x

import type { Server } from 'http';
import type { Socket } from 'net';

declare type express$RouterOptions = {
  caseSensitive?: boolean,
  mergeParams?: boolean,
  strict?: boolean
};

declare class express$RequestResponseBase {
  app: express$Application;
  get(field: string): string | void;
}

declare type express$RequestParams = {
  [param: string]: string
}

declare class express$Request extends http$IncomingMessage mixins express$RequestResponseBase {
  baseUrl: string;
  body: any;
  cookies: {[cookie: string]: string};
  connection: Socket;
  fresh: boolean;
  hostname: string;
  ip: string;
  ips: Array<string>;
  method: string;
  originalUrl: string;
  params: express$RequestParams;
  path: string;
  protocol: 'https' | 'http';
  query: {[name: string]: string | Array<string>};
  route: string;
  secure: boolean;
  signedCookies: {[signedCookie: string]: string};
  stale: boolean;
  subdomains: Array<string>;
  xhr: boolean;
  accepts(types: string): string | false;
  accepts(types: Array<string>): string | false;
  acceptsCharsets(...charsets: Array<string>): string | false;
  acceptsEncodings(...encoding: Array<string>): string | false;
  acceptsLanguages(...lang: Array<string>): string | false;
  header(field: string): string | void;
  is(type: string): boolean;
  param(name: string, defaultValue?: string): string | void;
}

declare type express$CookieOptions = {
  domain?: string,
  encode?: (value: string) => string,
  expires?: Date,
  httpOnly?: boolean,
  maxAge?: number,
  path?: string,
  secure?: boolean,
  signed?: boolean
};

declare type express$Path = string | RegExp;

declare type express$RenderCallback = (err: Error | null, html?: string) => mixed;

declare type express$SendFileOptions = {
  maxAge?: number,
  root?: string,
  lastModified?: boolean,
  headers?: {[name: string]: string},
  dotfiles?: 'allow' | 'deny' | 'ignore'
};

declare class express$Response extends http$ServerResponse mixins express$RequestResponseBase {
  headersSent: boolean;
  locals: {[name: string]: mixed};
  append(field: string, value?: string): this;
  attachment(filename?: string): this;
  cookie(name: string, value: string, options?: express$CookieOptions): this;
  clearCookie(name: string, options?: express$CookieOptions): this;
  download(path: string, filename?: string, callback?: (err?: ?Error) => void): this;
  format(typesObject: {[type: string]: Function}): this;
  json(body?: mixed): this;
  jsonp(body?: mixed): this;
  links(links: {[name: string]: string}): this;
  location(path: string): this;
  redirect(url: string, ...args: Array<void>): this;
  redirect(status: number, url: string, ...args: Array<void>): this;
  render(view: string, locals?: {[name: string]: mixed}, callback?: express$RenderCallback): this;
  send(body?: mixed): this;
  sendFile(path: string, options?: express$SendFileOptions, callback?: (err?: ?Error) => mixed): this;
  sendStatus(statusCode: number): this;
  header(field: string, value?: string): this;
  header(headers: {[name: string]: string}): this;
  set(field: string, value?: string|string[]): this;
  set(headers: {[name: string]: string}): this;
  status(statusCode: number): this;
  type(type: string): this;
  vary(field: string): this;
  req: express$Request;
}

declare type express$NextFunction = (err?: ?Error | 'route') => mixed;
declare type express$Middleware =
  ((req: $Subtype<express$Request>, res: express$Response, next: express$NextFunction) => mixed) |
  ((error: Error, req: $Subtype<express$Request>, res: express$Response, next: express$NextFunction) => mixed);
declare interface express$RouteMethodType<T> {
  (middleware: express$Middleware): T;
  (...middleware: Array<express$Middleware>): T;
  (path: express$Path|express$Path[], ...middleware: Array<express$Middleware>): T;
}
declare class express$Route {
  all: express$RouteMethodType<this>;
  get: express$RouteMethodType<this>;
  post: express$RouteMethodType<this>;
  put: express$RouteMethodType<this>;
  head: express$RouteMethodType<this>;
  delete: express$RouteMethodType<this>;
  options: express$RouteMethodType<this>;
  trace: express$RouteMethodType<this>;
  copy: express$RouteMethodType<this>;
  lock: express$RouteMethodType<this>;
  mkcol: express$RouteMethodType<this>;
  move: express$RouteMethodType<this>;
  purge: express$RouteMethodType<this>;
  propfind: express$RouteMethodType<this>;
  proppatch: express$RouteMethodType<this>;
  unlock: express$RouteMethodType<this>;
  report: express$RouteMethodType<this>;
  mkactivity: express$RouteMethodType<this>;
  checkout: express$RouteMethodType<this>;
  merge: express$RouteMethodType<this>;

  // @TODO Missing 'm-search' but get flow illegal name error.

  notify: express$RouteMethodType<this>;
  subscribe: express$RouteMethodType<this>;
  unsubscribe: express$RouteMethodType<this>;
  patch: express$RouteMethodType<this>;
  search: express$RouteMethodType<this>;
  connect: express$RouteMethodType<this>;
}

declare class express$Router extends express$Route {
  constructor(options?: express$RouterOptions): void;
  route(path: string): express$Route;
  static (options?: express$RouterOptions): express$Router;
  use(middleware: express$Middleware): this;
  use(...middleware: Array<express$Middleware>): this;
  use(path: express$Path|express$Path[], ...middleware: Array<express$Middleware>): this;
  use(path: string, router: express$Router): this;
  handle(req: http$IncomingMessage, res: http$ServerResponse, next: express$NextFunction): void;
  param(
    param: string,
    callback: (
      req: $Subtype<express$Request>,
      res: express$Response,
      next: express$NextFunction,
      id: string
    ) => mixed
  ): void;

  // Can't use regular callable signature syntax due to https://github.com/facebook/flow/issues/3084
  $call: (req: http$IncomingMessage, res: http$ServerResponse, next?: ?express$NextFunction) => void;
}

declare class express$Application extends express$Router mixins events$EventEmitter {
  constructor(): void;
  locals: {[name: string]: mixed};
  mountpath: string;
  listen(port: number, hostname?: string, backlog?: number, callback?: (err?: ?Error) => mixed): Server;
  listen(port: number, hostname?: string, callback?: (err?: ?Error) => mixed): Server;
  listen(port: number, callback?: (err?: ?Error) => mixed): Server;
  listen(path: string, callback?: (err?: ?Error) => mixed): Server;
  listen(handle: Object, callback?: (err?: ?Error) => mixed): Server;
  disable(name: string): void;
  disabled(name: string): boolean;
  enable(name: string): express$Application;
  enabled(name: string): boolean;
  engine(name: string, callback: Function): void;
  /**
   * Mixed will not be taken as a value option. Issue around using the GET http method name and the get for settings.
   */
  //   get(name: string): mixed;
  set(name: string, value: mixed): mixed;
  render(name: string, optionsOrFunction: {[name: string]: mixed}, callback: express$RenderCallback): void;
  handle(req: http$IncomingMessage, res: http$ServerResponse, next?: ?express$NextFunction): void;
}

declare module 'express' {
  declare export type RouterOptions = express$RouterOptions;
  declare export type CookieOptions = express$CookieOptions;
  declare export type Middleware = express$Middleware;
  declare export type NextFunction = express$NextFunction;
  declare export type RequestParams = express$RequestParams;
  declare export type $Response = express$Response;
  declare export type $Request = express$Request;
  declare export type $Application = express$Application;

  declare module.exports: {
    (): express$Application, // If you try to call like a function, it will use this signature
    static: (root: string, options?: Object) => express$Middleware, // `static` property on the function
    Router: typeof express$Router, // `Router` property on the function
  };
}
// flow-typed signature: 6a5610678d4b01e13bbfbbc62bdaf583
// flow-typed version: 3817bc6980/flow-bin_v0.x.x/flow_>=v0.25.x

declare module "flow-bin" {
  declare module.exports: string;
}
// flow-typed signature: 334664ea61c80495e1e70186a29a5fa7
// flow-typed version: <<STUB>>/fs-extra_v5.x.x/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'fs-extra'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'fs-extra' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'fs-extra/lib/copy-sync/copy-sync' {
  declare module.exports: any;
}

declare module 'fs-extra/lib/copy-sync/index' {
  declare module.exports: any;
}

declare module 'fs-extra/lib/copy/copy' {
  declare module.exports: any;
}

declare module 'fs-extra/lib/copy/index' {
  declare module.exports: any;
}

declare module 'fs-extra/lib/empty/index' {
  declare module.exports: any;
}

declare module 'fs-extra/lib/ensure/file' {
  declare module.exports: any;
}

declare module 'fs-extra/lib/ensure/index' {
  declare module.exports: any;
}

declare module 'fs-extra/lib/ensure/link' {
  declare module.exports: any;
}

declare module 'fs-extra/lib/ensure/symlink-paths' {
  declare module.exports: any;
}

declare module 'fs-extra/lib/ensure/symlink-type' {
  declare module.exports: any;
}

declare module 'fs-extra/lib/ensure/symlink' {
  declare module.exports: any;
}

declare module 'fs-extra/lib/fs/index' {
  declare module.exports: any;
}

declare module 'fs-extra/lib/index' {
  declare module.exports: any;
}

declare module 'fs-extra/lib/json/index' {
  declare module.exports: any;
}

declare module 'fs-extra/lib/json/jsonfile' {
  declare module.exports: any;
}

declare module 'fs-extra/lib/json/output-json-sync' {
  declare module.exports: any;
}

declare module 'fs-extra/lib/json/output-json' {
  declare module.exports: any;
}

declare module 'fs-extra/lib/mkdirs/index' {
  declare module.exports: any;
}

declare module 'fs-extra/lib/mkdirs/mkdirs-sync' {
  declare module.exports: any;
}

declare module 'fs-extra/lib/mkdirs/mkdirs' {
  declare module.exports: any;
}

declare module 'fs-extra/lib/mkdirs/win32' {
  declare module.exports: any;
}

declare module 'fs-extra/lib/move-sync/index' {
  declare module.exports: any;
}

declare module 'fs-extra/lib/move/index' {
  declare module.exports: any;
}

declare module 'fs-extra/lib/output/index' {
  declare module.exports: any;
}

declare module 'fs-extra/lib/path-exists/index' {
  declare module.exports: any;
}

declare module 'fs-extra/lib/remove/index' {
  declare module.exports: any;
}

declare module 'fs-extra/lib/remove/rimraf' {
  declare module.exports: any;
}

declare module 'fs-extra/lib/util/assign' {
  declare module.exports: any;
}

declare module 'fs-extra/lib/util/buffer' {
  declare module.exports: any;
}

declare module 'fs-extra/lib/util/utimes' {
  declare module.exports: any;
}

// Filename aliases
declare module 'fs-extra/lib/copy-sync/copy-sync.js' {
  declare module.exports: $Exports<'fs-extra/lib/copy-sync/copy-sync'>;
}
declare module 'fs-extra/lib/copy-sync/index.js' {
  declare module.exports: $Exports<'fs-extra/lib/copy-sync/index'>;
}
declare module 'fs-extra/lib/copy/copy.js' {
  declare module.exports: $Exports<'fs-extra/lib/copy/copy'>;
}
declare module 'fs-extra/lib/copy/index.js' {
  declare module.exports: $Exports<'fs-extra/lib/copy/index'>;
}
declare module 'fs-extra/lib/empty/index.js' {
  declare module.exports: $Exports<'fs-extra/lib/empty/index'>;
}
declare module 'fs-extra/lib/ensure/file.js' {
  declare module.exports: $Exports<'fs-extra/lib/ensure/file'>;
}
declare module 'fs-extra/lib/ensure/index.js' {
  declare module.exports: $Exports<'fs-extra/lib/ensure/index'>;
}
declare module 'fs-extra/lib/ensure/link.js' {
  declare module.exports: $Exports<'fs-extra/lib/ensure/link'>;
}
declare module 'fs-extra/lib/ensure/symlink-paths.js' {
  declare module.exports: $Exports<'fs-extra/lib/ensure/symlink-paths'>;
}
declare module 'fs-extra/lib/ensure/symlink-type.js' {
  declare module.exports: $Exports<'fs-extra/lib/ensure/symlink-type'>;
}
declare module 'fs-extra/lib/ensure/symlink.js' {
  declare module.exports: $Exports<'fs-extra/lib/ensure/symlink'>;
}
declare module 'fs-extra/lib/fs/index.js' {
  declare module.exports: $Exports<'fs-extra/lib/fs/index'>;
}
declare module 'fs-extra/lib/index.js' {
  declare module.exports: $Exports<'fs-extra/lib/index'>;
}
declare module 'fs-extra/lib/json/index.js' {
  declare module.exports: $Exports<'fs-extra/lib/json/index'>;
}
declare module 'fs-extra/lib/json/jsonfile.js' {
  declare module.exports: $Exports<'fs-extra/lib/json/jsonfile'>;
}
declare module 'fs-extra/lib/json/output-json-sync.js' {
  declare module.exports: $Exports<'fs-extra/lib/json/output-json-sync'>;
}
declare module 'fs-extra/lib/json/output-json.js' {
  declare module.exports: $Exports<'fs-extra/lib/json/output-json'>;
}
declare module 'fs-extra/lib/mkdirs/index.js' {
  declare module.exports: $Exports<'fs-extra/lib/mkdirs/index'>;
}
declare module 'fs-extra/lib/mkdirs/mkdirs-sync.js' {
  declare module.exports: $Exports<'fs-extra/lib/mkdirs/mkdirs-sync'>;
}
declare module 'fs-extra/lib/mkdirs/mkdirs.js' {
  declare module.exports: $Exports<'fs-extra/lib/mkdirs/mkdirs'>;
}
declare module 'fs-extra/lib/mkdirs/win32.js' {
  declare module.exports: $Exports<'fs-extra/lib/mkdirs/win32'>;
}
declare module 'fs-extra/lib/move-sync/index.js' {
  declare module.exports: $Exports<'fs-extra/lib/move-sync/index'>;
}
declare module 'fs-extra/lib/move/index.js' {
  declare module.exports: $Exports<'fs-extra/lib/move/index'>;
}
declare module 'fs-extra/lib/output/index.js' {
  declare module.exports: $Exports<'fs-extra/lib/output/index'>;
}
declare module 'fs-extra/lib/path-exists/index.js' {
  declare module.exports: $Exports<'fs-extra/lib/path-exists/index'>;
}
declare module 'fs-extra/lib/remove/index.js' {
  declare module.exports: $Exports<'fs-extra/lib/remove/index'>;
}
declare module 'fs-extra/lib/remove/rimraf.js' {
  declare module.exports: $Exports<'fs-extra/lib/remove/rimraf'>;
}
declare module 'fs-extra/lib/util/assign.js' {
  declare module.exports: $Exports<'fs-extra/lib/util/assign'>;
}
declare module 'fs-extra/lib/util/buffer.js' {
  declare module.exports: $Exports<'fs-extra/lib/util/buffer'>;
}
declare module 'fs-extra/lib/util/utimes.js' {
  declare module.exports: $Exports<'fs-extra/lib/util/utimes'>;
}
// flow-typed signature: 69ddad32e70eb9e1eb79e7ce2017117b
// flow-typed version: <<STUB>>/graphiql_v0.11.10/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'graphiql'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'graphiql' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'graphiql/dist/components/DocExplorer' {
  declare module.exports: any;
}

declare module 'graphiql/dist/components/DocExplorer/Argument' {
  declare module.exports: any;
}

declare module 'graphiql/dist/components/DocExplorer/DefaultValue' {
  declare module.exports: any;
}

declare module 'graphiql/dist/components/DocExplorer/FieldDoc' {
  declare module.exports: any;
}

declare module 'graphiql/dist/components/DocExplorer/MarkdownContent' {
  declare module.exports: any;
}

declare module 'graphiql/dist/components/DocExplorer/SchemaDoc' {
  declare module.exports: any;
}

declare module 'graphiql/dist/components/DocExplorer/SearchBox' {
  declare module.exports: any;
}

declare module 'graphiql/dist/components/DocExplorer/SearchResults' {
  declare module.exports: any;
}

declare module 'graphiql/dist/components/DocExplorer/TypeDoc' {
  declare module.exports: any;
}

declare module 'graphiql/dist/components/DocExplorer/TypeLink' {
  declare module.exports: any;
}

declare module 'graphiql/dist/components/ExecuteButton' {
  declare module.exports: any;
}

declare module 'graphiql/dist/components/GraphiQL' {
  declare module.exports: any;
}

declare module 'graphiql/dist/components/HistoryQuery' {
  declare module.exports: any;
}

declare module 'graphiql/dist/components/QueryEditor' {
  declare module.exports: any;
}

declare module 'graphiql/dist/components/QueryHistory' {
  declare module.exports: any;
}

declare module 'graphiql/dist/components/ResultViewer' {
  declare module.exports: any;
}

declare module 'graphiql/dist/components/ToolbarButton' {
  declare module.exports: any;
}

declare module 'graphiql/dist/components/ToolbarGroup' {
  declare module.exports: any;
}

declare module 'graphiql/dist/components/ToolbarMenu' {
  declare module.exports: any;
}

declare module 'graphiql/dist/components/ToolbarSelect' {
  declare module.exports: any;
}

declare module 'graphiql/dist/components/VariableEditor' {
  declare module.exports: any;
}

declare module 'graphiql/dist/index' {
  declare module.exports: any;
}

declare module 'graphiql/dist/utility/CodeMirrorSizer' {
  declare module.exports: any;
}

declare module 'graphiql/dist/utility/debounce' {
  declare module.exports: any;
}

declare module 'graphiql/dist/utility/elementPosition' {
  declare module.exports: any;
}

declare module 'graphiql/dist/utility/fillLeafs' {
  declare module.exports: any;
}

declare module 'graphiql/dist/utility/find' {
  declare module.exports: any;
}

declare module 'graphiql/dist/utility/getQueryFacts' {
  declare module.exports: any;
}

declare module 'graphiql/dist/utility/getSelectedOperationName' {
  declare module.exports: any;
}

declare module 'graphiql/dist/utility/introspectionQueries' {
  declare module.exports: any;
}

declare module 'graphiql/dist/utility/normalizeWhitespace' {
  declare module.exports: any;
}

declare module 'graphiql/dist/utility/onHasCompletion' {
  declare module.exports: any;
}

declare module 'graphiql/dist/utility/QueryStore' {
  declare module.exports: any;
}

declare module 'graphiql/dist/utility/StorageAPI' {
  declare module.exports: any;
}

declare module 'graphiql/graphiql' {
  declare module.exports: any;
}

declare module 'graphiql/graphiql.min' {
  declare module.exports: any;
}

// Filename aliases
declare module 'graphiql/dist/components/DocExplorer.js' {
  declare module.exports: $Exports<'graphiql/dist/components/DocExplorer'>;
}
declare module 'graphiql/dist/components/DocExplorer/Argument.js' {
  declare module.exports: $Exports<'graphiql/dist/components/DocExplorer/Argument'>;
}
declare module 'graphiql/dist/components/DocExplorer/DefaultValue.js' {
  declare module.exports: $Exports<'graphiql/dist/components/DocExplorer/DefaultValue'>;
}
declare module 'graphiql/dist/components/DocExplorer/FieldDoc.js' {
  declare module.exports: $Exports<'graphiql/dist/components/DocExplorer/FieldDoc'>;
}
declare module 'graphiql/dist/components/DocExplorer/MarkdownContent.js' {
  declare module.exports: $Exports<'graphiql/dist/components/DocExplorer/MarkdownContent'>;
}
declare module 'graphiql/dist/components/DocExplorer/SchemaDoc.js' {
  declare module.exports: $Exports<'graphiql/dist/components/DocExplorer/SchemaDoc'>;
}
declare module 'graphiql/dist/components/DocExplorer/SearchBox.js' {
  declare module.exports: $Exports<'graphiql/dist/components/DocExplorer/SearchBox'>;
}
declare module 'graphiql/dist/components/DocExplorer/SearchResults.js' {
  declare module.exports: $Exports<'graphiql/dist/components/DocExplorer/SearchResults'>;
}
declare module 'graphiql/dist/components/DocExplorer/TypeDoc.js' {
  declare module.exports: $Exports<'graphiql/dist/components/DocExplorer/TypeDoc'>;
}
declare module 'graphiql/dist/components/DocExplorer/TypeLink.js' {
  declare module.exports: $Exports<'graphiql/dist/components/DocExplorer/TypeLink'>;
}
declare module 'graphiql/dist/components/ExecuteButton.js' {
  declare module.exports: $Exports<'graphiql/dist/components/ExecuteButton'>;
}
declare module 'graphiql/dist/components/GraphiQL.js' {
  declare module.exports: $Exports<'graphiql/dist/components/GraphiQL'>;
}
declare module 'graphiql/dist/components/HistoryQuery.js' {
  declare module.exports: $Exports<'graphiql/dist/components/HistoryQuery'>;
}
declare module 'graphiql/dist/components/QueryEditor.js' {
  declare module.exports: $Exports<'graphiql/dist/components/QueryEditor'>;
}
declare module 'graphiql/dist/components/QueryHistory.js' {
  declare module.exports: $Exports<'graphiql/dist/components/QueryHistory'>;
}
declare module 'graphiql/dist/components/ResultViewer.js' {
  declare module.exports: $Exports<'graphiql/dist/components/ResultViewer'>;
}
declare module 'graphiql/dist/components/ToolbarButton.js' {
  declare module.exports: $Exports<'graphiql/dist/components/ToolbarButton'>;
}
declare module 'graphiql/dist/components/ToolbarGroup.js' {
  declare module.exports: $Exports<'graphiql/dist/components/ToolbarGroup'>;
}
declare module 'graphiql/dist/components/ToolbarMenu.js' {
  declare module.exports: $Exports<'graphiql/dist/components/ToolbarMenu'>;
}
declare module 'graphiql/dist/components/ToolbarSelect.js' {
  declare module.exports: $Exports<'graphiql/dist/components/ToolbarSelect'>;
}
declare module 'graphiql/dist/components/VariableEditor.js' {
  declare module.exports: $Exports<'graphiql/dist/components/VariableEditor'>;
}
declare module 'graphiql/dist/index.js' {
  declare module.exports: $Exports<'graphiql/dist/index'>;
}
declare module 'graphiql/dist/utility/CodeMirrorSizer.js' {
  declare module.exports: $Exports<'graphiql/dist/utility/CodeMirrorSizer'>;
}
declare module 'graphiql/dist/utility/debounce.js' {
  declare module.exports: $Exports<'graphiql/dist/utility/debounce'>;
}
declare module 'graphiql/dist/utility/elementPosition.js' {
  declare module.exports: $Exports<'graphiql/dist/utility/elementPosition'>;
}
declare module 'graphiql/dist/utility/fillLeafs.js' {
  declare module.exports: $Exports<'graphiql/dist/utility/fillLeafs'>;
}
declare module 'graphiql/dist/utility/find.js' {
  declare module.exports: $Exports<'graphiql/dist/utility/find'>;
}
declare module 'graphiql/dist/utility/getQueryFacts.js' {
  declare module.exports: $Exports<'graphiql/dist/utility/getQueryFacts'>;
}
declare module 'graphiql/dist/utility/getSelectedOperationName.js' {
  declare module.exports: $Exports<'graphiql/dist/utility/getSelectedOperationName'>;
}
declare module 'graphiql/dist/utility/introspectionQueries.js' {
  declare module.exports: $Exports<'graphiql/dist/utility/introspectionQueries'>;
}
declare module 'graphiql/dist/utility/normalizeWhitespace.js' {
  declare module.exports: $Exports<'graphiql/dist/utility/normalizeWhitespace'>;
}
declare module 'graphiql/dist/utility/onHasCompletion.js' {
  declare module.exports: $Exports<'graphiql/dist/utility/onHasCompletion'>;
}
declare module 'graphiql/dist/utility/QueryStore.js' {
  declare module.exports: $Exports<'graphiql/dist/utility/QueryStore'>;
}
declare module 'graphiql/dist/utility/StorageAPI.js' {
  declare module.exports: $Exports<'graphiql/dist/utility/StorageAPI'>;
}
declare module 'graphiql/graphiql.js' {
  declare module.exports: $Exports<'graphiql/graphiql'>;
}
declare module 'graphiql/graphiql.min.js' {
  declare module.exports: $Exports<'graphiql/graphiql.min'>;
}
// flow-typed signature: 78a3b0630930ae254dcef08544af115d
// flow-typed version: <<STUB>>/graphql_v^0.11.7/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'graphql'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'graphql' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'graphql/error/formatError' {
  declare module.exports: any;
}

declare module 'graphql/error/GraphQLError' {
  declare module.exports: any;
}

declare module 'graphql/error/index' {
  declare module.exports: any;
}

declare module 'graphql/error/locatedError' {
  declare module.exports: any;
}

declare module 'graphql/error/syntaxError' {
  declare module.exports: any;
}

declare module 'graphql/execution/execute' {
  declare module.exports: any;
}

declare module 'graphql/execution/index' {
  declare module.exports: any;
}

declare module 'graphql/execution/values' {
  declare module.exports: any;
}

declare module 'graphql/graphql' {
  declare module.exports: any;
}

declare module 'graphql/jsutils/dedent' {
  declare module.exports: any;
}

declare module 'graphql/jsutils/find' {
  declare module.exports: any;
}

declare module 'graphql/jsutils/invariant' {
  declare module.exports: any;
}

declare module 'graphql/jsutils/isInvalid' {
  declare module.exports: any;
}

declare module 'graphql/jsutils/isNullish' {
  declare module.exports: any;
}

declare module 'graphql/jsutils/keyMap' {
  declare module.exports: any;
}

declare module 'graphql/jsutils/keyValMap' {
  declare module.exports: any;
}

declare module 'graphql/jsutils/ObjMap' {
  declare module.exports: any;
}

declare module 'graphql/jsutils/quotedOrList' {
  declare module.exports: any;
}

declare module 'graphql/jsutils/suggestionList' {
  declare module.exports: any;
}

declare module 'graphql/language/ast' {
  declare module.exports: any;
}

declare module 'graphql/language/index' {
  declare module.exports: any;
}

declare module 'graphql/language/kinds' {
  declare module.exports: any;
}

declare module 'graphql/language/lexer' {
  declare module.exports: any;
}

declare module 'graphql/language/location' {
  declare module.exports: any;
}

declare module 'graphql/language/parser' {
  declare module.exports: any;
}

declare module 'graphql/language/printer' {
  declare module.exports: any;
}

declare module 'graphql/language/source' {
  declare module.exports: any;
}

declare module 'graphql/language/visitor' {
  declare module.exports: any;
}

declare module 'graphql/subscription/asyncIteratorReject' {
  declare module.exports: any;
}

declare module 'graphql/subscription/index' {
  declare module.exports: any;
}

declare module 'graphql/subscription/mapAsyncIterator' {
  declare module.exports: any;
}

declare module 'graphql/subscription/subscribe' {
  declare module.exports: any;
}

declare module 'graphql/type/definition' {
  declare module.exports: any;
}

declare module 'graphql/type/directives' {
  declare module.exports: any;
}

declare module 'graphql/type/index' {
  declare module.exports: any;
}

declare module 'graphql/type/introspection' {
  declare module.exports: any;
}

declare module 'graphql/type/scalars' {
  declare module.exports: any;
}

declare module 'graphql/type/schema' {
  declare module.exports: any;
}

declare module 'graphql/utilities/assertValidName' {
  declare module.exports: any;
}

declare module 'graphql/utilities/astFromValue' {
  declare module.exports: any;
}

declare module 'graphql/utilities/buildASTSchema' {
  declare module.exports: any;
}

declare module 'graphql/utilities/buildClientSchema' {
  declare module.exports: any;
}

declare module 'graphql/utilities/concatAST' {
  declare module.exports: any;
}

declare module 'graphql/utilities/extendSchema' {
  declare module.exports: any;
}

declare module 'graphql/utilities/findBreakingChanges' {
  declare module.exports: any;
}

declare module 'graphql/utilities/findDeprecatedUsages' {
  declare module.exports: any;
}

declare module 'graphql/utilities/getOperationAST' {
  declare module.exports: any;
}

declare module 'graphql/utilities/index' {
  declare module.exports: any;
}

declare module 'graphql/utilities/introspectionQuery' {
  declare module.exports: any;
}

declare module 'graphql/utilities/isValidJSValue' {
  declare module.exports: any;
}

declare module 'graphql/utilities/isValidLiteralValue' {
  declare module.exports: any;
}

declare module 'graphql/utilities/schemaPrinter' {
  declare module.exports: any;
}

declare module 'graphql/utilities/separateOperations' {
  declare module.exports: any;
}

declare module 'graphql/utilities/typeComparators' {
  declare module.exports: any;
}

declare module 'graphql/utilities/typeFromAST' {
  declare module.exports: any;
}

declare module 'graphql/utilities/TypeInfo' {
  declare module.exports: any;
}

declare module 'graphql/utilities/valueFromAST' {
  declare module.exports: any;
}

declare module 'graphql/validation/index' {
  declare module.exports: any;
}

declare module 'graphql/validation/rules/ArgumentsOfCorrectType' {
  declare module.exports: any;
}

declare module 'graphql/validation/rules/DefaultValuesOfCorrectType' {
  declare module.exports: any;
}

declare module 'graphql/validation/rules/FieldsOnCorrectType' {
  declare module.exports: any;
}

declare module 'graphql/validation/rules/FragmentsOnCompositeTypes' {
  declare module.exports: any;
}

declare module 'graphql/validation/rules/KnownArgumentNames' {
  declare module.exports: any;
}

declare module 'graphql/validation/rules/KnownDirectives' {
  declare module.exports: any;
}

declare module 'graphql/validation/rules/KnownFragmentNames' {
  declare module.exports: any;
}

declare module 'graphql/validation/rules/KnownTypeNames' {
  declare module.exports: any;
}

declare module 'graphql/validation/rules/LoneAnonymousOperation' {
  declare module.exports: any;
}

declare module 'graphql/validation/rules/NoFragmentCycles' {
  declare module.exports: any;
}

declare module 'graphql/validation/rules/NoUndefinedVariables' {
  declare module.exports: any;
}

declare module 'graphql/validation/rules/NoUnusedFragments' {
  declare module.exports: any;
}

declare module 'graphql/validation/rules/NoUnusedVariables' {
  declare module.exports: any;
}

declare module 'graphql/validation/rules/OverlappingFieldsCanBeMerged' {
  declare module.exports: any;
}

declare module 'graphql/validation/rules/PossibleFragmentSpreads' {
  declare module.exports: any;
}

declare module 'graphql/validation/rules/ProvidedNonNullArguments' {
  declare module.exports: any;
}

declare module 'graphql/validation/rules/ScalarLeafs' {
  declare module.exports: any;
}

declare module 'graphql/validation/rules/SingleFieldSubscriptions' {
  declare module.exports: any;
}

declare module 'graphql/validation/rules/UniqueArgumentNames' {
  declare module.exports: any;
}

declare module 'graphql/validation/rules/UniqueDirectivesPerLocation' {
  declare module.exports: any;
}

declare module 'graphql/validation/rules/UniqueFragmentNames' {
  declare module.exports: any;
}

declare module 'graphql/validation/rules/UniqueInputFieldNames' {
  declare module.exports: any;
}

declare module 'graphql/validation/rules/UniqueOperationNames' {
  declare module.exports: any;
}

declare module 'graphql/validation/rules/UniqueVariableNames' {
  declare module.exports: any;
}

declare module 'graphql/validation/rules/VariablesAreInputTypes' {
  declare module.exports: any;
}

declare module 'graphql/validation/rules/VariablesInAllowedPosition' {
  declare module.exports: any;
}

declare module 'graphql/validation/specifiedRules' {
  declare module.exports: any;
}

declare module 'graphql/validation/validate' {
  declare module.exports: any;
}

// Filename aliases
declare module 'graphql/error/formatError.js' {
  declare module.exports: $Exports<'graphql/error/formatError'>;
}
declare module 'graphql/error/GraphQLError.js' {
  declare module.exports: $Exports<'graphql/error/GraphQLError'>;
}
declare module 'graphql/error/index.js' {
  declare module.exports: $Exports<'graphql/error/index'>;
}
declare module 'graphql/error/locatedError.js' {
  declare module.exports: $Exports<'graphql/error/locatedError'>;
}
declare module 'graphql/error/syntaxError.js' {
  declare module.exports: $Exports<'graphql/error/syntaxError'>;
}
declare module 'graphql/execution/execute.js' {
  declare module.exports: $Exports<'graphql/execution/execute'>;
}
declare module 'graphql/execution/index.js' {
  declare module.exports: $Exports<'graphql/execution/index'>;
}
declare module 'graphql/execution/values.js' {
  declare module.exports: $Exports<'graphql/execution/values'>;
}
declare module 'graphql/graphql.js' {
  declare module.exports: $Exports<'graphql/graphql'>;
}
declare module 'graphql/index' {
  declare module.exports: $Exports<'graphql'>;
}
declare module 'graphql/index.js' {
  declare module.exports: $Exports<'graphql'>;
}
declare module 'graphql/jsutils/dedent.js' {
  declare module.exports: $Exports<'graphql/jsutils/dedent'>;
}
declare module 'graphql/jsutils/find.js' {
  declare module.exports: $Exports<'graphql/jsutils/find'>;
}
declare module 'graphql/jsutils/invariant.js' {
  declare module.exports: $Exports<'graphql/jsutils/invariant'>;
}
declare module 'graphql/jsutils/isInvalid.js' {
  declare module.exports: $Exports<'graphql/jsutils/isInvalid'>;
}
declare module 'graphql/jsutils/isNullish.js' {
  declare module.exports: $Exports<'graphql/jsutils/isNullish'>;
}
declare module 'graphql/jsutils/keyMap.js' {
  declare module.exports: $Exports<'graphql/jsutils/keyMap'>;
}
declare module 'graphql/jsutils/keyValMap.js' {
  declare module.exports: $Exports<'graphql/jsutils/keyValMap'>;
}
declare module 'graphql/jsutils/ObjMap.js' {
  declare module.exports: $Exports<'graphql/jsutils/ObjMap'>;
}
declare module 'graphql/jsutils/quotedOrList.js' {
  declare module.exports: $Exports<'graphql/jsutils/quotedOrList'>;
}
declare module 'graphql/jsutils/suggestionList.js' {
  declare module.exports: $Exports<'graphql/jsutils/suggestionList'>;
}
declare module 'graphql/language/ast.js' {
  declare module.exports: $Exports<'graphql/language/ast'>;
}
declare module 'graphql/language/index.js' {
  declare module.exports: $Exports<'graphql/language/index'>;
}
declare module 'graphql/language/kinds.js' {
  declare module.exports: $Exports<'graphql/language/kinds'>;
}
declare module 'graphql/language/lexer.js' {
  declare module.exports: $Exports<'graphql/language/lexer'>;
}
declare module 'graphql/language/location.js' {
  declare module.exports: $Exports<'graphql/language/location'>;
}
declare module 'graphql/language/parser.js' {
  declare module.exports: $Exports<'graphql/language/parser'>;
}
declare module 'graphql/language/printer.js' {
  declare module.exports: $Exports<'graphql/language/printer'>;
}
declare module 'graphql/language/source.js' {
  declare module.exports: $Exports<'graphql/language/source'>;
}
declare module 'graphql/language/visitor.js' {
  declare module.exports: $Exports<'graphql/language/visitor'>;
}
declare module 'graphql/subscription/asyncIteratorReject.js' {
  declare module.exports: $Exports<'graphql/subscription/asyncIteratorReject'>;
}
declare module 'graphql/subscription/index.js' {
  declare module.exports: $Exports<'graphql/subscription/index'>;
}
declare module 'graphql/subscription/mapAsyncIterator.js' {
  declare module.exports: $Exports<'graphql/subscription/mapAsyncIterator'>;
}
declare module 'graphql/subscription/subscribe.js' {
  declare module.exports: $Exports<'graphql/subscription/subscribe'>;
}
declare module 'graphql/type/definition.js' {
  declare module.exports: $Exports<'graphql/type/definition'>;
}
declare module 'graphql/type/directives.js' {
  declare module.exports: $Exports<'graphql/type/directives'>;
}
declare module 'graphql/type/index.js' {
  declare module.exports: $Exports<'graphql/type/index'>;
}
declare module 'graphql/type/introspection.js' {
  declare module.exports: $Exports<'graphql/type/introspection'>;
}
declare module 'graphql/type/scalars.js' {
  declare module.exports: $Exports<'graphql/type/scalars'>;
}
declare module 'graphql/type/schema.js' {
  declare module.exports: $Exports<'graphql/type/schema'>;
}
declare module 'graphql/utilities/assertValidName.js' {
  declare module.exports: $Exports<'graphql/utilities/assertValidName'>;
}
declare module 'graphql/utilities/astFromValue.js' {
  declare module.exports: $Exports<'graphql/utilities/astFromValue'>;
}
declare module 'graphql/utilities/buildASTSchema.js' {
  declare module.exports: $Exports<'graphql/utilities/buildASTSchema'>;
}
declare module 'graphql/utilities/buildClientSchema.js' {
  declare module.exports: $Exports<'graphql/utilities/buildClientSchema'>;
}
declare module 'graphql/utilities/concatAST.js' {
  declare module.exports: $Exports<'graphql/utilities/concatAST'>;
}
declare module 'graphql/utilities/extendSchema.js' {
  declare module.exports: $Exports<'graphql/utilities/extendSchema'>;
}
declare module 'graphql/utilities/findBreakingChanges.js' {
  declare module.exports: $Exports<'graphql/utilities/findBreakingChanges'>;
}
declare module 'graphql/utilities/findDeprecatedUsages.js' {
  declare module.exports: $Exports<'graphql/utilities/findDeprecatedUsages'>;
}
declare module 'graphql/utilities/getOperationAST.js' {
  declare module.exports: $Exports<'graphql/utilities/getOperationAST'>;
}
declare module 'graphql/utilities/index.js' {
  declare module.exports: $Exports<'graphql/utilities/index'>;
}
declare module 'graphql/utilities/introspectionQuery.js' {
  declare module.exports: $Exports<'graphql/utilities/introspectionQuery'>;
}
declare module 'graphql/utilities/isValidJSValue.js' {
  declare module.exports: $Exports<'graphql/utilities/isValidJSValue'>;
}
declare module 'graphql/utilities/isValidLiteralValue.js' {
  declare module.exports: $Exports<'graphql/utilities/isValidLiteralValue'>;
}
declare module 'graphql/utilities/schemaPrinter.js' {
  declare module.exports: $Exports<'graphql/utilities/schemaPrinter'>;
}
declare module 'graphql/utilities/separateOperations.js' {
  declare module.exports: $Exports<'graphql/utilities/separateOperations'>;
}
declare module 'graphql/utilities/typeComparators.js' {
  declare module.exports: $Exports<'graphql/utilities/typeComparators'>;
}
declare module 'graphql/utilities/typeFromAST.js' {
  declare module.exports: $Exports<'graphql/utilities/typeFromAST'>;
}
declare module 'graphql/utilities/TypeInfo.js' {
  declare module.exports: $Exports<'graphql/utilities/TypeInfo'>;
}
declare module 'graphql/utilities/valueFromAST.js' {
  declare module.exports: $Exports<'graphql/utilities/valueFromAST'>;
}
declare module 'graphql/validation/index.js' {
  declare module.exports: $Exports<'graphql/validation/index'>;
}
declare module 'graphql/validation/rules/ArgumentsOfCorrectType.js' {
  declare module.exports: $Exports<'graphql/validation/rules/ArgumentsOfCorrectType'>;
}
declare module 'graphql/validation/rules/DefaultValuesOfCorrectType.js' {
  declare module.exports: $Exports<'graphql/validation/rules/DefaultValuesOfCorrectType'>;
}
declare module 'graphql/validation/rules/FieldsOnCorrectType.js' {
  declare module.exports: $Exports<'graphql/validation/rules/FieldsOnCorrectType'>;
}
declare module 'graphql/validation/rules/FragmentsOnCompositeTypes.js' {
  declare module.exports: $Exports<'graphql/validation/rules/FragmentsOnCompositeTypes'>;
}
declare module 'graphql/validation/rules/KnownArgumentNames.js' {
  declare module.exports: $Exports<'graphql/validation/rules/KnownArgumentNames'>;
}
declare module 'graphql/validation/rules/KnownDirectives.js' {
  declare module.exports: $Exports<'graphql/validation/rules/KnownDirectives'>;
}
declare module 'graphql/validation/rules/KnownFragmentNames.js' {
  declare module.exports: $Exports<'graphql/validation/rules/KnownFragmentNames'>;
}
declare module 'graphql/validation/rules/KnownTypeNames.js' {
  declare module.exports: $Exports<'graphql/validation/rules/KnownTypeNames'>;
}
declare module 'graphql/validation/rules/LoneAnonymousOperation.js' {
  declare module.exports: $Exports<'graphql/validation/rules/LoneAnonymousOperation'>;
}
declare module 'graphql/validation/rules/NoFragmentCycles.js' {
  declare module.exports: $Exports<'graphql/validation/rules/NoFragmentCycles'>;
}
declare module 'graphql/validation/rules/NoUndefinedVariables.js' {
  declare module.exports: $Exports<'graphql/validation/rules/NoUndefinedVariables'>;
}
declare module 'graphql/validation/rules/NoUnusedFragments.js' {
  declare module.exports: $Exports<'graphql/validation/rules/NoUnusedFragments'>;
}
declare module 'graphql/validation/rules/NoUnusedVariables.js' {
  declare module.exports: $Exports<'graphql/validation/rules/NoUnusedVariables'>;
}
declare module 'graphql/validation/rules/OverlappingFieldsCanBeMerged.js' {
  declare module.exports: $Exports<'graphql/validation/rules/OverlappingFieldsCanBeMerged'>;
}
declare module 'graphql/validation/rules/PossibleFragmentSpreads.js' {
  declare module.exports: $Exports<'graphql/validation/rules/PossibleFragmentSpreads'>;
}
declare module 'graphql/validation/rules/ProvidedNonNullArguments.js' {
  declare module.exports: $Exports<'graphql/validation/rules/ProvidedNonNullArguments'>;
}
declare module 'graphql/validation/rules/ScalarLeafs.js' {
  declare module.exports: $Exports<'graphql/validation/rules/ScalarLeafs'>;
}
declare module 'graphql/validation/rules/SingleFieldSubscriptions.js' {
  declare module.exports: $Exports<'graphql/validation/rules/SingleFieldSubscriptions'>;
}
declare module 'graphql/validation/rules/UniqueArgumentNames.js' {
  declare module.exports: $Exports<'graphql/validation/rules/UniqueArgumentNames'>;
}
declare module 'graphql/validation/rules/UniqueDirectivesPerLocation.js' {
  declare module.exports: $Exports<'graphql/validation/rules/UniqueDirectivesPerLocation'>;
}
declare module 'graphql/validation/rules/UniqueFragmentNames.js' {
  declare module.exports: $Exports<'graphql/validation/rules/UniqueFragmentNames'>;
}
declare module 'graphql/validation/rules/UniqueInputFieldNames.js' {
  declare module.exports: $Exports<'graphql/validation/rules/UniqueInputFieldNames'>;
}
declare module 'graphql/validation/rules/UniqueOperationNames.js' {
  declare module.exports: $Exports<'graphql/validation/rules/UniqueOperationNames'>;
}
declare module 'graphql/validation/rules/UniqueVariableNames.js' {
  declare module.exports: $Exports<'graphql/validation/rules/UniqueVariableNames'>;
}
declare module 'graphql/validation/rules/VariablesAreInputTypes.js' {
  declare module.exports: $Exports<'graphql/validation/rules/VariablesAreInputTypes'>;
}
declare module 'graphql/validation/rules/VariablesInAllowedPosition.js' {
  declare module.exports: $Exports<'graphql/validation/rules/VariablesInAllowedPosition'>;
}
declare module 'graphql/validation/specifiedRules.js' {
  declare module.exports: $Exports<'graphql/validation/specifiedRules'>;
}
declare module 'graphql/validation/validate.js' {
  declare module.exports: $Exports<'graphql/validation/validate'>;
}
// flow-typed signature: 41a21b97ad4a7c01c4caf3a8b9382354
// flow-typed version: b43dff3e0e/invariant_v2.x.x/flow_>=v0.33.x

declare module invariant {
  declare var exports: (condition: boolean, message: string) => void;
}
// flow-typed signature: 107cf7068b8835594e97f938e8848244
// flow-typed version: 8b4dd96654/jest_v21.x.x/flow_>=v0.39.x

type JestMockFn<TArguments: $ReadOnlyArray<*>, TReturn> = {
  (...args: TArguments): TReturn,
  /**
   * An object for introspecting mock calls
   */
  mock: {
    /**
     * An array that represents all calls that have been made into this mock
     * function. Each call is represented by an array of arguments that were
     * passed during the call.
     */
    calls: Array<TArguments>,
    /**
     * An array that contains all the object instances that have been
     * instantiated from this mock function.
     */
    instances: Array<TReturn>
  },
  /**
   * Resets all information stored in the mockFn.mock.calls and
   * mockFn.mock.instances arrays. Often this is useful when you want to clean
   * up a mock's usage data between two assertions.
   */
  mockClear(): void,
  /**
   * Resets all information stored in the mock. This is useful when you want to
   * completely restore a mock back to its initial state.
   */
  mockReset(): void,
  /**
   * Removes the mock and restores the initial implementation. This is useful
   * when you want to mock functions in certain test cases and restore the
   * original implementation in others. Beware that mockFn.mockRestore only
   * works when mock was created with jest.spyOn. Thus you have to take care of
   * restoration yourself when manually assigning jest.fn().
   */
  mockRestore(): void,
  /**
   * Accepts a function that should be used as the implementation of the mock.
   * The mock itself will still record all calls that go into and instances
   * that come from itself -- the only difference is that the implementation
   * will also be executed when the mock is called.
   */
  mockImplementation(
    fn: (...args: TArguments) => TReturn
  ): JestMockFn<TArguments, TReturn>,
  /**
   * Accepts a function that will be used as an implementation of the mock for
   * one call to the mocked function. Can be chained so that multiple function
   * calls produce different results.
   */
  mockImplementationOnce(
    fn: (...args: TArguments) => TReturn
  ): JestMockFn<TArguments, TReturn>,
  /**
   * Just a simple sugar function for returning `this`
   */
  mockReturnThis(): void,
  /**
   * Deprecated: use jest.fn(() => value) instead
   */
  mockReturnValue(value: TReturn): JestMockFn<TArguments, TReturn>,
  /**
   * Sugar for only returning a value once inside your mock
   */
  mockReturnValueOnce(value: TReturn): JestMockFn<TArguments, TReturn>
};

type JestAsymmetricEqualityType = {
  /**
   * A custom Jasmine equality tester
   */
  asymmetricMatch(value: mixed): boolean
};

type JestCallsType = {
  allArgs(): mixed,
  all(): mixed,
  any(): boolean,
  count(): number,
  first(): mixed,
  mostRecent(): mixed,
  reset(): void
};

type JestClockType = {
  install(): void,
  mockDate(date: Date): void,
  tick(milliseconds?: number): void,
  uninstall(): void
};

type JestMatcherResult = {
  message?: string | (() => string),
  pass: boolean
};

type JestMatcher = (actual: any, expected: any) => JestMatcherResult;

type JestPromiseType = {
  /**
   * Use rejects to unwrap the reason of a rejected promise so any other
   * matcher can be chained. If the promise is fulfilled the assertion fails.
   */
  rejects: JestExpectType,
  /**
   * Use resolves to unwrap the value of a fulfilled promise so any other
   * matcher can be chained. If the promise is rejected the assertion fails.
   */
  resolves: JestExpectType
};

/**
 *  Plugin: jest-enzyme
 */
type EnzymeMatchersType = {
  toBeChecked(): void,
  toBeDisabled(): void,
  toBeEmpty(): void,
  toBePresent(): void,
  toContainReact(element: React$Element<any>): void,
  toHaveClassName(className: string): void,
  toHaveHTML(html: string): void,
  toHaveProp(propKey: string, propValue?: any): void,
  toHaveRef(refName: string): void,
  toHaveState(stateKey: string, stateValue?: any): void,
  toHaveStyle(styleKey: string, styleValue?: any): void,
  toHaveTagName(tagName: string): void,
  toHaveText(text: string): void,
  toIncludeText(text: string): void,
  toHaveValue(value: any): void,
  toMatchElement(element: React$Element<any>): void,
  toMatchSelector(selector: string): void
};

type JestExpectType = {
  not: JestExpectType & EnzymeMatchersType,
  /**
   * If you have a mock function, you can use .lastCalledWith to test what
   * arguments it was last called with.
   */
  lastCalledWith(...args: Array<any>): void,
  /**
   * toBe just checks that a value is what you expect. It uses === to check
   * strict equality.
   */
  toBe(value: any): void,
  /**
   * Use .toHaveBeenCalled to ensure that a mock function got called.
   */
  toBeCalled(): void,
  /**
   * Use .toBeCalledWith to ensure that a mock function was called with
   * specific arguments.
   */
  toBeCalledWith(...args: Array<any>): void,
  /**
   * Using exact equality with floating point numbers is a bad idea. Rounding
   * means that intuitive things fail.
   */
  toBeCloseTo(num: number, delta: any): void,
  /**
   * Use .toBeDefined to check that a variable is not undefined.
   */
  toBeDefined(): void,
  /**
   * Use .toBeFalsy when you don't care what a value is, you just want to
   * ensure a value is false in a boolean context.
   */
  toBeFalsy(): void,
  /**
   * To compare floating point numbers, you can use toBeGreaterThan.
   */
  toBeGreaterThan(number: number): void,
  /**
   * To compare floating point numbers, you can use toBeGreaterThanOrEqual.
   */
  toBeGreaterThanOrEqual(number: number): void,
  /**
   * To compare floating point numbers, you can use toBeLessThan.
   */
  toBeLessThan(number: number): void,
  /**
   * To compare floating point numbers, you can use toBeLessThanOrEqual.
   */
  toBeLessThanOrEqual(number: number): void,
  /**
   * Use .toBeInstanceOf(Class) to check that an object is an instance of a
   * class.
   */
  toBeInstanceOf(cls: Class<*>): void,
  /**
   * .toBeNull() is the same as .toBe(null) but the error messages are a bit
   * nicer.
   */
  toBeNull(): void,
  /**
   * Use .toBeTruthy when you don't care what a value is, you just want to
   * ensure a value is true in a boolean context.
   */
  toBeTruthy(): void,
  /**
   * Use .toBeUndefined to check that a variable is undefined.
   */
  toBeUndefined(): void,
  /**
   * Use .toContain when you want to check that an item is in a list. For
   * testing the items in the list, this uses ===, a strict equality check.
   */
  toContain(item: any): void,
  /**
   * Use .toContainEqual when you want to check that an item is in a list. For
   * testing the items in the list, this matcher recursively checks the
   * equality of all fields, rather than checking for object identity.
   */
  toContainEqual(item: any): void,
  /**
   * Use .toEqual when you want to check that two objects have the same value.
   * This matcher recursively checks the equality of all fields, rather than
   * checking for object identity.
   */
  toEqual(value: any): void,
  /**
   * Use .toHaveBeenCalled to ensure that a mock function got called.
   */
  toHaveBeenCalled(): void,
  /**
   * Use .toHaveBeenCalledTimes to ensure that a mock function got called exact
   * number of times.
   */
  toHaveBeenCalledTimes(number: number): void,
  /**
   * Use .toHaveBeenCalledWith to ensure that a mock function was called with
   * specific arguments.
   */
  toHaveBeenCalledWith(...args: Array<any>): void,
  /**
   * Use .toHaveBeenLastCalledWith to ensure that a mock function was last called
   * with specific arguments.
   */
  toHaveBeenLastCalledWith(...args: Array<any>): void,
  /**
   * Check that an object has a .length property and it is set to a certain
   * numeric value.
   */
  toHaveLength(number: number): void,
  /**
   *
   */
  toHaveProperty(propPath: string, value?: any): void,
  /**
   * Use .toMatch to check that a string matches a regular expression or string.
   */
  toMatch(regexpOrString: RegExp | string): void,
  /**
   * Use .toMatchObject to check that a javascript object matches a subset of the properties of an object.
   */
  toMatchObject(object: Object | Array<Object>): void,
  /**
   * This ensures that a React component matches the most recent snapshot.
   */
  toMatchSnapshot(name?: string): void,
  /**
   * Use .toThrow to test that a function throws when it is called.
   * If you want to test that a specific error gets thrown, you can provide an
   * argument to toThrow. The argument can be a string for the error message,
   * a class for the error, or a regex that should match the error.
   *
   * Alias: .toThrowError
   */
  toThrow(message?: string | Error | Class<Error> | RegExp): void,
  toThrowError(message?: string | Error | Class<Error> | RegExp): void,
  /**
   * Use .toThrowErrorMatchingSnapshot to test that a function throws a error
   * matching the most recent snapshot when it is called.
   */
  toThrowErrorMatchingSnapshot(): void
};

type JestObjectType = {
  /**
   *  Disables automatic mocking in the module loader.
   *
   *  After this method is called, all `require()`s will return the real
   *  versions of each module (rather than a mocked version).
   */
  disableAutomock(): JestObjectType,
  /**
   * An un-hoisted version of disableAutomock
   */
  autoMockOff(): JestObjectType,
  /**
   * Enables automatic mocking in the module loader.
   */
  enableAutomock(): JestObjectType,
  /**
   * An un-hoisted version of enableAutomock
   */
  autoMockOn(): JestObjectType,
  /**
   * Clears the mock.calls and mock.instances properties of all mocks.
   * Equivalent to calling .mockClear() on every mocked function.
   */
  clearAllMocks(): JestObjectType,
  /**
   * Resets the state of all mocks. Equivalent to calling .mockReset() on every
   * mocked function.
   */
  resetAllMocks(): JestObjectType,
  /**
   * Removes any pending timers from the timer system.
   */
  clearAllTimers(): void,
  /**
   * The same as `mock` but not moved to the top of the expectation by
   * babel-jest.
   */
  doMock(moduleName: string, moduleFactory?: any): JestObjectType,
  /**
   * The same as `unmock` but not moved to the top of the expectation by
   * babel-jest.
   */
  dontMock(moduleName: string): JestObjectType,
  /**
   * Returns a new, unused mock function. Optionally takes a mock
   * implementation.
   */
  fn<TArguments: $ReadOnlyArray<*>, TReturn>(
    implementation?: (...args: TArguments) => TReturn
  ): JestMockFn<TArguments, TReturn>,
  /**
   * Determines if the given function is a mocked function.
   */
  isMockFunction(fn: Function): boolean,
  /**
   * Given the name of a module, use the automatic mocking system to generate a
   * mocked version of the module for you.
   */
  genMockFromModule(moduleName: string): any,
  /**
   * Mocks a module with an auto-mocked version when it is being required.
   *
   * The second argument can be used to specify an explicit module factory that
   * is being run instead of using Jest's automocking feature.
   *
   * The third argument can be used to create virtual mocks -- mocks of modules
   * that don't exist anywhere in the system.
   */
  mock(
    moduleName: string,
    moduleFactory?: any,
    options?: Object
  ): JestObjectType,
  /**
   * Returns the actual module instead of a mock, bypassing all checks on
   * whether the module should receive a mock implementation or not.
   */
  requireActual(moduleName: string): any,
  /**
   * Returns a mock module instead of the actual module, bypassing all checks
   * on whether the module should be required normally or not.
   */
  requireMock(moduleName: string): any,
  /**
   * Resets the module registry - the cache of all required modules. This is
   * useful to isolate modules where local state might conflict between tests.
   */
  resetModules(): JestObjectType,
  /**
   * Exhausts the micro-task queue (usually interfaced in node via
   * process.nextTick).
   */
  runAllTicks(): void,
  /**
   * Exhausts the macro-task queue (i.e., all tasks queued by setTimeout(),
   * setInterval(), and setImmediate()).
   */
  runAllTimers(): void,
  /**
   * Exhausts all tasks queued by setImmediate().
   */
  runAllImmediates(): void,
  /**
   * Executes only the macro task queue (i.e. all tasks queued by setTimeout()
   * or setInterval() and setImmediate()).
   */
  runTimersToTime(msToRun: number): void,
  /**
   * Executes only the macro-tasks that are currently pending (i.e., only the
   * tasks that have been queued by setTimeout() or setInterval() up to this
   * point)
   */
  runOnlyPendingTimers(): void,
  /**
   * Explicitly supplies the mock object that the module system should return
   * for the specified module. Note: It is recommended to use jest.mock()
   * instead.
   */
  setMock(moduleName: string, moduleExports: any): JestObjectType,
  /**
   * Indicates that the module system should never return a mocked version of
   * the specified module from require() (e.g. that it should always return the
   * real module).
   */
  unmock(moduleName: string): JestObjectType,
  /**
   * Instructs Jest to use fake versions of the standard timer functions
   * (setTimeout, setInterval, clearTimeout, clearInterval, nextTick,
   * setImmediate and clearImmediate).
   */
  useFakeTimers(): JestObjectType,
  /**
   * Instructs Jest to use the real versions of the standard timer functions.
   */
  useRealTimers(): JestObjectType,
  /**
   * Creates a mock function similar to jest.fn but also tracks calls to
   * object[methodName].
   */
  spyOn(object: Object, methodName: string): JestMockFn<any, any>,
  /**
   * Set the default timeout interval for tests and before/after hooks in milliseconds.
   * Note: The default timeout interval is 5 seconds if this method is not called.
   */
  setTimeout(timeout: number): JestObjectType
};

type JestSpyType = {
  calls: JestCallsType
};

/** Runs this function after every test inside this context */
declare function afterEach(
  fn: (done: () => void) => ?Promise<mixed>,
  timeout?: number
): void;
/** Runs this function before every test inside this context */
declare function beforeEach(
  fn: (done: () => void) => ?Promise<mixed>,
  timeout?: number
): void;
/** Runs this function after all tests have finished inside this context */
declare function afterAll(
  fn: (done: () => void) => ?Promise<mixed>,
  timeout?: number
): void;
/** Runs this function before any tests have started inside this context */
declare function beforeAll(
  fn: (done: () => void) => ?Promise<mixed>,
  timeout?: number
): void;

/** A context for grouping tests together */
declare var describe: {
  /**
   * Creates a block that groups together several related tests in one "test suite"
   */
  (name: string, fn: () => void): void,

  /**
   * Only run this describe block
   */
  only(name: string, fn: () => void): void,

  /**
   * Skip running this describe block
   */
  skip(name: string, fn: () => void): void
};

/** An individual test unit */
declare var it: {
  /**
   * An individual test unit
   *
   * @param {string} Name of Test
   * @param {Function} Test
   * @param {number} Timeout for the test, in milliseconds.
   */
  (
    name: string,
    fn?: (done: () => void) => ?Promise<mixed>,
    timeout?: number
  ): void,
  /**
   * Only run this test
   *
   * @param {string} Name of Test
   * @param {Function} Test
   * @param {number} Timeout for the test, in milliseconds.
   */
  only(
    name: string,
    fn?: (done: () => void) => ?Promise<mixed>,
    timeout?: number
  ): void,
  /**
   * Skip running this test
   *
   * @param {string} Name of Test
   * @param {Function} Test
   * @param {number} Timeout for the test, in milliseconds.
   */
  skip(
    name: string,
    fn?: (done: () => void) => ?Promise<mixed>,
    timeout?: number
  ): void,
  /**
   * Run the test concurrently
   *
   * @param {string} Name of Test
   * @param {Function} Test
   * @param {number} Timeout for the test, in milliseconds.
   */
  concurrent(
    name: string,
    fn?: (done: () => void) => ?Promise<mixed>,
    timeout?: number
  ): void
};
declare function fit(
  name: string,
  fn: (done: () => void) => ?Promise<mixed>,
  timeout?: number
): void;
/** An individual test unit */
declare var test: typeof it;
/** A disabled group of tests */
declare var xdescribe: typeof describe;
/** A focused group of tests */
declare var fdescribe: typeof describe;
/** A disabled individual test */
declare var xit: typeof it;
/** A disabled individual test */
declare var xtest: typeof it;

/** The expect function is used every time you want to test a value */
declare var expect: {
  /** The object that you want to make assertions against */
  (value: any): JestExpectType & JestPromiseType & EnzymeMatchersType,
  /** Add additional Jasmine matchers to Jest's roster */
  extend(matchers: { [name: string]: JestMatcher }): void,
  /** Add a module that formats application-specific data structures. */
  addSnapshotSerializer(serializer: (input: Object) => string): void,
  assertions(expectedAssertions: number): void,
  hasAssertions(): void,
  any(value: mixed): JestAsymmetricEqualityType,
  anything(): void,
  arrayContaining(value: Array<mixed>): void,
  objectContaining(value: Object): void,
  /** Matches any received string that contains the exact expected string. */
  stringContaining(value: string): void,
  stringMatching(value: string | RegExp): void
};

// TODO handle return type
// http://jasmine.github.io/2.4/introduction.html#section-Spies
declare function spyOn(value: mixed, method: string): Object;

/** Holds all functions related to manipulating test runner */
declare var jest: JestObjectType;

/**
 * The global Jasmine object, this is generally not exposed as the public API,
 * using features inside here could break in later versions of Jest.
 */
declare var jasmine: {
  DEFAULT_TIMEOUT_INTERVAL: number,
  any(value: mixed): JestAsymmetricEqualityType,
  anything(): void,
  arrayContaining(value: Array<mixed>): void,
  clock(): JestClockType,
  createSpy(name: string): JestSpyType,
  createSpyObj(
    baseName: string,
    methodNames: Array<string>
  ): { [methodName: string]: JestSpyType },
  objectContaining(value: Object): void,
  stringMatching(value: string): void
};
// flow-typed signature: 2e82c8be2483588f05be3476cd2af900
// flow-typed version: <<STUB>>/JSONStream_v^1.3.1/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'JSONStream'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'JSONStream' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'JSONStream/examples/all_docs' {
  declare module.exports: any;
}

declare module 'JSONStream/test/bool' {
  declare module.exports: any;
}

declare module 'JSONStream/test/browser' {
  declare module.exports: any;
}

declare module 'JSONStream/test/destroy_missing' {
  declare module.exports: any;
}

declare module 'JSONStream/test/disabled/doubledot1' {
  declare module.exports: any;
}

declare module 'JSONStream/test/disabled/doubledot2' {
  declare module.exports: any;
}

declare module 'JSONStream/test/empty' {
  declare module.exports: any;
}

declare module 'JSONStream/test/error_contents' {
  declare module.exports: any;
}

declare module 'JSONStream/test/fn' {
  declare module.exports: any;
}

declare module 'JSONStream/test/gen' {
  declare module.exports: any;
}

declare module 'JSONStream/test/header_footer' {
  declare module.exports: any;
}

declare module 'JSONStream/test/issues' {
  declare module.exports: any;
}

declare module 'JSONStream/test/keys' {
  declare module.exports: any;
}

declare module 'JSONStream/test/map' {
  declare module.exports: any;
}

declare module 'JSONStream/test/multiple_objects_error' {
  declare module.exports: any;
}

declare module 'JSONStream/test/multiple_objects' {
  declare module.exports: any;
}

declare module 'JSONStream/test/null' {
  declare module.exports: any;
}

declare module 'JSONStream/test/parsejson' {
  declare module.exports: any;
}

declare module 'JSONStream/test/stringify_object' {
  declare module.exports: any;
}

declare module 'JSONStream/test/stringify' {
  declare module.exports: any;
}

declare module 'JSONStream/test/test' {
  declare module.exports: any;
}

declare module 'JSONStream/test/test2' {
  declare module.exports: any;
}

declare module 'JSONStream/test/two-ways' {
  declare module.exports: any;
}

// Filename aliases
declare module 'JSONStream/examples/all_docs.js' {
  declare module.exports: $Exports<'JSONStream/examples/all_docs'>;
}
declare module 'JSONStream/index' {
  declare module.exports: $Exports<'JSONStream'>;
}
declare module 'JSONStream/index.js' {
  declare module.exports: $Exports<'JSONStream'>;
}
declare module 'JSONStream/test/bool.js' {
  declare module.exports: $Exports<'JSONStream/test/bool'>;
}
declare module 'JSONStream/test/browser.js' {
  declare module.exports: $Exports<'JSONStream/test/browser'>;
}
declare module 'JSONStream/test/destroy_missing.js' {
  declare module.exports: $Exports<'JSONStream/test/destroy_missing'>;
}
declare module 'JSONStream/test/disabled/doubledot1.js' {
  declare module.exports: $Exports<'JSONStream/test/disabled/doubledot1'>;
}
declare module 'JSONStream/test/disabled/doubledot2.js' {
  declare module.exports: $Exports<'JSONStream/test/disabled/doubledot2'>;
}
declare module 'JSONStream/test/empty.js' {
  declare module.exports: $Exports<'JSONStream/test/empty'>;
}
declare module 'JSONStream/test/error_contents.js' {
  declare module.exports: $Exports<'JSONStream/test/error_contents'>;
}
declare module 'JSONStream/test/fn.js' {
  declare module.exports: $Exports<'JSONStream/test/fn'>;
}
declare module 'JSONStream/test/gen.js' {
  declare module.exports: $Exports<'JSONStream/test/gen'>;
}
declare module 'JSONStream/test/header_footer.js' {
  declare module.exports: $Exports<'JSONStream/test/header_footer'>;
}
declare module 'JSONStream/test/issues.js' {
  declare module.exports: $Exports<'JSONStream/test/issues'>;
}
declare module 'JSONStream/test/keys.js' {
  declare module.exports: $Exports<'JSONStream/test/keys'>;
}
declare module 'JSONStream/test/map.js' {
  declare module.exports: $Exports<'JSONStream/test/map'>;
}
declare module 'JSONStream/test/multiple_objects_error.js' {
  declare module.exports: $Exports<'JSONStream/test/multiple_objects_error'>;
}
declare module 'JSONStream/test/multiple_objects.js' {
  declare module.exports: $Exports<'JSONStream/test/multiple_objects'>;
}
declare module 'JSONStream/test/null.js' {
  declare module.exports: $Exports<'JSONStream/test/null'>;
}
declare module 'JSONStream/test/parsejson.js' {
  declare module.exports: $Exports<'JSONStream/test/parsejson'>;
}
declare module 'JSONStream/test/stringify_object.js' {
  declare module.exports: $Exports<'JSONStream/test/stringify_object'>;
}
declare module 'JSONStream/test/stringify.js' {
  declare module.exports: $Exports<'JSONStream/test/stringify'>;
}
declare module 'JSONStream/test/test.js' {
  declare module.exports: $Exports<'JSONStream/test/test'>;
}
declare module 'JSONStream/test/test2.js' {
  declare module.exports: $Exports<'JSONStream/test/test2'>;
}
declare module 'JSONStream/test/two-ways.js' {
  declare module.exports: $Exports<'JSONStream/test/two-ways'>;
}
// flow-typed signature: fcbc2c8209ca21df4e50468c1f1cf2cf
// flow-typed version: 9dc62314fe/lodash_v4.x.x/flow_>=v0.55.x

declare module "lodash" {
  declare type __CurriedFunction1<A, R, AA: A> = (...r: [AA]) => R;
  declare type CurriedFunction1<A, R> = __CurriedFunction1<A, R, *>;

  declare type __CurriedFunction2<A, B, R, AA: A, BB: B> = ((
    ...r: [AA]
  ) => CurriedFunction1<BB, R>) &
    ((...r: [AA, BB]) => R);
  declare type CurriedFunction2<A, B, R> = __CurriedFunction2<A, B, R, *, *>;

  declare type __CurriedFunction3<A, B, C, R, AA: A, BB: B, CC: C> = ((
    ...r: [AA]
  ) => CurriedFunction2<BB, CC, R>) &
    ((...r: [AA, BB]) => CurriedFunction1<CC, R>) &
    ((...r: [AA, BB, CC]) => R);
  declare type CurriedFunction3<A, B, C, R> = __CurriedFunction3<
    A,
    B,
    C,
    R,
    *,
    *,
    *
  >;

  declare type __CurriedFunction4<
    A,
    B,
    C,
    D,
    R,
    AA: A,
    BB: B,
    CC: C,
    DD: D
  > = ((...r: [AA]) => CurriedFunction3<BB, CC, DD, R>) &
    ((...r: [AA, BB]) => CurriedFunction2<CC, DD, R>) &
    ((...r: [AA, BB, CC]) => CurriedFunction1<DD, R>) &
    ((...r: [AA, BB, CC, DD]) => R);
  declare type CurriedFunction4<A, B, C, D, R> = __CurriedFunction4<
    A,
    B,
    C,
    D,
    R,
    *,
    *,
    *,
    *
  >;

  declare type __CurriedFunction5<
    A,
    B,
    C,
    D,
    E,
    R,
    AA: A,
    BB: B,
    CC: C,
    DD: D,
    EE: E
  > = ((...r: [AA]) => CurriedFunction4<BB, CC, DD, EE, R>) &
    ((...r: [AA, BB]) => CurriedFunction3<CC, DD, EE, R>) &
    ((...r: [AA, BB, CC]) => CurriedFunction2<DD, EE, R>) &
    ((...r: [AA, BB, CC, DD]) => CurriedFunction1<EE, R>) &
    ((...r: [AA, BB, CC, DD, EE]) => R);
  declare type CurriedFunction5<A, B, C, D, E, R> = __CurriedFunction5<
    A,
    B,
    C,
    D,
    E,
    R,
    *,
    *,
    *,
    *,
    *
  >;

  declare type __CurriedFunction6<
    A,
    B,
    C,
    D,
    E,
    F,
    R,
    AA: A,
    BB: B,
    CC: C,
    DD: D,
    EE: E,
    FF: F
  > = ((...r: [AA]) => CurriedFunction5<BB, CC, DD, EE, FF, R>) &
    ((...r: [AA, BB]) => CurriedFunction4<CC, DD, EE, FF, R>) &
    ((...r: [AA, BB, CC]) => CurriedFunction3<DD, EE, FF, R>) &
    ((...r: [AA, BB, CC, DD]) => CurriedFunction2<EE, FF, R>) &
    ((...r: [AA, BB, CC, DD, EE]) => CurriedFunction1<FF, R>) &
    ((...r: [AA, BB, CC, DD, EE, FF]) => R);
  declare type CurriedFunction6<A, B, C, D, E, F, R> = __CurriedFunction6<
    A,
    B,
    C,
    D,
    E,
    F,
    R,
    *,
    *,
    *,
    *,
    *,
    *
  >;

  declare type Curry = (<A, R>((...r: [A]) => R) => CurriedFunction1<A, R>) &
    (<A, B, R>((...r: [A, B]) => R) => CurriedFunction2<A, B, R>) &
    (<A, B, C, R>((...r: [A, B, C]) => R) => CurriedFunction3<A, B, C, R>) &
    (<A, B, C, D, R>(
      (...r: [A, B, C, D]) => R
    ) => CurriedFunction4<A, B, C, D, R>) &
    (<A, B, C, D, E, R>(
      (...r: [A, B, C, D, E]) => R
    ) => CurriedFunction5<A, B, C, D, E, R>) &
    (<A, B, C, D, E, F, R>(
      (...r: [A, B, C, D, E, F]) => R
    ) => CurriedFunction6<A, B, C, D, E, F, R>);

  declare type UnaryFn<A, R> = (a: A) => R;

  declare type TemplateSettings = {
    escape?: RegExp,
    evaluate?: RegExp,
    imports?: Object,
    interpolate?: RegExp,
    variable?: string
  };

  declare type TruncateOptions = {
    length?: number,
    omission?: string,
    separator?: RegExp | string
  };

  declare type DebounceOptions = {
    leading?: boolean,
    maxWait?: number,
    trailing?: boolean
  };

  declare type ThrottleOptions = {
    leading?: boolean,
    trailing?: boolean
  };

  declare type NestedArray<T> = Array<Array<T>>;

  declare type matchesIterateeShorthand = Object;
  declare type matchesPropertyIterateeShorthand = [string, any];
  declare type propertyIterateeShorthand = string;

  declare type OPredicate<A, O> =
    | ((value: A, key: string, object: O) => any)
    | matchesIterateeShorthand
    | matchesPropertyIterateeShorthand
    | propertyIterateeShorthand;

  declare type OIterateeWithResult<V, O, R> =
    | Object
    | string
    | ((value: V, key: string, object: O) => R);
  declare type OIteratee<O> = OIterateeWithResult<any, O, any>;
  declare type OFlatMapIteratee<T, U> = OIterateeWithResult<any, T, Array<U>>;

  declare type Predicate<T> =
    | ((value: T, index: number, array: Array<T>) => any)
    | matchesIterateeShorthand
    | matchesPropertyIterateeShorthand
    | propertyIterateeShorthand;

  declare type _ValueOnlyIteratee<T> = (value: T) => mixed;
  declare type ValueOnlyIteratee<T> = _ValueOnlyIteratee<T> | string;
  declare type _Iteratee<T> = (
    item: T,
    index: number,
    array: ?Array<T>
  ) => mixed;
  declare type Iteratee<T> = _Iteratee<T> | Object | string;
  declare type FlatMapIteratee<T, U> =
    | ((item: T, index: number, array: ?Array<T>) => Array<U>)
    | Object
    | string;
  declare type Comparator<T> = (item: T, item2: T) => boolean;

  declare type MapIterator<T, U> =
    | ((item: T, index: number, array: Array<T>) => U)
    | propertyIterateeShorthand;

  declare type OMapIterator<T, O, U> =
    | ((item: T, key: string, object: O) => U)
    | propertyIterateeShorthand;

  declare class Lodash {
    // Array
    chunk<T>(array: ?Array<T>, size?: number): Array<Array<T>>;
    compact<T, N: ?T>(array: Array<N>): Array<T>;
    concat<T>(base: Array<T>, ...elements: Array<any>): Array<T | any>;
    difference<T>(array: ?Array<T>, values?: Array<T>): Array<T>;
    differenceBy<T>(
      array: ?Array<T>,
      values: Array<T>,
      iteratee: ValueOnlyIteratee<T>
    ): T[];
    differenceWith<T>(array: T[], values: T[], comparator?: Comparator<T>): T[];
    drop<T>(array: ?Array<T>, n?: number): Array<T>;
    dropRight<T>(array: ?Array<T>, n?: number): Array<T>;
    dropRightWhile<T>(array: ?Array<T>, predicate?: Predicate<T>): Array<T>;
    dropWhile<T>(array: ?Array<T>, predicate?: Predicate<T>): Array<T>;
    fill<T, U>(
      array: ?Array<T>,
      value: U,
      start?: number,
      end?: number
    ): Array<T | U>;
    findIndex<T>(
      array: ?$ReadOnlyArray<T>,
      predicate?: Predicate<T>,
      fromIndex?: number
    ): number;
    findLastIndex<T>(
      array: ?$ReadOnlyArray<T>,
      predicate?: Predicate<T>,
      fromIndex?: number
    ): number;
    // alias of _.head
    first<T>(array: ?Array<T>): T;
    flatten<T, X>(array: Array<Array<T> | X>): Array<T | X>;
    flattenDeep<T>(array: any[]): Array<T>;
    flattenDepth(array: any[], depth?: number): any[];
    fromPairs<A, B>(pairs: Array<[A, B]>): { [key: A]: B };
    head<T>(array: ?Array<T>): T;
    indexOf<T>(array: ?Array<T>, value: T, fromIndex?: number): number;
    initial<T>(array: ?Array<T>): Array<T>;
    intersection<T>(...arrays: Array<Array<T>>): Array<T>;
    //Workaround until (...parameter: T, parameter2: U) works
    intersectionBy<T>(a1: Array<T>, iteratee?: ValueOnlyIteratee<T>): Array<T>;
    intersectionBy<T>(
      a1: Array<T>,
      a2: Array<T>,
      iteratee?: ValueOnlyIteratee<T>
    ): Array<T>;
    intersectionBy<T>(
      a1: Array<T>,
      a2: Array<T>,
      a3: Array<T>,
      iteratee?: ValueOnlyIteratee<T>
    ): Array<T>;
    intersectionBy<T>(
      a1: Array<T>,
      a2: Array<T>,
      a3: Array<T>,
      a4: Array<T>,
      iteratee?: ValueOnlyIteratee<T>
    ): Array<T>;
    //Workaround until (...parameter: T, parameter2: U) works
    intersectionWith<T>(a1: Array<T>, comparator: Comparator<T>): Array<T>;
    intersectionWith<T>(
      a1: Array<T>,
      a2: Array<T>,
      comparator: Comparator<T>
    ): Array<T>;
    intersectionWith<T>(
      a1: Array<T>,
      a2: Array<T>,
      a3: Array<T>,
      comparator: Comparator<T>
    ): Array<T>;
    intersectionWith<T>(
      a1: Array<T>,
      a2: Array<T>,
      a3: Array<T>,
      a4: Array<T>,
      comparator: Comparator<T>
    ): Array<T>;
    join<T>(array: ?Array<T>, separator?: string): string;
    last<T>(array: ?Array<T>): T;
    lastIndexOf<T>(array: ?Array<T>, value: T, fromIndex?: number): number;
    nth<T>(array: T[], n?: number): T;
    pull<T>(array: ?Array<T>, ...values?: Array<T>): Array<T>;
    pullAll<T>(array: ?Array<T>, values: Array<T>): Array<T>;
    pullAllBy<T>(
      array: ?Array<T>,
      values: Array<T>,
      iteratee?: ValueOnlyIteratee<T>
    ): Array<T>;
    pullAllWith<T>(array?: T[], values: T[], comparator?: Function): T[];
    pullAt<T>(array: ?Array<T>, ...indexed?: Array<number>): Array<T>;
    pullAt<T>(array: ?Array<T>, indexed?: Array<number>): Array<T>;
    remove<T>(array: ?Array<T>, predicate?: Predicate<T>): Array<T>;
    reverse<T>(array: ?Array<T>): Array<T>;
    slice<T>(array: ?Array<T>, start?: number, end?: number): Array<T>;
    sortedIndex<T>(array: ?Array<T>, value: T): number;
    sortedIndexBy<T>(
      array: ?Array<T>,
      value: T,
      iteratee?: ValueOnlyIteratee<T>
    ): number;
    sortedIndexOf<T>(array: ?Array<T>, value: T): number;
    sortedLastIndex<T>(array: ?Array<T>, value: T): number;
    sortedLastIndexBy<T>(
      array: ?Array<T>,
      value: T,
      iteratee?: ValueOnlyIteratee<T>
    ): number;
    sortedLastIndexOf<T>(array: ?Array<T>, value: T): number;
    sortedUniq<T>(array: ?Array<T>): Array<T>;
    sortedUniqBy<T>(array: ?Array<T>, iteratee?: (value: T) => mixed): Array<T>;
    tail<T>(array: ?Array<T>): Array<T>;
    take<T>(array: ?Array<T>, n?: number): Array<T>;
    takeRight<T>(array: ?Array<T>, n?: number): Array<T>;
    takeRightWhile<T>(array: ?Array<T>, predicate?: Predicate<T>): Array<T>;
    takeWhile<T>(array: ?Array<T>, predicate?: Predicate<T>): Array<T>;
    union<T>(...arrays?: Array<Array<T>>): Array<T>;
    //Workaround until (...parameter: T, parameter2: U) works
    unionBy<T>(a1: Array<T>, iteratee?: ValueOnlyIteratee<T>): Array<T>;
    unionBy<T>(
      a1: Array<T>,
      a2: Array<T>,
      iteratee?: ValueOnlyIteratee<T>
    ): Array<T>;
    unionBy<T>(
      a1: Array<T>,
      a2: Array<T>,
      a3: Array<T>,
      iteratee?: ValueOnlyIteratee<T>
    ): Array<T>;
    unionBy<T>(
      a1: Array<T>,
      a2: Array<T>,
      a3: Array<T>,
      a4: Array<T>,
      iteratee?: ValueOnlyIteratee<T>
    ): Array<T>;
    //Workaround until (...parameter: T, parameter2: U) works
    unionWith<T>(a1: Array<T>, comparator?: Comparator<T>): Array<T>;
    unionWith<T>(
      a1: Array<T>,
      a2: Array<T>,
      comparator?: Comparator<T>
    ): Array<T>;
    unionWith<T>(
      a1: Array<T>,
      a2: Array<T>,
      a3: Array<T>,
      comparator?: Comparator<T>
    ): Array<T>;
    unionWith<T>(
      a1: Array<T>,
      a2: Array<T>,
      a3: Array<T>,
      a4: Array<T>,
      comparator?: Comparator<T>
    ): Array<T>;
    uniq<T>(array: ?Array<T>): Array<T>;
    uniqBy<T>(array: ?Array<T>, iteratee?: ValueOnlyIteratee<T>): Array<T>;
    uniqWith<T>(array: ?Array<T>, comparator?: Comparator<T>): Array<T>;
    unzip<T>(array: ?Array<T>): Array<T>;
    unzipWith<T>(array: ?Array<T>, iteratee?: Iteratee<T>): Array<T>;
    without<T>(array: ?Array<T>, ...values?: Array<T>): Array<T>;
    xor<T>(...array: Array<Array<T>>): Array<T>;
    //Workaround until (...parameter: T, parameter2: U) works
    xorBy<T>(a1: Array<T>, iteratee?: ValueOnlyIteratee<T>): Array<T>;
    xorBy<T>(
      a1: Array<T>,
      a2: Array<T>,
      iteratee?: ValueOnlyIteratee<T>
    ): Array<T>;
    xorBy<T>(
      a1: Array<T>,
      a2: Array<T>,
      a3: Array<T>,
      iteratee?: ValueOnlyIteratee<T>
    ): Array<T>;
    xorBy<T>(
      a1: Array<T>,
      a2: Array<T>,
      a3: Array<T>,
      a4: Array<T>,
      iteratee?: ValueOnlyIteratee<T>
    ): Array<T>;
    //Workaround until (...parameter: T, parameter2: U) works
    xorWith<T>(a1: Array<T>, comparator?: Comparator<T>): Array<T>;
    xorWith<T>(
      a1: Array<T>,
      a2: Array<T>,
      comparator?: Comparator<T>
    ): Array<T>;
    xorWith<T>(
      a1: Array<T>,
      a2: Array<T>,
      a3: Array<T>,
      comparator?: Comparator<T>
    ): Array<T>;
    xorWith<T>(
      a1: Array<T>,
      a2: Array<T>,
      a3: Array<T>,
      a4: Array<T>,
      comparator?: Comparator<T>
    ): Array<T>;
    zip<A, B>(a1: A[], a2: B[]): Array<[A, B]>;
    zip<A, B, C>(a1: A[], a2: B[], a3: C[]): Array<[A, B, C]>;
    zip<A, B, C, D>(a1: A[], a2: B[], a3: C[], a4: D[]): Array<[A, B, C, D]>;
    zip<A, B, C, D, E>(
      a1: A[],
      a2: B[],
      a3: C[],
      a4: D[],
      a5: E[]
    ): Array<[A, B, C, D, E]>;

    zipObject<K, V>(props?: Array<K>, values?: Array<V>): { [key: K]: V };
    zipObjectDeep(props?: any[], values?: any): Object;
    //Workaround until (...parameter: T, parameter2: U) works
    zipWith<T>(a1: NestedArray<T>, iteratee?: Iteratee<T>): Array<T>;
    zipWith<T>(
      a1: NestedArray<T>,
      a2: NestedArray<T>,
      iteratee?: Iteratee<T>
    ): Array<T>;
    zipWith<T>(
      a1: NestedArray<T>,
      a2: NestedArray<T>,
      a3: NestedArray<T>,
      iteratee?: Iteratee<T>
    ): Array<T>;
    zipWith<T>(
      a1: NestedArray<T>,
      a2: NestedArray<T>,
      a3: NestedArray<T>,
      a4: NestedArray<T>,
      iteratee?: Iteratee<T>
    ): Array<T>;

    // Collection
    countBy<T>(array: ?Array<T>, iteratee?: ValueOnlyIteratee<T>): Object;
    countBy<T: Object>(object: T, iteratee?: ValueOnlyIteratee<T>): Object;
    // alias of _.forEach
    each<T>(array: ?Array<T>, iteratee?: Iteratee<T>): Array<T>;
    each<T: Object>(object: T, iteratee?: OIteratee<T>): T;
    // alias of _.forEachRight
    eachRight<T>(array: ?Array<T>, iteratee?: Iteratee<T>): Array<T>;
    eachRight<T: Object>(object: T, iteratee?: OIteratee<T>): T;
    every<T>(array: ?Array<T>, iteratee?: Iteratee<T>): boolean;
    every<T: Object>(object: T, iteratee?: OIteratee<T>): boolean;
    filter<T>(array: ?Array<T>, predicate?: Predicate<T>): Array<T>;
    filter<A, T: { [id: string]: A }>(
      object: T,
      predicate?: OPredicate<A, T>
    ): Array<A>;
    find<T>(
      array: ?$ReadOnlyArray<T>,
      predicate?: Predicate<T>,
      fromIndex?: number
    ): T | void;
    find<V, A, T: { [id: string]: A }>(
      object: T,
      predicate?: OPredicate<A, T>,
      fromIndex?: number
    ): V;
    findLast<T>(
      array: ?$ReadOnlyArray<T>,
      predicate?: Predicate<T>,
      fromIndex?: number
    ): T | void;
    findLast<V, A, T: { [id: string]: A }>(
      object: T,
      predicate?: OPredicate<A, T>
    ): V;
    flatMap<T, U>(array: ?Array<T>, iteratee?: FlatMapIteratee<T, U>): Array<U>;
    flatMap<T: Object, U>(
      object: T,
      iteratee?: OFlatMapIteratee<T, U>
    ): Array<U>;
    flatMapDeep<T, U>(
      array: ?Array<T>,
      iteratee?: FlatMapIteratee<T, U>
    ): Array<U>;
    flatMapDeep<T: Object, U>(
      object: T,
      iteratee?: OFlatMapIteratee<T, U>
    ): Array<U>;
    flatMapDepth<T, U>(
      array: ?Array<T>,
      iteratee?: FlatMapIteratee<T, U>,
      depth?: number
    ): Array<U>;
    flatMapDepth<T: Object, U>(
      object: T,
      iteratee?: OFlatMapIteratee<T, U>,
      depth?: number
    ): Array<U>;
    forEach<T>(array: ?Array<T>, iteratee?: Iteratee<T>): Array<T>;
    forEach<T: Object>(object: T, iteratee?: OIteratee<T>): T;
    forEachRight<T>(array: ?Array<T>, iteratee?: Iteratee<T>): Array<T>;
    forEachRight<T: Object>(object: T, iteratee?: OIteratee<T>): T;
    groupBy<V, T>(
      array: ?Array<T>,
      iteratee?: ValueOnlyIteratee<T>
    ): { [key: V]: Array<T> };
    groupBy<V, A, T: { [id: string]: A }>(
      object: T,
      iteratee?: ValueOnlyIteratee<A>
    ): { [key: V]: Array<A> };
    includes<T>(array: ?Array<T>, value: T, fromIndex?: number): boolean;
    includes<T: Object>(object: T, value: any, fromIndex?: number): boolean;
    includes(str: string, value: string, fromIndex?: number): boolean;
    invokeMap<T>(
      array: ?Array<T>,
      path: ((value: T) => Array<string> | string) | Array<string> | string,
      ...args?: Array<any>
    ): Array<any>;
    invokeMap<T: Object>(
      object: T,
      path: ((value: any) => Array<string> | string) | Array<string> | string,
      ...args?: Array<any>
    ): Array<any>;
    keyBy<T, V>(
      array: ?Array<T>,
      iteratee?: ValueOnlyIteratee<T>
    ): { [key: V]: ?T };
    keyBy<V, A, I, T: { [id: I]: A }>(
      object: T,
      iteratee?: ValueOnlyIteratee<A>
    ): { [key: V]: ?A };
    map<T, U>(array: ?Array<T>, iteratee?: MapIterator<T, U>): Array<U>;
    map<V, T: Object, U>(
      object: ?T,
      iteratee?: OMapIterator<V, T, U>
    ): Array<U>;
    map(
      str: ?string,
      iteratee?: (char: string, index: number, str: string) => any
    ): string;
    orderBy<T>(
      array: ?Array<T>,
      iteratees?: Array<Iteratee<T>> | string,
      orders?: Array<"asc" | "desc"> | string
    ): Array<T>;
    orderBy<V, T: Object>(
      object: T,
      iteratees?: Array<OIteratee<*>> | string,
      orders?: Array<"asc" | "desc"> | string
    ): Array<V>;
    partition<T>(
      array: ?Array<T>,
      predicate?: Predicate<T>
    ): [Array<T>, Array<T>];
    partition<V, A, T: { [id: string]: A }>(
      object: T,
      predicate?: OPredicate<A, T>
    ): [Array<V>, Array<V>];
    reduce<T, U>(
      array: ?Array<T>,
      iteratee?: (
        accumulator: U,
        value: T,
        index: number,
        array: ?Array<T>
      ) => U,
      accumulator?: U
    ): U;
    reduce<T: Object, U>(
      object: T,
      iteratee?: (accumulator: U, value: any, key: string, object: T) => U,
      accumulator?: U
    ): U;
    reduceRight<T, U>(
      array: ?Array<T>,
      iteratee?: (
        accumulator: U,
        value: T,
        index: number,
        array: ?Array<T>
      ) => U,
      accumulator?: U
    ): U;
    reduceRight<T: Object, U>(
      object: T,
      iteratee?: (accumulator: U, value: any, key: string, object: T) => U,
      accumulator?: U
    ): U;
    reject<T>(array: ?Array<T>, predicate?: Predicate<T>): Array<T>;
    reject<V: Object, A, T: { [id: string]: A }>(
      object: T,
      predicate?: OPredicate<A, T>
    ): Array<V>;
    sample<T>(array: ?Array<T>): T;
    sample<V, T: Object>(object: T): V;
    sampleSize<T>(array: ?Array<T>, n?: number): Array<T>;
    sampleSize<V, T: Object>(object: T, n?: number): Array<V>;
    shuffle<T>(array: ?Array<T>): Array<T>;
    shuffle<V, T: Object>(object: T): Array<V>;
    size(collection: Array<any> | Object): number;
    some<T>(array: ?Array<T>, predicate?: Predicate<T>): boolean;
    some<A, T: { [id: string]: A }>(
      object?: ?T,
      predicate?: OPredicate<A, T>
    ): boolean;
    sortBy<T>(array: ?Array<T>, ...iteratees?: Array<Iteratee<T>>): Array<T>;
    sortBy<T>(array: ?Array<T>, iteratees?: Array<Iteratee<T>>): Array<T>;
    sortBy<V, T: Object>(
      object: T,
      ...iteratees?: Array<OIteratee<T>>
    ): Array<V>;
    sortBy<V, T: Object>(object: T, iteratees?: Array<OIteratee<T>>): Array<V>;

    // Date
    now(): number;

    // Function
    after(n: number, fn: Function): Function;
    ary(func: Function, n?: number): Function;
    before(n: number, fn: Function): Function;
    bind(func: Function, thisArg: any, ...partials: Array<any>): Function;
    bindKey(obj: Object, key: string, ...partials: Array<any>): Function;
    curry: Curry;
    curry(func: Function, arity?: number): Function;
    curryRight(func: Function, arity?: number): Function;
    debounce<F: Function>(func: F, wait?: number, options?: DebounceOptions): F;
    defer(func: Function, ...args?: Array<any>): number;
    delay(func: Function, wait: number, ...args?: Array<any>): number;
    flip(func: Function): Function;
    memoize<F: Function>(func: F, resolver?: Function): F;
    negate(predicate: Function): Function;
    once(func: Function): Function;
    overArgs(func: Function, ...transforms: Array<Function>): Function;
    overArgs(func: Function, transforms: Array<Function>): Function;
    partial(func: Function, ...partials: any[]): Function;
    partialRight(func: Function, ...partials: Array<any>): Function;
    partialRight(func: Function, partials: Array<any>): Function;
    rearg(func: Function, ...indexes: Array<number>): Function;
    rearg(func: Function, indexes: Array<number>): Function;
    rest(func: Function, start?: number): Function;
    spread(func: Function): Function;
    throttle(
      func: Function,
      wait?: number,
      options?: ThrottleOptions
    ): Function;
    unary(func: Function): Function;
    wrap(value: any, wrapper: Function): Function;

    // Lang
    castArray(value: *): any[];
    clone<T>(value: T): T;
    cloneDeep<T>(value: T): T;
    cloneDeepWith<T, U>(
      value: T,
      customizer?: ?(value: T, key: number | string, object: T, stack: any) => U
    ): U;
    cloneWith<T, U>(
      value: T,
      customizer?: ?(value: T, key: number | string, object: T, stack: any) => U
    ): U;
    conformsTo<T: { [key: string]: mixed }>(
      source: T,
      predicates: T & { [key: string]: (x: any) => boolean }
    ): boolean;
    eq(value: any, other: any): boolean;
    gt(value: any, other: any): boolean;
    gte(value: any, other: any): boolean;
    isArguments(value: any): boolean;
    isArray(value: any): boolean;
    isArrayBuffer(value: any): boolean;
    isArrayLike(value: any): boolean;
    isArrayLikeObject(value: any): boolean;
    isBoolean(value: any): boolean;
    isBuffer(value: any): boolean;
    isDate(value: any): boolean;
    isElement(value: any): boolean;
    isEmpty(value: any): boolean;
    isEqual(value: any, other: any): boolean;
    isEqualWith<T, U>(
      value: T,
      other: U,
      customizer?: (
        objValue: any,
        otherValue: any,
        key: number | string,
        object: T,
        other: U,
        stack: any
      ) => boolean | void
    ): boolean;
    isError(value: any): boolean;
    isFinite(value: any): boolean;
    isFunction(value: Function): true;
    isFunction(value: number | string | void | null | Object): false;
    isInteger(value: any): boolean;
    isLength(value: any): boolean;
    isMap(value: any): boolean;
    isMatch(object?: ?Object, source: Object): boolean;
    isMatchWith<T: Object, U: Object>(
      object: T,
      source: U,
      customizer?: (
        objValue: any,
        srcValue: any,
        key: number | string,
        object: T,
        source: U
      ) => boolean | void
    ): boolean;
    isNaN(value: any): boolean;
    isNative(value: any): boolean;
    isNil(value: any): boolean;
    isNull(value: any): boolean;
    isNumber(value: any): boolean;
    isObject(value: any): boolean;
    isObjectLike(value: any): boolean;
    isPlainObject(value: any): boolean;
    isRegExp(value: any): boolean;
    isSafeInteger(value: any): boolean;
    isSet(value: any): boolean;
    isString(value: string): true;
    isString(
      value: number | boolean | Function | void | null | Object | Array<any>
    ): false;
    isSymbol(value: any): boolean;
    isTypedArray(value: any): boolean;
    isUndefined(value: any): boolean;
    isWeakMap(value: any): boolean;
    isWeakSet(value: any): boolean;
    lt(value: any, other: any): boolean;
    lte(value: any, other: any): boolean;
    toArray(value: any): Array<any>;
    toFinite(value: any): number;
    toInteger(value: any): number;
    toLength(value: any): number;
    toNumber(value: any): number;
    toPlainObject(value: any): Object;
    toSafeInteger(value: any): number;
    toString(value: any): string;

    // Math
    add(augend: number, addend: number): number;
    ceil(number: number, precision?: number): number;
    divide(dividend: number, divisor: number): number;
    floor(number: number, precision?: number): number;
    max<T>(array: ?Array<T>): T;
    maxBy<T>(array: ?Array<T>, iteratee?: Iteratee<T>): T;
    mean(array: Array<*>): number;
    meanBy<T>(array: Array<T>, iteratee?: Iteratee<T>): number;
    min<T>(array: ?Array<T>): T;
    minBy<T>(array: ?Array<T>, iteratee?: Iteratee<T>): T;
    multiply(multiplier: number, multiplicand: number): number;
    round(number: number, precision?: number): number;
    subtract(minuend: number, subtrahend: number): number;
    sum(array: Array<*>): number;
    sumBy<T>(array: Array<T>, iteratee?: Iteratee<T>): number;

    // number
    clamp(number: number, lower?: number, upper: number): number;
    inRange(number: number, start?: number, end: number): boolean;
    random(lower?: number, upper?: number, floating?: boolean): number;

    // Object
    assign(object?: ?Object, ...sources?: Array<Object>): Object;
    assignIn<A, B>(a: A, b: B): A & B;
    assignIn<A, B, C>(a: A, b: B, c: C): A & B & C;
    assignIn<A, B, C, D>(a: A, b: B, c: C, d: D): A & B & C & D;
    assignIn<A, B, C, D, E>(a: A, b: B, c: C, d: D, e: E): A & B & C & D & E;
    assignInWith<T: Object, A: Object>(
      object: T,
      s1: A,
      customizer?: (
        objValue: any,
        srcValue: any,
        key: string,
        object: T,
        source: A
      ) => any | void
    ): Object;
    assignInWith<T: Object, A: Object, B: Object>(
      object: T,
      s1: A,
      s2: B,
      customizer?: (
        objValue: any,
        srcValue: any,
        key: string,
        object: T,
        source: A | B
      ) => any | void
    ): Object;
    assignInWith<T: Object, A: Object, B: Object, C: Object>(
      object: T,
      s1: A,
      s2: B,
      s3: C,
      customizer?: (
        objValue: any,
        srcValue: any,
        key: string,
        object: T,
        source: A | B | C
      ) => any | void
    ): Object;
    assignInWith<T: Object, A: Object, B: Object, C: Object, D: Object>(
      object: T,
      s1: A,
      s2: B,
      s3: C,
      s4: D,
      customizer?: (
        objValue: any,
        srcValue: any,
        key: string,
        object: T,
        source: A | B | C | D
      ) => any | void
    ): Object;
    assignWith<T: Object, A: Object>(
      object: T,
      s1: A,
      customizer?: (
        objValue: any,
        srcValue: any,
        key: string,
        object: T,
        source: A
      ) => any | void
    ): Object;
    assignWith<T: Object, A: Object, B: Object>(
      object: T,
      s1: A,
      s2: B,
      customizer?: (
        objValue: any,
        srcValue: any,
        key: string,
        object: T,
        source: A | B
      ) => any | void
    ): Object;
    assignWith<T: Object, A: Object, B: Object, C: Object>(
      object: T,
      s1: A,
      s2: B,
      s3: C,
      customizer?: (
        objValue: any,
        srcValue: any,
        key: string,
        object: T,
        source: A | B | C
      ) => any | void
    ): Object;
    assignWith<T: Object, A: Object, B: Object, C: Object, D: Object>(
      object: T,
      s1: A,
      s2: B,
      s3: C,
      s4: D,
      customizer?: (
        objValue: any,
        srcValue: any,
        key: string,
        object: T,
        source: A | B | C | D
      ) => any | void
    ): Object;
    at(object?: ?Object, ...paths: Array<string>): Array<any>;
    at(object?: ?Object, paths: Array<string>): Array<any>;
    create<T>(prototype: T, properties?: Object): $Supertype<T>;
    defaults(object?: ?Object, ...sources?: Array<Object>): Object;
    defaultsDeep(object?: ?Object, ...sources?: Array<Object>): Object;
    // alias for _.toPairs
    entries(object?: ?Object): Array<[string, any]>;
    // alias for _.toPairsIn
    entriesIn(object?: ?Object): Array<[string, any]>;
    // alias for _.assignIn
    extend<A, B>(a: A, b: B): A & B;
    extend<A, B, C>(a: A, b: B, c: C): A & B & C;
    extend<A, B, C, D>(a: A, b: B, c: C, d: D): A & B & C & D;
    extend<A, B, C, D, E>(a: A, b: B, c: C, d: D, e: E): A & B & C & D & E;
    // alias for _.assignInWith
    extendWith<T: Object, A: Object>(
      object: T,
      s1: A,
      customizer?: (
        objValue: any,
        srcValue: any,
        key: string,
        object: T,
        source: A
      ) => any | void
    ): Object;
    extendWith<T: Object, A: Object, B: Object>(
      object: T,
      s1: A,
      s2: B,
      customizer?: (
        objValue: any,
        srcValue: any,
        key: string,
        object: T,
        source: A | B
      ) => any | void
    ): Object;
    extendWith<T: Object, A: Object, B: Object, C: Object>(
      object: T,
      s1: A,
      s2: B,
      s3: C,
      customizer?: (
        objValue: any,
        srcValue: any,
        key: string,
        object: T,
        source: A | B | C
      ) => any | void
    ): Object;
    extendWith<T: Object, A: Object, B: Object, C: Object, D: Object>(
      object: T,
      s1: A,
      s2: B,
      s3: C,
      s4: D,
      customizer?: (
        objValue: any,
        srcValue: any,
        key: string,
        object: T,
        source: A | B | C | D
      ) => any | void
    ): Object;
    findKey<A, T: { [id: string]: A }>(
      object?: ?T,
      predicate?: OPredicate<A, T>
    ): string | void;
    findLastKey<A, T: { [id: string]: A }>(
      object?: ?T,
      predicate?: OPredicate<A, T>
    ): string | void;
    forIn(object?: ?Object, iteratee?: OIteratee<*>): Object;
    forInRight(object?: ?Object, iteratee?: OIteratee<*>): Object;
    forOwn(object?: ?Object, iteratee?: OIteratee<*>): Object;
    forOwnRight(object?: ?Object, iteratee?: OIteratee<*>): Object;
    functions(object?: ?Object): Array<string>;
    functionsIn(object?: ?Object): Array<string>;
    get(
      object?: ?Object | ?Array<any>,
      path?: ?Array<string> | string,
      defaultValue?: any
    ): any;
    has(object?: ?Object, path?: ?Array<string> | string): boolean;
    hasIn(object?: ?Object, path?: ?Array<string> | string): boolean;
    invert(object?: ?Object, multiVal?: boolean): Object;
    invertBy(object: ?Object, iteratee?: Function): Object;
    invoke(
      object?: ?Object,
      path?: ?Array<string> | string,
      ...args?: Array<any>
    ): any;
    keys<K>(object?: ?{ [key: K]: any }): Array<K>;
    keys(object?: ?Object): Array<string>;
    keysIn(object?: ?Object): Array<string>;
    mapKeys(object?: ?Object, iteratee?: OIteratee<*>): Object;
    mapValues(object?: ?Object, iteratee?: OIteratee<*>): Object;
    merge(object?: ?Object, ...sources?: Array<?Object>): Object;
    mergeWith<T: Object, A: Object>(
      object: T,
      customizer?: (
        objValue: any,
        srcValue: any,
        key: string,
        object: T,
        source: A
      ) => any | void
    ): Object;
    mergeWith<T: Object, A: Object, B: Object>(
      object: T,
      s1: A,
      s2: B,
      customizer?: (
        objValue: any,
        srcValue: any,
        key: string,
        object: T,
        source: A | B
      ) => any | void
    ): Object;
    mergeWith<T: Object, A: Object, B: Object, C: Object>(
      object: T,
      s1: A,
      s2: B,
      s3: C,
      customizer?: (
        objValue: any,
        srcValue: any,
        key: string,
        object: T,
        source: A | B | C
      ) => any | void
    ): Object;
    mergeWith<T: Object, A: Object, B: Object, C: Object, D: Object>(
      object: T,
      s1: A,
      s2: B,
      s3: C,
      s4: D,
      customizer?: (
        objValue: any,
        srcValue: any,
        key: string,
        object: T,
        source: A | B | C | D
      ) => any | void
    ): Object;
    omit(object?: ?Object, ...props: Array<string>): Object;
    omit(object?: ?Object, props: Array<string>): Object;
    omitBy<A, T: { [id: string]: A }>(
      object?: ?T,
      predicate?: OPredicate<A, T>
    ): Object;
    pick(object?: ?Object, ...props: Array<string>): Object;
    pick(object?: ?Object, props: Array<string>): Object;
    pickBy<A, T: { [id: string]: A }>(
      object?: ?T,
      predicate?: OPredicate<A, T>
    ): Object;
    result(
      object?: ?Object,
      path?: ?Array<string> | string,
      defaultValue?: any
    ): any;
    set(object?: ?Object, path?: ?Array<string> | string, value: any): Object;
    setWith<T>(
      object: T,
      path?: ?Array<string> | string,
      value: any,
      customizer?: (nsValue: any, key: string, nsObject: T) => any
    ): Object;
    toPairs(object?: ?Object | Array<*>): Array<[string, any]>;
    toPairsIn(object?: ?Object): Array<[string, any]>;
    transform(
      collection: Object | Array<any>,
      iteratee?: OIteratee<*>,
      accumulator?: any
    ): any;
    unset(object?: ?Object, path?: ?Array<string> | string): boolean;
    update(object: Object, path: string[] | string, updater: Function): Object;
    updateWith(
      object: Object,
      path: string[] | string,
      updater: Function,
      customizer?: Function
    ): Object;
    values(object?: ?Object): Array<any>;
    valuesIn(object?: ?Object): Array<any>;

    // Seq
    // harder to read, but this is _()
    (value: any): any;
    chain<T>(value: T): any;
    tap<T>(value: T, interceptor: (value: T) => any): T;
    thru<T1, T2>(value: T1, interceptor: (value: T1) => T2): T2;
    // TODO: _.prototype.*

    // String
    camelCase(string?: ?string): string;
    capitalize(string?: string): string;
    deburr(string?: string): string;
    endsWith(string?: string, target?: string, position?: number): boolean;
    escape(string?: string): string;
    escapeRegExp(string?: string): string;
    kebabCase(string?: string): string;
    lowerCase(string?: string): string;
    lowerFirst(string?: string): string;
    pad(string?: string, length?: number, chars?: string): string;
    padEnd(string?: string, length?: number, chars?: string): string;
    padStart(string?: string, length?: number, chars?: string): string;
    parseInt(string: string, radix?: number): number;
    repeat(string?: string, n?: number): string;
    replace(
      string?: string,
      pattern: RegExp | string,
      replacement: ((string: string) => string) | string
    ): string;
    snakeCase(string?: string): string;
    split(
      string?: string,
      separator: RegExp | string,
      limit?: number
    ): Array<string>;
    startCase(string?: string): string;
    startsWith(string?: string, target?: string, position?: number): boolean;
    template(string?: string, options?: TemplateSettings): Function;
    toLower(string?: string): string;
    toUpper(string?: string): string;
    trim(string?: string, chars?: string): string;
    trimEnd(string?: string, chars?: string): string;
    trimStart(string?: string, chars?: string): string;
    truncate(string?: string, options?: TruncateOptions): string;
    unescape(string?: string): string;
    upperCase(string?: string): string;
    upperFirst(string?: string): string;
    words(string?: string, pattern?: RegExp | string): Array<string>;

    // Util
    attempt(func: Function, ...args: Array<any>): any;
    bindAll(object?: ?Object, methodNames: Array<string>): Object;
    bindAll(object?: ?Object, ...methodNames: Array<string>): Object;
    cond(pairs: NestedArray<Function>): Function;
    conforms(source: Object): Function;
    constant<T>(value: T): () => T;
    defaultTo<T1: string | boolean | Object, T2>(
      value: T1,
      defaultValue: T2
    ): T1;
    // NaN is a number instead of its own type, otherwise it would behave like null/void
    defaultTo<T1: number, T2>(value: T1, defaultValue: T2): T1 | T2;
    defaultTo<T1: void | null, T2>(value: T1, defaultValue: T2): T2;
    flow: $ComposeReverse;
    flow(funcs?: Array<Function>): Function;
    flowRight: $Compose;
    flowRight(funcs?: Array<Function>): Function;
    identity<T>(value: T): T;
    iteratee(func?: any): Function;
    matches(source: Object): Function;
    matchesProperty(path?: ?Array<string> | string, srcValue: any): Function;
    method(path?: ?Array<string> | string, ...args?: Array<any>): Function;
    methodOf(object?: ?Object, ...args?: Array<any>): Function;
    mixin<T: Function | Object>(
      object?: T,
      source: Object,
      options?: { chain: boolean }
    ): T;
    noConflict(): Lodash;
    noop(...args: Array<mixed>): void;
    nthArg(n?: number): Function;
    over(...iteratees: Array<Function>): Function;
    over(iteratees: Array<Function>): Function;
    overEvery(...predicates: Array<Function>): Function;
    overEvery(predicates: Array<Function>): Function;
    overSome(...predicates: Array<Function>): Function;
    overSome(predicates: Array<Function>): Function;
    property(path?: ?Array<string> | string): Function;
    propertyOf(object?: ?Object): Function;
    range(start: number, end: number, step?: number): Array<number>;
    range(end: number, step?: number): Array<number>;
    rangeRight(start: number, end: number, step?: number): Array<number>;
    rangeRight(end: number, step?: number): Array<number>;
    runInContext(context?: Object): Function;

    stubArray(): Array<*>;
    stubFalse(): false;
    stubObject(): {};
    stubString(): "";
    stubTrue(): true;
    times(n: number, ...rest: Array<void>): Array<number>;
    times<T>(n: number, iteratee: (i: number) => T): Array<T>;
    toPath(value: any): Array<string>;
    uniqueId(prefix?: string): string;

    // Properties
    VERSION: string;
    templateSettings: TemplateSettings;
  }

  declare module.exports: Lodash;
}

declare module "lodash/fp" {
  declare type __CurriedFunction1<A, R, AA: A> = (...r: [AA]) => R;
  declare type CurriedFunction1<A, R> = __CurriedFunction1<A, R, *>;

  declare type __CurriedFunction2<A, B, R, AA: A, BB: B> = ((
    ...r: [AA]
  ) => CurriedFunction1<BB, R>) &
    ((...r: [AA, BB]) => R);
  declare type CurriedFunction2<A, B, R> = __CurriedFunction2<A, B, R, *, *>;

  declare type __CurriedFunction3<A, B, C, R, AA: A, BB: B, CC: C> = ((
    ...r: [AA]
  ) => CurriedFunction2<BB, CC, R>) &
    ((...r: [AA, BB]) => CurriedFunction1<CC, R>) &
    ((...r: [AA, BB, CC]) => R);
  declare type CurriedFunction3<A, B, C, R> = __CurriedFunction3<
    A,
    B,
    C,
    R,
    *,
    *,
    *
  >;

  declare type __CurriedFunction4<
    A,
    B,
    C,
    D,
    R,
    AA: A,
    BB: B,
    CC: C,
    DD: D
  > = ((...r: [AA]) => CurriedFunction3<BB, CC, DD, R>) &
    ((...r: [AA, BB]) => CurriedFunction2<CC, DD, R>) &
    ((...r: [AA, BB, CC]) => CurriedFunction1<DD, R>) &
    ((...r: [AA, BB, CC, DD]) => R);
  declare type CurriedFunction4<A, B, C, D, R> = __CurriedFunction4<
    A,
    B,
    C,
    D,
    R,
    *,
    *,
    *,
    *
  >;

  declare type __CurriedFunction5<
    A,
    B,
    C,
    D,
    E,
    R,
    AA: A,
    BB: B,
    CC: C,
    DD: D,
    EE: E
  > = ((...r: [AA]) => CurriedFunction4<BB, CC, DD, EE, R>) &
    ((...r: [AA, BB]) => CurriedFunction3<CC, DD, EE, R>) &
    ((...r: [AA, BB, CC]) => CurriedFunction2<DD, EE, R>) &
    ((...r: [AA, BB, CC, DD]) => CurriedFunction1<EE, R>) &
    ((...r: [AA, BB, CC, DD, EE]) => R);
  declare type CurriedFunction5<A, B, C, D, E, R> = __CurriedFunction5<
    A,
    B,
    C,
    D,
    E,
    R,
    *,
    *,
    *,
    *,
    *
  >;

  declare type __CurriedFunction6<
    A,
    B,
    C,
    D,
    E,
    F,
    R,
    AA: A,
    BB: B,
    CC: C,
    DD: D,
    EE: E,
    FF: F
  > = ((...r: [AA]) => CurriedFunction5<BB, CC, DD, EE, FF, R>) &
    ((...r: [AA, BB]) => CurriedFunction4<CC, DD, EE, FF, R>) &
    ((...r: [AA, BB, CC]) => CurriedFunction3<DD, EE, FF, R>) &
    ((...r: [AA, BB, CC, DD]) => CurriedFunction2<EE, FF, R>) &
    ((...r: [AA, BB, CC, DD, EE]) => CurriedFunction1<FF, R>) &
    ((...r: [AA, BB, CC, DD, EE, FF]) => R);
  declare type CurriedFunction6<A, B, C, D, E, F, R> = __CurriedFunction6<
    A,
    B,
    C,
    D,
    E,
    F,
    R,
    *,
    *,
    *,
    *,
    *,
    *
  >;

  declare type Curry = (<A, R>((...r: [A]) => R) => CurriedFunction1<A, R>) &
    (<A, B, R>((...r: [A, B]) => R) => CurriedFunction2<A, B, R>) &
    (<A, B, C, R>((...r: [A, B, C]) => R) => CurriedFunction3<A, B, C, R>) &
    (<A, B, C, D, R>(
      (...r: [A, B, C, D]) => R
    ) => CurriedFunction4<A, B, C, D, R>) &
    (<A, B, C, D, E, R>(
      (...r: [A, B, C, D, E]) => R
    ) => CurriedFunction5<A, B, C, D, E, R>) &
    (<A, B, C, D, E, F, R>(
      (...r: [A, B, C, D, E, F]) => R
    ) => CurriedFunction6<A, B, C, D, E, F, R>);

  declare type UnaryFn<A, R> = (a: A) => R;

  declare type TemplateSettings = {
    escape?: RegExp,
    evaluate?: RegExp,
    imports?: Object,
    interpolate?: RegExp,
    variable?: string
  };

  declare type TruncateOptions = {
    length?: number,
    omission?: string,
    separator?: RegExp | string
  };

  declare type DebounceOptions = {
    leading?: boolean,
    maxWait?: number,
    trailing?: boolean
  };

  declare type ThrottleOptions = {
    leading?: boolean,
    trailing?: boolean
  };

  declare type NestedArray<T> = Array<Array<T>>;

  declare type matchesIterateeShorthand = Object;
  declare type matchesPropertyIterateeShorthand = [string, any];
  declare type propertyIterateeShorthand = string;

  declare type OPredicate<A> =
    | ((value: A) => any)
    | matchesIterateeShorthand
    | matchesPropertyIterateeShorthand
    | propertyIterateeShorthand;

  declare type OIterateeWithResult<V, R> = Object | string | ((value: V) => R);
  declare type OIteratee<O> = OIterateeWithResult<any, any>;
  declare type OFlatMapIteratee<T, U> = OIterateeWithResult<any, Array<U>>;

  declare type Predicate<T> =
    | ((value: T) => any)
    | matchesIterateeShorthand
    | matchesPropertyIterateeShorthand
    | propertyIterateeShorthand;

  declare type _ValueOnlyIteratee<T> = (value: T) => mixed;
  declare type ValueOnlyIteratee<T> = _ValueOnlyIteratee<T> | string;
  declare type _Iteratee<T> = (item: T) => mixed;
  declare type Iteratee<T> = _Iteratee<T> | Object | string;
  declare type FlatMapIteratee<T, U> =
    | ((item: T) => Array<U>)
    | Object
    | string;
  declare type Comparator<T> = (item: T, item2: T) => boolean;

  declare type MapIterator<T, U> = ((item: T) => U) | propertyIterateeShorthand;

  declare type OMapIterator<T, U> =
    | ((item: T) => U)
    | propertyIterateeShorthand;

  declare class Lodash {
    // Array
    chunk<T>(size: number): (array: Array<T>) => Array<Array<T>>;
    chunk<T>(size: number, array: Array<T>): Array<Array<T>>;
    compact<T, N: T>(array: Array<N>): Array<T>;
    concat<T, U, A: Array<T> | T, B: Array<U> | U>(
      base: A
    ): (elements: B) => Array<T | U>;
    concat<T, U, A: Array<T> | T, B: Array<U> | U>(
      base: A,
      elements: B
    ): Array<T | U>;
    difference<T>(values: Array<T>): (array: Array<T>) => Array<T>;
    difference<T>(values: Array<T>, array: Array<T>): Array<T>;
    differenceBy<T>(
      iteratee: ValueOnlyIteratee<T>
    ): ((values: Array<T>) => (array: Array<T>) => T[]) &
      ((values: Array<T>, array: Array<T>) => T[]);
    differenceBy<T>(
      iteratee: ValueOnlyIteratee<T>,
      values: Array<T>
    ): (array: Array<T>) => T[];
    differenceBy<T>(
      iteratee: ValueOnlyIteratee<T>,
      values: Array<T>,
      array: Array<T>
    ): T[];
    differenceWith<T>(
      values: T[]
    ): ((comparator: Comparator<T>) => (array: T[]) => T[]) &
      ((comparator: Comparator<T>, array: T[]) => T[]);
    differenceWith<T>(
      values: T[],
      comparator: Comparator<T>
    ): (array: T[]) => T[];
    differenceWith<T>(values: T[], comparator: Comparator<T>, array: T[]): T[];
    drop<T>(n: number): (array: Array<T>) => Array<T>;
    drop<T>(n: number, array: Array<T>): Array<T>;
    dropLast<T>(n: number): (array: Array<T>) => Array<T>;
    dropLast<T>(n: number, array: Array<T>): Array<T>;
    dropRight<T>(n: number): (array: Array<T>) => Array<T>;
    dropRight<T>(n: number, array: Array<T>): Array<T>;
    dropRightWhile<T>(predicate: Predicate<T>): (array: Array<T>) => Array<T>;
    dropRightWhile<T>(predicate: Predicate<T>, array: Array<T>): Array<T>;
    dropWhile<T>(predicate: Predicate<T>): (array: Array<T>) => Array<T>;
    dropWhile<T>(predicate: Predicate<T>, array: Array<T>): Array<T>;
    dropLastWhile<T>(predicate: Predicate<T>): (array: Array<T>) => Array<T>;
    dropLastWhile<T>(predicate: Predicate<T>, array: Array<T>): Array<T>;
    fill<T, U>(
      start: number
    ): ((
      end: number
    ) => ((value: U) => (array: Array<T>) => Array<T | U>) &
      ((value: U, array: Array<T>) => Array<T | U>)) &
      ((end: number, value: U) => (array: Array<T>) => Array<T | U>) &
      ((end: number, value: U, array: Array<T>) => Array<T | U>);
    fill<T, U>(
      start: number,
      end: number
    ): ((value: U) => (array: Array<T>) => Array<T | U>) &
      ((value: U, array: Array<T>) => Array<T | U>);
    fill<T, U>(
      start: number,
      end: number,
      value: U
    ): (array: Array<T>) => Array<T | U>;
    fill<T, U>(
      start: number,
      end: number,
      value: U,
      array: Array<T>
    ): Array<T | U>;
    findIndex<T>(predicate: Predicate<T>): (array: $ReadOnlyArray<T>) => number;
    findIndex<T>(predicate: Predicate<T>, array: $ReadOnlyArray<T>): number;
    findIndexFrom<T>(
      predicate: Predicate<T>
    ): ((fromIndex: number) => (array: $ReadOnlyArray<T>) => number) &
      ((fromIndex: number, array: $ReadOnlyArray<T>) => number);
    findIndexFrom<T>(
      predicate: Predicate<T>,
      fromIndex: number
    ): (array: $ReadOnlyArray<T>) => number;
    findIndexFrom<T>(
      predicate: Predicate<T>,
      fromIndex: number,
      array: $ReadOnlyArray<T>
    ): number;
    findLastIndex<T>(
      predicate: Predicate<T>
    ): (array: $ReadOnlyArray<T>) => number;
    findLastIndex<T>(predicate: Predicate<T>, array: $ReadOnlyArray<T>): number;
    findLastIndexFrom<T>(
      predicate: Predicate<T>
    ): ((fromIndex: number) => (array: $ReadOnlyArray<T>) => number) &
      ((fromIndex: number, array: $ReadOnlyArray<T>) => number);
    findLastIndexFrom<T>(
      predicate: Predicate<T>,
      fromIndex: number
    ): (array: $ReadOnlyArray<T>) => number;
    findLastIndexFrom<T>(
      predicate: Predicate<T>,
      fromIndex: number,
      array: $ReadOnlyArray<T>
    ): number;
    // alias of _.head
    first<T>(array: Array<T>): T;
    flatten<T, X>(array: Array<Array<T> | X>): Array<T | X>;
    unnest<T, X>(array: Array<Array<T> | X>): Array<T | X>;
    flattenDeep<T>(array: any[]): Array<T>;
    flattenDepth(depth: number): (array: any[]) => any[];
    flattenDepth(depth: number, array: any[]): any[];
    fromPairs<A, B>(pairs: Array<[A, B]>): { [key: A]: B };
    head<T>(array: Array<T>): T;
    indexOf<T>(value: T): (array: Array<T>) => number;
    indexOf<T>(value: T, array: Array<T>): number;
    indexOfFrom<T>(
      value: T
    ): ((fromIndex: number) => (array: Array<T>) => number) &
      ((fromIndex: number, array: Array<T>) => number);
    indexOfFrom<T>(value: T, fromIndex: number): (array: Array<T>) => number;
    indexOfFrom<T>(value: T, fromIndex: number, array: Array<T>): number;
    initial<T>(array: Array<T>): Array<T>;
    init<T>(array: Array<T>): Array<T>;
    intersection<T>(a1: Array<T>): (a2: Array<T>) => Array<T>;
    intersection<T>(a1: Array<T>, a2: Array<T>): Array<T>;
    intersectionBy<T>(
      iteratee: ValueOnlyIteratee<T>
    ): ((a1: Array<T>) => (a2: Array<T>) => Array<T>) &
      ((a1: Array<T>, a2: Array<T>) => Array<T>);
    intersectionBy<T>(
      iteratee: ValueOnlyIteratee<T>,
      a1: Array<T>
    ): (a2: Array<T>) => Array<T>;
    intersectionBy<T>(
      iteratee: ValueOnlyIteratee<T>,
      a1: Array<T>,
      a2: Array<T>
    ): Array<T>;
    intersectionWith<T>(
      comparator: Comparator<T>
    ): ((a1: Array<T>) => (a2: Array<T>) => Array<T>) &
      ((a1: Array<T>, a2: Array<T>) => Array<T>);
    intersectionWith<T>(
      comparator: Comparator<T>,
      a1: Array<T>
    ): (a2: Array<T>) => Array<T>;
    intersectionWith<T>(
      comparator: Comparator<T>,
      a1: Array<T>,
      a2: Array<T>
    ): Array<T>;
    join<T>(separator: string): (array: Array<T>) => string;
    join<T>(separator: string, array: Array<T>): string;
    last<T>(array: Array<T>): T;
    lastIndexOf<T>(value: T): (array: Array<T>) => number;
    lastIndexOf<T>(value: T, array: Array<T>): number;
    lastIndexOfFrom<T>(
      value: T
    ): ((fromIndex: number) => (array: Array<T>) => number) &
      ((fromIndex: number, array: Array<T>) => number);
    lastIndexOfFrom<T>(
      value: T,
      fromIndex: number
    ): (array: Array<T>) => number;
    lastIndexOfFrom<T>(value: T, fromIndex: number, array: Array<T>): number;
    nth<T>(n: number): (array: T[]) => T;
    nth<T>(n: number, array: T[]): T;
    pull<T>(value: T): (array: Array<T>) => Array<T>;
    pull<T>(value: T, array: Array<T>): Array<T>;
    pullAll<T>(values: Array<T>): (array: Array<T>) => Array<T>;
    pullAll<T>(values: Array<T>, array: Array<T>): Array<T>;
    pullAllBy<T>(
      iteratee: ValueOnlyIteratee<T>
    ): ((values: Array<T>) => (array: Array<T>) => Array<T>) &
      ((values: Array<T>, array: Array<T>) => Array<T>);
    pullAllBy<T>(
      iteratee: ValueOnlyIteratee<T>,
      values: Array<T>
    ): (array: Array<T>) => Array<T>;
    pullAllBy<T>(
      iteratee: ValueOnlyIteratee<T>,
      values: Array<T>,
      array: Array<T>
    ): Array<T>;
    pullAllWith<T>(
      comparator: Function
    ): ((values: T[]) => (array: T[]) => T[]) &
      ((values: T[], array: T[]) => T[]);
    pullAllWith<T>(comparator: Function, values: T[]): (array: T[]) => T[];
    pullAllWith<T>(comparator: Function, values: T[], array: T[]): T[];
    pullAt<T>(indexed: Array<number>): (array: Array<T>) => Array<T>;
    pullAt<T>(indexed: Array<number>, array: Array<T>): Array<T>;
    remove<T>(predicate: Predicate<T>): (array: Array<T>) => Array<T>;
    remove<T>(predicate: Predicate<T>, array: Array<T>): Array<T>;
    reverse<T>(array: Array<T>): Array<T>;
    slice<T>(
      start: number
    ): ((end: number) => (array: Array<T>) => Array<T>) &
      ((end: number, array: Array<T>) => Array<T>);
    slice<T>(start: number, end: number): (array: Array<T>) => Array<T>;
    slice<T>(start: number, end: number, array: Array<T>): Array<T>;
    sortedIndex<T>(value: T): (array: Array<T>) => number;
    sortedIndex<T>(value: T, array: Array<T>): number;
    sortedIndexBy<T>(
      iteratee: ValueOnlyIteratee<T>
    ): ((value: T) => (array: Array<T>) => number) &
      ((value: T, array: Array<T>) => number);
    sortedIndexBy<T>(
      iteratee: ValueOnlyIteratee<T>,
      value: T
    ): (array: Array<T>) => number;
    sortedIndexBy<T>(
      iteratee: ValueOnlyIteratee<T>,
      value: T,
      array: Array<T>
    ): number;
    sortedIndexOf<T>(value: T): (array: Array<T>) => number;
    sortedIndexOf<T>(value: T, array: Array<T>): number;
    sortedLastIndex<T>(value: T): (array: Array<T>) => number;
    sortedLastIndex<T>(value: T, array: Array<T>): number;
    sortedLastIndexBy<T>(
      iteratee: ValueOnlyIteratee<T>
    ): ((value: T) => (array: Array<T>) => number) &
      ((value: T, array: Array<T>) => number);
    sortedLastIndexBy<T>(
      iteratee: ValueOnlyIteratee<T>,
      value: T
    ): (array: Array<T>) => number;
    sortedLastIndexBy<T>(
      iteratee: ValueOnlyIteratee<T>,
      value: T,
      array: Array<T>
    ): number;
    sortedLastIndexOf<T>(value: T): (array: Array<T>) => number;
    sortedLastIndexOf<T>(value: T, array: Array<T>): number;
    sortedUniq<T>(array: Array<T>): Array<T>;
    sortedUniqBy<T>(
      iteratee: (value: T) => mixed
    ): (array: Array<T>) => Array<T>;
    sortedUniqBy<T>(iteratee: (value: T) => mixed, array: Array<T>): Array<T>;
    tail<T>(array: Array<T>): Array<T>;
    take<T>(n: number): (array: Array<T>) => Array<T>;
    take<T>(n: number, array: Array<T>): Array<T>;
    takeRight<T>(n: number): (array: Array<T>) => Array<T>;
    takeRight<T>(n: number, array: Array<T>): Array<T>;
    takeLast<T>(n: number): (array: Array<T>) => Array<T>;
    takeLast<T>(n: number, array: Array<T>): Array<T>;
    takeRightWhile<T>(predicate: Predicate<T>): (array: Array<T>) => Array<T>;
    takeRightWhile<T>(predicate: Predicate<T>, array: Array<T>): Array<T>;
    takeLastWhile<T>(predicate: Predicate<T>): (array: Array<T>) => Array<T>;
    takeLastWhile<T>(predicate: Predicate<T>, array: Array<T>): Array<T>;
    takeWhile<T>(predicate: Predicate<T>): (array: Array<T>) => Array<T>;
    takeWhile<T>(predicate: Predicate<T>, array: Array<T>): Array<T>;
    union<T>(a1: Array<T>): (a2: Array<T>) => Array<T>;
    union<T>(a1: Array<T>, a2: Array<T>): Array<T>;
    unionBy<T>(
      iteratee: ValueOnlyIteratee<T>
    ): ((a1: Array<T>) => (a2: Array<T>) => Array<T>) &
      ((a1: Array<T>, a2: Array<T>) => Array<T>);
    unionBy<T>(
      iteratee: ValueOnlyIteratee<T>,
      a1: Array<T>
    ): (a2: Array<T>) => Array<T>;
    unionBy<T>(
      iteratee: ValueOnlyIteratee<T>,
      a1: Array<T>,
      a2: Array<T>
    ): Array<T>;
    unionWith<T>(
      comparator: Comparator<T>
    ): ((a1: Array<T>) => (a2: Array<T>) => Array<T>) &
      ((a1: Array<T>, a2: Array<T>) => Array<T>);
    unionWith<T>(
      comparator: Comparator<T>,
      a1: Array<T>
    ): (a2: Array<T>) => Array<T>;
    unionWith<T>(
      comparator: Comparator<T>,
      a1: Array<T>,
      a2: Array<T>
    ): Array<T>;
    uniq<T>(array: Array<T>): Array<T>;
    uniqBy<T>(iteratee: ValueOnlyIteratee<T>): (array: Array<T>) => Array<T>;
    uniqBy<T>(iteratee: ValueOnlyIteratee<T>, array: Array<T>): Array<T>;
    uniqWith<T>(comparator: Comparator<T>): (array: Array<T>) => Array<T>;
    uniqWith<T>(comparator: Comparator<T>, array: Array<T>): Array<T>;
    unzip<T>(array: Array<T>): Array<T>;
    unzipWith<T>(iteratee: Iteratee<T>): (array: Array<T>) => Array<T>;
    unzipWith<T>(iteratee: Iteratee<T>, array: Array<T>): Array<T>;
    without<T>(values: Array<T>): (array: Array<T>) => Array<T>;
    without<T>(values: Array<T>, array: Array<T>): Array<T>;
    xor<T>(a1: Array<T>): (a2: Array<T>) => Array<T>;
    xor<T>(a1: Array<T>, a2: Array<T>): Array<T>;
    symmetricDifference<T>(a1: Array<T>): (a2: Array<T>) => Array<T>;
    symmetricDifference<T>(a1: Array<T>, a2: Array<T>): Array<T>;
    xorBy<T>(
      iteratee: ValueOnlyIteratee<T>
    ): ((a1: Array<T>) => (a2: Array<T>) => Array<T>) &
      ((a1: Array<T>, a2: Array<T>) => Array<T>);
    xorBy<T>(
      iteratee: ValueOnlyIteratee<T>,
      a1: Array<T>
    ): (a2: Array<T>) => Array<T>;
    xorBy<T>(
      iteratee: ValueOnlyIteratee<T>,
      a1: Array<T>,
      a2: Array<T>
    ): Array<T>;
    symmetricDifferenceBy<T>(
      iteratee: ValueOnlyIteratee<T>
    ): ((a1: Array<T>) => (a2: Array<T>) => Array<T>) &
      ((a1: Array<T>, a2: Array<T>) => Array<T>);
    symmetricDifferenceBy<T>(
      iteratee: ValueOnlyIteratee<T>,
      a1: Array<T>
    ): (a2: Array<T>) => Array<T>;
    symmetricDifferenceBy<T>(
      iteratee: ValueOnlyIteratee<T>,
      a1: Array<T>,
      a2: Array<T>
    ): Array<T>;
    xorWith<T>(
      comparator: Comparator<T>
    ): ((a1: Array<T>) => (a2: Array<T>) => Array<T>) &
      ((a1: Array<T>, a2: Array<T>) => Array<T>);
    xorWith<T>(
      comparator: Comparator<T>,
      a1: Array<T>
    ): (a2: Array<T>) => Array<T>;
    xorWith<T>(comparator: Comparator<T>, a1: Array<T>, a2: Array<T>): Array<T>;
    symmetricDifferenceWith<T>(
      comparator: Comparator<T>
    ): ((a1: Array<T>) => (a2: Array<T>) => Array<T>) &
      ((a1: Array<T>, a2: Array<T>) => Array<T>);
    symmetricDifferenceWith<T>(
      comparator: Comparator<T>,
      a1: Array<T>
    ): (a2: Array<T>) => Array<T>;
    symmetricDifferenceWith<T>(
      comparator: Comparator<T>,
      a1: Array<T>,
      a2: Array<T>
    ): Array<T>;
    zip<A, B>(a1: A[]): (a2: B[]) => Array<[A, B]>;
    zip<A, B>(a1: A[], a2: B[]): Array<[A, B]>;
    zipAll(arrays: Array<Array<any>>): Array<any>;
    zipObject<K, V>(props?: Array<K>): (values?: Array<V>) => { [key: K]: V };
    zipObject<K, V>(props?: Array<K>, values?: Array<V>): { [key: K]: V };
    zipObj(props: Array<any>): (values: Array<any>) => Object;
    zipObj(props: Array<any>, values: Array<any>): Object;
    zipObjectDeep(props: any[]): (values: any) => Object;
    zipObjectDeep(props: any[], values: any): Object;
    zipWith<T>(
      iteratee: Iteratee<T>
    ): ((a1: NestedArray<T>) => (a2: NestedArray<T>) => Array<T>) &
      ((a1: NestedArray<T>, a2: NestedArray<T>) => Array<T>);
    zipWith<T>(
      iteratee: Iteratee<T>,
      a1: NestedArray<T>
    ): (a2: NestedArray<T>) => Array<T>;
    zipWith<T>(
      iteratee: Iteratee<T>,
      a1: NestedArray<T>,
      a2: NestedArray<T>
    ): Array<T>;
    // Collection
    countBy<T>(
      iteratee: ValueOnlyIteratee<T>
    ): (collection: Array<T> | { [id: any]: T }) => { [string]: number };
    countBy<T>(
      iteratee: ValueOnlyIteratee<T>,
      collection: Array<T> | { [id: any]: T }
    ): { [string]: number };
    // alias of _.forEach
    each<T>(
      iteratee: Iteratee<T> | OIteratee<T>
    ): (collection: Array<T> | { [id: any]: T }) => Array<T>;
    each<T>(
      iteratee: Iteratee<T> | OIteratee<T>,
      collection: Array<T> | { [id: any]: T }
    ): Array<T>;
    // alias of _.forEachRight
    eachRight<T>(
      iteratee: Iteratee<T> | OIteratee<T>
    ): (collection: Array<T> | { [id: any]: T }) => Array<T>;
    eachRight<T>(
      iteratee: Iteratee<T> | OIteratee<T>,
      collection: Array<T> | { [id: any]: T }
    ): Array<T>;
    every<T>(
      iteratee: Iteratee<T> | OIteratee<T>
    ): (collection: Array<T> | { [id: any]: T }) => boolean;
    every<T>(
      iteratee: Iteratee<T> | OIteratee<T>,
      collection: Array<T> | { [id: any]: T }
    ): boolean;
    all<T>(
      iteratee: Iteratee<T> | OIteratee<T>
    ): (collection: Array<T> | { [id: any]: T }) => boolean;
    all<T>(
      iteratee: Iteratee<T> | OIteratee<T>,
      collection: Array<T> | { [id: any]: T }
    ): boolean;
    filter<T>(
      predicate: Predicate<T> | OPredicate<T>
    ): (collection: Array<T> | { [id: any]: T }) => Array<T>;
    filter<T>(
      predicate: Predicate<T> | OPredicate<T>,
      collection: Array<T> | { [id: any]: T }
    ): Array<T>;
    find<T>(
      predicate: Predicate<T> | OPredicate<T>
    ): (collection: $ReadOnlyArray<T> | { [id: any]: T }) => T | void;
    find<T>(
      predicate: Predicate<T> | OPredicate<T>,
      collection: $ReadOnlyArray<T> | { [id: any]: T }
    ): T | void;
    findFrom<T>(
      predicate: Predicate<T> | OPredicate<T>
    ): ((
      fromIndex: number
    ) => (collection: $ReadOnlyArray<T> | { [id: any]: T }) => T | void) &
      ((
        fromIndex: number,
        collection: $ReadOnlyArray<T> | { [id: any]: T }
      ) => T | void);
    findFrom<T>(
      predicate: Predicate<T> | OPredicate<T>,
      fromIndex: number
    ): (collection: Array<T> | { [id: any]: T }) => T | void;
    findFrom<T>(
      predicate: Predicate<T> | OPredicate<T>,
      fromIndex: number,
      collection: $ReadOnlyArray<T> | { [id: any]: T }
    ): T | void;
    findLast<T>(
      predicate: Predicate<T> | OPredicate<T>
    ): (collection: $ReadOnlyArray<T> | { [id: any]: T }) => T | void;
    findLast<T>(
      predicate: Predicate<T> | OPredicate<T>,
      collection: $ReadOnlyArray<T> | { [id: any]: T }
    ): T | void;
    findLastFrom<T>(
      predicate: Predicate<T> | OPredicate<T>
    ): ((
      fromIndex: number
    ) => (collection: $ReadOnlyArray<T> | { [id: any]: T }) => T | void) &
      ((
        fromIndex: number,
        collection: $ReadOnlyArray<T> | { [id: any]: T }
      ) => T | void);
    findLastFrom<T>(
      predicate: Predicate<T> | OPredicate<T>,
      fromIndex: number
    ): (collection: $ReadOnlyArray<T> | { [id: any]: T }) => T | void;
    findLastFrom<T>(
      predicate: Predicate<T> | OPredicate<T>,
      fromIndex: number,
      collection: $ReadOnlyArray<T> | { [id: any]: T }
    ): T | void;
    flatMap<T, U>(
      iteratee: FlatMapIteratee<T, U> | OFlatMapIteratee<T, U>
    ): (collection: Array<T> | { [id: any]: T }) => Array<U>;
    flatMap<T, U>(
      iteratee: FlatMapIteratee<T, U> | OFlatMapIteratee<T, U>,
      collection: Array<T> | { [id: any]: T }
    ): Array<U>;
    flatMapDeep<T, U>(
      iteratee: FlatMapIteratee<T, U> | OFlatMapIteratee<T, U>
    ): (collection: Array<T> | { [id: any]: T }) => Array<U>;
    flatMapDeep<T, U>(
      iteratee: FlatMapIteratee<T, U> | OFlatMapIteratee<T, U>,
      collection: Array<T> | { [id: any]: T }
    ): Array<U>;
    flatMapDepth<T, U>(
      iteratee: FlatMapIteratee<T, U> | OFlatMapIteratee<T, U>
    ): ((
      depth: number
    ) => (collection: Array<T> | { [id: any]: T }) => Array<U>) &
      ((depth: number, collection: Array<T> | { [id: any]: T }) => Array<U>);
    flatMapDepth<T, U>(
      iteratee: FlatMapIteratee<T, U> | OFlatMapIteratee<T, U>,
      depth: number
    ): (collection: Array<T> | { [id: any]: T }) => Array<U>;
    flatMapDepth<T, U>(
      iteratee: FlatMapIteratee<T, U> | OFlatMapIteratee<T, U>,
      depth: number,
      collection: Array<T> | { [id: any]: T }
    ): Array<U>;
    forEach<T>(
      iteratee: Iteratee<T> | OIteratee<T>
    ): (collection: Array<T> | { [id: any]: T }) => Array<T>;
    forEach<T>(
      iteratee: Iteratee<T> | OIteratee<T>,
      collection: Array<T> | { [id: any]: T }
    ): Array<T>;
    forEachRight<T>(
      iteratee: Iteratee<T> | OIteratee<T>
    ): (collection: Array<T> | { [id: any]: T }) => Array<T>;
    forEachRight<T>(
      iteratee: Iteratee<T> | OIteratee<T>,
      collection: Array<T> | { [id: any]: T }
    ): Array<T>;
    groupBy<V, T>(
      iteratee: ValueOnlyIteratee<T>
    ): (collection: Array<T> | { [id: any]: T }) => { [key: V]: Array<T> };
    groupBy<V, T>(
      iteratee: ValueOnlyIteratee<T>,
      collection: Array<T> | { [id: any]: T }
    ): { [key: V]: Array<T> };
    includes(value: string): (str: string) => boolean;
    includes(value: string, str: string): boolean;
    includes<T>(value: T): (collection: Array<T> | { [id: any]: T }) => boolean;
    includes<T>(value: T, collection: Array<T> | { [id: any]: T }): boolean;
    contains(value: string): (str: string) => boolean;
    contains(value: string, str: string): boolean;
    contains<T>(value: T): (collection: Array<T> | { [id: any]: T }) => boolean;
    contains<T>(value: T, collection: Array<T> | { [id: any]: T }): boolean;
    includesFrom(
      value: string
    ): ((fromIndex: number) => (str: string) => boolean) &
      ((fromIndex: number, str: string) => boolean);
    includesFrom(value: string, fromIndex: number): (str: string) => boolean;
    includesFrom(value: string, fromIndex: number, str: string): boolean;
    includesFrom<T>(
      value: T
    ): ((fromIndex: number) => (collection: Array<T>) => boolean) &
      ((fromIndex: number, collection: Array<T>) => boolean);
    includesFrom<T>(
      value: T,
      fromIndex: number
    ): (collection: Array<T>) => boolean;
    includesFrom<T>(value: T, fromIndex: number, collection: Array<T>): boolean;
    invokeMap<T>(
      path: ((value: T) => Array<string> | string) | Array<string> | string
    ): (collection: Array<T> | { [id: any]: T }) => Array<any>;
    invokeMap<T>(
      path: ((value: T) => Array<string> | string) | Array<string> | string,
      collection: Array<T> | { [id: any]: T }
    ): Array<any>;
    invokeArgsMap<T>(
      path: ((value: T) => Array<string> | string) | Array<string> | string
    ): ((
      collection: Array<T> | { [id: any]: T }
    ) => (args: Array<any>) => Array<any>) &
      ((
        collection: Array<T> | { [id: any]: T },
        args: Array<any>
      ) => Array<any>);
    invokeArgsMap<T>(
      path: ((value: T) => Array<string> | string) | Array<string> | string,
      collection: Array<T> | { [id: any]: T }
    ): (args: Array<any>) => Array<any>;
    invokeArgsMap<T>(
      path: ((value: T) => Array<string> | string) | Array<string> | string,
      collection: Array<T> | { [id: any]: T },
      args: Array<any>
    ): Array<any>;
    keyBy<T, V>(
      iteratee: ValueOnlyIteratee<T>
    ): (collection: Array<T> | { [id: any]: T }) => { [key: V]: T };
    keyBy<T, V>(
      iteratee: ValueOnlyIteratee<T>,
      collection: Array<T> | { [id: any]: T }
    ): { [key: V]: T };
    indexBy<T, V>(
      iteratee: ValueOnlyIteratee<T>
    ): (collection: Array<T> | { [id: any]: T }) => { [key: V]: T };
    indexBy<T, V>(
      iteratee: ValueOnlyIteratee<T>,
      collection: Array<T> | { [id: any]: T }
    ): { [key: V]: T };
    map<T, U>(
      iteratee: MapIterator<T, U> | OMapIterator<T, U>
    ): (collection: Array<T> | { [id: any]: T }) => Array<U>;
    map<T, U>(
      iteratee: MapIterator<T, U> | OMapIterator<T, U>,
      collection: Array<T> | { [id: any]: T }
    ): Array<U>;
    map(iteratee: (char: string) => any): (str: string) => string;
    map(iteratee: (char: string) => any, str: string): string;
    pluck<T, U>(
      iteratee: MapIterator<T, U> | OMapIterator<T, U>
    ): (collection: Array<T> | { [id: any]: T }) => Array<U>;
    pluck<T, U>(
      iteratee: MapIterator<T, U> | OMapIterator<T, U>,
      collection: Array<T> | { [id: any]: T }
    ): Array<U>;
    pluck(iteratee: (char: string) => any): (str: string) => string;
    pluck(iteratee: (char: string) => any, str: string): string;
    orderBy<T>(
      iteratees: Array<Iteratee<T> | OIteratee<*>> | string
    ): ((
      orders: Array<"asc" | "desc"> | string
    ) => (collection: Array<T> | { [id: any]: T }) => Array<T>) &
      ((
        orders: Array<"asc" | "desc"> | string,
        collection: Array<T> | { [id: any]: T }
      ) => Array<T>);
    orderBy<T>(
      iteratees: Array<Iteratee<T> | OIteratee<*>> | string,
      orders: Array<"asc" | "desc"> | string
    ): (collection: Array<T> | { [id: any]: T }) => Array<T>;
    orderBy<T>(
      iteratees: Array<Iteratee<T> | OIteratee<*>> | string,
      orders: Array<"asc" | "desc"> | string,
      collection: Array<T> | { [id: any]: T }
    ): Array<T>;
    partition<T>(
      predicate: Predicate<T> | OPredicate<T>
    ): (collection: Array<T> | { [id: any]: T }) => [Array<T>, Array<T>];
    partition<T>(
      predicate: Predicate<T> | OPredicate<T>,
      collection: Array<T> | { [id: any]: T }
    ): [Array<T>, Array<T>];
    reduce<T, U>(
      iteratee: (accumulator: U, value: T) => U
    ): ((accumulator: U) => (collection: Array<T> | { [id: any]: T }) => U) &
      ((accumulator: U, collection: Array<T> | { [id: any]: T }) => U);
    reduce<T, U>(
      iteratee: (accumulator: U, value: T) => U,
      accumulator: U
    ): (collection: Array<T> | { [id: any]: T }) => U;
    reduce<T, U>(
      iteratee: (accumulator: U, value: T) => U,
      accumulator: U,
      collection: Array<T> | { [id: any]: T }
    ): U;
    reduceRight<T, U>(
      iteratee: (value: T, accumulator: U) => U
    ): ((accumulator: U) => (collection: Array<T> | { [id: any]: T }) => U) &
      ((accumulator: U, collection: Array<T> | { [id: any]: T }) => U);
    reduceRight<T, U>(
      iteratee: (value: T, accumulator: U) => U,
      accumulator: U
    ): (collection: Array<T> | { [id: any]: T }) => U;
    reduceRight<T, U>(
      iteratee: (value: T, accumulator: U) => U,
      accumulator: U,
      collection: Array<T> | { [id: any]: T }
    ): U;
    reject<T>(
      predicate: Predicate<T> | OPredicate<T>
    ): (collection: Array<T> | { [id: any]: T }) => Array<T>;
    reject<T>(
      predicate: Predicate<T> | OPredicate<T>,
      collection: Array<T> | { [id: any]: T }
    ): Array<T>;
    sample<T>(collection: Array<T> | { [id: any]: T }): T;
    sampleSize<T>(
      n: number
    ): (collection: Array<T> | { [id: any]: T }) => Array<T>;
    sampleSize<T>(n: number, collection: Array<T> | { [id: any]: T }): Array<T>;
    shuffle<T>(collection: Array<T> | { [id: any]: T }): Array<T>;
    size(collection: Array<any> | Object): number;
    some<T>(
      predicate: Predicate<T> | OPredicate<T>
    ): (collection: Array<T> | { [id: any]: T }) => boolean;
    some<T>(
      predicate: Predicate<T> | OPredicate<T>,
      collection: Array<T> | { [id: any]: T }
    ): boolean;
    any<T>(
      predicate: Predicate<T> | OPredicate<T>
    ): (collection: Array<T> | { [id: any]: T }) => boolean;
    any<T>(
      predicate: Predicate<T> | OPredicate<T>,
      collection: Array<T> | { [id: any]: T }
    ): boolean;
    sortBy<T>(
      iteratees: Array<Iteratee<T> | OIteratee<T>> | Iteratee<T> | OIteratee<T>
    ): (collection: Array<T> | { [id: any]: T }) => Array<T>;
    sortBy<T>(
      iteratees: Array<Iteratee<T> | OIteratee<T>> | Iteratee<T> | OIteratee<T>,
      collection: Array<T> | { [id: any]: T }
    ): Array<T>;

    // Date
    now(): number;

    // Function
    after(fn: Function): (n: number) => Function;
    after(fn: Function, n: number): Function;
    ary(func: Function): Function;
    nAry(n: number): (func: Function) => Function;
    nAry(n: number, func: Function): Function;
    before(fn: Function): (n: number) => Function;
    before(fn: Function, n: number): Function;
    bind(func: Function): (thisArg: any) => Function;
    bind(func: Function, thisArg: any): Function;
    bindKey(obj: Object): (key: string) => Function;
    bindKey(obj: Object, key: string): Function;
    curry: Curry;
    curryN(arity: number): (func: Function) => Function;
    curryN(arity: number, func: Function): Function;
    curryRight(func: Function): Function;
    curryRightN(arity: number): (func: Function) => Function;
    curryRightN(arity: number, func: Function): Function;
    debounce(wait: number): <F: Function>(func: F) => F;
    debounce<F: Function>(wait: number, func: F): F;
    defer(func: Function): number;
    delay(wait: number): (func: Function) => number;
    delay(wait: number, func: Function): number;
    flip(func: Function): Function;
    memoize<F: Function>(func: F): F;
    negate(predicate: Function): Function;
    complement(predicate: Function): Function;
    once(func: Function): Function;
    overArgs(func: Function): (transforms: Array<Function>) => Function;
    overArgs(func: Function, transforms: Array<Function>): Function;
    useWith(func: Function): (transforms: Array<Function>) => Function;
    useWith(func: Function, transforms: Array<Function>): Function;
    partial(func: Function): (partials: any[]) => Function;
    partial(func: Function, partials: any[]): Function;
    partialRight(func: Function): (partials: Array<any>) => Function;
    partialRight(func: Function, partials: Array<any>): Function;
    rearg(indexes: Array<number>): (func: Function) => Function;
    rearg(indexes: Array<number>, func: Function): Function;
    rest(func: Function): Function;
    unapply(func: Function): Function;
    restFrom(start: number): (func: Function) => Function;
    restFrom(start: number, func: Function): Function;
    spread(func: Function): Function;
    apply(func: Function): Function;
    spreadFrom(start: number): (func: Function) => Function;
    spreadFrom(start: number, func: Function): Function;
    throttle(wait: number): (func: Function) => Function;
    throttle(wait: number, func: Function): Function;
    unary(func: Function): Function;
    wrap(wrapper: Function): (value: any) => Function;
    wrap(wrapper: Function, value: any): Function;

    // Lang
    castArray(value: *): any[];
    clone<T>(value: T): T;
    cloneDeep<T>(value: T): T;
    cloneDeepWith<T, U>(
      customizer: (value: T, key: number | string, object: T, stack: any) => U
    ): (value: T) => U;
    cloneDeepWith<T, U>(
      customizer: (value: T, key: number | string, object: T, stack: any) => U,
      value: T
    ): U;
    cloneWith<T, U>(
      customizer: (value: T, key: number | string, object: T, stack: any) => U
    ): (value: T) => U;
    cloneWith<T, U>(
      customizer: (value: T, key: number | string, object: T, stack: any) => U,
      value: T
    ): U;
    conformsTo<T: { [key: string]: mixed }>(
      predicates: T & { [key: string]: (x: any) => boolean }
    ): (source: T) => boolean;
    conformsTo<T: { [key: string]: mixed }>(
      predicates: T & { [key: string]: (x: any) => boolean },
      source: T
    ): boolean;
    where<T: { [key: string]: mixed }>(
      predicates: T & { [key: string]: (x: any) => boolean }
    ): (source: T) => boolean;
    where<T: { [key: string]: mixed }>(
      predicates: T & { [key: string]: (x: any) => boolean },
      source: T
    ): boolean;
    conforms<T: { [key: string]: mixed }>(
      predicates: T & { [key: string]: (x: any) => boolean }
    ): (source: T) => boolean;
    conforms<T: { [key: string]: mixed }>(
      predicates: T & { [key: string]: (x: any) => boolean },
      source: T
    ): boolean;
    eq(value: any): (other: any) => boolean;
    eq(value: any, other: any): boolean;
    identical(value: any): (other: any) => boolean;
    identical(value: any, other: any): boolean;
    gt(value: any): (other: any) => boolean;
    gt(value: any, other: any): boolean;
    gte(value: any): (other: any) => boolean;
    gte(value: any, other: any): boolean;
    isArguments(value: any): boolean;
    isArray(value: any): boolean;
    isArrayBuffer(value: any): boolean;
    isArrayLike(value: any): boolean;
    isArrayLikeObject(value: any): boolean;
    isBoolean(value: any): boolean;
    isBuffer(value: any): boolean;
    isDate(value: any): boolean;
    isElement(value: any): boolean;
    isEmpty(value: any): boolean;
    isEqual(value: any): (other: any) => boolean;
    isEqual(value: any, other: any): boolean;
    equals(value: any): (other: any) => boolean;
    equals(value: any, other: any): boolean;
    isEqualWith<T, U>(
      customizer: (
        objValue: any,
        otherValue: any,
        key: number | string,
        object: T,
        other: U,
        stack: any
      ) => boolean | void
    ): ((value: T) => (other: U) => boolean) &
      ((value: T, other: U) => boolean);
    isEqualWith<T, U>(
      customizer: (
        objValue: any,
        otherValue: any,
        key: number | string,
        object: T,
        other: U,
        stack: any
      ) => boolean | void,
      value: T
    ): (other: U) => boolean;
    isEqualWith<T, U>(
      customizer: (
        objValue: any,
        otherValue: any,
        key: number | string,
        object: T,
        other: U,
        stack: any
      ) => boolean | void,
      value: T,
      other: U
    ): boolean;
    isError(value: any): boolean;
    isFinite(value: any): boolean;
    isFunction(value: Function): true;
    isFunction(value: number | string | void | null | Object): false;
    isInteger(value: any): boolean;
    isLength(value: any): boolean;
    isMap(value: any): boolean;
    isMatch(source: Object): (object: Object) => boolean;
    isMatch(source: Object, object: Object): boolean;
    whereEq(source: Object): (object: Object) => boolean;
    whereEq(source: Object, object: Object): boolean;
    isMatchWith<T: Object, U: Object>(
      customizer: (
        objValue: any,
        srcValue: any,
        key: number | string,
        object: T,
        source: U
      ) => boolean | void
    ): ((source: U) => (object: T) => boolean) &
      ((source: U, object: T) => boolean);
    isMatchWith<T: Object, U: Object>(
      customizer: (
        objValue: any,
        srcValue: any,
        key: number | string,
        object: T,
        source: U
      ) => boolean | void,
      source: U
    ): (object: T) => boolean;
    isMatchWith<T: Object, U: Object>(
      customizer: (
        objValue: any,
        srcValue: any,
        key: number | string,
        object: T,
        source: U
      ) => boolean | void,
      source: U,
      object: T
    ): boolean;
    isNaN(value: any): boolean;
    isNative(value: any): boolean;
    isNil(value: any): boolean;
    isNull(value: any): boolean;
    isNumber(value: any): boolean;
    isObject(value: any): boolean;
    isObjectLike(value: any): boolean;
    isPlainObject(value: any): boolean;
    isRegExp(value: any): boolean;
    isSafeInteger(value: any): boolean;
    isSet(value: any): boolean;
    isString(value: string): true;
    isString(
      value: number | boolean | Function | void | null | Object | Array<any>
    ): false;
    isSymbol(value: any): boolean;
    isTypedArray(value: any): boolean;
    isUndefined(value: any): boolean;
    isWeakMap(value: any): boolean;
    isWeakSet(value: any): boolean;
    lt(value: any): (other: any) => boolean;
    lt(value: any, other: any): boolean;
    lte(value: any): (other: any) => boolean;
    lte(value: any, other: any): boolean;
    toArray(value: any): Array<any>;
    toFinite(value: any): number;
    toInteger(value: any): number;
    toLength(value: any): number;
    toNumber(value: any): number;
    toPlainObject(value: any): Object;
    toSafeInteger(value: any): number;
    toString(value: any): string;

    // Math
    add(augend: number): (addend: number) => number;
    add(augend: number, addend: number): number;
    ceil(number: number): number;
    divide(dividend: number): (divisor: number) => number;
    divide(dividend: number, divisor: number): number;
    floor(number: number): number;
    max<T>(array: Array<T>): T;
    maxBy<T>(iteratee: Iteratee<T>): (array: Array<T>) => T;
    maxBy<T>(iteratee: Iteratee<T>, array: Array<T>): T;
    mean(array: Array<*>): number;
    meanBy<T>(iteratee: Iteratee<T>): (array: Array<T>) => number;
    meanBy<T>(iteratee: Iteratee<T>, array: Array<T>): number;
    min<T>(array: Array<T>): T;
    minBy<T>(iteratee: Iteratee<T>): (array: Array<T>) => T;
    minBy<T>(iteratee: Iteratee<T>, array: Array<T>): T;
    multiply(multiplier: number): (multiplicand: number) => number;
    multiply(multiplier: number, multiplicand: number): number;
    round(number: number): number;
    subtract(minuend: number): (subtrahend: number) => number;
    subtract(minuend: number, subtrahend: number): number;
    sum(array: Array<*>): number;
    sumBy<T>(iteratee: Iteratee<T>): (array: Array<T>) => number;
    sumBy<T>(iteratee: Iteratee<T>, array: Array<T>): number;

    // number
    clamp(
      lower: number
    ): ((upper: number) => (number: number) => number) &
      ((upper: number, number: number) => number);
    clamp(lower: number, upper: number): (number: number) => number;
    clamp(lower: number, upper: number, number: number): number;
    inRange(
      start: number
    ): ((end: number) => (number: number) => boolean) &
      ((end: number, number: number) => boolean);
    inRange(start: number, end: number): (number: number) => boolean;
    inRange(start: number, end: number, number: number): boolean;
    random(lower: number): (upper: number) => number;
    random(lower: number, upper: number): number;

    // Object
    assign(object: Object): (source: Object) => Object;
    assign(object: Object, source: Object): Object;
    assignAll(objects: Array<Object>): Object;
    assignInAll(objects: Array<Object>): Object;
    extendAll(objects: Array<Object>): Object;
    assignIn<A, B>(a: A): (b: B) => A & B;
    assignIn<A, B>(a: A, b: B): A & B;
    assignInWith<T: Object, A: Object>(
      customizer: (
        objValue: any,
        srcValue: any,
        key: string,
        object: T,
        source: A
      ) => any | void
    ): ((object: T) => (s1: A) => Object) & ((object: T, s1: A) => Object);
    assignInWith<T: Object, A: Object>(
      customizer: (
        objValue: any,
        srcValue: any,
        key: string,
        object: T,
        source: A
      ) => any | void,
      object: T
    ): (s1: A) => Object;
    assignInWith<T: Object, A: Object>(
      customizer: (
        objValue: any,
        srcValue: any,
        key: string,
        object: T,
        source: A
      ) => any | void,
      object: T,
      s1: A
    ): Object;
    assignWith<T: Object, A: Object>(
      customizer: (
        objValue: any,
        srcValue: any,
        key: string,
        object: T,
        source: A
      ) => any | void
    ): ((object: T) => (s1: A) => Object) & ((object: T, s1: A) => Object);
    assignWith<T: Object, A: Object>(
      customizer: (
        objValue: any,
        srcValue: any,
        key: string,
        object: T,
        source: A
      ) => any | void,
      object: T
    ): (s1: A) => Object;
    assignWith<T: Object, A: Object>(
      customizer: (
        objValue: any,
        srcValue: any,
        key: string,
        object: T,
        source: A
      ) => any | void,
      object: T,
      s1: A
    ): Object;
    assignInAllWith(
      customizer: (
        objValue: any,
        srcValue: any,
        key: string,
        object: Object,
        source: Object
      ) => any | void
    ): (objects: Array<Object>) => Object;
    assignInAllWith(
      customizer: (
        objValue: any,
        srcValue: any,
        key: string,
        object: Object,
        source: Object
      ) => any | void,
      objects: Array<Object>
    ): Object;
    extendAllWith(
      customizer: (
        objValue: any,
        srcValue: any,
        key: string,
        object: Object,
        source: Object
      ) => any | void
    ): (objects: Array<Object>) => Object;
    extendAllWith(
      customizer: (
        objValue: any,
        srcValue: any,
        key: string,
        object: Object,
        source: Object
      ) => any | void,
      objects: Array<Object>
    ): Object;
    assignAllWith(
      customizer: (
        objValue: any,
        srcValue: any,
        key: string,
        object: Object,
        source: Object
      ) => any | void
    ): (objects: Array<Object>) => Object;
    assignAllWith(
      customizer: (
        objValue: any,
        srcValue: any,
        key: string,
        object: Object,
        source: Object
      ) => any | void,
      objects: Array<Object>
    ): Object;
    at(paths: Array<string>): (object: Object) => Array<any>;
    at(paths: Array<string>, object: Object): Array<any>;
    props(paths: Array<string>): (object: Object) => Array<any>;
    props(paths: Array<string>, object: Object): Array<any>;
    paths(paths: Array<string>): (object: Object) => Array<any>;
    paths(paths: Array<string>, object: Object): Array<any>;
    create<T>(prototype: T): $Supertype<T>;
    defaults(source: Object): (object: Object) => Object;
    defaults(source: Object, object: Object): Object;
    defaultsAll(objects: Array<Object>): Object;
    defaultsDeep(source: Object): (object: Object) => Object;
    defaultsDeep(source: Object, object: Object): Object;
    defaultsDeepAll(objects: Array<Object>): Object;
    // alias for _.toPairs
    entries(object: Object): Array<[string, any]>;
    // alias for _.toPairsIn
    entriesIn(object: Object): Array<[string, any]>;
    // alias for _.assignIn
    extend<A, B>(a: A): (b: B) => A & B;
    extend<A, B>(a: A, b: B): A & B;
    // alias for _.assignInWith
    extendWith<T: Object, A: Object>(
      customizer: (
        objValue: any,
        srcValue: any,
        key: string,
        object: T,
        source: A
      ) => any | void
    ): ((object: T) => (s1: A) => Object) & ((object: T, s1: A) => Object);
    extendWith<T: Object, A: Object>(
      customizer: (
        objValue: any,
        srcValue: any,
        key: string,
        object: T,
        source: A
      ) => any | void,
      object: T
    ): (s1: A) => Object;
    extendWith<T: Object, A: Object>(
      customizer: (
        objValue: any,
        srcValue: any,
        key: string,
        object: T,
        source: A
      ) => any | void,
      object: T,
      s1: A
    ): Object;
    findKey<A, T: { [id: any]: A }>(
      predicate: OPredicate<A>
    ): (object: T) => string | void;
    findKey<A, T: { [id: any]: A }>(
      predicate: OPredicate<A>,
      object: T
    ): string | void;
    findLastKey<A, T: { [id: any]: A }>(
      predicate: OPredicate<A>
    ): (object: T) => string | void;
    findLastKey<A, T: { [id: any]: A }>(
      predicate: OPredicate<A>,
      object: T
    ): string | void;
    forIn(iteratee: OIteratee<*>): (object: Object) => Object;
    forIn(iteratee: OIteratee<*>, object: Object): Object;
    forInRight(iteratee: OIteratee<*>): (object: Object) => Object;
    forInRight(iteratee: OIteratee<*>, object: Object): Object;
    forOwn(iteratee: OIteratee<*>): (object: Object) => Object;
    forOwn(iteratee: OIteratee<*>, object: Object): Object;
    forOwnRight(iteratee: OIteratee<*>): (object: Object) => Object;
    forOwnRight(iteratee: OIteratee<*>, object: Object): Object;
    functions(object: Object): Array<string>;
    functionsIn(object: Object): Array<string>;
    get(path: Array<string> | string): (object: Object | Array<any>) => any;
    get(path: Array<string> | string, object: Object | Array<any>): any;
    prop(path: Array<string> | string): (object: Object | Array<any>) => any;
    prop(path: Array<string> | string, object: Object | Array<any>): any;
    path(path: Array<string> | string): (object: Object | Array<any>) => any;
    path(path: Array<string> | string, object: Object | Array<any>): any;
    getOr(
      defaultValue: any
    ): ((
      path: Array<string> | string
    ) => (object: Object | Array<any>) => any) &
      ((path: Array<string> | string, object: Object | Array<any>) => any);
    getOr(
      defaultValue: any,
      path: Array<string> | string
    ): (object: Object | Array<any>) => any;
    getOr(
      defaultValue: any,
      path: Array<string> | string,
      object: Object | Array<any>
    ): any;
    propOr(
      defaultValue: any
    ): ((
      path: Array<string> | string
    ) => (object: Object | Array<any>) => any) &
      ((path: Array<string> | string, object: Object | Array<any>) => any);
    propOr(
      defaultValue: any,
      path: Array<string> | string
    ): (object: Object | Array<any>) => any;
    propOr(
      defaultValue: any,
      path: Array<string> | string,
      object: Object | Array<any>
    ): any;
    pathOr(
      defaultValue: any
    ): ((
      path: Array<string> | string
    ) => (object: Object | Array<any>) => any) &
      ((path: Array<string> | string, object: Object | Array<any>) => any);
    pathOr(
      defaultValue: any,
      path: Array<string> | string
    ): (object: Object | Array<any>) => any;
    pathOr(
      defaultValue: any,
      path: Array<string> | string,
      object: Object | Array<any>
    ): any;
    has(path: Array<string> | string): (object: Object) => boolean;
    has(path: Array<string> | string, object: Object): boolean;
    hasIn(path: Array<string> | string): (object: Object) => boolean;
    hasIn(path: Array<string> | string, object: Object): boolean;
    invert(object: Object): Object;
    invertObj(object: Object): Object;
    invertBy(iteratee: Function): (object: Object) => Object;
    invertBy(iteratee: Function, object: Object): Object;
    invoke(path: Array<string> | string): (object: Object) => any;
    invoke(path: Array<string> | string, object: Object): any;
    invokeArgs(
      path: Array<string> | string
    ): ((object: Object) => (args: Array<any>) => any) &
      ((object: Object, args: Array<any>) => any);
    invokeArgs(
      path: Array<string> | string,
      object: Object
    ): (args: Array<any>) => any;
    invokeArgs(
      path: Array<string> | string,
      object: Object,
      args: Array<any>
    ): any;
    keys<K>(object: { [key: K]: any }): Array<K>;
    keys(object: Object): Array<string>;
    keysIn(object: Object): Array<string>;
    mapKeys(iteratee: OIteratee<*>): (object: Object) => Object;
    mapKeys(iteratee: OIteratee<*>, object: Object): Object;
    mapValues(iteratee: OIteratee<*>): (object: Object) => Object;
    mapValues(iteratee: OIteratee<*>, object: Object): Object;
    merge(object: Object): (source: Object) => Object;
    merge(object: Object, source: Object): Object;
    mergeAll(objects: Array<Object>): Object;
    mergeWith<T: Object, A: Object, B: Object>(
      customizer: (
        objValue: any,
        srcValue: any,
        key: string,
        object: T,
        source: A | B
      ) => any | void
    ): ((object: T) => (s1: A) => Object) & ((object: T, s1: A) => Object);
    mergeWith<T: Object, A: Object, B: Object>(
      customizer: (
        objValue: any,
        srcValue: any,
        key: string,
        object: T,
        source: A | B
      ) => any | void,
      object: T
    ): (s1: A) => Object;
    mergeWith<T: Object, A: Object, B: Object>(
      customizer: (
        objValue: any,
        srcValue: any,
        key: string,
        object: T,
        source: A | B
      ) => any | void,
      object: T,
      s1: A
    ): Object;
    mergeAllWith(
      customizer: (
        objValue: any,
        srcValue: any,
        key: string,
        object: Object,
        source: Object
      ) => any | void
    ): (objects: Array<Object>) => Object;
    mergeAllWith(
      customizer: (
        objValue: any,
        srcValue: any,
        key: string,
        object: Object,
        source: Object
      ) => any | void,
      objects: Array<Object>
    ): Object;
    omit(props: Array<string>): (object: Object) => Object;
    omit(props: Array<string>, object: Object): Object;
    omitAll(props: Array<string>): (object: Object) => Object;
    omitAll(props: Array<string>, object: Object): Object;
    omitBy<A, T: { [id: any]: A }>(
      predicate: OPredicate<A>
    ): (object: T) => Object;
    omitBy<A, T: { [id: any]: A }>(predicate: OPredicate<A>, object: T): Object;
    pick(props: Array<string>): (object: Object) => Object;
    pick(props: Array<string>, object: Object): Object;
    pickAll(props: Array<string>): (object: Object) => Object;
    pickAll(props: Array<string>, object: Object): Object;
    pickBy<A, T: { [id: any]: A }>(
      predicate: OPredicate<A>
    ): (object: T) => Object;
    pickBy<A, T: { [id: any]: A }>(predicate: OPredicate<A>, object: T): Object;
    result(path: Array<string> | string): (object: Object) => any;
    result(path: Array<string> | string, object: Object): any;
    set(
      path: Array<string> | string
    ): ((value: any) => (object: Object) => Object) &
      ((value: any, object: Object) => Object);
    set(path: Array<string> | string, value: any): (object: Object) => Object;
    set(path: Array<string> | string, value: any, object: Object): Object;
    assoc(
      path: Array<string> | string
    ): ((value: any) => (object: Object) => Object) &
      ((value: any, object: Object) => Object);
    assoc(path: Array<string> | string, value: any): (object: Object) => Object;
    assoc(path: Array<string> | string, value: any, object: Object): Object;
    assocPath(
      path: Array<string> | string
    ): ((value: any) => (object: Object) => Object) &
      ((value: any, object: Object) => Object);
    assocPath(
      path: Array<string> | string,
      value: any
    ): (object: Object) => Object;
    assocPath(path: Array<string> | string, value: any, object: Object): Object;
    setWith<T>(
      customizer: (nsValue: any, key: string, nsObject: T) => any
    ): ((
      path: Array<string> | string
    ) => ((value: any) => (object: T) => Object) &
      ((value: any, object: T) => Object)) &
      ((path: Array<string> | string, value: any) => (object: T) => Object) &
      ((path: Array<string> | string, value: any, object: T) => Object);
    setWith<T>(
      customizer: (nsValue: any, key: string, nsObject: T) => any,
      path: Array<string> | string
    ): ((value: any) => (object: T) => Object) &
      ((value: any, object: T) => Object);
    setWith<T>(
      customizer: (nsValue: any, key: string, nsObject: T) => any,
      path: Array<string> | string,
      value: any
    ): (object: T) => Object;
    setWith<T>(
      customizer: (nsValue: any, key: string, nsObject: T) => any,
      path: Array<string> | string,
      value: any,
      object: T
    ): Object;
    toPairs(object: Object | Array<*>): Array<[string, any]>;
    toPairsIn(object: Object): Array<[string, any]>;
    transform(
      iteratee: OIteratee<*>
    ): ((accumulator: any) => (collection: Object | Array<any>) => any) &
      ((accumulator: any, collection: Object | Array<any>) => any);
    transform(
      iteratee: OIteratee<*>,
      accumulator: any
    ): (collection: Object | Array<any>) => any;
    transform(
      iteratee: OIteratee<*>,
      accumulator: any,
      collection: Object | Array<any>
    ): any;
    unset(path: Array<string> | string): (object: Object) => boolean;
    unset(path: Array<string> | string, object: Object): boolean;
    dissoc(path: Array<string> | string): (object: Object) => boolean;
    dissoc(path: Array<string> | string, object: Object): boolean;
    dissocPath(path: Array<string> | string): (object: Object) => boolean;
    dissocPath(path: Array<string> | string, object: Object): boolean;
    update(
      path: string[] | string
    ): ((updater: Function) => (object: Object) => Object) &
      ((updater: Function, object: Object) => Object);
    update(
      path: string[] | string,
      updater: Function
    ): (object: Object) => Object;
    update(path: string[] | string, updater: Function, object: Object): Object;
    updateWith(
      customizer: Function
    ): ((
      path: string[] | string
    ) => ((updater: Function) => (object: Object) => Object) &
      ((updater: Function, object: Object) => Object)) &
      ((
        path: string[] | string,
        updater: Function
      ) => (object: Object) => Object) &
      ((path: string[] | string, updater: Function, object: Object) => Object);
    updateWith(
      customizer: Function,
      path: string[] | string
    ): ((updater: Function) => (object: Object) => Object) &
      ((updater: Function, object: Object) => Object);
    updateWith(
      customizer: Function,
      path: string[] | string,
      updater: Function
    ): (object: Object) => Object;
    updateWith(
      customizer: Function,
      path: string[] | string,
      updater: Function,
      object: Object
    ): Object;
    values(object: Object): Array<any>;
    valuesIn(object: Object): Array<any>;

    tap<T>(interceptor: (value: T) => any): (value: T) => T;
    tap<T>(interceptor: (value: T) => any, value: T): T;
    thru<T1, T2>(interceptor: (value: T1) => T2): (value: T1) => T2;
    thru<T1, T2>(interceptor: (value: T1) => T2, value: T1): T2;

    // String
    camelCase(string: string): string;
    capitalize(string: string): string;
    deburr(string: string): string;
    endsWith(target: string): (string: string) => boolean;
    endsWith(target: string, string: string): boolean;
    escape(string: string): string;
    escapeRegExp(string: string): string;
    kebabCase(string: string): string;
    lowerCase(string: string): string;
    lowerFirst(string: string): string;
    pad(length: number): (string: string) => string;
    pad(length: number, string: string): string;
    padChars(
      chars: string
    ): ((length: number) => (string: string) => string) &
      ((length: number, string: string) => string);
    padChars(chars: string, length: number): (string: string) => string;
    padChars(chars: string, length: number, string: string): string;
    padEnd(length: number): (string: string) => string;
    padEnd(length: number, string: string): string;
    padCharsEnd(
      chars: string
    ): ((length: number) => (string: string) => string) &
      ((length: number, string: string) => string);
    padCharsEnd(chars: string, length: number): (string: string) => string;
    padCharsEnd(chars: string, length: number, string: string): string;
    padStart(length: number): (string: string) => string;
    padStart(length: number, string: string): string;
    padCharsStart(
      chars: string
    ): ((length: number) => (string: string) => string) &
      ((length: number, string: string) => string);
    padCharsStart(chars: string, length: number): (string: string) => string;
    padCharsStart(chars: string, length: number, string: string): string;
    parseInt(radix: number): (string: string) => number;
    parseInt(radix: number, string: string): number;
    repeat(n: number): (string: string) => string;
    repeat(n: number, string: string): string;
    replace(
      pattern: RegExp | string
    ): ((
      replacement: ((string: string) => string) | string
    ) => (string: string) => string) &
      ((
        replacement: ((string: string) => string) | string,
        string: string
      ) => string);
    replace(
      pattern: RegExp | string,
      replacement: ((string: string) => string) | string
    ): (string: string) => string;
    replace(
      pattern: RegExp | string,
      replacement: ((string: string) => string) | string,
      string: string
    ): string;
    snakeCase(string: string): string;
    split(separator: RegExp | string): (string: string) => Array<string>;
    split(separator: RegExp | string, string: string): Array<string>;
    startCase(string: string): string;
    startsWith(target: string): (string: string) => boolean;
    startsWith(target: string, string: string): boolean;
    template(string: string): Function;
    toLower(string: string): string;
    toUpper(string: string): string;
    trim(string: string): string;
    trimChars(chars: string): (string: string) => string;
    trimChars(chars: string, string: string): string;
    trimEnd(string: string): string;
    trimCharsEnd(chars: string): (string: string) => string;
    trimCharsEnd(chars: string, string: string): string;
    trimStart(string: string): string;
    trimCharsStart(chars: string): (string: string) => string;
    trimCharsStart(chars: string, string: string): string;
    truncate(options: TruncateOptions): (string: string) => string;
    truncate(options: TruncateOptions, string: string): string;
    unescape(string: string): string;
    upperCase(string: string): string;
    upperFirst(string: string): string;
    words(string: string): Array<string>;

    // Util
    attempt(func: Function): any;
    bindAll(methodNames: Array<string>): (object: Object) => Object;
    bindAll(methodNames: Array<string>, object: Object): Object;
    cond(pairs: NestedArray<Function>): Function;
    constant<T>(value: T): () => T;
    always<T>(value: T): () => T;
    defaultTo<T1: string | boolean | Object, T2>(
      defaultValue: T2
    ): (value: T1) => T1;
    defaultTo<T1: string | boolean | Object, T2>(
      defaultValue: T2,
      value: T1
    ): T1;
    // NaN is a number instead of its own type, otherwise it would behave like null/void
    defaultTo<T1: number, T2>(defaultValue: T2): (value: T1) => T1 | T2;
    defaultTo<T1: number, T2>(defaultValue: T2, value: T1): T1 | T2;
    defaultTo<T1: void | null, T2>(defaultValue: T2): (value: T1) => T2;
    defaultTo<T1: void | null, T2>(defaultValue: T2, value: T1): T2;
    flow: $ComposeReverse;
    flow(funcs: Array<Function>): Function;
    pipe: $ComposeReverse;
    pipe(funcs: Array<Function>): Function;
    flowRight: $Compose;
    flowRight(funcs: Array<Function>): Function;
    compose: $Compose;
    compose(funcs: Array<Function>): Function;
    identity<T>(value: T): T;
    iteratee(func: any): Function;
    matches(source: Object): (object: Object) => boolean;
    matches(source: Object, object: Object): boolean;
    matchesProperty(path: Array<string> | string): (srcValue: any) => Function;
    matchesProperty(path: Array<string> | string, srcValue: any): Function;
    propEq(path: Array<string> | string): (srcValue: any) => Function;
    propEq(path: Array<string> | string, srcValue: any): Function;
    pathEq(path: Array<string> | string): (srcValue: any) => Function;
    pathEq(path: Array<string> | string, srcValue: any): Function;
    method(path: Array<string> | string): Function;
    methodOf(object: Object): Function;
    mixin<T: Function | Object>(
      object: T
    ): ((source: Object) => (options: { chain: boolean }) => T) &
      ((source: Object, options: { chain: boolean }) => T);
    mixin<T: Function | Object>(
      object: T,
      source: Object
    ): (options: { chain: boolean }) => T;
    mixin<T: Function | Object>(
      object: T,
      source: Object,
      options: { chain: boolean }
    ): T;
    noConflict(): Lodash;
    noop(...args: Array<mixed>): void;
    nthArg(n: number): Function;
    over(iteratees: Array<Function>): Function;
    juxt(iteratees: Array<Function>): Function;
    overEvery(predicates: Array<Function>): Function;
    allPass(predicates: Array<Function>): Function;
    overSome(predicates: Array<Function>): Function;
    anyPass(predicates: Array<Function>): Function;
    property(
      path: Array<string> | string
    ): (object: Object | Array<any>) => any;
    property(path: Array<string> | string, object: Object | Array<any>): any;
    propertyOf(object: Object): (path: Array<string> | string) => Function;
    propertyOf(object: Object, path: Array<string> | string): Function;
    range(start: number): (end: number) => Array<number>;
    range(start: number, end: number): Array<number>;
    rangeStep(
      step: number
    ): ((start: number) => (end: number) => Array<number>) &
      ((start: number, end: number) => Array<number>);
    rangeStep(step: number, start: number): (end: number) => Array<number>;
    rangeStep(step: number, start: number, end: number): Array<number>;
    rangeRight(start: number): (end: number) => Array<number>;
    rangeRight(start: number, end: number): Array<number>;
    rangeStepRight(
      step: number
    ): ((start: number) => (end: number) => Array<number>) &
      ((start: number, end: number) => Array<number>);
    rangeStepRight(step: number, start: number): (end: number) => Array<number>;
    rangeStepRight(step: number, start: number, end: number): Array<number>;
    runInContext(context: Object): Function;

    stubArray(): Array<*>;
    stubFalse(): false;
    F(): false;
    stubObject(): {};
    stubString(): "";
    stubTrue(): true;
    T(): true;
    times<T>(iteratee: (i: number) => T): (n: number) => Array<T>;
    times<T>(iteratee: (i: number) => T, n: number): Array<T>;
    toPath(value: any): Array<string>;
    uniqueId(prefix: string): string;

    __: any;
    placeholder: any;

    convert(options: {
      cap?: boolean,
      curry?: boolean,
      fixed?: boolean,
      immutable?: boolean,
      rearg?: boolean
    }): void;

    // Properties
    VERSION: string;
    templateSettings: TemplateSettings;
  }

  declare module.exports: Lodash;
}

declare module "lodash/chunk" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "chunk">;
}

declare module "lodash/compact" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "compact">;
}

declare module "lodash/concat" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "concat">;
}

declare module "lodash/difference" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "difference">;
}

declare module "lodash/differenceBy" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "differenceBy">;
}

declare module "lodash/differenceWith" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "differenceWith">;
}

declare module "lodash/drop" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "drop">;
}

declare module "lodash/dropRight" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "dropRight">;
}

declare module "lodash/dropRightWhile" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "dropRightWhile">;
}

declare module "lodash/dropWhile" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "dropWhile">;
}

declare module "lodash/fill" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "fill">;
}

declare module "lodash/findIndex" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "findIndex">;
}

declare module "lodash/findLastIndex" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "findLastIndex">;
}

declare module "lodash/first" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "first">;
}

declare module "lodash/flatten" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "flatten">;
}

declare module "lodash/flattenDeep" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "flattenDeep">;
}

declare module "lodash/flattenDepth" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "flattenDepth">;
}

declare module "lodash/fromPairs" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "fromPairs">;
}

declare module "lodash/head" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "head">;
}

declare module "lodash/indexOf" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "indexOf">;
}

declare module "lodash/initial" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "initial">;
}

declare module "lodash/intersection" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "intersection">;
}

declare module "lodash/intersectionBy" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "intersectionBy">;
}

declare module "lodash/intersectionWith" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "intersectionWith">;
}

declare module "lodash/join" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "join">;
}

declare module "lodash/last" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "last">;
}

declare module "lodash/lastIndexOf" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "lastIndexOf">;
}

declare module "lodash/nth" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "nth">;
}

declare module "lodash/pull" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "pull">;
}

declare module "lodash/pullAll" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "pullAll">;
}

declare module "lodash/pullAllBy" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "pullAllBy">;
}

declare module "lodash/pullAllWith" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "pullAllWith">;
}

declare module "lodash/pullAt" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "pullAt">;
}

declare module "lodash/remove" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "remove">;
}

declare module "lodash/reverse" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "reverse">;
}

declare module "lodash/slice" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "slice">;
}

declare module "lodash/sortedIndex" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "sortedIndex">;
}

declare module "lodash/sortedIndexBy" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "sortedIndexBy">;
}

declare module "lodash/sortedIndexOf" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "sortedIndexOf">;
}

declare module "lodash/sortedLastIndex" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "sortedLastIndex">;
}

declare module "lodash/sortedLastIndexBy" {
  declare module.exports: $PropertyType<
    $Exports<"lodash">,
    "sortedLastIndexBy"
  >;
}

declare module "lodash/sortedLastIndexOf" {
  declare module.exports: $PropertyType<
    $Exports<"lodash">,
    "sortedLastIndexOf"
  >;
}

declare module "lodash/sortedUniq" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "sortedUniq">;
}

declare module "lodash/sortedUniqBy" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "sortedUniqBy">;
}

declare module "lodash/tail" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "tail">;
}

declare module "lodash/take" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "take">;
}

declare module "lodash/takeRight" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "takeRight">;
}

declare module "lodash/takeRightWhile" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "takeRightWhile">;
}

declare module "lodash/takeWhile" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "takeWhile">;
}

declare module "lodash/union" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "union">;
}

declare module "lodash/unionBy" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "unionBy">;
}

declare module "lodash/unionWith" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "unionWith">;
}

declare module "lodash/uniq" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "uniq">;
}

declare module "lodash/uniqBy" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "uniqBy">;
}

declare module "lodash/uniqWith" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "uniqWith">;
}

declare module "lodash/unzip" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "unzip">;
}

declare module "lodash/unzipWith" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "unzipWith">;
}

declare module "lodash/without" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "without">;
}

declare module "lodash/xor" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "xor">;
}

declare module "lodash/xorBy" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "xorBy">;
}

declare module "lodash/xorWith" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "xorWith">;
}

declare module "lodash/zip" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "zip">;
}

declare module "lodash/zipObject" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "zipObject">;
}

declare module "lodash/zipObjectDeep" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "zipObjectDeep">;
}

declare module "lodash/zipWith" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "zipWith">;
}

declare module "lodash/countBy" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "countBy">;
}

declare module "lodash/each" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "each">;
}

declare module "lodash/eachRight" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "eachRight">;
}

declare module "lodash/every" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "every">;
}

declare module "lodash/filter" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "filter">;
}

declare module "lodash/find" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "find">;
}

declare module "lodash/findLast" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "findLast">;
}

declare module "lodash/flatMap" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "flatMap">;
}

declare module "lodash/flatMapDeep" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "flatMapDeep">;
}

declare module "lodash/flatMapDepth" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "flatMapDepth">;
}

declare module "lodash/forEach" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "forEach">;
}

declare module "lodash/forEachRight" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "forEachRight">;
}

declare module "lodash/groupBy" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "groupBy">;
}

declare module "lodash/includes" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "includes">;
}

declare module "lodash/invokeMap" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "invokeMap">;
}

declare module "lodash/keyBy" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "keyBy">;
}

declare module "lodash/map" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "map">;
}

declare module "lodash/orderBy" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "orderBy">;
}

declare module "lodash/partition" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "partition">;
}

declare module "lodash/reduce" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "reduce">;
}

declare module "lodash/reduceRight" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "reduceRight">;
}

declare module "lodash/reject" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "reject">;
}

declare module "lodash/sample" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "sample">;
}

declare module "lodash/sampleSize" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "sampleSize">;
}

declare module "lodash/shuffle" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "shuffle">;
}

declare module "lodash/size" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "size">;
}

declare module "lodash/some" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "some">;
}

declare module "lodash/sortBy" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "sortBy">;
}

declare module "lodash/now" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "now">;
}

declare module "lodash/after" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "after">;
}

declare module "lodash/ary" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "ary">;
}

declare module "lodash/before" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "before">;
}

declare module "lodash/bind" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "bind">;
}

declare module "lodash/bindKey" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "bindKey">;
}

declare module "lodash/curry" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "curry">;
}

declare module "lodash/curryRight" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "curryRight">;
}

declare module "lodash/debounce" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "debounce">;
}

declare module "lodash/defer" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "defer">;
}

declare module "lodash/delay" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "delay">;
}

declare module "lodash/flip" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "flip">;
}

declare module "lodash/memoize" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "memoize">;
}

declare module "lodash/negate" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "negate">;
}

declare module "lodash/once" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "once">;
}

declare module "lodash/overArgs" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "overArgs">;
}

declare module "lodash/partial" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "partial">;
}

declare module "lodash/partialRight" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "partialRight">;
}

declare module "lodash/rearg" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "rearg">;
}

declare module "lodash/rest" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "rest">;
}

declare module "lodash/spread" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "spread">;
}

declare module "lodash/throttle" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "throttle">;
}

declare module "lodash/unary" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "unary">;
}

declare module "lodash/wrap" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "wrap">;
}

declare module "lodash/castArray" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "castArray">;
}

declare module "lodash/clone" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "clone">;
}

declare module "lodash/cloneDeep" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "cloneDeep">;
}

declare module "lodash/cloneDeepWith" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "cloneDeepWith">;
}

declare module "lodash/cloneWith" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "cloneWith">;
}

declare module "lodash/conformsTo" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "conformsTo">;
}

declare module "lodash/eq" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "eq">;
}

declare module "lodash/gt" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "gt">;
}

declare module "lodash/gte" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "gte">;
}

declare module "lodash/isArguments" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "isArguments">;
}

declare module "lodash/isArray" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "isArray">;
}

declare module "lodash/isArrayBuffer" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "isArrayBuffer">;
}

declare module "lodash/isArrayLike" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "isArrayLike">;
}

declare module "lodash/isArrayLikeObject" {
  declare module.exports: $PropertyType<
    $Exports<"lodash">,
    "isArrayLikeObject"
  >;
}

declare module "lodash/isBoolean" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "isBoolean">;
}

declare module "lodash/isBuffer" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "isBuffer">;
}

declare module "lodash/isDate" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "isDate">;
}

declare module "lodash/isElement" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "isElement">;
}

declare module "lodash/isEmpty" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "isEmpty">;
}

declare module "lodash/isEqual" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "isEqual">;
}

declare module "lodash/isEqualWith" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "isEqualWith">;
}

declare module "lodash/isError" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "isError">;
}

declare module "lodash/isFinite" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "isFinite">;
}

declare module "lodash/isFunction" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "isFunction">;
}

declare module "lodash/isInteger" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "isInteger">;
}

declare module "lodash/isLength" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "isLength">;
}

declare module "lodash/isMap" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "isMap">;
}

declare module "lodash/isMatch" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "isMatch">;
}

declare module "lodash/isMatchWith" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "isMatchWith">;
}

declare module "lodash/isNaN" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "isNaN">;
}

declare module "lodash/isNative" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "isNative">;
}

declare module "lodash/isNil" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "isNil">;
}

declare module "lodash/isNull" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "isNull">;
}

declare module "lodash/isNumber" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "isNumber">;
}

declare module "lodash/isObject" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "isObject">;
}

declare module "lodash/isObjectLike" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "isObjectLike">;
}

declare module "lodash/isPlainObject" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "isPlainObject">;
}

declare module "lodash/isRegExp" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "isRegExp">;
}

declare module "lodash/isSafeInteger" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "isSafeInteger">;
}

declare module "lodash/isSet" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "isSet">;
}

declare module "lodash/isString" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "isString">;
}

declare module "lodash/isSymbol" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "isSymbol">;
}

declare module "lodash/isTypedArray" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "isTypedArray">;
}

declare module "lodash/isUndefined" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "isUndefined">;
}

declare module "lodash/isWeakMap" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "isWeakMap">;
}

declare module "lodash/isWeakSet" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "isWeakSet">;
}

declare module "lodash/lt" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "lt">;
}

declare module "lodash/lte" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "lte">;
}

declare module "lodash/toArray" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "toArray">;
}

declare module "lodash/toFinite" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "toFinite">;
}

declare module "lodash/toInteger" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "toInteger">;
}

declare module "lodash/toLength" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "toLength">;
}

declare module "lodash/toNumber" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "toNumber">;
}

declare module "lodash/toPlainObject" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "toPlainObject">;
}

declare module "lodash/toSafeInteger" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "toSafeInteger">;
}

declare module "lodash/toString" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "toString">;
}

declare module "lodash/add" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "add">;
}

declare module "lodash/ceil" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "ceil">;
}

declare module "lodash/divide" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "divide">;
}

declare module "lodash/floor" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "floor">;
}

declare module "lodash/max" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "max">;
}

declare module "lodash/maxBy" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "maxBy">;
}

declare module "lodash/mean" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "mean">;
}

declare module "lodash/meanBy" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "meanBy">;
}

declare module "lodash/min" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "min">;
}

declare module "lodash/minBy" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "minBy">;
}

declare module "lodash/multiply" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "multiply">;
}

declare module "lodash/round" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "round">;
}

declare module "lodash/subtract" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "subtract">;
}

declare module "lodash/sum" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "sum">;
}

declare module "lodash/sumBy" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "sumBy">;
}

declare module "lodash/clamp" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "clamp">;
}

declare module "lodash/inRange" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "inRange">;
}

declare module "lodash/random" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "random">;
}

declare module "lodash/assign" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "assign">;
}

declare module "lodash/assignIn" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "assignIn">;
}

declare module "lodash/assignInWith" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "assignInWith">;
}

declare module "lodash/assignWith" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "assignWith">;
}

declare module "lodash/at" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "at">;
}

declare module "lodash/create" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "create">;
}

declare module "lodash/defaults" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "defaults">;
}

declare module "lodash/defaultsDeep" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "defaultsDeep">;
}

declare module "lodash/entries" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "entries">;
}

declare module "lodash/entriesIn" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "entriesIn">;
}

declare module "lodash/extend" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "extend">;
}

declare module "lodash/extendWith" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "extendWith">;
}

declare module "lodash/findKey" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "findKey">;
}

declare module "lodash/findLastKey" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "findLastKey">;
}

declare module "lodash/forIn" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "forIn">;
}

declare module "lodash/forInRight" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "forInRight">;
}

declare module "lodash/forOwn" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "forOwn">;
}

declare module "lodash/forOwnRight" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "forOwnRight">;
}

declare module "lodash/functions" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "functions">;
}

declare module "lodash/functionsIn" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "functionsIn">;
}

declare module "lodash/get" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "get">;
}

declare module "lodash/has" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "has">;
}

declare module "lodash/hasIn" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "hasIn">;
}

declare module "lodash/invert" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "invert">;
}

declare module "lodash/invertBy" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "invertBy">;
}

declare module "lodash/invoke" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "invoke">;
}

declare module "lodash/keys" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "keys">;
}

declare module "lodash/keysIn" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "keysIn">;
}

declare module "lodash/mapKeys" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "mapKeys">;
}

declare module "lodash/mapValues" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "mapValues">;
}

declare module "lodash/merge" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "merge">;
}

declare module "lodash/mergeWith" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "mergeWith">;
}

declare module "lodash/omit" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "omit">;
}

declare module "lodash/omitBy" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "omitBy">;
}

declare module "lodash/pick" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "pick">;
}

declare module "lodash/pickBy" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "pickBy">;
}

declare module "lodash/result" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "result">;
}

declare module "lodash/set" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "set">;
}

declare module "lodash/setWith" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "setWith">;
}

declare module "lodash/toPairs" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "toPairs">;
}

declare module "lodash/toPairsIn" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "toPairsIn">;
}

declare module "lodash/transform" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "transform">;
}

declare module "lodash/unset" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "unset">;
}

declare module "lodash/update" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "update">;
}

declare module "lodash/updateWith" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "updateWith">;
}

declare module "lodash/values" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "values">;
}

declare module "lodash/valuesIn" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "valuesIn">;
}

declare module "lodash/chain" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "chain">;
}

declare module "lodash/tap" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "tap">;
}

declare module "lodash/thru" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "thru">;
}

declare module "lodash/camelCase" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "camelCase">;
}

declare module "lodash/capitalize" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "capitalize">;
}

declare module "lodash/deburr" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "deburr">;
}

declare module "lodash/endsWith" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "endsWith">;
}

declare module "lodash/escape" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "escape">;
}

declare module "lodash/escapeRegExp" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "escapeRegExp">;
}

declare module "lodash/kebabCase" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "kebabCase">;
}

declare module "lodash/lowerCase" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "lowerCase">;
}

declare module "lodash/lowerFirst" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "lowerFirst">;
}

declare module "lodash/pad" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "pad">;
}

declare module "lodash/padEnd" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "padEnd">;
}

declare module "lodash/padStart" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "padStart">;
}

declare module "lodash/parseInt" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "parseInt">;
}

declare module "lodash/repeat" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "repeat">;
}

declare module "lodash/replace" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "replace">;
}

declare module "lodash/snakeCase" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "snakeCase">;
}

declare module "lodash/split" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "split">;
}

declare module "lodash/startCase" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "startCase">;
}

declare module "lodash/startsWith" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "startsWith">;
}

declare module "lodash/template" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "template">;
}

declare module "lodash/toLower" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "toLower">;
}

declare module "lodash/toUpper" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "toUpper">;
}

declare module "lodash/trim" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "trim">;
}

declare module "lodash/trimEnd" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "trimEnd">;
}

declare module "lodash/trimStart" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "trimStart">;
}

declare module "lodash/truncate" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "truncate">;
}

declare module "lodash/unescape" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "unescape">;
}

declare module "lodash/upperCase" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "upperCase">;
}

declare module "lodash/upperFirst" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "upperFirst">;
}

declare module "lodash/words" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "words">;
}

declare module "lodash/attempt" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "attempt">;
}

declare module "lodash/bindAll" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "bindAll">;
}

declare module "lodash/cond" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "cond">;
}

declare module "lodash/conforms" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "conforms">;
}

declare module "lodash/constant" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "constant">;
}

declare module "lodash/defaultTo" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "defaultTo">;
}

declare module "lodash/flow" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "flow">;
}

declare module "lodash/flowRight" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "flowRight">;
}

declare module "lodash/identity" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "identity">;
}

declare module "lodash/iteratee" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "iteratee">;
}

declare module "lodash/matches" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "matches">;
}

declare module "lodash/matchesProperty" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "matchesProperty">;
}

declare module "lodash/method" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "method">;
}

declare module "lodash/methodOf" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "methodOf">;
}

declare module "lodash/mixin" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "mixin">;
}

declare module "lodash/noConflict" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "noConflict">;
}

declare module "lodash/noop" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "noop">;
}

declare module "lodash/nthArg" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "nthArg">;
}

declare module "lodash/over" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "over">;
}

declare module "lodash/overEvery" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "overEvery">;
}

declare module "lodash/overSome" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "overSome">;
}

declare module "lodash/property" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "property">;
}

declare module "lodash/propertyOf" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "propertyOf">;
}

declare module "lodash/range" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "range">;
}

declare module "lodash/rangeRight" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "rangeRight">;
}

declare module "lodash/runInContext" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "runInContext">;
}

declare module "lodash/stubArray" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "stubArray">;
}

declare module "lodash/stubFalse" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "stubFalse">;
}

declare module "lodash/stubObject" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "stubObject">;
}

declare module "lodash/stubString" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "stubString">;
}

declare module "lodash/stubTrue" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "stubTrue">;
}

declare module "lodash/times" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "times">;
}

declare module "lodash/toPath" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "toPath">;
}

declare module "lodash/uniqueId" {
  declare module.exports: $PropertyType<$Exports<"lodash">, "uniqueId">;
}
// flow-typed signature: de535bf82f2186287df01b1d05ef7355
// flow-typed version: <<STUB>>/openssl-wrapper_v0.3.4/flow_v0.69.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'openssl-wrapper'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'openssl-wrapper' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'openssl-wrapper/lib/index' {
  declare module.exports: any;
}

declare module 'openssl-wrapper/src/index' {
  declare module.exports: any;
}

declare module 'openssl-wrapper/test/index.spec' {
  declare module.exports: any;
}

// Filename aliases
declare module 'openssl-wrapper/lib/index.js' {
  declare module.exports: $Exports<'openssl-wrapper/lib/index'>;
}
declare module 'openssl-wrapper/src/index.js' {
  declare module.exports: $Exports<'openssl-wrapper/src/index'>;
}
declare module 'openssl-wrapper/test/index.spec.js' {
  declare module.exports: $Exports<'openssl-wrapper/test/index.spec'>;
}
// flow-typed signature: 41ed726d42e8bdc8e940fef3395a9649
// flow-typed version: <<STUB>>/polished_v^1.1.1/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'polished'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'polished' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'polished/dist/polished.es' {
  declare module.exports: any;
}

declare module 'polished/dist/polished' {
  declare module.exports: any;
}

declare module 'polished/dist/polished.min' {
  declare module.exports: any;
}

declare module 'polished/docs/assets/anchor' {
  declare module.exports: any;
}

declare module 'polished/docs/assets/docs' {
  declare module.exports: any;
}

declare module 'polished/docs/assets/highlight.pack' {
  declare module.exports: any;
}

declare module 'polished/docs/assets/polished' {
  declare module.exports: any;
}

declare module 'polished/docs/assets/script' {
  declare module.exports: any;
}

declare module 'polished/lib/color/adjustHue' {
  declare module.exports: any;
}

declare module 'polished/lib/color/complement' {
  declare module.exports: any;
}

declare module 'polished/lib/color/darken' {
  declare module.exports: any;
}

declare module 'polished/lib/color/desaturate' {
  declare module.exports: any;
}

declare module 'polished/lib/color/grayscale' {
  declare module.exports: any;
}

declare module 'polished/lib/color/hsl' {
  declare module.exports: any;
}

declare module 'polished/lib/color/hsla' {
  declare module.exports: any;
}

declare module 'polished/lib/color/invert' {
  declare module.exports: any;
}

declare module 'polished/lib/color/lighten' {
  declare module.exports: any;
}

declare module 'polished/lib/color/mix' {
  declare module.exports: any;
}

declare module 'polished/lib/color/opacify' {
  declare module.exports: any;
}

declare module 'polished/lib/color/parseToHsl' {
  declare module.exports: any;
}

declare module 'polished/lib/color/parseToRgb' {
  declare module.exports: any;
}

declare module 'polished/lib/color/readableColor' {
  declare module.exports: any;
}

declare module 'polished/lib/color/rgb' {
  declare module.exports: any;
}

declare module 'polished/lib/color/rgba' {
  declare module.exports: any;
}

declare module 'polished/lib/color/saturate' {
  declare module.exports: any;
}

declare module 'polished/lib/color/setHue' {
  declare module.exports: any;
}

declare module 'polished/lib/color/setLightness' {
  declare module.exports: any;
}

declare module 'polished/lib/color/setSaturation' {
  declare module.exports: any;
}

declare module 'polished/lib/color/shade' {
  declare module.exports: any;
}

declare module 'polished/lib/color/tint' {
  declare module.exports: any;
}

declare module 'polished/lib/color/toColorString' {
  declare module.exports: any;
}

declare module 'polished/lib/color/transparentize' {
  declare module.exports: any;
}

declare module 'polished/lib/helpers/directionalProperty' {
  declare module.exports: any;
}

declare module 'polished/lib/helpers/em' {
  declare module.exports: any;
}

declare module 'polished/lib/helpers/modularScale' {
  declare module.exports: any;
}

declare module 'polished/lib/helpers/rem' {
  declare module.exports: any;
}

declare module 'polished/lib/helpers/stripUnit' {
  declare module.exports: any;
}

declare module 'polished/lib/index' {
  declare module.exports: any;
}

declare module 'polished/lib/internalHelpers/_capitalizeString' {
  declare module.exports: any;
}

declare module 'polished/lib/internalHelpers/_curry' {
  declare module.exports: any;
}

declare module 'polished/lib/internalHelpers/_endsWith' {
  declare module.exports: any;
}

declare module 'polished/lib/internalHelpers/_guard' {
  declare module.exports: any;
}

declare module 'polished/lib/internalHelpers/_hslToHex' {
  declare module.exports: any;
}

declare module 'polished/lib/internalHelpers/_hslToRgb' {
  declare module.exports: any;
}

declare module 'polished/lib/internalHelpers/_isValidDimensionValue' {
  declare module.exports: any;
}

declare module 'polished/lib/internalHelpers/_nameToHex' {
  declare module.exports: any;
}

declare module 'polished/lib/internalHelpers/_numberToHex' {
  declare module.exports: any;
}

declare module 'polished/lib/internalHelpers/_polishedLogs' {
  declare module.exports: any;
}

declare module 'polished/lib/internalHelpers/_pxto' {
  declare module.exports: any;
}

declare module 'polished/lib/internalHelpers/_reduceHexValue' {
  declare module.exports: any;
}

declare module 'polished/lib/internalHelpers/_rgbToHsl' {
  declare module.exports: any;
}

declare module 'polished/lib/internalHelpers/_statefulSelectors' {
  declare module.exports: any;
}

declare module 'polished/lib/mixins/clearFix' {
  declare module.exports: any;
}

declare module 'polished/lib/mixins/ellipsis' {
  declare module.exports: any;
}

declare module 'polished/lib/mixins/fontFace' {
  declare module.exports: any;
}

declare module 'polished/lib/mixins/hideText' {
  declare module.exports: any;
}

declare module 'polished/lib/mixins/hiDPI' {
  declare module.exports: any;
}

declare module 'polished/lib/mixins/normalize' {
  declare module.exports: any;
}

declare module 'polished/lib/mixins/placeholder' {
  declare module.exports: any;
}

declare module 'polished/lib/mixins/radialGradient' {
  declare module.exports: any;
}

declare module 'polished/lib/mixins/retinaImage' {
  declare module.exports: any;
}

declare module 'polished/lib/mixins/selection' {
  declare module.exports: any;
}

declare module 'polished/lib/mixins/timingFunctions' {
  declare module.exports: any;
}

declare module 'polished/lib/mixins/triangle' {
  declare module.exports: any;
}

declare module 'polished/lib/mixins/wordWrap' {
  declare module.exports: any;
}

declare module 'polished/lib/shorthands/animation' {
  declare module.exports: any;
}

declare module 'polished/lib/shorthands/backgroundImages' {
  declare module.exports: any;
}

declare module 'polished/lib/shorthands/backgrounds' {
  declare module.exports: any;
}

declare module 'polished/lib/shorthands/borderColor' {
  declare module.exports: any;
}

declare module 'polished/lib/shorthands/borderRadius' {
  declare module.exports: any;
}

declare module 'polished/lib/shorthands/borderStyle' {
  declare module.exports: any;
}

declare module 'polished/lib/shorthands/borderWidth' {
  declare module.exports: any;
}

declare module 'polished/lib/shorthands/buttons' {
  declare module.exports: any;
}

declare module 'polished/lib/shorthands/margin' {
  declare module.exports: any;
}

declare module 'polished/lib/shorthands/padding' {
  declare module.exports: any;
}

declare module 'polished/lib/shorthands/position' {
  declare module.exports: any;
}

declare module 'polished/lib/shorthands/size' {
  declare module.exports: any;
}

declare module 'polished/lib/shorthands/textInputs' {
  declare module.exports: any;
}

declare module 'polished/lib/shorthands/transitions' {
  declare module.exports: any;
}

declare module 'polished/lib/types/color' {
  declare module.exports: any;
}

// Filename aliases
declare module 'polished/dist/polished.es.js' {
  declare module.exports: $Exports<'polished/dist/polished.es'>;
}
declare module 'polished/dist/polished.js' {
  declare module.exports: $Exports<'polished/dist/polished'>;
}
declare module 'polished/dist/polished.min.js' {
  declare module.exports: $Exports<'polished/dist/polished.min'>;
}
declare module 'polished/docs/assets/anchor.js' {
  declare module.exports: $Exports<'polished/docs/assets/anchor'>;
}
declare module 'polished/docs/assets/docs.js' {
  declare module.exports: $Exports<'polished/docs/assets/docs'>;
}
declare module 'polished/docs/assets/highlight.pack.js' {
  declare module.exports: $Exports<'polished/docs/assets/highlight.pack'>;
}
declare module 'polished/docs/assets/polished.js' {
  declare module.exports: $Exports<'polished/docs/assets/polished'>;
}
declare module 'polished/docs/assets/script.js' {
  declare module.exports: $Exports<'polished/docs/assets/script'>;
}
declare module 'polished/lib/color/adjustHue.js' {
  declare module.exports: $Exports<'polished/lib/color/adjustHue'>;
}
declare module 'polished/lib/color/complement.js' {
  declare module.exports: $Exports<'polished/lib/color/complement'>;
}
declare module 'polished/lib/color/darken.js' {
  declare module.exports: $Exports<'polished/lib/color/darken'>;
}
declare module 'polished/lib/color/desaturate.js' {
  declare module.exports: $Exports<'polished/lib/color/desaturate'>;
}
declare module 'polished/lib/color/grayscale.js' {
  declare module.exports: $Exports<'polished/lib/color/grayscale'>;
}
declare module 'polished/lib/color/hsl.js' {
  declare module.exports: $Exports<'polished/lib/color/hsl'>;
}
declare module 'polished/lib/color/hsla.js' {
  declare module.exports: $Exports<'polished/lib/color/hsla'>;
}
declare module 'polished/lib/color/invert.js' {
  declare module.exports: $Exports<'polished/lib/color/invert'>;
}
declare module 'polished/lib/color/lighten.js' {
  declare module.exports: $Exports<'polished/lib/color/lighten'>;
}
declare module 'polished/lib/color/mix.js' {
  declare module.exports: $Exports<'polished/lib/color/mix'>;
}
declare module 'polished/lib/color/opacify.js' {
  declare module.exports: $Exports<'polished/lib/color/opacify'>;
}
declare module 'polished/lib/color/parseToHsl.js' {
  declare module.exports: $Exports<'polished/lib/color/parseToHsl'>;
}
declare module 'polished/lib/color/parseToRgb.js' {
  declare module.exports: $Exports<'polished/lib/color/parseToRgb'>;
}
declare module 'polished/lib/color/readableColor.js' {
  declare module.exports: $Exports<'polished/lib/color/readableColor'>;
}
declare module 'polished/lib/color/rgb.js' {
  declare module.exports: $Exports<'polished/lib/color/rgb'>;
}
declare module 'polished/lib/color/rgba.js' {
  declare module.exports: $Exports<'polished/lib/color/rgba'>;
}
declare module 'polished/lib/color/saturate.js' {
  declare module.exports: $Exports<'polished/lib/color/saturate'>;
}
declare module 'polished/lib/color/setHue.js' {
  declare module.exports: $Exports<'polished/lib/color/setHue'>;
}
declare module 'polished/lib/color/setLightness.js' {
  declare module.exports: $Exports<'polished/lib/color/setLightness'>;
}
declare module 'polished/lib/color/setSaturation.js' {
  declare module.exports: $Exports<'polished/lib/color/setSaturation'>;
}
declare module 'polished/lib/color/shade.js' {
  declare module.exports: $Exports<'polished/lib/color/shade'>;
}
declare module 'polished/lib/color/tint.js' {
  declare module.exports: $Exports<'polished/lib/color/tint'>;
}
declare module 'polished/lib/color/toColorString.js' {
  declare module.exports: $Exports<'polished/lib/color/toColorString'>;
}
declare module 'polished/lib/color/transparentize.js' {
  declare module.exports: $Exports<'polished/lib/color/transparentize'>;
}
declare module 'polished/lib/helpers/directionalProperty.js' {
  declare module.exports: $Exports<'polished/lib/helpers/directionalProperty'>;
}
declare module 'polished/lib/helpers/em.js' {
  declare module.exports: $Exports<'polished/lib/helpers/em'>;
}
declare module 'polished/lib/helpers/modularScale.js' {
  declare module.exports: $Exports<'polished/lib/helpers/modularScale'>;
}
declare module 'polished/lib/helpers/rem.js' {
  declare module.exports: $Exports<'polished/lib/helpers/rem'>;
}
declare module 'polished/lib/helpers/stripUnit.js' {
  declare module.exports: $Exports<'polished/lib/helpers/stripUnit'>;
}
declare module 'polished/lib/index.js' {
  declare module.exports: $Exports<'polished/lib/index'>;
}
declare module 'polished/lib/internalHelpers/_capitalizeString.js' {
  declare module.exports: $Exports<'polished/lib/internalHelpers/_capitalizeString'>;
}
declare module 'polished/lib/internalHelpers/_curry.js' {
  declare module.exports: $Exports<'polished/lib/internalHelpers/_curry'>;
}
declare module 'polished/lib/internalHelpers/_endsWith.js' {
  declare module.exports: $Exports<'polished/lib/internalHelpers/_endsWith'>;
}
declare module 'polished/lib/internalHelpers/_guard.js' {
  declare module.exports: $Exports<'polished/lib/internalHelpers/_guard'>;
}
declare module 'polished/lib/internalHelpers/_hslToHex.js' {
  declare module.exports: $Exports<'polished/lib/internalHelpers/_hslToHex'>;
}
declare module 'polished/lib/internalHelpers/_hslToRgb.js' {
  declare module.exports: $Exports<'polished/lib/internalHelpers/_hslToRgb'>;
}
declare module 'polished/lib/internalHelpers/_isValidDimensionValue.js' {
  declare module.exports: $Exports<'polished/lib/internalHelpers/_isValidDimensionValue'>;
}
declare module 'polished/lib/internalHelpers/_nameToHex.js' {
  declare module.exports: $Exports<'polished/lib/internalHelpers/_nameToHex'>;
}
declare module 'polished/lib/internalHelpers/_numberToHex.js' {
  declare module.exports: $Exports<'polished/lib/internalHelpers/_numberToHex'>;
}
declare module 'polished/lib/internalHelpers/_polishedLogs.js' {
  declare module.exports: $Exports<'polished/lib/internalHelpers/_polishedLogs'>;
}
declare module 'polished/lib/internalHelpers/_pxto.js' {
  declare module.exports: $Exports<'polished/lib/internalHelpers/_pxto'>;
}
declare module 'polished/lib/internalHelpers/_reduceHexValue.js' {
  declare module.exports: $Exports<'polished/lib/internalHelpers/_reduceHexValue'>;
}
declare module 'polished/lib/internalHelpers/_rgbToHsl.js' {
  declare module.exports: $Exports<'polished/lib/internalHelpers/_rgbToHsl'>;
}
declare module 'polished/lib/internalHelpers/_statefulSelectors.js' {
  declare module.exports: $Exports<'polished/lib/internalHelpers/_statefulSelectors'>;
}
declare module 'polished/lib/mixins/clearFix.js' {
  declare module.exports: $Exports<'polished/lib/mixins/clearFix'>;
}
declare module 'polished/lib/mixins/ellipsis.js' {
  declare module.exports: $Exports<'polished/lib/mixins/ellipsis'>;
}
declare module 'polished/lib/mixins/fontFace.js' {
  declare module.exports: $Exports<'polished/lib/mixins/fontFace'>;
}
declare module 'polished/lib/mixins/hideText.js' {
  declare module.exports: $Exports<'polished/lib/mixins/hideText'>;
}
declare module 'polished/lib/mixins/hiDPI.js' {
  declare module.exports: $Exports<'polished/lib/mixins/hiDPI'>;
}
declare module 'polished/lib/mixins/normalize.js' {
  declare module.exports: $Exports<'polished/lib/mixins/normalize'>;
}
declare module 'polished/lib/mixins/placeholder.js' {
  declare module.exports: $Exports<'polished/lib/mixins/placeholder'>;
}
declare module 'polished/lib/mixins/radialGradient.js' {
  declare module.exports: $Exports<'polished/lib/mixins/radialGradient'>;
}
declare module 'polished/lib/mixins/retinaImage.js' {
  declare module.exports: $Exports<'polished/lib/mixins/retinaImage'>;
}
declare module 'polished/lib/mixins/selection.js' {
  declare module.exports: $Exports<'polished/lib/mixins/selection'>;
}
declare module 'polished/lib/mixins/timingFunctions.js' {
  declare module.exports: $Exports<'polished/lib/mixins/timingFunctions'>;
}
declare module 'polished/lib/mixins/triangle.js' {
  declare module.exports: $Exports<'polished/lib/mixins/triangle'>;
}
declare module 'polished/lib/mixins/wordWrap.js' {
  declare module.exports: $Exports<'polished/lib/mixins/wordWrap'>;
}
declare module 'polished/lib/shorthands/animation.js' {
  declare module.exports: $Exports<'polished/lib/shorthands/animation'>;
}
declare module 'polished/lib/shorthands/backgroundImages.js' {
  declare module.exports: $Exports<'polished/lib/shorthands/backgroundImages'>;
}
declare module 'polished/lib/shorthands/backgrounds.js' {
  declare module.exports: $Exports<'polished/lib/shorthands/backgrounds'>;
}
declare module 'polished/lib/shorthands/borderColor.js' {
  declare module.exports: $Exports<'polished/lib/shorthands/borderColor'>;
}
declare module 'polished/lib/shorthands/borderRadius.js' {
  declare module.exports: $Exports<'polished/lib/shorthands/borderRadius'>;
}
declare module 'polished/lib/shorthands/borderStyle.js' {
  declare module.exports: $Exports<'polished/lib/shorthands/borderStyle'>;
}
declare module 'polished/lib/shorthands/borderWidth.js' {
  declare module.exports: $Exports<'polished/lib/shorthands/borderWidth'>;
}
declare module 'polished/lib/shorthands/buttons.js' {
  declare module.exports: $Exports<'polished/lib/shorthands/buttons'>;
}
declare module 'polished/lib/shorthands/margin.js' {
  declare module.exports: $Exports<'polished/lib/shorthands/margin'>;
}
declare module 'polished/lib/shorthands/padding.js' {
  declare module.exports: $Exports<'polished/lib/shorthands/padding'>;
}
declare module 'polished/lib/shorthands/position.js' {
  declare module.exports: $Exports<'polished/lib/shorthands/position'>;
}
declare module 'polished/lib/shorthands/size.js' {
  declare module.exports: $Exports<'polished/lib/shorthands/size'>;
}
declare module 'polished/lib/shorthands/textInputs.js' {
  declare module.exports: $Exports<'polished/lib/shorthands/textInputs'>;
}
declare module 'polished/lib/shorthands/transitions.js' {
  declare module.exports: $Exports<'polished/lib/shorthands/transitions'>;
}
declare module 'polished/lib/types/color.js' {
  declare module.exports: $Exports<'polished/lib/types/color'>;
}
// flow-typed signature: 8bbe6221bd08557b01d489734074fd02
// flow-typed version: <<STUB>>/prettier_v1.5.0/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'prettier'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'prettier' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'prettier/bin/prettier' {
  declare module.exports: any;
}

declare module 'prettier/parser-babylon' {
  declare module.exports: any;
}

declare module 'prettier/parser-flow' {
  declare module.exports: any;
}

declare module 'prettier/parser-graphql' {
  declare module.exports: any;
}

declare module 'prettier/parser-json' {
  declare module.exports: any;
}

declare module 'prettier/parser-parse5' {
  declare module.exports: any;
}

declare module 'prettier/parser-postcss' {
  declare module.exports: any;
}

declare module 'prettier/parser-typescript' {
  declare module.exports: any;
}

// Filename aliases
declare module 'prettier/bin/prettier.js' {
  declare module.exports: $Exports<'prettier/bin/prettier'>;
}
declare module 'prettier/index' {
  declare module.exports: $Exports<'prettier'>;
}
declare module 'prettier/index.js' {
  declare module.exports: $Exports<'prettier'>;
}
declare module 'prettier/parser-babylon.js' {
  declare module.exports: $Exports<'prettier/parser-babylon'>;
}
declare module 'prettier/parser-flow.js' {
  declare module.exports: $Exports<'prettier/parser-flow'>;
}
declare module 'prettier/parser-graphql.js' {
  declare module.exports: $Exports<'prettier/parser-graphql'>;
}
declare module 'prettier/parser-json.js' {
  declare module.exports: $Exports<'prettier/parser-json'>;
}
declare module 'prettier/parser-parse5.js' {
  declare module.exports: $Exports<'prettier/parser-parse5'>;
}
declare module 'prettier/parser-postcss.js' {
  declare module.exports: $Exports<'prettier/parser-postcss'>;
}
declare module 'prettier/parser-typescript.js' {
  declare module.exports: $Exports<'prettier/parser-typescript'>;
}
// flow-typed signature: 3eaa1f24c7397b78a7481992d2cddcb2
// flow-typed version: a1a20d4928/prop-types_v15.x.x/flow_>=v0.41.x

type $npm$propTypes$ReactPropsCheckType = (
  props: any,
  propName: string,
  componentName: string,
  href?: string) => ?Error;

declare module 'prop-types' {
  declare var array: React$PropType$Primitive<Array<any>>;
  declare var bool: React$PropType$Primitive<boolean>;
  declare var func: React$PropType$Primitive<Function>;
  declare var number: React$PropType$Primitive<number>;
  declare var object: React$PropType$Primitive<Object>;
  declare var string: React$PropType$Primitive<string>;
  declare var any: React$PropType$Primitive<any>;
  declare var arrayOf: React$PropType$ArrayOf;
  declare var element: React$PropType$Primitive<any>; /* TODO */
  declare var instanceOf: React$PropType$InstanceOf;
  declare var node: React$PropType$Primitive<any>; /* TODO */
  declare var objectOf: React$PropType$ObjectOf;
  declare var oneOf: React$PropType$OneOf;
  declare var oneOfType: React$PropType$OneOfType;
  declare var shape: React$PropType$Shape;

  declare function checkPropTypes<V>(
    propTypes: $Subtype<{[_: $Keys<V>]: $npm$propTypes$ReactPropsCheckType}>,
    values: V,
    location: string,
    componentName: string,
    getStack: ?(() => ?string)
  ) : void;
}
// flow-typed signature: d3fd33836d3ae586d973d7728260a311
// flow-typed version: <<STUB>>/react-color_v^2.11.7/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'react-color'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'react-color' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'react-color/examples/Button' {
  declare module.exports: any;
}

declare module 'react-color/examples/index' {
  declare module.exports: any;
}

declare module 'react-color/examples/Sketch' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/alpha/Alpha' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/alpha/AlphaPointer' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/alpha/spec' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/block/Block' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/block/BlockSwatches' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/block/spec' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/chrome/Chrome' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/chrome/ChromeFields' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/chrome/ChromePointer' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/chrome/ChromePointerCircle' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/chrome/spec' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/circle/Circle' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/circle/CircleSwatch' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/circle/spec' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/common/Alpha' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/common/Checkboard' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/common/ColorWrap' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/common/EditableInput' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/common/Hue' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/common/index' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/common/Saturation' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/common/spec' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/common/Swatch' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/compact/Compact' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/compact/CompactColor' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/compact/CompactFields' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/compact/spec' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/github/Github' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/github/GithubSwatch' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/github/spec' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/hue/Hue' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/hue/HuePointer' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/hue/spec' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/material/Material' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/material/spec' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/photoshop/Photoshop' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/photoshop/PhotoshopButton' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/photoshop/PhotoshopFields' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/photoshop/PhotoshopPointer' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/photoshop/PhotoshopPointerCircle' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/photoshop/PhotoshopPreviews' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/photoshop/spec' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/sketch/Sketch' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/sketch/SketchFields' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/sketch/SketchPresetColors' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/sketch/spec' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/slider/Slider' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/slider/SliderPointer' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/slider/SliderSwatch' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/slider/SliderSwatches' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/slider/spec' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/swatches/spec' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/swatches/Swatches' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/swatches/SwatchesColor' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/swatches/SwatchesGroup' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/twitter/spec' {
  declare module.exports: any;
}

declare module 'react-color/lib/components/twitter/Twitter' {
  declare module.exports: any;
}

declare module 'react-color/lib/helpers/alpha' {
  declare module.exports: any;
}

declare module 'react-color/lib/helpers/checkboard' {
  declare module.exports: any;
}

declare module 'react-color/lib/helpers/color' {
  declare module.exports: any;
}

declare module 'react-color/lib/helpers/hue' {
  declare module.exports: any;
}

declare module 'react-color/lib/helpers/interaction' {
  declare module.exports: any;
}

declare module 'react-color/lib/helpers/saturation' {
  declare module.exports: any;
}

declare module 'react-color/lib/helpers/spec' {
  declare module.exports: any;
}

declare module 'react-color/lib/index' {
  declare module.exports: any;
}

declare module 'react-color/modules/highlight' {
  declare module.exports: any;
}

declare module 'react-color/modules/highlight.js/highlight' {
  declare module.exports: any;
}

declare module 'react-color/modules/highlight.js/index' {
  declare module.exports: any;
}

declare module 'react-color/modules/highlight.js/languages/javascript' {
  declare module.exports: any;
}

declare module 'react-color/modules/react-basic-layout/index' {
  declare module.exports: any;
}

declare module 'react-color/modules/react-basic-layout/lib/components/Container' {
  declare module.exports: any;
}

declare module 'react-color/modules/react-basic-layout/lib/components/Grid' {
  declare module.exports: any;
}

declare module 'react-color/modules/react-docs/index' {
  declare module.exports: any;
}

declare module 'react-color/modules/react-docs/lib/components/Code' {
  declare module.exports: any;
}

declare module 'react-color/modules/react-docs/lib/components/Docs' {
  declare module.exports: any;
}

declare module 'react-color/modules/react-docs/lib/components/Markdown' {
  declare module.exports: any;
}

declare module 'react-color/modules/react-docs/lib/components/MarkdownTitle' {
  declare module.exports: any;
}

declare module 'react-color/modules/react-docs/lib/components/Sidebar' {
  declare module.exports: any;
}

declare module 'react-color/modules/react-docs/lib/components/SidebarItem' {
  declare module.exports: any;
}

declare module 'react-color/modules/react-docs/lib/helpers/markdown' {
  declare module.exports: any;
}

declare module 'react-color/modules/react-material-design/index' {
  declare module.exports: any;
}

declare module 'react-color/modules/react-material-design/lib/components/Link' {
  declare module.exports: any;
}

declare module 'react-color/modules/react-material-design/lib/components/Raised' {
  declare module.exports: any;
}

declare module 'react-color/modules/react-material-design/lib/components/Tab' {
  declare module.exports: any;
}

declare module 'react-color/modules/react-material-design/lib/components/Tabs' {
  declare module.exports: any;
}

declare module 'react-color/modules/react-material-design/lib/components/Tile' {
  declare module.exports: any;
}

declare module 'react-color/modules/react-move/index' {
  declare module.exports: any;
}

declare module 'react-color/modules/react-move/lib/components/Move' {
  declare module.exports: any;
}

declare module 'react-color/modules/remarkable/index' {
  declare module.exports: any;
}

declare module 'react-color/modules/tinycolor2/index' {
  declare module.exports: any;
}

declare module 'react-color/modules/webpack-react-static/index' {
  declare module.exports: any;
}

declare module 'react-color/scripts/docs-dist' {
  declare module.exports: any;
}

declare module 'react-color/scripts/docs-server' {
  declare module.exports: any;
}

declare module 'react-color/webpack.config' {
  declare module.exports: any;
}

// Filename aliases
declare module 'react-color/examples/Button.js' {
  declare module.exports: $Exports<'react-color/examples/Button'>;
}
declare module 'react-color/examples/index.js' {
  declare module.exports: $Exports<'react-color/examples/index'>;
}
declare module 'react-color/examples/Sketch.js' {
  declare module.exports: $Exports<'react-color/examples/Sketch'>;
}
declare module 'react-color/lib/components/alpha/Alpha.js' {
  declare module.exports: $Exports<'react-color/lib/components/alpha/Alpha'>;
}
declare module 'react-color/lib/components/alpha/AlphaPointer.js' {
  declare module.exports: $Exports<'react-color/lib/components/alpha/AlphaPointer'>;
}
declare module 'react-color/lib/components/alpha/spec.js' {
  declare module.exports: $Exports<'react-color/lib/components/alpha/spec'>;
}
declare module 'react-color/lib/components/block/Block.js' {
  declare module.exports: $Exports<'react-color/lib/components/block/Block'>;
}
declare module 'react-color/lib/components/block/BlockSwatches.js' {
  declare module.exports: $Exports<'react-color/lib/components/block/BlockSwatches'>;
}
declare module 'react-color/lib/components/block/spec.js' {
  declare module.exports: $Exports<'react-color/lib/components/block/spec'>;
}
declare module 'react-color/lib/components/chrome/Chrome.js' {
  declare module.exports: $Exports<'react-color/lib/components/chrome/Chrome'>;
}
declare module 'react-color/lib/components/chrome/ChromeFields.js' {
  declare module.exports: $Exports<'react-color/lib/components/chrome/ChromeFields'>;
}
declare module 'react-color/lib/components/chrome/ChromePointer.js' {
  declare module.exports: $Exports<'react-color/lib/components/chrome/ChromePointer'>;
}
declare module 'react-color/lib/components/chrome/ChromePointerCircle.js' {
  declare module.exports: $Exports<'react-color/lib/components/chrome/ChromePointerCircle'>;
}
declare module 'react-color/lib/components/chrome/spec.js' {
  declare module.exports: $Exports<'react-color/lib/components/chrome/spec'>;
}
declare module 'react-color/lib/components/circle/Circle.js' {
  declare module.exports: $Exports<'react-color/lib/components/circle/Circle'>;
}
declare module 'react-color/lib/components/circle/CircleSwatch.js' {
  declare module.exports: $Exports<'react-color/lib/components/circle/CircleSwatch'>;
}
declare module 'react-color/lib/components/circle/spec.js' {
  declare module.exports: $Exports<'react-color/lib/components/circle/spec'>;
}
declare module 'react-color/lib/components/common/Alpha.js' {
  declare module.exports: $Exports<'react-color/lib/components/common/Alpha'>;
}
declare module 'react-color/lib/components/common/Checkboard.js' {
  declare module.exports: $Exports<'react-color/lib/components/common/Checkboard'>;
}
declare module 'react-color/lib/components/common/ColorWrap.js' {
  declare module.exports: $Exports<'react-color/lib/components/common/ColorWrap'>;
}
declare module 'react-color/lib/components/common/EditableInput.js' {
  declare module.exports: $Exports<'react-color/lib/components/common/EditableInput'>;
}
declare module 'react-color/lib/components/common/Hue.js' {
  declare module.exports: $Exports<'react-color/lib/components/common/Hue'>;
}
declare module 'react-color/lib/components/common/index.js' {
  declare module.exports: $Exports<'react-color/lib/components/common/index'>;
}
declare module 'react-color/lib/components/common/Saturation.js' {
  declare module.exports: $Exports<'react-color/lib/components/common/Saturation'>;
}
declare module 'react-color/lib/components/common/spec.js' {
  declare module.exports: $Exports<'react-color/lib/components/common/spec'>;
}
declare module 'react-color/lib/components/common/Swatch.js' {
  declare module.exports: $Exports<'react-color/lib/components/common/Swatch'>;
}
declare module 'react-color/lib/components/compact/Compact.js' {
  declare module.exports: $Exports<'react-color/lib/components/compact/Compact'>;
}
declare module 'react-color/lib/components/compact/CompactColor.js' {
  declare module.exports: $Exports<'react-color/lib/components/compact/CompactColor'>;
}
declare module 'react-color/lib/components/compact/CompactFields.js' {
  declare module.exports: $Exports<'react-color/lib/components/compact/CompactFields'>;
}
declare module 'react-color/lib/components/compact/spec.js' {
  declare module.exports: $Exports<'react-color/lib/components/compact/spec'>;
}
declare module 'react-color/lib/components/github/Github.js' {
  declare module.exports: $Exports<'react-color/lib/components/github/Github'>;
}
declare module 'react-color/lib/components/github/GithubSwatch.js' {
  declare module.exports: $Exports<'react-color/lib/components/github/GithubSwatch'>;
}
declare module 'react-color/lib/components/github/spec.js' {
  declare module.exports: $Exports<'react-color/lib/components/github/spec'>;
}
declare module 'react-color/lib/components/hue/Hue.js' {
  declare module.exports: $Exports<'react-color/lib/components/hue/Hue'>;
}
declare module 'react-color/lib/components/hue/HuePointer.js' {
  declare module.exports: $Exports<'react-color/lib/components/hue/HuePointer'>;
}
declare module 'react-color/lib/components/hue/spec.js' {
  declare module.exports: $Exports<'react-color/lib/components/hue/spec'>;
}
declare module 'react-color/lib/components/material/Material.js' {
  declare module.exports: $Exports<'react-color/lib/components/material/Material'>;
}
declare module 'react-color/lib/components/material/spec.js' {
  declare module.exports: $Exports<'react-color/lib/components/material/spec'>;
}
declare module 'react-color/lib/components/photoshop/Photoshop.js' {
  declare module.exports: $Exports<'react-color/lib/components/photoshop/Photoshop'>;
}
declare module 'react-color/lib/components/photoshop/PhotoshopButton.js' {
  declare module.exports: $Exports<'react-color/lib/components/photoshop/PhotoshopButton'>;
}
declare module 'react-color/lib/components/photoshop/PhotoshopFields.js' {
  declare module.exports: $Exports<'react-color/lib/components/photoshop/PhotoshopFields'>;
}
declare module 'react-color/lib/components/photoshop/PhotoshopPointer.js' {
  declare module.exports: $Exports<'react-color/lib/components/photoshop/PhotoshopPointer'>;
}
declare module 'react-color/lib/components/photoshop/PhotoshopPointerCircle.js' {
  declare module.exports: $Exports<'react-color/lib/components/photoshop/PhotoshopPointerCircle'>;
}
declare module 'react-color/lib/components/photoshop/PhotoshopPreviews.js' {
  declare module.exports: $Exports<'react-color/lib/components/photoshop/PhotoshopPreviews'>;
}
declare module 'react-color/lib/components/photoshop/spec.js' {
  declare module.exports: $Exports<'react-color/lib/components/photoshop/spec'>;
}
declare module 'react-color/lib/components/sketch/Sketch.js' {
  declare module.exports: $Exports<'react-color/lib/components/sketch/Sketch'>;
}
declare module 'react-color/lib/components/sketch/SketchFields.js' {
  declare module.exports: $Exports<'react-color/lib/components/sketch/SketchFields'>;
}
declare module 'react-color/lib/components/sketch/SketchPresetColors.js' {
  declare module.exports: $Exports<'react-color/lib/components/sketch/SketchPresetColors'>;
}
declare module 'react-color/lib/components/sketch/spec.js' {
  declare module.exports: $Exports<'react-color/lib/components/sketch/spec'>;
}
declare module 'react-color/lib/components/slider/Slider.js' {
  declare module.exports: $Exports<'react-color/lib/components/slider/Slider'>;
}
declare module 'react-color/lib/components/slider/SliderPointer.js' {
  declare module.exports: $Exports<'react-color/lib/components/slider/SliderPointer'>;
}
declare module 'react-color/lib/components/slider/SliderSwatch.js' {
  declare module.exports: $Exports<'react-color/lib/components/slider/SliderSwatch'>;
}
declare module 'react-color/lib/components/slider/SliderSwatches.js' {
  declare module.exports: $Exports<'react-color/lib/components/slider/SliderSwatches'>;
}
declare module 'react-color/lib/components/slider/spec.js' {
  declare module.exports: $Exports<'react-color/lib/components/slider/spec'>;
}
declare module 'react-color/lib/components/swatches/spec.js' {
  declare module.exports: $Exports<'react-color/lib/components/swatches/spec'>;
}
declare module 'react-color/lib/components/swatches/Swatches.js' {
  declare module.exports: $Exports<'react-color/lib/components/swatches/Swatches'>;
}
declare module 'react-color/lib/components/swatches/SwatchesColor.js' {
  declare module.exports: $Exports<'react-color/lib/components/swatches/SwatchesColor'>;
}
declare module 'react-color/lib/components/swatches/SwatchesGroup.js' {
  declare module.exports: $Exports<'react-color/lib/components/swatches/SwatchesGroup'>;
}
declare module 'react-color/lib/components/twitter/spec.js' {
  declare module.exports: $Exports<'react-color/lib/components/twitter/spec'>;
}
declare module 'react-color/lib/components/twitter/Twitter.js' {
  declare module.exports: $Exports<'react-color/lib/components/twitter/Twitter'>;
}
declare module 'react-color/lib/helpers/alpha.js' {
  declare module.exports: $Exports<'react-color/lib/helpers/alpha'>;
}
declare module 'react-color/lib/helpers/checkboard.js' {
  declare module.exports: $Exports<'react-color/lib/helpers/checkboard'>;
}
declare module 'react-color/lib/helpers/color.js' {
  declare module.exports: $Exports<'react-color/lib/helpers/color'>;
}
declare module 'react-color/lib/helpers/hue.js' {
  declare module.exports: $Exports<'react-color/lib/helpers/hue'>;
}
declare module 'react-color/lib/helpers/interaction.js' {
  declare module.exports: $Exports<'react-color/lib/helpers/interaction'>;
}
declare module 'react-color/lib/helpers/saturation.js' {
  declare module.exports: $Exports<'react-color/lib/helpers/saturation'>;
}
declare module 'react-color/lib/helpers/spec.js' {
  declare module.exports: $Exports<'react-color/lib/helpers/spec'>;
}
declare module 'react-color/lib/index.js' {
  declare module.exports: $Exports<'react-color/lib/index'>;
}
declare module 'react-color/modules/highlight.js' {
  declare module.exports: $Exports<'react-color/modules/highlight'>;
}
declare module 'react-color/modules/highlight.js/highlight.js' {
  declare module.exports: $Exports<'react-color/modules/highlight.js/highlight'>;
}
declare module 'react-color/modules/highlight.js/index.js' {
  declare module.exports: $Exports<'react-color/modules/highlight.js/index'>;
}
declare module 'react-color/modules/highlight.js/languages/javascript.js' {
  declare module.exports: $Exports<'react-color/modules/highlight.js/languages/javascript'>;
}
declare module 'react-color/modules/react-basic-layout/index.js' {
  declare module.exports: $Exports<'react-color/modules/react-basic-layout/index'>;
}
declare module 'react-color/modules/react-basic-layout/lib/components/Container.js' {
  declare module.exports: $Exports<'react-color/modules/react-basic-layout/lib/components/Container'>;
}
declare module 'react-color/modules/react-basic-layout/lib/components/Grid.js' {
  declare module.exports: $Exports<'react-color/modules/react-basic-layout/lib/components/Grid'>;
}
declare module 'react-color/modules/react-docs/index.js' {
  declare module.exports: $Exports<'react-color/modules/react-docs/index'>;
}
declare module 'react-color/modules/react-docs/lib/components/Code.js' {
  declare module.exports: $Exports<'react-color/modules/react-docs/lib/components/Code'>;
}
declare module 'react-color/modules/react-docs/lib/components/Docs.js' {
  declare module.exports: $Exports<'react-color/modules/react-docs/lib/components/Docs'>;
}
declare module 'react-color/modules/react-docs/lib/components/Markdown.js' {
  declare module.exports: $Exports<'react-color/modules/react-docs/lib/components/Markdown'>;
}
declare module 'react-color/modules/react-docs/lib/components/MarkdownTitle.js' {
  declare module.exports: $Exports<'react-color/modules/react-docs/lib/components/MarkdownTitle'>;
}
declare module 'react-color/modules/react-docs/lib/components/Sidebar.js' {
  declare module.exports: $Exports<'react-color/modules/react-docs/lib/components/Sidebar'>;
}
declare module 'react-color/modules/react-docs/lib/components/SidebarItem.js' {
  declare module.exports: $Exports<'react-color/modules/react-docs/lib/components/SidebarItem'>;
}
declare module 'react-color/modules/react-docs/lib/helpers/markdown.js' {
  declare module.exports: $Exports<'react-color/modules/react-docs/lib/helpers/markdown'>;
}
declare module 'react-color/modules/react-material-design/index.js' {
  declare module.exports: $Exports<'react-color/modules/react-material-design/index'>;
}
declare module 'react-color/modules/react-material-design/lib/components/Link.js' {
  declare module.exports: $Exports<'react-color/modules/react-material-design/lib/components/Link'>;
}
declare module 'react-color/modules/react-material-design/lib/components/Raised.js' {
  declare module.exports: $Exports<'react-color/modules/react-material-design/lib/components/Raised'>;
}
declare module 'react-color/modules/react-material-design/lib/components/Tab.js' {
  declare module.exports: $Exports<'react-color/modules/react-material-design/lib/components/Tab'>;
}
declare module 'react-color/modules/react-material-design/lib/components/Tabs.js' {
  declare module.exports: $Exports<'react-color/modules/react-material-design/lib/components/Tabs'>;
}
declare module 'react-color/modules/react-material-design/lib/components/Tile.js' {
  declare module.exports: $Exports<'react-color/modules/react-material-design/lib/components/Tile'>;
}
declare module 'react-color/modules/react-move/index.js' {
  declare module.exports: $Exports<'react-color/modules/react-move/index'>;
}
declare module 'react-color/modules/react-move/lib/components/Move.js' {
  declare module.exports: $Exports<'react-color/modules/react-move/lib/components/Move'>;
}
declare module 'react-color/modules/remarkable/index.js' {
  declare module.exports: $Exports<'react-color/modules/remarkable/index'>;
}
declare module 'react-color/modules/tinycolor2/index.js' {
  declare module.exports: $Exports<'react-color/modules/tinycolor2/index'>;
}
declare module 'react-color/modules/webpack-react-static/index.js' {
  declare module.exports: $Exports<'react-color/modules/webpack-react-static/index'>;
}
declare module 'react-color/scripts/docs-dist.js' {
  declare module.exports: $Exports<'react-color/scripts/docs-dist'>;
}
declare module 'react-color/scripts/docs-server.js' {
  declare module.exports: $Exports<'react-color/scripts/docs-server'>;
}
declare module 'react-color/webpack.config.js' {
  declare module.exports: $Exports<'react-color/webpack.config'>;
}
// flow-typed signature: fd664fcf7a2fc39e3ce5d7776ec7ae24
// flow-typed version: <<STUB>>/react-devtools-core_v3.0.0/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'react-devtools-core'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'react-devtools-core' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'react-devtools-core/build/backend' {
  declare module.exports: any;
}

declare module 'react-devtools-core/build/standalone' {
  declare module.exports: any;
}

declare module 'react-devtools-core/standalone' {
  declare module.exports: any;
}

// Filename aliases
declare module 'react-devtools-core/build/backend.js' {
  declare module.exports: $Exports<'react-devtools-core/build/backend'>;
}
declare module 'react-devtools-core/build/standalone.js' {
  declare module.exports: $Exports<'react-devtools-core/build/standalone'>;
}
declare module 'react-devtools-core/index' {
  declare module.exports: $Exports<'react-devtools-core'>;
}
declare module 'react-devtools-core/index.js' {
  declare module.exports: $Exports<'react-devtools-core'>;
}
declare module 'react-devtools-core/standalone.js' {
  declare module.exports: $Exports<'react-devtools-core/standalone'>;
}
// flow-typed signature: 16b40ff613d36712444ef20fb107de7c
// flow-typed version: be6cfc6753/react-redux_v5.x.x/flow_>=v0.62.0

import type { Dispatch, Store } from "redux";

declare module "react-redux" {
  import type { ComponentType, ElementConfig } from 'react';

  declare export class Provider<S, A> extends React$Component<{
    store: Store<S, A>,
    children?: any
  }> {}

  declare export function createProvider(
    storeKey?: string,
    subKey?: string
  ): Provider<*, *>;

  /*

  S = State
  A = Action
  OP = OwnProps
  SP = StateProps
  DP = DispatchProps
  MP = Merge props
  MDP = Map dispatch to props object
  RSP = Returned state props
  RDP = Returned dispatch props
  RMP = Returned merge props
  CP = Props for returned component
  Com = React Component
  */

  declare type MapStateToProps<S: Object, SP: Object, RSP: Object> = (state: S, props: SP) => RSP;

  declare type MapDispatchToProps<A, OP: Object, RDP: Object> = (dispatch: Dispatch<A>, ownProps: OP) => RDP;

  declare type MergeProps<SP: Object, DP: Object, MP: Object, RMP: Object> = (
    stateProps: SP,
    dispatchProps: DP,
    ownProps: MP
  ) => RMP;

  declare type ConnectOptions<S: Object, OP: Object, RSP: Object, RMP: Object> = {|
    pure?: boolean,
    withRef?: boolean,
    areStatesEqual?: (next: S, prev: S) => boolean,
    areOwnPropsEqual?: (next: OP, prev: OP) => boolean,
    areStatePropsEqual?: (next: RSP, prev: RSP) => boolean,
    areMergedPropsEqual?: (next: RMP, prev: RMP) => boolean,
    storeKey?: string
  |};

  declare type OmitDispatch<Component> = $Diff<Component, {dispatch: Dispatch<*>}>;

  declare export function connect<
    Com: ComponentType<*>,
    S: Object,
    DP: Object,
    RSP: Object,
    CP: $Diff<OmitDispatch<ElementConfig<Com>>, RSP>
    >(
    mapStateToProps: MapStateToProps<S, DP, RSP>,
    mapDispatchToProps?: null
  ): (component: Com) => ComponentType<CP & DP>;

  declare export function connect<Com: ComponentType<*>>(
    mapStateToProps?: null,
    mapDispatchToProps?: null
  ): (component: Com) => ComponentType<OmitDispatch<ElementConfig<Com>>>;

  declare export function connect<
    Com: ComponentType<*>,
    A,
    S: Object,
    DP: Object,
    SP: Object,
    RSP: Object,
    RDP: Object,
    CP: $Diff<$Diff<ElementConfig<Com>, RSP>, RDP>
    >(
    mapStateToProps: MapStateToProps<S, SP, RSP>,
    mapDispatchToProps: MapDispatchToProps<A, DP, RDP>
  ): (component: Com) => ComponentType<CP & SP & DP>;

  declare export function connect<
    Com: ComponentType<*>,
    A,
    OP: Object,
    DP: Object,
    PR: Object,
    CP: $Diff<ElementConfig<Com>, DP>
    >(
    mapStateToProps?: null,
    mapDispatchToProps: MapDispatchToProps<A, OP, DP>
  ): (Com) => ComponentType<CP & OP>;

  declare export function connect<
    Com: ComponentType<*>,
    MDP: Object
    >(
    mapStateToProps?: null,
    mapDispatchToProps: MDP
  ): (component: Com) => ComponentType<$Diff<ElementConfig<Com>, MDP>>;

  declare export function connect<
    Com: ComponentType<*>,
    S: Object,
    SP: Object,
    RSP: Object,
    MDP: Object,
    CP: $Diff<ElementConfig<Com>, RSP>
    >(
    mapStateToProps: MapStateToProps<S, SP, RSP>,
    mapDispatchToPRops: MDP
  ): (component: Com) => ComponentType<$Diff<CP, MDP> & SP>;

  declare export function connect<
    Com: ComponentType<*>,
    A,
    S: Object,
    DP: Object,
    SP: Object,
    RSP: Object,
    RDP: Object,
    MP: Object,
    RMP: Object,
    CP: $Diff<ElementConfig<Com>, RMP>
    >(
    mapStateToProps: MapStateToProps<S, SP, RSP>,
    mapDispatchToProps: ?MapDispatchToProps<A, DP, RDP>,
    mergeProps: MergeProps<RSP, RDP, MP, RMP>
  ): (component: Com) => ComponentType<CP & SP & DP & MP>;

  declare export function connect<Com: ComponentType<*>,
    A,
    S: Object,
    DP: Object,
    SP: Object,
    RSP: Object,
    RDP: Object,
    MP: Object,
    RMP: Object
    >(
    mapStateToProps: ?MapStateToProps<S, SP, RSP>,
    mapDispatchToProps: ?MapDispatchToProps<A, DP, RDP>,
    mergeProps: ?MergeProps<RSP, RDP, MP, RMP>,
    options: ConnectOptions<S, SP & DP & MP, RSP, RMP>
  ): (component: Com) => ComponentType<$Diff<ElementConfig<Com>, RMP> & SP & DP & MP>;

  declare export default {
    Provider: typeof Provider,
    createProvider: typeof createProvider,
    connect: typeof connect,
  };
}
// flow-typed signature: d75e9be7ed16f88e288f787e982584b8
// flow-typed version: <<STUB>>/react-test-renderer_v^16/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'react-test-renderer'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'react-test-renderer' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'react-test-renderer/cjs/react-test-renderer-shallow.development' {
  declare module.exports: any;
}

declare module 'react-test-renderer/cjs/react-test-renderer-shallow.production.min' {
  declare module.exports: any;
}

declare module 'react-test-renderer/cjs/react-test-renderer.development' {
  declare module.exports: any;
}

declare module 'react-test-renderer/cjs/react-test-renderer.production.min' {
  declare module.exports: any;
}

declare module 'react-test-renderer/shallow' {
  declare module.exports: any;
}

// Filename aliases
declare module 'react-test-renderer/cjs/react-test-renderer-shallow.development.js' {
  declare module.exports: $Exports<'react-test-renderer/cjs/react-test-renderer-shallow.development'>;
}
declare module 'react-test-renderer/cjs/react-test-renderer-shallow.production.min.js' {
  declare module.exports: $Exports<'react-test-renderer/cjs/react-test-renderer-shallow.production.min'>;
}
declare module 'react-test-renderer/cjs/react-test-renderer.development.js' {
  declare module.exports: $Exports<'react-test-renderer/cjs/react-test-renderer.development'>;
}
declare module 'react-test-renderer/cjs/react-test-renderer.production.min.js' {
  declare module.exports: $Exports<'react-test-renderer/cjs/react-test-renderer.production.min'>;
}
declare module 'react-test-renderer/index' {
  declare module.exports: $Exports<'react-test-renderer'>;
}
declare module 'react-test-renderer/index.js' {
  declare module.exports: $Exports<'react-test-renderer'>;
}
declare module 'react-test-renderer/shallow.js' {
  declare module.exports: $Exports<'react-test-renderer/shallow'>;
}
// flow-typed signature: 7ad3746a26284155ba00efee65b4be9b
// flow-typed version: <<STUB>>/react-virtualized_v^9.13.0/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'react-virtualized'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'react-virtualized' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'react-virtualized/dist/commonjs/ArrowKeyStepper/ArrowKeyStepper.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/ArrowKeyStepper/ArrowKeyStepper' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/ArrowKeyStepper/index' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/ArrowKeyStepper/types' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/AutoSizer/AutoSizer.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/AutoSizer/AutoSizer' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/AutoSizer/index' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/AutoSizer/types' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/CellMeasurer/CellMeasurer.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/CellMeasurer/CellMeasurer' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/CellMeasurer/CellMeasurerCache.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/CellMeasurer/CellMeasurerCache' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/CellMeasurer/index' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Collection/Collection.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Collection/Collection' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Collection/CollectionView' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Collection/index' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Collection/Section.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Collection/Section' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Collection/SectionManager.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Collection/SectionManager' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Collection/TestData' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Collection/types' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Collection/utils/calculateSizeAndPositionData.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Collection/utils/calculateSizeAndPositionData' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/ColumnSizer/ColumnSizer.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/ColumnSizer/ColumnSizer' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/ColumnSizer/index' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Grid/accessibilityOverscanIndicesGetter.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Grid/accessibilityOverscanIndicesGetter' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Grid/defaultCellRangeRenderer' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Grid/defaultOverscanIndicesGetter.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Grid/defaultOverscanIndicesGetter' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Grid/Grid.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Grid/Grid' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Grid/index' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Grid/types' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Grid/utils/calculateSizeAndPositionDataAndUpdateScrollOffset.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Grid/utils/calculateSizeAndPositionDataAndUpdateScrollOffset' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Grid/utils/CellSizeAndPositionManager.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Grid/utils/CellSizeAndPositionManager' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Grid/utils/ScalingCellSizeAndPositionManager.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Grid/utils/ScalingCellSizeAndPositionManager' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Grid/utils/updateScrollIndexHelper.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Grid/utils/updateScrollIndexHelper' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/index' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/InfiniteLoader/index' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/InfiniteLoader/InfiniteLoader.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/InfiniteLoader/InfiniteLoader' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/jest-setup' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/List/index' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/List/List.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/List/List' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/List/types' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Masonry/createCellPositioner' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Masonry/index' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Masonry/Masonry.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Masonry/Masonry' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Masonry/PositionCache' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/MultiGrid/CellMeasurerCacheDecorator' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/MultiGrid/index' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/MultiGrid/MultiGrid.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/MultiGrid/MultiGrid' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/ScrollSync/index' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/ScrollSync/ScrollSync.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/ScrollSync/ScrollSync' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Table/Column.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Table/Column' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Table/defaultCellDataGetter' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Table/defaultCellRenderer' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Table/defaultHeaderRenderer' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Table/defaultHeaderRowRenderer' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Table/defaultRowRenderer' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Table/index' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Table/SortDirection' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Table/SortIndicator' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Table/Table.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Table/Table' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/Table/types' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/TestUtils' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/utils/animationFrame' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/utils/createCallbackMemoizer.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/utils/createCallbackMemoizer' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/utils/getUpdatedOffsetForIndex.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/utils/getUpdatedOffsetForIndex' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/utils/initCellMetadata' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/utils/requestAnimationTimeout' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/utils/TestHelper' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/vendor/binarySearchBounds' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/vendor/detectElementResize' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/vendor/intervalTree' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/WindowScroller/index' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/WindowScroller/utils/dimensions' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/WindowScroller/utils/onScroll' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/WindowScroller/WindowScroller.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/commonjs/WindowScroller/WindowScroller' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/ArrowKeyStepper/ArrowKeyStepper.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/ArrowKeyStepper/ArrowKeyStepper' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/ArrowKeyStepper/index' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/ArrowKeyStepper/types' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/AutoSizer/AutoSizer.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/AutoSizer/AutoSizer' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/AutoSizer/index' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/AutoSizer/types' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/CellMeasurer/CellMeasurer.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/CellMeasurer/CellMeasurer' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/CellMeasurer/CellMeasurerCache.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/CellMeasurer/CellMeasurerCache' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/CellMeasurer/index' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Collection/Collection.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Collection/Collection' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Collection/CollectionView' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Collection/index' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Collection/Section.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Collection/Section' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Collection/SectionManager.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Collection/SectionManager' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Collection/TestData' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Collection/types' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Collection/utils/calculateSizeAndPositionData.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Collection/utils/calculateSizeAndPositionData' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/ColumnSizer/ColumnSizer.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/ColumnSizer/ColumnSizer' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/ColumnSizer/index' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Grid/accessibilityOverscanIndicesGetter.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Grid/accessibilityOverscanIndicesGetter' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Grid/defaultCellRangeRenderer' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Grid/defaultOverscanIndicesGetter.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Grid/defaultOverscanIndicesGetter' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Grid/Grid.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Grid/Grid' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Grid/index' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Grid/types' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Grid/utils/calculateSizeAndPositionDataAndUpdateScrollOffset.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Grid/utils/calculateSizeAndPositionDataAndUpdateScrollOffset' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Grid/utils/CellSizeAndPositionManager.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Grid/utils/CellSizeAndPositionManager' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Grid/utils/ScalingCellSizeAndPositionManager.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Grid/utils/ScalingCellSizeAndPositionManager' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Grid/utils/updateScrollIndexHelper.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Grid/utils/updateScrollIndexHelper' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/index' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/InfiniteLoader/index' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/InfiniteLoader/InfiniteLoader.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/InfiniteLoader/InfiniteLoader' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/jest-setup' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/List/index' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/List/List.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/List/List' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/List/types' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Masonry/createCellPositioner' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Masonry/index' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Masonry/Masonry.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Masonry/Masonry' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Masonry/PositionCache' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/MultiGrid/CellMeasurerCacheDecorator' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/MultiGrid/index' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/MultiGrid/MultiGrid.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/MultiGrid/MultiGrid' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/ScrollSync/index' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/ScrollSync/ScrollSync.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/ScrollSync/ScrollSync' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Table/Column.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Table/Column' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Table/defaultCellDataGetter' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Table/defaultCellRenderer' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Table/defaultHeaderRenderer' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Table/defaultHeaderRowRenderer' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Table/defaultRowRenderer' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Table/index' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Table/SortDirection' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Table/SortIndicator' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Table/Table.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Table/Table' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/Table/types' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/TestUtils' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/utils/animationFrame' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/utils/createCallbackMemoizer.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/utils/createCallbackMemoizer' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/utils/getUpdatedOffsetForIndex.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/utils/getUpdatedOffsetForIndex' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/utils/initCellMetadata' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/utils/requestAnimationTimeout' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/utils/TestHelper' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/vendor/binarySearchBounds' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/vendor/detectElementResize' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/vendor/intervalTree' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/WindowScroller/index' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/WindowScroller/utils/dimensions' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/WindowScroller/utils/onScroll' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/WindowScroller/WindowScroller.jest' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/es/WindowScroller/WindowScroller' {
  declare module.exports: any;
}

declare module 'react-virtualized/dist/umd/react-virtualized' {
  declare module.exports: any;
}

// Filename aliases
declare module 'react-virtualized/dist/commonjs/ArrowKeyStepper/ArrowKeyStepper.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/ArrowKeyStepper/ArrowKeyStepper.jest'>;
}
declare module 'react-virtualized/dist/commonjs/ArrowKeyStepper/ArrowKeyStepper.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/ArrowKeyStepper/ArrowKeyStepper'>;
}
declare module 'react-virtualized/dist/commonjs/ArrowKeyStepper/index.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/ArrowKeyStepper/index'>;
}
declare module 'react-virtualized/dist/commonjs/ArrowKeyStepper/types.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/ArrowKeyStepper/types'>;
}
declare module 'react-virtualized/dist/commonjs/AutoSizer/AutoSizer.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/AutoSizer/AutoSizer.jest'>;
}
declare module 'react-virtualized/dist/commonjs/AutoSizer/AutoSizer.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/AutoSizer/AutoSizer'>;
}
declare module 'react-virtualized/dist/commonjs/AutoSizer/index.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/AutoSizer/index'>;
}
declare module 'react-virtualized/dist/commonjs/AutoSizer/types.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/AutoSizer/types'>;
}
declare module 'react-virtualized/dist/commonjs/CellMeasurer/CellMeasurer.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/CellMeasurer/CellMeasurer.jest'>;
}
declare module 'react-virtualized/dist/commonjs/CellMeasurer/CellMeasurer.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/CellMeasurer/CellMeasurer'>;
}
declare module 'react-virtualized/dist/commonjs/CellMeasurer/CellMeasurerCache.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/CellMeasurer/CellMeasurerCache.jest'>;
}
declare module 'react-virtualized/dist/commonjs/CellMeasurer/CellMeasurerCache.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/CellMeasurer/CellMeasurerCache'>;
}
declare module 'react-virtualized/dist/commonjs/CellMeasurer/index.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/CellMeasurer/index'>;
}
declare module 'react-virtualized/dist/commonjs/Collection/Collection.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Collection/Collection.jest'>;
}
declare module 'react-virtualized/dist/commonjs/Collection/Collection.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Collection/Collection'>;
}
declare module 'react-virtualized/dist/commonjs/Collection/CollectionView.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Collection/CollectionView'>;
}
declare module 'react-virtualized/dist/commonjs/Collection/index.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Collection/index'>;
}
declare module 'react-virtualized/dist/commonjs/Collection/Section.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Collection/Section.jest'>;
}
declare module 'react-virtualized/dist/commonjs/Collection/Section.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Collection/Section'>;
}
declare module 'react-virtualized/dist/commonjs/Collection/SectionManager.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Collection/SectionManager.jest'>;
}
declare module 'react-virtualized/dist/commonjs/Collection/SectionManager.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Collection/SectionManager'>;
}
declare module 'react-virtualized/dist/commonjs/Collection/TestData.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Collection/TestData'>;
}
declare module 'react-virtualized/dist/commonjs/Collection/types.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Collection/types'>;
}
declare module 'react-virtualized/dist/commonjs/Collection/utils/calculateSizeAndPositionData.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Collection/utils/calculateSizeAndPositionData.jest'>;
}
declare module 'react-virtualized/dist/commonjs/Collection/utils/calculateSizeAndPositionData.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Collection/utils/calculateSizeAndPositionData'>;
}
declare module 'react-virtualized/dist/commonjs/ColumnSizer/ColumnSizer.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/ColumnSizer/ColumnSizer.jest'>;
}
declare module 'react-virtualized/dist/commonjs/ColumnSizer/ColumnSizer.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/ColumnSizer/ColumnSizer'>;
}
declare module 'react-virtualized/dist/commonjs/ColumnSizer/index.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/ColumnSizer/index'>;
}
declare module 'react-virtualized/dist/commonjs/Grid/accessibilityOverscanIndicesGetter.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Grid/accessibilityOverscanIndicesGetter.jest'>;
}
declare module 'react-virtualized/dist/commonjs/Grid/accessibilityOverscanIndicesGetter.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Grid/accessibilityOverscanIndicesGetter'>;
}
declare module 'react-virtualized/dist/commonjs/Grid/defaultCellRangeRenderer.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Grid/defaultCellRangeRenderer'>;
}
declare module 'react-virtualized/dist/commonjs/Grid/defaultOverscanIndicesGetter.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Grid/defaultOverscanIndicesGetter.jest'>;
}
declare module 'react-virtualized/dist/commonjs/Grid/defaultOverscanIndicesGetter.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Grid/defaultOverscanIndicesGetter'>;
}
declare module 'react-virtualized/dist/commonjs/Grid/Grid.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Grid/Grid.jest'>;
}
declare module 'react-virtualized/dist/commonjs/Grid/Grid.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Grid/Grid'>;
}
declare module 'react-virtualized/dist/commonjs/Grid/index.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Grid/index'>;
}
declare module 'react-virtualized/dist/commonjs/Grid/types.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Grid/types'>;
}
declare module 'react-virtualized/dist/commonjs/Grid/utils/calculateSizeAndPositionDataAndUpdateScrollOffset.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Grid/utils/calculateSizeAndPositionDataAndUpdateScrollOffset.jest'>;
}
declare module 'react-virtualized/dist/commonjs/Grid/utils/calculateSizeAndPositionDataAndUpdateScrollOffset.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Grid/utils/calculateSizeAndPositionDataAndUpdateScrollOffset'>;
}
declare module 'react-virtualized/dist/commonjs/Grid/utils/CellSizeAndPositionManager.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Grid/utils/CellSizeAndPositionManager.jest'>;
}
declare module 'react-virtualized/dist/commonjs/Grid/utils/CellSizeAndPositionManager.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Grid/utils/CellSizeAndPositionManager'>;
}
declare module 'react-virtualized/dist/commonjs/Grid/utils/ScalingCellSizeAndPositionManager.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Grid/utils/ScalingCellSizeAndPositionManager.jest'>;
}
declare module 'react-virtualized/dist/commonjs/Grid/utils/ScalingCellSizeAndPositionManager.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Grid/utils/ScalingCellSizeAndPositionManager'>;
}
declare module 'react-virtualized/dist/commonjs/Grid/utils/updateScrollIndexHelper.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Grid/utils/updateScrollIndexHelper.jest'>;
}
declare module 'react-virtualized/dist/commonjs/Grid/utils/updateScrollIndexHelper.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Grid/utils/updateScrollIndexHelper'>;
}
declare module 'react-virtualized/dist/commonjs/index.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/index'>;
}
declare module 'react-virtualized/dist/commonjs/InfiniteLoader/index.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/InfiniteLoader/index'>;
}
declare module 'react-virtualized/dist/commonjs/InfiniteLoader/InfiniteLoader.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/InfiniteLoader/InfiniteLoader.jest'>;
}
declare module 'react-virtualized/dist/commonjs/InfiniteLoader/InfiniteLoader.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/InfiniteLoader/InfiniteLoader'>;
}
declare module 'react-virtualized/dist/commonjs/jest-setup.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/jest-setup'>;
}
declare module 'react-virtualized/dist/commonjs/List/index.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/List/index'>;
}
declare module 'react-virtualized/dist/commonjs/List/List.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/List/List.jest'>;
}
declare module 'react-virtualized/dist/commonjs/List/List.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/List/List'>;
}
declare module 'react-virtualized/dist/commonjs/List/types.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/List/types'>;
}
declare module 'react-virtualized/dist/commonjs/Masonry/createCellPositioner.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Masonry/createCellPositioner'>;
}
declare module 'react-virtualized/dist/commonjs/Masonry/index.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Masonry/index'>;
}
declare module 'react-virtualized/dist/commonjs/Masonry/Masonry.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Masonry/Masonry.jest'>;
}
declare module 'react-virtualized/dist/commonjs/Masonry/Masonry.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Masonry/Masonry'>;
}
declare module 'react-virtualized/dist/commonjs/Masonry/PositionCache.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Masonry/PositionCache'>;
}
declare module 'react-virtualized/dist/commonjs/MultiGrid/CellMeasurerCacheDecorator.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/MultiGrid/CellMeasurerCacheDecorator'>;
}
declare module 'react-virtualized/dist/commonjs/MultiGrid/index.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/MultiGrid/index'>;
}
declare module 'react-virtualized/dist/commonjs/MultiGrid/MultiGrid.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/MultiGrid/MultiGrid.jest'>;
}
declare module 'react-virtualized/dist/commonjs/MultiGrid/MultiGrid.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/MultiGrid/MultiGrid'>;
}
declare module 'react-virtualized/dist/commonjs/ScrollSync/index.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/ScrollSync/index'>;
}
declare module 'react-virtualized/dist/commonjs/ScrollSync/ScrollSync.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/ScrollSync/ScrollSync.jest'>;
}
declare module 'react-virtualized/dist/commonjs/ScrollSync/ScrollSync.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/ScrollSync/ScrollSync'>;
}
declare module 'react-virtualized/dist/commonjs/Table/Column.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Table/Column.jest'>;
}
declare module 'react-virtualized/dist/commonjs/Table/Column.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Table/Column'>;
}
declare module 'react-virtualized/dist/commonjs/Table/defaultCellDataGetter.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Table/defaultCellDataGetter'>;
}
declare module 'react-virtualized/dist/commonjs/Table/defaultCellRenderer.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Table/defaultCellRenderer'>;
}
declare module 'react-virtualized/dist/commonjs/Table/defaultHeaderRenderer.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Table/defaultHeaderRenderer'>;
}
declare module 'react-virtualized/dist/commonjs/Table/defaultHeaderRowRenderer.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Table/defaultHeaderRowRenderer'>;
}
declare module 'react-virtualized/dist/commonjs/Table/defaultRowRenderer.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Table/defaultRowRenderer'>;
}
declare module 'react-virtualized/dist/commonjs/Table/index.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Table/index'>;
}
declare module 'react-virtualized/dist/commonjs/Table/SortDirection.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Table/SortDirection'>;
}
declare module 'react-virtualized/dist/commonjs/Table/SortIndicator.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Table/SortIndicator'>;
}
declare module 'react-virtualized/dist/commonjs/Table/Table.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Table/Table.jest'>;
}
declare module 'react-virtualized/dist/commonjs/Table/Table.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Table/Table'>;
}
declare module 'react-virtualized/dist/commonjs/Table/types.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/Table/types'>;
}
declare module 'react-virtualized/dist/commonjs/TestUtils.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/TestUtils'>;
}
declare module 'react-virtualized/dist/commonjs/utils/animationFrame.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/utils/animationFrame'>;
}
declare module 'react-virtualized/dist/commonjs/utils/createCallbackMemoizer.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/utils/createCallbackMemoizer.jest'>;
}
declare module 'react-virtualized/dist/commonjs/utils/createCallbackMemoizer.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/utils/createCallbackMemoizer'>;
}
declare module 'react-virtualized/dist/commonjs/utils/getUpdatedOffsetForIndex.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/utils/getUpdatedOffsetForIndex.jest'>;
}
declare module 'react-virtualized/dist/commonjs/utils/getUpdatedOffsetForIndex.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/utils/getUpdatedOffsetForIndex'>;
}
declare module 'react-virtualized/dist/commonjs/utils/initCellMetadata.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/utils/initCellMetadata'>;
}
declare module 'react-virtualized/dist/commonjs/utils/requestAnimationTimeout.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/utils/requestAnimationTimeout'>;
}
declare module 'react-virtualized/dist/commonjs/utils/TestHelper.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/utils/TestHelper'>;
}
declare module 'react-virtualized/dist/commonjs/vendor/binarySearchBounds.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/vendor/binarySearchBounds'>;
}
declare module 'react-virtualized/dist/commonjs/vendor/detectElementResize.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/vendor/detectElementResize'>;
}
declare module 'react-virtualized/dist/commonjs/vendor/intervalTree.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/vendor/intervalTree'>;
}
declare module 'react-virtualized/dist/commonjs/WindowScroller/index.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/WindowScroller/index'>;
}
declare module 'react-virtualized/dist/commonjs/WindowScroller/utils/dimensions.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/WindowScroller/utils/dimensions'>;
}
declare module 'react-virtualized/dist/commonjs/WindowScroller/utils/onScroll.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/WindowScroller/utils/onScroll'>;
}
declare module 'react-virtualized/dist/commonjs/WindowScroller/WindowScroller.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/WindowScroller/WindowScroller.jest'>;
}
declare module 'react-virtualized/dist/commonjs/WindowScroller/WindowScroller.js' {
  declare module.exports: $Exports<'react-virtualized/dist/commonjs/WindowScroller/WindowScroller'>;
}
declare module 'react-virtualized/dist/es/ArrowKeyStepper/ArrowKeyStepper.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/ArrowKeyStepper/ArrowKeyStepper.jest'>;
}
declare module 'react-virtualized/dist/es/ArrowKeyStepper/ArrowKeyStepper.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/ArrowKeyStepper/ArrowKeyStepper'>;
}
declare module 'react-virtualized/dist/es/ArrowKeyStepper/index.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/ArrowKeyStepper/index'>;
}
declare module 'react-virtualized/dist/es/ArrowKeyStepper/types.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/ArrowKeyStepper/types'>;
}
declare module 'react-virtualized/dist/es/AutoSizer/AutoSizer.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/AutoSizer/AutoSizer.jest'>;
}
declare module 'react-virtualized/dist/es/AutoSizer/AutoSizer.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/AutoSizer/AutoSizer'>;
}
declare module 'react-virtualized/dist/es/AutoSizer/index.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/AutoSizer/index'>;
}
declare module 'react-virtualized/dist/es/AutoSizer/types.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/AutoSizer/types'>;
}
declare module 'react-virtualized/dist/es/CellMeasurer/CellMeasurer.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/CellMeasurer/CellMeasurer.jest'>;
}
declare module 'react-virtualized/dist/es/CellMeasurer/CellMeasurer.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/CellMeasurer/CellMeasurer'>;
}
declare module 'react-virtualized/dist/es/CellMeasurer/CellMeasurerCache.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/CellMeasurer/CellMeasurerCache.jest'>;
}
declare module 'react-virtualized/dist/es/CellMeasurer/CellMeasurerCache.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/CellMeasurer/CellMeasurerCache'>;
}
declare module 'react-virtualized/dist/es/CellMeasurer/index.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/CellMeasurer/index'>;
}
declare module 'react-virtualized/dist/es/Collection/Collection.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Collection/Collection.jest'>;
}
declare module 'react-virtualized/dist/es/Collection/Collection.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Collection/Collection'>;
}
declare module 'react-virtualized/dist/es/Collection/CollectionView.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Collection/CollectionView'>;
}
declare module 'react-virtualized/dist/es/Collection/index.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Collection/index'>;
}
declare module 'react-virtualized/dist/es/Collection/Section.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Collection/Section.jest'>;
}
declare module 'react-virtualized/dist/es/Collection/Section.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Collection/Section'>;
}
declare module 'react-virtualized/dist/es/Collection/SectionManager.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Collection/SectionManager.jest'>;
}
declare module 'react-virtualized/dist/es/Collection/SectionManager.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Collection/SectionManager'>;
}
declare module 'react-virtualized/dist/es/Collection/TestData.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Collection/TestData'>;
}
declare module 'react-virtualized/dist/es/Collection/types.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Collection/types'>;
}
declare module 'react-virtualized/dist/es/Collection/utils/calculateSizeAndPositionData.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Collection/utils/calculateSizeAndPositionData.jest'>;
}
declare module 'react-virtualized/dist/es/Collection/utils/calculateSizeAndPositionData.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Collection/utils/calculateSizeAndPositionData'>;
}
declare module 'react-virtualized/dist/es/ColumnSizer/ColumnSizer.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/ColumnSizer/ColumnSizer.jest'>;
}
declare module 'react-virtualized/dist/es/ColumnSizer/ColumnSizer.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/ColumnSizer/ColumnSizer'>;
}
declare module 'react-virtualized/dist/es/ColumnSizer/index.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/ColumnSizer/index'>;
}
declare module 'react-virtualized/dist/es/Grid/accessibilityOverscanIndicesGetter.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Grid/accessibilityOverscanIndicesGetter.jest'>;
}
declare module 'react-virtualized/dist/es/Grid/accessibilityOverscanIndicesGetter.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Grid/accessibilityOverscanIndicesGetter'>;
}
declare module 'react-virtualized/dist/es/Grid/defaultCellRangeRenderer.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Grid/defaultCellRangeRenderer'>;
}
declare module 'react-virtualized/dist/es/Grid/defaultOverscanIndicesGetter.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Grid/defaultOverscanIndicesGetter.jest'>;
}
declare module 'react-virtualized/dist/es/Grid/defaultOverscanIndicesGetter.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Grid/defaultOverscanIndicesGetter'>;
}
declare module 'react-virtualized/dist/es/Grid/Grid.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Grid/Grid.jest'>;
}
declare module 'react-virtualized/dist/es/Grid/Grid.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Grid/Grid'>;
}
declare module 'react-virtualized/dist/es/Grid/index.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Grid/index'>;
}
declare module 'react-virtualized/dist/es/Grid/types.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Grid/types'>;
}
declare module 'react-virtualized/dist/es/Grid/utils/calculateSizeAndPositionDataAndUpdateScrollOffset.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Grid/utils/calculateSizeAndPositionDataAndUpdateScrollOffset.jest'>;
}
declare module 'react-virtualized/dist/es/Grid/utils/calculateSizeAndPositionDataAndUpdateScrollOffset.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Grid/utils/calculateSizeAndPositionDataAndUpdateScrollOffset'>;
}
declare module 'react-virtualized/dist/es/Grid/utils/CellSizeAndPositionManager.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Grid/utils/CellSizeAndPositionManager.jest'>;
}
declare module 'react-virtualized/dist/es/Grid/utils/CellSizeAndPositionManager.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Grid/utils/CellSizeAndPositionManager'>;
}
declare module 'react-virtualized/dist/es/Grid/utils/ScalingCellSizeAndPositionManager.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Grid/utils/ScalingCellSizeAndPositionManager.jest'>;
}
declare module 'react-virtualized/dist/es/Grid/utils/ScalingCellSizeAndPositionManager.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Grid/utils/ScalingCellSizeAndPositionManager'>;
}
declare module 'react-virtualized/dist/es/Grid/utils/updateScrollIndexHelper.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Grid/utils/updateScrollIndexHelper.jest'>;
}
declare module 'react-virtualized/dist/es/Grid/utils/updateScrollIndexHelper.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Grid/utils/updateScrollIndexHelper'>;
}
declare module 'react-virtualized/dist/es/index.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/index'>;
}
declare module 'react-virtualized/dist/es/InfiniteLoader/index.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/InfiniteLoader/index'>;
}
declare module 'react-virtualized/dist/es/InfiniteLoader/InfiniteLoader.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/InfiniteLoader/InfiniteLoader.jest'>;
}
declare module 'react-virtualized/dist/es/InfiniteLoader/InfiniteLoader.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/InfiniteLoader/InfiniteLoader'>;
}
declare module 'react-virtualized/dist/es/jest-setup.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/jest-setup'>;
}
declare module 'react-virtualized/dist/es/List/index.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/List/index'>;
}
declare module 'react-virtualized/dist/es/List/List.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/List/List.jest'>;
}
declare module 'react-virtualized/dist/es/List/List.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/List/List'>;
}
declare module 'react-virtualized/dist/es/List/types.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/List/types'>;
}
declare module 'react-virtualized/dist/es/Masonry/createCellPositioner.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Masonry/createCellPositioner'>;
}
declare module 'react-virtualized/dist/es/Masonry/index.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Masonry/index'>;
}
declare module 'react-virtualized/dist/es/Masonry/Masonry.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Masonry/Masonry.jest'>;
}
declare module 'react-virtualized/dist/es/Masonry/Masonry.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Masonry/Masonry'>;
}
declare module 'react-virtualized/dist/es/Masonry/PositionCache.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Masonry/PositionCache'>;
}
declare module 'react-virtualized/dist/es/MultiGrid/CellMeasurerCacheDecorator.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/MultiGrid/CellMeasurerCacheDecorator'>;
}
declare module 'react-virtualized/dist/es/MultiGrid/index.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/MultiGrid/index'>;
}
declare module 'react-virtualized/dist/es/MultiGrid/MultiGrid.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/MultiGrid/MultiGrid.jest'>;
}
declare module 'react-virtualized/dist/es/MultiGrid/MultiGrid.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/MultiGrid/MultiGrid'>;
}
declare module 'react-virtualized/dist/es/ScrollSync/index.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/ScrollSync/index'>;
}
declare module 'react-virtualized/dist/es/ScrollSync/ScrollSync.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/ScrollSync/ScrollSync.jest'>;
}
declare module 'react-virtualized/dist/es/ScrollSync/ScrollSync.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/ScrollSync/ScrollSync'>;
}
declare module 'react-virtualized/dist/es/Table/Column.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Table/Column.jest'>;
}
declare module 'react-virtualized/dist/es/Table/Column.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Table/Column'>;
}
declare module 'react-virtualized/dist/es/Table/defaultCellDataGetter.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Table/defaultCellDataGetter'>;
}
declare module 'react-virtualized/dist/es/Table/defaultCellRenderer.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Table/defaultCellRenderer'>;
}
declare module 'react-virtualized/dist/es/Table/defaultHeaderRenderer.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Table/defaultHeaderRenderer'>;
}
declare module 'react-virtualized/dist/es/Table/defaultHeaderRowRenderer.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Table/defaultHeaderRowRenderer'>;
}
declare module 'react-virtualized/dist/es/Table/defaultRowRenderer.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Table/defaultRowRenderer'>;
}
declare module 'react-virtualized/dist/es/Table/index.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Table/index'>;
}
declare module 'react-virtualized/dist/es/Table/SortDirection.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Table/SortDirection'>;
}
declare module 'react-virtualized/dist/es/Table/SortIndicator.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Table/SortIndicator'>;
}
declare module 'react-virtualized/dist/es/Table/Table.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Table/Table.jest'>;
}
declare module 'react-virtualized/dist/es/Table/Table.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Table/Table'>;
}
declare module 'react-virtualized/dist/es/Table/types.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/Table/types'>;
}
declare module 'react-virtualized/dist/es/TestUtils.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/TestUtils'>;
}
declare module 'react-virtualized/dist/es/utils/animationFrame.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/utils/animationFrame'>;
}
declare module 'react-virtualized/dist/es/utils/createCallbackMemoizer.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/utils/createCallbackMemoizer.jest'>;
}
declare module 'react-virtualized/dist/es/utils/createCallbackMemoizer.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/utils/createCallbackMemoizer'>;
}
declare module 'react-virtualized/dist/es/utils/getUpdatedOffsetForIndex.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/utils/getUpdatedOffsetForIndex.jest'>;
}
declare module 'react-virtualized/dist/es/utils/getUpdatedOffsetForIndex.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/utils/getUpdatedOffsetForIndex'>;
}
declare module 'react-virtualized/dist/es/utils/initCellMetadata.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/utils/initCellMetadata'>;
}
declare module 'react-virtualized/dist/es/utils/requestAnimationTimeout.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/utils/requestAnimationTimeout'>;
}
declare module 'react-virtualized/dist/es/utils/TestHelper.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/utils/TestHelper'>;
}
declare module 'react-virtualized/dist/es/vendor/binarySearchBounds.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/vendor/binarySearchBounds'>;
}
declare module 'react-virtualized/dist/es/vendor/detectElementResize.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/vendor/detectElementResize'>;
}
declare module 'react-virtualized/dist/es/vendor/intervalTree.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/vendor/intervalTree'>;
}
declare module 'react-virtualized/dist/es/WindowScroller/index.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/WindowScroller/index'>;
}
declare module 'react-virtualized/dist/es/WindowScroller/utils/dimensions.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/WindowScroller/utils/dimensions'>;
}
declare module 'react-virtualized/dist/es/WindowScroller/utils/onScroll.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/WindowScroller/utils/onScroll'>;
}
declare module 'react-virtualized/dist/es/WindowScroller/WindowScroller.jest.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/WindowScroller/WindowScroller.jest'>;
}
declare module 'react-virtualized/dist/es/WindowScroller/WindowScroller.js' {
  declare module.exports: $Exports<'react-virtualized/dist/es/WindowScroller/WindowScroller'>;
}
declare module 'react-virtualized/dist/umd/react-virtualized.js' {
  declare module.exports: $Exports<'react-virtualized/dist/umd/react-virtualized'>;
}
// flow-typed signature: cca4916b0213065533df8335c3285a4a
// flow-typed version: cab04034e7/redux_v3.x.x/flow_>=v0.55.x

declare module 'redux' {

  /*

    S = State
    A = Action
    D = Dispatch

  */

  declare export type DispatchAPI<A> = (action: A) => A;
  declare export type Dispatch<A: { type: $Subtype<string> }> = DispatchAPI<A>;

  declare export type MiddlewareAPI<S, A, D = Dispatch<A>> = {
    dispatch: D;
    getState(): S;
  };

  declare export type Store<S, A, D = Dispatch<A>> = {
    // rewrite MiddlewareAPI members in order to get nicer error messages (intersections produce long messages)
    dispatch: D;
    getState(): S;
    subscribe(listener: () => void): () => void;
    replaceReducer(nextReducer: Reducer<S, A>): void
  };

  declare export type Reducer<S, A> = (state: S | void, action: A) => S;

  declare export type CombinedReducer<S, A> = (state: $Shape<S> & {} | void, action: A) => S;

  declare export type Middleware<S, A, D = Dispatch<A>> =
    (api: MiddlewareAPI<S, A, D>) =>
      (next: D) => D;

  declare export type StoreCreator<S, A, D = Dispatch<A>> = {
    (reducer: Reducer<S, A>, enhancer?: StoreEnhancer<S, A, D>): Store<S, A, D>;
    (reducer: Reducer<S, A>, preloadedState: S, enhancer?: StoreEnhancer<S, A, D>): Store<S, A, D>;
  };

  declare export type StoreEnhancer<S, A, D = Dispatch<A>> = (next: StoreCreator<S, A, D>) => StoreCreator<S, A, D>;

  declare export function createStore<S, A, D>(reducer: Reducer<S, A>, enhancer?: StoreEnhancer<S, A, D>): Store<S, A, D>;
  declare export function createStore<S, A, D>(reducer: Reducer<S, A>, preloadedState?: S, enhancer?: StoreEnhancer<S, A, D>): Store<S, A, D>;

  declare export function applyMiddleware<S, A, D>(...middlewares: Array<Middleware<S, A, D>>): StoreEnhancer<S, A, D>;

  declare export type ActionCreator<A, B> = (...args: Array<B>) => A;
  declare export type ActionCreators<K, A> = { [key: K]: ActionCreator<A, any> };

  declare export function bindActionCreators<A, C: ActionCreator<A, any>, D: DispatchAPI<A>>(actionCreator: C, dispatch: D): C;
  declare export function bindActionCreators<A, K, C: ActionCreators<K, A>, D: DispatchAPI<A>>(actionCreators: C, dispatch: D): C;

  declare export function combineReducers<O: Object, A>(reducers: O): CombinedReducer<$ObjMap<O, <S>(r: Reducer<S, any>) => S>, A>;

  declare export var compose: $Compose;
}

declare module 'rsocket-core' {
  declare module.exports: $Exports<'rsocket-core'>;
}

declare module 'rsocket-tcp-server' {
  declare module.exports: $Exports<'rsocket-tcp-server'>;
}
// flow-typed signature: 843db49f208e061075c2c057f6db5c4d
// flow-typed version: <<STUB>>/string-natural-compare_v^2.0.2/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'string-natural-compare'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'string-natural-compare' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'string-natural-compare/natural-compare' {
  declare module.exports: any;
}

// Filename aliases
declare module 'string-natural-compare/natural-compare.js' {
  declare module.exports: $Exports<'string-natural-compare/natural-compare'>;
}
// flow-typed signature: ab12cb0bb6ca55414cab3e4d58ebf17e
// flow-typed version: <<STUB>>/vis_v4.21.0/flow_v0.69.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'vis'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'vis' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'vis/dist/vis-graph3d.min' {
  declare module.exports: any;
}

declare module 'vis/dist/vis-network.min' {
  declare module.exports: any;
}

declare module 'vis/dist/vis-timeline-graph2d.min' {
  declare module.exports: any;
}

declare module 'vis/dist/vis' {
  declare module.exports: any;
}

declare module 'vis/dist/vis.min' {
  declare module.exports: any;
}

declare module 'vis/docs/js/bootstrap' {
  declare module.exports: any;
}

declare module 'vis/docs/js/bootstrap.min' {
  declare module.exports: any;
}

declare module 'vis/docs/js/docs.min' {
  declare module.exports: any;
}

declare module 'vis/docs/js/googleAnalytics' {
  declare module.exports: any;
}

declare module 'vis/docs/js/ie-emulation-modes-warning' {
  declare module.exports: any;
}

declare module 'vis/docs/js/ie10-viewport-bug-workaround' {
  declare module.exports: any;
}

declare module 'vis/docs/js/jquery.highlight' {
  declare module.exports: any;
}

declare module 'vis/docs/js/jquery.min' {
  declare module.exports: any;
}

declare module 'vis/docs/js/jquery.url.min' {
  declare module.exports: any;
}

declare module 'vis/docs/js/main' {
  declare module.exports: any;
}

declare module 'vis/docs/js/prettify/lang-apollo' {
  declare module.exports: any;
}

declare module 'vis/docs/js/prettify/lang-css' {
  declare module.exports: any;
}

declare module 'vis/docs/js/prettify/lang-hs' {
  declare module.exports: any;
}

declare module 'vis/docs/js/prettify/lang-lisp' {
  declare module.exports: any;
}

declare module 'vis/docs/js/prettify/lang-lua' {
  declare module.exports: any;
}

declare module 'vis/docs/js/prettify/lang-ml' {
  declare module.exports: any;
}

declare module 'vis/docs/js/prettify/lang-proto' {
  declare module.exports: any;
}

declare module 'vis/docs/js/prettify/lang-scala' {
  declare module.exports: any;
}

declare module 'vis/docs/js/prettify/lang-sql' {
  declare module.exports: any;
}

declare module 'vis/docs/js/prettify/lang-vb' {
  declare module.exports: any;
}

declare module 'vis/docs/js/prettify/lang-vhdl' {
  declare module.exports: any;
}

declare module 'vis/docs/js/prettify/lang-wiki' {
  declare module.exports: any;
}

declare module 'vis/docs/js/prettify/lang-yaml' {
  declare module.exports: any;
}

declare module 'vis/docs/js/prettify/prettify' {
  declare module.exports: any;
}

declare module 'vis/docs/js/smooth-scroll.min' {
  declare module.exports: any;
}

declare module 'vis/docs/js/tipuesearch.config' {
  declare module.exports: any;
}

declare module 'vis/docs/js/tipuesearch' {
  declare module.exports: any;
}

declare module 'vis/docs/js/tipuesearch.min' {
  declare module.exports: any;
}

declare module 'vis/docs/js/toggleTable' {
  declare module.exports: any;
}

declare module 'vis/examples/graph3d/playground/csv2array' {
  declare module.exports: any;
}

declare module 'vis/examples/graph3d/playground/playground' {
  declare module.exports: any;
}

declare module 'vis/examples/graph3d/playground/prettify/lang-apollo' {
  declare module.exports: any;
}

declare module 'vis/examples/graph3d/playground/prettify/lang-css' {
  declare module.exports: any;
}

declare module 'vis/examples/graph3d/playground/prettify/lang-hs' {
  declare module.exports: any;
}

declare module 'vis/examples/graph3d/playground/prettify/lang-lisp' {
  declare module.exports: any;
}

declare module 'vis/examples/graph3d/playground/prettify/lang-lua' {
  declare module.exports: any;
}

declare module 'vis/examples/graph3d/playground/prettify/lang-ml' {
  declare module.exports: any;
}

declare module 'vis/examples/graph3d/playground/prettify/lang-proto' {
  declare module.exports: any;
}

declare module 'vis/examples/graph3d/playground/prettify/lang-scala' {
  declare module.exports: any;
}

declare module 'vis/examples/graph3d/playground/prettify/lang-sql' {
  declare module.exports: any;
}

declare module 'vis/examples/graph3d/playground/prettify/lang-vb' {
  declare module.exports: any;
}

declare module 'vis/examples/graph3d/playground/prettify/lang-vhdl' {
  declare module.exports: any;
}

declare module 'vis/examples/graph3d/playground/prettify/lang-wiki' {
  declare module.exports: any;
}

declare module 'vis/examples/graph3d/playground/prettify/lang-yaml' {
  declare module.exports: any;
}

declare module 'vis/examples/graph3d/playground/prettify/prettify' {
  declare module.exports: any;
}

declare module 'vis/examples/network/datasources/largeHierarchicalDataset' {
  declare module.exports: any;
}

declare module 'vis/examples/network/datasources/WorldCup2014' {
  declare module.exports: any;
}

declare module 'vis/examples/network/exampleApplications/disassemblerExample' {
  declare module.exports: any;
}

declare module 'vis/examples/network/exampleUtil' {
  declare module.exports: any;
}

declare module 'vis/examples/timeline/other/requirejs/scripts/main' {
  declare module.exports: any;
}

declare module 'vis/examples/timeline/other/requirejs/scripts/require' {
  declare module.exports: any;
}

declare module 'vis/gulpfile' {
  declare module.exports: any;
}

declare module 'vis/index-graph3d' {
  declare module.exports: any;
}

declare module 'vis/index-network' {
  declare module.exports: any;
}

declare module 'vis/index-timeline-graph2d' {
  declare module.exports: any;
}

declare module 'vis/lib/DataSet' {
  declare module.exports: any;
}

declare module 'vis/lib/DataView' {
  declare module.exports: any;
}

declare module 'vis/lib/DOMutil' {
  declare module.exports: any;
}

declare module 'vis/lib/graph3d/Camera' {
  declare module.exports: any;
}

declare module 'vis/lib/graph3d/DataGroup' {
  declare module.exports: any;
}

declare module 'vis/lib/graph3d/Filter' {
  declare module.exports: any;
}

declare module 'vis/lib/graph3d/Graph3d' {
  declare module.exports: any;
}

declare module 'vis/lib/graph3d/options' {
  declare module.exports: any;
}

declare module 'vis/lib/graph3d/Point2d' {
  declare module.exports: any;
}

declare module 'vis/lib/graph3d/Point3d' {
  declare module.exports: any;
}

declare module 'vis/lib/graph3d/Range' {
  declare module.exports: any;
}

declare module 'vis/lib/graph3d/Settings' {
  declare module.exports: any;
}

declare module 'vis/lib/graph3d/Slider' {
  declare module.exports: any;
}

declare module 'vis/lib/graph3d/StepNumber' {
  declare module.exports: any;
}

declare module 'vis/lib/hammerUtil' {
  declare module.exports: any;
}

declare module 'vis/lib/header' {
  declare module.exports: any;
}

declare module 'vis/lib/module/hammer' {
  declare module.exports: any;
}

declare module 'vis/lib/module/moment' {
  declare module.exports: any;
}

declare module 'vis/lib/module/uuid' {
  declare module.exports: any;
}

declare module 'vis/lib/network/CachedImage' {
  declare module.exports: any;
}

declare module 'vis/lib/network/dotparser' {
  declare module.exports: any;
}

declare module 'vis/lib/network/gephiParser' {
  declare module.exports: any;
}

declare module 'vis/lib/network/Images' {
  declare module.exports: any;
}

declare module 'vis/lib/network/locales' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/Canvas' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/CanvasRenderer' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/Clustering' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/algorithms/FloydWarshall' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/DirectionStrategy' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/Edge' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/edges/BezierEdgeDynamic' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/edges/BezierEdgeStatic' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/edges/CubicBezierEdge' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/edges/StraightEdge' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/edges/util/BezierEdgeBase' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/edges/util/CubicBezierEdgeBase' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/edges/util/EdgeBase' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/edges/util/EndPoints' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/NavigationHandler' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/Node' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/nodes/Cluster' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/nodes/shapes/Box' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/nodes/shapes/Circle' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/nodes/shapes/CircularImage' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/nodes/shapes/Database' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/nodes/shapes/Diamond' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/nodes/shapes/Dot' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/nodes/shapes/Ellipse' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/nodes/shapes/Hexagon' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/nodes/shapes/Icon' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/nodes/shapes/Image' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/nodes/shapes/Square' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/nodes/shapes/Star' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/nodes/shapes/Text' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/nodes/shapes/Triangle' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/nodes/shapes/TriangleDown' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/nodes/util/CircleImageBase' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/nodes/util/NodeBase' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/nodes/util/ShapeBase' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/physics/BarnesHutSolver' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/physics/CentralGravitySolver' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/physics/FA2BasedCentralGravitySolver' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/physics/FA2BasedRepulsionSolver' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/physics/HierarchicalRepulsionSolver' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/physics/HierarchicalSpringSolver' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/physics/RepulsionSolver' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/physics/SpringSolver' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/shared/ComponentUtil' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/shared/Label' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/shared/LabelAccumulator' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/components/shared/LabelSplitter' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/EdgesHandler' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/Groups' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/InteractionHandler' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/KamadaKawai' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/LayoutEngine' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/ManipulationSystem' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/NodesHandler' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/PhysicsEngine' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/SelectionHandler' {
  declare module.exports: any;
}

declare module 'vis/lib/network/modules/View' {
  declare module.exports: any;
}

declare module 'vis/lib/network/Network' {
  declare module.exports: any;
}

declare module 'vis/lib/network/NetworkUtil' {
  declare module.exports: any;
}

declare module 'vis/lib/network/options' {
  declare module.exports: any;
}

declare module 'vis/lib/network/shapes' {
  declare module.exports: any;
}

declare module 'vis/lib/Queue' {
  declare module.exports: any;
}

declare module 'vis/lib/shared/Activator' {
  declare module.exports: any;
}

declare module 'vis/lib/shared/ColorPicker' {
  declare module.exports: any;
}

declare module 'vis/lib/shared/Configurator' {
  declare module.exports: any;
}

declare module 'vis/lib/shared/Popup' {
  declare module.exports: any;
}

declare module 'vis/lib/shared/Validator' {
  declare module.exports: any;
}

declare module 'vis/lib/timeline/component/BackgroundGroup' {
  declare module.exports: any;
}

declare module 'vis/lib/timeline/component/Component' {
  declare module.exports: any;
}

declare module 'vis/lib/timeline/component/CurrentTime' {
  declare module.exports: any;
}

declare module 'vis/lib/timeline/component/CustomTime' {
  declare module.exports: any;
}

declare module 'vis/lib/timeline/component/DataAxis' {
  declare module.exports: any;
}

declare module 'vis/lib/timeline/component/DataScale' {
  declare module.exports: any;
}

declare module 'vis/lib/timeline/component/graph2d_types/bar' {
  declare module.exports: any;
}

declare module 'vis/lib/timeline/component/graph2d_types/line' {
  declare module.exports: any;
}

declare module 'vis/lib/timeline/component/graph2d_types/points' {
  declare module.exports: any;
}

declare module 'vis/lib/timeline/component/GraphGroup' {
  declare module.exports: any;
}

declare module 'vis/lib/timeline/component/Group' {
  declare module.exports: any;
}

declare module 'vis/lib/timeline/component/item/BackgroundItem' {
  declare module.exports: any;
}

declare module 'vis/lib/timeline/component/item/BoxItem' {
  declare module.exports: any;
}

declare module 'vis/lib/timeline/component/item/Item' {
  declare module.exports: any;
}

declare module 'vis/lib/timeline/component/item/PointItem' {
  declare module.exports: any;
}

declare module 'vis/lib/timeline/component/item/RangeItem' {
  declare module.exports: any;
}

declare module 'vis/lib/timeline/component/ItemSet' {
  declare module.exports: any;
}

declare module 'vis/lib/timeline/component/Legend' {
  declare module.exports: any;
}

declare module 'vis/lib/timeline/component/LineGraph' {
  declare module.exports: any;
}

declare module 'vis/lib/timeline/component/TimeAxis' {
  declare module.exports: any;
}

declare module 'vis/lib/timeline/Core' {
  declare module.exports: any;
}

declare module 'vis/lib/timeline/DateUtil' {
  declare module.exports: any;
}

declare module 'vis/lib/timeline/Graph2d' {
  declare module.exports: any;
}

declare module 'vis/lib/timeline/locales' {
  declare module.exports: any;
}

declare module 'vis/lib/timeline/optionsGraph2d' {
  declare module.exports: any;
}

declare module 'vis/lib/timeline/optionsTimeline' {
  declare module.exports: any;
}

declare module 'vis/lib/timeline/Range' {
  declare module.exports: any;
}

declare module 'vis/lib/timeline/Stack' {
  declare module.exports: any;
}

declare module 'vis/lib/timeline/Timeline' {
  declare module.exports: any;
}

declare module 'vis/lib/timeline/TimeStep' {
  declare module.exports: any;
}

declare module 'vis/lib/util' {
  declare module.exports: any;
}

// Filename aliases
declare module 'vis/dist/vis-graph3d.min.js' {
  declare module.exports: $Exports<'vis/dist/vis-graph3d.min'>;
}
declare module 'vis/dist/vis-network.min.js' {
  declare module.exports: $Exports<'vis/dist/vis-network.min'>;
}
declare module 'vis/dist/vis-timeline-graph2d.min.js' {
  declare module.exports: $Exports<'vis/dist/vis-timeline-graph2d.min'>;
}
declare module 'vis/dist/vis.js' {
  declare module.exports: $Exports<'vis/dist/vis'>;
}
declare module 'vis/dist/vis.min.js' {
  declare module.exports: $Exports<'vis/dist/vis.min'>;
}
declare module 'vis/docs/js/bootstrap.js' {
  declare module.exports: $Exports<'vis/docs/js/bootstrap'>;
}
declare module 'vis/docs/js/bootstrap.min.js' {
  declare module.exports: $Exports<'vis/docs/js/bootstrap.min'>;
}
declare module 'vis/docs/js/docs.min.js' {
  declare module.exports: $Exports<'vis/docs/js/docs.min'>;
}
declare module 'vis/docs/js/googleAnalytics.js' {
  declare module.exports: $Exports<'vis/docs/js/googleAnalytics'>;
}
declare module 'vis/docs/js/ie-emulation-modes-warning.js' {
  declare module.exports: $Exports<'vis/docs/js/ie-emulation-modes-warning'>;
}
declare module 'vis/docs/js/ie10-viewport-bug-workaround.js' {
  declare module.exports: $Exports<'vis/docs/js/ie10-viewport-bug-workaround'>;
}
declare module 'vis/docs/js/jquery.highlight.js' {
  declare module.exports: $Exports<'vis/docs/js/jquery.highlight'>;
}
declare module 'vis/docs/js/jquery.min.js' {
  declare module.exports: $Exports<'vis/docs/js/jquery.min'>;
}
declare module 'vis/docs/js/jquery.url.min.js' {
  declare module.exports: $Exports<'vis/docs/js/jquery.url.min'>;
}
declare module 'vis/docs/js/main.js' {
  declare module.exports: $Exports<'vis/docs/js/main'>;
}
declare module 'vis/docs/js/prettify/lang-apollo.js' {
  declare module.exports: $Exports<'vis/docs/js/prettify/lang-apollo'>;
}
declare module 'vis/docs/js/prettify/lang-css.js' {
  declare module.exports: $Exports<'vis/docs/js/prettify/lang-css'>;
}
declare module 'vis/docs/js/prettify/lang-hs.js' {
  declare module.exports: $Exports<'vis/docs/js/prettify/lang-hs'>;
}
declare module 'vis/docs/js/prettify/lang-lisp.js' {
  declare module.exports: $Exports<'vis/docs/js/prettify/lang-lisp'>;
}
declare module 'vis/docs/js/prettify/lang-lua.js' {
  declare module.exports: $Exports<'vis/docs/js/prettify/lang-lua'>;
}
declare module 'vis/docs/js/prettify/lang-ml.js' {
  declare module.exports: $Exports<'vis/docs/js/prettify/lang-ml'>;
}
declare module 'vis/docs/js/prettify/lang-proto.js' {
  declare module.exports: $Exports<'vis/docs/js/prettify/lang-proto'>;
}
declare module 'vis/docs/js/prettify/lang-scala.js' {
  declare module.exports: $Exports<'vis/docs/js/prettify/lang-scala'>;
}
declare module 'vis/docs/js/prettify/lang-sql.js' {
  declare module.exports: $Exports<'vis/docs/js/prettify/lang-sql'>;
}
declare module 'vis/docs/js/prettify/lang-vb.js' {
  declare module.exports: $Exports<'vis/docs/js/prettify/lang-vb'>;
}
declare module 'vis/docs/js/prettify/lang-vhdl.js' {
  declare module.exports: $Exports<'vis/docs/js/prettify/lang-vhdl'>;
}
declare module 'vis/docs/js/prettify/lang-wiki.js' {
  declare module.exports: $Exports<'vis/docs/js/prettify/lang-wiki'>;
}
declare module 'vis/docs/js/prettify/lang-yaml.js' {
  declare module.exports: $Exports<'vis/docs/js/prettify/lang-yaml'>;
}
declare module 'vis/docs/js/prettify/prettify.js' {
  declare module.exports: $Exports<'vis/docs/js/prettify/prettify'>;
}
declare module 'vis/docs/js/smooth-scroll.min.js' {
  declare module.exports: $Exports<'vis/docs/js/smooth-scroll.min'>;
}
declare module 'vis/docs/js/tipuesearch.config.js' {
  declare module.exports: $Exports<'vis/docs/js/tipuesearch.config'>;
}
declare module 'vis/docs/js/tipuesearch.js' {
  declare module.exports: $Exports<'vis/docs/js/tipuesearch'>;
}
declare module 'vis/docs/js/tipuesearch.min.js' {
  declare module.exports: $Exports<'vis/docs/js/tipuesearch.min'>;
}
declare module 'vis/docs/js/toggleTable.js' {
  declare module.exports: $Exports<'vis/docs/js/toggleTable'>;
}
declare module 'vis/examples/graph3d/playground/csv2array.js' {
  declare module.exports: $Exports<'vis/examples/graph3d/playground/csv2array'>;
}
declare module 'vis/examples/graph3d/playground/playground.js' {
  declare module.exports: $Exports<'vis/examples/graph3d/playground/playground'>;
}
declare module 'vis/examples/graph3d/playground/prettify/lang-apollo.js' {
  declare module.exports: $Exports<'vis/examples/graph3d/playground/prettify/lang-apollo'>;
}
declare module 'vis/examples/graph3d/playground/prettify/lang-css.js' {
  declare module.exports: $Exports<'vis/examples/graph3d/playground/prettify/lang-css'>;
}
declare module 'vis/examples/graph3d/playground/prettify/lang-hs.js' {
  declare module.exports: $Exports<'vis/examples/graph3d/playground/prettify/lang-hs'>;
}
declare module 'vis/examples/graph3d/playground/prettify/lang-lisp.js' {
  declare module.exports: $Exports<'vis/examples/graph3d/playground/prettify/lang-lisp'>;
}
declare module 'vis/examples/graph3d/playground/prettify/lang-lua.js' {
  declare module.exports: $Exports<'vis/examples/graph3d/playground/prettify/lang-lua'>;
}
declare module 'vis/examples/graph3d/playground/prettify/lang-ml.js' {
  declare module.exports: $Exports<'vis/examples/graph3d/playground/prettify/lang-ml'>;
}
declare module 'vis/examples/graph3d/playground/prettify/lang-proto.js' {
  declare module.exports: $Exports<'vis/examples/graph3d/playground/prettify/lang-proto'>;
}
declare module 'vis/examples/graph3d/playground/prettify/lang-scala.js' {
  declare module.exports: $Exports<'vis/examples/graph3d/playground/prettify/lang-scala'>;
}
declare module 'vis/examples/graph3d/playground/prettify/lang-sql.js' {
  declare module.exports: $Exports<'vis/examples/graph3d/playground/prettify/lang-sql'>;
}
declare module 'vis/examples/graph3d/playground/prettify/lang-vb.js' {
  declare module.exports: $Exports<'vis/examples/graph3d/playground/prettify/lang-vb'>;
}
declare module 'vis/examples/graph3d/playground/prettify/lang-vhdl.js' {
  declare module.exports: $Exports<'vis/examples/graph3d/playground/prettify/lang-vhdl'>;
}
declare module 'vis/examples/graph3d/playground/prettify/lang-wiki.js' {
  declare module.exports: $Exports<'vis/examples/graph3d/playground/prettify/lang-wiki'>;
}
declare module 'vis/examples/graph3d/playground/prettify/lang-yaml.js' {
  declare module.exports: $Exports<'vis/examples/graph3d/playground/prettify/lang-yaml'>;
}
declare module 'vis/examples/graph3d/playground/prettify/prettify.js' {
  declare module.exports: $Exports<'vis/examples/graph3d/playground/prettify/prettify'>;
}
declare module 'vis/examples/network/datasources/largeHierarchicalDataset.js' {
  declare module.exports: $Exports<'vis/examples/network/datasources/largeHierarchicalDataset'>;
}
declare module 'vis/examples/network/datasources/WorldCup2014.js' {
  declare module.exports: $Exports<'vis/examples/network/datasources/WorldCup2014'>;
}
declare module 'vis/examples/network/exampleApplications/disassemblerExample.js' {
  declare module.exports: $Exports<'vis/examples/network/exampleApplications/disassemblerExample'>;
}
declare module 'vis/examples/network/exampleUtil.js' {
  declare module.exports: $Exports<'vis/examples/network/exampleUtil'>;
}
declare module 'vis/examples/timeline/other/requirejs/scripts/main.js' {
  declare module.exports: $Exports<'vis/examples/timeline/other/requirejs/scripts/main'>;
}
declare module 'vis/examples/timeline/other/requirejs/scripts/require.js' {
  declare module.exports: $Exports<'vis/examples/timeline/other/requirejs/scripts/require'>;
}
declare module 'vis/gulpfile.js' {
  declare module.exports: $Exports<'vis/gulpfile'>;
}
declare module 'vis/index-graph3d.js' {
  declare module.exports: $Exports<'vis/index-graph3d'>;
}
declare module 'vis/index-network.js' {
  declare module.exports: $Exports<'vis/index-network'>;
}
declare module 'vis/index-timeline-graph2d.js' {
  declare module.exports: $Exports<'vis/index-timeline-graph2d'>;
}
declare module 'vis/index' {
  declare module.exports: $Exports<'vis'>;
}
declare module 'vis/index.js' {
  declare module.exports: $Exports<'vis'>;
}
declare module 'vis/lib/DataSet.js' {
  declare module.exports: $Exports<'vis/lib/DataSet'>;
}
declare module 'vis/lib/DataView.js' {
  declare module.exports: $Exports<'vis/lib/DataView'>;
}
declare module 'vis/lib/DOMutil.js' {
  declare module.exports: $Exports<'vis/lib/DOMutil'>;
}
declare module 'vis/lib/graph3d/Camera.js' {
  declare module.exports: $Exports<'vis/lib/graph3d/Camera'>;
}
declare module 'vis/lib/graph3d/DataGroup.js' {
  declare module.exports: $Exports<'vis/lib/graph3d/DataGroup'>;
}
declare module 'vis/lib/graph3d/Filter.js' {
  declare module.exports: $Exports<'vis/lib/graph3d/Filter'>;
}
declare module 'vis/lib/graph3d/Graph3d.js' {
  declare module.exports: $Exports<'vis/lib/graph3d/Graph3d'>;
}
declare module 'vis/lib/graph3d/options.js' {
  declare module.exports: $Exports<'vis/lib/graph3d/options'>;
}
declare module 'vis/lib/graph3d/Point2d.js' {
  declare module.exports: $Exports<'vis/lib/graph3d/Point2d'>;
}
declare module 'vis/lib/graph3d/Point3d.js' {
  declare module.exports: $Exports<'vis/lib/graph3d/Point3d'>;
}
declare module 'vis/lib/graph3d/Range.js' {
  declare module.exports: $Exports<'vis/lib/graph3d/Range'>;
}
declare module 'vis/lib/graph3d/Settings.js' {
  declare module.exports: $Exports<'vis/lib/graph3d/Settings'>;
}
declare module 'vis/lib/graph3d/Slider.js' {
  declare module.exports: $Exports<'vis/lib/graph3d/Slider'>;
}
declare module 'vis/lib/graph3d/StepNumber.js' {
  declare module.exports: $Exports<'vis/lib/graph3d/StepNumber'>;
}
declare module 'vis/lib/hammerUtil.js' {
  declare module.exports: $Exports<'vis/lib/hammerUtil'>;
}
declare module 'vis/lib/header.js' {
  declare module.exports: $Exports<'vis/lib/header'>;
}
declare module 'vis/lib/module/hammer.js' {
  declare module.exports: $Exports<'vis/lib/module/hammer'>;
}
declare module 'vis/lib/module/moment.js' {
  declare module.exports: $Exports<'vis/lib/module/moment'>;
}
declare module 'vis/lib/module/uuid.js' {
  declare module.exports: $Exports<'vis/lib/module/uuid'>;
}
declare module 'vis/lib/network/CachedImage.js' {
  declare module.exports: $Exports<'vis/lib/network/CachedImage'>;
}
declare module 'vis/lib/network/dotparser.js' {
  declare module.exports: $Exports<'vis/lib/network/dotparser'>;
}
declare module 'vis/lib/network/gephiParser.js' {
  declare module.exports: $Exports<'vis/lib/network/gephiParser'>;
}
declare module 'vis/lib/network/Images.js' {
  declare module.exports: $Exports<'vis/lib/network/Images'>;
}
declare module 'vis/lib/network/locales.js' {
  declare module.exports: $Exports<'vis/lib/network/locales'>;
}
declare module 'vis/lib/network/modules/Canvas.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/Canvas'>;
}
declare module 'vis/lib/network/modules/CanvasRenderer.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/CanvasRenderer'>;
}
declare module 'vis/lib/network/modules/Clustering.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/Clustering'>;
}
declare module 'vis/lib/network/modules/components/algorithms/FloydWarshall.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/algorithms/FloydWarshall'>;
}
declare module 'vis/lib/network/modules/components/DirectionStrategy.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/DirectionStrategy'>;
}
declare module 'vis/lib/network/modules/components/Edge.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/Edge'>;
}
declare module 'vis/lib/network/modules/components/edges/BezierEdgeDynamic.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/edges/BezierEdgeDynamic'>;
}
declare module 'vis/lib/network/modules/components/edges/BezierEdgeStatic.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/edges/BezierEdgeStatic'>;
}
declare module 'vis/lib/network/modules/components/edges/CubicBezierEdge.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/edges/CubicBezierEdge'>;
}
declare module 'vis/lib/network/modules/components/edges/StraightEdge.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/edges/StraightEdge'>;
}
declare module 'vis/lib/network/modules/components/edges/util/BezierEdgeBase.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/edges/util/BezierEdgeBase'>;
}
declare module 'vis/lib/network/modules/components/edges/util/CubicBezierEdgeBase.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/edges/util/CubicBezierEdgeBase'>;
}
declare module 'vis/lib/network/modules/components/edges/util/EdgeBase.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/edges/util/EdgeBase'>;
}
declare module 'vis/lib/network/modules/components/edges/util/EndPoints.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/edges/util/EndPoints'>;
}
declare module 'vis/lib/network/modules/components/NavigationHandler.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/NavigationHandler'>;
}
declare module 'vis/lib/network/modules/components/Node.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/Node'>;
}
declare module 'vis/lib/network/modules/components/nodes/Cluster.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/nodes/Cluster'>;
}
declare module 'vis/lib/network/modules/components/nodes/shapes/Box.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/nodes/shapes/Box'>;
}
declare module 'vis/lib/network/modules/components/nodes/shapes/Circle.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/nodes/shapes/Circle'>;
}
declare module 'vis/lib/network/modules/components/nodes/shapes/CircularImage.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/nodes/shapes/CircularImage'>;
}
declare module 'vis/lib/network/modules/components/nodes/shapes/Database.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/nodes/shapes/Database'>;
}
declare module 'vis/lib/network/modules/components/nodes/shapes/Diamond.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/nodes/shapes/Diamond'>;
}
declare module 'vis/lib/network/modules/components/nodes/shapes/Dot.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/nodes/shapes/Dot'>;
}
declare module 'vis/lib/network/modules/components/nodes/shapes/Ellipse.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/nodes/shapes/Ellipse'>;
}
declare module 'vis/lib/network/modules/components/nodes/shapes/Hexagon.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/nodes/shapes/Hexagon'>;
}
declare module 'vis/lib/network/modules/components/nodes/shapes/Icon.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/nodes/shapes/Icon'>;
}
declare module 'vis/lib/network/modules/components/nodes/shapes/Image.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/nodes/shapes/Image'>;
}
declare module 'vis/lib/network/modules/components/nodes/shapes/Square.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/nodes/shapes/Square'>;
}
declare module 'vis/lib/network/modules/components/nodes/shapes/Star.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/nodes/shapes/Star'>;
}
declare module 'vis/lib/network/modules/components/nodes/shapes/Text.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/nodes/shapes/Text'>;
}
declare module 'vis/lib/network/modules/components/nodes/shapes/Triangle.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/nodes/shapes/Triangle'>;
}
declare module 'vis/lib/network/modules/components/nodes/shapes/TriangleDown.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/nodes/shapes/TriangleDown'>;
}
declare module 'vis/lib/network/modules/components/nodes/util/CircleImageBase.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/nodes/util/CircleImageBase'>;
}
declare module 'vis/lib/network/modules/components/nodes/util/NodeBase.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/nodes/util/NodeBase'>;
}
declare module 'vis/lib/network/modules/components/nodes/util/ShapeBase.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/nodes/util/ShapeBase'>;
}
declare module 'vis/lib/network/modules/components/physics/BarnesHutSolver.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/physics/BarnesHutSolver'>;
}
declare module 'vis/lib/network/modules/components/physics/CentralGravitySolver.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/physics/CentralGravitySolver'>;
}
declare module 'vis/lib/network/modules/components/physics/FA2BasedCentralGravitySolver.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/physics/FA2BasedCentralGravitySolver'>;
}
declare module 'vis/lib/network/modules/components/physics/FA2BasedRepulsionSolver.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/physics/FA2BasedRepulsionSolver'>;
}
declare module 'vis/lib/network/modules/components/physics/HierarchicalRepulsionSolver.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/physics/HierarchicalRepulsionSolver'>;
}
declare module 'vis/lib/network/modules/components/physics/HierarchicalSpringSolver.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/physics/HierarchicalSpringSolver'>;
}
declare module 'vis/lib/network/modules/components/physics/RepulsionSolver.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/physics/RepulsionSolver'>;
}
declare module 'vis/lib/network/modules/components/physics/SpringSolver.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/physics/SpringSolver'>;
}
declare module 'vis/lib/network/modules/components/shared/ComponentUtil.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/shared/ComponentUtil'>;
}
declare module 'vis/lib/network/modules/components/shared/Label.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/shared/Label'>;
}
declare module 'vis/lib/network/modules/components/shared/LabelAccumulator.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/shared/LabelAccumulator'>;
}
declare module 'vis/lib/network/modules/components/shared/LabelSplitter.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/components/shared/LabelSplitter'>;
}
declare module 'vis/lib/network/modules/EdgesHandler.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/EdgesHandler'>;
}
declare module 'vis/lib/network/modules/Groups.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/Groups'>;
}
declare module 'vis/lib/network/modules/InteractionHandler.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/InteractionHandler'>;
}
declare module 'vis/lib/network/modules/KamadaKawai.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/KamadaKawai'>;
}
declare module 'vis/lib/network/modules/LayoutEngine.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/LayoutEngine'>;
}
declare module 'vis/lib/network/modules/ManipulationSystem.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/ManipulationSystem'>;
}
declare module 'vis/lib/network/modules/NodesHandler.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/NodesHandler'>;
}
declare module 'vis/lib/network/modules/PhysicsEngine.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/PhysicsEngine'>;
}
declare module 'vis/lib/network/modules/SelectionHandler.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/SelectionHandler'>;
}
declare module 'vis/lib/network/modules/View.js' {
  declare module.exports: $Exports<'vis/lib/network/modules/View'>;
}
declare module 'vis/lib/network/Network.js' {
  declare module.exports: $Exports<'vis/lib/network/Network'>;
}
declare module 'vis/lib/network/NetworkUtil.js' {
  declare module.exports: $Exports<'vis/lib/network/NetworkUtil'>;
}
declare module 'vis/lib/network/options.js' {
  declare module.exports: $Exports<'vis/lib/network/options'>;
}
declare module 'vis/lib/network/shapes.js' {
  declare module.exports: $Exports<'vis/lib/network/shapes'>;
}
declare module 'vis/lib/Queue.js' {
  declare module.exports: $Exports<'vis/lib/Queue'>;
}
declare module 'vis/lib/shared/Activator.js' {
  declare module.exports: $Exports<'vis/lib/shared/Activator'>;
}
declare module 'vis/lib/shared/ColorPicker.js' {
  declare module.exports: $Exports<'vis/lib/shared/ColorPicker'>;
}
declare module 'vis/lib/shared/Configurator.js' {
  declare module.exports: $Exports<'vis/lib/shared/Configurator'>;
}
declare module 'vis/lib/shared/Popup.js' {
  declare module.exports: $Exports<'vis/lib/shared/Popup'>;
}
declare module 'vis/lib/shared/Validator.js' {
  declare module.exports: $Exports<'vis/lib/shared/Validator'>;
}
declare module 'vis/lib/timeline/component/BackgroundGroup.js' {
  declare module.exports: $Exports<'vis/lib/timeline/component/BackgroundGroup'>;
}
declare module 'vis/lib/timeline/component/Component.js' {
  declare module.exports: $Exports<'vis/lib/timeline/component/Component'>;
}
declare module 'vis/lib/timeline/component/CurrentTime.js' {
  declare module.exports: $Exports<'vis/lib/timeline/component/CurrentTime'>;
}
declare module 'vis/lib/timeline/component/CustomTime.js' {
  declare module.exports: $Exports<'vis/lib/timeline/component/CustomTime'>;
}
declare module 'vis/lib/timeline/component/DataAxis.js' {
  declare module.exports: $Exports<'vis/lib/timeline/component/DataAxis'>;
}
declare module 'vis/lib/timeline/component/DataScale.js' {
  declare module.exports: $Exports<'vis/lib/timeline/component/DataScale'>;
}
declare module 'vis/lib/timeline/component/graph2d_types/bar.js' {
  declare module.exports: $Exports<'vis/lib/timeline/component/graph2d_types/bar'>;
}
declare module 'vis/lib/timeline/component/graph2d_types/line.js' {
  declare module.exports: $Exports<'vis/lib/timeline/component/graph2d_types/line'>;
}
declare module 'vis/lib/timeline/component/graph2d_types/points.js' {
  declare module.exports: $Exports<'vis/lib/timeline/component/graph2d_types/points'>;
}
declare module 'vis/lib/timeline/component/GraphGroup.js' {
  declare module.exports: $Exports<'vis/lib/timeline/component/GraphGroup'>;
}
declare module 'vis/lib/timeline/component/Group.js' {
  declare module.exports: $Exports<'vis/lib/timeline/component/Group'>;
}
declare module 'vis/lib/timeline/component/item/BackgroundItem.js' {
  declare module.exports: $Exports<'vis/lib/timeline/component/item/BackgroundItem'>;
}
declare module 'vis/lib/timeline/component/item/BoxItem.js' {
  declare module.exports: $Exports<'vis/lib/timeline/component/item/BoxItem'>;
}
declare module 'vis/lib/timeline/component/item/Item.js' {
  declare module.exports: $Exports<'vis/lib/timeline/component/item/Item'>;
}
declare module 'vis/lib/timeline/component/item/PointItem.js' {
  declare module.exports: $Exports<'vis/lib/timeline/component/item/PointItem'>;
}
declare module 'vis/lib/timeline/component/item/RangeItem.js' {
  declare module.exports: $Exports<'vis/lib/timeline/component/item/RangeItem'>;
}
declare module 'vis/lib/timeline/component/ItemSet.js' {
  declare module.exports: $Exports<'vis/lib/timeline/component/ItemSet'>;
}
declare module 'vis/lib/timeline/component/Legend.js' {
  declare module.exports: $Exports<'vis/lib/timeline/component/Legend'>;
}
declare module 'vis/lib/timeline/component/LineGraph.js' {
  declare module.exports: $Exports<'vis/lib/timeline/component/LineGraph'>;
}
declare module 'vis/lib/timeline/component/TimeAxis.js' {
  declare module.exports: $Exports<'vis/lib/timeline/component/TimeAxis'>;
}
declare module 'vis/lib/timeline/Core.js' {
  declare module.exports: $Exports<'vis/lib/timeline/Core'>;
}
declare module 'vis/lib/timeline/DateUtil.js' {
  declare module.exports: $Exports<'vis/lib/timeline/DateUtil'>;
}
declare module 'vis/lib/timeline/Graph2d.js' {
  declare module.exports: $Exports<'vis/lib/timeline/Graph2d'>;
}
declare module 'vis/lib/timeline/locales.js' {
  declare module.exports: $Exports<'vis/lib/timeline/locales'>;
}
declare module 'vis/lib/timeline/optionsGraph2d.js' {
  declare module.exports: $Exports<'vis/lib/timeline/optionsGraph2d'>;
}
declare module 'vis/lib/timeline/optionsTimeline.js' {
  declare module.exports: $Exports<'vis/lib/timeline/optionsTimeline'>;
}
declare module 'vis/lib/timeline/Range.js' {
  declare module.exports: $Exports<'vis/lib/timeline/Range'>;
}
declare module 'vis/lib/timeline/Stack.js' {
  declare module.exports: $Exports<'vis/lib/timeline/Stack'>;
}
declare module 'vis/lib/timeline/Timeline.js' {
  declare module.exports: $Exports<'vis/lib/timeline/Timeline'>;
}
declare module 'vis/lib/timeline/TimeStep.js' {
  declare module.exports: $Exports<'vis/lib/timeline/TimeStep'>;
}
declare module 'vis/lib/util.js' {
  declare module.exports: $Exports<'vis/lib/util'>;
}
// flow-typed signature: a099122576a24c7a78325271cdd0048f
// flow-typed version: <<STUB>>/websocket_v^1.0.24/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'websocket'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'websocket' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'websocket/gulpfile' {
  declare module.exports: any;
}

declare module 'websocket/lib/browser' {
  declare module.exports: any;
}

declare module 'websocket/lib/BufferUtil.fallback' {
  declare module.exports: any;
}

declare module 'websocket/lib/BufferUtil' {
  declare module.exports: any;
}

declare module 'websocket/lib/Deprecation' {
  declare module.exports: any;
}

declare module 'websocket/lib/utils' {
  declare module.exports: any;
}

declare module 'websocket/lib/Validation.fallback' {
  declare module.exports: any;
}

declare module 'websocket/lib/Validation' {
  declare module.exports: any;
}

declare module 'websocket/lib/version' {
  declare module.exports: any;
}

declare module 'websocket/lib/W3CWebSocket' {
  declare module.exports: any;
}

declare module 'websocket/lib/websocket' {
  declare module.exports: any;
}

declare module 'websocket/lib/WebSocketClient' {
  declare module.exports: any;
}

declare module 'websocket/lib/WebSocketConnection' {
  declare module.exports: any;
}

declare module 'websocket/lib/WebSocketFrame' {
  declare module.exports: any;
}

declare module 'websocket/lib/WebSocketRequest' {
  declare module.exports: any;
}

declare module 'websocket/lib/WebSocketRouter' {
  declare module.exports: any;
}

declare module 'websocket/lib/WebSocketRouterRequest' {
  declare module.exports: any;
}

declare module 'websocket/lib/WebSocketServer' {
  declare module.exports: any;
}

declare module 'websocket/vendor/FastBufferList' {
  declare module.exports: any;
}

// Filename aliases
declare module 'websocket/gulpfile.js' {
  declare module.exports: $Exports<'websocket/gulpfile'>;
}
declare module 'websocket/index' {
  declare module.exports: $Exports<'websocket'>;
}
declare module 'websocket/index.js' {
  declare module.exports: $Exports<'websocket'>;
}
declare module 'websocket/lib/browser.js' {
  declare module.exports: $Exports<'websocket/lib/browser'>;
}
declare module 'websocket/lib/BufferUtil.fallback.js' {
  declare module.exports: $Exports<'websocket/lib/BufferUtil.fallback'>;
}
declare module 'websocket/lib/BufferUtil.js' {
  declare module.exports: $Exports<'websocket/lib/BufferUtil'>;
}
declare module 'websocket/lib/Deprecation.js' {
  declare module.exports: $Exports<'websocket/lib/Deprecation'>;
}
declare module 'websocket/lib/utils.js' {
  declare module.exports: $Exports<'websocket/lib/utils'>;
}
declare module 'websocket/lib/Validation.fallback.js' {
  declare module.exports: $Exports<'websocket/lib/Validation.fallback'>;
}
declare module 'websocket/lib/Validation.js' {
  declare module.exports: $Exports<'websocket/lib/Validation'>;
}
declare module 'websocket/lib/version.js' {
  declare module.exports: $Exports<'websocket/lib/version'>;
}
declare module 'websocket/lib/W3CWebSocket.js' {
  declare module.exports: $Exports<'websocket/lib/W3CWebSocket'>;
}
declare module 'websocket/lib/websocket.js' {
  declare module.exports: $Exports<'websocket/lib/websocket'>;
}
declare module 'websocket/lib/WebSocketClient.js' {
  declare module.exports: $Exports<'websocket/lib/WebSocketClient'>;
}
declare module 'websocket/lib/WebSocketConnection.js' {
  declare module.exports: $Exports<'websocket/lib/WebSocketConnection'>;
}
declare module 'websocket/lib/WebSocketFrame.js' {
  declare module.exports: $Exports<'websocket/lib/WebSocketFrame'>;
}
declare module 'websocket/lib/WebSocketRequest.js' {
  declare module.exports: $Exports<'websocket/lib/WebSocketRequest'>;
}
declare module 'websocket/lib/WebSocketRouter.js' {
  declare module.exports: $Exports<'websocket/lib/WebSocketRouter'>;
}
declare module 'websocket/lib/WebSocketRouterRequest.js' {
  declare module.exports: $Exports<'websocket/lib/WebSocketRouterRequest'>;
}
declare module 'websocket/lib/WebSocketServer.js' {
  declare module.exports: $Exports<'websocket/lib/WebSocketServer'>;
}
declare module 'websocket/vendor/FastBufferList.js' {
  declare module.exports: $Exports<'websocket/vendor/FastBufferList'>;
}
// flow-typed signature: efc8a980cb830128a9eaa7f9ee01567b
// flow-typed version: <<STUB>>/ws_v^3.0.0/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'ws'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'ws' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'ws/lib/BufferUtil' {
  declare module.exports: any;
}

declare module 'ws/lib/Constants' {
  declare module.exports: any;
}

declare module 'ws/lib/ErrorCodes' {
  declare module.exports: any;
}

declare module 'ws/lib/EventTarget' {
  declare module.exports: any;
}

declare module 'ws/lib/Extensions' {
  declare module.exports: any;
}

declare module 'ws/lib/PerMessageDeflate' {
  declare module.exports: any;
}

declare module 'ws/lib/Receiver' {
  declare module.exports: any;
}

declare module 'ws/lib/Sender' {
  declare module.exports: any;
}

declare module 'ws/lib/Validation' {
  declare module.exports: any;
}

declare module 'ws/lib/WebSocket' {
  declare module.exports: any;
}

declare module 'ws/lib/WebSocketServer' {
  declare module.exports: any;
}

// Filename aliases
declare module 'ws/index' {
  declare module.exports: $Exports<'ws'>;
}
declare module 'ws/index.js' {
  declare module.exports: $Exports<'ws'>;
}
declare module 'ws/lib/BufferUtil.js' {
  declare module.exports: $Exports<'ws/lib/BufferUtil'>;
}
declare module 'ws/lib/Constants.js' {
  declare module.exports: $Exports<'ws/lib/Constants'>;
}
declare module 'ws/lib/ErrorCodes.js' {
  declare module.exports: $Exports<'ws/lib/ErrorCodes'>;
}
declare module 'ws/lib/EventTarget.js' {
  declare module.exports: $Exports<'ws/lib/EventTarget'>;
}
declare module 'ws/lib/Extensions.js' {
  declare module.exports: $Exports<'ws/lib/Extensions'>;
}
declare module 'ws/lib/PerMessageDeflate.js' {
  declare module.exports: $Exports<'ws/lib/PerMessageDeflate'>;
}
declare module 'ws/lib/Receiver.js' {
  declare module.exports: $Exports<'ws/lib/Receiver'>;
}
declare module 'ws/lib/Sender.js' {
  declare module.exports: $Exports<'ws/lib/Sender'>;
}
declare module 'ws/lib/Validation.js' {
  declare module.exports: $Exports<'ws/lib/Validation'>;
}
declare module 'ws/lib/WebSocket.js' {
  declare module.exports: $Exports<'ws/lib/WebSocket'>;
}
declare module 'ws/lib/WebSocketServer.js' {
  declare module.exports: $Exports<'ws/lib/WebSocketServer'>;
}
// flow-typed signature: 3efe3623a87ff36c0bcfb0fbcdbdf729
// flow-typed version: <<STUB>>/yargs_v^10.0.3/flow_v0.59.0

/**
 * This is an autogenerated libdef stub for:
 *
 *   'yargs'
 *
 * Fill this stub out by replacing all the `any` types.
 *
 * Once filled out, we encourage you to share your work with the
 * community by sending a pull request to:
 * https://github.com/flowtype/flow-typed
 */

declare module 'yargs' {
  declare module.exports: any;
}

/**
 * We include stubs for each file inside this npm package in case you need to
 * require those files directly. Feel free to delete any files that aren't
 * needed.
 */
declare module 'yargs/lib/apply-extends' {
  declare module.exports: any;
}

declare module 'yargs/lib/argsert' {
  declare module.exports: any;
}

declare module 'yargs/lib/command' {
  declare module.exports: any;
}

declare module 'yargs/lib/completion' {
  declare module.exports: any;
}

declare module 'yargs/lib/levenshtein' {
  declare module.exports: any;
}

declare module 'yargs/lib/obj-filter' {
  declare module.exports: any;
}

declare module 'yargs/lib/usage' {
  declare module.exports: any;
}

declare module 'yargs/lib/validation' {
  declare module.exports: any;
}

declare module 'yargs/lib/yerror' {
  declare module.exports: any;
}

declare module 'yargs/yargs' {
  declare module.exports: any;
}

// Filename aliases
declare module 'yargs/index' {
  declare module.exports: $Exports<'yargs'>;
}
declare module 'yargs/index.js' {
  declare module.exports: $Exports<'yargs'>;
}
declare module 'yargs/lib/apply-extends.js' {
  declare module.exports: $Exports<'yargs/lib/apply-extends'>;
}
declare module 'yargs/lib/argsert.js' {
  declare module.exports: $Exports<'yargs/lib/argsert'>;
}
declare module 'yargs/lib/command.js' {
  declare module.exports: $Exports<'yargs/lib/command'>;
}
declare module 'yargs/lib/completion.js' {
  declare module.exports: $Exports<'yargs/lib/completion'>;
}
declare module 'yargs/lib/levenshtein.js' {
  declare module.exports: $Exports<'yargs/lib/levenshtein'>;
}
declare module 'yargs/lib/obj-filter.js' {
  declare module.exports: $Exports<'yargs/lib/obj-filter'>;
}
declare module 'yargs/lib/usage.js' {
  declare module.exports: $Exports<'yargs/lib/usage'>;
}
declare module 'yargs/lib/validation.js' {
  declare module.exports: $Exports<'yargs/lib/validation'>;
}
declare module 'yargs/lib/yerror.js' {
  declare module.exports: $Exports<'yargs/lib/yerror'>;
}
declare module 'yargs/yargs.js' {
  declare module.exports: $Exports<'yargs/yargs'>;
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <ComponentKit/CKComponent.h>
#import <SonarKit/SKMacros.h>
#import <SonarKitLayoutPlugin/SKNamed.h>
#import <SonarKitLayoutPlugin/SKNodeDescriptor.h>

FB_LINK_REQUIRE(CKComponent_Sonar)
@interface CKComponent (Sonar)

- (NSArray<SKNamed<NSDictionary<NSString *, NSObject *> *> *> *)sonar_getData;
- (NSDictionary<NSString *, SKNodeUpdateData> *)sonar_getDataMutations;
- (NSString *)sonar_getName;
- (NSString *)sonar_getDecoration;

@end
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <ComponentKit/CKFlexboxComponent.h>
#import <SonarKit/SKMacros.h>

FB_LINK_REQUIRE(CKFlexboxComponent_Sonar)
@interface CKFlexboxComponent (Sonar)

@end
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <ComponentKit/CKInsetComponent.h>
#import <SonarKit/SKMacros.h>

FB_LINK_REQUIRE(CKInsetComponent_Sonar)
@interface CKInsetComponent (Sonar)

@end
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <SonarKitLayoutPlugin/SKNodeDescriptor.h>

@class CKComponentHostingView;

@interface SKComponentHostingViewDescriptor : SKNodeDescriptor<CKComponentHostingView *>

@end
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <SonarKitLayoutPlugin/SKNodeDescriptor.h>

@class SKComponentLayoutWrapper;

@interface SKComponentLayoutDescriptor: SKNodeDescriptor<SKComponentLayoutWrapper *>

@end
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <Foundation/Foundation.h>

#import <ComponentKit/CKComponentLayout.h>
#import <ComponentKit/CKFlexboxComponent.h>

@protocol CKInspectableView;

@interface SKComponentLayoutWrapper : NSObject

@property (nonatomic, weak, readonly) CKComponent *component;
@property (nonatomic, readonly) NSString *identifier;
@property (nonatomic, readonly) CGSize size;
@property (nonatomic, readonly) CGPoint position;
@property (nonatomic, readonly) std::vector<SKComponentLayoutWrapper *> children;

// Null for layouts which are not direct children of a CKFlexboxComponent
@property (nonatomic, readonly) BOOL isFlexboxChild;
@property (nonatomic, readonly) CKFlexboxComponentChild flexboxChild;

+ (instancetype)newFromRoot:(id<CKInspectableView>)root;

@end
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <SonarKitLayoutPlugin/SKNodeDescriptor.h>

@class CKComponentRootView;

@interface SKComponentRootViewDescriptor : SKNodeDescriptor<CKComponentRootView *>

@end
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <Foundation/Foundation.h>

#import <SonarKitLayoutPlugin/SKDescriptorMapper.h>

@interface SonarKitLayoutComponentKitSupport : NSObject

+ (void)setUpWithDescriptorMapper:(SKDescriptorMapper *)mapper;

@end
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <ComponentKit/CKComponent.h>
#import <ComponentKit/CKFlexboxComponent.h>

NSString *relativeDimension(CKRelativeDimension dimension);
NSDictionary<NSString *, NSString *> *flexboxRect(CKFlexboxSpacing spacing);
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <Foundation/Foundation.h>

@class SKNodeDescriptor;

@interface SKDescriptorMapper : NSObject

- (instancetype)initWithDefaults;

- (SKNodeDescriptor *)descriptorForClass:(Class)cls;

- (void)registerDescriptor:(SKNodeDescriptor *)descriptor forClass:(Class)cls;

- (NSArray<SKNodeDescriptor *> *)allDescriptors;

@end
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <UIKit/UIKit.h>

@interface SKHighlightOverlay : NSObject

+ (instancetype)sharedInstance;
+ (UIColor*)overlayColor;

- (void)mountInView:(UIView *)view withFrame:(CGRect)frame;
- (void)unmount;

@end
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <Foundation/Foundation.h>

@protocol SKInvalidationDelegate

- (void)invalidateNode:(id<NSObject>)node;

- (void)updateNodeReference:(id<NSObject>)node;

@end

@interface SKInvalidation : NSObject

+ (instancetype)sharedInstance;

+ (void)enableInvalidations;

@property (nonatomic, weak) id<SKInvalidationDelegate> delegate;

@end
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <Foundation/Foundation.h>

@interface SKNamed<__covariant T> : NSObject

+ (instancetype)newWithName:(NSString *)name withValue:(T)value;

@property (nonatomic, readonly) NSString *name;
@property (nonatomic, readonly) T value;

@end
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <UIKit/UIKit.h>

#import "SKDescriptorMapper.h"
#import "SKNamed.h"
#import "SKTouch.h"

typedef void (^SKNodeUpdateData)(id value);

/**
 A SKNodeDescriptor is an object which know how to expose an Object of type T
 to SonarKitLayoutPlugin. This class is the extension point for SonarKitLayoutPlugin and
 is how custom objects or data can be exposed to Sonar.
 */
@interface SKNodeDescriptor<__covariant T> : NSObject

/**
 If the descriptor class is dependent on some set-up, use this.
 This is invoked once Sonar connects.
 */
- (void)setUp;

/**
 Initializes the node-descriptor with a SKDescriptorMapper which contains mappings
 between Class -> SKNodeDescriptor<Class>.
 */
- (instancetype)initWithDescriptorMapper:(SKDescriptorMapper *)mapper;

/**
 Gets the node-descriptor registered for a specific class.
 */
- (SKNodeDescriptor *)descriptorForClass:(Class)cls;

/**
  A globally unique ID used to identify a node in the hierarchy. This is used
  in the communication between SonarKitLayoutPlugin and the Sonar desktop application
  in order to identify nodes.
 */
- (NSString *)identifierForNode:(T)node;

/**
  The name used to identify this node in the Sonar desktop application. This is what
  will be visible in the hierarchy.
 */
- (NSString *)nameForNode:(T)node;

/**
  The number of children this node exposes in the layout hierarchy.
 */
- (NSUInteger)childCountForNode:(T)node;

/**
  Get the child for a specific node at a specified index.
 */
- (id)childForNode:(T)node atIndex:(NSUInteger)index;

/**
 Get the data to show for this node in the sidebar of the Sonar application. The objects
 will be shown in order by SKNamed.name as their header.
 */
- (NSArray<SKNamed<NSDictionary *> *> *)dataForNode:(T)node;

/**
 Get the attributes for this node. Attributes will be showed in the Sonar application right
 next to the name of the node.
 */
- (NSArray<SKNamed<NSString *> *> *)attributesForNode:(T)node;

/**
 A mapping of the path for a specific value, and a block responsible for updating
 its corresponding value for a specific node.

 The paths (string) is dependent on what `dataForNode` returns (e.g "SKNodeDescriptor.name").
 */
- (NSDictionary<NSString *, SKNodeUpdateData> *)dataMutationsForNode:(T)node;

/**
 This is used in order to highlight any specific node which is currently
 selected in the Sonar application. The plugin automatically takes care of de-selecting
 the previously highlighted node.
 */
- (void)setHighlighted:(BOOL)highlighted forNode:(T)node;

/**
 Perform hit testing on the given node. Either continue the search in
 one of the children of the node, or finish the hit testing on this
 node.
 */
- (void)hitTest:(SKTouch *)point forNode:(T)node;

/**
 Invalidate a specific node. This is called once a node is removed or added
 from or to the layout hierarchy.
 */
- (void)invalidateNode:(T)node;

/**
 The decoration for this node. Valid values are defined in the Sonar
 applictation.
 */
- (NSString *)decorationForNode:(T)node;

/**
 Whether the node matches the given query.
 Used for layout search.
 */
- (BOOL)matchesQuery:(NSString *)query forNode:(T)node;

@end
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <UIKit/UIKit.h>

@protocol SKSonarValueCoder

+ (instancetype)fromSonarValue:(id)sonarValue;

- (NSDictionary<NSString *, id<NSObject>> *)sonarValue;

@end

class SKObject {
public:
  SKObject(CGRect rect);
  SKObject(CGSize size);
  SKObject(CGPoint point);
  SKObject(UIEdgeInsets insets);
  SKObject(CGAffineTransform transform);
  SKObject(id<SKSonarValueCoder> value);
  SKObject(id value);

  operator id<NSObject> () const noexcept {
    return _actual ?: [NSNull null];
  }
protected:
  id<NSObject> _actual;
};

class SKMutableObject : public SKObject {
public:
  SKMutableObject(CGRect rect) : SKObject(rect) { }
  SKMutableObject(CGSize size) : SKObject(size) { };
  SKMutableObject(CGPoint point) : SKObject(point) { };
  SKMutableObject(UIEdgeInsets insets) : SKObject(insets) { };
  SKMutableObject(CGAffineTransform transform) : SKObject(transform) { };
  SKMutableObject(id<SKSonarValueCoder> value) : SKObject(value) { };
  SKMutableObject(id value) : SKObject(value) { };

  operator id<NSObject> () {
    convertToMutable();
    return _actual;
  }
protected:
  BOOL _convertedToMutable = NO;
  void convertToMutable();
};
/*
 *  Copyright (c) 2004-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#ifndef SKSearchResultNode_h
#define SKSearchResultNode_h

#import <Foundation/Foundation.h>

@interface SKSearchResultNode : NSObject

@property (nonatomic, copy, readonly) NSString *nodeId;

- (instancetype)initWithNode:(NSString *)nodeId
                     asMatch:(BOOL)isMatch
                 withElement:(NSDictionary *)element
                 andChildren:(NSArray<SKSearchResultNode *> *)children;

- (NSDictionary *)toNSDictionary;

@end
#endif /* SKSearchResultNode_h */
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <UIKit/UIKit.h>

typedef void (^SKTapReceiver)(CGPoint touchPoint);

@protocol SKTapListener

@property (nonatomic, readonly) BOOL isMounted;

- (void)mountWithFrame:(CGRect)frame;

- (void)unmount;

- (void)listenForTapWithBlock:(SKTapReceiver)receiver;

@end
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import "SKTapListener.h"

@interface SKTapListenerImpl : NSObject<SKTapListener, UIGestureRecognizerDelegate>

@end
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <UIKit/UIKit.h>

#import "SKDescriptorMapper.h"

typedef void (^SKTouchFinishDelegate)(NSArray<NSString *> *path);

@interface SKTouch : NSObject

- (instancetype)initWithTouchPoint:(CGPoint)touchPoint
                       withRootNode:(id<NSObject>)node
              withDescriptorMapper:(SKDescriptorMapper *)mapper
                    finishWithBlock:(SKTouchFinishDelegate)d;

- (void)continueWithChildIndex:(NSUInteger)childIndex
                     withOffset:(CGPoint)offset;

- (void)finish;

- (BOOL)containedIn:(CGRect)bounds;

@end
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#if FB_SONARKIT_ENABLED

#import <Foundation/Foundation.h>

#import <SonarKit/SonarPlugin.h>

#import "SKTapListener.h"
#import "SKInvalidation.h"
#import "SKDescriptorMapper.h"

@interface SonarKitLayoutPlugin : NSObject<SonarPlugin, SKInvalidationDelegate>

- (instancetype)initWithRootNode:(id<NSObject>)rootNode
            withDescriptorMapper:(SKDescriptorMapper *)mapper;

- (instancetype)initWithRootNode:(id<NSObject>)rootNode
                 withTapListener:(id<SKTapListener>)tapListener
            withDescriptorMapper:(SKDescriptorMapper *)mapper;

@property (nonatomic, readonly, strong) SKDescriptorMapper *descriptorMapper;

@end

#endif
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <UIKit/UIKit.h>

#import <SonarKit/SKMacros.h>

FB_LINK_REQUIRE(UICollectionView_SKInvalidation)
@interface UICollectionView (SKInvalidation)

+ (void)enableInvalidations;

@end
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <UIKit/UIKit.h>

#import <SonarKit/SKMacros.h>

#import "SKObject.h"

FB_LINK_REQUIRE(UIColor_SonarValueCoder)
@interface UIColor (SonarValueCoder) <SKSonarValueCoder>

@end
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <SonarKit/SKMacros.h>

FB_LINK_REQUIRE(UIView_SKInvalidation)
@interface UIView (SKInvalidation)

+ (void)enableInvalidation;

@end
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <UIKit/UIKit.h>

#import "SKNodeDescriptor.h"

@interface SKApplicationDescriptor : SKNodeDescriptor<UIApplication *>

@end
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <UIKit/UIKit.h>

#import "SKNodeDescriptor.h"

@class UIButton;

@interface SKButtonDescriptor : SKNodeDescriptor<UIButton *>

@end
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <UIKit/UIKit.h>

#import "SKNodeDescriptor.h"

@interface SKScrollViewDescriptor : SKNodeDescriptor<UIScrollView *>

@end
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <UIKit/UIKit.h>

#import "SKNodeDescriptor.h"

@interface SKViewControllerDescriptor : SKNodeDescriptor<UIViewController *>

@end
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#if FB_SONARKIT_ENABLED

#import <UIKit/UIKit.h>

#import "SKNodeDescriptor.h"

@interface SKViewDescriptor : SKNodeDescriptor<UIView *>

@end

#endif
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <UIKit/UIKit.h>

@interface SKHiddenWindow : UIWindow
@end
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <Foundation/Foundation.h>

/*
 A hash function is needed in order to use NSObject classes
 as keys in C++ STL
 */
class SKObjectHash {
public:
  size_t operator()(const NSObject *x) const {
    return (size_t)[x hash];
  }
};
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <Foundation/Foundation.h>

void swizzleMethods(Class cls, SEL original, SEL swissled);
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <Foundation/Foundation.h>

#define APPLY_ENUM_TO_YOGA_PROPERTY(varName, enumName) \
^(NSString *newValue) { \
NSNumber *varName = [[enumName##EnumMap allKeysForObject:newValue] lastObject]; \
if (varName == nil) { return; } \
node.yoga.varName = (enumName)[varName unsignedIntegerValue]; \
}

#define APPLY_VALUE_TO_YGVALUE(varName) \
^(NSNumber *value) { \
YGValue newValue = node.yoga.varName; \
newValue.value = [value floatValue]; \
node.yoga.varName = newValue; \
}

#define APPLY_UNIT_TO_YGVALUE(varName, enumName) \
^(NSString *value) { \
NSNumber *varName = [[enumName##EnumMap allKeysForObject:value] lastObject]; \
if (varName == nil) { return; } \
YGValue newValue = node.yoga.varName; \
newValue.unit = (enumName)[varName unsignedIntegerValue]; \
node.yoga.varName = newValue; \
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <SonarKitLayoutPlugin/SKTapListener.h>

@interface SKTapListenerMock : NSObject<SKTapListener>

- (void)tapAt:(CGPoint)point;

@end
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <UIKit/UIKit.h>

@interface TestNode : NSObject

@property (nonatomic, copy) NSString *nodeName;
@property (nonatomic, copy) NSArray<TestNode *> *children;

@property (nonatomic, assign) BOOL highlighted;
@property (nonatomic, assign) CGRect frame;

- (instancetype)initWithName:(NSString *)name;
- (instancetype)initWithName:(NSString *)name withFrame:(CGRect)frame;

@end
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <SonarKitLayoutPlugin/SKNodeDescriptor.h>

#import "TestNode.h"

@interface TestNodeDescriptor : SKNodeDescriptor<TestNode *>
@end
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#if FB_SONARKIT_ENABLED

#import <Foundation/Foundation.h>
#import <SonarKitNetworkPlugin/SKNetworkReporter.h>

@interface SKIOSNetworkAdapter : NSObject<SKNetworkAdapterDelegate>
- (instancetype)init NS_DESIGNATED_INITIALIZER;
@property (weak, nonatomic) id<SKNetworkReporterDelegate> delegate;

@end

#endif
// Copyright 2004-present Facebook. All Rights Reserved.

//
//  FLEXNetworkObserver.h
//  Derived from:
//
//  PDAFNetworkDomainController.h
//  PonyDebugger
//
//  Created by Mike Lewis on 2/27/12.
//
//  Licensed to Square, Inc. under one or more contributor license agreements.
//  See the LICENSE file distributed with this work for the terms under
//  which Square, Inc. licenses this file to you.
//

#import <Foundation/Foundation.h>

FOUNDATION_EXTERN NSString *const kFLEXNetworkObserverEnabledStateChangedNotification;

/// This class swizzles NSURLConnection and NSURLSession delegate methods to observe events in the URL loading system.
/// High level network events are sent to the default FLEXNetworkRecorder instance which maintains the request history and caches response bodies.
@interface FLEXNetworkObserver : NSObject

+ (void)start;

@end
//
//  FLEXNetworkRecorder.h
//  Flipboard
//
//  Created by Ryan Olson on 2/4/15.
//  Copyright 2004-present Facebook. All Rights Reserved.
//

#import <Foundation/Foundation.h>

#import <SonarKitNetworkPlugin/SKNetworkReporter.h>

// Notifications posted when the record is updated
extern NSString *const kFLEXNetworkRecorderNewTransactionNotification;
extern NSString *const kFLEXNetworkRecorderTransactionUpdatedNotification;
extern NSString *const kFLEXNetworkRecorderUserInfoTransactionKey;
extern NSString *const kFLEXNetworkRecorderTransactionsClearedNotification;

@class FLEXNetworkTransaction;

@interface FLEXNetworkRecorder : NSObject

/// In general, it only makes sense to have one recorder for the entire application.
+ (instancetype)defaultRecorder;

@property (nonatomic, weak) id<SKNetworkReporterDelegate> delegate;

/// Defaults to 25 MB if never set. Values set here are presisted across launches of the app.
@property (nonatomic, assign) NSUInteger responseCacheByteLimit;

/// If NO, the recorder not cache will not cache response for content types with an "image", "video", or "audio" prefix.
@property (nonatomic, assign) BOOL shouldCacheMediaResponses;

@property (nonatomic, copy) NSArray<NSString *> *hostBlacklist;


// Accessing recorded network activity

/// Array of FLEXNetworkTransaction objects ordered by start time with the newest first.
- (NSArray<FLEXNetworkTransaction *> *)networkTransactions;

/// The full response data IFF it hasn't been purged due to memory pressure.
- (NSData *)cachedResponseBodyForTransaction:(FLEXNetworkTransaction *)transaction;

/// Dumps all network transactions and cached response bodies.
- (void)clearRecordedActivity;


// Recording network activity

/// Call when app is about to send HTTP request.
- (void)recordRequestWillBeSentWithRequestID:(NSString *)requestID request:(NSURLRequest *)request redirectResponse:(NSURLResponse *)redirectResponse;

/// Call when HTTP response is available.
- (void)recordResponseReceivedWithRequestID:(NSString *)requestID response:(NSURLResponse *)response;

/// Call when data chunk is received over the network.
- (void)recordDataReceivedWithRequestID:(NSString *)requestID dataLength:(int64_t)dataLength;

/// Call when HTTP request has finished loading.
- (void)recordLoadingFinishedWithRequestID:(NSString *)requestID responseBody:(NSData *)responseBody;

/// Call when HTTP request has failed to load.
- (void)recordLoadingFailedWithRequestID:(NSString *)requestID error:(NSError *)error;

/// Call to set the request mechanism anytime after recordRequestWillBeSent... has been called.
/// This string can be set to anything useful about the API used to make the request.
- (void)recordMechanism:(NSString *)mechanism forRequestID:(NSString *)requestID;

@end
//
//  FLEXNetworkTransaction.h
//  Flipboard
//
//  Created by Ryan Olson on 2/8/15.
//  Copyright 2004-present Facebook. All Rights Reserved.
//

#import <Foundation/Foundation.h>

#import "UIKit/UIKit.h"

typedef NS_ENUM(NSInteger, FLEXNetworkTransactionState) {
    FLEXNetworkTransactionStateUnstarted,
    FLEXNetworkTransactionStateAwaitingResponse,
    FLEXNetworkTransactionStateReceivingData,
    FLEXNetworkTransactionStateFinished,
    FLEXNetworkTransactionStateFailed
};

@interface FLEXNetworkTransaction : NSObject

@property (nonatomic, copy) NSString *requestID;

@property (nonatomic, strong) NSURLRequest *request;
@property (nonatomic, strong) NSURLResponse *response;
@property (nonatomic, copy) NSString *requestMechanism;
@property (nonatomic, assign) FLEXNetworkTransactionState transactionState;
@property (nonatomic, strong) NSError *error;

@property (nonatomic, strong) NSDate *startTime;
@property (nonatomic, assign) NSTimeInterval latency;
@property (nonatomic, assign) NSTimeInterval duration;

@property (nonatomic, assign) int64_t receivedDataLength;

/// Only applicable for image downloads. A small thumbnail to preview the full response.
@property (nonatomic, strong) UIImage *responseThumbnail;

/// Populated lazily. Handles both normal HTTPBody data and HTTPBodyStreams.
@property (nonatomic, strong, readonly) NSData *cachedRequestBody;

+ (NSString *)readableStringFromTransactionState:(FLEXNetworkTransactionState)state;

@end
// Copyright 2004-present Facebook. All Rights Reserved.

#import <Availability.h>
#import <AvailabilityInternal.h>
#import <objc/runtime.h>

#import <Foundation/Foundation.h>
#import <UIKit/UIKit.h>

#define FLEXFloor(x) (floor([[UIScreen mainScreen] scale] * (x)) / [[UIScreen mainScreen] scale])

#define FLEX_AT_LEAST_IOS11_SDK defined(__IPHONE_11_0) && (__IPHONE_OS_VERSION_MAX_ALLOWED >= __IPHONE_11_0)

@interface NSNumber (SonarUtility)

+ (NSNumber *)random;

@end

@interface NSDate (SonarUtility)

+ (uint64_t)timestamp;
@end

@interface FLEXUtility : NSObject

// Swizzling utilities

+ (SEL)swizzledSelectorForSelector:(SEL)selector;
+ (BOOL)instanceRespondsButDoesNotImplementSelector:(SEL)selector class:(Class)cls;
+ (void)replaceImplementationOfKnownSelector:(SEL)originalSelector onClass:(Class)className withBlock:(id)block swizzledSelector:(SEL)swizzledSelector;
+ (void)replaceImplementationOfSelector:(SEL)selector withSelector:(SEL)swizzledSelector forClass:(Class)cls withMethodDescription:(struct objc_method_description)methodDescription implementationBlock:(id)implementationBlock undefinedBlock:(id)undefinedBlock;

@end
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#if FB_SONARKIT_ENABLED

#import <Foundation/Foundation.h>

#import <SonarKit/SonarPlugin.h>

#import <memory>

#import "SKDispatchQueue.h"

@interface SKBufferingPlugin : NSObject<SonarPlugin>

- (instancetype)initWithQueue:(const std::shared_ptr<facebook::sonar::DispatchQueue> &)queue NS_DESIGNATED_INITIALIZER;

- (void)send:(NSString *)method sonarObject:(NSDictionary<NSString *, id> *)sonarObject;

@end

#endif
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#if FB_SONARKIT_ENABLED

#pragma once

#import <dispatch/dispatch.h>

namespace facebook {
  namespace sonar {
    class DispatchQueue
    {
    public:
      virtual void async(dispatch_block_t block) = 0;
    };

    class GCDQueue: public DispatchQueue
    {
    public:
      GCDQueue(dispatch_queue_t underlyingQueue)
      :_underlyingQueue(underlyingQueue) { }

      void async(dispatch_block_t block) override
      {
        dispatch_async(_underlyingQueue, block);
      }

    private:
      dispatch_queue_t _underlyingQueue;
    };
  }
}

#endif
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <Foundation/Foundation.h>

struct RequestInfo {
  int64_t identifier;
  uint64_t timestamp;
  NSURLRequest *request;
  NSString *body;

  void setBody(NSData *data) {
    body = data ? [data base64EncodedStringWithOptions: 0]
    : [request.HTTPBody base64EncodedStringWithOptions: 0];
  }
};

struct ResponseInfo {
  int64_t identifier;
  uint64_t timestamp;
  NSURLResponse *response;
  NSString *body;

  bool shouldStripReponseBody() {
    NSHTTPURLResponse *httpResponse = (NSHTTPURLResponse*)response;
    NSString *contentType = httpResponse.allHeaderFields[@"content-type"];
    if (!contentType) {
      return NO;
    }

    return [contentType containsString:@"image/"] ||
    [contentType containsString:@"video/"] ||
    [contentType containsString:@"application/zip"];
  }

  void setBody(NSData *data) {
    body = shouldStripReponseBody() ? nil : [data base64EncodedStringWithOptions: 0];
  }

};

@protocol SKNetworkReporterDelegate

- (void)didObserveRequest:(RequestInfo)request;
- (void)didObserveResponse:(ResponseInfo)response;

@end

@protocol SKNetworkAdapterDelegate

@property (weak, nonatomic) id<SKNetworkReporterDelegate> delegate;

@end
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#if FB_SONARKIT_ENABLED
#import <Foundation/Foundation.h>

#import <SonarKit/SonarPlugin.h>

#import "SKBufferingPlugin.h"
#import "SKNetworkReporter.h"
#import "SKDispatchQueue.h"

@interface SonarKitNetworkPlugin : SKBufferingPlugin <SKNetworkReporterDelegate>

- (instancetype)initWithNetworkAdapter:(id<SKNetworkAdapterDelegate>)adapter NS_DESIGNATED_INITIALIZER;
- (instancetype)initWithNetworkAdapter:(id<SKNetworkAdapterDelegate>)adapter queue:(const std::shared_ptr<facebook::sonar::DispatchQueue> &)queue; //For test purposes

@property (strong, nonatomic) id<SKNetworkAdapterDelegate> adapter;

@end

#endif
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <UIKit/UIKit.h>

@interface AppDelegate : UIResponder <UIApplicationDelegate>
@end
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <UIKit/UIKit.h>

@interface MainViewController : UIViewController

@end
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

#import <UIKit/UIKit.h>

@interface NetworkViewController : UIViewController

@end
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <UIKit/UIKit.h>

@interface RootViewController : UIViewController

@end
/*
 *  Copyright (c) 2004-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

 #ifndef SKMACROS_H
 #define SKMACROS_H

 #import <FBDefines/FBMacros.h>

 #ifdef __cplusplus
 # define SK_EXTERN_C_BEGIN extern "C" {
 # define SK_EXTERN_C_END   }
 # define SK_EXTERN_C extern "C"
 #else
 # define SK_EXTERN_C_BEGIN
 # define SK_EXTERN_C_END
 # define SK_EXTERN_C extern
 #endif

 #define SKLog(...) NSLog(__VA_ARGS__)
 #define SKTrace(...) /*NSLog(__VA_ARGS__)*/

#endif
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <Foundation/Foundation.h>

#import "SonarPlugin.h"

/**
Represents a connection between the Sonar desktop och client side. Manages the lifecycle of attached
plugin instances.
*/
@interface SonarClient : NSObject

/**
The shared singleton SonarClient instance. It is an error to call this on non-debug builds to avoid leaking data.
*/
+ (instancetype)sharedClient;

/**
Register a plugin with the client.
*/
- (void)addPlugin:(NSObject<SonarPlugin> *)plugin;

/**
Unregister a plugin with the client.
*/
- (void)removePlugin:(NSObject<SonarPlugin> *)plugin;

/**
Retrieve the plugin with a given identifier which was previously registered with this client.
*/
- (NSObject<SonarPlugin> *)pluginWithIdentifier:(NSString *)identifier;

/**
Establish a connection to the Sonar desktop.
*/
- (void)start;

/**
Stop the connection to the Sonar desktop.
*/
- (void)stop;

// initializers are disabled. You must use `+[SonarClient sharedClient]` instance.
- (instancetype)init NS_UNAVAILABLE;
+ (instancetype)new NS_UNAVAILABLE;

@end
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <Foundation/Foundation.h>

@protocol SonarResponder;
@protocol SonarWebSocket;

typedef void (^SonarReceiver)(NSDictionary*, id<SonarResponder>);

/**
Represents a connection between the Desktop and mobile plugins with corresponding identifiers.
*/
@protocol SonarConnection

/**
Invoke a method on the Sonar desktop plugin with with a matching identifier.
*/
- (void)send:(NSString *)method withParams:(NSDictionary *)params;

/**
Register a receiver to be notified of incoming calls of the given method from the Sonar desktop
plugin with a matching identifier.
*/
- (void)receive:(NSString *)method withBlock:(SonarReceiver)receiver;

@end
/*
 *  Copyright (c) 2004-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

#import <Foundation/Foundation.h>
#import "SKMacros.h"

SK_EXTERN_C_BEGIN
void SonarPerformBlockOnMainThread(void(^block)());
SK_EXTERN_C_END

@protocol SonarConnection;

@protocol SonarPlugin

/**
The plugin's identifier. This should map to a javascript plugin with the same identifier to ensure
messages are sent correctly.
*/
- (NSString *)identifier;

/**
Called when a connection has been established between this plugin and the corresponding plugin on
the Sonar desktop app. The provided connection can be used to register method receivers as well
as send messages back to the desktop app.
*/
- (void)didConnect:(id<SonarConnection>)connection;

/**
Called when a plugin has been disconnected and the SonarConnection provided in didConnect is no
longer valid to use.
*/
- (void)didDisconnect;

@end
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <Foundation/Foundation.h>

/**
Acts as a hook for providing return values to remote called from Sonar desktop plugins.
*/
@protocol SonarResponder

/**
Respond with a successful return value.
*/
- (void)success:(NSDictionary *)response;

/**
Respond with an error.
*/
- (void)error:(NSDictionary *)response;

@end
/*
 *  Copyright (c) 2004-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <Sonar/SonarConnection.h>
#import <SonarKit/SonarConnection.h>

/**
SonarCppBridgingConnection is a simple ObjC wrapper around SonarConnection
that forwards messages to the underlying C++ connection. This class allows
pure Objective-C plugins to send messages to the underlying connection.
*/
@interface SonarCppBridgingConnection : NSObject <SonarConnection>
- (instancetype)initWithCppConnection:(std::shared_ptr<facebook::sonar::SonarConnection>)conn;
@end
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <Sonar/SonarResponder.h>
#import <SonarKit/SonarResponder.h>

/**
SonarCppBridgingResponder is a simple ObjC wrapper around SonarResponder
that forwards messages to the underlying C++ responder. This class allows
pure Objective-C plugins to send messages to the underlying responder.
*/
@interface SonarCppBridgingResponder : NSObject <SonarResponder>
- (instancetype)initWithCppResponder:(std::unique_ptr<facebook::sonar::SonarResponder>)responder;
@end
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#ifndef __OBJC__
#error This header can only be included in .mm (ObjC++) files
#endif

#import <Sonar/SonarPlugin.h>
#import <SonarKit/SonarCppBridgingConnection.h>
#import <SonarKit/SonarPlugin.h>

namespace facebook {
namespace sonar {

using ObjCPlugin = NSObject<SonarPlugin> *;

/**
SonarCppWrapperPlugin is a simple C++ wrapper around Objective-C Sonar plugins
that can be passed to SonarClient. This class allows developers to write pure
Objective-C plugins if they want.
*/
class SonarCppWrapperPlugin final : public facebook::sonar::SonarPlugin {
public:
  // Under ARC copying objCPlugin *does* increment its retain count
  SonarCppWrapperPlugin(ObjCPlugin objCPlugin) : _objCPlugin(objCPlugin) {}

  std::string identifier() const override { return [[_objCPlugin identifier] UTF8String]; }

  void didConnect(std::shared_ptr<facebook::sonar::SonarConnection> conn) override
  {
    SonarCppBridgingConnection *const bridgingConn = [[SonarCppBridgingConnection alloc] initWithCppConnection:conn];
    [_objCPlugin didConnect:bridgingConn];
  }

  void didDisconnect() override { [_objCPlugin didDisconnect]; }

  ObjCPlugin getObjCPlugin() { return _objCPlugin; }

private:
  ObjCPlugin _objCPlugin;
};

} // namespace sonar
} // namespace facebook
/*
 *  Copyright (c) 2004-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once

#import <Foundation/Foundation.h>

#include <folly/dynamic.h>

namespace facebook {
namespace cxxutils {

folly::dynamic convertIdToFollyDynamic(id json);
id convertFollyDynamicToId(const folly::dynamic &dyn);

} }
/*
 *  Copyright (c) 2004-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#ifndef FB_SK_MACROS_H
 #define FB_SK_MACROS_H

    #define FB_LINK_REQUIRE_(NAME, UNIQUE)
    #define FB_LINKABLE(NAME)
    #define FB_LINK_REQUIRE(NAME)
    #define FB_LINK_REQUIRE_EXT(NAME)

#endif
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <Foundation/Foundation.h>

enum {
  SKPortForwardingFrameTypeOpenPipe = 201,
  SKPortForwardingFrameTypeWriteToPipe = 202,
  SKPortForwardingFrameTypeClosePipe = 203,
};

static dispatch_data_t NSDataToGCDData(NSData *data) {
  __block NSData *retainedData = data;
  return dispatch_data_create(data.bytes, data.length, nil, ^{
    retainedData = nil;
  });
}
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <Foundation/Foundation.h>

@interface SKPortForwardingServer : NSObject

- (instancetype)init;

- (void)listenForMultiplexingChannelOnPort:(NSUInteger)port;
- (void)forwardConnectionsFromPort:(NSUInteger)port;
- (void)close;

@end
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <Foundation/Foundation.h>

#import <SonarKit/SonarPlugin.h>

@protocol SonarConnection;

typedef void (^ConnectBlock)(id<SonarConnection>);
typedef void (^DisconnectBlock)();

@interface BlockBasedSonarPlugin : NSObject<SonarPlugin>

- (instancetype)initIdentifier:(NSString *)identifier connect:(ConnectBlock)connect disconnect:(DisconnectBlock)disconnect;

@end
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#ifndef __cplusplus
#error This header can only be included in .mm (ObjC++) files
#endif

#import <Foundation/Foundation.h>

#import <Sonar/SonarClient.h>
#import <SonarKit/SonarClient.h>

@interface SonarClient (Testing)

- (instancetype)initWithCppClient:(facebook::sonar::SonarClient *)cppClient;

@end
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <Foundation/Foundation.h>

#import <SonarKit/SonarConnection.h>

@interface SonarConnectionMock : NSObject<SonarConnection>

@property (nonatomic, assign, getter=isConnected) BOOL connected;
@property (nonatomic, readonly) NSDictionary<NSString *, SonarReceiver> *receivers;
@property (nonatomic, readonly) NSDictionary<NSString *, NSArray<NSDictionary *> *> *sent;

@end
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#import <Foundation/Foundation.h>

#import <SonarKit/SonarResponder.h>

@interface SonarResponderMock : NSObject<SonarResponder>

@property (nonatomic, readonly) NSArray<NSDictionary *> *successes;
@property (nonatomic, readonly) NSArray<NSDictionary *> *errors;

@end
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
/** @file ALog.h
 *
 *  Very simple android only logging. Define LOG_TAG to enable the macros.
 */

#pragma once

#ifdef __ANDROID__

#include <android/log.h>

namespace facebook {
namespace alog {

template<typename... ARGS>
inline void log(int level, const char* tag, const char* msg, ARGS... args) noexcept {
  __android_log_print(level, tag, msg, args...);
}

template<typename... ARGS>
inline void log(int level, const char* tag, const char* msg) noexcept {
  __android_log_write(level, tag, msg);
}

template<typename... ARGS>
inline void logv(const char* tag, const char* msg, ARGS... args) noexcept {
  log(ANDROID_LOG_VERBOSE, tag, msg, args...);
}

template<typename... ARGS>
inline void logd(const char* tag, const char* msg, ARGS... args) noexcept {
  log(ANDROID_LOG_DEBUG, tag, msg, args...);
}

template<typename... ARGS>
inline void logi(const char* tag, const char* msg, ARGS... args) noexcept {
  log(ANDROID_LOG_INFO, tag, msg, args...);
}

template<typename... ARGS>
inline void logw(const char* tag, const char* msg, ARGS... args) noexcept {
  log(ANDROID_LOG_WARN, tag, msg, args...);
}

template<typename... ARGS>
inline void loge(const char* tag, const char* msg, ARGS... args) noexcept {
  log(ANDROID_LOG_ERROR, tag, msg, args...);
}

template<typename... ARGS>
inline void logf(const char* tag, const char* msg, ARGS... args) noexcept {
  log(ANDROID_LOG_FATAL, tag, msg, args...);
}


#ifdef LOG_TAG
# define ALOGV(...) ::facebook::alog::logv(LOG_TAG, __VA_ARGS__)
# define ALOGD(...) ::facebook::alog::logd(LOG_TAG, __VA_ARGS__)
# define ALOGI(...) ::facebook::alog::logi(LOG_TAG, __VA_ARGS__)
# define ALOGW(...) ::facebook::alog::logw(LOG_TAG, __VA_ARGS__)
# define ALOGE(...) ::facebook::alog::loge(LOG_TAG, __VA_ARGS__)
# define ALOGF(...) ::facebook::alog::logf(LOG_TAG, __VA_ARGS__)
#endif

}}

#else
# define ALOGV(...) ((void)0)
# define ALOGD(...) ((void)0)
# define ALOGI(...) ((void)0)
# define ALOGW(...) ((void)0)
# define ALOGE(...) ((void)0)
# define ALOGF(...) ((void)0)
#endif
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#ifndef FBASSERT_H
#define FBASSERT_H

#include <fb/visibility.h>

namespace facebook {
#define ENABLE_FBASSERT 1

#if ENABLE_FBASSERT
#define FBASSERTMSGF(expr, msg, ...) !(expr) ? facebook::assertInternal("Assert (%s:%d): " msg, __FILE__, __LINE__, ##__VA_ARGS__) : (void) 0
#else
#define FBASSERTMSGF(expr, msg, ...)
#endif // ENABLE_FBASSERT

#define FBASSERT(expr) FBASSERTMSGF(expr, "%s", #expr)

#define FBCRASH(msg, ...) facebook::assertInternal("Fatal error (%s:%d): " msg, __FILE__, __LINE__, ##__VA_ARGS__)
#define FBUNREACHABLE() facebook::assertInternal("This code should be unreachable (%s:%d)", __FILE__, __LINE__)

FBEXPORT void assertInternal(const char* formatstr, ...) __attribute__((noreturn));

// This allows storing the assert message before the current process terminates due to a crash
typedef void (*AssertHandler)(const char* message);
void setAssertHandler(AssertHandler assertHandler);

} // namespace facebook
#endif // FBASSERT_H
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once
#include <atomic>
#include <fb/assert.h>
#include <fb/noncopyable.h>
#include <fb/nonmovable.h>
#include <fb/RefPtr.h>

namespace facebook {

class Countable : public noncopyable, public nonmovable {
public:
  // RefPtr expects refcount to start at 0
  Countable() : m_refcount(0) {}
  virtual ~Countable()
  {
    FBASSERT(m_refcount == 0);
  }

private:
  void ref() {
    ++m_refcount;
  }

  void unref() {
    if (0 == --m_refcount) {
      delete this;
    }
  }

  bool hasOnlyOneRef() const {
    return m_refcount == 1;
  }

  template <typename T> friend class RefPtr;
  std::atomic<int> m_refcount;
};

}
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once
#include <functional>
#include <string>
#include <jni.h>

#include <fb/visibility.h>

namespace facebook {
namespace jni {

// Keeps a thread-local reference to the current thread's JNIEnv.
struct Environment {
  // May be null if this thread isn't attached to the JVM
  FBEXPORT static JNIEnv* current();
  static void initialize(JavaVM* vm);

  // There are subtle issues with calling the next functions directly. It is
  // much better to always use a ThreadScope to manage attaching/detaching for
  // you.
  FBEXPORT static JNIEnv* ensureCurrentThreadIsAttached();
  FBEXPORT static void detachCurrentThread();
};

/**
 * RAII Object that attaches a thread to the JVM. Failing to detach from a thread before it
 * exits will cause a crash, as will calling Detach an extra time, and this guard class helps
 * keep that straight. In addition, it remembers whether it performed the attach or not, so it
 * is safe to nest it with itself or with non-fbjni code that manages the attachment correctly.
 *
 * Potential concerns:
 *  - Attaching to the JVM is fast (~100us on MotoG), but ideally you would attach while the
 *    app is not busy.
 *  - Having a thread detach at arbitrary points is not safe in Dalvik; you need to be sure that
 *    there is no Java code on the current stack or you run the risk of a crash like:
 *      ERROR: detaching thread with interp frames (count=18)
 *    (More detail at https://groups.google.com/forum/#!topic/android-ndk/2H8z5grNqjo)
 *    ThreadScope won't do a detach if the thread was already attached before the guard is
 *    instantiated, but there's probably some usage that could trip this up.
 *  - Newly attached C++ threads only get the bootstrap class loader -- i.e. java language
 *    classes, not any of our application's classes. This will be different behavior than threads
 *    that were initiated on the Java side. A workaround is to pass a global reference for a
 *    class or instance to the new thread; this bypasses the need for the class loader.
 *    (See http://docs.oracle.com/javase/7/docs/technotes/guides/jni/spec/invocation.html#attach_current_thread)
 *    If you need access to the application's classes, you can use ThreadScope::WithClassLoader.
 */
class FBEXPORT ThreadScope {
 public:
  ThreadScope();
  ThreadScope(ThreadScope&) = delete;
  ThreadScope(ThreadScope&&) = default;
  ThreadScope& operator=(ThreadScope&) = delete;
  ThreadScope& operator=(ThreadScope&&) = delete;
  ~ThreadScope();

  /**
   * This runs the closure in a scope with fbjni's classloader. This should be
   * the same classloader as the rest of the application and thus anything
   * running in the closure will have access to the same classes as in a normal
   * java-create thread.
   */
  static void WithClassLoader(std::function<void()>&& runnable);

  static void OnLoad();
 private:
  bool attachedWithThisScope_;
};
}
}
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once

#include <jni.h>

#include <fb/Environment.h>
#include <fb/ALog.h>
#include <fb/fbjni/Common.h>
#include <fb/fbjni/Exceptions.h>
#include <fb/fbjni/JThrowable.h>
#include <fb/fbjni/ReferenceAllocators.h>
#include <fb/fbjni/References.h>
#include <fb/fbjni/Meta.h>
#include <fb/fbjni/CoreClasses.h>
#include <fb/fbjni/Iterator.h>
#include <fb/fbjni/Hybrid.h>
#include <fb/fbjni/Registration.h>
/*
 *  Copyright (c) 2005-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
/*
 * FB Wrapper for logging functions.
 *
 * The android logging API uses the macro "LOG()" for its logic, which means
 * that it conflicts with random other places that use LOG for their own
 * purposes and doesn't work right half the places you include it
 *
 * FBLOG uses exactly the same semantics (FBLOGD for debug etc) but because of
 * the FB prefix it's strictly better. FBLOGV also gets stripped out based on
 * whether NDEBUG is set, but can be overridden by FBLOG_NDEBUG
 *
 * Most of the rest is a copy of <cutils/log.h> with minor changes.
 */

//
// C/C++ logging functions.  See the logging documentation for API details.
//
// We'd like these to be available from C code (in case we import some from
// somewhere), so this has a C interface.
//
// The output will be correct when the log file is shared between multiple
// threads and/or multiple processes so long as the operating system
// supports O_APPEND.  These calls have mutex-protected data structures
// and so are NOT reentrant.  Do not use LOG in a signal handler.
//
#pragma once

#include <fb/visibility.h>

#ifdef __cplusplus
extern "C" {
#endif

#ifdef ANDROID
#include <android/log.h>
#else
// These declarations are needed for our internal use even on non-Android
// builds.
// (they are borrowed from <android/log.h>)

/*
 * Android log priority values, in ascending priority order.
 */
typedef enum android_LogPriority {
  ANDROID_LOG_UNKNOWN = 0,
  ANDROID_LOG_DEFAULT, /* only for SetMinPriority() */
  ANDROID_LOG_VERBOSE,
  ANDROID_LOG_DEBUG,
  ANDROID_LOG_INFO,
  ANDROID_LOG_WARN,
  ANDROID_LOG_ERROR,
  ANDROID_LOG_FATAL,
  ANDROID_LOG_SILENT, /* only for SetMinPriority(); must be last */
} android_LogPriority;

/*
 * Send a simple string to the log.
 */
int __android_log_write(int prio, const char *tag, const char *text);

/*
 * Send a formatted string to the log, used like printf(fmt,...)
 */
int __android_log_print(int prio, const char *tag, const char *fmt, ...)
#if defined(__GNUC__)
    __attribute__((format(printf, 3, 4)))
#endif
    ;

#endif

// ---------------------------------------------------------------------

/*
 * Normally we strip FBLOGV (VERBOSE messages) from release builds.
 * You can modify this (for example with "#define FBLOG_NDEBUG 0"
 * at the top of your source file) to change that behavior.
 */
#ifndef FBLOG_NDEBUG
#ifdef NDEBUG
#define FBLOG_NDEBUG 1
#else
#define FBLOG_NDEBUG 0
#endif
#endif

/*
 * This is the local tag used for the following simplified
 * logging macros.  You can change this preprocessor definition
 * before using the other macros to change the tag.
 */
#ifndef LOG_TAG
#define LOG_TAG NULL
#endif

// ---------------------------------------------------------------------

/*
 * Simplified macro to send a verbose log message using the current LOG_TAG.
 */
#ifndef FBLOGV
#if FBLOG_NDEBUG
#define FBLOGV(...) ((void)0)
#else
#define FBLOGV(...) ((void)FBLOG(LOG_VERBOSE, LOG_TAG, __VA_ARGS__))
#endif
#endif

#define CONDITION(cond) (__builtin_expect((cond) != 0, 0))

#ifndef FBLOGV_IF
#if FBLOG_NDEBUG
#define FBLOGV_IF(cond, ...) ((void)0)
#else
#define FBLOGV_IF(cond, ...)                                            \
  ((CONDITION(cond)) ? ((void)FBLOG(LOG_VERBOSE, LOG_TAG, __VA_ARGS__)) \
                     : (void)0)
#endif
#endif

/*
 * Simplified macro to send a debug log message using the current LOG_TAG.
 */
#ifndef FBLOGD
#define FBLOGD(...) ((void)FBLOG(LOG_DEBUG, LOG_TAG, __VA_ARGS__))
#endif

#ifndef FBLOGD_IF
#define FBLOGD_IF(cond, ...) \
  ((CONDITION(cond)) ? ((void)FBLOG(LOG_DEBUG, LOG_TAG, __VA_ARGS__)) : (void)0)
#endif

/*
 * Simplified macro to send an info log message using the current LOG_TAG.
 */
#ifndef FBLOGI
#define FBLOGI(...) ((void)FBLOG(LOG_INFO, LOG_TAG, __VA_ARGS__))
#endif

#ifndef FBLOGI_IF
#define FBLOGI_IF(cond, ...) \
  ((CONDITION(cond)) ? ((void)FBLOG(LOG_INFO, LOG_TAG, __VA_ARGS__)) : (void)0)
#endif

/*
 * Simplified macro to send a warning log message using the current LOG_TAG.
 */
#ifndef FBLOGW
#define FBLOGW(...) ((void)FBLOG(LOG_WARN, LOG_TAG, __VA_ARGS__))
#endif

#ifndef FBLOGW_IF
#define FBLOGW_IF(cond, ...) \
  ((CONDITION(cond)) ? ((void)FBLOG(LOG_WARN, LOG_TAG, __VA_ARGS__)) : (void)0)
#endif

/*
 * Simplified macro to send an error log message using the current LOG_TAG.
 */
#ifndef FBLOGE
#define FBLOGE(...) ((void)FBLOG(LOG_ERROR, LOG_TAG, __VA_ARGS__))
#endif

#ifndef FBLOGE_IF
#define FBLOGE_IF(cond, ...) \
  ((CONDITION(cond)) ? ((void)FBLOG(LOG_ERROR, LOG_TAG, __VA_ARGS__)) : (void)0)
#endif

// ---------------------------------------------------------------------

/*
 * Conditional based on whether the current LOG_TAG is enabled at
 * verbose priority.
 */
#ifndef IF_FBLOGV
#if FBLOG_NDEBUG
#define IF_FBLOGV() if (false)
#else
#define IF_FBLOGV() IF_FBLOG(LOG_VERBOSE, LOG_TAG)
#endif
#endif

/*
 * Conditional based on whether the current LOG_TAG is enabled at
 * debug priority.
 */
#ifndef IF_FBLOGD
#define IF_FBLOGD() IF_FBLOG(LOG_DEBUG, LOG_TAG)
#endif

/*
 * Conditional based on whether the current LOG_TAG is enabled at
 * info priority.
 */
#ifndef IF_FBLOGI
#define IF_FBLOGI() IF_FBLOG(LOG_INFO, LOG_TAG)
#endif

/*
 * Conditional based on whether the current LOG_TAG is enabled at
 * warn priority.
 */
#ifndef IF_FBLOGW
#define IF_FBLOGW() IF_FBLOG(LOG_WARN, LOG_TAG)
#endif

/*
 * Conditional based on whether the current LOG_TAG is enabled at
 * error priority.
 */
#ifndef IF_FBLOGE
#define IF_FBLOGE() IF_FBLOG(LOG_ERROR, LOG_TAG)
#endif

// ---------------------------------------------------------------------

/*
 * Log a fatal error.  If the given condition fails, this stops program
 * execution like a normal assertion, but also generating the given message.
 * It is NOT stripped from release builds.  Note that the condition test
 * is -inverted- from the normal assert() semantics.
 */
#define FBLOG_ALWAYS_FATAL_IF(cond, ...)                                   \
  ((CONDITION(cond)) ? ((void)fb_printAssert(#cond, LOG_TAG, __VA_ARGS__)) \
                     : (void)0)

#define FBLOG_ALWAYS_FATAL(...) \
  (((void)fb_printAssert(NULL, LOG_TAG, __VA_ARGS__)))

/*
 * Versions of LOG_ALWAYS_FATAL_IF and LOG_ALWAYS_FATAL that
 * are stripped out of release builds.
 */
#if FBLOG_NDEBUG

#define FBLOG_FATAL_IF(cond, ...) ((void)0)
#define FBLOG_FATAL(...) ((void)0)

#else

#define FBLOG_FATAL_IF(cond, ...) FBLOG_ALWAYS_FATAL_IF(cond, __VA_ARGS__)
#define FBLOG_FATAL(...) FBLOG_ALWAYS_FATAL(__VA_ARGS__)

#endif

/*
 * Assertion that generates a log message when the assertion fails.
 * Stripped out of release builds.  Uses the current LOG_TAG.
 */
#define FBLOG_ASSERT(cond, ...) FBLOG_FATAL_IF(!(cond), __VA_ARGS__)
//#define LOG_ASSERT(cond) LOG_FATAL_IF(!(cond), "Assertion failed: " #cond)

// ---------------------------------------------------------------------

/*
 * Basic log message macro.
 *
 * Example:
 *  FBLOG(LOG_WARN, NULL, "Failed with error %d", errno);
 *
 * The second argument may be NULL or "" to indicate the "global" tag.
 */
#ifndef FBLOG
#define FBLOG(priority, tag, ...) \
  FBLOG_PRI(ANDROID_##priority, tag, __VA_ARGS__)
#endif

#ifndef FBLOG_BY_DELIMS
#define FBLOG_BY_DELIMS(priority, tag, delims, msg, ...) \
  logPrintByDelims(ANDROID_##priority, tag, delims, msg, ##__VA_ARGS__)
#endif

/*
 * Log macro that allows you to specify a number for the priority.
 */
#ifndef FBLOG_PRI
#define FBLOG_PRI(priority, tag, ...) fb_printLog(priority, tag, __VA_ARGS__)
#endif

/*
 * Log macro that allows you to pass in a varargs ("args" is a va_list).
 */
#ifndef FBLOG_PRI_VA
#define FBLOG_PRI_VA(priority, tag, fmt, args) \
  fb_vprintLog(priority, NULL, tag, fmt, args)
#endif

/*
 * Conditional given a desired logging priority and tag.
 */
#ifndef IF_FBLOG
#define IF_FBLOG(priority, tag) if (fb_testLog(ANDROID_##priority, tag))
#endif

typedef void (*LogHandler)(int priority, const char* tag, const char* message);
FBEXPORT void setLogHandler(LogHandler logHandler);

/*
 * ===========================================================================
 *
 * The stuff in the rest of this file should not be used directly.
 */
FBEXPORT int fb_printLog(int prio, const char* tag, const char* fmt, ...)
#if defined(__GNUC__)
    __attribute__((format(printf, 3, 4)))
#endif
    ;

#define fb_vprintLog(prio, cond, tag, fmt...) \
  __android_log_vprint(prio, tag, fmt)

#define fb_printAssert(cond, tag, fmt...) __android_log_assert(cond, tag, fmt)

#define fb_writeLog(prio, tag, text) __android_log_write(prio, tag, text)

#define fb_bWriteLog(tag, payload, len) __android_log_bwrite(tag, payload, len)
#define fb_btWriteLog(tag, type, payload, len) \
  __android_log_btwrite(tag, type, payload, len)

#define fb_testLog(prio, tag) (1)

/*
 * FB extensions
 */
void logPrintByDelims(int priority, const char* tag, const char* delims,
                      const char* msg, ...);

#ifdef __cplusplus
}
#endif
/*
 *  Copyright (c) 2004-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once

#include <iomanip>
#include <iostream>
#include <string>
#include <vector>

#include <fb/visibility.h>

namespace facebook {
namespace lyra {

constexpr size_t kDefaultLimit = 64;

using InstructionPointer = const void*;

class FBEXPORT StackTraceElement {
 public:
  StackTraceElement(InstructionPointer absoluteProgramCounter,
                    InstructionPointer libraryBase,
                    InstructionPointer functionAddress, std::string libraryName,
                    std::string functionName)
      : absoluteProgramCounter_{absoluteProgramCounter},
        libraryBase_{libraryBase},
        functionAddress_{functionAddress},
        libraryName_{std::move(libraryName)},
        functionName_{std::move(functionName)} {}

  InstructionPointer libraryBase() const noexcept { return libraryBase_; }

  InstructionPointer functionAddress() const noexcept {
    return functionAddress_;
  }

  InstructionPointer absoluteProgramCounter() const noexcept {
    return absoluteProgramCounter_;
  }

  const std::string& libraryName() const noexcept { return libraryName_; }

  const std::string& functionName() const noexcept { return functionName_; }

  /**
   * The offset of the program counter to the base of the library (i.e. the
   * address that addr2line takes as input>
   */
  std::ptrdiff_t libraryOffset() const noexcept {
    auto absoluteLibrary = static_cast<const char*>(libraryBase_);
    auto absoluteabsoluteProgramCounter =
        static_cast<const char*>(absoluteProgramCounter_);
    return absoluteabsoluteProgramCounter - absoluteLibrary;
  }

  /**
   * The offset within the current function
   */
  int functionOffset() const noexcept {
    auto absoluteSymbol = static_cast<const char*>(functionAddress_);
    auto absoluteabsoluteProgramCounter =
        static_cast<const char*>(absoluteProgramCounter_);
    return absoluteabsoluteProgramCounter - absoluteSymbol;
  }

 private:
  const InstructionPointer absoluteProgramCounter_;
  const InstructionPointer libraryBase_;
  const InstructionPointer functionAddress_;
  const std::string libraryName_;
  const std::string functionName_;
};

/**
 * Populate the vector with the current stack trace
 *
 * Note that this trace needs to be symbolicated to get the library offset even
 * if it is to be symbolicated off-line.
 *
 * Beware of a bug on some platforms, which makes the trace loop until the
 * buffer is full when it reaches a noexpr function. It seems to be fixed in
 * newer versions of gcc. https://gcc.gnu.org/bugzilla/show_bug.cgi?id=56846
 *
 * @param stackTrace The vector that will receive the stack trace. Before
 * filling the vector it will be cleared. The vector will never grow so the
 * number of frames captured is limited by the capacity of it.
 *
 * @param skip The number of frames to skip before capturing the trace
 */
FBEXPORT void getStackTrace(std::vector<InstructionPointer>& stackTrace,
                            size_t skip = 0);

/**
 * Creates a vector and populates it with the current stack trace
 *
 * Note that this trace needs to be symbolicated to get the library offset even
 * if it is to be symbolicated off-line.
 *
 * Beware of a bug on some platforms, which makes the trace loop until the
 * buffer is full when it reaches a noexpr function. It seems to be fixed in
 * newer versions of gcc. https://gcc.gnu.org/bugzilla/show_bug.cgi?id=56846
 *
 * @param skip The number of frames to skip before capturing the trace
 *
 * @limit The maximum number of frames captured
 */
FBEXPORT inline std::vector<InstructionPointer> getStackTrace(
    size_t skip = 0,
    size_t limit = kDefaultLimit) {
  auto stackTrace = std::vector<InstructionPointer>{};
  stackTrace.reserve(limit);
  getStackTrace(stackTrace, skip + 1);
  return stackTrace;
}

/**
 * Symbolicates a stack trace into a given vector
 *
 * @param symbols The vector to receive the output. The vector is cleared and
 * enough room to keep the frames are reserved.
 *
 * @param stackTrace The input stack trace
 */
FBEXPORT void getStackTraceSymbols(std::vector<StackTraceElement>& symbols,
                                   const std::vector<InstructionPointer>& trace);

/**
 * Symbolicates a stack trace into a new vector
 *
 * @param stackTrace The input stack trace
 */
FBEXPORT inline std::vector<StackTraceElement> getStackTraceSymbols(
    const std::vector<InstructionPointer>& trace) {
  auto symbols = std::vector<StackTraceElement>{};
  getStackTraceSymbols(symbols, trace);
  return symbols;
}


/**
 * Captures and symbolicates a stack trace
 *
 * Beware of a bug on some platforms, which makes the trace loop until the
 * buffer is full when it reaches a noexpr function. It seems to be fixed in
 * newer versions of gcc. https://gcc.gnu.org/bugzilla/show_bug.cgi?id=56846
 *
 * @param skip The number of frames before capturing the trace
 *
 * @param limit The maximum number of frames captured
 */
FBEXPORT inline std::vector<StackTraceElement> getStackTraceSymbols(
    size_t skip = 0,
    size_t limit = kDefaultLimit) {
  return getStackTraceSymbols(getStackTrace(skip + 1, limit));
}

/**
 * Formatting a stack trace element
 */
FBEXPORT std::ostream& operator<<(std::ostream& out, const StackTraceElement& elm);

/**
 * Formatting a stack trace
 */
FBEXPORT std::ostream& operator<<(std::ostream& out,
                                  const std::vector<StackTraceElement>& trace);
}
}
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once

namespace facebook {

struct noncopyable {
  noncopyable(const noncopyable&) = delete;
  noncopyable& operator=(const noncopyable&) = delete;
protected:
  noncopyable() = default;
};

}
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once

namespace facebook {

struct nonmovable {
  nonmovable(nonmovable&&) = delete;
  nonmovable& operator=(nonmovable&&) = delete;
protected:
  nonmovable() = default;
};

}
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once
#include <cstring>
#include <string>
#include <sstream>

namespace facebook {

#define FROM_HERE facebook::ProgramLocation(__FUNCTION__, __FILE__, __LINE__)

class ProgramLocation {
public:
  ProgramLocation() : m_functionName("Unspecified"), m_fileName("Unspecified"), m_lineNumber(0) {}

  ProgramLocation(const char* functionName, const char* fileName, int line) :
      m_functionName(functionName),
      m_fileName(fileName),
      m_lineNumber(line)
    {}

  const char* functionName() const { return m_functionName; }
  const char* fileName() const { return m_fileName; }
  int lineNumber() const { return m_lineNumber; }

  std::string asFormattedString() const {
    std::stringstream str;
    str << "Function " << m_functionName << " in file " << m_fileName << ":" << m_lineNumber;
    return str.str();
  }

  bool operator==(const ProgramLocation& other) const {
    // Assumes that the strings are static
    return (m_functionName == other.m_functionName) && (m_fileName == other.m_fileName) && m_lineNumber == other.m_lineNumber;
  }

private:
  const char* m_functionName;
  const char* m_fileName;
  int m_lineNumber;
};

}
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once
#include <utility>
#include <fb/assert.h>

namespace facebook {

// Reference counting smart pointer. This is designed to work with the
// Countable class or other implementations in the future. It is designed in a
// way to be both efficient and difficult to misuse. Typical usage is very
// simple once you learn the patterns (and the compiler will help!):
//
// By default, the internal pointer is null.
//   RefPtr<Foo> ref;
//
// Object creation requires explicit construction:
//   RefPtr<Foo> ref = createNew<Foo>(...);
//
// Or if the constructor is not public:
//   RefPtr<Foo> ref = adoptRef(new Foo(...));
//
// But you can implicitly create from nullptr:
//   RefPtr<Foo> maybeRef = cond ? ref : nullptr;
//
// Move/Copy Construction/Assignment are straightforward:
//   RefPtr<Foo> ref2 = ref;
//   ref = std::move(ref2);
//
// Destruction automatically drops the RefPtr's reference as expected.
//
// Upcasting is implicit but downcasting requires an explicit cast:
//   struct Bar : public Foo {};
//   RefPtr<Bar> barRef = static_cast<RefPtr<Bar>>(ref);
//   ref = barRef;
//
template <class T>
class RefPtr {
public:
  constexpr RefPtr() :
    m_ptr(nullptr)
  {}

  // Allow implicit construction from a pointer only from nullptr
  constexpr RefPtr(std::nullptr_t ptr) :
    m_ptr(nullptr)
  {}

  RefPtr(const RefPtr<T>& ref) :
    m_ptr(ref.m_ptr)
  {
    refIfNecessary(m_ptr);
  }

  // Only allow implicit upcasts. A downcast will result in a compile error
  // unless you use static_cast (which will end up invoking the explicit
  // operator below).
  template <typename U>
  RefPtr(const RefPtr<U>& ref, typename std::enable_if<std::is_base_of<T,U>::value, U>::type* = nullptr) :
    m_ptr(ref.get())
  {
    refIfNecessary(m_ptr);
  }

  RefPtr(RefPtr<T>&& ref) :
    m_ptr(nullptr)
  {
    *this = std::move(ref);
  }

  // Only allow implicit upcasts. A downcast will result in a compile error
  // unless you use static_cast (which will end up invoking the explicit
  // operator below).
  template <typename U>
  RefPtr(RefPtr<U>&& ref, typename std::enable_if<std::is_base_of<T,U>::value, U>::type* = nullptr) :
    m_ptr(nullptr)
  {
    *this = std::move(ref);
  }

  ~RefPtr() {
    unrefIfNecessary(m_ptr);
    m_ptr = nullptr;
  }

  RefPtr<T>& operator=(const RefPtr<T>& ref) {
    if (m_ptr != ref.m_ptr) {
      unrefIfNecessary(m_ptr);
      m_ptr = ref.m_ptr;
      refIfNecessary(m_ptr);
    }
    return *this;
  }

  // The STL assumes rvalue references are unique and for simplicity's sake, we
  // make the same assumption here, that &ref != this.
  RefPtr<T>& operator=(RefPtr<T>&& ref) {
    unrefIfNecessary(m_ptr);
    m_ptr = ref.m_ptr;
    ref.m_ptr = nullptr;
    return *this;
  }

  template <typename U>
  RefPtr<T>& operator=(RefPtr<U>&& ref) {
    unrefIfNecessary(m_ptr);
    m_ptr = ref.m_ptr;
    ref.m_ptr = nullptr;
    return *this;
  }

  void reset() {
    unrefIfNecessary(m_ptr);
    m_ptr = nullptr;
  }

  T* get() const {
    return m_ptr;
  }

  T* operator->() const {
    return m_ptr;
  }

  T& operator*() const {
    return *m_ptr;
  }

  template <typename U>
  explicit operator RefPtr<U> () const;

  explicit operator bool() const {
    return m_ptr ? true : false;
  }

  bool isTheLastRef() const {
    FBASSERT(m_ptr);
    return m_ptr->hasOnlyOneRef();
  }

  // Creates a strong reference from a raw pointer, assuming that is already
  // referenced from some other RefPtr. This should be used sparingly.
  static inline RefPtr<T> assumeAlreadyReffed(T* ptr) {
    return RefPtr<T>(ptr, ConstructionMode::External);
  }

  // Creates a strong reference from a raw pointer, assuming that it points to a
  // freshly-created object. See the documentation for RefPtr for usage.
  static inline RefPtr<T> adoptRef(T* ptr) {
    return RefPtr<T>(ptr, ConstructionMode::Adopted);
  }

private:
  enum class ConstructionMode {
    Adopted,
    External
  };

  RefPtr(T* ptr, ConstructionMode mode) :
    m_ptr(ptr)
  {
    FBASSERTMSGF(ptr, "Got null pointer in %s construction mode", mode == ConstructionMode::Adopted ? "adopted" : "external");
    ptr->ref();
    if (mode == ConstructionMode::Adopted) {
      FBASSERT(ptr->hasOnlyOneRef());
    }
  }

  static inline void refIfNecessary(T* ptr) {
    if (ptr) {
      ptr->ref();
    }
  }
  static inline void unrefIfNecessary(T* ptr) {
    if (ptr) {
      ptr->unref();
    }
  }

  template <typename U> friend class RefPtr;

  T* m_ptr;
};

// Creates a strong reference from a raw pointer, assuming that is already
// referenced from some other RefPtr and that it is non-null. This should be
// used sparingly.
template <typename T>
static inline RefPtr<T> assumeAlreadyReffed(T* ptr) {
  return RefPtr<T>::assumeAlreadyReffed(ptr);
}

// As above, but tolerant of nullptr.
template <typename T>
static inline RefPtr<T> assumeAlreadyReffedOrNull(T* ptr) {
  return ptr ? RefPtr<T>::assumeAlreadyReffed(ptr) : nullptr;
}

// Creates a strong reference from a raw pointer, assuming that it points to a
// freshly-created object. See the documentation for RefPtr for usage.
template <typename T>
static inline RefPtr<T> adoptRef(T* ptr) {
  return RefPtr<T>::adoptRef(ptr);
}

template <typename T, typename ...Args>
static inline RefPtr<T> createNew(Args&&... arguments) {
  return RefPtr<T>::adoptRef(new T(std::forward<Args>(arguments)...));
}

template <typename T> template <typename U>
RefPtr<T>::operator RefPtr<U>() const {
  static_assert(std::is_base_of<T, U>::value, "Invalid static cast");
  return assumeAlreadyReffedOrNull<U>(static_cast<U*>(m_ptr));
}

template <typename T, typename U>
inline bool operator==(const RefPtr<T>& a, const RefPtr<U>& b) {
  return a.get() == b.get();
}

template <typename T, typename U>
inline bool operator!=(const RefPtr<T>& a, const RefPtr<U>& b) {
  return a.get() != b.get();
}

template <typename T, typename U>
inline bool operator==(const RefPtr<T>& ref, U* ptr) {
  return ref.get() == ptr;
}

template <typename T, typename U>
inline bool operator!=(const RefPtr<T>& ref, U* ptr) {
  return ref.get() != ptr;
}

template <typename T, typename U>
inline bool operator==(U* ptr, const RefPtr<T>& ref) {
  return ref.get() == ptr;
}

template <typename T, typename U>
inline bool operator!=(U* ptr, const RefPtr<T>& ref) {
  return ref.get() != ptr;
}

template <typename T>
inline bool operator==(const RefPtr<T>& ref, std::nullptr_t ptr) {
  return ref.get() == ptr;
}

template <typename T>
inline bool operator!=(const RefPtr<T>& ref, std::nullptr_t ptr) {
  return ref.get() != ptr;
}

template <typename T>
inline bool operator==(std::nullptr_t ptr, const RefPtr<T>& ref) {
  return ref.get() == ptr;
}

template <typename T>
inline bool operator!=(std::nullptr_t ptr, const RefPtr<T>& ref) {
  return ref.get() != ptr;
}

}
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once
#include <fb/assert.h>
#include <utility>

namespace facebook {

// Class that lets you declare a global but does not add a static constructor
// to the binary. Eventually I'd like to have this auto-initialize in a
// multithreaded environment but for now it's easiest just to use manual
// initialization.
template <typename T>
class StaticInitialized {
public:
  constexpr StaticInitialized() :
    m_instance(nullptr)
  {}

  template <typename ...Args>
  void initialize(Args&&... arguments) {
    FBASSERT(!m_instance);
    m_instance = new T(std::forward<Args>(arguments)...);
  }

  T* operator->() const {
    return m_instance;
  }
private:
  T* m_instance;
};

}
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once

#include <pthread.h>
#include <errno.h>

#include <fb/assert.h>

namespace facebook {

///////////////////////////////////////////////////////////////////////////////

/**
 * A thread-local object is a "global" object within a thread. This is useful
 * for writing apartment-threaded code, where nothing is actullay shared
 * between different threads (hence no locking) but those variables are not
 * on stack in local scope. To use it, just do something like this,
 *
 *   ThreadLocal<MyClass> static_object;
 *     static_object->data_ = ...;
 *     static_object->doSomething();
 *
 *   ThreadLocal<int> static_number;
 *     int value = *static_number;
 *
 * So, syntax-wise it's similar to pointers. T can be primitive types, and if
 * it's a class, there has to be a default constructor.
 */
template<typename T>
class ThreadLocal {
public:
  /**
   * Constructor that has to be called from a thread-neutral place.
   */
  ThreadLocal() :
    m_key(0),
    m_cleanup(OnThreadExit) {
    initialize();
  }

  /**
   * As above but with a custom cleanup function
   */
  typedef void (*CleanupFunction)(void* obj);
  explicit ThreadLocal(CleanupFunction cleanup) :
    m_key(0),
    m_cleanup(cleanup) {
    FBASSERT(cleanup);
    initialize();
  }

  /**
   * Access object's member or method through this operator overload.
   */
  T *operator->() const {
    return get();
  }

  T &operator*() const {
    return *get();
  }

  T *get() const {
    return (T*)pthread_getspecific(m_key);
  }

  T* release() {
    T* obj = get();
    pthread_setspecific(m_key, NULL);
    return obj;
  }

  void reset(T* other = NULL) {
    T* old = (T*)pthread_getspecific(m_key);
    if (old != other) {
      FBASSERT(m_cleanup);
      m_cleanup(old);
      pthread_setspecific(m_key, other);
    }
  }

private:
  void initialize() {
    int ret = pthread_key_create(&m_key, m_cleanup);
    if (ret != 0) {
      const char *msg = "(unknown error)";
      switch (ret) {
      case EAGAIN:
        msg = "PTHREAD_KEYS_MAX (1024) is exceeded";
        break;
      case ENOMEM:
        msg = "Out-of-memory";
        break;
      }
      (void) msg;
      FBASSERTMSGF(0, "pthread_key_create failed: %d %s", ret, msg);
    }
  }

  static void OnThreadExit(void *obj) {
    if (NULL != obj) {
      delete (T*)obj;
    }
  }

  pthread_key_t m_key;
  CleanupFunction m_cleanup;
};

}
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once

#define FBEXPORT __attribute__((visibility("default")))
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once

#include "CoreClasses.h"

namespace facebook {
namespace jni {

namespace detail {
template <typename T, typename jprim>
struct JPrimitive : JavaClass<T> {
  using typename JavaClass<T>::javaobject;
  using JavaClass<T>::javaClassStatic;
  static local_ref<javaobject> valueOf(jprim val) {
    static auto cls = javaClassStatic();
    static auto method =
      cls->template getStaticMethod<javaobject(jprim)>("valueOf");
    return method(cls, val);
  }
  jprim value() const {
    static auto method =
      javaClassStatic()->template getMethod<jprim()>(T::kValueMethod);
    return method(this->self());
  }
};

} // namespace detail


#define DEFINE_BOXED_PRIMITIVE(LITTLE, BIG)                          \
  struct J ## BIG : detail::JPrimitive<J ## BIG, j ## LITTLE> {      \
    static auto constexpr kJavaDescriptor = "Ljava/lang/" #BIG ";";  \
    static auto constexpr kValueMethod = #LITTLE "Value";            \
    j ## LITTLE LITTLE ## Value() const {                            \
      return value();                                                \
    }                                                                \
  };                                                                 \
  inline local_ref<jobject> autobox(j ## LITTLE val) {               \
    return J ## BIG::valueOf(val);                                   \
  }

DEFINE_BOXED_PRIMITIVE(boolean, Boolean)
DEFINE_BOXED_PRIMITIVE(byte, Byte)
DEFINE_BOXED_PRIMITIVE(char, Character)
DEFINE_BOXED_PRIMITIVE(short, Short)
DEFINE_BOXED_PRIMITIVE(int, Integer)
DEFINE_BOXED_PRIMITIVE(long, Long)
DEFINE_BOXED_PRIMITIVE(float, Float)
DEFINE_BOXED_PRIMITIVE(double, Double)

#undef DEFINE_BOXED_PRIMITIVE

inline local_ref<jobject> autobox(alias_ref<jobject> val) {
  return make_local(val);
}

}}
/*
 *  Copyright (c) 2016-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once

#include <fb/visibility.h>

#include "CoreClasses.h"
#include "References-forward.h"

namespace facebook {
namespace jni {

// JNI's NIO support has some awkward preconditions and error reporting. This
// class provides much more user-friendly access.
class FBEXPORT JByteBuffer : public JavaClass<JByteBuffer> {
 public:
  static constexpr const char* kJavaDescriptor = "Ljava/nio/ByteBuffer;";

  static local_ref<JByteBuffer> wrapBytes(uint8_t* data, size_t size);

  bool isDirect() const;

  uint8_t* getDirectBytes() const;
  size_t getDirectSize() const;
};

}}
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
/** @file Common.h
 *
 * Defining the stuff that don't deserve headers of their own...
 */

#pragma once

#include <functional>

#include <jni.h>

#include <fb/visibility.h>
#include <fb/Environment.h>

#ifdef FBJNI_DEBUG_REFS
# ifdef __ANDROID__
#  include <android/log.h>
# else
#  include <cstdio>
# endif
#endif

// If a pending JNI Java exception is found, wraps it in a JniException object and throws it as
// a C++ exception.
#define FACEBOOK_JNI_THROW_PENDING_EXCEPTION() \
  ::facebook::jni::throwPendingJniExceptionAsCppException()

// If the condition is true, throws a JniException object, which wraps the pending JNI Java
// exception if any. If no pending exception is found, throws a JniException object that wraps a
// RuntimeException throwable. 
#define FACEBOOK_JNI_THROW_EXCEPTION_IF(CONDITION) \
  ::facebook::jni::throwCppExceptionIf(CONDITION)

/// @cond INTERNAL

namespace facebook {
namespace jni {

FBEXPORT void throwPendingJniExceptionAsCppException();
FBEXPORT void throwCppExceptionIf(bool condition);

[[noreturn]] FBEXPORT void throwNewJavaException(jthrowable);
[[noreturn]] FBEXPORT void throwNewJavaException(const char* throwableName, const char* msg);
template<typename... Args>
[[noreturn]] void throwNewJavaException(const char* throwableName, const char* fmt, Args... args);


/**
 * This needs to be called at library load time, typically in your JNI_OnLoad method.
 *
 * The intended use is to return the result of initialize() directly
 * from JNI_OnLoad and to do nothing else there. Library specific
 * initialization code should go in the function passed to initialize
 * (which can be, and probably should be, a C++ lambda). This approach
 * provides correct error handling and translation errors during
 * initialization into Java exceptions when appropriate.
 *
 * Failure to call this will cause your code to crash in a remarkably
 * unhelpful way (typically a segfault) while trying to handle an exception
 * which occurs later.
 */
FBEXPORT jint initialize(JavaVM*, std::function<void()>&&) noexcept;

namespace internal {

/**
 * Retrieve a pointer the JNI environment of the current thread.
 *
 * @pre The current thread must be attached to the VM
 */
inline JNIEnv* getEnv() noexcept {
  // TODO(T6594868) Benchmark against raw JNI access
  return Environment::current();
}

// Define to get extremely verbose logging of references and to enable reference stats
#ifdef FBJNI_DEBUG_REFS
template<typename... Args>
inline void dbglog(const char* msg, Args... args) {
# ifdef __ANDROID__
  __android_log_print(ANDROID_LOG_VERBOSE, "fbjni_dbg", msg, args...);
# else
  std::fprintf(stderr, msg, args...);
# endif
}

#else

template<typename... Args>
inline void dbglog(const char*, Args...) {
}

#endif

}}}

/// @endcond
/*
 *  Copyright (c) 2016-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once

#include "CoreClasses.h"
#include "File.h"

namespace facebook {
namespace jni {

class AContext : public JavaClass<AContext> {
 public:
  static constexpr const char* kJavaDescriptor = "Landroid/content/Context;";

  // Define a method that calls into the represented Java class
  local_ref<JFile::javaobject> getCacheDir() {
    static auto method = getClass()->getMethod<JFile::javaobject()>("getCacheDir");
    return method(self());
  }

  local_ref<JFile::javaobject> getFilesDir() {
    static auto method = getClass()->getMethod<JFile::javaobject()>("getFilesDir");
    return method(self());
  }
};

}
}
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once

#include <string.h>
#include <type_traits>
#include <stdlib.h>

#include "Common.h"
#include "Exceptions.h"
#include "Meta.h"
#include "MetaConvert.h"

namespace facebook {
namespace jni {

// jobject /////////////////////////////////////////////////////////////////////////////////////////

inline bool isSameObject(alias_ref<JObject> lhs, alias_ref<JObject> rhs) noexcept {
  return internal::getEnv()->IsSameObject(lhs.get(), rhs.get()) != JNI_FALSE;
}

inline local_ref<JClass> JObject::getClass() const noexcept {
  return adopt_local(internal::getEnv()->GetObjectClass(self()));
}

inline bool JObject::isInstanceOf(alias_ref<JClass> cls) const noexcept {
  return internal::getEnv()->IsInstanceOf(self(), cls.get()) != JNI_FALSE;
}

template<typename T>
inline T JObject::getFieldValue(JField<T> field) const noexcept {
  return field.get(self());
}

template<typename T>
inline local_ref<T*> JObject::getFieldValue(JField<T*> field) const noexcept {
  return adopt_local(field.get(self()));
}

template<typename T>
inline void JObject::setFieldValue(JField<T> field, T value) noexcept {
  field.set(self(), value);
}

inline std::string JObject::toString() const {
  static auto method = findClassLocal("java/lang/Object")->getMethod<jstring()>("toString");

  return method(self())->toStdString();
}


// Class is here instead of CoreClasses.h because we need
// alias_ref to be complete.
class MonitorLock {
 public:
  inline MonitorLock() noexcept;
  inline MonitorLock(alias_ref<JObject> object) noexcept;
  inline ~MonitorLock() noexcept;

  inline MonitorLock(MonitorLock&& other) noexcept;
  inline MonitorLock& operator=(MonitorLock&& other) noexcept;

  inline MonitorLock(const MonitorLock&) = delete;
  inline MonitorLock& operator=(const MonitorLock&) = delete;

 private:
  inline void reset() noexcept;
  alias_ref<JObject> owned_;
};

MonitorLock::MonitorLock() noexcept : owned_(nullptr) {}

MonitorLock::MonitorLock(alias_ref<JObject> object) noexcept
    : owned_(object) {
  internal::getEnv()->MonitorEnter(object.get());
}

void MonitorLock::reset() noexcept {
  if (owned_) {
    internal::getEnv()->MonitorExit(owned_.get());
    if (internal::getEnv()->ExceptionCheck()) {
      abort(); // Lock mismatch
    }
    owned_ = nullptr;
  }
}

MonitorLock::~MonitorLock() noexcept {
  reset();
}

MonitorLock::MonitorLock(MonitorLock&& other) noexcept
    : owned_(other.owned_)
{
  other.owned_ = nullptr;
}

MonitorLock& MonitorLock::operator=(MonitorLock&& other) noexcept {
  reset();
  owned_ = other.owned_;
  other.owned_ = nullptr;
  return *this;
}

inline MonitorLock JObject::lock() const noexcept {
  return MonitorLock(this_);
}

inline jobject JObject::self() const noexcept {
  return this_;
}

inline void swap(JObject& a, JObject& b) noexcept {
  using std::swap;
  swap(a.this_, b.this_);
}

// JavaClass ///////////////////////////////////////////////////////////////////////////////////////

namespace detail {
template<typename JC, typename... Args>
static local_ref<JC> newInstance(Args... args) {
  static auto cls = JC::javaClassStatic();
  static auto constructor = cls->template getConstructor<typename JC::javaobject(Args...)>();
  return cls->newObject(constructor, args...);
}
}


template <typename T, typename B, typename J>
auto JavaClass<T, B, J>::self() const noexcept -> javaobject {
  return static_cast<javaobject>(JObject::self());
}

// jclass //////////////////////////////////////////////////////////////////////////////////////////

namespace detail {

// This is not a real type.  It is used so people won't accidentally
// use a void* to initialize a NativeMethod.
struct NativeMethodWrapper;

}

struct NativeMethod {
  const char* name;
  std::string descriptor;
  detail::NativeMethodWrapper* wrapper;
};

inline local_ref<JClass> JClass::getSuperclass() const noexcept {
  return adopt_local(internal::getEnv()->GetSuperclass(self()));
}

inline void JClass::registerNatives(std::initializer_list<NativeMethod> methods) {
  const auto env = internal::getEnv();

  JNINativeMethod jnimethods[methods.size()];
  size_t i = 0;
  for (auto it = methods.begin(); it < methods.end(); ++it, ++i) {
    jnimethods[i].name = it->name;
    jnimethods[i].signature = it->descriptor.c_str();
    jnimethods[i].fnPtr = reinterpret_cast<void*>(it->wrapper);
  }

  auto result = env->RegisterNatives(self(), jnimethods, methods.size());
  FACEBOOK_JNI_THROW_EXCEPTION_IF(result != JNI_OK);
}

inline bool JClass::isAssignableFrom(alias_ref<JClass> other) const noexcept {
  const auto env = internal::getEnv();
  const auto result = env->IsAssignableFrom(self(), other.get());
  return result;
}

template<typename F>
inline JConstructor<F> JClass::getConstructor() const {
  return getConstructor<F>(jmethod_traits_from_cxx<F>::constructor_descriptor().c_str());
}

template<typename F>
inline JConstructor<F> JClass::getConstructor(const char* descriptor) const {
  constexpr auto constructor_method_name = "<init>";
  return getMethod<F>(constructor_method_name, descriptor);
}

template<typename F>
inline JMethod<F> JClass::getMethod(const char* name) const {
  return getMethod<F>(name, jmethod_traits_from_cxx<F>::descriptor().c_str());
}

template<typename F>
inline JMethod<F> JClass::getMethod(
    const char* name,
    const char* descriptor) const {
  const auto env = internal::getEnv();
  const auto method = env->GetMethodID(self(), name, descriptor);
  FACEBOOK_JNI_THROW_EXCEPTION_IF(!method);
  return JMethod<F>{method};
}

template<typename F>
inline JStaticMethod<F> JClass::getStaticMethod(const char* name) const {
  return getStaticMethod<F>(name, jmethod_traits_from_cxx<F>::descriptor().c_str());
}

template<typename F>
inline JStaticMethod<F> JClass::getStaticMethod(
    const char* name,
    const char* descriptor) const {
  const auto env = internal::getEnv();
  const auto method = env->GetStaticMethodID(self(), name, descriptor);
  FACEBOOK_JNI_THROW_EXCEPTION_IF(!method);
  return JStaticMethod<F>{method};
}

template<typename F>
inline JNonvirtualMethod<F> JClass::getNonvirtualMethod(const char* name) const {
  return getNonvirtualMethod<F>(name, jmethod_traits_from_cxx<F>::descriptor().c_str());
}

template<typename F>
inline JNonvirtualMethod<F> JClass::getNonvirtualMethod(
    const char* name,
    const char* descriptor) const {
  const auto env = internal::getEnv();
  const auto method = env->GetMethodID(self(), name, descriptor);
  FACEBOOK_JNI_THROW_EXCEPTION_IF(!method);
  return JNonvirtualMethod<F>{method};
}

template<typename T>
inline JField<enable_if_t<IsJniScalar<T>(), T>>
JClass::getField(const char* name) const {
  return getField<T>(name, jtype_traits<T>::descriptor().c_str());
}

template<typename T>
inline JField<enable_if_t<IsJniScalar<T>(), T>> JClass::getField(
    const char* name,
    const char* descriptor) const {
  const auto env = internal::getEnv();
  auto field = env->GetFieldID(self(), name, descriptor);
  FACEBOOK_JNI_THROW_EXCEPTION_IF(!field);
  return JField<T>{field};
}

template<typename T>
inline JStaticField<enable_if_t<IsJniScalar<T>(), T>> JClass::getStaticField(
    const char* name) const {
  return getStaticField<T>(name, jtype_traits<T>::descriptor().c_str());
}

template<typename T>
inline JStaticField<enable_if_t<IsJniScalar<T>(), T>> JClass::getStaticField(
    const char* name,
    const char* descriptor) const {
  const auto env = internal::getEnv();
  auto field = env->GetStaticFieldID(self(), name, descriptor);
  FACEBOOK_JNI_THROW_EXCEPTION_IF(!field);
  return JStaticField<T>{field};
}

template<typename T>
inline T JClass::getStaticFieldValue(JStaticField<T> field) const noexcept {
  return field.get(self());
}

template<typename T>
inline local_ref<T*> JClass::getStaticFieldValue(JStaticField<T*> field) noexcept {
  return adopt_local(field.get(self()));
}

template<typename T>
inline void JClass::setStaticFieldValue(JStaticField<T> field, T value) noexcept {
  field.set(self(), value);
}

template<typename R, typename... Args>
inline local_ref<R> JClass::newObject(
    JConstructor<R(Args...)> constructor,
    Args... args) const {
  const auto env = internal::getEnv();
  auto object = env->NewObject(self(), constructor.getId(),
      detail::callToJni(
        detail::Convert<typename std::decay<Args>::type>::toCall(args))...);
  FACEBOOK_JNI_THROW_EXCEPTION_IF(!object);
  return adopt_local(static_cast<R>(object));
}

inline jclass JClass::self() const noexcept {
  return static_cast<jclass>(JObject::self());
}

inline void registerNatives(const char* name, std::initializer_list<NativeMethod> methods) {
  findClassLocal(name)->registerNatives(methods);
}


// jstring /////////////////////////////////////////////////////////////////////////////////////////

inline local_ref<JString> make_jstring(const std::string& modifiedUtf8) {
  return make_jstring(modifiedUtf8.c_str());
}

namespace detail {
// convert to std::string from jstring
template <>
struct Convert<std::string> {
  typedef jstring jniType;
  static std::string fromJni(jniType t) {
    return wrap_alias(t)->toStdString();
  }
  static jniType toJniRet(const std::string& t) {
    return make_jstring(t).release();
  }
  static local_ref<JString> toCall(const std::string& t) {
    return make_jstring(t);
  }
};

// convert return from const char*
template <>
struct Convert<const char*> {
  typedef jstring jniType;
  // no automatic synthesis of const char*.  (It can't be freed.)
  static jniType toJniRet(const char* t) {
    return make_jstring(t).release();
  }
  static local_ref<JString> toCall(const char* t) {
    return make_jstring(t);
  }
};
}

// JStackTrace //////////////////////////////////////////////////////////////////////////////////////

inline auto JStackTraceElement::create(
    const std::string& declaringClass, const std::string& methodName, const std::string& file, int line)
    -> local_ref<javaobject> {
  return newInstance(declaringClass, methodName, file, line);
}

inline std::string JStackTraceElement::getClassName() const {
  static auto meth = javaClassStatic()->getMethod<local_ref<JString>()>("getClassName");
  return meth(self())->toStdString();
}

inline std::string JStackTraceElement::getMethodName() const {
  static auto meth = javaClassStatic()->getMethod<local_ref<JString>()>("getMethodName");
  return meth(self())->toStdString();
}

inline std::string JStackTraceElement::getFileName() const {
  static auto meth = javaClassStatic()->getMethod<local_ref<JString>()>("getFileName");
  return meth(self())->toStdString();
}

inline int JStackTraceElement::getLineNumber() const {
  static auto meth = javaClassStatic()->getMethod<jint()>("getLineNumber");
  return meth(self());
}

// jthrowable //////////////////////////////////////////////////////////////////////////////////////

inline local_ref<JThrowable> JThrowable::initCause(alias_ref<JThrowable> cause) {
  static auto meth = javaClassStatic()->getMethod<javaobject(javaobject)>("initCause");
  return meth(self(), cause.get());
}

// jtypeArray //////////////////////////////////////////////////////////////////////////////////////

namespace detail {
inline size_t JArray::size() const noexcept {
  const auto env = internal::getEnv();
  return env->GetArrayLength(self());
}
}

namespace detail {
template<typename Target>
inline ElementProxy<Target>::ElementProxy(
    Target* target,
    size_t idx)
    : target_{target}, idx_{idx} {}

template<typename Target>
inline ElementProxy<Target>& ElementProxy<Target>::operator=(const T& o) {
  target_->setElement(idx_, o);
  return *this;
}

template<typename Target>
inline ElementProxy<Target>& ElementProxy<Target>::operator=(alias_ref<T>& o) {
  target_->setElement(idx_, o.get());
  return *this;
}

template<typename Target>
inline ElementProxy<Target>& ElementProxy<Target>::operator=(alias_ref<T>&& o) {
  target_->setElement(idx_, o.get());
  return *this;
}

template<typename Target>
inline ElementProxy<Target>& ElementProxy<Target>::operator=(const ElementProxy<Target>& o) {
  auto src = o.target_->getElement(o.idx_);
  target_->setElement(idx_, src.get());
  return *this;
}

template<typename Target>
inline ElementProxy<Target>::ElementProxy::operator const local_ref<T> () const {
  return target_->getElement(idx_);
}

template<typename Target>
inline ElementProxy<Target>::ElementProxy::operator local_ref<T> () {
  return target_->getElement(idx_);
}
}

template <typename T>
std::string JArrayClass<T>::get_instantiated_java_descriptor() {
  return "[" + jtype_traits<T>::descriptor();
};

template <typename T>
std::string JArrayClass<T>::get_instantiated_base_name() {
  return get_instantiated_java_descriptor();
};

template<typename T>
auto JArrayClass<T>::newArray(size_t size) -> local_ref<javaobject> {
  static auto elementClass = findClassStatic(jtype_traits<T>::base_name().c_str());
  const auto env = internal::getEnv();
  auto rawArray = env->NewObjectArray(size, elementClass.get(), nullptr);
  FACEBOOK_JNI_THROW_EXCEPTION_IF(!rawArray);
  return adopt_local(static_cast<javaobject>(rawArray));
}

template<typename T>
inline void JArrayClass<T>::setElement(size_t idx, const T& value) {
  const auto env = internal::getEnv();
  env->SetObjectArrayElement(this->self(), idx, value);
}

template<typename T>
inline local_ref<T> JArrayClass<T>::getElement(size_t idx) {
  const auto env = internal::getEnv();
  auto rawElement = env->GetObjectArrayElement(this->self(), idx);
  return adopt_local(static_cast<T>(rawElement));
}

template<typename T>
inline detail::ElementProxy<JArrayClass<T>> JArrayClass<T>::operator[](size_t index) {
  return detail::ElementProxy<JArrayClass<T>>(this, index);
}

// jarray /////////////////////////////////////////////////////////////////////////////////////////

template <typename JArrayType>
auto JPrimitiveArray<JArrayType>::getRegion(jsize start, jsize length)
    -> std::unique_ptr<T[]> {
  using T = typename jtype_traits<JArrayType>::entry_type;
  auto buf = std::unique_ptr<T[]>{new T[length]};
  getRegion(start, length, buf.get());
  return buf;
}

template <typename JArrayType>
std::string JPrimitiveArray<JArrayType>::get_instantiated_java_descriptor() {
  return jtype_traits<JArrayType>::descriptor();
}
template <typename JArrayType>
std::string JPrimitiveArray<JArrayType>::get_instantiated_base_name() {
  return JPrimitiveArray::get_instantiated_java_descriptor();
}

template <typename JArrayType>
auto JPrimitiveArray<JArrayType>::pin() -> PinnedPrimitiveArray<T, PinnedArrayAlloc<T>> {
  return PinnedPrimitiveArray<T, PinnedArrayAlloc<T>>{this->self(), 0, 0};
}

template <typename JArrayType>
auto JPrimitiveArray<JArrayType>::pinRegion(jsize start, jsize length)
    -> PinnedPrimitiveArray<T, PinnedRegionAlloc<T>> {
  return PinnedPrimitiveArray<T, PinnedRegionAlloc<T>>{this->self(), start, length};
}

template <typename JArrayType>
auto JPrimitiveArray<JArrayType>::pinCritical()
    -> PinnedPrimitiveArray<T, PinnedCriticalAlloc<T>> {
  return PinnedPrimitiveArray<T, PinnedCriticalAlloc<T>>{this->self(), 0, 0};
}

template <typename T>
class PinnedArrayAlloc {
 public:
  static void allocate(
      alias_ref<typename jtype_traits<T>::array_type> array,
      jsize start,
      jsize length,
      T** elements,
      size_t* size,
      jboolean* isCopy) {
    (void) start;
    (void) length;
    *elements = array->getElements(isCopy);
    *size = array->size();
  }
  static void release(
      alias_ref<typename jtype_traits<T>::array_type> array,
      T* elements,
      jint start,
      jint size,
      jint mode) {
    (void) start;
    (void) size;
    array->releaseElements(elements, mode);
  }
};

template <typename T>
class PinnedCriticalAlloc {
 public:
  static void allocate(
      alias_ref<typename jtype_traits<T>::array_type> array,
      jsize start,
      jsize length,
      T** elements,
      size_t* size,
      jboolean* isCopy) {
    const auto env = internal::getEnv();
    *elements = static_cast<T*>(env->GetPrimitiveArrayCritical(array.get(), isCopy));
    FACEBOOK_JNI_THROW_EXCEPTION_IF(!elements);
    *size = array->size();
  }
  static void release(
      alias_ref<typename jtype_traits<T>::array_type> array,
      T* elements,
      jint start,
      jint size,
      jint mode) {
    const auto env = internal::getEnv();
    env->ReleasePrimitiveArrayCritical(array.get(), elements, mode);
  }
};

template <typename T>
class PinnedRegionAlloc {
 public:
  static void allocate(
      alias_ref<typename jtype_traits<T>::array_type> array,
      jsize start,
      jsize length,
      T** elements,
      size_t* size,
      jboolean* isCopy) {
    auto buf = array->getRegion(start, length);
    FACEBOOK_JNI_THROW_EXCEPTION_IF(!buf);
    *elements = buf.release();
    *size = length;
    *isCopy = true;
  }
  static void release(
      alias_ref<typename jtype_traits<T>::array_type> array,
      T* elements,
      jint start,
      jint size,
      jint mode) {
    std::unique_ptr<T[]> holder;
    if (mode == 0 || mode == JNI_ABORT) {
      holder.reset(elements);
    }
    if (mode == 0 || mode == JNI_COMMIT) {
      array->setRegion(start, size, elements);
    }
  }
};

// PinnedPrimitiveArray ///////////////////////////////////////////////////////////////////////////

template<typename T, typename Alloc>
PinnedPrimitiveArray<T, Alloc>::PinnedPrimitiveArray(PinnedPrimitiveArray&& o) {
  *this = std::move(o);
}

template<typename T, typename Alloc>
PinnedPrimitiveArray<T, Alloc>&
PinnedPrimitiveArray<T, Alloc>::operator=(PinnedPrimitiveArray&& o) {
  if (array_) {
    release();
  }
  array_ = std::move(o.array_);
  elements_ = o.elements_;
  isCopy_ = o.isCopy_;
  size_ = o.size_;
  start_ = o.start_;
  o.clear();
  return *this;
}

template<typename T, typename Alloc>
T* PinnedPrimitiveArray<T, Alloc>::get() {
  return elements_;
}

template<typename T, typename Alloc>
inline void PinnedPrimitiveArray<T, Alloc>::release() {
  releaseImpl(0);
  clear();
}

template<typename T, typename Alloc>
inline void PinnedPrimitiveArray<T, Alloc>::commit() {
  releaseImpl(JNI_COMMIT);
}

template<typename T, typename Alloc>
inline void PinnedPrimitiveArray<T, Alloc>::abort() {
  releaseImpl(JNI_ABORT);
  clear();
}

template <typename T, typename Alloc>
inline void PinnedPrimitiveArray<T, Alloc>::releaseImpl(jint mode) {
  FACEBOOK_JNI_THROW_EXCEPTION_IF(array_.get() == nullptr);
  Alloc::release(array_, elements_, start_, size_, mode);
}

template<typename T, typename Alloc>
inline void PinnedPrimitiveArray<T, Alloc>::clear() noexcept {
  array_ = nullptr;
  elements_ = nullptr;
  isCopy_ = false;
  start_ = 0;
  size_ = 0;
}

template<typename T, typename Alloc>
inline T& PinnedPrimitiveArray<T, Alloc>::operator[](size_t index) {
  FACEBOOK_JNI_THROW_EXCEPTION_IF(elements_ == nullptr);
  return elements_[index];
}

template<typename T, typename Alloc>
inline bool PinnedPrimitiveArray<T, Alloc>::isCopy() const noexcept {
  return isCopy_ == JNI_TRUE;
}

template<typename T, typename Alloc>
inline size_t PinnedPrimitiveArray<T, Alloc>::size() const noexcept {
  return size_;
}

template<typename T, typename Alloc>
inline PinnedPrimitiveArray<T, Alloc>::~PinnedPrimitiveArray() noexcept {
  if (elements_) {
    release();
  }
}

template<typename T, typename Alloc>
inline PinnedPrimitiveArray<T, Alloc>::PinnedPrimitiveArray(alias_ref<typename jtype_traits<T>::array_type> array, jint start, jint length) {
  array_ = array;
  start_ = start;
  Alloc::allocate(array, start, length, &elements_, &size_, &isCopy_);
}

template<typename T, typename Base, typename JType>
inline alias_ref<JClass> JavaClass<T, Base, JType>::javaClassStatic() {
  static auto cls = findClassStatic(jtype_traits<typename T::javaobject>::base_name().c_str());
  return cls;
}

template<typename T, typename Base, typename JType>
inline local_ref<JClass> JavaClass<T, Base, JType>::javaClassLocal() {
  std::string className(jtype_traits<typename T::javaobject>::base_name().c_str());
  return findClassLocal(className.c_str());
}

}}
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once

/** @file CoreClasses.h
 *
 * In CoreClasses.h wrappers for the core classes (jobject, jclass, and jstring) is defined
 * to provide access to corresponding JNI functions + some conveniance.
 */

#include "References-forward.h"
#include "Meta-forward.h"
#include "TypeTraits.h"
#include <sstream>

#include <memory>

#include <jni.h>

#include <fb/visibility.h>

namespace facebook {
namespace jni {

class JClass;
class JObject;

/// Lookup a class by name. Note this functions returns an alias_ref that
/// points to a leaked global reference.  This is appropriate for classes
/// that are never unloaded (which is any class in an Android app and most
/// Java programs).
///
/// The most common use case for this is storing the result
/// in a "static auto" variable, or a static global.
///
/// @return Returns a leaked global reference to the class
FBEXPORT alias_ref<JClass> findClassStatic(const char* name);

/// Lookup a class by name. Note this functions returns a local reference,
/// which means that it must not be stored in a static variable.
///
/// The most common use case for this is one-time initialization
/// (like caching method ids).
///
/// @return Returns a global reference to the class
FBEXPORT local_ref<JClass> findClassLocal(const char* name);

/// Check to see if two references refer to the same object. Comparison with nullptr
/// returns true if and only if compared to another nullptr. A weak reference that
/// refers to a reclaimed object count as nullptr.
FBEXPORT bool isSameObject(alias_ref<JObject> lhs, alias_ref<JObject> rhs) noexcept;

// Together, these classes allow convenient use of any class with the fbjni
// helpers.  To use:
//
// struct MyClass : public JavaClass<MyClass> {
//   constexpr static auto kJavaDescriptor = "Lcom/example/package/MyClass;";
// };
//
// Then, an alias_ref<MyClass::javaobject> will be backed by an instance of
// MyClass. JavaClass provides a convenient way to add functionality to these
// smart references.
//
// For example:
//
// struct MyClass : public JavaClass<MyClass> {
//   constexpr static auto kJavaDescriptor = "Lcom/example/package/MyClass;";
//
//   void foo() {
//     static auto method = javaClassStatic()->getMethod<void()>("foo");
//     method(self());
//   }
//
//   static local_ref<javaobject> create(int i) {
//     return newInstance(i);
//   }
// };
//
// auto obj = MyClass::create(10);
// obj->foo();
//
// While users of a JavaClass-type can lookup methods and fields through the
// underlying JClass, those calls can only be checked at runtime. It is recommended
// that the JavaClass-type instead explicitly expose it's methods as in the example
// above.

namespace detail {
template<typename JC, typename... Args>
static local_ref<JC> newInstance(Args... args);
}

class MonitorLock;

class FBEXPORT JObject : detail::JObjectBase {
public:
  static constexpr auto kJavaDescriptor = "Ljava/lang/Object;";

  static constexpr const char* get_instantiated_java_descriptor() { return nullptr; }
  static constexpr const char* get_instantiated_base_name() { return nullptr; }

  /// Get a @ref local_ref of the object's class
  local_ref<JClass> getClass() const noexcept;

  /// Checks if the object is an instance of a class
  bool isInstanceOf(alias_ref<JClass> cls) const noexcept;

  /// Get the primitive value of a field
  template<typename T>
  T getFieldValue(JField<T> field) const noexcept;

  /// Get and wrap the value of a field in a @ref local_ref
  template<typename T>
  local_ref<T*> getFieldValue(JField<T*> field) const noexcept;

  /// Set the value of field. Any Java type is accepted, including the primitive types
  /// and raw reference types.
  template<typename T>
  void setFieldValue(JField<T> field, T value) noexcept;

  /// Convenience method to create a std::string representing the object
  std::string toString() const;

  // Take this object's monitor lock
  MonitorLock lock() const noexcept;

  typedef _jobject _javaobject;
  typedef _javaobject* javaobject;

protected:
  jobject self() const noexcept;
private:
  friend void swap(JObject& a, JObject& b) noexcept;
  template<typename>
  friend struct detail::ReprAccess;
  template<typename, typename, typename>
  friend class JavaClass;

  template <typename, typename>
  friend class JObjectWrapper;
};

// This is only to maintain backwards compatibility with things that are
// already providing a specialization of JObjectWrapper. Any such instances
// should be updated to use a JavaClass.
template<>
class JObjectWrapper<jobject> : public JObject {
};


namespace detail {
template <typename, typename Base, typename JType>
struct JTypeFor {
  static_assert(
      std::is_base_of<
        std::remove_pointer<jobject>::type,
        typename std::remove_pointer<JType>::type
      >::value, "");
  using _javaobject = typename std::remove_pointer<JType>::type;
  using javaobject = JType;
};

template <typename T, typename Base>
struct JTypeFor<T, Base, void> {
  // JNI pattern for jobject assignable pointer
  struct _javaobject :  Base::_javaobject {
    // This allows us to map back to the defining type (in ReprType, for
    // example).
    typedef T JniRefRepr;
  };
  using javaobject = _javaobject*;
};
}

// JavaClass provides a method to inform fbjni about user-defined Java types.
// Given a class:
// struct Foo : JavaClass<Foo> {
//   static constexpr auto kJavaDescriptor = "Lcom/example/package/Foo;";
// };
// fbjni can determine the java type/method signatures for Foo::javaobject and
// smart refs (like alias_ref<Foo::javaobject>) will hold an instance of Foo
// and provide access to it through the -> and * operators.
//
// The "Base" template argument can be used to specify the JavaClass superclass
// of this type (for instance, JString's Base is JObject).
//
// The "JType" template argument is used to provide a jni type (like jstring,
// jthrowable) to be used as javaobject. This should only be necessary for
// built-in jni types and not user-defined ones.
template <typename T, typename Base = JObject, typename JType = void>
class FBEXPORT JavaClass : public Base {
  using JObjType = typename detail::JTypeFor<T, Base, JType>;
public:
  using _javaobject = typename JObjType::_javaobject;
  using javaobject = typename JObjType::javaobject;

  using JavaBase = JavaClass;

  static alias_ref<JClass> javaClassStatic();
  static local_ref<JClass> javaClassLocal();
protected:
  /// Allocates a new object and invokes the specified constructor
  /// Like JClass's getConstructor, this function can only check at runtime if
  /// the class actually has a constructor that accepts the corresponding types.
  /// While a JavaClass-type can expose this function directly, it is recommended
  /// to instead to use this to explicitly only expose those constructors that
  /// the Java class actually has (i.e. with static create() functions).
  template<typename... Args>
  static local_ref<T> newInstance(Args... args) {
    return detail::newInstance<T>(args...);
  }

  javaobject self() const noexcept;
};

/// Wrapper to provide functionality to jclass references
struct NativeMethod;

class FBEXPORT JClass : public JavaClass<JClass, JObject, jclass> {
 public:
  /// Java type descriptor
  static constexpr const char* kJavaDescriptor = "Ljava/lang/Class;";

  /// Get a @local_ref to the super class of this class
  local_ref<JClass> getSuperclass() const noexcept;

  /// Register native methods for the class.  Usage looks like this:
  ///
  /// classRef->registerNatives({
  ///     makeNativeMethod("nativeMethodWithAutomaticDescriptor",
  ///                      methodWithAutomaticDescriptor),
  ///     makeNativeMethod("nativeMethodWithExplicitDescriptor",
  ///                      "(Lcom/facebook/example/MyClass;)V",
  ///                      methodWithExplicitDescriptor),
  ///  });
  ///
  /// By default, C++ exceptions raised will be converted to Java exceptions.
  /// To avoid this and get the "standard" JNI behavior of a crash when a C++
  /// exception is crashing out of the JNI method, declare the method noexcept.
  void registerNatives(std::initializer_list<NativeMethod> methods);

  /// Check to see if the class is assignable from another class
  /// @pre cls != nullptr
  bool isAssignableFrom(alias_ref<JClass> cls) const noexcept;

  /// Convenience method to lookup the constructor with descriptor as specified by the
  /// type arguments
  template<typename F>
  JConstructor<F> getConstructor() const;

  /// Convenience method to lookup the constructor with specified descriptor
  template<typename F>
  JConstructor<F> getConstructor(const char* descriptor) const;

  /// Look up the method with given name and descriptor as specified with the type arguments
  template<typename F>
  JMethod<F> getMethod(const char* name) const;

  /// Look up the method with given name and descriptor
  template<typename F>
  JMethod<F> getMethod(const char* name, const char* descriptor) const;

  /// Lookup the field with the given name and deduced descriptor
  template<typename T>
  JField<enable_if_t<IsJniScalar<T>(), T>> getField(const char* name) const;

  /// Lookup the field with the given name and descriptor
  template<typename T>
  JField<enable_if_t<IsJniScalar<T>(), T>> getField(const char* name, const char* descriptor) const;

  /// Lookup the static field with the given name and deduced descriptor
  template<typename T>
  JStaticField<enable_if_t<IsJniScalar<T>(), T>> getStaticField(const char* name) const;

  /// Lookup the static field with the given name and descriptor
  template<typename T>
  JStaticField<enable_if_t<IsJniScalar<T>(), T>> getStaticField(
      const char* name,
      const char* descriptor) const;

  /// Get the primitive value of a static field
  template<typename T>
  T getStaticFieldValue(JStaticField<T> field) const noexcept;

  /// Get and wrap the value of a field in a @ref local_ref
  template<typename T>
  local_ref<T*> getStaticFieldValue(JStaticField<T*> field) noexcept;

  /// Set the value of field. Any Java type is accepted, including the primitive types
  /// and raw reference types.
  template<typename T>
  void setStaticFieldValue(JStaticField<T> field, T value) noexcept;

  /// Allocates a new object and invokes the specified constructor
  template<typename R, typename... Args>
  local_ref<R> newObject(JConstructor<R(Args...)> constructor, Args... args) const;

  /// Look up the static method with given name and descriptor as specified with the type arguments
  template<typename F>
  JStaticMethod<F> getStaticMethod(const char* name) const;

  /// Look up the static method with given name and descriptor
  template<typename F>
  JStaticMethod<F> getStaticMethod(const char* name, const char* descriptor) const;

  /// Look up the non virtual method with given name and descriptor as specified with the
  /// type arguments
  template<typename F>
  JNonvirtualMethod<F> getNonvirtualMethod(const char* name) const;

  /// Look up the non virtual method with given name and descriptor
  template<typename F>
  JNonvirtualMethod<F> getNonvirtualMethod(const char* name, const char* descriptor) const;

private:
  jclass self() const noexcept;
};

// Convenience method to register methods on a class without holding
// onto the class object.
void registerNatives(const char* name, std::initializer_list<NativeMethod> methods);

/// Wrapper to provide functionality to jstring references
class FBEXPORT JString : public JavaClass<JString, JObject, jstring> {
 public:
  /// Java type descriptor
  static constexpr const char* kJavaDescriptor = "Ljava/lang/String;";

  /// Convenience method to convert a jstring object to a std::string
  std::string toStdString() const;
};

/// Convenience functions to convert a std::string or const char* into a @ref local_ref to a
/// jstring
FBEXPORT local_ref<JString> make_jstring(const char* modifiedUtf8);
FBEXPORT local_ref<JString> make_jstring(const std::string& modifiedUtf8);

namespace detail {
template<typename Target>
class ElementProxy {
 private:
  Target* target_;
  size_t idx_;

 public:
  using T = typename Target::javaentry;
  ElementProxy(Target* target, size_t idx);

  ElementProxy& operator=(const T& o);

  ElementProxy& operator=(alias_ref<T>& o);

  ElementProxy& operator=(alias_ref<T>&& o);

  ElementProxy& operator=(const ElementProxy& o);

  operator const local_ref<T> () const;

  operator local_ref<T> ();
};
}

namespace detail {
class FBEXPORT JArray : public JavaClass<JArray, JObject, jarray> {
 public:
  // This cannot be used in a scope that derives a descriptor (like in a method
  // signature). Use a more derived type instead (like JArrayInt or
  // JArrayClass<T>).
  static constexpr const char* kJavaDescriptor = nullptr;
  size_t size() const noexcept;
};

// This is used so that the JArrayClass<T> javaobject extends jni's
// jobjectArray. This class should not be used directly. A general Object[]
// should use JArrayClass<jobject>.
class FBEXPORT JTypeArray : public JavaClass<JTypeArray, JArray, jobjectArray> {
  // This cannot be used in a scope that derives a descriptor (like in a method
  // signature).
  static constexpr const char* kJavaDescriptor = nullptr;
};
}

template<typename T>
class JArrayClass : public JavaClass<JArrayClass<T>, detail::JTypeArray> {
 public:
  static_assert(is_plain_jni_reference<T>(), "");
  // javaentry is the jni type of an entry in the array (i.e. jint).
  using javaentry = T;
  // javaobject is the jni type of the array.
  using javaobject = typename JavaClass<JArrayClass<T>, detail::JTypeArray>::javaobject;
  static constexpr const char* kJavaDescriptor = nullptr;
  static std::string get_instantiated_java_descriptor();
  static std::string get_instantiated_base_name();

  /// Allocate a new array from Java heap, for passing as a JNI parameter or return value.
  /// NOTE: if using as a return value, you want to call release() instead of get() on the
  /// smart pointer.
  static local_ref<javaobject> newArray(size_t count);

  /// Assign an object to the array.
  /// Typically you will use the shorthand (*ref)[idx]=value;
  void setElement(size_t idx, const T& value);

  /// Read an object from the array.
  /// Typically you will use the shorthand
  ///   T value = (*ref)[idx];
  /// If you use auto, you'll get an ElementProxy, which may need to be cast.
  local_ref<T> getElement(size_t idx);

  /// EXPERIMENTAL SUBSCRIPT SUPPORT
  /// This implementation of [] returns a proxy object which then has a bunch of specializations
  /// (adopt_local free function, operator= and casting overloads on the ElementProxy) that can
  /// make code look like it is dealing with a T rather than an obvious proxy. In particular, the
  /// proxy in this iteration does not read a value and therefore does not create a LocalRef
  /// until one of these other operators is used. There are certainly holes that you may find
  /// by using idioms that haven't been tried yet. Consider yourself warned. On the other hand,
  /// it does make for some idiomatic assignment code; see TestBuildStringArray in fbjni_tests
  /// for some examples.
  detail::ElementProxy<JArrayClass> operator[](size_t idx);
};

template <typename T>
using jtypeArray = typename JArrayClass<T>::javaobject;

template<typename T>
local_ref<typename JArrayClass<T>::javaobject> adopt_local_array(jobjectArray ref) {
  return adopt_local(static_cast<typename JArrayClass<T>::javaobject>(ref));
}

template<typename Target>
local_ref<typename Target::javaentry> adopt_local(detail::ElementProxy<Target> elementProxy) {
  return static_cast<local_ref<typename Target::javaentry>>(elementProxy);
}


struct FBEXPORT JStackTraceElement : JavaClass<JStackTraceElement> {
  static auto constexpr kJavaDescriptor = "Ljava/lang/StackTraceElement;";

  static local_ref<javaobject> create(const std::string& declaringClass, const std::string& methodName, const std::string& file, int line);

  std::string getClassName() const;
  std::string getMethodName() const;
  std::string getFileName() const;
  int getLineNumber() const;
};

/// Wrapper to provide functionality to jthrowable references
class FBEXPORT JThrowable : public JavaClass<JThrowable, JObject, jthrowable> {
 public:
  static constexpr const char* kJavaDescriptor = "Ljava/lang/Throwable;";
  local_ref<JThrowable> initCause(alias_ref<JThrowable> cause);
  using JStackTrace = JArrayClass<JStackTraceElement::javaobject>;
  local_ref<JStackTrace> getStackTrace();
};

template <typename T, typename PinAlloc>
class PinnedPrimitiveArray;

template <typename T> class PinnedArrayAlloc;
template <typename T> class PinnedRegionAlloc;
template <typename T> class PinnedCriticalAlloc;

/// Wrapper to provide functionality to jarray references.
/// This is an empty holder by itself. Construct a PinnedPrimitiveArray to actually interact with
/// the elements of the array.
template <typename JArrayType>
class FBEXPORT JPrimitiveArray :
    public JavaClass<JPrimitiveArray<JArrayType>, detail::JArray, JArrayType> {
  static_assert(is_jni_primitive_array<JArrayType>(), "");
 public:
  static constexpr const char* kJavaDescriptor = nullptr;
  static std::string get_instantiated_java_descriptor();
  static std::string get_instantiated_base_name();

  using T = typename jtype_traits<JArrayType>::entry_type;

  static local_ref<JArrayType> newArray(size_t count);

  void getRegion(jsize start, jsize length, T* buf);
  std::unique_ptr<T[]> getRegion(jsize start, jsize length);
  void setRegion(jsize start, jsize length, const T* buf);

  /// Returns a view of the underlying array. This will either be a "pinned"
  /// version of the array (in which case changes to one immediately affect the
  /// other) or a copy of the array (in which cases changes to the view will take
  /// affect when destroyed or on calls to release()/commit()).
  PinnedPrimitiveArray<T, PinnedArrayAlloc<T>> pin();

  /// Returns a view of part of the underlying array. A pinned region is always
  /// backed by a copy of the region.
  PinnedPrimitiveArray<T, PinnedRegionAlloc<T>> pinRegion(jsize start, jsize length);

  /// Returns a view of the underlying array like pin(). However, while the pin
  /// is held, the code is considered within a "critical region". In a critical
  /// region, native code must not call JNI functions or make any calls that may
  /// block on other Java threads. These restrictions make it more likely that
  /// the view will be "pinned" rather than copied (for example, the VM may
  /// suspend garbage collection within a critical region).
  PinnedPrimitiveArray<T, PinnedCriticalAlloc<T>> pinCritical();

private:
  friend class PinnedArrayAlloc<T>;
  T* getElements(jboolean* isCopy);
  void releaseElements(T* elements, jint mode);
};

FBEXPORT local_ref<jbooleanArray> make_boolean_array(jsize size);
FBEXPORT local_ref<jbyteArray> make_byte_array(jsize size);
FBEXPORT local_ref<jcharArray> make_char_array(jsize size);
FBEXPORT local_ref<jshortArray> make_short_array(jsize size);
FBEXPORT local_ref<jintArray> make_int_array(jsize size);
FBEXPORT local_ref<jlongArray> make_long_array(jsize size);
FBEXPORT local_ref<jfloatArray> make_float_array(jsize size);
FBEXPORT local_ref<jdoubleArray> make_double_array(jsize size);

using JArrayBoolean = JPrimitiveArray<jbooleanArray>;
using JArrayByte = JPrimitiveArray<jbyteArray>;
using JArrayChar = JPrimitiveArray<jcharArray>;
using JArrayShort = JPrimitiveArray<jshortArray>;
using JArrayInt = JPrimitiveArray<jintArray>;
using JArrayLong = JPrimitiveArray<jlongArray>;
using JArrayFloat = JPrimitiveArray<jfloatArray>;
using JArrayDouble = JPrimitiveArray<jdoubleArray>;

/// RAII class for pinned primitive arrays
/// This currently only supports read/write access to existing java arrays. You can't create a
/// primitive array this way yet. This class also pins the entire array into memory during the
/// lifetime of the PinnedPrimitiveArray. If you need to unpin the array manually, call the
/// release() or abort() functions. During a long-running block of code, you
/// should unpin the array as soon as you're done with it, to avoid holding up
/// the Java garbage collector.
template <typename T, typename PinAlloc>
class PinnedPrimitiveArray {
  public:
   static_assert(is_jni_primitive<T>::value,
       "PinnedPrimitiveArray requires primitive jni type.");

   using ArrayType = typename jtype_traits<T>::array_type;

   PinnedPrimitiveArray(PinnedPrimitiveArray&&);
   PinnedPrimitiveArray(const PinnedPrimitiveArray&) = delete;
   ~PinnedPrimitiveArray() noexcept;

   PinnedPrimitiveArray& operator=(PinnedPrimitiveArray&&);
   PinnedPrimitiveArray& operator=(const PinnedPrimitiveArray&) = delete;

   T* get();
   void release();
   /// Unpins the array. If the array is a copy, pending changes are discarded.
   void abort();
   /// If the array is a copy, copies pending changes to the underlying java array.
   void commit();

   bool isCopy() const noexcept;

   const T& operator[](size_t index) const;
   T& operator[](size_t index);
   size_t size() const noexcept;

  private:
   alias_ref<ArrayType> array_;
   size_t start_;
   T* elements_;
   jboolean isCopy_;
   size_t size_;

   void allocate(alias_ref<ArrayType>, jint start, jint length);
   void releaseImpl(jint mode);
   void clear() noexcept;

   PinnedPrimitiveArray(alias_ref<ArrayType>, jint start, jint length);

   friend class JPrimitiveArray<typename jtype_traits<T>::array_type>;
};

#pragma push_macro("PlainJniRefMap")
#undef PlainJniRefMap
#define PlainJniRefMap(rtype, jtype) \
namespace detail { \
template<> \
struct RefReprType<jtype> { \
  using type = rtype; \
}; \
}

PlainJniRefMap(JArrayBoolean, jbooleanArray);
PlainJniRefMap(JArrayByte, jbyteArray);
PlainJniRefMap(JArrayChar, jcharArray);
PlainJniRefMap(JArrayShort, jshortArray);
PlainJniRefMap(JArrayInt, jintArray);
PlainJniRefMap(JArrayLong, jlongArray);
PlainJniRefMap(JArrayFloat, jfloatArray);
PlainJniRefMap(JArrayDouble, jdoubleArray);
PlainJniRefMap(JObject, jobject);
PlainJniRefMap(JClass, jclass);
PlainJniRefMap(JString, jstring);
PlainJniRefMap(JThrowable, jthrowable);

#pragma pop_macro("PlainJniRefMap")

}}

#include "CoreClasses-inl.h"
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
/**
 * @file Exceptions.h
 *
 * After invoking a JNI function that can throw a Java exception, the macro
 * @ref FACEBOOK_JNI_THROW_PENDING_EXCEPTION() or @ref FACEBOOK_JNI_THROW_EXCEPTION_IF()
 * should be invoked.
 *
 * IMPORTANT! IMPORTANT! IMPORTANT! IMPORTANT! IMPORTANT! IMPORTANT! IMPORTANT! IMPORTANT!
 * To use these methods you MUST call initExceptionHelpers() when your library is loaded.
 */

#pragma once

#include <alloca.h>
#include <stdexcept>
#include <string>

#include <jni.h>

#include <fb/visibility.h>

#include "Common.h"
#include "References.h"
#include "CoreClasses.h"

namespace facebook {
namespace jni {

class JThrowable;

class JCppException : public JavaClass<JCppException, JThrowable> {
 public:
  static auto constexpr kJavaDescriptor = "Lcom/facebook/jni/CppException;";

  static local_ref<JCppException> create(const char* str) {
    return newInstance(make_jstring(str));
  }

  static local_ref<JCppException> create(const std::exception& ex) {
    return newInstance(make_jstring(ex.what()));
  }
};

// JniException ////////////////////////////////////////////////////////////////////////////////////

/**
 * This class wraps a Java exception into a C++ exception; if the exception is routed back
 * to the Java side, it can be unwrapped and just look like a pure Java interaction. The class
 * is resilient to errors while creating the exception, falling back to some pre-allocated
 * exceptions if a new one cannot be allocated or populated.
 *
 * Note: the what() method of this class is not thread-safe (t6900503).
 */
class FBEXPORT JniException : public std::exception {
 public:
  JniException();
  ~JniException();

  explicit JniException(alias_ref<jthrowable> throwable);

  JniException(JniException &&rhs);

  JniException(const JniException &other);

  local_ref<JThrowable> getThrowable() const noexcept;

  virtual const char* what() const noexcept;

  void setJavaException() const noexcept;

 private:
  global_ref<JThrowable> throwable_;
  mutable std::string what_;
  mutable bool isMessageExtracted_;
  const static std::string kExceptionMessageFailure_;

  void populateWhat() const noexcept;
};

// Exception throwing & translating functions //////////////////////////////////////////////////////

// Functions that throw C++ exceptions

static const int kMaxExceptionMessageBufferSize = 512;

// These methods are the preferred way to throw a Java exception from
// a C++ function.  They create and throw a C++ exception which wraps
// a Java exception, so the C++ flow is interrupted. Then, when
// translatePendingCppExceptionToJavaException is called at the
// topmost level of the native stack, the wrapped Java exception is
// thrown to the java caller.
template<typename... Args>
[[noreturn]] void throwNewJavaException(const char* throwableName, const char* fmt, Args... args) {
  int msgSize = snprintf(nullptr, 0, fmt, args...);

  char *msg = (char*) alloca(msgSize + 1);
  snprintf(msg, kMaxExceptionMessageBufferSize, fmt, args...);
  throwNewJavaException(throwableName, msg);
}

// Identifies any pending C++ exception and throws it as a Java exception. If the exception can't
// be thrown, it aborts the program. This is a noexcept function at C++ level.
FBEXPORT void translatePendingCppExceptionToJavaException() noexcept;

// For convenience, some exception names in java.lang are available here.

const char* const gJavaLangIllegalArgumentException = "java/lang/IllegalArgumentException";

}}
/*
 *  Copyright (c) 2016-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once

#include "CoreClasses.h"

namespace facebook {
namespace jni {

class JFile : public JavaClass<JFile> {
 public:
  static constexpr const char* kJavaDescriptor = "Ljava/io/File;";

  // Define a method that calls into the represented Java class
  std::string getAbsolutePath() {
    static auto method = getClass()->getMethod<jstring()>("getAbsolutePath");
    return method(self())->toStdString();
  }

};

}
}
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once

#include <memory>
#include <type_traits>

#include <fb/assert.h>
#include <fb/visibility.h>

#include "CoreClasses.h"

namespace facebook {
namespace jni {

namespace detail {

class BaseHybridClass {
public:
  virtual ~BaseHybridClass() {}
};

struct FBEXPORT HybridData : public JavaClass<HybridData> {
  constexpr static auto kJavaDescriptor = "Lcom/facebook/jni/HybridData;";
  void setNativePointer(std::unique_ptr<BaseHybridClass> new_value);
  BaseHybridClass* getNativePointer();
  static local_ref<HybridData> create();
};

template <typename Base, typename Enabled = void>
struct HybridTraits {
  // This static assert should actually always fail if we don't use one of the
  // specializations below.
  static_assert(
      std::is_base_of<JObject, Base>::value ||
      std::is_base_of<BaseHybridClass, Base>::value,
      "The base of a HybridClass must be either another HybridClass or derived from JObject.");
};

template <>
struct HybridTraits<BaseHybridClass> {
 using CxxBase = BaseHybridClass;
 using JavaBase = JObject;
};

template <typename Base>
struct HybridTraits<
    Base,
    typename std::enable_if<std::is_base_of<BaseHybridClass, Base>::value>::type> {
 using CxxBase = Base;
 using JavaBase = typename Base::JavaPart;
};

template <typename Base>
struct HybridTraits<
    Base,
    typename std::enable_if<std::is_base_of<JObject, Base>::value>::type> {
 using CxxBase = BaseHybridClass;
 using JavaBase = Base;
};

// convert to HybridClass* from jhybridobject
template <typename T>
struct FBEXPORT Convert<
  T, typename std::enable_if<
    std::is_base_of<BaseHybridClass, typename std::remove_pointer<T>::type>::value>::type> {
  typedef typename std::remove_pointer<T>::type::jhybridobject jniType;
  static T fromJni(jniType t) {
    if (t == nullptr) {
      return nullptr;
    }
    return wrap_alias(t)->cthis();
  }
  // There is no automatic return conversion for objects.
};

template<typename T>
struct RefReprType<T, typename std::enable_if<std::is_base_of<BaseHybridClass, T>::value, void>::type> {
  static_assert(std::is_same<T, void>::value,
      "HybridFoo (where HybridFoo derives from HybridClass<HybridFoo>) is not supported in this context. "
      "For an xxx_ref<HybridFoo>, you may want: xxx_ref<HybridFoo::javaobject> or HybridFoo*.");
  using Repr = T;
};


}

template <typename T, typename Base = detail::BaseHybridClass>
class FBEXPORT HybridClass : public detail::HybridTraits<Base>::CxxBase {
public:
  struct JavaPart : JavaClass<JavaPart, typename detail::HybridTraits<Base>::JavaBase> {
    // At this point, T is incomplete, and so we cannot access
    // T::kJavaDescriptor directly. jtype_traits support this escape hatch for
    // such a case.
    static constexpr const char* kJavaDescriptor = nullptr;
    static std::string get_instantiated_java_descriptor();
    static std::string get_instantiated_base_name();

    using HybridType = T;

    // This will reach into the java object and extract the C++ instance from
    // the mHybridData and return it.
    T* cthis();

    friend class HybridClass;
  };

  using jhybridobject = typename JavaPart::javaobject;
  using javaobject = typename JavaPart::javaobject;
  typedef detail::HybridData::javaobject jhybriddata;

  static alias_ref<JClass> javaClassStatic() {
    return JavaPart::javaClassStatic();
  }

  static local_ref<JClass> javaClassLocal() {
    std::string className(T::kJavaDescriptor + 1, strlen(T::kJavaDescriptor) - 2);
    return findClassLocal(className.c_str());
  }

protected:
  typedef HybridClass HybridBase;

  // This ensures that a C++ hybrid part cannot be created on its own
  // by default.  If a hybrid wants to enable this, it can provide its
  // own public ctor, or change the accessibility of this to public.
  using detail::HybridTraits<Base>::CxxBase::CxxBase;

  static void registerHybrid(std::initializer_list<NativeMethod> methods) {
    javaClassStatic()->registerNatives(methods);
  }

  static local_ref<detail::HybridData> makeHybridData(std::unique_ptr<T> cxxPart) {
    auto hybridData = detail::HybridData::create();
    hybridData->setNativePointer(std::move(cxxPart));
    return hybridData;
  }

  template <typename... Args>
  static local_ref<detail::HybridData> makeCxxInstance(Args&&... args) {
    return makeHybridData(std::unique_ptr<T>(new T(std::forward<Args>(args)...)));
  }

public:
  // Factory method for creating a hybrid object where the arguments
  // are used to initialize the C++ part directly without passing them
  // through java.  This method requires the Java part to have a ctor
  // which takes a HybridData, and for the C++ part to have a ctor
  // compatible with the arguments passed here.  For safety, the ctor
  // can be private, and the hybrid declared a friend of its base, so
  // the hybrid can only be created from here.
  //
  // Exception behavior: This can throw an exception if creating the
  // C++ object fails, or any JNI methods throw.
  template <typename... Args>
  static local_ref<JavaPart> newObjectCxxArgs(Args&&... args) {
    auto hybridData = makeCxxInstance(std::forward<Args>(args)...);
    return JavaPart::newInstance(hybridData);
  }

  // TODO? Create reusable interface for Allocatable classes and use it to
  // strengthen type-checking (and possibly provide a default
  // implementation of allocate().)
  template <typename... Args>
  static local_ref<jhybridobject> allocateWithCxxArgs(Args&&... args) {
    auto hybridData = makeCxxInstance(std::forward<Args>(args)...);
    static auto allocateMethod =
        javaClassStatic()->template getStaticMethod<jhybridobject(jhybriddata)>("allocate");
    return allocateMethod(javaClassStatic(), hybridData.get());
  }

  // Factory method for creating a hybrid object where the arguments
  // are passed to the java ctor.
  template <typename... Args>
  static local_ref<JavaPart> newObjectJavaArgs(Args&&... args) {
    return JavaPart::newInstance(std::move(args)...);
  }

  // If a hybrid class throws an exception which derives from
  // std::exception, it will be passed to mapException on the hybrid
  // class, or nearest ancestor.  This allows boilerplate exception
  // translation code (for example, calling throwNewJavaException on a
  // particular java class) to be hoisted to a common function.  If
  // mapException returns, then the std::exception will be translated
  // to Java.
  static void mapException(const std::exception& ex) {}
};

template <typename T, typename B>
inline T* HybridClass<T, B>::JavaPart::cthis() {
  static auto field =
    HybridClass<T, B>::JavaPart::javaClassStatic()->template getField<detail::HybridData::javaobject>("mHybridData");
  auto hybridData = this->getFieldValue(field);
  if (!hybridData) {
    throwNewJavaException("java/lang/NullPointerException", "java.lang.NullPointerException");
  }
  // I'd like to use dynamic_cast here, but -fno-rtti is the default.
  T* value = static_cast<T*>(hybridData->getNativePointer());
  // This would require some serious programmer error.
  FBASSERTMSGF(value != 0, "Incorrect C++ type in hybrid field");
  return value;
};

template <typename T, typename B>
/* static */ inline std::string HybridClass<T, B>::JavaPart::get_instantiated_java_descriptor() {
  return T::kJavaDescriptor;
}

template <typename T, typename B>
/* static */ inline std::string HybridClass<T, B>::JavaPart::get_instantiated_base_name() {
  auto name = get_instantiated_java_descriptor();
  return name.substr(1, name.size() - 2);
}

// Given a *_ref object which refers to a hybrid class, this will reach inside
// of it, find the mHybridData, extract the C++ instance pointer, cast it to
// the appropriate type, and return it.
template <typename T>
inline auto cthis(T jthis) -> decltype(jthis->cthis()) {
  return jthis->cthis();
}

void HybridDataOnLoad();

}
}
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once

namespace facebook {
namespace jni {

namespace detail {

template <typename E>
struct IteratorHelper : public JavaClass<IteratorHelper<E>> {
  constexpr static auto kJavaDescriptor = "Lcom/facebook/jni/IteratorHelper;";

  typedef local_ref<E> value_type;
  typedef ptrdiff_t difference_type;
  typedef value_type* pointer;
  typedef value_type& reference;
  typedef std::forward_iterator_tag iterator_category;

  typedef JavaClass<IteratorHelper<E>> JavaBase_;

  bool hasNext() const {
    static auto hasNextMethod =
      JavaBase_::javaClassStatic()->template getMethod<jboolean()>("hasNext");
    return hasNextMethod(JavaBase_::self());
  }

  value_type next() {
    static auto elementField =
      JavaBase_::javaClassStatic()->template getField<jobject>("mElement");
    return dynamic_ref_cast<E>(JavaBase_::getFieldValue(elementField));
  }

  static void reset(value_type& v) {
    v.reset();
  }
};

template <typename K, typename V>
struct MapIteratorHelper : public JavaClass<MapIteratorHelper<K,V>> {
  constexpr static auto kJavaDescriptor = "Lcom/facebook/jni/MapIteratorHelper;";

  typedef std::pair<local_ref<K>, local_ref<V>> value_type;

  typedef JavaClass<MapIteratorHelper<K,V>> JavaBase_;

  bool hasNext() const {
    static auto hasNextMethod =
      JavaBase_::javaClassStatic()->template getMethod<jboolean()>("hasNext");
    return hasNextMethod(JavaBase_::self());
  }

  value_type next() {
    static auto keyField = JavaBase_::javaClassStatic()->template getField<jobject>("mKey");
    static auto valueField = JavaBase_::javaClassStatic()->template getField<jobject>("mValue");
    return std::make_pair(dynamic_ref_cast<K>(JavaBase_::getFieldValue(keyField)),
                          dynamic_ref_cast<V>(JavaBase_::getFieldValue(valueField)));
  }

  static void reset(value_type& v) {
    v.first.reset();
    v.second.reset();
  }
};

template <typename T>
class Iterator {
 public:
  typedef typename T::value_type value_type;
  typedef ptrdiff_t difference_type;
  typedef value_type* pointer;
  typedef value_type& reference;
  typedef std::input_iterator_tag iterator_category;

  // begin ctor
  Iterator(global_ref<typename T::javaobject>&& helper)
      : helper_(std::move(helper))
      , i_(-1) {
    ++(*this);
  }

  // end ctor
  Iterator()
      : i_(-1) {}

  bool operator==(const Iterator& it) const { return i_ == it.i_; }
  bool operator!=(const Iterator& it) const { return !(*this == it); }
  const value_type& operator*() const { assert(i_ != -1); return entry_; }
  const value_type* operator->() const { assert(i_ != -1); return &entry_; }
  Iterator& operator++() {  // preincrement
    bool hasNext = helper_->hasNext();
    if (hasNext) {
      ++i_;
      entry_ = helper_->next();
    } else {
      i_ = -1;
      helper_->reset(entry_);
    }
    return *this;
  }
  Iterator operator++(int) {  // postincrement
    Iterator ret;
    ret.i_ = i_;
    ret.entry_ = std::move(entry_);
    ++(*this);
    return ret;
  }

  global_ref<typename T::javaobject> helper_;
  // set to -1 at end
  std::ptrdiff_t i_;
  value_type entry_;
};

}

template <typename E>
struct JIterator<E>::Iterator : public detail::Iterator<detail::IteratorHelper<E>> {
  using detail::Iterator<detail::IteratorHelper<E>>::Iterator;
};

template <typename E>
typename JIterator<E>::Iterator JIterator<E>::begin() const {
  static auto ctor = detail::IteratorHelper<E>::javaClassStatic()->
    template getConstructor<typename detail::IteratorHelper<E>::javaobject(
                              typename JIterator<E>::javaobject)>();
  return Iterator(
    make_global(
      detail::IteratorHelper<E>::javaClassStatic()->newObject(ctor, this->self())));
}

template <typename E>
typename JIterator<E>::Iterator JIterator<E>::end() const {
  return Iterator();
}

template <typename E>
struct JIterable<E>::Iterator : public detail::Iterator<detail::IteratorHelper<E>> {
  using detail::Iterator<detail::IteratorHelper<E>>::Iterator;
};

template <typename E>
typename JIterable<E>::Iterator JIterable<E>::begin() const {
  static auto ctor = detail::IteratorHelper<E>::javaClassStatic()->
    template getConstructor<typename detail::IteratorHelper<E>::javaobject(
                              typename JIterable<E>::javaobject)>();
  return Iterator(
    make_global(
      detail::IteratorHelper<E>::javaClassStatic()->newObject(ctor, this->self())));
}

template <typename E>
typename JIterable<E>::Iterator JIterable<E>::end() const {
  return Iterator();
}

template <typename E>
size_t JCollection<E>::size() const {
  static auto sizeMethod =
    JCollection<E>::javaClassStatic()->template getMethod<jint()>("size");
  return sizeMethod(this->self());
}

template <typename K, typename V>
struct JMap<K,V>::Iterator : public detail::Iterator<detail::MapIteratorHelper<K,V>> {
  using detail::Iterator<detail::MapIteratorHelper<K,V>>::Iterator;
};

template <typename K, typename V>
size_t JMap<K,V>::size() const {
  static auto sizeMethod =
    JMap<K,V>::javaClassStatic()->template getMethod<jint()>("size");
  return sizeMethod(this->self());
}

template <typename K, typename V>
typename JMap<K,V>::Iterator JMap<K,V>::begin() const {
  static auto ctor = detail::MapIteratorHelper<K,V>::javaClassStatic()->
    template getConstructor<typename detail::MapIteratorHelper<K,V>::javaobject(
                              typename JMap<K,V>::javaobject)>();
  return Iterator(
    make_global(
      detail::MapIteratorHelper<K,V>::javaClassStatic()->newObject(ctor, this->self())));
}

template <typename K, typename V>
typename JMap<K,V>::Iterator JMap<K,V>::end() const {
  return Iterator();
}

}
}
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once

#include "CoreClasses.h"

namespace facebook {
namespace jni {

/**
 * JavaClass which represents a reference to a java.util.Iterator instance.  It
 * provides begin()/end() methods to provide C++-style iteration over the
 * underlying collection.  The class has a template parameter for the element
 * type, which defaults to jobject.  For example:
 *
 * alias_ref<JIterator<jstring>::javaobject> my_iter = ...;
 *
 * In the simplest case, it can be used just as alias_ref<JIterator<>::javaobject>,
 * for example in a method declaration.
 */
template <typename E = jobject>
struct JIterator : JavaClass<JIterator<E>> {
  constexpr static auto kJavaDescriptor = "Ljava/util/Iterator;";

  struct Iterator;

  /**
   * To iterate:
   *
   * for (const auto& element : *jiter) { ... }
   *
   * The JIterator iterator value_type is local_ref<E>, containing a reference
   * to an element instance.
   *
   * If the Iterator returns objects whch are not convertible to the given
   * element type, iteration will throw a java ClassCastException.
   *
   * For example, to convert an iterator over a collection of java strings to
   * an std::vector of std::strings:
   *
   * std::vector<std::string> vs;
   * for (const auto& elem : *jiter) {
   *    vs.push_back(elem->toStdString());
   * }
   *
   * Or if you prefer using std algorithms:
   *
   * std::vector<std::string> vs;
   * std::transform(jiter->begin(), jiter->end(), std::back_inserter(vs),
   *                [](const local_ref<jstring>& elem) { return elem->toStdString(); });
   *
   * The iterator is a InputIterator.
   */
  Iterator begin() const;
  Iterator end() const;
};

/**
 * Similar to JIterator, except this represents any object which implements the
 * java.lang.Iterable interface. It will create the Java Iterator as a part of
 * begin().
 */
template <typename E = jobject>
struct JIterable : JavaClass<JIterable<E>> {
  constexpr static auto kJavaDescriptor = "Ljava/lang/Iterable;";

  struct Iterator;

  Iterator begin() const;
  Iterator end() const;
};

/**
 * JavaClass types which represent Collection, List, and Set are also provided.
 * These preserve the Java class heirarchy.
 */
template <typename E = jobject>
struct JCollection : JavaClass<JCollection<E>, JIterable<E>> {
  constexpr static auto kJavaDescriptor = "Ljava/util/Collection;";

  /**
   * Returns the number of elements in the collection.
   */
  size_t size() const;
};

template <typename E = jobject>
struct JList : JavaClass<JList<E>, JCollection<E>> {
  constexpr static auto kJavaDescriptor = "Ljava/util/List;";
};

template <typename E = jobject>
struct JSet : JavaClass<JSet<E>, JCollection<E>> {
  constexpr static auto kJavaDescriptor = "Ljava/util/Set;";
};

/**
 * JavaClass which represents a reference to a java.util.Map instance.  It adds
 * wrappers around Java methods, including begin()/end() methods to provide
 * C++-style iteration over the Java Map.  The class has template parameters
 * for the key and value types, which default to jobject.  For example:
 *
 * alias_ref<JMap<jstring, MyJClass::javaobject>::javaobject> my_map = ...;
 *
 * In the simplest case, it can be used just as alias_ref<JMap<>::javaobject>,
 * for example in a method declaration.
 */
template <typename K = jobject, typename V = jobject>
struct JMap : JavaClass<JMap<K,V>> {
  constexpr static auto kJavaDescriptor = "Ljava/util/Map;";

  struct Iterator;

  /**
   * Returns the number of pairs in the map.
   */
  size_t size() const;

  /**
   * To iterate over the Map:
   *
   * for (const auto& entry : *jmap) { ... }
   *
   * The JMap iterator value_type is std::pair<local_ref<K>, local_ref<V>>
   * containing references to key and value instances.
   *
   * If the Map contains objects whch are not convertible to the given key and
   * value types, iteration will throw a java ClassCastException.
   *
   * The iterator is a InputIterator.
   */
  Iterator begin() const;
  Iterator end() const;
};

}
}

#include "Iterator-inl.h"
/*
 *  Copyright (c) 2016-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once

#include "CoreClasses.h"
#include "NativeRunnable.h"

namespace facebook {
namespace jni {

class JThread : public JavaClass<JThread> {
 public:
  static constexpr const char* kJavaDescriptor = "Ljava/lang/Thread;";

  void start() {
    static auto method = javaClassStatic()->getMethod<void()>("start");
    method(self());
  }

  void join() {
    static auto method = javaClassStatic()->getMethod<void()>("join");
    method(self());
  }

  static local_ref<JThread> create(std::function<void()>&& runnable) {
    auto jrunnable = JNativeRunnable::newObjectCxxArgs(std::move(runnable));
    return newInstance(static_ref_cast<JRunnable::javaobject>(jrunnable));
  }
};

}
}
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once
#include "CoreClasses.h"

struct JThrowable : public facebook::jni::JavaClass<JThrowable, facebook::jni::JThrowable> {
  constexpr static auto kJavaDescriptor = "Ljava/lang/Throwable;";

  std::string getStackTrace() const;
};
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once

namespace facebook {
namespace jni {

template<typename F>
class JMethod;
template<typename F>
class JStaticMethod;
template<typename F>
class JNonvirtualMethod;
template<typename F>
struct JConstructor;
template<typename F>
class JField;
template<typename F>
class JStaticField;

/// Type traits for Java types (currently providing Java type descriptors)
template<typename T>
struct jtype_traits;

/// Type traits for Java methods (currently providing Java type descriptors)
template<typename F>
struct jmethod_traits;

}}
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once

#include <jni.h>

#include "Common.h"
#include "Exceptions.h"
#include "MetaConvert.h"
#include "References.h"
#include "Boxed.h"

#if defined(__ANDROID__)
#include <sys/system_properties.h>
#endif

namespace facebook {
namespace jni {

// JMethod /////////////////////////////////////////////////////////////////////////////////////////

inline JMethodBase::JMethodBase(jmethodID method_id) noexcept
  : method_id_{method_id}
{}

inline JMethodBase::operator bool() const noexcept {
  return method_id_ != nullptr;
}

inline jmethodID JMethodBase::getId() const noexcept {
  return method_id_;
}

namespace {

template <int idx, typename... Args>
struct ArgsArraySetter;

template <int idx, typename Arg, typename... Args>
struct ArgsArraySetter<idx, Arg, Args...> {
  static void set(alias_ref<JArrayClass<jobject>::javaobject> array, Arg arg0, Args... args) {
    // TODO(xxxxxxxx): Use Convert<Args>... to do conversions like the fast path.
    (*array)[idx] = autobox(arg0);
    ArgsArraySetter<idx + 1, Args...>::set(array, args...);
  }
};

template <int idx>
struct ArgsArraySetter<idx> {
  static void set(alias_ref<JArrayClass<jobject>::javaobject> array) {
  }
};

template <typename... Args>
local_ref<JArrayClass<jobject>::javaobject> makeArgsArray(Args... args) {
  auto arr = JArrayClass<jobject>::newArray(sizeof...(args));
  ArgsArraySetter<0, Args...>::set(arr, args...);
  return arr;
}


inline bool needsSlowPath(alias_ref<jobject> obj) {
#if defined(__ANDROID__)
  // On Android 6.0, art crashes when attempting to call a function on a Proxy.
  // So, when we detect that case we must use the safe, slow workaround. That is,
  // we resolve the method id to the corresponding java.lang.reflect.Method object
  // and make the call via it's invoke() method.
  static auto android_sdk = ([] {
     char sdk_version_str[PROP_VALUE_MAX];
     __system_property_get("ro.build.version.sdk", sdk_version_str);
     return atoi(sdk_version_str);
  })();
  static auto is_bad_android = android_sdk == 23;
  if (!is_bad_android) return false;
  static auto proxy_class = findClassStatic("java/lang/reflect/Proxy");
  return obj->isInstanceOf(proxy_class);
#else
  return false;
#endif
}

}

template<typename... Args>
inline void JMethod<void(Args...)>::operator()(alias_ref<jobject> self, Args... args) {
  const auto env = Environment::current();
  env->CallVoidMethod(
        self.get(),
        getId(),
        detail::callToJni(detail::Convert<typename std::decay<Args>::type>::toCall(args))...);
  FACEBOOK_JNI_THROW_PENDING_EXCEPTION();
}

#pragma push_macro("DEFINE_PRIMITIVE_CALL")
#undef DEFINE_PRIMITIVE_CALL
#define DEFINE_PRIMITIVE_CALL(TYPE, METHOD, CLASS)                                             \
template<typename... Args>                                                                     \
inline TYPE JMethod<TYPE(Args...)>::operator()(alias_ref<jobject> self, Args... args) {        \
  const auto env = internal::getEnv();                                                         \
  auto result = env->Call ## METHOD ## Method(                                                 \
        self.get(),                                                                            \
        getId(),                                                                               \
        detail::callToJni(detail::Convert<typename std::decay<Args>::type>::toCall(args))...); \
  FACEBOOK_JNI_THROW_PENDING_EXCEPTION();                                                      \
  return result;                                                                               \
}

DEFINE_PRIMITIVE_CALL(jboolean, Boolean, JBoolean)
DEFINE_PRIMITIVE_CALL(jbyte, Byte, JByte)
DEFINE_PRIMITIVE_CALL(jchar, Char, JCharacter)
DEFINE_PRIMITIVE_CALL(jshort, Short, JShort)
DEFINE_PRIMITIVE_CALL(jint, Int, JInteger)
DEFINE_PRIMITIVE_CALL(jlong, Long, JLong)
DEFINE_PRIMITIVE_CALL(jfloat, Float, JFloat)
DEFINE_PRIMITIVE_CALL(jdouble, Double, JDouble)
#pragma pop_macro("DEFINE_PRIMITIVE_CALL")

/// JMethod specialization for references that wraps the return value in a @ref local_ref
template<typename R, typename... Args>
class JMethod<R(Args...)> : public JMethodBase {
 public:
   // TODO: static_assert is jobject-derived or local_ref jobject
  using JniRet = typename detail::Convert<typename std::decay<R>::type>::jniType;
  static_assert(IsPlainJniReference<JniRet>(), "JniRet must be a JNI reference");
  using JMethodBase::JMethodBase;
  JMethod() noexcept {};
  JMethod(const JMethod& other) noexcept = default;

  /// Invoke a method and return a local reference wrapping the result
  local_ref<JniRet> operator()(alias_ref<jobject> self, Args... args);

  friend class JClass;
};

template<typename R, typename... Args>
inline auto JMethod<R(Args...)>::operator()(alias_ref<jobject> self, Args... args) -> local_ref<JniRet> {
  const auto env = Environment::current();
  auto result = env->CallObjectMethod(
      self.get(),
      getId(),
      detail::callToJni(detail::Convert<typename std::decay<Args>::type>::toCall(args))...);
  FACEBOOK_JNI_THROW_PENDING_EXCEPTION();
  return adopt_local(static_cast<JniRet>(result));
}

template<typename... Args>
inline void JStaticMethod<void(Args...)>::operator()(alias_ref<jclass> cls, Args... args) {
  const auto env = internal::getEnv();
  env->CallStaticVoidMethod(
        cls.get(),
        getId(),
        detail::callToJni(detail::Convert<typename std::decay<Args>::type>::toCall(args))...);
  FACEBOOK_JNI_THROW_PENDING_EXCEPTION();
}

#pragma push_macro("DEFINE_PRIMITIVE_STATIC_CALL")
#undef DEFINE_PRIMITIVE_STATIC_CALL
#define DEFINE_PRIMITIVE_STATIC_CALL(TYPE, METHOD)                                             \
template<typename... Args>                                                                     \
inline TYPE JStaticMethod<TYPE(Args...)>::operator()(alias_ref<jclass> cls, Args... args) {    \
  const auto env = internal::getEnv();                                                         \
  auto result = env->CallStatic ## METHOD ## Method(                                           \
        cls.get(),                                                                             \
        getId(),                                                                               \
        detail::callToJni(detail::Convert<typename std::decay<Args>::type>::toCall(args))...); \
  FACEBOOK_JNI_THROW_PENDING_EXCEPTION();                                                      \
        return result;                                                                         \
}

DEFINE_PRIMITIVE_STATIC_CALL(jboolean, Boolean)
DEFINE_PRIMITIVE_STATIC_CALL(jbyte, Byte)
DEFINE_PRIMITIVE_STATIC_CALL(jchar, Char)
DEFINE_PRIMITIVE_STATIC_CALL(jshort, Short)
DEFINE_PRIMITIVE_STATIC_CALL(jint, Int)
DEFINE_PRIMITIVE_STATIC_CALL(jlong, Long)
DEFINE_PRIMITIVE_STATIC_CALL(jfloat, Float)
DEFINE_PRIMITIVE_STATIC_CALL(jdouble, Double)
#pragma pop_macro("DEFINE_PRIMITIVE_STATIC_CALL")

/// JStaticMethod specialization for references that wraps the return value in a @ref local_ref
template<typename R, typename... Args>
class JStaticMethod<R(Args...)> : public JMethodBase {

 public:
  using JniRet = typename detail::Convert<typename std::decay<R>::type>::jniType;
  static_assert(IsPlainJniReference<JniRet>(), "T* must be a JNI reference");
  using JMethodBase::JMethodBase;
  JStaticMethod() noexcept {};
  JStaticMethod(const JStaticMethod& other) noexcept = default;

  /// Invoke a method and return a local reference wrapping the result
  local_ref<JniRet> operator()(alias_ref<jclass> cls, Args... args) {
    const auto env = internal::getEnv();
    auto result = env->CallStaticObjectMethod(
          cls.get(),
          getId(),
          detail::callToJni(detail::Convert<typename std::decay<Args>::type>::toCall(args))...);
    FACEBOOK_JNI_THROW_PENDING_EXCEPTION();
    return adopt_local(static_cast<JniRet>(result));
  }

  friend class JClass;
};

template<typename... Args>
inline void
JNonvirtualMethod<void(Args...)>::operator()(alias_ref<jobject> self, alias_ref<jclass> cls, Args... args) {
  const auto env = internal::getEnv();
  env->CallNonvirtualVoidMethod(
        self.get(),
        cls.get(),
        getId(),
        detail::callToJni(detail::Convert<typename std::decay<Args>::type>::toCall(args))...);
  FACEBOOK_JNI_THROW_PENDING_EXCEPTION();
}

#pragma push_macro("DEFINE_PRIMITIVE_NON_VIRTUAL_CALL")
#undef DEFINE_PRIMITIVE_NON_VIRTUAL_CALL
#define DEFINE_PRIMITIVE_NON_VIRTUAL_CALL(TYPE, METHOD)                                                      \
template<typename... Args>                                                                                   \
inline TYPE                                                                                                  \
JNonvirtualMethod<TYPE(Args...)>::operator()(alias_ref<jobject> self, alias_ref<jclass> cls, Args... args) { \
  const auto env = internal::getEnv();                                                                       \
  auto result = env->CallNonvirtual ## METHOD ## Method(                                                     \
        self.get(),                                                                                          \
        cls.get(),                                                                                           \
        getId(),                                                                                             \
        detail::callToJni(detail::Convert<typename std::decay<Args>::type>::toCall(args))...);               \
  FACEBOOK_JNI_THROW_PENDING_EXCEPTION();                                                                    \
  return result;                                                                                             \
}

DEFINE_PRIMITIVE_NON_VIRTUAL_CALL(jboolean, Boolean)
DEFINE_PRIMITIVE_NON_VIRTUAL_CALL(jbyte, Byte)
DEFINE_PRIMITIVE_NON_VIRTUAL_CALL(jchar, Char)
DEFINE_PRIMITIVE_NON_VIRTUAL_CALL(jshort, Short)
DEFINE_PRIMITIVE_NON_VIRTUAL_CALL(jint, Int)
DEFINE_PRIMITIVE_NON_VIRTUAL_CALL(jlong, Long)
DEFINE_PRIMITIVE_NON_VIRTUAL_CALL(jfloat, Float)
DEFINE_PRIMITIVE_NON_VIRTUAL_CALL(jdouble, Double)
#pragma pop_macro("DEFINE_PRIMITIVE_NON_VIRTUAL_CALL")

/// JNonvirtualMethod specialization for references that wraps the return value in a @ref local_ref
template<typename R, typename... Args>
class JNonvirtualMethod<R(Args...)> : public JMethodBase {
 public:
  using JniRet = typename detail::Convert<typename std::decay<R>::type>::jniType;
  static_assert(IsPlainJniReference<JniRet>(), "T* must be a JNI reference");
  using JMethodBase::JMethodBase;
  JNonvirtualMethod() noexcept {};
  JNonvirtualMethod(const JNonvirtualMethod& other) noexcept = default;

  /// Invoke a method and return a local reference wrapping the result
  local_ref<JniRet> operator()(alias_ref<jobject> self, alias_ref<jclass> cls, Args... args){
    const auto env = internal::getEnv();
    auto result = env->CallNonvirtualObjectMethod(
          self.get(),
          cls.get(),
          getId(),
          detail::callToJni(detail::Convert<typename std::decay<Args>::type>::toCall(args))...);
    FACEBOOK_JNI_THROW_PENDING_EXCEPTION();
    return adopt_local(static_cast<JniRet>(result));
  }

  friend class JClass;
};

template <typename... Args>
local_ref<jobject> slowCall(jmethodID method_id, alias_ref<jobject> self, Args... args) {
    static auto invoke = findClassStatic("java/lang/reflect/Method")
      ->getMethod<jobject(jobject, JArrayClass<jobject>::javaobject)>("invoke");
    // TODO(xxxxxxx): Provide fbjni interface to ToReflectedMethod.
    auto reflected = adopt_local(Environment::current()->ToReflectedMethod(self->getClass().get(), method_id, JNI_FALSE));
    FACEBOOK_JNI_THROW_PENDING_EXCEPTION();
    if (!reflected) throw std::runtime_error("Unable to get reflected java.lang.reflect.Method");
    auto argsArray = makeArgsArray(args...);
    // No need to check for exceptions since invoke is itself a JMethod that will do that for us.
    return invoke(reflected, self.get(), argsArray.get());
}


// JField<T> ///////////////////////////////////////////////////////////////////////////////////////

template<typename T>
inline JField<T>::JField(jfieldID field) noexcept
  : field_id_{field}
{}

template<typename T>
inline JField<T>::operator bool() const noexcept {
  return field_id_ != nullptr;
}

template<typename T>
inline jfieldID JField<T>::getId() const noexcept {
  return field_id_;
}

#pragma push_macro("DEFINE_FIELD_PRIMITIVE_GET_SET")
#undef DEFINE_FIELD_PRIMITIVE_GET_SET
#define DEFINE_FIELD_PRIMITIVE_GET_SET(TYPE, METHOD)                 \
template<>                                                           \
inline TYPE JField<TYPE>::get(jobject object) const noexcept {       \
  const auto env = internal::getEnv();                               \
  return env->Get ## METHOD ## Field(object, field_id_);             \
}                                                                    \
                                                                     \
template<>                                                           \
inline void JField<TYPE>::set(jobject object, TYPE value) noexcept { \
  const auto env = internal::getEnv();                               \
  env->Set ## METHOD ## Field(object, field_id_, value);             \
}

DEFINE_FIELD_PRIMITIVE_GET_SET(jboolean, Boolean)
DEFINE_FIELD_PRIMITIVE_GET_SET(jbyte, Byte)
DEFINE_FIELD_PRIMITIVE_GET_SET(jchar, Char)
DEFINE_FIELD_PRIMITIVE_GET_SET(jshort, Short)
DEFINE_FIELD_PRIMITIVE_GET_SET(jint, Int)
DEFINE_FIELD_PRIMITIVE_GET_SET(jlong, Long)
DEFINE_FIELD_PRIMITIVE_GET_SET(jfloat, Float)
DEFINE_FIELD_PRIMITIVE_GET_SET(jdouble, Double)
#pragma pop_macro("DEFINE_FIELD_PRIMITIVE_GET_SET")

template<typename T>
inline T JField<T>::get(jobject object) const noexcept {
  return static_cast<T>(internal::getEnv()->GetObjectField(object, field_id_));
}

template<typename T>
inline void JField<T>::set(jobject object, T value) noexcept {
  internal::getEnv()->SetObjectField(object, field_id_, static_cast<jobject>(value));
}

// JStaticField<T> /////////////////////////////////////////////////////////////////////////////////

template<typename T>
inline JStaticField<T>::JStaticField(jfieldID field) noexcept
  : field_id_{field}
{}

template<typename T>
inline JStaticField<T>::operator bool() const noexcept {
  return field_id_ != nullptr;
}

template<typename T>
inline jfieldID JStaticField<T>::getId() const noexcept {
  return field_id_;
}

#pragma push_macro("DEFINE_STATIC_FIELD_PRIMITIVE_GET_SET")
#undef DEFINE_STATIC_FIELD_PRIMITIVE_GET_SET
#define DEFINE_STATIC_FIELD_PRIMITIVE_GET_SET(TYPE, METHOD)                \
template<>                                                                 \
inline TYPE JStaticField<TYPE>::get(jclass jcls) const noexcept {          \
  const auto env = internal::getEnv();                                     \
  return env->GetStatic ## METHOD ## Field(jcls, field_id_);               \
}                                                                          \
                                                                           \
template<>                                                                 \
inline void JStaticField<TYPE>::set(jclass jcls, TYPE value) noexcept {    \
  const auto env = internal::getEnv();                                     \
  env->SetStatic ## METHOD ## Field(jcls, field_id_, value);               \
}

DEFINE_STATIC_FIELD_PRIMITIVE_GET_SET(jboolean, Boolean)
DEFINE_STATIC_FIELD_PRIMITIVE_GET_SET(jbyte, Byte)
DEFINE_STATIC_FIELD_PRIMITIVE_GET_SET(jchar, Char)
DEFINE_STATIC_FIELD_PRIMITIVE_GET_SET(jshort, Short)
DEFINE_STATIC_FIELD_PRIMITIVE_GET_SET(jint, Int)
DEFINE_STATIC_FIELD_PRIMITIVE_GET_SET(jlong, Long)
DEFINE_STATIC_FIELD_PRIMITIVE_GET_SET(jfloat, Float)
DEFINE_STATIC_FIELD_PRIMITIVE_GET_SET(jdouble, Double)
#pragma pop_macro("DEFINE_STATIC_FIELD_PRIMITIVE_GET_SET")

template<typename T>
inline T JStaticField<T>::get(jclass jcls) const noexcept {
  const auto env = internal::getEnv();
  return static_cast<T>(env->GetStaticObjectField(jcls, field_id_));
}

template<typename T>
inline void JStaticField<T>::set(jclass jcls, T value) noexcept {
  internal::getEnv()->SetStaticObjectField(jcls, field_id_, value);
}


// jmethod_traits //////////////////////////////////////////////////////////////////////////////////

// TODO(T6608405) Adapt this to implement a register natives method that requires no descriptor
namespace internal {

template<typename Head>
inline std::string JavaDescriptor() {
  return jtype_traits<Head>::descriptor();
}

template<typename Head, typename Elem, typename... Tail>
inline std::string JavaDescriptor() {
  return JavaDescriptor<Head>() + JavaDescriptor<Elem, Tail...>();
}

template<typename R, typename Arg1, typename... Args>
inline std::string JMethodDescriptor() {
  return "(" + JavaDescriptor<Arg1, Args...>() + ")" + JavaDescriptor<R>();
}

template<typename R>
inline std::string JMethodDescriptor() {
  return "()" + JavaDescriptor<R>();
}

} // internal

template<typename R, typename... Args>
inline std::string jmethod_traits<R(Args...)>::descriptor() {
  return internal::JMethodDescriptor<R, Args...>();
}

template<typename R, typename... Args>
inline std::string jmethod_traits<R(Args...)>::constructor_descriptor() {
  return internal::JMethodDescriptor<void, Args...>();
}

}}
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
/** @file meta.h
 *
 * Provides wrappers for meta data such as methods and fields.
 */

#pragma once

#include <type_traits>
#include <string>

#include <jni.h>

#include "References-forward.h"

#ifdef __ANDROID__
# include <android/log.h>
# define XLOG_TAG "fb-jni"
# define XLOGV(...) __android_log_print(ANDROID_LOG_VERBOSE, XLOG_TAG, __VA_ARGS__)
# define XLOGD(...) __android_log_print(ANDROID_LOG_DEBUG, XLOG_TAG, __VA_ARGS__)
# define XLOGI(...) __android_log_print(ANDROID_LOG_INFO, XLOG_TAG, __VA_ARGS__)
# define XLOGW(...) __android_log_print(ANDROID_LOG_WARN, XLOG_TAG, __VA_ARGS__)
# define XLOGE(...) __android_log_print(ANDROID_LOG_ERROR, XLOG_TAG, __VA_ARGS__)
# define XLOGWTF(...) __android_log_print(ANDROID_LOG_FATAL, XLOG_TAG, __VA_ARGS__)
#endif

namespace facebook {
namespace jni {

// This will get the reflected Java Method from the method_id, get it's invoke
// method, and call the method via that. This shouldn't ever be needed, but
// Android 6.0 crashes when calling a method on a java.lang.Proxy via jni.
template <typename... Args>
local_ref<jobject> slowCall(jmethodID method_id, alias_ref<jobject> self, Args... args);

class JObject;


/// Wrapper of a jmethodID. Provides a common base for JMethod specializations
class JMethodBase {
 public:
  /// Verify that the method is valid
  explicit operator bool() const noexcept;

  /// Access the wrapped id
  jmethodID getId() const noexcept;

 protected:
  /// Create a wrapper of a method id
  explicit JMethodBase(jmethodID method_id = nullptr) noexcept;

 private:
  jmethodID method_id_;
};


/// Representation of a jmethodID
template<typename F>
class JMethod;

/// @cond INTERNAL
#pragma push_macro("DEFINE_PRIMITIVE_METHOD_CLASS")

#undef DEFINE_PRIMITIVE_METHOD_CLASS

// Defining JMethod specializations based on return value
#define DEFINE_PRIMITIVE_METHOD_CLASS(TYPE)                                      \
template<typename... Args>                                                       \
class JMethod<TYPE(Args...)> : public JMethodBase {                              \
 public:                                                                         \
  static_assert(std::is_void<TYPE>::value || IsJniPrimitive<TYPE>(),             \
      "TYPE must be primitive or void");                                         \
                                                                                 \
  using JMethodBase::JMethodBase;                                                \
  JMethod() noexcept {};                                                         \
  JMethod(const JMethod& other) noexcept = default;                              \
                                                                                 \
  TYPE operator()(alias_ref<jobject> self, Args... args);                        \
                                                                                 \
  friend class JClass;                                                           \
}

DEFINE_PRIMITIVE_METHOD_CLASS(void);
DEFINE_PRIMITIVE_METHOD_CLASS(jboolean);
DEFINE_PRIMITIVE_METHOD_CLASS(jbyte);
DEFINE_PRIMITIVE_METHOD_CLASS(jchar);
DEFINE_PRIMITIVE_METHOD_CLASS(jshort);
DEFINE_PRIMITIVE_METHOD_CLASS(jint);
DEFINE_PRIMITIVE_METHOD_CLASS(jlong);
DEFINE_PRIMITIVE_METHOD_CLASS(jfloat);
DEFINE_PRIMITIVE_METHOD_CLASS(jdouble);

#pragma pop_macro("DEFINE_PRIMITIVE_METHOD_CLASS")
/// @endcond


/// Convenience type representing constructors
/// These should only be used with JClass::getConstructor and JClass::newObject.
template<typename F>
struct JConstructor : private JMethod<F> {
  using JMethod<F>::JMethod;
 private:
  JConstructor(const JMethod<F>& other) : JMethod<F>(other.getId()) {}
  friend class JClass;
};

/// Representation of a jStaticMethodID
template<typename F>
class JStaticMethod;

/// @cond INTERNAL
#pragma push_macro("DEFINE_PRIMITIVE_STATIC_METHOD_CLASS")

#undef DEFINE_PRIMITIVE_STATIC_METHOD_CLASS

// Defining JStaticMethod specializations based on return value
#define DEFINE_PRIMITIVE_STATIC_METHOD_CLASS(TYPE)                          \
template<typename... Args>                                                  \
class JStaticMethod<TYPE(Args...)> : public JMethodBase {                   \
  static_assert(std::is_void<TYPE>::value || IsJniPrimitive<TYPE>(),        \
      "T must be a JNI primitive or void");                                 \
                                                                            \
 public:                                                                    \
  using JMethodBase::JMethodBase;                                           \
  JStaticMethod() noexcept {};                                              \
  JStaticMethod(const JStaticMethod& other) noexcept = default;             \
                                                                            \
  TYPE operator()(alias_ref<jclass> cls, Args... args);                     \
                                                                            \
  friend class JClass;                                                      \
}

DEFINE_PRIMITIVE_STATIC_METHOD_CLASS(void);
DEFINE_PRIMITIVE_STATIC_METHOD_CLASS(jboolean);
DEFINE_PRIMITIVE_STATIC_METHOD_CLASS(jbyte);
DEFINE_PRIMITIVE_STATIC_METHOD_CLASS(jchar);
DEFINE_PRIMITIVE_STATIC_METHOD_CLASS(jshort);
DEFINE_PRIMITIVE_STATIC_METHOD_CLASS(jint);
DEFINE_PRIMITIVE_STATIC_METHOD_CLASS(jlong);
DEFINE_PRIMITIVE_STATIC_METHOD_CLASS(jfloat);
DEFINE_PRIMITIVE_STATIC_METHOD_CLASS(jdouble);

#pragma pop_macro("DEFINE_PRIMITIVE_STATIC_METHOD_CLASS")
/// @endcond


/// Representation of a jNonvirtualMethodID
template<typename F>
class JNonvirtualMethod;

/// @cond INTERNAL
#pragma push_macro("DEFINE_PRIMITIVE_NON_VIRTUAL_METHOD_CLASS")

#undef DEFINE_PRIMITIVE_NON_VIRTUAL_METHOD_CLASS

// Defining JNonvirtualMethod specializations based on return value
#define DEFINE_PRIMITIVE_NON_VIRTUAL_METHOD_CLASS(TYPE)                     \
template<typename... Args>                                                  \
class JNonvirtualMethod<TYPE(Args...)> : public JMethodBase {               \
  static_assert(std::is_void<TYPE>::value || IsJniPrimitive<TYPE>(),        \
      "T must be a JNI primitive or void");                                 \
                                                                            \
 public:                                                                    \
  using JMethodBase::JMethodBase;                                           \
  JNonvirtualMethod() noexcept {};                                          \
  JNonvirtualMethod(const JNonvirtualMethod& other) noexcept = default;     \
                                                                            \
  TYPE operator()(alias_ref<jobject> self, alias_ref<jclass> cls, Args... args);       \
                                                                            \
  friend class JClass;                                                      \
}

DEFINE_PRIMITIVE_NON_VIRTUAL_METHOD_CLASS(void);
DEFINE_PRIMITIVE_NON_VIRTUAL_METHOD_CLASS(jboolean);
DEFINE_PRIMITIVE_NON_VIRTUAL_METHOD_CLASS(jbyte);
DEFINE_PRIMITIVE_NON_VIRTUAL_METHOD_CLASS(jchar);
DEFINE_PRIMITIVE_NON_VIRTUAL_METHOD_CLASS(jshort);
DEFINE_PRIMITIVE_NON_VIRTUAL_METHOD_CLASS(jint);
DEFINE_PRIMITIVE_NON_VIRTUAL_METHOD_CLASS(jlong);
DEFINE_PRIMITIVE_NON_VIRTUAL_METHOD_CLASS(jfloat);
DEFINE_PRIMITIVE_NON_VIRTUAL_METHOD_CLASS(jdouble);

#pragma pop_macro("DEFINE_PRIMITIVE_NON_VIRTUAL_METHOD_CLASS")
/// @endcond


/**
 * JField represents typed fields and simplifies their access. Note that object types return
 * raw pointers which generally should promptly get a wrap_local treatment.
 */
template<typename T>
class JField {
  static_assert(IsJniScalar<T>(), "T must be a JNI scalar");

 public:
  /// Wraps an existing field id
  explicit JField(jfieldID field = nullptr) noexcept;

  /// Verify that the id is valid
  explicit operator bool() const noexcept;

  /// Access the wrapped id
  jfieldID getId() const noexcept;

 private:
  jfieldID field_id_;

  /// Get field value
  /// @pre object != nullptr
  T get(jobject object) const noexcept;

  /// Set field value
  /// @pre object != nullptr
  void set(jobject object, T value) noexcept;

  friend class JObject;
};


/**
 * JStaticField represents typed fields and simplifies their access. Note that object types
 * return raw pointers which generally should promptly get a wrap_local treatment.
 */
template<typename T>
class JStaticField {
  static_assert(IsJniScalar<T>(), "T must be a JNI scalar");

 public:
  /// Wraps an existing field id
  explicit JStaticField(jfieldID field = nullptr) noexcept;

  /// Verify that the id is valid
  explicit operator bool() const noexcept;

  /// Access the wrapped id
  jfieldID getId() const noexcept;

 private:
  jfieldID field_id_;

  /// Get field value
  /// @pre object != nullptr
  T get(jclass jcls) const noexcept;

  /// Set field value
  /// @pre object != nullptr
  void set(jclass jcls, T value) noexcept;

  friend class JClass;
  friend class JObject;
};


/// Template magic to provide @ref jmethod_traits
template<typename R, typename... Args>
struct jmethod_traits<R(Args...)> {
  static std::string descriptor();
  static std::string constructor_descriptor();
};


// jtype_traits ////////////////////////////////////////////////////////////////////////////////////

template<typename T>
struct jtype_traits {
private:
  using Repr = ReprType<T>;
public:
  // The jni type signature (described at
  // http://docs.oracle.com/javase/1.5.0/docs/guide/jni/spec/types.html).
  static std::string descriptor() {
    std::string descriptor;
    if (Repr::kJavaDescriptor == nullptr) {
      descriptor = Repr::get_instantiated_java_descriptor();
    } else {
      descriptor = Repr::kJavaDescriptor;
    }
    return descriptor;
  }

  // The signature used for class lookups. See
  // http://docs.oracle.com/javase/6/docs/api/java/lang/Class.html#getName().
  static std::string base_name() {
    if (Repr::kJavaDescriptor != nullptr) {
      std::string base_name = Repr::kJavaDescriptor;
      return base_name.substr(1, base_name.size() - 2);
    }
    return Repr::get_instantiated_base_name();
  }
};

#pragma push_macro("DEFINE_FIELD_AND_ARRAY_TRAIT")
#undef DEFINE_FIELD_AND_ARRAY_TRAIT

#define DEFINE_FIELD_AND_ARRAY_TRAIT(TYPE, DSC)                     \
template<>                                                          \
struct jtype_traits<TYPE> {                                         \
  static std::string descriptor() { return std::string{#DSC}; }     \
  static std::string base_name() { return descriptor(); }           \
  using array_type = TYPE ## Array;                                 \
};                                                                  \
template<>                                                          \
struct jtype_traits<TYPE ## Array> {                                \
  static std::string descriptor() { return std::string{"[" #DSC}; } \
  static std::string base_name() { return descriptor(); }           \
  using entry_type = TYPE;                                          \
};

// There is no voidArray, handle that without the macro.
template<>
struct jtype_traits<void> {
  static std::string descriptor() { return std::string{"V"}; };
};

DEFINE_FIELD_AND_ARRAY_TRAIT(jboolean, Z)
DEFINE_FIELD_AND_ARRAY_TRAIT(jbyte,    B)
DEFINE_FIELD_AND_ARRAY_TRAIT(jchar,    C)
DEFINE_FIELD_AND_ARRAY_TRAIT(jshort,   S)
DEFINE_FIELD_AND_ARRAY_TRAIT(jint,     I)
DEFINE_FIELD_AND_ARRAY_TRAIT(jlong,    J)
DEFINE_FIELD_AND_ARRAY_TRAIT(jfloat,   F)
DEFINE_FIELD_AND_ARRAY_TRAIT(jdouble,  D)

#pragma pop_macro("DEFINE_FIELD_AND_ARRAY_TRAIT")


template <typename T>
struct jmethod_traits_from_cxx;

}}

#include "Meta-inl.h"
/*
 *  Copyright (c) 2004-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once

#include <jni.h>

#include "Common.h"
#include "References.h"

namespace facebook {
namespace jni {

namespace detail {

// In order to avoid potentially filling the jni locals table,
// temporary objects (right now, this is just jstrings) need to be
// released. This is done by returning a holder which autoconverts to
// jstring.
template <typename T>
inline T callToJni(T&& t) {
  return t;
}

template <typename T>
inline JniType<T> callToJni(local_ref<T>&& sref) {
  return sref.get();
}

// Normally, pass through types unmolested.
template <typename T, typename Enabled = void>
struct Convert {
  typedef T jniType;
  static jniType fromJni(jniType t) {
    return t;
  }
  static jniType toJniRet(jniType t) {
    return t;
  }
  static jniType toCall(jniType t) {
    return t;
  }
};

// This is needed for return conversion
template <>
struct Convert<void> {
  typedef void jniType;
};

// jboolean is an unsigned char, not a bool. Allow it to work either way.
template<>
struct Convert<bool> {
  typedef jboolean jniType;
  static bool fromJni(jniType t) {
    return t;
  }
  static jniType toJniRet(bool t) {
    return t;
  }
  static jniType toCall(bool t) {
    return t;
  }
};

// convert to alias_ref<T> from T
template <typename T>
struct Convert<alias_ref<T>> {
  typedef JniType<T> jniType;
  static alias_ref<jniType> fromJni(jniType t) {
    return wrap_alias(t);
  }
  static jniType toJniRet(alias_ref<jniType> t) {
    return t.get();
  }
  static jniType toCall(alias_ref<jniType> t) {
    return t.get();
  }
};

// convert return from local_ref<T>
template <typename T>
struct Convert<local_ref<T>> {
  typedef JniType<T> jniType;
  // No automatic synthesis of local_ref
  static jniType toJniRet(local_ref<jniType> t) {
    return t.release();
  }
  static jniType toCall(local_ref<jniType> t) {
    return t.get();
  }
};

// convert return from global_ref<T>
template <typename T>
struct Convert<global_ref<T>> {
  typedef JniType<T> jniType;
  // No automatic synthesis of global_ref
  static jniType toJniRet(global_ref<jniType> t) {
    return t.get();
  }
  static jniType toCall(global_ref<jniType> t) {
    return t.get();
  }
};

template <typename T> struct jni_sig_from_cxx_t;
template <typename R, typename... Args>
struct jni_sig_from_cxx_t<R(Args...)> {
  using JniRet = typename Convert<typename std::decay<R>::type>::jniType;
  using JniSig = JniRet(typename Convert<typename std::decay<Args>::type>::jniType...);
};

template <typename T>
using jni_sig_from_cxx = typename jni_sig_from_cxx_t<T>::JniSig;

} // namespace detail

template <typename R, typename... Args>
struct jmethod_traits_from_cxx<R(Args...)> : jmethod_traits<detail::jni_sig_from_cxx<R(Args...)>> {
};

}}
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once

#include "CoreClasses.h"
#include "Hybrid.h"
#include "Registration.h"

#include <functional>

namespace facebook {
namespace jni {

struct JRunnable : public JavaClass<JRunnable> {
  static auto constexpr kJavaDescriptor = "Ljava/lang/Runnable;";
};

struct JNativeRunnable : public HybridClass<JNativeRunnable, JRunnable> {
 public:
  static auto constexpr kJavaDescriptor = "Lcom/facebook/jni/NativeRunnable;";

  JNativeRunnable(std::function<void()>&& runnable) : runnable_(std::move(runnable)) {}

  static void OnLoad() {
    registerHybrid({
        makeNativeMethod("run", JNativeRunnable::run),
      });
  }

  void run() {
    runnable_();
  }

 private:
  std::function<void()> runnable_;
};


} // namespace jni
} // namespace facebook
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once

#include <cassert>
#include <new>
#include <atomic>

namespace facebook {
namespace jni {

/// @cond INTERNAL
namespace internal {

// Statistics mostly provided for test (only updated if FBJNI_DEBUG_REFS is defined)
struct ReferenceStats {
  std::atomic_uint locals_deleted, globals_deleted, weaks_deleted;

  void reset() noexcept;
};

extern ReferenceStats g_reference_stats;
}
/// @endcond


// LocalReferenceAllocator /////////////////////////////////////////////////////////////////////////

inline jobject LocalReferenceAllocator::newReference(jobject original) const {
  internal::dbglog("Local new: %p", original);
  auto ref = internal::getEnv()->NewLocalRef(original);
  FACEBOOK_JNI_THROW_PENDING_EXCEPTION();
  return ref;
}

inline void LocalReferenceAllocator::deleteReference(jobject reference) const noexcept {
  internal::dbglog("Local release: %p", reference);

  if (reference) {
    #ifdef FBJNI_DEBUG_REFS
      ++internal::g_reference_stats.locals_deleted;
    #endif
    assert(verifyReference(reference));
    internal::getEnv()->DeleteLocalRef(reference);
  }
}

inline bool LocalReferenceAllocator::verifyReference(jobject reference) const noexcept {
  if (!reference || !internal::doesGetObjectRefTypeWork()) {
    return true;
  }
  return internal::getEnv()->GetObjectRefType(reference) == JNILocalRefType;
}


// GlobalReferenceAllocator ////////////////////////////////////////////////////////////////////////

inline jobject GlobalReferenceAllocator::newReference(jobject original) const {
  internal::dbglog("Global new: %p", original);
  auto ref = internal::getEnv()->NewGlobalRef(original);
  FACEBOOK_JNI_THROW_PENDING_EXCEPTION();
  return ref;
}

inline void GlobalReferenceAllocator::deleteReference(jobject reference) const noexcept {
  internal::dbglog("Global release: %p", reference);

  if (reference) {
    #ifdef FBJNI_DEBUG_REFS
      ++internal::g_reference_stats.globals_deleted;
    #endif
    assert(verifyReference(reference));
    internal::getEnv()->DeleteGlobalRef(reference);
  }
}

inline bool GlobalReferenceAllocator::verifyReference(jobject reference) const noexcept {
  if (!reference || !internal::doesGetObjectRefTypeWork()) {
    return true;
  }
  return internal::getEnv()->GetObjectRefType(reference) == JNIGlobalRefType;
}


// WeakGlobalReferenceAllocator ////////////////////////////////////////////////////////////////////

inline jobject WeakGlobalReferenceAllocator::newReference(jobject original) const {
  internal::dbglog("Weak global new: %p", original);
  auto ref = internal::getEnv()->NewWeakGlobalRef(original);
  FACEBOOK_JNI_THROW_PENDING_EXCEPTION();
  return ref;
}

inline void WeakGlobalReferenceAllocator::deleteReference(jobject reference) const noexcept {
  internal::dbglog("Weak Global release: %p", reference);

  if (reference) {
    #ifdef FBJNI_DEBUG_REFS
      ++internal::g_reference_stats.weaks_deleted;
    #endif
    assert(verifyReference(reference));
    internal::getEnv()->DeleteWeakGlobalRef(reference);
  }
}

inline bool WeakGlobalReferenceAllocator::verifyReference(jobject reference) const noexcept {
  if (!reference || !internal::doesGetObjectRefTypeWork()) {
    return true;
  }
  return internal::getEnv()->GetObjectRefType(reference) == JNIWeakGlobalRefType;
}

}}
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
/**
 * @file ReferenceAllocators.h
 *
 * Reference allocators are used to create and delete various classes of JNI references (local,
 * global, and weak global).
 */

#pragma once

#include <fb/visibility.h>

#include "Common.h"

namespace facebook { namespace jni {

/// Allocator that handles local references
class FBEXPORT LocalReferenceAllocator {
 public:
  jobject newReference(jobject original) const;
  void deleteReference(jobject reference) const noexcept;
  bool verifyReference(jobject reference) const noexcept;
};

/// Allocator that handles global references
class FBEXPORT GlobalReferenceAllocator {
 public:
  jobject newReference(jobject original) const;
  void deleteReference(jobject reference) const noexcept;
  bool verifyReference(jobject reference) const noexcept;
};

/// Allocator that handles weak global references
class FBEXPORT WeakGlobalReferenceAllocator {
 public:
  jobject newReference(jobject original) const;
  void deleteReference(jobject reference) const noexcept;
  bool verifyReference(jobject reference) const noexcept;
};

/// @cond INTERNAL
namespace internal {

/**
 * @return true iff env->GetObjectRefType is expected to work properly.
 */
FBEXPORT bool doesGetObjectRefTypeWork();

}
/// @endcond

}}

#include "ReferenceAllocators-inl.h"
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once

#include "ReferenceAllocators.h"

namespace facebook {
namespace jni {

template<typename T, typename Enable = void>
class JObjectWrapper;

namespace detail {
struct JObjectBase {
  jobject get() const noexcept;
  void set(jobject reference) noexcept;
  jobject this_;
};

// RefReprType maps a type to the representation used by fbjni smart references.
template <typename T, typename Enable = void>
struct RefReprType;

template <typename T>
struct JavaObjectType;

template <typename T>
struct ReprAccess;
}

// Given T, either a jobject-like type or a JavaClass-derived type, ReprType<T>
// is the corresponding JavaClass-derived type and JniType<T> is the
// jobject-like type.
template <typename T>
using ReprType = typename detail::RefReprType<T>::type;

template <typename T>
using JniType = typename detail::JavaObjectType<T>::type;

template<typename T, typename Alloc>
class base_owned_ref;

template<typename T, typename Alloc>
class basic_strong_ref;

template<typename T>
class weak_ref;

template<typename T>
class alias_ref;

/// A smart unique reference owning a local JNI reference
template<typename T>
using local_ref = basic_strong_ref<T, LocalReferenceAllocator>;

/// A smart unique reference owning a global JNI reference
template<typename T>
using global_ref = basic_strong_ref<T, GlobalReferenceAllocator>;

}} // namespace facebook::jni
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once

#include <new>
#include "CoreClasses.h"

namespace facebook {
namespace jni {

template<typename T>
inline enable_if_t<IsPlainJniReference<T>(), T> getPlainJniReference(T ref) {
  return ref;
}

template<typename T>
inline JniType<T> getPlainJniReference(alias_ref<T> ref) {
  return ref.get();
}

template<typename T, typename A>
inline JniType<T> getPlainJniReference(const base_owned_ref<T, A>& ref) {
  return ref.get();
}


namespace detail {
template <typename Repr>
struct ReprAccess {
  using javaobject = JniType<Repr>;
  static void set(Repr& repr, javaobject obj) noexcept {
    repr.JObjectBase::set(obj);
  }
  static javaobject get(const Repr& repr) {
    return static_cast<javaobject>(repr.JObject::get());
  }
};

namespace {
template <typename Repr>
void StaticAssertValidRepr() noexcept {
  static_assert(std::is_base_of<JObject, Repr>::value,
      "A smart ref representation must be derived from JObject.");
  static_assert(IsPlainJniReference<JniType<Repr>>(), "T must be a JNI reference");
  static_assert(sizeof(Repr) == sizeof(JObjectBase), "");
  static_assert(alignof(Repr) == alignof(JObjectBase), "");
}
}

template <typename Repr>
ReprStorage<Repr>::ReprStorage(JniType<Repr> obj) noexcept {
  StaticAssertValidRepr<Repr>();
  set(obj);
}

template <typename Repr>
void ReprStorage<Repr>::set(JniType<Repr> obj) noexcept {
  new (&storage_) Repr;
  ReprAccess<Repr>::set(get(), obj);
}

template <typename Repr>
Repr& ReprStorage<Repr>::get() noexcept {
  return *reinterpret_cast<Repr*>(&storage_);
}

template <typename Repr>
const Repr& ReprStorage<Repr>::get() const noexcept {
  return *reinterpret_cast<const Repr*>(&storage_);
}

template <typename Repr>
JniType<Repr> ReprStorage<Repr>::jobj() const noexcept {
  ReprAccess<Repr>::get(get());
  return ReprAccess<Repr>::get(get());
}

template <typename Repr>
void ReprStorage<Repr>::swap(ReprStorage& other) noexcept {
  StaticAssertValidRepr<Repr>();
  using std::swap;
  swap(get(), other.get());
}

inline void JObjectBase::set(jobject reference) noexcept {
  this_ = reference;
}

inline jobject JObjectBase::get() const noexcept {
  return this_;
}

template<typename T, typename Alloc>
enable_if_t<IsNonWeakReference<T>(), plain_jni_reference_t<T>> make_ref(const T& reference) {
  auto old_reference = getPlainJniReference(reference);
  if (!old_reference) {
    return nullptr;
  }

  auto ref = Alloc{}.newReference(old_reference);
  if (!ref) {
    // Note that we end up here if we pass a weak ref that refers to a collected object.
    // Thus, it's hard to come up with a reason why this function should be used with
    // weak references.
    throw std::bad_alloc{};
  }

  return static_cast<plain_jni_reference_t<T>>(ref);
}

} // namespace detail

template<typename T>
inline local_ref<T> adopt_local(T ref) noexcept {
  static_assert(IsPlainJniReference<T>(), "T must be a plain jni reference");
  return local_ref<T>{ref};
}

template<typename T>
inline global_ref<T> adopt_global(T ref) noexcept {
  static_assert(IsPlainJniReference<T>(), "T must be a plain jni reference");
  return global_ref<T>{ref};
}

template<typename T>
inline weak_ref<T> adopt_weak_global(T ref) noexcept {
  static_assert(IsPlainJniReference<T>(), "T must be a plain jni reference");
  return weak_ref<T>{ref};
}


template<typename T>
inline enable_if_t<IsPlainJniReference<T>(), alias_ref<T>> wrap_alias(T ref) noexcept {
  return alias_ref<T>(ref);
}


template<typename T>
enable_if_t<IsPlainJniReference<T>(), alias_ref<T>> wrap_alias(T ref) noexcept;


template<typename T>
enable_if_t<IsNonWeakReference<T>(), local_ref<plain_jni_reference_t<T>>>
make_local(const T& ref) {
  return adopt_local(detail::make_ref<T, LocalReferenceAllocator>(ref));
}

template<typename T>
enable_if_t<IsNonWeakReference<T>(), global_ref<plain_jni_reference_t<T>>>
make_global(const T& ref) {
  return adopt_global(detail::make_ref<T, GlobalReferenceAllocator>(ref));
}

template<typename T>
enable_if_t<IsNonWeakReference<T>(), weak_ref<plain_jni_reference_t<T>>>
make_weak(const T& ref) {
  return adopt_weak_global(detail::make_ref<T, WeakGlobalReferenceAllocator>(ref));
}

template<typename T1, typename T2>
inline enable_if_t<IsNonWeakReference<T1>() && IsNonWeakReference<T2>(), bool>
operator==(const T1& a, const T2& b) {
  return isSameObject(getPlainJniReference(a), getPlainJniReference(b));
}

template<typename T1, typename T2>
inline enable_if_t<IsNonWeakReference<T1>() && IsNonWeakReference<T2>(), bool>
operator!=(const T1& a, const T2& b) {
  return !(a == b);
}


// base_owned_ref ///////////////////////////////////////////////////////////////////////

template<typename T, typename Alloc>
inline base_owned_ref<T, Alloc>::base_owned_ref() noexcept
  : base_owned_ref(nullptr)
{}

template<typename T, typename Alloc>
inline base_owned_ref<T, Alloc>::base_owned_ref(std::nullptr_t t) noexcept
  : base_owned_ref(static_cast<javaobject>(nullptr))
{}

template<typename T, typename Alloc>
inline base_owned_ref<T, Alloc>::base_owned_ref(const base_owned_ref& other)
  : storage_{static_cast<javaobject>(Alloc{}.newReference(other.get()))}
{}

template<typename T, typename Alloc>
template<typename U>
inline base_owned_ref<T, Alloc>::base_owned_ref(const base_owned_ref<U, Alloc>& other)
  : storage_{static_cast<javaobject>(Alloc{}.newReference(other.get()))}
{
  static_assert(std::is_convertible<JniType<U>, javaobject>::value, "");
}

template<typename T, typename Alloc>
inline facebook::jni::base_owned_ref<T, Alloc>::base_owned_ref(
    javaobject reference) noexcept
  : storage_(reference) {
  assert(Alloc{}.verifyReference(reference));
  internal::dbglog("New wrapped ref=%p this=%p", get(), this);
}

template<typename T, typename Alloc>
inline base_owned_ref<T, Alloc>::base_owned_ref(
    base_owned_ref<T, Alloc>&& other) noexcept
  : storage_(other.get()) {
  internal::dbglog("New move from ref=%p other=%p", other.get(), &other);
  internal::dbglog("New move to ref=%p this=%p", get(), this);
  // JObject is a simple type and does not support move semantics so we explicitly
  // clear other
  other.set(nullptr);
}

template<typename T, typename Alloc>
template<typename U>
base_owned_ref<T, Alloc>::base_owned_ref(base_owned_ref<U, Alloc>&& other) noexcept
  : storage_(other.get()) {
  internal::dbglog("New move from ref=%p other=%p", other.get(), &other);
  internal::dbglog("New move to ref=%p this=%p", get(), this);
  // JObject is a simple type and does not support move semantics so we explicitly
  // clear other
  other.set(nullptr);
}

template<typename T, typename Alloc>
inline base_owned_ref<T, Alloc>::~base_owned_ref() noexcept {
  reset();
  internal::dbglog("Ref destruct ref=%p this=%p", get(), this);
}

template<typename T, typename Alloc>
inline auto base_owned_ref<T, Alloc>::release() noexcept -> javaobject {
  auto value = get();
  internal::dbglog("Ref release ref=%p this=%p", value, this);
  set(nullptr);
  return value;
}

template<typename T, typename Alloc>
inline void base_owned_ref<T,Alloc>::reset() noexcept {
  reset(nullptr);
}

template<typename T, typename Alloc>
inline void base_owned_ref<T,Alloc>::reset(javaobject reference) noexcept {
  if (get()) {
    assert(Alloc{}.verifyReference(reference));
    Alloc{}.deleteReference(get());
  }
  set(reference);
}

template<typename T, typename Alloc>
inline auto base_owned_ref<T, Alloc>::get() const noexcept -> javaobject {
  return storage_.jobj();
}

template<typename T, typename Alloc>
inline void base_owned_ref<T, Alloc>::set(javaobject ref) noexcept {
  storage_.set(ref);
}


// weak_ref ///////////////////////////////////////////////////////////////////////

template<typename T>
inline weak_ref<T>& weak_ref<T>::operator=(
    const weak_ref& other) {
  auto otherCopy = other;
  swap(*this, otherCopy);
  return *this;
}

template<typename T>
inline weak_ref<T>& weak_ref<T>::operator=(
    weak_ref<T>&& other) noexcept {
  internal::dbglog("Op= move ref=%p this=%p oref=%p other=%p",
      get(), this, other.get(), &other);
  reset(other.release());
  return *this;
}

template<typename T>
local_ref<T> weak_ref<T>::lockLocal() const {
  return adopt_local(
      static_cast<javaobject>(LocalReferenceAllocator{}.newReference(get())));
}

template<typename T>
global_ref<T> weak_ref<T>::lockGlobal() const {
  return adopt_global(
      static_cast<javaobject>(GlobalReferenceAllocator{}.newReference(get())));
}

template<typename T>
inline void swap(
    weak_ref<T>& a,
    weak_ref<T>& b) noexcept {
  internal::dbglog("Ref swap a.ref=%p a=%p b.ref=%p b=%p",
      a.get(), &a, b.get(), &b);
  a.storage_.swap(b.storage_);
}


// basic_strong_ref ////////////////////////////////////////////////////////////////////////////

template<typename T, typename Alloc>
inline basic_strong_ref<T, Alloc>& basic_strong_ref<T, Alloc>::operator=(
    const basic_strong_ref& other) {
  auto otherCopy = other;
  swap(*this, otherCopy);
  return *this;
}

template<typename T, typename Alloc>
inline basic_strong_ref<T, Alloc>& basic_strong_ref<T, Alloc>::operator=(
    basic_strong_ref<T, Alloc>&& other) noexcept {
  internal::dbglog("Op= move ref=%p this=%p oref=%p other=%p",
      get(), this, other.get(), &other);
  reset(other.release());
  return *this;
}

template<typename T, typename Alloc>
inline alias_ref<T> basic_strong_ref<T, Alloc>::releaseAlias() noexcept {
  return wrap_alias(release());
}

template<typename T, typename Alloc>
inline basic_strong_ref<T, Alloc>::operator bool() const noexcept {
  return get() != nullptr;
}

template<typename T, typename Alloc>
inline auto basic_strong_ref<T, Alloc>::operator->() noexcept -> Repr* {
  return &storage_.get();
}

template<typename T, typename Alloc>
inline auto basic_strong_ref<T, Alloc>::operator->() const noexcept -> const Repr* {
  return &storage_.get();
}

template<typename T, typename Alloc>
inline auto basic_strong_ref<T, Alloc>::operator*() noexcept -> Repr& {
  return storage_.get();
}

template<typename T, typename Alloc>
inline auto basic_strong_ref<T, Alloc>::operator*() const noexcept -> const Repr& {
  return storage_.get();
}

template<typename T, typename Alloc>
inline void swap(
    basic_strong_ref<T, Alloc>& a,
    basic_strong_ref<T, Alloc>& b) noexcept {
  internal::dbglog("Ref swap a.ref=%p a=%p b.ref=%p b=%p",
      a.get(), &a, b.get(), &b);
  using std::swap;
  a.storage_.swap(b.storage_);
}


// alias_ref //////////////////////////////////////////////////////////////////////////////

template<typename T>
inline alias_ref<T>::alias_ref() noexcept
  : storage_{nullptr}
{}

template<typename T>
inline alias_ref<T>::alias_ref(std::nullptr_t) noexcept
  : storage_{nullptr}
{}

template<typename T>
inline alias_ref<T>::alias_ref(const alias_ref& other) noexcept
  : storage_{other.get()}
{}

template<typename T>
inline alias_ref<T>::alias_ref(javaobject ref) noexcept
  : storage_(ref) {
  assert(
      LocalReferenceAllocator{}.verifyReference(ref) ||
      GlobalReferenceAllocator{}.verifyReference(ref));
}

template<typename T>
template<typename TOther, typename /* for SFINAE */>
inline alias_ref<T>::alias_ref(alias_ref<TOther> other) noexcept
  : storage_{other.get()}
{}

template<typename T>
template<typename TOther, typename AOther, typename /* for SFINAE */>
inline alias_ref<T>::alias_ref(const basic_strong_ref<TOther, AOther>& other) noexcept
  : storage_{other.get()}
{}

template<typename T>
inline alias_ref<T>& alias_ref<T>::operator=(alias_ref other) noexcept {
  swap(*this, other);
  return *this;
}

template<typename T>
inline alias_ref<T>::operator bool() const noexcept {
  return get() != nullptr;
}

template<typename T>
inline auto facebook::jni::alias_ref<T>::get() const noexcept -> javaobject {
  return storage_.jobj();
}

template<typename T>
inline auto alias_ref<T>::operator->() noexcept -> Repr* {
  return &(**this);
}

template<typename T>
inline auto alias_ref<T>::operator->() const noexcept -> const Repr* {
  return &(**this);
}

template<typename T>
inline auto alias_ref<T>::operator*() noexcept -> Repr& {
  return storage_.get();
}

template<typename T>
inline auto alias_ref<T>::operator*() const noexcept -> const Repr& {
  return storage_.get();
}

template<typename T>
inline void alias_ref<T>::set(javaobject ref) noexcept {
  storage_.set(ref);
}

template<typename T>
inline void swap(alias_ref<T>& a, alias_ref<T>& b) noexcept {
  a.storage_.swap(b.storage_);
}

// Could reduce code duplication by using a pointer-to-function
// template argument.  I'm not sure whether that would make the code
// more maintainable (DRY), or less (too clever/confusing.).
template<typename T, typename U>
enable_if_t<IsPlainJniReference<T>(), local_ref<T>>
static_ref_cast(const local_ref<U>& ref) noexcept
{
  T p = static_cast<T>(ref.get());
  return make_local(p);
}

template<typename T, typename U>
enable_if_t<IsPlainJniReference<T>(), global_ref<T>>
static_ref_cast(const global_ref<U>& ref) noexcept
{
  T p = static_cast<T>(ref.get());
  return make_global(p);
}

template<typename T, typename U>
enable_if_t<IsPlainJniReference<T>(), alias_ref<T>>
static_ref_cast(const alias_ref<U>& ref) noexcept
{
  T p = static_cast<T>(ref.get());
  return wrap_alias(p);
}

template<typename T, typename RefType>
auto dynamic_ref_cast(const RefType& ref) ->
enable_if_t<IsPlainJniReference<T>(), decltype(static_ref_cast<T>(ref))>
{
  if (! ref) {
    return decltype(static_ref_cast<T>(ref))();
  }

  std::string target_class_name{jtype_traits<T>::base_name()};

  // If not found, will throw an exception.
  alias_ref<jclass> target_class = findClassStatic(target_class_name.c_str());

  local_ref<jclass> source_class = ref->getClass();

  if ( ! source_class->isAssignableFrom(target_class)) {
    throwNewJavaException("java/lang/ClassCastException",
                          "Tried to cast from %s to %s.",
                          source_class->toString().c_str(),
                          target_class_name.c_str());
  }

  return static_ref_cast<T>(ref);
}

}}
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
/** @file References.h
 *
 * Functionality similar to smart pointers, but for references into the VM. Four main reference
 * types are provided: local_ref, global_ref, weak_ref, and alias_ref. All are generic
 * templates that and refer to objects in the jobject hierarchy. The type of the referred objects
 * are specified using the template parameter. All reference types except alias_ref own their
 * underlying reference, just as a std smart pointer owns the underlying raw pointer. In the context
 * of std smart pointers, these references behave like unique_ptr, and have basically the same
 * interface. Thus, when the reference is destructed, the plain JNI reference, i.e. the underlying
 * JNI reference (like the parameters passed directly to JNI functions), is released. The alias
 * references provides no ownership and is a simple wrapper for plain JNI references.
 *
 * All but the weak references provides access to the underlying object using dereferencing, and a
 * get() method. It is also possible to convert these references to booleans to test for nullity.
 * To access the underlying object of a weak reference, the reference must either be released, or
 * the weak reference can be used to create a local or global reference.
 *
 * An owning reference is created either by moving the reference from an existing owned reference,
 * by copying an existing owned reference (which creates a new underlying reference), by using the
 * default constructor which initialize the reference to nullptr, or by using a helper function. The
 * helper function exist in two flavors: make_XXX or adopt_XXX.
 *
 * Adopting takes a plain JNI reference and wrap it in an owned reference. It takes ownership of the
 * plain JNI reference so be sure that no one else owns the reference when you adopt it, and make
 * sure that you know what kind of reference it is.
 *
 * New owned references can be created from existing plain JNI references, alias references, local
 * references, and global references (i.e. non-weak references) using the make_local, make_global,
 * and make_weak functions.
 *
 * Alias references can be implicitly initialized using global, local and plain JNI references using
 * the wrap_alias function. Here, we don't assume ownership of the passed-in reference, but rather
 * create a separate reference that we do own, leaving the passed-in reference to its fate.
 *
 * Similar rules apply for assignment. An owned reference can be copy or move assigned using a smart
 * reference of the same type. In the case of copy assignment a new reference is created. Alias
 * reference can also be assigned new values, but since they are simple wrappers of plain JNI
 * references there is no move semantics involved.
 *
 * Alias references are special in that they do not own the object and can therefore safely be
 * converted to and from its corresponding plain JNI reference. They are useful as parameters of
 * functions that do not affect the lifetime of a reference. Usage can be compared with using plain
 * JNI pointers as parameters where a function does not take ownership of the underlying object.
 *
 * The local, global, and alias references makes it possible to access methods in the underlying
 * objects. A core set of classes are implemented in CoreClasses.h, and user defined wrappers are
 * supported (see example below). The wrappers also supports inheritance so a wrapper can inherit
 * from another wrapper to gain access to its functionality. As an example the jstring wrapper
 * inherits from the jobject wrapper, so does the jclass wrapper. That means that you can for
 * example call the toString() method using the jclass wrapper, or any other class that inherits
 * from the jobject wrapper.
 *
 * Note that the wrappers are parameterized on the static type of your (jobject) pointer, thus if
 * you have a jobject that refers to a Java String you will need to cast it to jstring to get the
 * jstring wrapper. This also mean that if you make a down cast that is invalid there will be no one
 * stopping you and the wrappers currently does not detect this which can cause crashes. Thus, cast
 * wisely.
 *
 * @include WrapperSample.cpp
 */

#pragma once

#include <cassert>
#include <cstddef>
#include <type_traits>

#include <jni.h>

#include <fb/visibility.h>

#include "ReferenceAllocators.h"
#include "TypeTraits.h"
#include "References-forward.h"

namespace facebook {
namespace jni {

/// Convenience function to wrap an existing local reference
template<typename T>
local_ref<T> adopt_local(T ref) noexcept;

/// Convenience function to wrap an existing global reference
template<typename T>
global_ref<T> adopt_global(T ref) noexcept;

/// Convenience function to wrap an existing weak reference
template<typename T>
weak_ref<T> adopt_weak_global(T ref) noexcept;


/// Swaps two owning references of the same type
template<typename T>
void swap(weak_ref<T>& a, weak_ref<T>& b) noexcept;

/// Swaps two owning references of the same type
template<typename T, typename Alloc>
void swap(basic_strong_ref<T, Alloc>& a, basic_strong_ref<T, Alloc>& b) noexcept;

/**
 * Retrieve the plain reference from a plain reference.
 */
template<typename T>
enable_if_t<IsPlainJniReference<T>(), T> getPlainJniReference(T ref);

/**
 * Retrieve the plain reference from an alias reference.
 */
template<typename T>
JniType<T> getPlainJniReference(alias_ref<T> ref);

/**
 * Retrieve the plain JNI reference from any reference owned reference.
 */
template<typename T, typename Alloc>
JniType<T> getPlainJniReference(const base_owned_ref<T, Alloc>& ref);

class JObject;
class JClass;

namespace detail {

template <typename T, typename Enable = void>
struct HasJniRefRepr : std::false_type {};

template <typename T>
struct HasJniRefRepr<T, typename std::enable_if<!std::is_same<typename T::JniRefRepr, void>::value, void>::type> : std::true_type {
  using type = typename T::JniRefRepr;
};

template <typename T>
struct RefReprType<T*> {
  using type = typename std::conditional<HasJniRefRepr<T>::value, typename HasJniRefRepr<T>::type, JObjectWrapper<T*>>::type;
  static_assert(std::is_base_of<JObject, type>::value,
      "Repr type missing JObject base.");
  static_assert(std::is_same<type, typename RefReprType<type>::type>::value,
      "RefReprType<T> not idempotent");
};

template <typename T>
struct RefReprType<T, typename std::enable_if<std::is_base_of<JObject, T>::value, void>::type> {
  using type = T;
  static_assert(std::is_base_of<JObject, type>::value,
      "Repr type missing JObject base.");
  static_assert(std::is_same<type, typename RefReprType<type>::type>::value,
      "RefReprType<T> not idempotent");
};

template <typename T>
struct JavaObjectType {
  using type = typename RefReprType<T>::type::javaobject;
  static_assert(IsPlainJniReference<type>(),
      "JavaObjectType<T> not a plain jni reference");
  static_assert(std::is_same<type, typename JavaObjectType<type>::type>::value,
      "JavaObjectType<T> not idempotent");
};

template <typename T>
struct JavaObjectType<JObjectWrapper<T>> {
  using type = T;
  static_assert(IsPlainJniReference<type>(),
      "JavaObjectType<T> not a plain jni reference");
  static_assert(std::is_same<type, typename JavaObjectType<type>::type>::value,
      "JavaObjectType<T> not idempotent");
};

template <typename T>
struct JavaObjectType<T*> {
  using type = T*;
  static_assert(IsPlainJniReference<type>(),
      "JavaObjectType<T> not a plain jni reference");
  static_assert(std::is_same<type, typename JavaObjectType<type>::type>::value,
      "JavaObjectType<T> not idempotent");
};

template <typename Repr>
struct ReprStorage {
  explicit ReprStorage(JniType<Repr> obj) noexcept;

  void set(JniType<Repr> obj) noexcept;

  Repr& get() noexcept;
  const Repr& get() const noexcept;
  JniType<Repr> jobj() const noexcept;

  void swap(ReprStorage& other) noexcept;
 private:
  ReprStorage() = delete;
  ReprStorage(const ReprStorage&) = delete;
  ReprStorage(ReprStorage&&) = delete;
  ReprStorage& operator=(const ReprStorage&) = delete;
  ReprStorage& operator=(ReprStorage&&) = delete;

  using Storage = typename std::aligned_storage<sizeof(JObjectBase), alignof(JObjectBase)>::type;
  Storage storage_;
};

} // namespace detail

/**
 * Create a new local reference from an existing reference
 *
 * @param ref a plain JNI, alias, or strong reference
 * @return an owned local reference (referring to null if the input does)
 * @throws std::bad_alloc if the JNI reference could not be created
 */
template<typename T>
enable_if_t<IsNonWeakReference<T>(), local_ref<plain_jni_reference_t<T>>>
make_local(const T& r);

/**
 * Create a new global reference from an existing reference
 *
 * @param ref a plain JNI, alias, or strong reference
 * @return an owned global reference (referring to null if the input does)
 * @throws std::bad_alloc if the JNI reference could not be created
 */
template<typename T>
enable_if_t<IsNonWeakReference<T>(), global_ref<plain_jni_reference_t<T>>>
make_global(const T& r);

/**
 * Create a new weak global reference from an existing reference
 *
 * @param ref a plain JNI, alias, or strong reference
 * @return an owned weak global reference (referring to null if the input does)
 * @throws std::bad_alloc if the returned reference is null
 */
template<typename T>
enable_if_t<IsNonWeakReference<T>(), weak_ref<plain_jni_reference_t<T>>>
make_weak(const T& r);

/**
 * Compare two references to see if they refer to the same object
 */
template<typename T1, typename T2>
enable_if_t<IsNonWeakReference<T1>() && IsNonWeakReference<T2>(), bool>
operator==(const T1& a, const T2& b);

/**
 * Compare two references to see if they don't refer to the same object
 */
template<typename T1, typename T2>
enable_if_t<IsNonWeakReference<T1>() && IsNonWeakReference<T2>(), bool>
operator!=(const T1& a, const T2& b);

template<typename T, typename Alloc>
class base_owned_ref {
 public:
  using javaobject = JniType<T>;

  /**
   * Release the ownership and set the reference to null. Thus no deleter is invoked.
   * @return Returns the reference
   */
  javaobject release() noexcept;

  /**
   * Reset the reference to refer to nullptr.
   */
  void reset() noexcept;

 protected:
  using Repr = ReprType<T>;
  detail::ReprStorage<Repr> storage_;

  javaobject get() const noexcept;
  void set(javaobject ref) noexcept;

  /*
   * Wrap an existing reference and transfers its ownership to the newly created unique reference.
   * NB! Does not create a new reference
   */
  explicit base_owned_ref(javaobject reference) noexcept;

  /// Create a null reference
  base_owned_ref() noexcept;

  /// Create a null reference
  explicit base_owned_ref(std::nullptr_t) noexcept;

  /// Copy constructor (note creates a new reference)
  base_owned_ref(const base_owned_ref& other);
  template<typename U>
  base_owned_ref(const base_owned_ref<U, Alloc>& other);

  /// Transfers ownership of an underlying reference from one unique reference to another
  base_owned_ref(base_owned_ref&& other) noexcept;
  template<typename U>
  base_owned_ref(base_owned_ref<U, Alloc>&& other) noexcept;

  /// The delete the underlying reference if applicable
  ~base_owned_ref() noexcept;


  /// Assignment operator (note creates a new reference)
  base_owned_ref& operator=(const base_owned_ref& other);

  /// Assignment by moving a reference thus not creating a new reference
  base_owned_ref& operator=(base_owned_ref&& rhs) noexcept;

  void reset(javaobject reference) noexcept;

  friend javaobject jni::getPlainJniReference<>(const base_owned_ref& ref);

  template<typename U, typename UAlloc>
  friend class base_owned_ref;
};


/**
 * A smart reference that owns its underlying JNI reference. The class provides basic
 * functionality to handle a reference but gives no access to it unless the reference is
 * released, thus no longer owned. The API is stolen with pride from unique_ptr and the
 * semantics should be basically the same. This class should not be used directly, instead use
 * @ref weak_ref
 */
template<typename T>
class weak_ref : public base_owned_ref<T, WeakGlobalReferenceAllocator> {
 public:
  using javaobject = JniType<T>;

  using Allocator = WeakGlobalReferenceAllocator;

  // This inherits non-default, non-copy, non-move ctors.
  using base_owned_ref<T, Allocator>::base_owned_ref;

  /// Create a null reference
  weak_ref() noexcept
    : base_owned_ref<T, Allocator>{} {}

  /// Create a null reference
  explicit weak_ref(std::nullptr_t) noexcept
    : base_owned_ref<T, Allocator>{nullptr} {}

  /// Copy constructor (note creates a new reference)
  weak_ref(const weak_ref& other)
    : base_owned_ref<T, Allocator>{other} {}

  // This needs to be explicit to change its visibility.
  template<typename U>
  weak_ref(const weak_ref<U>& other)
    : base_owned_ref<T, Allocator>{other} {}

  /// Transfers ownership of an underlying reference from one unique reference to another
  weak_ref(weak_ref&& other) noexcept
    : base_owned_ref<T, Allocator>{std::move(other)} {}


  /// Assignment operator (note creates a new reference)
  weak_ref& operator=(const weak_ref& other);

  /// Assignment by moving a reference thus not creating a new reference
  weak_ref& operator=(weak_ref&& rhs) noexcept;

  // Creates an owned local reference to the referred object or to null if the object is reclaimed
  local_ref<T> lockLocal() const;

  // Creates an owned global reference to the referred object or to null if the object is reclaimed
  global_ref<T> lockGlobal() const;

 private:
  // get/release/reset on weak_ref are not exposed to users.
  using base_owned_ref<T, Allocator>::get;
  using base_owned_ref<T, Allocator>::release;
  using base_owned_ref<T, Allocator>::reset;
  /*
   * Wrap an existing reference and transfers its ownership to the newly created unique reference.
   * NB! Does not create a new reference
   */
  explicit weak_ref(javaobject reference) noexcept
    : base_owned_ref<T, Allocator>{reference} {}

  template<typename T2> friend class weak_ref;
  friend weak_ref<javaobject> adopt_weak_global<javaobject>(javaobject ref) noexcept;
  friend void swap<T>(weak_ref& a, weak_ref& b) noexcept;
};


/**
 * A class representing owned strong references to Java objects. This class
 * should not be used directly, instead use @ref local_ref, or @ref global_ref.
 */
template<typename T, typename Alloc>
class basic_strong_ref : public base_owned_ref<T, Alloc> {
  using typename base_owned_ref<T, Alloc>::Repr;
 public:
  using javaobject = JniType<T>;

  using Allocator = Alloc;

  // This inherits non-default, non-copy, non-move ctors.
  using base_owned_ref<T, Alloc>::base_owned_ref;
  using base_owned_ref<T, Alloc>::release;
  using base_owned_ref<T, Alloc>::reset;

  /// Create a null reference
  basic_strong_ref() noexcept
    : base_owned_ref<T, Alloc>{} {}

  /// Create a null reference
  explicit basic_strong_ref(std::nullptr_t) noexcept
    : base_owned_ref<T, Alloc>{nullptr} {}

  /// Copy constructor (note creates a new reference)
  basic_strong_ref(const basic_strong_ref& other)
    : base_owned_ref<T, Alloc>{other} {}

  // This needs to be explicit to change its visibility.
  template<typename U>
  basic_strong_ref(const basic_strong_ref<U, Alloc>& other)
    : base_owned_ref<T, Alloc>{other} {}

  /// Transfers ownership of an underlying reference from one unique reference to another
  basic_strong_ref(basic_strong_ref&& other) noexcept
    : base_owned_ref<T, Alloc>{std::move(other)} {}

  /// Assignment operator (note creates a new reference)
  basic_strong_ref& operator=(const basic_strong_ref& other);

  /// Assignment by moving a reference thus not creating a new reference
  basic_strong_ref& operator=(basic_strong_ref&& rhs) noexcept;

  /// Get the plain JNI reference
  using base_owned_ref<T, Allocator>::get;

  /// Release the ownership of the reference and return the wrapped reference in an alias
  alias_ref<T> releaseAlias() noexcept;

  /// Checks if the reference points to a non-null object
  explicit operator bool() const noexcept;

  /// Access the functionality provided by the object wrappers
  Repr* operator->() noexcept;

  /// Access the functionality provided by the object wrappers
  const Repr* operator->() const noexcept;

  /// Provide a reference to the underlying wrapper (be sure that it is non-null before invoking)
  Repr& operator*() noexcept;

  /// Provide a const reference to the underlying wrapper (be sure that it is non-null
  /// before invoking)
  const Repr& operator*() const noexcept;

 private:

  using base_owned_ref<T, Alloc>::storage_;

  /*
   * Wrap an existing reference and transfers its ownership to the newly created unique reference.
   * NB! Does not create a new reference
   */
  explicit basic_strong_ref(javaobject reference) noexcept
    : base_owned_ref<T, Alloc>{reference} {}


  friend local_ref<T> adopt_local<T>(T ref) noexcept;
  friend global_ref<T> adopt_global<T>(T ref) noexcept;
  friend void swap<T, Alloc>(basic_strong_ref& a, basic_strong_ref& b) noexcept;
};


template<typename T>
enable_if_t<IsPlainJniReference<T>(), alias_ref<T>> wrap_alias(T ref) noexcept;

/// Swaps to alias reference of the same type
template<typename T>
void swap(alias_ref<T>& a, alias_ref<T>& b) noexcept;

/**
 * A non-owning variant of the smart references (a dumb reference). These references still provide
 * access to the functionality of the @ref JObjectWrapper specializations including exception
 * handling and ease of use. Use this representation when you don't want to claim ownership of the
 * underlying reference (compare to using raw pointers instead of smart pointers.) For symmetry use
 * @ref alias_ref instead of this class.
 */
template<typename T>
class alias_ref {
  using Repr = ReprType<T>;

 public:
  using javaobject = JniType<T>;

  /// Create a null reference
  alias_ref() noexcept;

  /// Create a null reference
  alias_ref(std::nullptr_t) noexcept;

  /// Copy constructor
  alias_ref(const alias_ref& other) noexcept;

  /// Wrap an existing plain JNI reference
  /* implicit */ alias_ref(javaobject ref) noexcept;

  /// Wrap an existing smart reference of any type convertible to T
  template<
    typename TOther,
    typename = enable_if_t<
      IsConvertible<JniType<TOther>, javaobject>(), T>
    >
  alias_ref(alias_ref<TOther> other) noexcept;

  /// Wrap an existing alias reference of a type convertible to T
  template<
    typename TOther,
    typename AOther,
    typename = enable_if_t<
      IsConvertible<JniType<TOther>, javaobject>(), T>
    >
  alias_ref(const basic_strong_ref<TOther, AOther>& other) noexcept;

  /// Assignment operator
  alias_ref& operator=(alias_ref other) noexcept;

  /// Checks if the reference points to a non-null object
  explicit operator bool() const noexcept;

  /// Converts back to a plain JNI reference
  javaobject get() const noexcept;

  /// Access the functionality provided by the object wrappers
  Repr* operator->() noexcept;

  /// Access the functionality provided by the object wrappers
  const Repr* operator->() const noexcept;

  /// Provide a guaranteed non-null reference (be sure that it is non-null before invoking)
  Repr& operator*() noexcept;

  /// Provide a guaranteed non-null reference (be sure that it is non-null before invoking)
  const Repr& operator*() const noexcept;

 private:
  void set(javaobject ref) noexcept;

  detail::ReprStorage<Repr> storage_;

  friend void swap<T>(alias_ref& a, alias_ref& b) noexcept;
};


/**
 * RAII object to create a local JNI frame, using PushLocalFrame/PopLocalFrame.
 *
 * This is useful when you have a call which is initiated from C++-land, and therefore
 * doesn't automatically get a local JNI frame managed for you by the JNI framework.
 */
class FBEXPORT JniLocalScope {
public:
  JniLocalScope(JNIEnv* p_env, jint capacity);
  ~JniLocalScope();

private:
  JNIEnv* env_;
  bool hasFrame_;
};

template<typename T, typename U>
enable_if_t<IsPlainJniReference<T>(), local_ref<T>>
static_ref_cast(const local_ref<U>& ref) noexcept;

template<typename T, typename U>
enable_if_t<IsPlainJniReference<T>(), global_ref<T>>
static_ref_cast(const global_ref<U>& ref) noexcept;

template<typename T, typename U>
enable_if_t<IsPlainJniReference<T>(), alias_ref<T>>
static_ref_cast(const alias_ref<U>& ref) noexcept;

template<typename T, typename RefType>
auto dynamic_ref_cast(const RefType& ref) ->
enable_if_t<IsPlainJniReference<T>(), decltype(static_ref_cast<T>(ref))> ;

}}

#include "References-inl.h"
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once

#include "Exceptions.h"
#include "Hybrid.h"

namespace facebook {
namespace jni {

namespace detail {

#ifdef __i386__
// X86 ABI forces 16 byte stack allignment on calls. Unfortunately
// sometimes Dalvik chooses not to obey the ABI:
// - https://code.google.com/p/android/issues/detail?id=61012
// - https://android.googlesource.com/platform/ndk/+/81696d2%5E!/
// Therefore, we tell the compiler to re-align the stack on entry
// to our JNI functions.
#define JNI_ENTRY_POINT __attribute__((force_align_arg_pointer))
#else
#define JNI_ENTRY_POINT
#endif

// registration wrapper for legacy JNI-style functions

template<typename F, F func, typename C, typename... Args>
inline NativeMethodWrapper* exceptionWrapJNIMethod(void (*)(JNIEnv*, C, Args... args)) {
  struct funcWrapper {
    JNI_ENTRY_POINT static void call(JNIEnv* env, jobject obj, Args... args) {
      // Note that if func was declared noexcept, then both gcc and clang are smart
      // enough to elide the try/catch.
      try {
        (*func)(env, static_cast<C>(obj), args...);
      } catch (...) {
        translatePendingCppExceptionToJavaException();
      }
    }
  };

  // This intentionally erases the real type; JNI will do it anyway
  return reinterpret_cast<NativeMethodWrapper*>(&(funcWrapper::call));
}

template<typename F, F func, typename C, typename R, typename... Args>
inline NativeMethodWrapper* exceptionWrapJNIMethod(R (*)(JNIEnv*, C, Args... args)) {
  struct funcWrapper {
    JNI_ENTRY_POINT static R call(JNIEnv* env, jobject obj, Args... args) {
      try {
        return (*func)(env, static_cast<JniType<C>>(obj), args...);
      } catch (...) {
        translatePendingCppExceptionToJavaException();
        return R{};
      }
    }
  };

  // This intentionally erases the real type; JNI will do it anyway
  return reinterpret_cast<NativeMethodWrapper*>(&(funcWrapper::call));
}

// registration wrappers for functions, with autoconversion of arguments.

template<typename F, F func, typename C, typename... Args>
inline NativeMethodWrapper* exceptionWrapJNIMethod(void (*)(alias_ref<C>, Args... args)) {
  struct funcWrapper {
    JNI_ENTRY_POINT static void call(JNIEnv*, jobject obj,
                                     typename Convert<typename std::decay<Args>::type>::jniType... args) {
      try {
        (*func)(static_cast<JniType<C>>(obj), Convert<typename std::decay<Args>::type>::fromJni(args)...);
      } catch (...) {
        translatePendingCppExceptionToJavaException();
      }
    }
  };

  // This intentionally erases the real type; JNI will do it anyway
  return reinterpret_cast<NativeMethodWrapper*>(&(funcWrapper::call));
}

template<typename F, F func, typename C, typename R, typename... Args>
inline NativeMethodWrapper* exceptionWrapJNIMethod(R (*)(alias_ref<C>, Args... args)) {
  struct funcWrapper {

    JNI_ENTRY_POINT static typename Convert<typename std::decay<R>::type>::jniType call(JNIEnv*, jobject obj,
                                       typename Convert<typename std::decay<Args>::type>::jniType... args) {
      try {
        return Convert<typename std::decay<R>::type>::toJniRet(
          (*func)(static_cast<JniType<C>>(obj), Convert<typename std::decay<Args>::type>::fromJni(args)...));
      } catch (...) {
        using jniRet = typename Convert<typename std::decay<R>::type>::jniType;
        translatePendingCppExceptionToJavaException();
        return jniRet{};
      }
    }
  };

  // This intentionally erases the real type; JNI will do it anyway
  return reinterpret_cast<NativeMethodWrapper*>(&(funcWrapper::call));
}

// registration wrappers for non-static methods, with autoconvertion of arguments.

template<typename M, M method, typename C, typename... Args>
inline NativeMethodWrapper* exceptionWrapJNIMethod(void (C::*method0)(Args... args)) {
  struct funcWrapper {
    JNI_ENTRY_POINT static void call(JNIEnv* env, jobject obj,
                                     typename Convert<typename std::decay<Args>::type>::jniType... args) {
      try {
        try {
          auto aref = wrap_alias(static_cast<typename C::jhybridobject>(obj));
          // This is usually a noop, but if the hybrid object is a
          // base class of other classes which register JNI methods,
          // this will get the right type for the registered method.
          auto cobj = static_cast<C*>(facebook::jni::cthis(aref));
          (cobj->*method)(Convert<typename std::decay<Args>::type>::fromJni(args)...);
        } catch (const std::exception& ex) {
          C::mapException(ex);
          throw;
        }
      } catch (...) {
        translatePendingCppExceptionToJavaException();
      }
    }
  };

  // This intentionally erases the real type; JNI will do it anyway
  return reinterpret_cast<NativeMethodWrapper*>(&(funcWrapper::call));
}

template<typename M, M method, typename C, typename R, typename... Args>
inline NativeMethodWrapper* exceptionWrapJNIMethod(R (C::*method0)(Args... args)) {
  struct funcWrapper {

    JNI_ENTRY_POINT static typename Convert<typename std::decay<R>::type>::jniType call(JNIEnv* env, jobject obj,
                                       typename Convert<typename std::decay<Args>::type>::jniType... args) {
      try {
        try {
          auto aref = wrap_alias(static_cast<typename C::jhybridobject>(obj));
          // This is usually a noop, but if the hybrid object is a
          // base class of other classes which register JNI methods,
          // this will get the right type for the registered method.
          auto cobj = static_cast<C*>(facebook::jni::cthis(aref));
          return Convert<typename std::decay<R>::type>::toJniRet(
            (cobj->*method)(Convert<typename std::decay<Args>::type>::fromJni(args)...));
        } catch (const std::exception& ex) {
          C::mapException(ex);
          throw;
        }
      } catch (...) {
        using jniRet = typename Convert<typename std::decay<R>::type>::jniType;
        translatePendingCppExceptionToJavaException();
        return jniRet{};
      }
    }
  };

  // This intentionally erases the real type; JNI will do it anyway
  return reinterpret_cast<NativeMethodWrapper*>(&(funcWrapper::call));
}

template<typename R, typename C, typename... Args>
inline std::string makeDescriptor(R (*)(JNIEnv*, C, Args... args)) {
  return jmethod_traits<R(Args...)>::descriptor();
}

template<typename R, typename C, typename... Args>
inline std::string makeDescriptor(R (*)(alias_ref<C>, Args... args)) {
  return jmethod_traits_from_cxx<R(Args...)>::descriptor();
}

template<typename R, typename C, typename... Args>
inline std::string makeDescriptor(R (C::*)(Args... args)) {
  return jmethod_traits_from_cxx<R(Args...)>::descriptor();
}

}

}}
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once

#include <jni.h>
#include "References.h"

namespace facebook {
namespace jni {

namespace detail {

// This uses the real JNI function as a non-type template parameter to
// cause a (static member) function to exist with the same signature,
// but with try/catch exception translation.
template<typename F, F func, typename C, typename... Args>
NativeMethodWrapper* exceptionWrapJNIMethod(void (*func0)(JNIEnv*, jobject, Args... args));

// Same as above, but for non-void return types.
template<typename F, F func, typename C, typename R, typename... Args>
NativeMethodWrapper* exceptionWrapJNIMethod(R (*func0)(JNIEnv*, jobject, Args... args));

// Automatically wrap object argument, and don't take env explicitly.
template<typename F, F func, typename C, typename... Args>
NativeMethodWrapper* exceptionWrapJNIMethod(void (*func0)(alias_ref<C>, Args... args));

// Automatically wrap object argument, and don't take env explicitly,
// non-void return type.
template<typename F, F func, typename C, typename R, typename... Args>
NativeMethodWrapper* exceptionWrapJNIMethod(R (*func0)(alias_ref<C>, Args... args));

// Extract C++ instance from object, and invoke given method on it.
template<typename M, M method, typename C, typename... Args>
NativeMethodWrapper* exceptionWrapJNIMethod(void (C::*method0)(Args... args));

// Extract C++ instance from object, and invoke given method on it,
// non-void return type
template<typename M, M method, typename C, typename R, typename... Args>
NativeMethodWrapper* exceptionWrapJNIMethod(R (C::*method0)(Args... args));

// This uses deduction to figure out the descriptor name if the types
// are primitive or have JObjectWrapper specializations.
template<typename R, typename C, typename... Args>
std::string makeDescriptor(R (*func)(JNIEnv*, C, Args... args));

// This uses deduction to figure out the descriptor name if the types
// are primitive or have JObjectWrapper specializations.
template<typename R, typename C, typename... Args>
std::string makeDescriptor(R (*func)(alias_ref<C>, Args... args));

// This uses deduction to figure out the descriptor name if the types
// are primitive or have JObjectWrapper specializations.
template<typename R, typename C, typename... Args>
std::string makeDescriptor(R (C::*method0)(Args... args));

}

// We have to use macros here, because the func needs to be used
// as both a decltype expression argument and as a non-type template
// parameter, since C++ provides no way for translateException
// to deduce the type of its non-type template parameter.
// The empty string in the macros below ensures that name
// is always a string literal (because that syntax is only
// valid when name is a string literal).
#define makeNativeMethod2(name, func)                                   \
  { name "", ::facebook::jni::detail::makeDescriptor(&func),            \
      ::facebook::jni::detail::exceptionWrapJNIMethod<decltype(&func), &func>(&func) }

#define makeNativeMethod3(name, desc, func)                             \
  { name "", desc,                                                      \
      ::facebook::jni::detail::exceptionWrapJNIMethod<decltype(&func), &func>(&func) }

// Variadic template hacks to get macros with different numbers of
// arguments. Usage instructions are in CoreClasses.h.
#define makeNativeMethodN(a, b, c, count, ...) makeNativeMethod ## count
#define makeNativeMethod(...) makeNativeMethodN(__VA_ARGS__, 3, 2)(__VA_ARGS__)

}}

#include "Registration-inl.h"
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once

#include <type_traits>

#include "References-forward.h"

namespace facebook {
namespace jni {

/// Generic std::enable_if helper
template<bool B, typename T>
using enable_if_t = typename std::enable_if<B, T>::type;

/// Generic std::is_convertible helper
template<typename From, typename To>
constexpr bool IsConvertible() {
  return std::is_convertible<From, To>::value;
}

template<template<typename...> class TT, typename T>
struct is_instantiation_of : std::false_type {};

template<template<typename...> class TT, typename... Ts>
struct is_instantiation_of<TT, TT<Ts...>> : std::true_type {};

template<template<typename...> class TT, typename... Ts>
constexpr bool IsInstantiationOf() {
  return is_instantiation_of<TT, Ts...>::value;
}

/// Metafunction to determine whether a type is a JNI reference or not
template<typename T>
struct is_plain_jni_reference :
  std::integral_constant<bool,
      std::is_pointer<T>::value &&
      std::is_base_of<
        typename std::remove_pointer<jobject>::type,
        typename std::remove_pointer<T>::type>::value> {};

/// Helper to simplify use of is_plain_jni_reference
template<typename T>
constexpr bool IsPlainJniReference() {
  return is_plain_jni_reference<T>::value;
}

/// Metafunction to determine whether a type is a primitive JNI type or not
template<typename T>
struct is_jni_primitive :
  std::integral_constant<bool,
    std::is_same<jboolean, T>::value ||
    std::is_same<jbyte, T>::value ||
    std::is_same<jchar, T>::value ||
    std::is_same<jshort, T>::value ||
    std::is_same<jint, T>::value ||
    std::is_same<jlong, T>::value ||
    std::is_same<jfloat, T>::value ||
    std::is_same<jdouble, T>::value> {};

/// Helper to simplify use of is_jni_primitive
template<typename T>
constexpr bool IsJniPrimitive() {
  return is_jni_primitive<T>::value;
}

/// Metafunction to determine whether a type is a JNI array of primitives or not
template <typename T>
struct is_jni_primitive_array :
  std::integral_constant<bool,
    std::is_same<jbooleanArray, T>::value ||
    std::is_same<jbyteArray, T>::value ||
    std::is_same<jcharArray, T>::value ||
    std::is_same<jshortArray, T>::value ||
    std::is_same<jintArray, T>::value ||
    std::is_same<jlongArray, T>::value ||
    std::is_same<jfloatArray, T>::value ||
    std::is_same<jdoubleArray, T>::value> {};

/// Helper to simplify use of is_jni_primitive_array
template <typename T>
constexpr bool IsJniPrimitiveArray() {
  return is_jni_primitive_array<T>::value;
}

/// Metafunction to determine if a type is a scalar (primitive or reference) JNI type
template<typename T>
struct is_jni_scalar :
  std::integral_constant<bool,
    is_plain_jni_reference<T>::value ||
    is_jni_primitive<T>::value> {};

/// Helper to simplify use of is_jni_scalar
template<typename T>
constexpr bool IsJniScalar() {
  return is_jni_scalar<T>::value;
}

// Metafunction to determine if a type is a JNI type
template<typename T>
struct is_jni_type :
  std::integral_constant<bool,
    is_jni_scalar<T>::value ||
    std::is_void<T>::value> {};

/// Helper to simplify use of is_jni_type
template<typename T>
constexpr bool IsJniType() {
  return is_jni_type<T>::value;
}

template<typename T>
struct is_non_weak_reference :
  std::integral_constant<bool,
    IsPlainJniReference<T>() ||
    IsInstantiationOf<basic_strong_ref, T>() ||
    IsInstantiationOf<alias_ref, T>()> {};

template<typename T>
constexpr bool IsNonWeakReference() {
  return is_non_weak_reference<T>::value;
}

template<typename T>
struct is_any_reference :
  std::integral_constant<bool,
    IsPlainJniReference<T>() ||
    IsInstantiationOf<weak_ref, T>() ||
    IsInstantiationOf<basic_strong_ref, T>() ||
    IsInstantiationOf<alias_ref, T>()> {};

template<typename T>
constexpr bool IsAnyReference() {
  return is_any_reference<T>::value;
}

template<typename T>
struct reference_traits {
  using plain_jni_reference_t = JniType<T>;
  static_assert(IsPlainJniReference<plain_jni_reference_t>(), "Need a plain JNI reference");
};

template<template <typename...> class R, typename T, typename... A>
struct reference_traits<R<T, A...>> {
  using plain_jni_reference_t = JniType<T>;
  static_assert(IsPlainJniReference<plain_jni_reference_t>(), "Need a plain JNI reference");
};

template<typename T>
using plain_jni_reference_t = typename reference_traits<T>::plain_jni_reference_t;

} // namespace jni
} // namespace facebook
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once

#include <jni.h>

#include <fb/Countable.h>
#include <fb/RefPtr.h>
#include <fb/visibility.h>

namespace facebook {
namespace jni {

FBEXPORT const RefPtr<Countable>& countableFromJava(JNIEnv* env, jobject obj);

template <typename T> RefPtr<T> extractRefPtr(JNIEnv* env, jobject obj) {
  return static_cast<RefPtr<T>>(countableFromJava(env, obj));
}

template <typename T> RefPtr<T> extractPossiblyNullRefPtr(JNIEnv* env, jobject obj) {
  return obj ? extractRefPtr<T>(env, obj) : nullptr;
}

FBEXPORT void setCountableForJava(JNIEnv* env, jobject obj, RefPtr<Countable>&& countable);

void CountableOnLoad(JNIEnv* env);

} }

/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once

#include <memory>
#include <type_traits>

#include <jni.h>

#include <fb/Environment.h>

namespace facebook { namespace jni {

template<typename T>
class GlobalReference {
  static_assert(std::is_convertible<T, jobject>::value,
                "GlobalReference<T> instantiated with type that is not "
                "convertible to jobject");

 public:
  explicit GlobalReference(T globalReference) :
    reference_(globalReference? Environment::current()->NewGlobalRef(globalReference) : nullptr) {
  }

  ~GlobalReference() {
    reset();
  }

  GlobalReference() :
    reference_(nullptr) {
  }

  // enable move constructor and assignment
  GlobalReference(GlobalReference&& rhs) :
    reference_(std::move(rhs.reference_)) {
    rhs.reference_ = nullptr;
  }

  GlobalReference& operator=(GlobalReference&& rhs) {
    if (this != &rhs) {
      reset();
      reference_ = std::move(rhs.reference_);
      rhs.reference_ = nullptr;
    }
    return *this;
  }

  GlobalReference(const GlobalReference<T>& rhs) :
    reference_{} {
    reset(rhs.get());
  }

  GlobalReference& operator=(const GlobalReference<T>& rhs) {
    if (this == &rhs) {
      return *this;
    }
    reset(rhs.get());
    return *this;
  }

  explicit operator bool() const {
    return (reference_ != nullptr);
  }

  T get() const {
    return reinterpret_cast<T>(reference_);
  }

  void reset(T globalReference = nullptr) {
    if (reference_) {
      Environment::current()->DeleteGlobalRef(reference_);
    }
    if (globalReference) {
      reference_ = Environment::current()->NewGlobalRef(globalReference);
    } else {
      reference_ = nullptr;
    }
  }

 private:
  jobject reference_;
};

}}
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once

#include <jni.h>

#include <fb/visibility.h>

namespace facebook {

/**
 * Instructs the JNI environment to throw an exception.
 *
 * @param pEnv JNI environment
 * @param szClassName class name to throw
 * @param szFmt sprintf-style format string
 * @param ... sprintf-style args
 * @return 0 on success; a negative value on failure
 */
FBEXPORT jint throwException(JNIEnv* pEnv, const char* szClassName, const char* szFmt, va_list va_args);

/**
 * Instructs the JNI environment to throw a NoClassDefFoundError.
 *
 * @param pEnv JNI environment
 * @param szFmt sprintf-style format string
 * @param ... sprintf-style args
 * @return 0 on success; a negative value on failure
 */
FBEXPORT jint throwNoClassDefError(JNIEnv* pEnv, const char* szFmt, ...);

/**
 * Instructs the JNI environment to throw a RuntimeException.
 *
 * @param pEnv JNI environment
 * @param szFmt sprintf-style format string
 * @param ... sprintf-style args
 * @return 0 on success; a negative value on failure
 */
FBEXPORT jint throwRuntimeException(JNIEnv* pEnv, const char* szFmt, ...);

/**
 * Instructs the JNI environment to throw a IllegalArgumentException.
 *
 * @param pEnv JNI environment
 * @param szFmt sprintf-style format string
 * @param ... sprintf-style args
 * @return 0 on success; a negative value on failure
 */
FBEXPORT jint throwIllegalArgumentException(JNIEnv* pEnv, const char* szFmt, ...);

/**
 * Instructs the JNI environment to throw a IllegalStateException.
 *
 * @param pEnv JNI environment
 * @param szFmt sprintf-style format string
 * @param ... sprintf-style args
 * @return 0 on success; a negative value on failure
 */
FBEXPORT jint throwIllegalStateException(JNIEnv* pEnv, const char* szFmt, ...);

/**
 * Instructs the JNI environment to throw an IOException.
 *
 * @param pEnv JNI environment
 * @param szFmt sprintf-style format string
 * @param ... sprintf-style args
 * @return 0 on success; a negative value on failure
 */
FBEXPORT jint throwIOException(JNIEnv* pEnv, const char* szFmt, ...);

/**
 * Instructs the JNI environment to throw an AssertionError.
 *
 * @param pEnv JNI environment
 * @param szFmt sprintf-style format string
 * @param ... sprintf-style args
 * @return 0 on success; a negative value on failure
 */
FBEXPORT jint throwAssertionError(JNIEnv* pEnv, const char* szFmt, ...);

/**
 * Instructs the JNI environment to throw an OutOfMemoryError.
 *
 * @param pEnv JNI environment
 * @param szFmt sprintf-style format string
 * @param ... sprintf-style args
 * @return 0 on success; a negative value on failure
 */
FBEXPORT jint throwOutOfMemoryError(JNIEnv* pEnv, const char* szFmt, ...);

/**
 * Finds the specified class. If it's not found, instructs the JNI environment to throw an
 * exception.
 *
 * @param pEnv JNI environment
 * @param szClassName the classname to find in JNI format (e.g. "java/lang/String")
 * @return the class or NULL if not found (in which case a pending exception will be queued). This
 *     returns a global reference (JNIEnv::NewGlobalRef).
 */
FBEXPORT jclass findClassOrThrow(JNIEnv *pEnv, const char* szClassName);

/**
 * Finds the specified field of the specified class. If it's not found, instructs the JNI
 * environment to throw an exception.
 *
 * @param pEnv JNI environment
 * @param clazz the class to lookup the field in
 * @param szFieldName the name of the field to find
 * @param szSig the signature of the field
 * @return the field or NULL if not found (in which case a pending exception will be queued)
 */
FBEXPORT jfieldID getFieldIdOrThrow(JNIEnv* pEnv, jclass clazz, const char* szFieldName, const char* szSig);

/**
 * Finds the specified method of the specified class. If it's not found, instructs the JNI
 * environment to throw an exception.
 *
 * @param pEnv JNI environment
 * @param clazz the class to lookup the method in
 * @param szMethodName the name of the method to find
 * @param szSig the signature of the method
 * @return the method or NULL if not found (in which case a pending exception will be queued)
 */
FBEXPORT jmethodID getMethodIdOrThrow(
    JNIEnv* pEnv,
    jclass clazz,
    const char* szMethodName,
    const char* szSig);

} // namespace facebook

/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once

#include <memory>
#include <type_traits>

#include <jni.h>

#include <fb/Environment.h>

namespace facebook {
namespace jni {

template<class T>
struct LocalReferenceDeleter {
  static_assert(std::is_convertible<T, jobject>::value,
    "LocalReferenceDeleter<T> instantiated with type that is not convertible to jobject");
  void operator()(T localReference) {
    if (localReference != nullptr) {
      Environment::current()->DeleteLocalRef(localReference);
    }
  } 
 };

template<class T>
using LocalReference =
  std::unique_ptr<typename std::remove_pointer<T>::type, LocalReferenceDeleter<T>>;

} }
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once

#include <string>

#include <jni.h>

#include <fb/visibility.h>

namespace facebook {
namespace jni {

namespace detail {

void utf8ToModifiedUTF8(const uint8_t* bytes, size_t len, uint8_t* modified, size_t modifiedLength);
size_t modifiedLength(const std::string& str);
size_t modifiedLength(const uint8_t* str, size_t* length);
std::string modifiedUTF8ToUTF8(const uint8_t* modified, size_t len) noexcept;
std::string utf16toUTF8(const uint16_t* utf16Bytes, size_t len) noexcept;

}

// JNI represents strings encoded with modified version of UTF-8.  The difference between UTF-8 and
// Modified UTF-8 is that the latter support only 1-byte, 2-byte, and 3-byte formats. Supplementary
// character (4 bytes in unicode) needs to be represented in the form of surrogate pairs. To create
// a Modified UTF-8 surrogate pair that Dalvik would understand we take 4-byte unicode character,
// encode it with UTF-16 which gives us two 2 byte chars (surrogate pair) and then we encode each
// pair as UTF-8. This result in 2 x 3 byte characters.  To convert modified UTF-8 to standard
// UTF-8, this mus tbe reversed.
//
// The second difference is that Modified UTF-8 is encoding NUL byte in 2-byte format.
//
// In order to avoid complex error handling, only a minimum of validity checking is done to avoid
// crashing.  If the input is invalid, the output may be invalid as well.
//
// Relevant links:
//  - http://docs.oracle.com/javase/7/docs/technotes/guides/jni/spec/functions.html
//  - https://docs.oracle.com/javase/6/docs/api/java/io/DataInput.html#modified-utf-8

class FBEXPORT LocalString {
public:
  // Assumes UTF8 encoding and make a required convertion to modified UTF-8 when the string
  // contains unicode supplementary characters.
  explicit LocalString(const std::string& str);
  explicit LocalString(const char* str);
  jstring string() const {
    return m_string;
  }
  ~LocalString();
private:
  jstring m_string;
};

// JString to UTF16 extractor using RAII idiom
class JStringUtf16Extractor {
public:
  JStringUtf16Extractor(JNIEnv* env, jstring javaString)
  : env_(env)
  , javaString_(javaString)
  , utf16String_(nullptr) {
    if (env_ && javaString_) {
      utf16String_ = env_->GetStringCritical(javaString_, nullptr);
    }
  }

  ~JStringUtf16Extractor() {
    if (utf16String_) {
      env_->ReleaseStringCritical(javaString_, utf16String_);
    }
  }

  operator const jchar* () const {
    return utf16String_;
  }

private:
  JNIEnv* env_;
  jstring javaString_;
  const jchar* utf16String_;
};

// The string from JNI is converted to standard UTF-8 if the string contains supplementary
// characters.
FBEXPORT std::string fromJString(JNIEnv* env, jstring str);

} }
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once
#include <jni.h>
#include <initializer_list>
#include <fb/assert.h>

namespace facebook {
namespace jni {

static inline void registerNatives(JNIEnv* env, jclass cls, std::initializer_list<JNINativeMethod> methods) {
  auto result = env->RegisterNatives(cls, methods.begin(), methods.size());
  FBASSERT(result == 0);
}

static inline void registerNatives(JNIEnv* env, const char* cls, std::initializer_list<JNINativeMethod> list) {
  registerNatives(env, env->FindClass(cls), list);
}

} }
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once
#include <string>
#include <jni.h>
#include <fb/noncopyable.h>
#include <fb/Countable.h>
#include <fb/visibility.h>


namespace facebook {
namespace jni {

class FBEXPORT WeakReference : public Countable {
public:
  typedef RefPtr<WeakReference> Ptr;
  WeakReference(jobject strongRef);
  ~WeakReference();
  jweak weakRef() {
    return m_weakReference;
  }

private:
  jweak m_weakReference;
};

// This class is intended to take a weak reference and turn it into a strong
// local reference. Consequently, it should only be allocated on the stack.
class FBEXPORT ResolvedWeakReference : public noncopyable {
public:
  ResolvedWeakReference(jobject weakRef);
  ResolvedWeakReference(const RefPtr<WeakReference>& weakRef);
  ~ResolvedWeakReference();

  operator jobject () {
    return m_strongReference;
  }

  explicit operator bool () {
    return m_strongReference != nullptr;
  }

private:
  jobject m_strongReference;
};

} }

/*
 *  Copyright (c) 2004-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.jni;

import com.facebook.proguard.annotations.DoNotStrip;

/**
 * A Java Object that has native memory allocated corresponding to this instance.
 *
 * <p>NB: THREAD SAFETY (this comment also exists at Countable.cpp)
 *
 * <p>{@link #dispose} deletes the corresponding native object on whatever thread the method is
 * called on. In the common case when this is called by Countable#finalize(), this will be called on
 * the system finalizer thread. If you manually call dispose on the Java object, the native object
 * will be deleted synchronously on that thread.
 */
@DoNotStrip
public class Countable {

  // Private C++ instance
  @DoNotStrip private long mInstance = 0;

  public native void dispose();

  protected void finalize() throws Throwable {
    dispose();
    super.finalize();
  }
}
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.jni;

import com.facebook.proguard.annotations.DoNotStrip;

@DoNotStrip
public class CppException extends RuntimeException {
  @DoNotStrip
  public CppException(String message) {
    super(message);
  }
}
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.jni;

import com.facebook.proguard.annotations.DoNotStrip;

@DoNotStrip
public class CppSystemErrorException extends CppException {
  int errorCode;

  @DoNotStrip
  public CppSystemErrorException(String message, int errorCode) {
    super(message);
    this.errorCode = errorCode;
  }

  public int getErrorCode() {
    return errorCode;
  }
}
/*
 *  Copyright (c) 2004-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

package com.facebook.jni;

import com.facebook.proguard.annotations.DoNotStrip;

@DoNotStrip
public abstract class HybridClassBase extends HybridData {}
/*
 *  Copyright (c) 2004-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.jni;

import com.facebook.proguard.annotations.DoNotStrip;

/**
 * This object holds a native C++ member for hybrid Java/C++ objects.
 *
 * <p>NB: THREAD SAFETY
 *
 * <p>{@link #dispose} deletes the corresponding native object on whatever thread the method is
 * called on. In the common case when this is called by HybridData#finalize(), this will be called
 * on the system finalizer thread. If you manually call resetNative() on the Java object, the C++
 * object will be deleted synchronously on that thread.
 */
@DoNotStrip
public class HybridData {

  // Private C++ instance
  @DoNotStrip private long mNativePointer = 0;

  /**
   * To explicitly delete the instance, call resetNative(). If the C++ instance is referenced after
   * this is called, a NullPointerException will be thrown. resetNative() may be called multiple
   * times safely. Because {@link #finalize} calls resetNative, the instance will not leak if this
   * is not called, but timing of deletion and the thread the C++ dtor is called on will be at the
   * whim of the Java GC. If you want to control the thread and timing of the destructor, you should
   * call resetNative() explicitly.
   */
  public native void resetNative();

  protected void finalize() throws Throwable {
    resetNative();
    super.finalize();
  }

  public boolean isValid() {
    return mNativePointer != 0;
  }
}
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.jni;

import com.facebook.proguard.annotations.DoNotStrip;
import java.util.Iterator;
import javax.annotation.Nullable;

/**
 * To iterate over an Iterator from C++ requires two calls per entry: hasNext() and next(). This
 * helper reduces it to one call and one field get per entry. It does not use a generic argument,
 * since in C++, the types will be erased, anyway. This is *not* a {@link java.util.Iterator}.
 */
@DoNotStrip
public class IteratorHelper {
  private final Iterator mIterator;

  // This is private, but accessed via JNI.
  @DoNotStrip private @Nullable Object mElement;

  @DoNotStrip
  public IteratorHelper(Iterator iterator) {
    mIterator = iterator;
  }

  @DoNotStrip
  public IteratorHelper(Iterable iterable) {
    mIterator = iterable.iterator();
  }

  /**
   * Moves the helper to the next entry in the map, if any. Returns true iff there is an entry to
   * read.
   */
  @DoNotStrip
  boolean hasNext() {
    if (mIterator.hasNext()) {
      mElement = mIterator.next();
      return true;
    } else {
      mElement = null;
      return false;
    }
  }
}
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.jni;

import com.facebook.proguard.annotations.DoNotStrip;
import java.util.Iterator;
import java.util.Map;
import javax.annotation.Nullable;

/**
 * To iterate over a Map from C++ requires four calls per entry: hasNext(), next(), getKey(),
 * getValue(). This helper reduces it to one call and two field gets per entry. It does not use a
 * generic argument, since in C++, the types will be erased, anyway. This is *not* a {@link
 * java.util.Iterator}.
 */
@DoNotStrip
public class MapIteratorHelper {
  @DoNotStrip private final Iterator<Map.Entry> mIterator;
  @DoNotStrip private @Nullable Object mKey;
  @DoNotStrip private @Nullable Object mValue;

  @DoNotStrip
  public MapIteratorHelper(Map map) {
    mIterator = map.entrySet().iterator();
  }

  /**
   * Moves the helper to the next entry in the map, if any. Returns true iff there is an entry to
   * read.
   */
  @DoNotStrip
  boolean hasNext() {
    if (mIterator.hasNext()) {
      Map.Entry entry = mIterator.next();
      mKey = entry.getKey();
      mValue = entry.getValue();
      return true;
    } else {
      mKey = null;
      mValue = null;
      return false;
    }
  }
}
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.jni;

import com.facebook.proguard.annotations.DoNotStrip;

/** A Runnable that has a native run implementation. */
@DoNotStrip
public class NativeRunnable implements Runnable {

  private final HybridData mHybridData;

  private NativeRunnable(HybridData hybridData) {
    mHybridData = hybridData;
  }

  public native void run();
}
/*
 *  Copyright (c) 2004-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.jni;

import com.facebook.proguard.annotations.DoNotStrip;

@DoNotStrip
public class ThreadScopeSupport {
  // This is just used for ThreadScope::withClassLoader to have a java function
  // in the stack so that jni has access to the correct classloader.
  @DoNotStrip
  private static void runStdFunction(long ptr) {
    runStdFunctionImpl(ptr);
  }

  private static native void runStdFunctionImpl(long ptr);
}
/*
 *  Copyright (c) 2015-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
package com.facebook.jni;

import com.facebook.proguard.annotations.DoNotStrip;

@DoNotStrip
public class UnknownCppException extends CppException {
  @DoNotStrip
  public UnknownCppException() {
    super("Unknown");
  }

  @DoNotStrip
  public UnknownCppException(String message) {
    super(message);
  }
}
/*
 *  Copyright (c) 2014-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once

#ifdef __ANDROID__
#include_next <jni.h>
#else
#include "real/jni.h"
#endif
/*
 *  Copyright (c) 2006-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
/*
 * JNI specification, as defined by Sun:
 * http://java.sun.com/javase/6/docs/technotes/guides/jni/spec/jniTOC.html
 *
 * Everything here is expected to be VM-neutral.
 */

#ifndef JNI_H_
#define JNI_H_

#include <stdarg.h>
#include <stdint.h>

/* Primitive types that match up with Java equivalents. */
typedef uint8_t  jboolean; /* unsigned 8 bits */
typedef int8_t   jbyte;    /* signed 8 bits */
typedef uint16_t jchar;    /* unsigned 16 bits */
typedef int16_t  jshort;   /* signed 16 bits */
typedef int32_t  jint;     /* signed 32 bits */
typedef int64_t  jlong;    /* signed 64 bits */
typedef float    jfloat;   /* 32-bit IEEE 754 */
typedef double   jdouble;  /* 64-bit IEEE 754 */

/* "cardinal indices and sizes" */
typedef jint     jsize;

#ifdef __cplusplus
/*
 * Reference types, in C++
 */
class _jobject {};
class _jclass : public _jobject {};
class _jstring : public _jobject {};
class _jarray : public _jobject {};
class _jobjectArray : public _jarray {};
class _jbooleanArray : public _jarray {};
class _jbyteArray : public _jarray {};
class _jcharArray : public _jarray {};
class _jshortArray : public _jarray {};
class _jintArray : public _jarray {};
class _jlongArray : public _jarray {};
class _jfloatArray : public _jarray {};
class _jdoubleArray : public _jarray {};
class _jthrowable : public _jobject {};

typedef _jobject*       jobject;
typedef _jclass*        jclass;
typedef _jstring*       jstring;
typedef _jarray*        jarray;
typedef _jobjectArray*  jobjectArray;
typedef _jbooleanArray* jbooleanArray;
typedef _jbyteArray*    jbyteArray;
typedef _jcharArray*    jcharArray;
typedef _jshortArray*   jshortArray;
typedef _jintArray*     jintArray;
typedef _jlongArray*    jlongArray;
typedef _jfloatArray*   jfloatArray;
typedef _jdoubleArray*  jdoubleArray;
typedef _jthrowable*    jthrowable;
typedef _jobject*       jweak;


#else /* not __cplusplus */

/*
 * Reference types, in C.
 */
typedef void*           jobject;
typedef jobject         jclass;
typedef jobject         jstring;
typedef jobject         jarray;
typedef jarray          jobjectArray;
typedef jarray          jbooleanArray;
typedef jarray          jbyteArray;
typedef jarray          jcharArray;
typedef jarray          jshortArray;
typedef jarray          jintArray;
typedef jarray          jlongArray;
typedef jarray          jfloatArray;
typedef jarray          jdoubleArray;
typedef jobject         jthrowable;
typedef jobject         jweak;

#endif /* not __cplusplus */

struct _jfieldID;                       /* opaque structure */
typedef struct _jfieldID* jfieldID;     /* field IDs */

struct _jmethodID;                      /* opaque structure */
typedef struct _jmethodID* jmethodID;   /* method IDs */

struct JNIInvokeInterface;

typedef union jvalue {
    jboolean    z;
    jbyte       b;
    jchar       c;
    jshort      s;
    jint        i;
    jlong       j;
    jfloat      f;
    jdouble     d;
    jobject     l;
} jvalue;

typedef enum jobjectRefType {
    JNIInvalidRefType = 0,
    JNILocalRefType = 1,
    JNIGlobalRefType = 2,
    JNIWeakGlobalRefType = 3
} jobjectRefType;

typedef struct {
    const char* name;
    const char* signature;
    void*       fnPtr;
} JNINativeMethod;

struct _JNIEnv;
struct _JavaVM;
typedef const struct JNINativeInterface* C_JNIEnv;

#if defined(__cplusplus)
typedef _JNIEnv JNIEnv;
typedef _JavaVM JavaVM;
#else
typedef const struct JNINativeInterface* JNIEnv;
typedef const struct JNIInvokeInterface* JavaVM;
#endif

/*
 * Table of interface function pointers.
 */
struct JNINativeInterface {
    void*       reserved0;
    void*       reserved1;
    void*       reserved2;
    void*       reserved3;

    jint        (*GetVersion)(JNIEnv *);

    jclass      (*DefineClass)(JNIEnv*, const char*, jobject, const jbyte*,
                        jsize);
    jclass      (*FindClass)(JNIEnv*, const char*);

    jmethodID   (*FromReflectedMethod)(JNIEnv*, jobject);
    jfieldID    (*FromReflectedField)(JNIEnv*, jobject);
    /* spec doesn't show jboolean parameter */
    jobject     (*ToReflectedMethod)(JNIEnv*, jclass, jmethodID, jboolean);

    jclass      (*GetSuperclass)(JNIEnv*, jclass);
    jboolean    (*IsAssignableFrom)(JNIEnv*, jclass, jclass);

    /* spec doesn't show jboolean parameter */
    jobject     (*ToReflectedField)(JNIEnv*, jclass, jfieldID, jboolean);

    jint        (*Throw)(JNIEnv*, jthrowable);
    jint        (*ThrowNew)(JNIEnv *, jclass, const char *);
    jthrowable  (*ExceptionOccurred)(JNIEnv*);
    void        (*ExceptionDescribe)(JNIEnv*);
    void        (*ExceptionClear)(JNIEnv*);
    void        (*FatalError)(JNIEnv*, const char*);

    jint        (*PushLocalFrame)(JNIEnv*, jint);
    jobject     (*PopLocalFrame)(JNIEnv*, jobject);

    jobject     (*NewGlobalRef)(JNIEnv*, jobject);
    void        (*DeleteGlobalRef)(JNIEnv*, jobject);
    void        (*DeleteLocalRef)(JNIEnv*, jobject);
    jboolean    (*IsSameObject)(JNIEnv*, jobject, jobject);

    jobject     (*NewLocalRef)(JNIEnv*, jobject);
    jint        (*EnsureLocalCapacity)(JNIEnv*, jint);

    jobject     (*AllocObject)(JNIEnv*, jclass);
    jobject     (*NewObject)(JNIEnv*, jclass, jmethodID, ...);
    jobject     (*NewObjectV)(JNIEnv*, jclass, jmethodID, va_list);
    jobject     (*NewObjectA)(JNIEnv*, jclass, jmethodID, jvalue*);

    jclass      (*GetObjectClass)(JNIEnv*, jobject);
    jboolean    (*IsInstanceOf)(JNIEnv*, jobject, jclass);
    jmethodID   (*GetMethodID)(JNIEnv*, jclass, const char*, const char*);

    jobject     (*CallObjectMethod)(JNIEnv*, jobject, jmethodID, ...);
    jobject     (*CallObjectMethodV)(JNIEnv*, jobject, jmethodID, va_list);
    jobject     (*CallObjectMethodA)(JNIEnv*, jobject, jmethodID, jvalue*);
    jboolean    (*CallBooleanMethod)(JNIEnv*, jobject, jmethodID, ...);
    jboolean    (*CallBooleanMethodV)(JNIEnv*, jobject, jmethodID, va_list);
    jboolean    (*CallBooleanMethodA)(JNIEnv*, jobject, jmethodID, jvalue*);
    jbyte       (*CallByteMethod)(JNIEnv*, jobject, jmethodID, ...);
    jbyte       (*CallByteMethodV)(JNIEnv*, jobject, jmethodID, va_list);
    jbyte       (*CallByteMethodA)(JNIEnv*, jobject, jmethodID, jvalue*);
    jchar       (*CallCharMethod)(JNIEnv*, jobject, jmethodID, ...);
    jchar       (*CallCharMethodV)(JNIEnv*, jobject, jmethodID, va_list);
    jchar       (*CallCharMethodA)(JNIEnv*, jobject, jmethodID, jvalue*);
    jshort      (*CallShortMethod)(JNIEnv*, jobject, jmethodID, ...);
    jshort      (*CallShortMethodV)(JNIEnv*, jobject, jmethodID, va_list);
    jshort      (*CallShortMethodA)(JNIEnv*, jobject, jmethodID, jvalue*);
    jint        (*CallIntMethod)(JNIEnv*, jobject, jmethodID, ...);
    jint        (*CallIntMethodV)(JNIEnv*, jobject, jmethodID, va_list);
    jint        (*CallIntMethodA)(JNIEnv*, jobject, jmethodID, jvalue*);
    jlong       (*CallLongMethod)(JNIEnv*, jobject, jmethodID, ...);
    jlong       (*CallLongMethodV)(JNIEnv*, jobject, jmethodID, va_list);
    jlong       (*CallLongMethodA)(JNIEnv*, jobject, jmethodID, jvalue*);
    jfloat      (*CallFloatMethod)(JNIEnv*, jobject, jmethodID, ...);
    jfloat      (*CallFloatMethodV)(JNIEnv*, jobject, jmethodID, va_list);
    jfloat      (*CallFloatMethodA)(JNIEnv*, jobject, jmethodID, jvalue*);
    jdouble     (*CallDoubleMethod)(JNIEnv*, jobject, jmethodID, ...);
    jdouble     (*CallDoubleMethodV)(JNIEnv*, jobject, jmethodID, va_list);
    jdouble     (*CallDoubleMethodA)(JNIEnv*, jobject, jmethodID, jvalue*);
    void        (*CallVoidMethod)(JNIEnv*, jobject, jmethodID, ...);
    void        (*CallVoidMethodV)(JNIEnv*, jobject, jmethodID, va_list);
    void        (*CallVoidMethodA)(JNIEnv*, jobject, jmethodID, jvalue*);

    jobject     (*CallNonvirtualObjectMethod)(JNIEnv*, jobject, jclass,
                        jmethodID, ...);
    jobject     (*CallNonvirtualObjectMethodV)(JNIEnv*, jobject, jclass,
                        jmethodID, va_list);
    jobject     (*CallNonvirtualObjectMethodA)(JNIEnv*, jobject, jclass,
                        jmethodID, jvalue*);
    jboolean    (*CallNonvirtualBooleanMethod)(JNIEnv*, jobject, jclass,
                        jmethodID, ...);
    jboolean    (*CallNonvirtualBooleanMethodV)(JNIEnv*, jobject, jclass,
                         jmethodID, va_list);
    jboolean    (*CallNonvirtualBooleanMethodA)(JNIEnv*, jobject, jclass,
                         jmethodID, jvalue*);
    jbyte       (*CallNonvirtualByteMethod)(JNIEnv*, jobject, jclass,
                        jmethodID, ...);
    jbyte       (*CallNonvirtualByteMethodV)(JNIEnv*, jobject, jclass,
                        jmethodID, va_list);
    jbyte       (*CallNonvirtualByteMethodA)(JNIEnv*, jobject, jclass,
                        jmethodID, jvalue*);
    jchar       (*CallNonvirtualCharMethod)(JNIEnv*, jobject, jclass,
                        jmethodID, ...);
    jchar       (*CallNonvirtualCharMethodV)(JNIEnv*, jobject, jclass,
                        jmethodID, va_list);
    jchar       (*CallNonvirtualCharMethodA)(JNIEnv*, jobject, jclass,
                        jmethodID, jvalue*);
    jshort      (*CallNonvirtualShortMethod)(JNIEnv*, jobject, jclass,
                        jmethodID, ...);
    jshort      (*CallNonvirtualShortMethodV)(JNIEnv*, jobject, jclass,
                        jmethodID, va_list);
    jshort      (*CallNonvirtualShortMethodA)(JNIEnv*, jobject, jclass,
                        jmethodID, jvalue*);
    jint        (*CallNonvirtualIntMethod)(JNIEnv*, jobject, jclass,
                        jmethodID, ...);
    jint        (*CallNonvirtualIntMethodV)(JNIEnv*, jobject, jclass,
                        jmethodID, va_list);
    jint        (*CallNonvirtualIntMethodA)(JNIEnv*, jobject, jclass,
                        jmethodID, jvalue*);
    jlong       (*CallNonvirtualLongMethod)(JNIEnv*, jobject, jclass,
                        jmethodID, ...);
    jlong       (*CallNonvirtualLongMethodV)(JNIEnv*, jobject, jclass,
                        jmethodID, va_list);
    jlong       (*CallNonvirtualLongMethodA)(JNIEnv*, jobject, jclass,
                        jmethodID, jvalue*);
    jfloat      (*CallNonvirtualFloatMethod)(JNIEnv*, jobject, jclass,
                        jmethodID, ...);
    jfloat      (*CallNonvirtualFloatMethodV)(JNIEnv*, jobject, jclass,
                        jmethodID, va_list);
    jfloat      (*CallNonvirtualFloatMethodA)(JNIEnv*, jobject, jclass,
                        jmethodID, jvalue*);
    jdouble     (*CallNonvirtualDoubleMethod)(JNIEnv*, jobject, jclass,
                        jmethodID, ...);
    jdouble     (*CallNonvirtualDoubleMethodV)(JNIEnv*, jobject, jclass,
                        jmethodID, va_list);
    jdouble     (*CallNonvirtualDoubleMethodA)(JNIEnv*, jobject, jclass,
                        jmethodID, jvalue*);
    void        (*CallNonvirtualVoidMethod)(JNIEnv*, jobject, jclass,
                        jmethodID, ...);
    void        (*CallNonvirtualVoidMethodV)(JNIEnv*, jobject, jclass,
                        jmethodID, va_list);
    void        (*CallNonvirtualVoidMethodA)(JNIEnv*, jobject, jclass,
                        jmethodID, jvalue*);

    jfieldID    (*GetFieldID)(JNIEnv*, jclass, const char*, const char*);

    jobject     (*GetObjectField)(JNIEnv*, jobject, jfieldID);
    jboolean    (*GetBooleanField)(JNIEnv*, jobject, jfieldID);
    jbyte       (*GetByteField)(JNIEnv*, jobject, jfieldID);
    jchar       (*GetCharField)(JNIEnv*, jobject, jfieldID);
    jshort      (*GetShortField)(JNIEnv*, jobject, jfieldID);
    jint        (*GetIntField)(JNIEnv*, jobject, jfieldID);
    jlong       (*GetLongField)(JNIEnv*, jobject, jfieldID);
    jfloat      (*GetFloatField)(JNIEnv*, jobject, jfieldID);
    jdouble     (*GetDoubleField)(JNIEnv*, jobject, jfieldID);

    void        (*SetObjectField)(JNIEnv*, jobject, jfieldID, jobject);
    void        (*SetBooleanField)(JNIEnv*, jobject, jfieldID, jboolean);
    void        (*SetByteField)(JNIEnv*, jobject, jfieldID, jbyte);
    void        (*SetCharField)(JNIEnv*, jobject, jfieldID, jchar);
    void        (*SetShortField)(JNIEnv*, jobject, jfieldID, jshort);
    void        (*SetIntField)(JNIEnv*, jobject, jfieldID, jint);
    void        (*SetLongField)(JNIEnv*, jobject, jfieldID, jlong);
    void        (*SetFloatField)(JNIEnv*, jobject, jfieldID, jfloat);
    void        (*SetDoubleField)(JNIEnv*, jobject, jfieldID, jdouble);

    jmethodID   (*GetStaticMethodID)(JNIEnv*, jclass, const char*, const char*);

    jobject     (*CallStaticObjectMethod)(JNIEnv*, jclass, jmethodID, ...);
    jobject     (*CallStaticObjectMethodV)(JNIEnv*, jclass, jmethodID, va_list);
    jobject     (*CallStaticObjectMethodA)(JNIEnv*, jclass, jmethodID, jvalue*);
    jboolean    (*CallStaticBooleanMethod)(JNIEnv*, jclass, jmethodID, ...);
    jboolean    (*CallStaticBooleanMethodV)(JNIEnv*, jclass, jmethodID,
                        va_list);
    jboolean    (*CallStaticBooleanMethodA)(JNIEnv*, jclass, jmethodID,
                        jvalue*);
    jbyte       (*CallStaticByteMethod)(JNIEnv*, jclass, jmethodID, ...);
    jbyte       (*CallStaticByteMethodV)(JNIEnv*, jclass, jmethodID, va_list);
    jbyte       (*CallStaticByteMethodA)(JNIEnv*, jclass, jmethodID, jvalue*);
    jchar       (*CallStaticCharMethod)(JNIEnv*, jclass, jmethodID, ...);
    jchar       (*CallStaticCharMethodV)(JNIEnv*, jclass, jmethodID, va_list);
    jchar       (*CallStaticCharMethodA)(JNIEnv*, jclass, jmethodID, jvalue*);
    jshort      (*CallStaticShortMethod)(JNIEnv*, jclass, jmethodID, ...);
    jshort      (*CallStaticShortMethodV)(JNIEnv*, jclass, jmethodID, va_list);
    jshort      (*CallStaticShortMethodA)(JNIEnv*, jclass, jmethodID, jvalue*);
    jint        (*CallStaticIntMethod)(JNIEnv*, jclass, jmethodID, ...);
    jint        (*CallStaticIntMethodV)(JNIEnv*, jclass, jmethodID, va_list);
    jint        (*CallStaticIntMethodA)(JNIEnv*, jclass, jmethodID, jvalue*);
    jlong       (*CallStaticLongMethod)(JNIEnv*, jclass, jmethodID, ...);
    jlong       (*CallStaticLongMethodV)(JNIEnv*, jclass, jmethodID, va_list);
    jlong       (*CallStaticLongMethodA)(JNIEnv*, jclass, jmethodID, jvalue*);
    jfloat      (*CallStaticFloatMethod)(JNIEnv*, jclass, jmethodID, ...);
    jfloat      (*CallStaticFloatMethodV)(JNIEnv*, jclass, jmethodID, va_list);
    jfloat      (*CallStaticFloatMethodA)(JNIEnv*, jclass, jmethodID, jvalue*);
    jdouble     (*CallStaticDoubleMethod)(JNIEnv*, jclass, jmethodID, ...);
    jdouble     (*CallStaticDoubleMethodV)(JNIEnv*, jclass, jmethodID, va_list);
    jdouble     (*CallStaticDoubleMethodA)(JNIEnv*, jclass, jmethodID, jvalue*);
    void        (*CallStaticVoidMethod)(JNIEnv*, jclass, jmethodID, ...);
    void        (*CallStaticVoidMethodV)(JNIEnv*, jclass, jmethodID, va_list);
    void        (*CallStaticVoidMethodA)(JNIEnv*, jclass, jmethodID, jvalue*);

    jfieldID    (*GetStaticFieldID)(JNIEnv*, jclass, const char*,
                        const char*);

    jobject     (*GetStaticObjectField)(JNIEnv*, jclass, jfieldID);
    jboolean    (*GetStaticBooleanField)(JNIEnv*, jclass, jfieldID);
    jbyte       (*GetStaticByteField)(JNIEnv*, jclass, jfieldID);
    jchar       (*GetStaticCharField)(JNIEnv*, jclass, jfieldID);
    jshort      (*GetStaticShortField)(JNIEnv*, jclass, jfieldID);
    jint        (*GetStaticIntField)(JNIEnv*, jclass, jfieldID);
    jlong       (*GetStaticLongField)(JNIEnv*, jclass, jfieldID);
    jfloat      (*GetStaticFloatField)(JNIEnv*, jclass, jfieldID);
    jdouble     (*GetStaticDoubleField)(JNIEnv*, jclass, jfieldID);

    void        (*SetStaticObjectField)(JNIEnv*, jclass, jfieldID, jobject);
    void        (*SetStaticBooleanField)(JNIEnv*, jclass, jfieldID, jboolean);
    void        (*SetStaticByteField)(JNIEnv*, jclass, jfieldID, jbyte);
    void        (*SetStaticCharField)(JNIEnv*, jclass, jfieldID, jchar);
    void        (*SetStaticShortField)(JNIEnv*, jclass, jfieldID, jshort);
    void        (*SetStaticIntField)(JNIEnv*, jclass, jfieldID, jint);
    void        (*SetStaticLongField)(JNIEnv*, jclass, jfieldID, jlong);
    void        (*SetStaticFloatField)(JNIEnv*, jclass, jfieldID, jfloat);
    void        (*SetStaticDoubleField)(JNIEnv*, jclass, jfieldID, jdouble);

    jstring     (*NewString)(JNIEnv*, const jchar*, jsize);
    jsize       (*GetStringLength)(JNIEnv*, jstring);
    const jchar* (*GetStringChars)(JNIEnv*, jstring, jboolean*);
    void        (*ReleaseStringChars)(JNIEnv*, jstring, const jchar*);
    jstring     (*NewStringUTF)(JNIEnv*, const char*);
    jsize       (*GetStringUTFLength)(JNIEnv*, jstring);
    /* JNI spec says this returns const jbyte*, but that's inconsistent */
    const char* (*GetStringUTFChars)(JNIEnv*, jstring, jboolean*);
    void        (*ReleaseStringUTFChars)(JNIEnv*, jstring, const char*);
    jsize       (*GetArrayLength)(JNIEnv*, jarray);
    jobjectArray (*NewObjectArray)(JNIEnv*, jsize, jclass, jobject);
    jobject     (*GetObjectArrayElement)(JNIEnv*, jobjectArray, jsize);
    void        (*SetObjectArrayElement)(JNIEnv*, jobjectArray, jsize, jobject);

    jbooleanArray (*NewBooleanArray)(JNIEnv*, jsize);
    jbyteArray    (*NewByteArray)(JNIEnv*, jsize);
    jcharArray    (*NewCharArray)(JNIEnv*, jsize);
    jshortArray   (*NewShortArray)(JNIEnv*, jsize);
    jintArray     (*NewIntArray)(JNIEnv*, jsize);
    jlongArray    (*NewLongArray)(JNIEnv*, jsize);
    jfloatArray   (*NewFloatArray)(JNIEnv*, jsize);
    jdoubleArray  (*NewDoubleArray)(JNIEnv*, jsize);

    jboolean*   (*GetBooleanArrayElements)(JNIEnv*, jbooleanArray, jboolean*);
    jbyte*      (*GetByteArrayElements)(JNIEnv*, jbyteArray, jboolean*);
    jchar*      (*GetCharArrayElements)(JNIEnv*, jcharArray, jboolean*);
    jshort*     (*GetShortArrayElements)(JNIEnv*, jshortArray, jboolean*);
    jint*       (*GetIntArrayElements)(JNIEnv*, jintArray, jboolean*);
    jlong*      (*GetLongArrayElements)(JNIEnv*, jlongArray, jboolean*);
    jfloat*     (*GetFloatArrayElements)(JNIEnv*, jfloatArray, jboolean*);
    jdouble*    (*GetDoubleArrayElements)(JNIEnv*, jdoubleArray, jboolean*);

    void        (*ReleaseBooleanArrayElements)(JNIEnv*, jbooleanArray,
                        jboolean*, jint);
    void        (*ReleaseByteArrayElements)(JNIEnv*, jbyteArray,
                        jbyte*, jint);
    void        (*ReleaseCharArrayElements)(JNIEnv*, jcharArray,
                        jchar*, jint);
    void        (*ReleaseShortArrayElements)(JNIEnv*, jshortArray,
                        jshort*, jint);
    void        (*ReleaseIntArrayElements)(JNIEnv*, jintArray,
                        jint*, jint);
    void        (*ReleaseLongArrayElements)(JNIEnv*, jlongArray,
                        jlong*, jint);
    void        (*ReleaseFloatArrayElements)(JNIEnv*, jfloatArray,
                        jfloat*, jint);
    void        (*ReleaseDoubleArrayElements)(JNIEnv*, jdoubleArray,
                        jdouble*, jint);

    void        (*GetBooleanArrayRegion)(JNIEnv*, jbooleanArray,
                        jsize, jsize, jboolean*);
    void        (*GetByteArrayRegion)(JNIEnv*, jbyteArray,
                        jsize, jsize, jbyte*);
    void        (*GetCharArrayRegion)(JNIEnv*, jcharArray,
                        jsize, jsize, jchar*);
    void        (*GetShortArrayRegion)(JNIEnv*, jshortArray,
                        jsize, jsize, jshort*);
    void        (*GetIntArrayRegion)(JNIEnv*, jintArray,
                        jsize, jsize, jint*);
    void        (*GetLongArrayRegion)(JNIEnv*, jlongArray,
                        jsize, jsize, jlong*);
    void        (*GetFloatArrayRegion)(JNIEnv*, jfloatArray,
                        jsize, jsize, jfloat*);
    void        (*GetDoubleArrayRegion)(JNIEnv*, jdoubleArray,
                        jsize, jsize, jdouble*);

    /* spec shows these without const; some jni.h do, some don't */
    void        (*SetBooleanArrayRegion)(JNIEnv*, jbooleanArray,
                        jsize, jsize, const jboolean*);
    void        (*SetByteArrayRegion)(JNIEnv*, jbyteArray,
                        jsize, jsize, const jbyte*);
    void        (*SetCharArrayRegion)(JNIEnv*, jcharArray,
                        jsize, jsize, const jchar*);
    void        (*SetShortArrayRegion)(JNIEnv*, jshortArray,
                        jsize, jsize, const jshort*);
    void        (*SetIntArrayRegion)(JNIEnv*, jintArray,
                        jsize, jsize, const jint*);
    void        (*SetLongArrayRegion)(JNIEnv*, jlongArray,
                        jsize, jsize, const jlong*);
    void        (*SetFloatArrayRegion)(JNIEnv*, jfloatArray,
                        jsize, jsize, const jfloat*);
    void        (*SetDoubleArrayRegion)(JNIEnv*, jdoubleArray,
                        jsize, jsize, const jdouble*);

    jint        (*RegisterNatives)(JNIEnv*, jclass, const JNINativeMethod*,
                        jint);
    jint        (*UnregisterNatives)(JNIEnv*, jclass);
    jint        (*MonitorEnter)(JNIEnv*, jobject);
    jint        (*MonitorExit)(JNIEnv*, jobject);
    jint        (*GetJavaVM)(JNIEnv*, JavaVM**);

    void        (*GetStringRegion)(JNIEnv*, jstring, jsize, jsize, jchar*);
    void        (*GetStringUTFRegion)(JNIEnv*, jstring, jsize, jsize, char*);

    void*       (*GetPrimitiveArrayCritical)(JNIEnv*, jarray, jboolean*);
    void        (*ReleasePrimitiveArrayCritical)(JNIEnv*, jarray, void*, jint);

    const jchar* (*GetStringCritical)(JNIEnv*, jstring, jboolean*);
    void        (*ReleaseStringCritical)(JNIEnv*, jstring, const jchar*);

    jweak       (*NewWeakGlobalRef)(JNIEnv*, jobject);
    void        (*DeleteWeakGlobalRef)(JNIEnv*, jweak);

    jboolean    (*ExceptionCheck)(JNIEnv*);

    jobject     (*NewDirectByteBuffer)(JNIEnv*, void*, jlong);
    void*       (*GetDirectBufferAddress)(JNIEnv*, jobject);
    jlong       (*GetDirectBufferCapacity)(JNIEnv*, jobject);

    /* added in JNI 1.6 */
    jobjectRefType (*GetObjectRefType)(JNIEnv*, jobject);
};

/*
 * C++ object wrapper.
 *
 * This is usually overlaid on a C struct whose first element is a
 * JNINativeInterface*.  We rely somewhat on compiler behavior.
 */
struct _JNIEnv {
    /* do not rename this; it does not seem to be entirely opaque */
    const struct JNINativeInterface* functions;

#if defined(__cplusplus)

    jint GetVersion()
    { return functions->GetVersion(this); }

    jclass DefineClass(const char *name, jobject loader, const jbyte* buf,
        jsize bufLen)
    { return functions->DefineClass(this, name, loader, buf, bufLen); }

    jclass FindClass(const char* name)
    { return functions->FindClass(this, name); }

    jmethodID FromReflectedMethod(jobject method)
    { return functions->FromReflectedMethod(this, method); }

    jfieldID FromReflectedField(jobject field)
    { return functions->FromReflectedField(this, field); }

    jobject ToReflectedMethod(jclass cls, jmethodID methodID, jboolean isStatic)
    { return functions->ToReflectedMethod(this, cls, methodID, isStatic); }

    jclass GetSuperclass(jclass clazz)
    { return functions->GetSuperclass(this, clazz); }

    jboolean IsAssignableFrom(jclass clazz1, jclass clazz2)
    { return functions->IsAssignableFrom(this, clazz1, clazz2); }

    jobject ToReflectedField(jclass cls, jfieldID fieldID, jboolean isStatic)
    { return functions->ToReflectedField(this, cls, fieldID, isStatic); }

    jint Throw(jthrowable obj)
    { return functions->Throw(this, obj); }

    jint ThrowNew(jclass clazz, const char* message)
    { return functions->ThrowNew(this, clazz, message); }

    jthrowable ExceptionOccurred()
    { return functions->ExceptionOccurred(this); }

    void ExceptionDescribe()
    { functions->ExceptionDescribe(this); }

    void ExceptionClear()
    { functions->ExceptionClear(this); }

    void FatalError(const char* msg)
    { functions->FatalError(this, msg); }

    jint PushLocalFrame(jint capacity)
    { return functions->PushLocalFrame(this, capacity); }

    jobject PopLocalFrame(jobject result)
    { return functions->PopLocalFrame(this, result); }

    jobject NewGlobalRef(jobject obj)
    { return functions->NewGlobalRef(this, obj); }

    void DeleteGlobalRef(jobject globalRef)
    { functions->DeleteGlobalRef(this, globalRef); }

    void DeleteLocalRef(jobject localRef)
    { functions->DeleteLocalRef(this, localRef); }

    jboolean IsSameObject(jobject ref1, jobject ref2)
    { return functions->IsSameObject(this, ref1, ref2); }

    jobject NewLocalRef(jobject ref)
    { return functions->NewLocalRef(this, ref); }

    jint EnsureLocalCapacity(jint capacity)
    { return functions->EnsureLocalCapacity(this, capacity); }

    jobject AllocObject(jclass clazz)
    { return functions->AllocObject(this, clazz); }

    jobject NewObject(jclass clazz, jmethodID methodID, ...)
    {
        va_list args;
        va_start(args, methodID);
        jobject result = functions->NewObjectV(this, clazz, methodID, args);
        va_end(args);
        return result;
    }

    jobject NewObjectV(jclass clazz, jmethodID methodID, va_list args)
    { return functions->NewObjectV(this, clazz, methodID, args); }

    jobject NewObjectA(jclass clazz, jmethodID methodID, jvalue* args)
    { return functions->NewObjectA(this, clazz, methodID, args); }

    jclass GetObjectClass(jobject obj)
    { return functions->GetObjectClass(this, obj); }

    jboolean IsInstanceOf(jobject obj, jclass clazz)
    { return functions->IsInstanceOf(this, obj, clazz); }

    jmethodID GetMethodID(jclass clazz, const char* name, const char* sig)
    { return functions->GetMethodID(this, clazz, name, sig); }

#define CALL_TYPE_METHOD(_jtype, _jname)                                    \
    _jtype Call##_jname##Method(jobject obj, jmethodID methodID, ...)       \
    {                                                                       \
        _jtype result;                                                      \
        va_list args;                                                       \
        va_start(args, methodID);                                           \
        result = functions->Call##_jname##MethodV(this, obj, methodID,      \
                    args);                                                  \
        va_end(args);                                                       \
        return result;                                                      \
    }
#define CALL_TYPE_METHODV(_jtype, _jname)                                   \
    _jtype Call##_jname##MethodV(jobject obj, jmethodID methodID,           \
        va_list args)                                                       \
    { return functions->Call##_jname##MethodV(this, obj, methodID, args); }
#define CALL_TYPE_METHODA(_jtype, _jname)                                   \
    _jtype Call##_jname##MethodA(jobject obj, jmethodID methodID,           \
        jvalue* args)                                                       \
    { return functions->Call##_jname##MethodA(this, obj, methodID, args); }

#define CALL_TYPE(_jtype, _jname)                                           \
    CALL_TYPE_METHOD(_jtype, _jname)                                        \
    CALL_TYPE_METHODV(_jtype, _jname)                                       \
    CALL_TYPE_METHODA(_jtype, _jname)

    CALL_TYPE(jobject, Object)
    CALL_TYPE(jboolean, Boolean)
    CALL_TYPE(jbyte, Byte)
    CALL_TYPE(jchar, Char)
    CALL_TYPE(jshort, Short)
    CALL_TYPE(jint, Int)
    CALL_TYPE(jlong, Long)
    CALL_TYPE(jfloat, Float)
    CALL_TYPE(jdouble, Double)

    void CallVoidMethod(jobject obj, jmethodID methodID, ...)
    {
        va_list args;
        va_start(args, methodID);
        functions->CallVoidMethodV(this, obj, methodID, args);
        va_end(args);
    }
    void CallVoidMethodV(jobject obj, jmethodID methodID, va_list args)
    { functions->CallVoidMethodV(this, obj, methodID, args); }
    void CallVoidMethodA(jobject obj, jmethodID methodID, jvalue* args)
    { functions->CallVoidMethodA(this, obj, methodID, args); }

#define CALL_NONVIRT_TYPE_METHOD(_jtype, _jname)                            \
    _jtype CallNonvirtual##_jname##Method(jobject obj, jclass clazz,        \
        jmethodID methodID, ...)                                            \
    {                                                                       \
        _jtype result;                                                      \
        va_list args;                                                       \
        va_start(args, methodID);                                           \
        result = functions->CallNonvirtual##_jname##MethodV(this, obj,      \
                    clazz, methodID, args);                                 \
        va_end(args);                                                       \
        return result;                                                      \
    }
#define CALL_NONVIRT_TYPE_METHODV(_jtype, _jname)                           \
    _jtype CallNonvirtual##_jname##MethodV(jobject obj, jclass clazz,       \
        jmethodID methodID, va_list args)                                   \
    { return functions->CallNonvirtual##_jname##MethodV(this, obj, clazz,   \
        methodID, args); }
#define CALL_NONVIRT_TYPE_METHODA(_jtype, _jname)                           \
    _jtype CallNonvirtual##_jname##MethodA(jobject obj, jclass clazz,       \
        jmethodID methodID, jvalue* args)                                   \
    { return functions->CallNonvirtual##_jname##MethodA(this, obj, clazz,   \
        methodID, args); }

#define CALL_NONVIRT_TYPE(_jtype, _jname)                                   \
    CALL_NONVIRT_TYPE_METHOD(_jtype, _jname)                                \
    CALL_NONVIRT_TYPE_METHODV(_jtype, _jname)                               \
    CALL_NONVIRT_TYPE_METHODA(_jtype, _jname)

    CALL_NONVIRT_TYPE(jobject, Object)
    CALL_NONVIRT_TYPE(jboolean, Boolean)
    CALL_NONVIRT_TYPE(jbyte, Byte)
    CALL_NONVIRT_TYPE(jchar, Char)
    CALL_NONVIRT_TYPE(jshort, Short)
    CALL_NONVIRT_TYPE(jint, Int)
    CALL_NONVIRT_TYPE(jlong, Long)
    CALL_NONVIRT_TYPE(jfloat, Float)
    CALL_NONVIRT_TYPE(jdouble, Double)

    void CallNonvirtualVoidMethod(jobject obj, jclass clazz,
        jmethodID methodID, ...)
    {
        va_list args;
        va_start(args, methodID);
        functions->CallNonvirtualVoidMethodV(this, obj, clazz, methodID, args);
        va_end(args);
    }
    void CallNonvirtualVoidMethodV(jobject obj, jclass clazz,
        jmethodID methodID, va_list args)
    { functions->CallNonvirtualVoidMethodV(this, obj, clazz, methodID, args); }
    void CallNonvirtualVoidMethodA(jobject obj, jclass clazz,
        jmethodID methodID, jvalue* args)
    { functions->CallNonvirtualVoidMethodA(this, obj, clazz, methodID, args); }

    jfieldID GetFieldID(jclass clazz, const char* name, const char* sig)
    { return functions->GetFieldID(this, clazz, name, sig); }

    jobject GetObjectField(jobject obj, jfieldID fieldID)
    { return functions->GetObjectField(this, obj, fieldID); }
    jboolean GetBooleanField(jobject obj, jfieldID fieldID)
    { return functions->GetBooleanField(this, obj, fieldID); }
    jbyte GetByteField(jobject obj, jfieldID fieldID)
    { return functions->GetByteField(this, obj, fieldID); }
    jchar GetCharField(jobject obj, jfieldID fieldID)
    { return functions->GetCharField(this, obj, fieldID); }
    jshort GetShortField(jobject obj, jfieldID fieldID)
    { return functions->GetShortField(this, obj, fieldID); }
    jint GetIntField(jobject obj, jfieldID fieldID)
    { return functions->GetIntField(this, obj, fieldID); }
    jlong GetLongField(jobject obj, jfieldID fieldID)
    { return functions->GetLongField(this, obj, fieldID); }
    jfloat GetFloatField(jobject obj, jfieldID fieldID)
    { return functions->GetFloatField(this, obj, fieldID); }
    jdouble GetDoubleField(jobject obj, jfieldID fieldID)
    { return functions->GetDoubleField(this, obj, fieldID); }

    void SetObjectField(jobject obj, jfieldID fieldID, jobject value)
    { functions->SetObjectField(this, obj, fieldID, value); }
    void SetBooleanField(jobject obj, jfieldID fieldID, jboolean value)
    { functions->SetBooleanField(this, obj, fieldID, value); }
    void SetByteField(jobject obj, jfieldID fieldID, jbyte value)
    { functions->SetByteField(this, obj, fieldID, value); }
    void SetCharField(jobject obj, jfieldID fieldID, jchar value)
    { functions->SetCharField(this, obj, fieldID, value); }
    void SetShortField(jobject obj, jfieldID fieldID, jshort value)
    { functions->SetShortField(this, obj, fieldID, value); }
    void SetIntField(jobject obj, jfieldID fieldID, jint value)
    { functions->SetIntField(this, obj, fieldID, value); }
    void SetLongField(jobject obj, jfieldID fieldID, jlong value)
    { functions->SetLongField(this, obj, fieldID, value); }
    void SetFloatField(jobject obj, jfieldID fieldID, jfloat value)
    { functions->SetFloatField(this, obj, fieldID, value); }
    void SetDoubleField(jobject obj, jfieldID fieldID, jdouble value)
    { functions->SetDoubleField(this, obj, fieldID, value); }

    jmethodID GetStaticMethodID(jclass clazz, const char* name, const char* sig)
    { return functions->GetStaticMethodID(this, clazz, name, sig); }

#define CALL_STATIC_TYPE_METHOD(_jtype, _jname)                             \
    _jtype CallStatic##_jname##Method(jclass clazz, jmethodID methodID,     \
        ...)                                                                \
    {                                                                       \
        _jtype result;                                                      \
        va_list args;                                                       \
        va_start(args, methodID);                                           \
        result = functions->CallStatic##_jname##MethodV(this, clazz,        \
                    methodID, args);                                        \
        va_end(args);                                                       \
        return result;                                                      \
    }
#define CALL_STATIC_TYPE_METHODV(_jtype, _jname)                            \
    _jtype CallStatic##_jname##MethodV(jclass clazz, jmethodID methodID,    \
        va_list args)                                                       \
    { return functions->CallStatic##_jname##MethodV(this, clazz, methodID,  \
        args); }
#define CALL_STATIC_TYPE_METHODA(_jtype, _jname)                            \
    _jtype CallStatic##_jname##MethodA(jclass clazz, jmethodID methodID,    \
        jvalue* args)                                                       \
    { return functions->CallStatic##_jname##MethodA(this, clazz, methodID,  \
        args); }

#define CALL_STATIC_TYPE(_jtype, _jname)                                    \
    CALL_STATIC_TYPE_METHOD(_jtype, _jname)                                 \
    CALL_STATIC_TYPE_METHODV(_jtype, _jname)                                \
    CALL_STATIC_TYPE_METHODA(_jtype, _jname)

    CALL_STATIC_TYPE(jobject, Object)
    CALL_STATIC_TYPE(jboolean, Boolean)
    CALL_STATIC_TYPE(jbyte, Byte)
    CALL_STATIC_TYPE(jchar, Char)
    CALL_STATIC_TYPE(jshort, Short)
    CALL_STATIC_TYPE(jint, Int)
    CALL_STATIC_TYPE(jlong, Long)
    CALL_STATIC_TYPE(jfloat, Float)
    CALL_STATIC_TYPE(jdouble, Double)

    void CallStaticVoidMethod(jclass clazz, jmethodID methodID, ...)
    {
        va_list args;
        va_start(args, methodID);
        functions->CallStaticVoidMethodV(this, clazz, methodID, args);
        va_end(args);
    }
    void CallStaticVoidMethodV(jclass clazz, jmethodID methodID, va_list args)
    { functions->CallStaticVoidMethodV(this, clazz, methodID, args); }
    void CallStaticVoidMethodA(jclass clazz, jmethodID methodID, jvalue* args)
    { functions->CallStaticVoidMethodA(this, clazz, methodID, args); }

    jfieldID GetStaticFieldID(jclass clazz, const char* name, const char* sig)
    { return functions->GetStaticFieldID(this, clazz, name, sig); }

    jobject GetStaticObjectField(jclass clazz, jfieldID fieldID)
    { return functions->GetStaticObjectField(this, clazz, fieldID); }
    jboolean GetStaticBooleanField(jclass clazz, jfieldID fieldID)
    { return functions->GetStaticBooleanField(this, clazz, fieldID); }
    jbyte GetStaticByteField(jclass clazz, jfieldID fieldID)
    { return functions->GetStaticByteField(this, clazz, fieldID); }
    jchar GetStaticCharField(jclass clazz, jfieldID fieldID)
    { return functions->GetStaticCharField(this, clazz, fieldID); }
    jshort GetStaticShortField(jclass clazz, jfieldID fieldID)
    { return functions->GetStaticShortField(this, clazz, fieldID); }
    jint GetStaticIntField(jclass clazz, jfieldID fieldID)
    { return functions->GetStaticIntField(this, clazz, fieldID); }
    jlong GetStaticLongField(jclass clazz, jfieldID fieldID)
    { return functions->GetStaticLongField(this, clazz, fieldID); }
    jfloat GetStaticFloatField(jclass clazz, jfieldID fieldID)
    { return functions->GetStaticFloatField(this, clazz, fieldID); }
    jdouble GetStaticDoubleField(jclass clazz, jfieldID fieldID)
    { return functions->GetStaticDoubleField(this, clazz, fieldID); }

    void SetStaticObjectField(jclass clazz, jfieldID fieldID, jobject value)
    { functions->SetStaticObjectField(this, clazz, fieldID, value); }
    void SetStaticBooleanField(jclass clazz, jfieldID fieldID, jboolean value)
    { functions->SetStaticBooleanField(this, clazz, fieldID, value); }
    void SetStaticByteField(jclass clazz, jfieldID fieldID, jbyte value)
    { functions->SetStaticByteField(this, clazz, fieldID, value); }
    void SetStaticCharField(jclass clazz, jfieldID fieldID, jchar value)
    { functions->SetStaticCharField(this, clazz, fieldID, value); }
    void SetStaticShortField(jclass clazz, jfieldID fieldID, jshort value)
    { functions->SetStaticShortField(this, clazz, fieldID, value); }
    void SetStaticIntField(jclass clazz, jfieldID fieldID, jint value)
    { functions->SetStaticIntField(this, clazz, fieldID, value); }
    void SetStaticLongField(jclass clazz, jfieldID fieldID, jlong value)
    { functions->SetStaticLongField(this, clazz, fieldID, value); }
    void SetStaticFloatField(jclass clazz, jfieldID fieldID, jfloat value)
    { functions->SetStaticFloatField(this, clazz, fieldID, value); }
    void SetStaticDoubleField(jclass clazz, jfieldID fieldID, jdouble value)
    { functions->SetStaticDoubleField(this, clazz, fieldID, value); }

    jstring NewString(const jchar* unicodeChars, jsize len)
    { return functions->NewString(this, unicodeChars, len); }

    jsize GetStringLength(jstring string)
    { return functions->GetStringLength(this, string); }

    const jchar* GetStringChars(jstring string, jboolean* isCopy)
    { return functions->GetStringChars(this, string, isCopy); }

    void ReleaseStringChars(jstring string, const jchar* chars)
    { functions->ReleaseStringChars(this, string, chars); }

    jstring NewStringUTF(const char* bytes)
    { return functions->NewStringUTF(this, bytes); }

    jsize GetStringUTFLength(jstring string)
    { return functions->GetStringUTFLength(this, string); }

    const char* GetStringUTFChars(jstring string, jboolean* isCopy)
    { return functions->GetStringUTFChars(this, string, isCopy); }

    void ReleaseStringUTFChars(jstring string, const char* utf)
    { functions->ReleaseStringUTFChars(this, string, utf); }

    jsize GetArrayLength(jarray array)
    { return functions->GetArrayLength(this, array); }

    jobjectArray NewObjectArray(jsize length, jclass elementClass,
        jobject initialElement)
    { return functions->NewObjectArray(this, length, elementClass,
        initialElement); }

    jobject GetObjectArrayElement(jobjectArray array, jsize index)
    { return functions->GetObjectArrayElement(this, array, index); }

    void SetObjectArrayElement(jobjectArray array, jsize index, jobject value)
    { functions->SetObjectArrayElement(this, array, index, value); }

    jbooleanArray NewBooleanArray(jsize length)
    { return functions->NewBooleanArray(this, length); }
    jbyteArray NewByteArray(jsize length)
    { return functions->NewByteArray(this, length); }
    jcharArray NewCharArray(jsize length)
    { return functions->NewCharArray(this, length); }
    jshortArray NewShortArray(jsize length)
    { return functions->NewShortArray(this, length); }
    jintArray NewIntArray(jsize length)
    { return functions->NewIntArray(this, length); }
    jlongArray NewLongArray(jsize length)
    { return functions->NewLongArray(this, length); }
    jfloatArray NewFloatArray(jsize length)
    { return functions->NewFloatArray(this, length); }
    jdoubleArray NewDoubleArray(jsize length)
    { return functions->NewDoubleArray(this, length); }

    jboolean* GetBooleanArrayElements(jbooleanArray array, jboolean* isCopy)
    { return functions->GetBooleanArrayElements(this, array, isCopy); }
    jbyte* GetByteArrayElements(jbyteArray array, jboolean* isCopy)
    { return functions->GetByteArrayElements(this, array, isCopy); }
    jchar* GetCharArrayElements(jcharArray array, jboolean* isCopy)
    { return functions->GetCharArrayElements(this, array, isCopy); }
    jshort* GetShortArrayElements(jshortArray array, jboolean* isCopy)
    { return functions->GetShortArrayElements(this, array, isCopy); }
    jint* GetIntArrayElements(jintArray array, jboolean* isCopy)
    { return functions->GetIntArrayElements(this, array, isCopy); }
    jlong* GetLongArrayElements(jlongArray array, jboolean* isCopy)
    { return functions->GetLongArrayElements(this, array, isCopy); }
    jfloat* GetFloatArrayElements(jfloatArray array, jboolean* isCopy)
    { return functions->GetFloatArrayElements(this, array, isCopy); }
    jdouble* GetDoubleArrayElements(jdoubleArray array, jboolean* isCopy)
    { return functions->GetDoubleArrayElements(this, array, isCopy); }

    void ReleaseBooleanArrayElements(jbooleanArray array, jboolean* elems,
        jint mode)
    { functions->ReleaseBooleanArrayElements(this, array, elems, mode); }
    void ReleaseByteArrayElements(jbyteArray array, jbyte* elems,
        jint mode)
    { functions->ReleaseByteArrayElements(this, array, elems, mode); }
    void ReleaseCharArrayElements(jcharArray array, jchar* elems,
        jint mode)
    { functions->ReleaseCharArrayElements(this, array, elems, mode); }
    void ReleaseShortArrayElements(jshortArray array, jshort* elems,
        jint mode)
    { functions->ReleaseShortArrayElements(this, array, elems, mode); }
    void ReleaseIntArrayElements(jintArray array, jint* elems,
        jint mode)
    { functions->ReleaseIntArrayElements(this, array, elems, mode); }
    void ReleaseLongArrayElements(jlongArray array, jlong* elems,
        jint mode)
    { functions->ReleaseLongArrayElements(this, array, elems, mode); }
    void ReleaseFloatArrayElements(jfloatArray array, jfloat* elems,
        jint mode)
    { functions->ReleaseFloatArrayElements(this, array, elems, mode); }
    void ReleaseDoubleArrayElements(jdoubleArray array, jdouble* elems,
        jint mode)
    { functions->ReleaseDoubleArrayElements(this, array, elems, mode); }

    void GetBooleanArrayRegion(jbooleanArray array, jsize start, jsize len,
        jboolean* buf)
    { functions->GetBooleanArrayRegion(this, array, start, len, buf); }
    void GetByteArrayRegion(jbyteArray array, jsize start, jsize len,
        jbyte* buf)
    { functions->GetByteArrayRegion(this, array, start, len, buf); }
    void GetCharArrayRegion(jcharArray array, jsize start, jsize len,
        jchar* buf)
    { functions->GetCharArrayRegion(this, array, start, len, buf); }
    void GetShortArrayRegion(jshortArray array, jsize start, jsize len,
        jshort* buf)
    { functions->GetShortArrayRegion(this, array, start, len, buf); }
    void GetIntArrayRegion(jintArray array, jsize start, jsize len,
        jint* buf)
    { functions->GetIntArrayRegion(this, array, start, len, buf); }
    void GetLongArrayRegion(jlongArray array, jsize start, jsize len,
        jlong* buf)
    { functions->GetLongArrayRegion(this, array, start, len, buf); }
    void GetFloatArrayRegion(jfloatArray array, jsize start, jsize len,
        jfloat* buf)
    { functions->GetFloatArrayRegion(this, array, start, len, buf); }
    void GetDoubleArrayRegion(jdoubleArray array, jsize start, jsize len,
        jdouble* buf)
    { functions->GetDoubleArrayRegion(this, array, start, len, buf); }

    void SetBooleanArrayRegion(jbooleanArray array, jsize start, jsize len,
        const jboolean* buf)
    { functions->SetBooleanArrayRegion(this, array, start, len, buf); }
    void SetByteArrayRegion(jbyteArray array, jsize start, jsize len,
        const jbyte* buf)
    { functions->SetByteArrayRegion(this, array, start, len, buf); }
    void SetCharArrayRegion(jcharArray array, jsize start, jsize len,
        const jchar* buf)
    { functions->SetCharArrayRegion(this, array, start, len, buf); }
    void SetShortArrayRegion(jshortArray array, jsize start, jsize len,
        const jshort* buf)
    { functions->SetShortArrayRegion(this, array, start, len, buf); }
    void SetIntArrayRegion(jintArray array, jsize start, jsize len,
        const jint* buf)
    { functions->SetIntArrayRegion(this, array, start, len, buf); }
    void SetLongArrayRegion(jlongArray array, jsize start, jsize len,
        const jlong* buf)
    { functions->SetLongArrayRegion(this, array, start, len, buf); }
    void SetFloatArrayRegion(jfloatArray array, jsize start, jsize len,
        const jfloat* buf)
    { functions->SetFloatArrayRegion(this, array, start, len, buf); }
    void SetDoubleArrayRegion(jdoubleArray array, jsize start, jsize len,
        const jdouble* buf)
    { functions->SetDoubleArrayRegion(this, array, start, len, buf); }

    jint RegisterNatives(jclass clazz, const JNINativeMethod* methods,
        jint nMethods)
    { return functions->RegisterNatives(this, clazz, methods, nMethods); }

    jint UnregisterNatives(jclass clazz)
    { return functions->UnregisterNatives(this, clazz); }

    jint MonitorEnter(jobject obj)
    { return functions->MonitorEnter(this, obj); }

    jint MonitorExit(jobject obj)
    { return functions->MonitorExit(this, obj); }

    jint GetJavaVM(JavaVM** vm)
    { return functions->GetJavaVM(this, vm); }

    void GetStringRegion(jstring str, jsize start, jsize len, jchar* buf)
    { functions->GetStringRegion(this, str, start, len, buf); }

    void GetStringUTFRegion(jstring str, jsize start, jsize len, char* buf)
    { return functions->GetStringUTFRegion(this, str, start, len, buf); }

    void* GetPrimitiveArrayCritical(jarray array, jboolean* isCopy)
    { return functions->GetPrimitiveArrayCritical(this, array, isCopy); }

    void ReleasePrimitiveArrayCritical(jarray array, void* carray, jint mode)
    { functions->ReleasePrimitiveArrayCritical(this, array, carray, mode); }

    const jchar* GetStringCritical(jstring string, jboolean* isCopy)
    { return functions->GetStringCritical(this, string, isCopy); }

    void ReleaseStringCritical(jstring string, const jchar* carray)
    { functions->ReleaseStringCritical(this, string, carray); }

    jweak NewWeakGlobalRef(jobject obj)
    { return functions->NewWeakGlobalRef(this, obj); }

    void DeleteWeakGlobalRef(jweak obj)
    { functions->DeleteWeakGlobalRef(this, obj); }

    jboolean ExceptionCheck()
    { return functions->ExceptionCheck(this); }

    jobject NewDirectByteBuffer(void* address, jlong capacity)
    { return functions->NewDirectByteBuffer(this, address, capacity); }

    void* GetDirectBufferAddress(jobject buf)
    { return functions->GetDirectBufferAddress(this, buf); }

    jlong GetDirectBufferCapacity(jobject buf)
    { return functions->GetDirectBufferCapacity(this, buf); }

    /* added in JNI 1.6 */
    jobjectRefType GetObjectRefType(jobject obj)
    { return functions->GetObjectRefType(this, obj); }
#endif /*__cplusplus*/
};


/*
 * JNI invocation interface.
 */
struct JNIInvokeInterface {
    void*       reserved0;
    void*       reserved1;
    void*       reserved2;

    jint        (*DestroyJavaVM)(JavaVM*);
    jint        (*AttachCurrentThread)(JavaVM*, JNIEnv**, void*);
    jint        (*DetachCurrentThread)(JavaVM*);
    jint        (*GetEnv)(JavaVM*, void**, jint);
    jint        (*AttachCurrentThreadAsDaemon)(JavaVM*, JNIEnv**, void*);
};

/*
 * C++ version.
 */
struct _JavaVM {
    const struct JNIInvokeInterface* functions;

#if defined(__cplusplus)
    jint DestroyJavaVM()
    { return functions->DestroyJavaVM(this); }
    jint AttachCurrentThread(JNIEnv** p_env, void* thr_args)
    { return functions->AttachCurrentThread(this, p_env, thr_args); }
    jint DetachCurrentThread()
    { return functions->DetachCurrentThread(this); }
    jint GetEnv(void** env, jint version)
    { return functions->GetEnv(this, env, version); }
    jint AttachCurrentThreadAsDaemon(JNIEnv** p_env, void* thr_args)
    { return functions->AttachCurrentThreadAsDaemon(this, p_env, thr_args); }
#endif /*__cplusplus*/
};

struct JavaVMAttachArgs {
    jint        version;    /* must be >= JNI_VERSION_1_2 */
    const char* name;       /* NULL or name of thread as modified UTF-8 str */
    jobject     group;      /* global ref of a ThreadGroup object, or NULL */
};
typedef struct JavaVMAttachArgs JavaVMAttachArgs;

/*
 * JNI 1.2+ initialization.  (As of 1.6, the pre-1.2 structures are no
 * longer supported.)
 */
typedef struct JavaVMOption {
    const char* optionString;
    void*       extraInfo;
} JavaVMOption;

typedef struct JavaVMInitArgs {
    jint        version;    /* use JNI_VERSION_1_2 or later */

    jint        nOptions;
    JavaVMOption* options;
    jboolean    ignoreUnrecognized;
} JavaVMInitArgs;

#ifdef __cplusplus
extern "C" {
#endif
/*
 * VM initialization functions.
 *
 * Note these are the only symbols exported for JNI by the VM.
 */
jint JNI_GetDefaultJavaVMInitArgs(void*);
jint JNI_CreateJavaVM(JavaVM**, JNIEnv**, void*);
jint JNI_GetCreatedJavaVMs(JavaVM**, jsize, jsize*);

#define JNIIMPORT
#define JNIEXPORT  __attribute__ ((visibility ("default")))
#define JNICALL

/*
 * Prototypes for functions exported by loadable shared libs.  These are
 * called by JNI, not provided by JNI.
 */
JNIEXPORT jint JNI_OnLoad(JavaVM* vm, void* reserved);
JNIEXPORT void JNI_OnUnload(JavaVM* vm, void* reserved);

#ifdef __cplusplus
}
#endif


/*
 * Manifest constants.
 */
#define JNI_FALSE   0
#define JNI_TRUE    1

#define JNI_VERSION_1_1 0x00010001
#define JNI_VERSION_1_2 0x00010002
#define JNI_VERSION_1_4 0x00010004
#define JNI_VERSION_1_6 0x00010006

#define JNI_OK          (0)         /* no error */
#define JNI_ERR         (-1)        /* generic error */
#define JNI_EDETACHED   (-2)        /* thread detached from the VM */
#define JNI_EVERSION    (-3)        /* JNI version error */

#define JNI_COMMIT      1           /* copy content, do not free buffer */
#define JNI_ABORT       2           /* free buffer w/o copying back */

#endif  /* JNI_H_ */
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */
const path = require('path');
const tmp = require('tmp');
const fs = require('fs-extra');
const builder = require('electron-builder');
const Platform = builder.Platform;
const metro = require('../static/node_modules/metro');
const compilePlugins = require('../static/compilePlugins');

function generateManifest(versionNumber) {
  const filePath = path.join(__dirname, '..', 'dist');
  if (!fs.existsSync(filePath)) {
    fs.mkdirSync(filePath);
  }
  fs.writeFileSync(
    path.join(__dirname, '../dist/manifest.json'),
    JSON.stringify({
      package: 'com.facebook.sonar',
      version_name: versionNumber,
    }),
  );
}

function buildFolder() {
  // eslint-disable-next-line no-console
  console.log('Creating build directory');
  return new Promise((resolve, reject) => {
    tmp.dir((err, buildFolder) => {
      if (err) {
        reject(err);
      } else {
        resolve(buildFolder);
      }
    });
  }).catch(die);
}

function modifyPackageManifest(buildFolder) {
  // eslint-disable-next-line no-console
  console.log('Creating package.json manifest');
  const manifest = require('../package.json');
  const manifestStatic = require('../static/package.json');

  // The manifest's dependencies are bundled with the final app by
  // electron-builder. We want to bundle the dependencies from the static-folder
  // because all dependencies from the root-folder are already bundled by metro.
  manifest.dependencies = manifestStatic.dependencies;
  manifest.main = 'index.js';

  const buildNumber = process.argv.join(' ').match(/--version=(\d+)/);
  if (buildNumber && buildNumber.length > 0) {
    manifest.version = [
      ...manifest.version.split('.').slice(0, 2),
      buildNumber[1],
    ].join('.');
  }

  return new Promise((resolve, reject) => {
    fs.writeFile(
      path.join(buildFolder, 'package.json'),
      JSON.stringify(manifest, null, '  '),
      err => {
        if (err) {
          reject(err);
        } else {
          resolve(manifest.version);
        }
      },
    );
  }).catch(die);
}

function buildDist(buildFolder) {
  const targetsRaw = [];

  if (process.argv.indexOf('--mac') > -1) {
    targetsRaw.push(Platform.MAC.createTarget(['zip']));
  }
  if (process.argv.indexOf('--linux') > -1) {
    targetsRaw.push(Platform.LINUX.createTarget(['zip']));
  }
  if (process.argv.indexOf('--win') > -1) {
    targetsRaw.push(Platform.WINDOWS.createTarget(['zip']));
  }
  if (!targetsRaw.length) {
    throw new Error('No targets specified. eg. --mac, --win, or --linux');
  }

  // merge all target maps into a single map
  let targetsMerged = [];
  for (const target of targetsRaw) {
    targetsMerged = targetsMerged.concat(Array.from(target));
  }
  const targets = new Map(targetsMerged);

  const electronDownload = {};
  if (process.env.electron_config_cache) {
    electronDownload.cache = process.env.electron_config_cache;
  }

  return builder
    .build({
      appDir: buildFolder,
      config: {
        appId: `com.facebook.sonar`,
        directories: {
          buildResources: path.join(__dirname, '..', 'static'),
          output: path.join(__dirname, '..', 'dist'),
        },
        electronDownload,
        npmRebuild: false,
        asarUnpack: 'PortForwardingMacApp.app/**/*',
      },
      projectDir: buildFolder,
      targets,
    })
    .catch(die);
}

function die(err) {
  console.error(err.stack);
  process.exit(1);
}

function compile(buildFolder) {
  // eslint-disable-next-line no-console
  console.log(
    'Building main bundle',
    path.join(__dirname, '..', 'src', 'init.js'),
  );
  return metro
    .runBuild({
      config: {
        getProjectRoots: () => [path.join(__dirname, '..')],
        getTransformModulePath: () =>
          path.join(__dirname, '..', 'static', 'transforms', 'index.js'),
      },
      resetCache: true,
      dev: false,
      entry: path.join(__dirname, '..', 'src', 'init.js'),
      out: path.join(buildFolder, 'bundle.js'),
    })
    .catch(die);
}

function copyStaticFolder(buildFolder) {
  return new Promise((resolve, reject) => {
    fs.copy(
      path.join(__dirname, '..', 'static'),
      buildFolder,
      {
        dereference: true,
      },
      err => {
        if (err) {
          reject(err);
        } else {
          resolve();
        }
      },
    );
  }).catch(die);
}

function compileDefaultPlugins(buildFolder) {
  const defaultPluginFolder = 'defaultPlugins';
  const defaultPluginDir = path.join(buildFolder, defaultPluginFolder);
  return compilePlugins(
    null,
    [
      path.join(__dirname, '..', 'src', 'plugins'),
      path.join(__dirname, '..', 'src', 'fb', 'plugins'),
    ],
    defaultPluginDir,
  ).then(defaultPlugins =>
    fs.writeFileSync(
      path.join(defaultPluginDir, 'index.json'),
      JSON.stringify(
        defaultPlugins.map(plugin => ({
          ...plugin,
          out: path.join(defaultPluginFolder, path.parse(plugin.out).base),
        })),
      ),
    ),
  );
}

(async () => {
  const dir = await buildFolder();
  // eslint-disable-next-line no-console
  console.log('Created build directory', dir);
  await copyStaticFolder(dir);
  await compileDefaultPlugins(dir);
  await compile(dir);
  const versionNumber = await modifyPackageManifest(dir);
  generateManifest(versionNumber);
  await buildDist(dir);
  // eslint-disable-next-line no-console
  console.log('✨  Done');
  process.exit();
})();
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

const generate = require('babel-generator').default;
const babylon = require('babylon');
const babel = require('babel-core');
const metro = require('metro');

exports.transform = function({
  filename,
  options,
  src,
  plugins: defaultPlugins,
}) {
  const presets = [];

  let ast = babylon.parse(src, {
    filename,
    plugins: ['jsx', 'flow', 'classProperties', 'objectRestSpread'],
    sourceType: filename.includes('node_modules') ? 'script' : 'module',
  });

  // run babel
  const plugins = [
    ...defaultPlugins,
    require('./babel-plugins/electron-requires.js'),
    require('./babel-plugins/dynamic-requires.js'),
  ];
  if (!filename.includes('node_modules')) {
    plugins.unshift(require('babel-plugin-transform-es2015-modules-commonjs'));
  }
  ast = babel.transformFromAst(ast, src, {
    babelrc: !filename.includes('node_modules'),
    code: false,
    comments: false,
    compact: false,
    filename,
    plugins,
    presets,
    sourceMaps: true,
  }).ast;

  const result = generate(
    ast,
    {
      filename,
      sourceFileName: filename,
      sourceMaps: true,
    },
    src,
  );

  return {
    ast,
    code: result.code,
    filename,
    map: result.rawMappings.map(metro.sourceMaps.compactMapping),
  };
};
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */
const electronBinary = require('electron');
const codeFrame = require('babel-code-frame');
const socketIo = require('socket.io');
const express = require('express');
const detect = require('detect-port');
const child = require('child_process');
const Convert = require('ansi-to-html');
const chalk = require('chalk');
const http = require('http');
const path = require('path');
const metro = require('../static/node_modules/metro');
const fs = require('fs');

const convertAnsi = new Convert();

const DEFAULT_PORT = process.env.PORT || 3000;
const STATIC_DIR = path.join(__dirname, '..', 'static');

function launchElectron({bundleURL, electronURL}) {
  const args = [
    path.join(STATIC_DIR, 'index.js'),
    '--remote-debugging-port=9222',
    '--dynamicPlugins=~/fbsource/xplat/sonar/src/plugins,~/fbsource/xplat/sonar/src/fb/plugins',
  ];

  const proc = child.spawn(electronBinary, args, {
    cwd: STATIC_DIR,
    env: {
      ...process.env,
      SONAR_ROOT: process.cwd(),
      BUNDLE_URL: bundleURL,
      ELECTRON_URL: electronURL,
    },
    stdio: 'inherit',
  });

  proc.on('close', () => {
    process.exit();
  });

  process.on('exit', () => {
    proc.kill();
  });
}

function startMetroServer(port) {
  return metro.runServer({
    port,
    watch: true,
    config: {
      getProjectRoots: () => [path.join(__dirname, '..')],
      getTransformModulePath: () =>
        path.join(__dirname, '..', 'static', 'transforms', 'index.js'),
    },
  });
}

function startAssetServer(port) {
  const app = express();

  app.use((req, res, next) => {
    if (knownErrors[req.url] != null) {
      delete knownErrors[req.url];
      outputScreen();
    }
    next();
  });

  app.get('/', (req, res) => {
    fs.readFile(path.join(STATIC_DIR, 'index.dev.html'), (err, content) => {
      res.end(content);
    });
  });

  app.use(express.static(STATIC_DIR));

  app.use(function(err, req, res, next) {
    knownErrors[req.url] = err;
    outputScreen();
    res.status(500).send('Something broke, check the console!');
  });

  const server = http.createServer(app);

  return new Promise((resolve, reject) => {
    server.listen(port, () => resolve(server));
  });
}

function addWebsocket(server) {
  const io = socketIo(server);

  // notify connected clients that there's errors in the console
  io.on('connection', client => {
    if (hasErrors()) {
      client.emit('hasErrors', convertAnsi.toHtml(buildErrorScreen()));
    }
  });

  // refresh the app on changes to the src folder
  // this can be removed once metroServer notifies us about file changes
  fs.watch(path.join(__dirname, '..', 'src'), () => {
    io.emit('refresh');
  });

  return io;
}

const knownErrors = {};

function hasErrors() {
  return Object.keys(knownErrors).length > 0;
}

function buildErrorScreen() {
  const lines = [
    chalk.red(`✖ Found ${Object.keys(knownErrors).length} errors`),
    '',
  ];

  for (const url in knownErrors) {
    const err = knownErrors[url];

    if (err.filename != null && err.lineNumber != null && err.column != null) {
      lines.push(chalk.inverse(err.filename));
      lines.push();
      lines.push(err.message);
      lines.push(
        codeFrame(
          fs.readFileSync(err.filename, 'utf8'),
          err.lineNumber,
          err.column,
        ),
      );
    } else {
      lines.push(err.stack);
    }

    lines.push('');
  }

  return lines.join('\n');
}

function outputScreen(socket) {
  // output screen
  if (hasErrors()) {
    const errorScreen = buildErrorScreen();
    console.error(errorScreen);

    // notify live clients of errors
    socket.emit('hasErrors', convertAnsi.toHtml(errorScreen));
  } else {
    // eslint-disable-next-line no-console
    console.log(chalk.green('✔ No known errors'));
  }
}

(async () => {
  const assetServerPort = await detect(DEFAULT_PORT);
  const assetServer = await startAssetServer(assetServerPort);
  const socket = addWebsocket(assetServer);
  const metroServerPort = await detect(DEFAULT_PORT + 1);
  await startMetroServer(metroServerPort);
  outputScreen(socket);
  launchElectron({
    bundleURL: `http://localhost:${metroServerPort}/src/init.bundle`,
    electronURL: `http://localhost:${assetServerPort}/index.dev.html`,
  });
})();
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

const glob = require('glob');
const path = require('path');
const {spawn} = require('child_process');
const PACKAGES = ['static', 'src/plugins/*', 'src/fb/plugins/*'];
const YARN_PATH =
  process.argv.length > 2 ? path.join(__dirname, process.argv[2]) : 'yarn';

Promise.all(
  PACKAGES.map(
    pattern =>
      new Promise((resolve, reject) => {
        glob(
          path.join(__dirname, '..', pattern, 'package.json'),
          (err, matches) => {
            if (err) {
              reject(err);
            } else {
              resolve(matches);
            }
          },
        );
      }),
  ),
)
  .then(packages =>
    Promise.all(
      packages.reduce((acc, cv) => acc.concat(cv), []).map(
        pkg =>
          new Promise(resolve => {
            const cwd = pkg.replace('/package.json', '');
            const yarn = spawn(YARN_PATH, ['--mutex', 'file'], {
              cwd,
            });
            yarn.stderr.on('data', e => console.error(e.toString()));
            yarn.on('close', code => resolve(code));
          }),
      ),
    ),
  )
  // eslint-disable-next-line
  .then(() => console.log('📦  Installed all dependencies!'));
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */
import {ErrorBoundary, FlexColumn, FlexRow} from 'sonar';
import {connect} from 'react-redux';
import {toggleBugDialogVisible} from './reducers/application.js';
import {setupMenu, activateMenuItems} from './MenuBar.js';
import {devicePlugins} from './device-plugins/index.js';
import WelcomeScreen from './chrome/WelcomeScreen.js';
import SonarTitleBar from './chrome/SonarTitleBar.js';
import BaseDevice from './devices/BaseDevice.js';
import MainSidebar from './chrome/MainSidebar.js';
import {SonarBasePlugin} from './plugin.js';
import {Server, Client} from './server.js';
import * as reducers from './reducers.js';
import React from 'react';
import BugReporter from './fb-stubs/BugReporter.js';
import ErrorReporter from './fb-stubs/ErrorReporter.js';
import BugReporterDialog from './chrome/BugReporterDialog.js';
import ErrorBar from './chrome/ErrorBar.js';
import Logger from './fb-stubs/Logger.js';
import PluginContainer from './PluginContainer.js';
import PluginManager from './chrome/PluginManager.js';
const electron = require('electron');
const yargs = require('yargs');

export type {Client};

export type StatePluginInfo = {
  plugin: ?SonarBasePlugin<>,
  state: Object,
};

export type StateClientPlugins = {
  [pluginKey: string]: StatePluginInfo,
};

export type StatePlugins = {
  [appKey: string]: StateClientPlugins,
};

export type State = {
  activePluginKey: ?string,
  activeAppKey: ?string,
  plugins: StatePlugins,
  error: ?string,
  server: Server,
};

type Props = {
  devices: Array<BaseDevice>,
  leftSidebarVisible: boolean,
  bugDialogVisible: boolean,
  pluginManagerVisible: boolean,
  toggleBugDialogVisible: (visible?: boolean) => void,
};

export class App extends React.Component<Props, State> {
  constructor() {
    performance.mark('init');
    super();
    this.initTracking();

    this.logger = new Logger();

    this.state = {
      activeAppKey: null,
      activePluginKey: null,
      error: null,
      devices: {},
      plugins: {},
      server: this.initServer(),
    };

    this.errorReporter = new ErrorReporter(this.logger.scribeLogger);
    this.bugReporter = new BugReporter(this.logger);
    this.commandLineArgs = yargs.parse(electron.remote.process.argv);

    setupMenu(this.sendKeyboardAction);
  }

  errorReporter: ErrorReporter;
  bugReporter: BugReporter;
  logger: Logger;
  commandLineArgs: Object;
  _hasActivatedPreferredPlugin: boolean = false;

  componentDidMount() {
    this.logger.trackTimeSince('init');

    // close socket before reloading
    window.addEventListener('beforeunload', () => {
      this.state.server.close();
    });
  }

  componentDidUpdate(prevProps: Props) {
    if (prevProps.devices !== this.props.devices) {
      this.ensurePluginSelected();
    }
  }

  toJSON() {
    return null;
  }

  initServer(): Server {
    const server = new Server(this);

    server.addListener('new-client', client => {
      client.addListener('close', () => {
        this.setState(state =>
          reducers.TeardownClient(this, state, {appKey: client.id}),
        );
        if (this.state.activeAppKey === client.id) {
          setTimeout(this.ensurePluginSelected);
        }
      });

      client.addListener('plugins-change', () => {
        this.setState({}, this.ensurePluginSelected);
      });
    });

    server.addListener('clients-change', () => {
      this.setState({}, this.ensurePluginSelected);
    });

    server.addListener('error', err => {
      if (err.code === 'EADDRINUSE') {
        this.setState({
          error:
            "Couldn't start websocket server. " +
            'Looks like you have multiple copies of Sonar running.',
        });
      } else {
        // unknown error
        this.setState({
          error: err.message,
        });
      }
    });

    return server;
  }

  initTracking = () => {
    electron.ipcRenderer.on('trackUsage', () => {
      // check if there's a plugin currently active
      const {activeAppKey, activePluginKey} = this.state;
      if (activeAppKey == null || activePluginKey == null) {
        return;
      }

      // app plugins
      const client = this.getClient(activeAppKey);
      if (client) {
        this.logger.track('usage', 'ping', {
          app: client.query.app,
          device: client.query.device,
          os: client.query.os,
          plugin: activePluginKey,
        });
        return;
      }

      // device plugins
      const device: ?BaseDevice = this.getDevice(activeAppKey);
      if (device) {
        this.logger.track('usage', 'ping', {
          os: device.os,
          plugin: activePluginKey,
          device: device.title,
        });
      }
    });
  };

  sendKeyboardAction = (action: string) => {
    const {activeAppKey, activePluginKey} = this.state;

    if (activeAppKey != null && activePluginKey != null) {
      const clientPlugins = this.state.plugins[activeAppKey];
      const pluginInfo = clientPlugins && clientPlugins[activePluginKey];
      const plugin = pluginInfo && pluginInfo.plugin;
      if (plugin && typeof plugin.onKeyboardAction === 'function') {
        plugin.onKeyboardAction(action);
      }
    }
  };

  getDevice = (id: string): ?BaseDevice => {
    this.props.devices.find((device: BaseDevice) => device.serial === id);
  };

  ensurePluginSelected = () => {
    // check if we need to rehydrate this client as it may have been previously active
    const {activeAppKey, activePluginKey, server} = this.state;
    const {devices} = this.props;

    if (!this._hasActivatedPreferredPlugin) {
      for (const connection of server.connections.values()) {
        const {client} = connection;
        const {plugins} = client;

        for (const plugin of plugins) {
          if (plugin !== this.commandLineArgs.plugin) {
            continue;
          }

          this._hasActivatedPreferredPlugin = true;
          this.onActivatePlugin(client.id, plugin);
          return;
        }
      }

      if (devices.length > 0) {
        const device = devices[0];
        for (const plugin of devicePlugins) {
          if (plugin.id !== this.commandLineArgs.plugin) {
            continue;
          }

          this._hasActivatedPreferredPlugin = true;
          this.onActivatePlugin(device.serial, plugin.id);
          return;
        }
      }
    }

    if (activeAppKey != null && activePluginKey != null) {
      const client = this.getClient(activeAppKey);
      if (client != null && client.plugins.includes(activePluginKey)) {
        this.onActivatePlugin(client.id, activePluginKey);
        return;
      }

      const device: ?BaseDevice = this.getDevice(activeAppKey);
      if (device != null) {
        this.onActivatePlugin(device.serial, activePluginKey);
        return;
      }
    } else {
      // No plugin selected, let's select one
      const deviceList = ((Object.values(devices): any): Array<BaseDevice>);
      if (deviceList.length > 0) {
        const device = deviceList[0];
        this.onActivatePlugin(device.serial, devicePlugins[0].id);
        return;
      }

      const connections = Array.from(server.connections.values());
      if (connections.length > 0) {
        const client = connections[0].client;
        const plugins = client.plugins;
        if (plugins.length > 0) {
          this.onActivatePlugin(client.id, client.plugins[0]);
          return;
        }
      }
    }
  };

  getClient(appKey: ?string): ?Client {
    if (appKey == null) {
      return null;
    }

    const info = this.state.server.connections.get(appKey);
    if (info != null) {
      return info.client;
    }
  }

  onActivatePlugin = (appKey: string, pluginKey: string) => {
    activateMenuItems(pluginKey);

    this.setState(state =>
      reducers.ActivatePlugin(this, state, {
        appKey,
        pluginKey,
      }),
    );
  };

  render() {
    const {state} = this;
    const hasDevices =
      this.props.devices.length > 0 || state.server.connections.size > 0;
    let mainView = null;

    const {activeAppKey, activePluginKey} = state;
    if (activeAppKey != null && activePluginKey != null) {
      const clientPlugins = state.plugins[activeAppKey];
      const pluginInfo = clientPlugins && clientPlugins[activePluginKey];
      const plugin = pluginInfo && pluginInfo.plugin;
      if (plugin) {
        mainView = this.props.pluginManagerVisible ? (
          <PluginManager />
        ) : (
          <ErrorBoundary
            heading={`Plugin "${
              plugin.constructor.title
            }" encountered an error during render`}
            logger={this.logger}>
            <PluginContainer
              logger={this.logger}
              plugin={plugin}
              state={plugin.state}
            />
          </ErrorBoundary>
        );
      }
    }

    return (
      <FlexColumn fill={true}>
        <SonarTitleBar />
        {this.props.bugDialogVisible && (
          <BugReporterDialog
            bugReporter={this.bugReporter}
            close={() => this.props.toggleBugDialogVisible(false)}
          />
        )}
        {hasDevices ? (
          <FlexRow fill={true}>
            {this.props.leftSidebarVisible && (
              <MainSidebar
                activePluginKey={state.activePluginKey}
                activeAppKey={state.activeAppKey}
                devices={this.props.devices}
                server={state.server}
                onActivatePlugin={this.onActivatePlugin}
              />
            )}
            {mainView}
          </FlexRow>
        ) : this.props.pluginManagerVisible ? (
          <PluginManager />
        ) : (
          <WelcomeScreen />
        )}
        <ErrorBar text={state.error} />
      </FlexColumn>
    );
  }
}

export default connect(
  ({
    application: {pluginManagerVisible, bugDialogVisible, leftSidebarVisible},
    devices,
  }) => ({
    pluginManagerVisible,
    bugDialogVisible,
    leftSidebarVisible,
    devices,
  }),
  {toggleBugDialogVisible},
)(App);
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type {
  TableHighlightedRows,
  TableRows,
  TableColumnSizes,
  TableColumns,
} from 'sonar';
import {FlexColumn, Button} from 'sonar';
import textContent from './utils/textContent.js';
import createPaste from './utils/createPaste.js';
import {SonarPlugin, SearchableTable} from 'sonar';

type ID = string;

type RowData = {
  id: ID,
};

type Props<T> = {|
  title: string,
  id: string,
  icon: string,
  method: string,
  resetMethod?: string,
  columns: TableColumns,
  columnSizes: TableColumnSizes,
  renderSidebar: (row: T) => any,
  buildRow: (row: T) => any,
|};

type State<T> = {|
  rows: TableRows,
  datas: {[key: ID]: T},
  selectedIds: Array<ID>,
|};

type AppendAndUpdateAction<T> = {|type: 'AppendAndUpdate', datas: Array<T>|};
type ResetAndUpdateAction<T> = {|type: 'ResetAndUpdate', datas: Array<T>|};
type Actions<T> = AppendAndUpdateAction<T> | ResetAndUpdateAction<T>;

/**
 * createTablePlugin creates a Plugin class which handles fetching data from the client and
 * displaying in in a table. The table handles selection of items and rendering a sidebar where
 * more detailed information can be presented about the selected row.
 *
 * The plugin expects the be able to subscribe to the `method` argument and recieve either an array
 * of data objects or a single data object. Each data object represents a row in the table which is
 * build by calling the `buildRow` function argument.
 *
 * An optional resetMethod argument can be provided which will replace the current rows with the
 * data provided. This is useful when connecting to sonar for this first time, or reconnecting to
 * the client in an unknown state.
 */
export function createTablePlugin<T: RowData>(props: Props<T>) {
  return class extends SonarPlugin<State<T>, Actions<T>> {
    static title = props.title;
    static id = props.id;
    static icon = props.icon;
    static keyboardActions = ['clear', 'createPaste'];

    state = {
      rows: [],
      datas: {},
      selectedIds: [],
    };

    onKeyboardAction = (action: string) => {
      if (action === 'clear') {
        this.clear();
      } else if (action === 'createPaste') {
        this.createPaste();
      }
    };

    reducers = {
      AppendAndUpdate(state: State<T>, action: AppendAndUpdateAction<T>) {
        const newRows = [];
        const newData = {};

        for (const data of action.datas.reverse()) {
          if (data.id == null) {
            console.warn('The data sent did not contain an ID.');
          }
          if (this.state.datas[data.id] == null) {
            newData[data.id] = data;
            newRows.push(props.buildRow(data));
          }
        }
        return {
          datas: {...state.datas, ...newData},
          rows: [...state.rows, ...newRows],
        };
      },
      ResetAndUpdate(state: State<T>, action: ResetAndUpdateAction<T>) {
        const newRows = [];
        const newData = {};

        for (const data of action.datas.reverse()) {
          if (data.id == null) {
            console.warn('The data sent did not contain an ID.');
          }
          if (this.state.datas[data.id] == null) {
            newData[data.id] = data;
            newRows.push(props.buildRow(data));
          }
        }
        return {
          datas: newData,
          rows: newRows,
        };
      },
    };

    init() {
      this.client.subscribe(props.method, (data: T | Array<T>) => {
        this.dispatchAction({
          type: 'AppendAndUpdate',
          datas: data instanceof Array ? data : [data],
        });
      });
      if (props.resetMethod) {
        this.client.subscribe(props.resetMethod, (data: Array<T>) => {
          this.dispatchAction({
            type: 'ResetAndUpdate',
            datas: data instanceof Array ? data : [],
          });
        });
      }
    }

    clear = () => {
      this.setState({
        datas: {},
        rows: [],
        selectedIds: [],
      });
    };

    createPaste = () => {
      let paste = '';
      const mapFn = row =>
        Object.keys(props.columns)
          .map(key => textContent(row.columns[key].value))
          .join('\t');

      if (this.state.selectedIds.length > 0) {
        // create paste from selection
        paste = this.state.rows
          .filter(row => this.state.selectedIds.indexOf(row.key) > -1)
          .map(mapFn)
          .join('\n');
      } else {
        // create paste with all rows
        paste = this.state.rows.map(mapFn).join('\n');
      }
      createPaste(paste);
    };

    onRowHighlighted = (keys: TableHighlightedRows) => {
      this.setState({
        selectedIds: keys,
      });
    };

    renderSidebar = () => {
      const {renderSidebar} = props;
      const {datas, selectedIds} = this.state;
      const selectedId = selectedIds.length !== 1 ? null : selectedIds[0];

      if (selectedId != null) {
        return renderSidebar(datas[selectedId]);
      } else {
        return null;
      }
    };

    render() {
      const {columns, columnSizes} = props;
      const {rows} = this.state;

      return (
        <FlexColumn fill={true}>
          <SearchableTable
            key={props.id}
            rowLineHeight={28}
            floating={false}
            multiline={true}
            columnSizes={columnSizes}
            columns={columns}
            onRowHighlighted={this.onRowHighlighted}
            multiHighlight={true}
            rows={rows}
            stickyBottom={true}
            actions={<Button onClick={this.clear}>Clear Table</Button>}
          />
        </FlexColumn>
      );
    }
  };
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

export {default as styled} from './ui/styled/index.js';
export * from './ui/index.js';
export * from './utils/index.js';

export {default as GK} from './fb-stubs/GK.js';
export {SonarBasePlugin, SonarPlugin, SonarDevicePlugin} from './plugin.js';
export {createTablePlugin} from './createTablePlugin.js';

export * from './init.js';
export {default} from './init.js';

export {default as AndroidDevice} from './devices/AndroidDevice.js';
export {default as Device} from './devices/BaseDevice.js';
export {default as IOSDevice} from './devices/IOSDevice.js';
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import {Provider} from 'react-redux';
import ReactDOM from 'react-dom';
import {ContextMenuProvider} from 'sonar';
import {precachedIcons} from './utils/icons.js';
import GK from './fb-stubs/GK.js';
import App from './App.js';
import {createStore} from 'redux';
import reducers from './reducers/index.js';
import dispatcher from './dispatcher/index.js';
const path = require('path');

const store = createStore(
  reducers,
  window.__REDUX_DEVTOOLS_EXTENSION__ && window.__REDUX_DEVTOOLS_EXTENSION__(),
);

dispatcher(store);

GK.init();

const AppFrame = () => (
  <ContextMenuProvider>
    <Provider store={store}>
      <App />
    </Provider>
  </ContextMenuProvider>
);

// $FlowFixMe: this element exists!
ReactDOM.render(<AppFrame />, document.getElementById('root'));
// $FlowFixMe: service workers exist!
navigator.serviceWorker
  .register(
    process.env.NODE_ENV === 'production'
      ? path.join(__dirname, 'serviceWorker.js')
      : './serviceWorker.js',
  )
  .then(r => {
    (r.installing || r.active).postMessage({precachedIcons});
  })
  .catch(console.error);
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type {SonarBasePlugin} from './plugin.js';

import {devicePlugins} from './device-plugins/index.js';
import {
  isProduction,
  loadsDynamicPlugins,
  toggleDynamicPluginLoading,
} from './utils/dynamicPluginLoading.js';
import plugins from './plugins/index.js';
import electron from 'electron';

export type DefaultKeyboardAction = 'clear' | 'goToBottom' | 'createPaste';
export type TopLevelMenu = 'Edit' | 'View' | 'Window' | 'Help';

type MenuItem = {|
  label?: string,
  accelerator?: string,
  role?: string,
  click?: Function,
  submenu?: Array<MenuItem>,
  type?: string,
  enabled?: boolean,
|};

export type KeyboardAction = {|
  action: string,
  label: string,
  accelerator?: string,
  topLevelMenu: TopLevelMenu,
|};

const defaultKeyboardActions: Array<KeyboardAction> = [
  {
    label: 'Clear',
    accelerator: 'CmdOrCtrl+K',
    topLevelMenu: 'View',
    action: 'clear',
  },
  {
    label: 'Go To Bottom',
    accelerator: 'CmdOrCtrl+B',
    topLevelMenu: 'View',
    action: 'goToBottom',
  },
  {
    label: 'Create Paste',
    topLevelMenu: 'Edit',
    action: 'createPaste',
  },
];

export type KeyboardActions = Array<DefaultKeyboardAction | KeyboardAction>;

const menuItems: Map<string, Object> = new Map();

export function setupMenu(actionHandler: (action: string) => void) {
  const template = getTemplate(electron.remote.app, electron.remote.shell);

  // collect all keyboard actions from all plugins
  const registeredActions: Set<?KeyboardAction> = new Set(
    [...devicePlugins, ...plugins]
      .map((plugin: Class<SonarBasePlugin<>>) => plugin.keyboardActions || [])
      .reduce((acc: KeyboardActions, cv) => acc.concat(cv), [])
      .map(
        (action: DefaultKeyboardAction | KeyboardAction) =>
          typeof action === 'string'
            ? defaultKeyboardActions.find(a => a.action === action)
            : action,
      ),
  );

  // add keyboard actions to
  registeredActions.forEach(keyboardAction => {
    if (keyboardAction != null) {
      appendMenuItem(template, actionHandler, keyboardAction);
    }
  });

  // create actual menu instance
  const applicationMenu = electron.remote.Menu.buildFromTemplate(template);

  // add menu items to map, so we can modify them easily later
  registeredActions.forEach(keyboardAction => {
    if (keyboardAction != null) {
      const {topLevelMenu, label, action} = keyboardAction;
      const menu = applicationMenu.items.find(
        menuItem => menuItem.label === topLevelMenu,
      );
      const menuItem = menu.submenu.items.find(
        menuItem => menuItem.label === label,
      );
      menuItems.set(action, menuItem);
    }
  });

  // update menubar
  electron.remote.Menu.setApplicationMenu(applicationMenu);
}

function appendMenuItem(
  template: Array<MenuItem>,
  actionHandler: (action: string) => void,
  item: ?KeyboardAction,
) {
  const keyboardAction = item;
  if (keyboardAction == null) {
    return;
  }
  const itemIndex = template.findIndex(
    menu => menu.label === keyboardAction.topLevelMenu,
  );
  if (itemIndex > -1 && template[itemIndex].submenu != null) {
    template[itemIndex].submenu.push({
      click: () => actionHandler(keyboardAction.action),
      label: keyboardAction.label,
      accelerator: keyboardAction.accelerator,
      enabled: false,
    });
  }
}

export function activateMenuItems(activePluginKey: ?string) {
  const activePlugin: ?Class<SonarBasePlugin<>> = [
    ...devicePlugins,
    ...plugins,
  ].find((plugin: Class<SonarBasePlugin<>>) => plugin.id === activePluginKey);

  // disable all keyboard actions
  for (const item of menuItems) {
    item[1].enabled = false;
  }

  // enable keyboard actions for the current plugin
  if (activePlugin != null && activePlugin.keyboardActions != null) {
    (activePlugin.keyboardActions || []).forEach(keyboardAction => {
      const action =
        typeof keyboardAction === 'string'
          ? keyboardAction
          : keyboardAction.action;
      const item = menuItems.get(action);
      if (item != null) {
        item.enabled = true;
      }
    });
  }

  // set the application menu again to make sure it updates
  electron.remote.Menu.setApplicationMenu(
    electron.remote.Menu.getApplicationMenu(),
  );
}

function getTemplate(app: Object, shell: Object): Array<MenuItem> {
  const template = [
    {
      label: 'Edit',
      submenu: [
        {
          label: 'Undo',
          accelerator: 'CmdOrCtrl+Z',
          role: 'undo',
        },
        {
          label: 'Redo',
          accelerator: 'Shift+CmdOrCtrl+Z',
          role: 'redo',
        },
        {
          type: 'separator',
        },
        {
          label: 'Cut',
          accelerator: 'CmdOrCtrl+X',
          role: 'cut',
        },
        {
          label: 'Copy',
          accelerator: 'CmdOrCtrl+C',
          role: 'copy',
        },
        {
          label: 'Paste',
          accelerator: 'CmdOrCtrl+V',
          role: 'paste',
        },
        {
          label: 'Select All',
          accelerator: 'CmdOrCtrl+A',
          role: 'selectall',
        },
      ],
    },
    {
      label: 'View',
      submenu: [
        {
          label: 'Reload',
          accelerator: 'CmdOrCtrl+R',
          click: function(item: Object, focusedWindow: Object) {
            if (focusedWindow) {
              focusedWindow.reload();
            }
          },
        },
        {
          label: 'Toggle Full Screen',
          accelerator: (function() {
            if (process.platform === 'darwin') {
              return 'Ctrl+Command+F';
            } else {
              return 'F11';
            }
          })(),
          click: function(item: Object, focusedWindow: Object) {
            if (focusedWindow) {
              focusedWindow.setFullScreen(!focusedWindow.isFullScreen());
            }
          },
        },
        {
          label: 'Toggle Developer Tools',
          accelerator: (function() {
            if (process.platform === 'darwin') {
              return 'Alt+Command+I';
            } else {
              return 'Ctrl+Shift+I';
            }
          })(),
          click: function(item: Object, focusedWindow: Object) {
            if (focusedWindow) {
              focusedWindow.toggleDevTools();
            }
          },
        },
        {
          type: 'separator',
        },
      ],
    },
    {
      label: 'Window',
      role: 'window',
      submenu: [
        {
          label: 'Minimize',
          accelerator: 'CmdOrCtrl+M',
          role: 'minimize',
        },
        {
          label: 'Close',
          accelerator: 'CmdOrCtrl+W',
          role: 'close',
        },
      ],
    },
    {
      label: 'Help',
      role: 'help',
      submenu: [
        {
          label: 'Getting started',
          click: function() {
            shell.openExternal('https://fbsonar.com/docs/getting-started.html');
          },
        },
        {
          label: 'Create plugins',
          click: function() {
            shell.openExternal('https://fbsonar.com/docs/create-plugin.html');
          },
        },
        {
          label: 'Report problems',
          click: function() {
            shell.openExternal('https://github.com/facebook/Sonar/issues');
          },
        },
      ],
    },
  ];

  if (process.platform === 'darwin') {
    const name = app.getName();
    template.unshift({
      label: name,
      submenu: [
        {
          label: 'About ' + name,
          role: 'about',
        },
        {
          type: 'separator',
        },
        {
          label: 'Services',
          role: 'services',
          submenu: [],
        },
        {
          type: 'separator',
        },
        {
          label: 'Hide ' + name,
          accelerator: 'Command+H',
          role: 'hide',
        },
        {
          label: 'Hide Others',
          accelerator: 'Command+Shift+H',
          role: 'hideothers',
        },
        {
          label: 'Show All',
          role: 'unhide',
        },
        {
          type: 'separator',
        },
        {
          label: `Restart in ${
            loadsDynamicPlugins() ? 'Production' : 'Development'
          } Mode`,
          enabled: isProduction(),
          click: function() {
            toggleDynamicPluginLoading();
          },
        },
        {
          label: 'Quit',
          accelerator: 'Command+Q',
          click: function() {
            app.quit();
          },
        },
      ],
    });
    const windowMenu = template.find(function(m: Object) {
      return m.role === 'window';
    });
    if (windowMenu) {
      windowMenu.submenu.push(
        {
          type: 'separator',
        },
        {
          label: 'Bring All to Front',
          role: 'front',
        },
      );
    }
  }

  return template;
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type {KeyboardActions} from './MenuBar.js';
import type {App} from './App.js';
import type {Client} from './server.js';

import BaseDevice from './devices/BaseDevice.js';
import {AndroidDevice, IOSDevice} from 'sonar';

const invariant = require('invariant');

export type PluginClient = {|
  send: (method: string, params?: Object) => void,
  call: (method: string, params?: Object) => Promise<any>,
  subscribe: (method: string, callback: (params: any) => void) => void,
|};

type PluginTarget = BaseDevice | Client;

/**
 * This is a wrapper for a plugin instance and state. We have a special toJSON method that removes the plugin
 * instance and any state if it's not set to be persisted.
 */
export class PluginStateContainer {
  constructor(plugin: SonarBasePlugin<>, state: Object) {
    this.plugin = plugin;
    this.state = state;
  }

  plugin: ?SonarBasePlugin<>;
  state: Object;

  toJSON() {
    return {
      plugin: null,
      state: this.plugin != null ? this.state : null,
    };
  }
}

export class SonarBasePlugin<State: Object = any, Actions = any> {
  constructor() {
    // $FlowFixMe: this is fine
    this.state = {};
  }

  static title: string = 'Unknown';
  static id: string = 'Unknown';
  static icon: string = 'apps';
  static persist: boolean = true;
  static keyboardActions: ?KeyboardActions;
  static screenshot: ?string;

  // forbid instance properties that should be static
  title: empty;
  id: empty;
  persist: empty;

  namespaceKey: string;
  reducers: {
    [actionName: string]: (state: State, actionData: Object) => $Shape<State>,
  } = {};
  app: App;
  state: State;
  renderSidebar: ?() => ?React.Element<*>;
  renderIntro: ?() => ?React.Element<*>;
  onKeyboardAction: ?(action: string) => void;

  toJSON() {
    return null;
  }

  // methods to be overriden by plugins
  init(): void {}
  teardown(): void {}
  // methods to be overridden by subclasses
  _init(): void {}
  _teardown(): void {}
  _setup(target: PluginTarget, app: App) {
    this.app = app;
  }

  setState(
    state: $Shape<State> | ((state: State) => $Shape<State>),
    callback?: () => void,
  ) {
    if (typeof state === 'function') {
      state = state(this.state);
    }
    this.state = Object.assign({}, this.state, state);

    const pluginKey = this.constructor.id;
    const namespaceKey = this.namespaceKey;
    const appState = this.app.state;

    // update app state
    this.app.setState(
      {
        plugins: {
          ...appState.plugins,
          [namespaceKey]: {
            ...(appState.plugins[namespaceKey] || {}),
            [pluginKey]: new PluginStateContainer(this, this.state),
          },
        },
      },
      callback,
    );
  }

  dispatchAction(actionData: Actions) {
    // $FlowFixMe
    const action = this.reducers[actionData.type];
    if (!action) {
      // $FlowFixMe
      throw new ReferenceError(`Unknown action ${actionData.type}`);
    }

    if (typeof action === 'function') {
      this.setState(action.call(this, this.state, actionData));
    } else {
      // $FlowFixMe
      throw new TypeError(`Reducer ${actionData.type} isn't a function`);
    }
  }

  render(): any {
    return null;
  }
}

export class SonarDevicePlugin<
  State: Object = any,
  Actions = any,
> extends SonarBasePlugin<State, Actions> {
  device: BaseDevice;

  _setup(target: PluginTarget, app: App) {
    invariant(target instanceof BaseDevice, 'expected instanceof Client');
    const device: BaseDevice = target;

    this.namespaceKey = device.serial;
    this.device = device;
    super._setup(device, app);
  }

  _teardown() {
    this.teardown();
  }

  _init() {
    this.init();
  }
}

export class SonarPlugin<
  State: Object = any,
  Actions = any,
> extends SonarBasePlugin<State, Actions> {
  constructor() {
    super();
    this.subscriptions = [];
  }

  subscriptions: Array<{
    method: string,
    callback: Function,
  }>;

  client: PluginClient;
  realClient: Client;

  getDevice(): ?BaseDevice {
    return this.realClient.getDevice();
  }

  getAndroidDevice(): AndroidDevice {
    const device = this.getDevice();
    invariant(
      device != null && device instanceof AndroidDevice,
      'expected android device',
    );
    return device;
  }

  getIOSDevice() {
    const device = this.getDevice();
    invariant(
      device != null && device instanceof IOSDevice,
      'expected ios device',
    );
    return device;
  }

  _setup(target: any, app: App) {
    /* We have to type the above as `any` since if we import the actual Client we have an
       unresolvable dependency cycle */

    const realClient: Client = target;
    const id: string = this.constructor.id;

    this.namespaceKey = realClient.id;
    this.realClient = realClient;
    this.client = {
      call: (method, params) => realClient.call(id, method, params),
      send: (method, params) => realClient.send(id, method, params),
      subscribe: (method, callback) => {
        this.subscriptions.push({
          method,
          callback,
        });
        realClient.subscribe(id, method, callback);
      },
    };

    super._setup(realClient, app);
  }

  _teardown() {
    // automatically unsubscribe subscriptions
    for (const {method, callback} of this.subscriptions) {
      this.realClient.unsubscribe(this.constructor.id, method, callback);
    }

    // run plugin teardown
    this.teardown();
    if (this.realClient.connected) {
      this.realClient.rawSend('deinit', {plugin: this.constructor.id});
    }
  }

  _init() {
    this.realClient.rawSend('init', {plugin: this.constructor.id});
    this.init();
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */
import {Component, FlexColumn, Sidebar, colors} from 'sonar';
import Intro from './ui/components/intro/intro.js';
import {connect} from 'react-redux';
import {
  toggleRightSidebarAvailable,
  toggleRightSidebarVisible,
} from './reducers/application.js';
import type {SonarBasePlugin} from './plugin.js';
import type LogManager from './fb-stubs/Logger';

type Props = {
  plugin: SonarBasePlugin<>,
  state?: any,
  logger: LogManager,
  rightSidebarVisible: boolean,
  rightSidebarAvailable: boolean,
  toggleRightSidebarVisible: (available: ?boolean) => void,
  toggleRightSidebarAvailable: (available: ?boolean) => void,
};

type State = {
  showIntro: boolean,
};

class PluginContainer extends Component<Props, State> {
  state = {
    showIntro:
      typeof this.props.plugin.renderIntro === 'function' &&
      window.localStorage.getItem(
        `${this.props.plugin.constructor.id}.introShown`,
      ) !== 'true',
  };

  _sidebar: ?React$Node;

  static Container = FlexColumn.extends({
    width: 0,
    flexGrow: 1,
    flexShrink: 1,
    backgroundColor: colors.white,
  });

  componentWillUnmount() {
    performance.mark(`init_${this.props.plugin.constructor.id}`);
  }

  componentDidMount() {
    this.props.logger.trackTimeSince(
      `init_${this.props.plugin.constructor.id}`,
    );
  }

  componentDidUpdate(prevProps: Props) {
    if (prevProps.plugin !== this.props.plugin) {
      this.props.logger.trackTimeSince(
        `init_${this.props.plugin.constructor.id}`,
      );
    }
  }

  componentWillUpdate(nextProps: Props) {
    if (this.props.plugin !== nextProps.plugin) {
      performance.mark(`init_${nextProps.plugin.constructor.id}`);
    }
    let sidebarContent;
    if (typeof nextProps.plugin.renderSidebar === 'function') {
      sidebarContent = nextProps.plugin.renderSidebar();
    }

    if (sidebarContent == null) {
      this._sidebar = null;
      nextProps.toggleRightSidebarAvailable(false);
    } else {
      this._sidebar = (
        <Sidebar position="right" width={400} key="sidebar">
          {sidebarContent}
        </Sidebar>
      );
      nextProps.toggleRightSidebarAvailable(true);
    }
  }

  onDismissIntro = () => {
    const {plugin} = this.props;
    window.localStorage.setItem(`${plugin.constructor.id}.introShown`, 'true');
    this.setState({
      showIntro: false,
    });
  };

  render() {
    const {plugin} = this.props;

    return [
      <PluginContainer.Container key="plugin">
        {this.state.showIntro ? (
          <Intro
            title={plugin.constructor.title}
            icon={plugin.constructor.icon}
            screenshot={plugin.constructor.screenshot}
            onDismiss={this.onDismissIntro}>
            {typeof plugin.renderIntro === 'function' && plugin.renderIntro()}
          </Intro>
        ) : (
          plugin.render()
        )}
      </PluginContainer.Container>,
      this.props.rightSidebarVisible === false ? null : this._sidebar,
    ];
  }
}

export default connect(
  ({application: {rightSidebarVisible, rightSidebarAvailable}}) => ({
    rightSidebarVisible,
    rightSidebarAvailable,
  }),
  {
    toggleRightSidebarAvailable,
    toggleRightSidebarVisible,
  },
)(PluginContainer);
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type {
  App,
  State,
  StatePluginInfo,
  StatePlugins,
  StateClientPlugins,
} from './App.js';
import type {SonarBasePlugin} from 'sonar';
import {devicePlugins} from './device-plugins/index.js';
import {SonarPlugin, SonarDevicePlugin} from 'sonar';
import {PluginStateContainer} from './plugin.js';
import BaseDevice from './devices/BaseDevice.js';
import plugins from './plugins/index.js';
import {Client} from './server.js';

const invariant = require('invariant');

type ActivatePluginAction = {|
  appKey: string,
  pluginKey: string,
|};

type TeardownClientAction = {|
  appKey: string,
|};

export function ActivatePlugin(
  app: App,
  state: State,
  {appKey, pluginKey}: ActivatePluginAction,
) {
  const {activePluginKey, activeAppKey} = state;

  // get currently active plugin
  const activeClientPlugins: ?StateClientPlugins =
    activeAppKey != null ? state.plugins[activeAppKey] : null;
  const activePluginInfo: ?StatePluginInfo =
    activePluginKey != null && activeClientPlugins
      ? activeClientPlugins[activePluginKey]
      : null;

  // check if this plugin is already active
  if (
    activePluginKey === pluginKey &&
    activeAppKey === appKey &&
    activePluginInfo &&
    activePluginInfo.plugin
  ) {
    // this is a noop
    return state;
  }

  // produce new plugins object
  const newPluginsState: StatePlugins = {
    ...state.plugins,
  };

  // check if the currently active plugin needs to be torn down after being deactivated
  if (
    activeAppKey != null &&
    activePluginKey != null &&
    activePluginInfo &&
    activeClientPlugins
  ) {
    const activePlugin: ?SonarBasePlugin<> = activePluginInfo.plugin;
    if (activePlugin && !activePlugin.constructor.persist) {
      // teardown the currently active plugin
      activePlugin._teardown();

      // and remove it's plugin instance so next time it's made active it'll be reloaded
      newPluginsState[activeAppKey] = {
        ...activeClientPlugins,
        [activePluginKey]: {
          plugin: null,
          state: activePluginInfo.state,
        },
      };
    }
  }

  // get the plugin state associated with the new client
  const newClientPluginsState: StateClientPlugins = {
    ...(newPluginsState[appKey] || {}),
  };
  newPluginsState[appKey] = newClientPluginsState;

  // find the Plugin constructor with this key
  let Plugin: Class<SonarBasePlugin<>>;
  for (const FindPlugin of plugins) {
    if (FindPlugin.id === pluginKey) {
      Plugin = FindPlugin;
    }
  }
  for (const FindPlugin of devicePlugins) {
    if (FindPlugin.id === pluginKey) {
      Plugin = FindPlugin;
    }
  }
  invariant(Plugin, 'expected plugin');

  // get target, this could be an app connection or a device
  const clientInfo = state.server.connections.get(appKey);
  let target: void | Client | BaseDevice;
  if (clientInfo) {
    target = clientInfo.client;
    invariant(
      // $FlowFixMe prototype not known
      Plugin.prototype instanceof SonarPlugin,
      'expected plugin to be an app Plugin',
    );
  } else {
    target = app.props.devices.find(
      (device: BaseDevice) => device.serial === appKey,
    );
    invariant(
      // $FlowFixMe prototype not known
      Plugin.prototype instanceof SonarDevicePlugin,
      'expected plugin to be DevicePlugin',
    );
  }
  invariant(target, 'expected target');

  // initialise the client if it hasn't alreadu been
  const thisPluginState: ?StatePluginInfo = newClientPluginsState[pluginKey];
  if (!thisPluginState || !thisPluginState.plugin) {
    const plugin = new Plugin();

    // setup plugin, this is to avoid consumers having to pass args to super
    plugin._setup(target, app);

    // if we already have state for this plugin then rehydrate it
    if (thisPluginState && thisPluginState.state) {
      plugin.state = thisPluginState.state;
    }

    // init plugin - setup broadcasts, initial messages etc
    plugin._init();

    newClientPluginsState[pluginKey] = new PluginStateContainer(
      plugin,
      plugin.state,
    );
  }

  return {
    activeAppKey: appKey,
    activePluginKey: pluginKey,
    plugins: newPluginsState,
  };
}

export function TeardownClient(
  app: App,
  state: State,
  {appKey}: TeardownClientAction,
) {
  const allPlugins: StatePlugins = {...state.plugins};

  // teardown all plugins
  const clientPlugins: StateClientPlugins = allPlugins[appKey];
  for (const pluginKey in clientPlugins) {
    const {plugin} = clientPlugins[pluginKey];
    if (plugin) {
      plugin._teardown();
    }
  }

  // remove this client
  delete allPlugins[appKey];

  return {
    activeAppKey: state.activeAppKey === appKey ? null : state.activeAppKey,
    activePluginKey:
      state.activeAppKey === appKey ? null : state.activePluginKey,
    plugins: allPlugins,
  };
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type BaseDevice from './devices/BaseDevice.js';
import type {App} from './App.js';
import type {SonarPlugin} from './plugin.js';
import plugins from './plugins/index.js';
import CertificateProvider from './utils/CertificateProvider';
import type {SecureServerConfig} from './utils/CertificateProvider';

import {RSocketServer, ReactiveSocket, PartialResponder} from 'rsocket-core';
import RSocketTCPServer from 'rsocket-tcp-server';
const tls = require('tls');
const net = require('net');

const EventEmitter = (require('events'): any);

const invariant = require('invariant');

const SECURE_PORT = 8088;
const INSECURE_PORT = 8089;

type RSocket = {|
  fireAndForget(payload: {data: string}): void,
  connectionStatus(): any,
  close(): void,
|};

type ClientInfo = {|
  connection: ?ReactiveSocket,
  client: Client,
|};

type Plugins = Array<string>;

type ClientQuery = {|
  app: string,
  os: string,
  device: string,
  device_id: ?string,
|};

type RequestMetadata = {method: string, id: number, params: ?Object};

export class Client extends EventEmitter {
  constructor(app: App, id: string, query: ClientQuery, conn: ReactiveSocket) {
    super();

    this.connected = true;
    this.plugins = [];
    this.connection = conn;
    this.id = id;
    this.query = query;
    this.messageIdCounter = 0;
    this.app = app;

    this.broadcastCallbacks = new Map();
    this.requestCallbacks = new Map();

    const client = this;
    this.responder = {
      fireAndForget: (payload: {data: string}) => {
        client.onMessage(payload.data);
      },
    };

    conn.connectionStatus().subscribe({
      onNext(payload) {
        if (payload.kind == 'ERROR' || payload.kind == 'CLOSED') {
          client.connected = false;
        }
      },
      onSubscribe(subscription) {
        subscription.request(Number.MAX_SAFE_INTEGER);
      },
    });
  }

  on: ((event: 'plugins-change', callback: () => void) => void) &
    ((event: 'close', callback: () => void) => void);

  app: App;
  connected: boolean;
  id: string;
  query: ClientQuery;
  messageIdCounter: number;
  plugins: Plugins;
  connection: ReactiveSocket;
  responder: PartialResponder;

  broadcastCallbacks: Map<?string, Map<string, Set<Function>>>;

  requestCallbacks: Map<
    number,
    {|
      resolve: (data: any) => void,
      reject: (err: Error) => void,
      metadata: RequestMetadata,
    |},
  >;

  getDevice(): ?BaseDevice {
    const {device_id} = this.query;

    if (device_id == null) {
      return null;
    } else {
      return this.app.getDevice(device_id);
    }
  }

  supportsPlugin(Plugin: Class<SonarPlugin<>>): boolean {
    return this.plugins.includes(Plugin.id);
  }

  getFirstSupportedPlugin(): ?string {
    for (const Plugin of plugins) {
      if (this.supportsPlugin(Plugin)) {
        return Plugin.id;
      }
    }
  }

  async init() {
    await this.getPlugins();
  }

  // get the supported plugins
  async getPlugins(): Promise<Plugins> {
    const plugins = await this.rawCall('getPlugins').then(data => data.plugins);
    this.plugins = plugins;
    return plugins;
  }

  // get the plugins, and update the UI
  async refreshPlugins() {
    await this.getPlugins();
    this.emit('plugins-change');
  }

  onMessage(msg: string) {
    if (typeof msg !== 'string') {
      return;
    }

    let rawData;
    try {
      rawData = JSON.parse(msg);
    } catch (err) {
      this.app.logger.error(`Invalid JSON: ${msg}`, 'clientMessage');
      return;
    }

    const data: {|
      id?: number,
      method?: string,
      params?: Object,
      success?: Object,
      error?: Object,
    |} = rawData;

    this.app.logger.info(data, 'message:receive');

    const {id, method} = data;

    if (id == null) {
      const {error} = data;
      if (error != null) {
        this.app.logger.error(error.stacktrace || error.message, 'deviceError');
        this.app.errorReporter.report({
          message: error.message,
          stack: error.stacktrace,
        });
      } else if (method === 'refreshPlugins') {
        this.refreshPlugins();
      } else if (method === 'execute') {
        const params = data.params;
        invariant(params, 'expected params');

        const apiCallbacks = this.broadcastCallbacks.get(params.api);
        if (!apiCallbacks) {
          return;
        }

        const methodCallbacks: ?Set<Function> = apiCallbacks.get(params.method);
        if (methodCallbacks) {
          for (const callback of methodCallbacks) {
            callback(params.params);
          }
        }
      }
      return;
    }

    const callbacks = this.requestCallbacks.get(id);
    if (!callbacks) {
      return;
    }
    this.requestCallbacks.delete(id);
    this.finishTimingRequestResponse(callbacks.metadata);

    if (data.success) {
      callbacks.resolve(data.success);
    } else if (data.error) {
      callbacks.reject(data.error);
    } else {
      // ???
    }
  }

  toJSON() {
    return null;
  }

  subscribe(
    api: ?string = null,
    method: string,
    callback: (params: Object) => void,
  ) {
    let apiCallbacks = this.broadcastCallbacks.get(api);
    if (!apiCallbacks) {
      apiCallbacks = new Map();
      this.broadcastCallbacks.set(api, apiCallbacks);
    }

    let methodCallbacks = apiCallbacks.get(method);
    if (!methodCallbacks) {
      methodCallbacks = new Set();
      apiCallbacks.set(method, methodCallbacks);
    }
    methodCallbacks.add(callback);
  }

  unsubscribe(api: ?string = null, method: string, callback: Function) {
    const apiCallbacks = this.broadcastCallbacks.get(api);
    if (!apiCallbacks) {
      return;
    }

    const methodCallbacks = apiCallbacks.get(method);
    if (!methodCallbacks) {
      return;
    }
    methodCallbacks.delete(callback);
  }

  rawCall(method: string, params?: Object): Promise<Object> {
    return new Promise((resolve, reject) => {
      const id = this.messageIdCounter++;
      const metadata: RequestMetadata = {
        method,
        id,
        params,
      };
      this.requestCallbacks.set(id, {reject, resolve, metadata});

      const data = {
        id,
        method,
        params,
      };

      this.app.logger.info(data, 'message:call');
      this.startTimingRequestResponse({method, id, params});
      this.connection.fireAndForget({data: JSON.stringify(data)});
    });
  }

  startTimingRequestResponse(data: RequestMetadata) {
    performance.mark(this.getPerformanceMark(data));
  }

  finishTimingRequestResponse(data: RequestMetadata) {
    const mark = this.getPerformanceMark(data);
    const logEventName = this.getLogEventName(data);
    this.app.logger.trackTimeSince(mark, logEventName);
  }

  getPerformanceMark(data: RequestMetadata): string {
    const {method, id} = data;
    return `request_response_${method}_${id}`;
  }

  getLogEventName(data: RequestMetadata): string {
    const {method, params} = data;
    return params && params.api && params.method
      ? `request_response_${method}_${params.api}_${params.method}`
      : `request_response_${method}`;
  }

  rawSend(method: string, params?: Object): void {
    const data = {
      method,
      params,
    };
    this.app.logger.info(data, 'message:send');
    this.connection.fireAndForget({data: JSON.stringify(data)});
  }

  call(api: string, method: string, params?: Object): Promise<Object> {
    return this.rawCall('execute', {api, method, params});
  }

  send(api: string, method: string, params?: Object): void {
    return this.rawSend('execute', {api, method, params});
  }
}

export class Server extends EventEmitter {
  connections: Map<string, ClientInfo>;
  secureServer: RSocketServer;
  insecureServer: RSocketServer;
  certificateProvider: CertificateProvider;
  app: App;

  constructor(app: App) {
    super();
    this.app = app;
    this.connections = new Map();
    this.certificateProvider = new CertificateProvider(this, app.logger);
    this.init();
  }

  on: ((event: 'new-client', callback: (client: Client) => void) => void) &
    ((event: 'error', callback: (err: Error) => void) => void) &
    ((event: 'clients-change', callback: () => void) => void);

  init() {
    if (process.env.NODE_ENV === 'test') {
      this.app.logger.warn(
        "rsocket server has not been started as we're in test mode",
        'server',
      );
      return;
    }

    this.certificateProvider
      .loadSecureServerConfig()
      .then(
        options => (this.secureServer = this.startServer(SECURE_PORT, options)),
      );
    this.insecureServer = this.startServer(INSECURE_PORT);
  }

  startServer(port: number, sslConfig?: SecureServerConfig) {
    const server = this;
    const serverFactory = onConnect => {
      const transportServer = sslConfig
        ? tls.createServer(sslConfig, socket => {
            onConnect(socket);
          })
        : net.createServer(onConnect);
      transportServer
        .on('error', err => {
          server.emit('error', err);
          server.app.logger.error(
            `Error opening server on port ${port}`,
            'server',
          );
        })
        .on('listening', () => {
          server.app.logger.warn(
            `${
              sslConfig ? 'Secure' : 'Certificate'
            } server started on port ${port}`,
            'server',
          );
        });
      return transportServer;
    };
    const rsServer = new RSocketServer({
      getRequestHandler: sslConfig
        ? this._trustedRequestHandler
        : this._untrustedRequestHandler,
      transport: new RSocketTCPServer({
        port: port,
        serverFactory: serverFactory,
      }),
    });

    rsServer.start();
    return rsServer;
  }

  _trustedRequestHandler = (conn: RSocket, connectRequest: {data: string}) => {
    const server = this;

    const client = this.addConnection(conn, connectRequest.data);

    conn.connectionStatus().subscribe({
      onNext(payload) {
        if (payload.kind == 'ERROR' || payload.kind == 'CLOSED') {
          server.app.logger.warn(
            `Device disconnected ${client.id}`,
            'connection',
          );
          server.removeConnection(client.id);
        }
      },
      onSubscribe(subscription) {
        subscription.request(Number.MAX_SAFE_INTEGER);
      },
    });

    return client.responder;
  };

  _untrustedRequestHandler = (
    conn: RSocket,
    connectRequest: {data: string},
  ) => {
    const connectionParameters = JSON.parse(connectRequest.data);

    return {
      fireAndForget: (payload: {data: string}) => {
        if (typeof payload.data !== 'string') {
          return;
        }

        let rawData;
        try {
          rawData = JSON.parse(payload.data);
        } catch (err) {
          this.app.logger.error(
            `Invalid JSON: ${payload.data}`,
            'clientMessage',
          );
          return;
        }

        const json: {|
          method: 'signCertificate',
          csr: string,
          destination: string,
        |} = rawData;
        if (json.method === 'signCertificate') {
          this.app.logger.warn('CSR received from device', 'server');
          const {csr, destination} = json;
          this.certificateProvider.processCertificateSigningRequest(
            csr,
            connectionParameters.os,
            destination,
          );
        }
      },
    };
  };

  close() {
    this.secureServer.stop();
    this.insecureServer.stop();
  }

  toJSON() {
    return null;
  }

  addConnection(conn: ReactiveSocket, queryString: string): Client {
    const query = JSON.parse(queryString);
    invariant(query, 'expected query');

    this.app.logger.warn(`Device connected: ${queryString}`, 'connection');

    const id = `${query.app}-${query.os}-${query.device}`;
    const client = new Client(this.app, id, query, conn);

    const info = {
      client,
      connection: conn,
    };

    client.init().then(() => {
      this.app.logger.info(
        `Device client initialised: ${id}. Supported plugins: ${client.plugins.join(
          ', ',
        )}`,
        'connection',
      );

      /* If a device gets disconnected without being cleaned up properly,
       * sonar won't be aware until it attempts to reconnect.
       * When it does we need to terminate the zombie connection.
      */
      if (this.connections.has(id)) {
        const connectionInfo = this.connections.get(id);
        connectionInfo &&
          connectionInfo.connection &&
          connectionInfo.connection.close();
        this.removeConnection(id);
      }

      this.connections.set(id, info);
      this.emit('new-client', client);
      this.emit('clients-change');
      client.emit('plugins-change');
    });

    return client;
  }

  attachFakeClient(client: Client) {
    this.connections.set(client.id, {
      client,
      connection: null,
    });
  }

  removeConnection(id: string) {
    const info = this.connections.get(id);
    if (info) {
      info.client.emit('close');
      this.connections.delete(id);
      this.emit('clients-change');
    }
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import {FlexRow, Text, colors, LoadingIndicator, Glyph, Component} from 'sonar';
import {remote} from 'electron';
import {isProduction} from '../utils/dynamicPluginLoading';
import config from '../fb-stubs/config.js';
const version = remote.app.getVersion();

const VersionText = Text.extends({
  color: colors.light50,
  marginLeft: 4,
  marginTop: 2,
});

const Container = FlexRow.extends({
  alignItems: 'center',
});

type State = {
  updater:
    | 'error'
    | 'checking-for-update'
    | 'update-available'
    | 'update-not-available'
    | 'update-downloaded',
  error?: string,
};

export default class AutoUpdateVersion extends Component<{}, State> {
  state = {
    updater: 'update-not-available',
  };

  componentDidMount() {
    if (isProduction()) {
      remote.autoUpdater.setFeedURL(
        `${config.updateServer}?version=${version}`,
      );

      remote.autoUpdater.on('update-downloaded', () => {
        this.setState({updater: 'update-downloaded'});

        remote.dialog.showMessageBox(
          {
            title: 'Update available',
            message: 'A new version of Sonar is available!',
            detail: `You have Sonar ${version} which is outdated. Update to the latest version now.`,
            buttons: ['Install and Restart'],
          },
          () => {
            remote.autoUpdater.quitAndInstall();
          },
        );
      });

      remote.autoUpdater.on('error', error => {
        this.setState({updater: 'error', error: error.toString()});
      });

      remote.autoUpdater.on('checking-for-update', () => {
        this.setState({updater: 'checking-for-update'});
      });

      remote.autoUpdater.on('update-available', error => {
        this.setState({updater: 'update-available'});
      });

      remote.autoUpdater.on('update-not-available', error => {
        this.setState({updater: 'update-not-available'});
      });

      remote.autoUpdater.checkForUpdates();
    }
  }

  render() {
    return (
      <Container>
        {this.state.updater === 'update-available' && (
          <span title="Downloading new version">
            <LoadingIndicator size={16} />
          </span>
        )}
        {this.state.updater === 'error' && (
          <span title={`Error fetching update: ${this.state.error || ''}`}>
            <Glyph color={colors.light30} name="caution-triangle" />
          </span>
        )}
        {this.state.updater === 'update-downloaded' && (
          <span title="Update available. Restart Sonar.">
            <Glyph color={colors.light30} name="breaking-news" />
          </span>
        )}
        {isProduction() && <VersionText>{version}</VersionText>}
      </Container>
    );
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type BugReporter from '../fb-stubs/BugReporter.js';
import {Component} from 'react';
import {
  Button,
  colors,
  Link,
  Input,
  FlexColumn,
  FlexRow,
  Textarea,
  Text,
  FlexCenter,
  styled,
} from 'sonar';

const Container = FlexColumn.extends({
  padding: 10,
});

const textareaStyle = {
  margin: 0,
  marginBottom: 10,
};

const DialogContainer = styled.view({
  width: 400,
  height: 300,
  position: 'absolute',
  left: '50%',
  marginLeft: -200,
  top: 40,
  zIndex: 999999,
  backgroundColor: '#fff',
  border: '1px solid #ddd',
  borderTop: 'none',
  borderBottomLeftRadius: 5,
  borderBottomRightRadius: 5,
  boxShadow: '0 1px 10px rgba(0, 0, 0, 0.1)',
});

const TitleInput = Input.extends({
  ...textareaStyle,
  height: 30,
});

const DescriptionTextarea = Textarea.extends({
  ...textareaStyle,
  flexGrow: 1,
});

const SubmitButtonContainer = styled.view({
  marginLeft: 'auto',
});

const Footer = FlexRow.extends({
  lineHeight: '24px',
});

const CloseDoneButton = Button.extends({
  width: 50,
  margin: '10px auto',
});

type State = {
  description: string,
  title: string,
  submitting: boolean,
  success: false | number, // false if not created, id of bug if it's been created
  error: ?string,
};

type Props = {
  bugReporter: BugReporter,
  close: () => void,
};

const DEFAULT_DESCRIPTION = `Thanks for taking the time to provide feedback!
Please fill out the following information to make addressing your issue easier.

What device platform are you using? ios/android
What sort of device are you using? emulator/physical
What app are you trying to use? wilde, fb4a, lite etc
Describe your problem in as much detail as possible: `;

export default class BugReporterDialog extends Component<Props, State> {
  constructor(props: Props) {
    super(props);

    this.state = {
      description: DEFAULT_DESCRIPTION,
      title: '',
      submitting: false,
      success: false,
      error: null,
    };
  }

  titleRef: HTMLElement;
  descriptionRef: HTMLElement;

  onDescriptionChange = (e: SyntheticInputEvent<HTMLInputElement>) => {
    this.setState({description: e.target.value});
  };

  onTitleChange = (e: SyntheticInputEvent<HTMLInputElement>) => {
    this.setState({title: e.target.value});
  };

  onSubmit = () => {
    // validate fields
    const {title, description} = this.state;
    if (!title) {
      this.setState({
        error: 'Title required.',
      });
      this.titleRef.focus();
      return;
    }
    if (!description) {
      this.setState({
        error: 'Description required.',
      });
      this.descriptionRef.focus();
      return;
    }

    this.setState(
      {
        error: null,
        submitting: true,
      },
      () => {
        // this will be called before the next repaint
        requestAnimationFrame(() => {
          // we have to call this again to ensure a repaint has actually happened
          // as requestAnimationFrame is called BEFORE a repaint, not after which
          // means we have to queue up twice to actually ensure a repaint has
          // happened
          requestAnimationFrame(() => {
            this.props.bugReporter
              .report(title, description)
              .then((id: number) => {
                this.setState({
                  submitting: false,
                  success: id,
                });
              })
              .catch(err => {
                this.setState({
                  error: err.message,
                  submitting: false,
                });
              });
          });
        });
      },
    );
  };

  setTitleRef = (ref: HTMLElement) => {
    this.titleRef = ref;
  };

  setDescriptionRef = (ref: HTMLElement) => {
    this.descriptionRef = ref;
  };

  onCancel = () => {
    this.props.close();
  };

  render() {
    let content;

    const {title, success, error, description} = this.state;

    if (success) {
      content = (
        <FlexCenter fill={true}>
          <FlexColumn>
            <Text>
              <Text>Bug </Text>

              <Text bold={true}>
                <Link
                  href={`https://our.intern.facebook.com/intern/bug/${success}`}>
                  {success}
                </Link>
              </Text>

              <Text> created. Thank you for the report!</Text>
            </Text>

            <CloseDoneButton onClick={this.onCancel}>Close</CloseDoneButton>
          </FlexColumn>
        </FlexCenter>
      );
    } else {
      content = (
        <Container fill={true}>
          <TitleInput
            placeholder="Title..."
            value={title}
            innerRef={this.setTitleRef}
            onChange={this.onTitleChange}
          />

          <DescriptionTextarea
            placeholder="Description..."
            value={description}
            innerRef={this.setDescriptionRef}
            onChange={this.onDescriptionChange}
          />

          <Footer>
            {error != null && <Text color={colors.red}>{error}</Text>}
            <SubmitButtonContainer>
              <Button type="primary" onClick={this.onSubmit}>
                Submit report
              </Button>
              <Button type="danger" onClick={this.onCancel}>
                Cancel
              </Button>
            </SubmitButtonContainer>
          </Footer>
        </Container>
      );
    }

    return <DialogContainer>{content}</DialogContainer>;
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import {Component, styled, Glyph, Button, colors} from 'sonar';
import {connect} from 'react-redux';
import BaseDevice from '../devices/BaseDevice.js';
import child_process from 'child_process';
import DevicesList from './DevicesList.js';

const adb = require('adbkit-fb');

const Light = styled.view(
  {
    width: 10,
    height: 10,
    borderRadius: '999em',
    backgroundColor: props => (props.active ? '#70f754' : colors.light20),
    border: props => `1px solid ${props.active ? '#52d936' : colors.light30}`,
  },
  {
    ignoreAttributes: ['active'],
  },
);

type Props = {|
  devices: Array<BaseDevice>,
|};

type Emulator = {|
  name: string,
  os?: string,
  isRunning: boolean,
|};

type State = {
  androidEmulators: Array<Emulator>,
  iOSSimulators: Array<Emulator>,
  popoverVisible: boolean,
};

type IOSSimulatorList = {
  devices: {
    [os: string]: Array<{
      state: 'Shutdown' | 'Booted',
      availability: string,
      name: string,
      udid: string,
      os?: string,
    }>,
  },
};

class DevicesButton extends Component<Props, State> {
  state = {
    androidEmulators: [],
    iOSSimulators: [],
    popoverVisible: false,
  };

  client = adb.createClient();
  _iOSSimulatorRefreshInterval: ?number;

  componentDidMount() {
    this.updateEmulatorState(this.openMenuWhenNoDevicesConnected);
    this.fetchIOSSimulators();
    this._iOSSimulatorRefreshInterval = window.setInterval(
      this.fetchIOSSimulators,
      5000,
    );

    this.client.trackDevices().then(tracker => {
      tracker.on('add', () => this.updateEmulatorState());
      tracker.on('remove', () => this.updateEmulatorState());
      tracker.on('end', () => this.updateEmulatorState());
    });
  }

  componentWillUnmount() {
    if (this._iOSSimulatorRefreshInterval != null) {
      window.clearInterval(this._iOSSimulatorRefreshInterval);
    }
  }

  fetchIOSSimulators = () => {
    child_process.exec(
      'xcrun simctl list devices --json',
      (err: ?Error, data: ?string) => {
        if (data != null && err == null) {
          const devicesList: IOSSimulatorList = JSON.parse(data);
          const iOSSimulators = Object.keys(devicesList.devices)
            .map(os =>
              devicesList.devices[os].map(device => {
                device.os = os;
                return device;
              }),
            )
            .reduce((acc, cv) => acc.concat(cv), [])
            .filter(device => device.state === 'Booted')
            .map(device => ({
              name: device.name,
              os: device.os,
              isRunning: true,
            }));
          this.setState({iOSSimulators});
        }
      },
    );
  };

  openMenuWhenNoDevicesConnected = () => {
    const numberOfEmulators = this.state.androidEmulators.filter(
      e => e.isRunning,
    ).length;
    const numberOfDevices = Object.values(this.props.devices).length;
    if (numberOfEmulators + numberOfDevices === 0) {
      this.setState({popoverVisible: true});
    }
  };

  updateEmulatorState = async (cb?: Function) => {
    try {
      const devices = await this.getEmulatorNames();
      const ports = await this.getRunningEmulatorPorts();
      const runningDevices = await Promise.all(
        ports.map(port => this.getRunningName(port)),
      );
      this.setState(
        {
          androidEmulators: devices.map(name => ({
            name,
            isRunning: runningDevices.indexOf(name) > -1,
          })),
        },
        cb,
      );
    } catch (e) {
      console.error(e);
    }
  };

  getEmulatorNames(): Promise<Array<string>> {
    return new Promise((resolve, reject) => {
      child_process.exec(
        '$ANDROID_HOME/tools/emulator -list-avds',
        (error: ?Error, data: ?string) => {
          if (error == null && data != null) {
            resolve(data.split('\n').filter(name => name !== ''));
          } else {
            reject(error);
          }
        },
      );
    });
  }

  getRunningEmulatorPorts(): Promise<Array<string>> {
    const EMULATOR_PREFIX = 'emulator-';
    return adb
      .createClient()
      .listDevices()
      .then((devices: Array<{id: string}>) =>
        devices
          .filter(d => d.id.startsWith(EMULATOR_PREFIX))
          .map(d => d.id.replace(EMULATOR_PREFIX, '')),
      )
      .catch((e: Error) => {
        return [];
      });
  }

  getRunningName(port: string): Promise<?string> {
    return new Promise((resolve, reject) => {
      child_process.exec(
        `echo "avd name" | nc -w 1 localhost ${port}`,
        (error: ?Error, data: ?string) => {
          if (error == null && data != null) {
            const match = data.trim().match(/(.*)\r\nOK$/);
            resolve(match != null && match.length > 0 ? match[1] : null);
          } else {
            reject(error);
          }
        },
      );
    });
  }

  launchEmulator = (name: string) => {
    child_process.exec(
      `$ANDROID_HOME/tools/emulator @${name}`,
      this.updateEmulatorState,
    );
  };

  createEmualtor = () => {};

  onClick = () => {
    this.setState({popoverVisible: !this.state.popoverVisible});
    this.updateEmulatorState();
    this.fetchIOSSimulators();
  };

  onDismissPopover = () => {
    this.setState({popoverVisible: false});
  };

  render() {
    let text = 'No devices running';
    let glyph = 'minus-circle';

    const runnningEmulators = this.state.androidEmulators.filter(
      emulator => emulator.isRunning,
    );

    const numberOfRunningDevices =
      runnningEmulators.length + this.state.iOSSimulators.length;

    if (numberOfRunningDevices > 0) {
      text = `${numberOfRunningDevices} device${
        numberOfRunningDevices > 1 ? 's' : ''
      } running`;
      glyph = 'mobile';
    }

    const connectedDevices = this.props.devices;

    return (
      <Button
        compact={true}
        onClick={this.onClick}
        icon={glyph}
        disabled={this.state.androidEmulators.length === 0}>
        {text}
        {this.state.popoverVisible && (
          <DevicesList
            onDismiss={this.onDismissPopover}
            sections={[
              {
                title: 'Running',
                items: [
                  ...connectedDevices
                    .filter(device => device.deviceType === 'physical')
                    .map(device => ({
                      title: device.title,
                      subtitle: device.os,
                      icon: <Light active={true} />,
                    })),
                  ...runnningEmulators.map(emulator => ({
                    title: emulator.name,
                    subtitle: 'Android Emulator',
                    icon: <Light active={true} />,
                  })),
                  ...this.state.iOSSimulators.map(simulator => ({
                    title: simulator.name,
                    subtitle: `${String(simulator.os)} Simulator`,
                    icon: <Light active={true} />,
                  })),
                ],
              },
              {
                title: 'Not Running',
                items: [
                  ...this.state.androidEmulators
                    .filter(emulator => !emulator.isRunning)
                    .map(emulator => ({
                      title: emulator.name,
                      subtitle: 'Android Emulator',
                      onClick: () => this.launchEmulator(emulator.name),
                      icon: <Light active={false} />,
                    })),
                  {
                    title: 'Connect a device',
                    subtitle: 'Plugins will load automatically',
                    icon: <Glyph name="mobile" size={12} />,
                  },
                ],
              },
            ]}
          />
        )}
      </Button>
    );
  }
}

export default connect(({devices}) => ({
  devices,
}))(DevicesButton);
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import {
  PureComponent,
  FlexRow,
  FlexBox,
  Text,
  Button,
  Popover,
  styled,
  colors,
} from 'sonar';

const Heading = Text.extends({
  display: 'block',
  backgroundColor: colors.white,
  color: colors.light30,
  fontSize: 11,
  fontWeight: 600,
  lineHeight: '21px',
  padding: '4px 8px 0',
});

const PopoverItem = FlexRow.extends({
  alignItems: 'center',
  borderBottom: `1px solid ${colors.light05}`,
  height: 50,
  '&:last-child': {
    borderBottom: 'none',
  },
});

const ItemTitle = Text.extends({
  display: 'block',
  fontSize: 14,
  fontWeight: 400,
  lineHeight: '120%',
  textOverflow: 'ellipsis',
  overflow: 'hidden',
  whiteSpace: 'nowrap',
  marginBottom: 1,
});

const ItemSubtitle = Text.extends({
  display: 'block',
  fontWeight: 400,
  fontSize: 11,
  color: colors.light30,
  lineHeight: '14px',
  textOverflow: 'ellipsis',
  overflow: 'hidden',
  whiteSpace: 'nowrap',
});

const ItemImage = FlexBox.extends({
  alignItems: 'center',
  justifyContent: 'center',
  width: 40,
  flexShrink: 0,
});

const ItemContent = styled.view({
  minWidth: 0,
  paddingRight: 5,
  flexGrow: 1,
});

const Section = styled.view({
  maxWidth: 260,
  borderBottom: `1px solid ${colors.light05}`,
  '&:last-child': {
    borderBottom: 'none',
  },
});

const Action = Button.extends({
  border: `1px solid ${colors.macOSTitleBarButtonBorder}`,
  background: 'transparent',
  color: colors.macOSTitleBarIconSelected,
  marginRight: 8,
  marginLeft: 4,
  lineHeight: '22px',
  '&:hover': {
    background: 'transparent',
  },
  '&:active': {
    background: 'transparent',
    border: `1px solid ${colors.macOSTitleBarButtonBorder}`,
  },
});

type Props = {|
  sections: Array<{
    title: string,
    items: Array<{
      title: string,
      subtitle: string,
      onClick?: Function,
      icon?: React.Element<*>,
    }>,
  }>,
  onDismiss: Function,
|};

export default class DevicesList extends PureComponent<Props> {
  render() {
    return (
      <Popover onDismiss={this.props.onDismiss}>
        {this.props.sections.map(section => {
          if (section.items.length > 0) {
            return (
              <Section key={section.title}>
                <Heading>{section.title}</Heading>
                {section.items.map(item => (
                  <PopoverItem key={item.title}>
                    <ItemImage>{item.icon}</ItemImage>
                    <ItemContent>
                      <ItemTitle>{item.title}</ItemTitle>
                      <ItemSubtitle>{item.subtitle}</ItemSubtitle>
                    </ItemContent>
                    {item.onClick && (
                      <Action onClick={item.onClick} compact={true}>
                        Run
                      </Action>
                    )}
                  </PopoverItem>
                ))}
              </Section>
            );
          } else {
            return null;
          }
        })}
      </Popover>
    );
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import {styled, colors} from 'sonar';

const ErrorBarContainer = styled.view({
  backgroundColor: colors.cherry,
  bottom: 0,
  color: '#fff',
  left: 0,
  lineHeight: '26px',
  position: 'absolute',
  right: 0,
  textAlign: 'center',
  zIndex: 2,
});

export default function ErrorBar(props: {|text: ?string|}) {
  if (props.text == null) {
    return null;
  } else {
    return <ErrorBarContainer>{props.text}</ErrorBarContainer>;
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type {SonarBasePlugin} from '../plugin.js';
import type {Client} from '../server.js';

import {
  Component,
  Sidebar,
  FlexBox,
  ClickableList,
  ClickableListItem,
  colors,
  brandColors,
  Text,
  Glyph,
} from 'sonar';
import {devicePlugins} from '../device-plugins/index.js';
import type BaseDevice from '../devices/BaseDevice.js';
import PropTypes from 'prop-types';
import plugins from '../plugins/index.js';

const CustomClickableListItem = ClickableListItem.extends({
  paddingLeft: 10,
  display: 'flex',
  alignItems: 'center',
  marginBottom: 2,
});

const SidebarHeader = FlexBox.extends({
  display: 'block',
  alignItems: 'center',
  padding: 3,
  color: colors.macOSSidebarSectionTitle,
  fontSize: 11,
  fontWeight: 500,
  marginLeft: 7,
  textOverflow: 'ellipsis',
  overflow: 'hidden',
  whiteSpace: 'nowrap',
  flexShrink: 0,
});

const PluginShape = FlexBox.extends(
  {
    marginRight: 5,
    backgroundColor: props => props.backgroundColor,
    borderRadius: 3,
    flexShrink: 0,
    width: 18,
    height: 18,
    justifyContent: 'center',
    alignItems: 'center',
  },
  {
    ignoreAttributes: ['backgroundColor'],
  },
);

const PluginName = Text.extends({
  minWidth: 0,
  textOverflow: 'ellipsis',
  whiteSpace: 'nowrap',
  overflow: 'hidden',
});

function PluginIcon({
  backgroundColor,
  name,
  color,
}: {
  backgroundColor: string,
  name: string,
  color: string,
}) {
  return (
    <PluginShape backgroundColor={backgroundColor}>
      <Glyph size={12} name={name} color={color} />
    </PluginShape>
  );
}

class PluginSidebarListItem extends Component<{
  activePluginKey: ?string,
  activeAppKey: ?string,
  onActivatePlugin: (appKey: string, pluginKey: string) => void,
  appKey: string,
  appName?: string,
  isActive: boolean,
  Plugin: Class<SonarBasePlugin<>>,
  windowFocused: boolean,
}> {
  onClick = () => {
    const {props} = this;
    props.onActivatePlugin(props.appKey, props.Plugin.id);
  };

  render() {
    const {isActive, Plugin, windowFocused, appKey, appName} = this.props;

    let iconColor;
    if (appName != null) {
      iconColor = brandColors[appName];
    }

    if (iconColor == null) {
      const pluginColors = [
        colors.seaFoam,
        colors.teal,
        colors.lime,
        colors.lemon,
        colors.orange,
        colors.tomato,
        colors.cherry,
        colors.pink,
        colors.grape,
      ];

      iconColor = pluginColors[parseInt(appKey, 36) % pluginColors.length];
    }

    return (
      <CustomClickableListItem
        active={isActive}
        onClick={this.onClick}
        windowFocused={windowFocused}>
        <PluginIcon
          name={Plugin.icon}
          backgroundColor={
            isActive
              ? windowFocused
                ? colors.white
                : colors.macOSSidebarSectionTitle
              : iconColor
          }
          color={
            isActive
              ? windowFocused
                ? colors.macOSTitleBarIconSelected
                : colors.white
              : colors.white
          }
        />
        <PluginName>{Plugin.title}</PluginName>
      </CustomClickableListItem>
    );
  }
}

function PluginSidebarList(props: {|
  activePluginKey: ?string,
  activeAppKey: ?string,
  onActivatePlugin: (appKey: string, pluginKey: string) => void,
  appKey: string,
  appName?: string,
  enabledPlugins: Array<Class<SonarBasePlugin<>>>,
  windowFocused: boolean,
|}) {
  if (props.enabledPlugins.length === 0) {
    return <Text>No available plugins for this device</Text>;
  }

  return (
    <ClickableList>
      {props.enabledPlugins.map(Plugin => {
        const isActive =
          props.activeAppKey === props.appKey &&
          props.activePluginKey === Plugin.id;
        return (
          <PluginSidebarListItem
            key={Plugin.id}
            activePluginKey={props.activePluginKey}
            activeAppKey={props.activeAppKey}
            onActivatePlugin={props.onActivatePlugin}
            appKey={props.appKey}
            appName={props.appName}
            isActive={isActive}
            Plugin={Plugin}
            windowFocused={props.windowFocused}
          />
        );
      })}
    </ClickableList>
  );
}

function AppSidebarInfo(props: {|
  client: Client,
  appKey: string,
  activePluginKey: ?string,
  activeAppKey: ?string,
  onActivatePlugin: (appKey: string, pluginKey: string) => void,
  windowFocused: boolean,
|}): any {
  const {appKey, client, windowFocused} = props;

  let enabledPlugins = [];
  for (const Plugin of plugins) {
    if (client.supportsPlugin(Plugin)) {
      enabledPlugins.push(Plugin);
    }
  }
  enabledPlugins = enabledPlugins.sort((a, b) => {
    return (a.title || '').localeCompare(b.title);
  });

  return [
    <SidebarHeader key={client.query.app}>{`${client.query.app} (${
      client.query.os
    }) - ${client.query.device}`}</SidebarHeader>,
    <PluginSidebarList
      key={`list-${appKey}`}
      activePluginKey={props.activePluginKey}
      activeAppKey={props.activeAppKey}
      onActivatePlugin={props.onActivatePlugin}
      appKey={appKey}
      appName={client.query.app}
      enabledPlugins={enabledPlugins}
      windowFocused={windowFocused}
    />,
  ];
}

type MainSidebarProps = {|
  activePluginKey: ?string,
  activeAppKey: ?string,
  onActivatePlugin: (appKey: string, pluginKey: string) => void,
  devices: Array<BaseDevice>,
  server: Server,
|};

export default class MainSidebar extends Component<MainSidebarProps> {
  static contextTypes = {
    windowIsFocused: PropTypes.bool,
  };

  render() {
    const connections = Array.from(this.props.server.connections.values()).sort(
      (a, b) => {
        return (a.client.query.app || '').localeCompare(b.client.query.app);
      },
    );

    const sidebarContent = connections.map(conn => {
      const {client} = conn;

      return (
        <AppSidebarInfo
          key={`app=${client.id}`}
          client={client}
          appKey={client.id}
          activePluginKey={this.props.activePluginKey}
          activeAppKey={this.props.activeAppKey}
          onActivatePlugin={this.props.onActivatePlugin}
          windowFocused={this.context.windowIsFocused}
        />
      );
    });

    let {devices} = this.props;
    devices = devices.sort((a, b) => {
      return (a.title || '').localeCompare(b.title);
    });

    for (const device of devices) {
      let enabledPlugins = [];
      for (const DevicePlugin of devicePlugins) {
        if (device.supportsPlugin(DevicePlugin)) {
          enabledPlugins.push(DevicePlugin);
        }
      }
      enabledPlugins = enabledPlugins.sort((a, b) => {
        return (a.title || '').localeCompare(b.title);
      });

      sidebarContent.unshift([
        <SidebarHeader key={device.title}>{device.title}</SidebarHeader>,
        <PluginSidebarList
          key={`list-${device.serial}`}
          activePluginKey={this.props.activePluginKey}
          activeAppKey={this.props.activeAppKey}
          onActivatePlugin={this.props.onActivatePlugin}
          appKey={device.serial}
          enabledPlugins={enabledPlugins}
          windowFocused={this.context.windowIsFocused}
        />,
      ]);
    }

    return (
      <Sidebar
        position="left"
        width={200}
        backgroundColor={
          this.context.windowIsFocused ? 'transparent' : '#f6f6f6'
        }>
        {sidebarContent}
      </Sidebar>
    );
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import {
  PureComponent,
  Button,
  FlexColumn,
  FlexBox,
  Text,
  LoadingIndicator,
  ButtonGroup,
  colors,
  Glyph,
  FlexRow,
  styled,
  Searchable,
} from 'sonar';
const {spawn} = require('child_process');
const path = require('path');
const {app, shell} = require('electron').remote;

const SONAR_PLUGIN_PATH = path.join(app.getPath('home'), '.sonar');
const DYNAMIC_PLUGINS = JSON.parse(window.process.env.PLUGINS || '[]');

type NPMModule = {
  name: string,
  version: string,
  description?: string,
  error?: Object,
};

type Status =
  | 'installed'
  | 'outdated'
  | 'install'
  | 'remove'
  | 'update'
  | 'uninstalled'
  | 'uptodate';

type PluginT = {
  name: string,
  version?: string,
  description?: string,
  status: Status,
  managed?: boolean,
  entry?: string,
  rootDir?: string,
};

type Props = {
  searchTerm: string,
};
type State = {
  plugins: {
    [name: string]: PluginT,
  },
  restartRequired: boolean,
  searchCompleted: boolean,
};

const Container = FlexBox.extends({
  width: '100%',
  flexGrow: 1,
  background: colors.light02,
  overflowY: 'scroll',
});

const Title = Text.extends({
  fontWeight: 500,
});

const Plugin = FlexColumn.extends({
  backgroundColor: colors.white,
  borderRadius: 4,
  padding: 15,
  margin: '0 15px 25px',
  boxShadow: '0 1px 2px rgba(0,0,0,0.05)',
});

const SectionTitle = styled.text({
  fontWeight: 'bold',
  fontSize: 24,
  margin: 15,
  marginLeft: 20,
});

const Loading = FlexBox.extends({
  padding: 50,
  alignItems: 'center',
  justifyContent: 'center',
});

const RestartRequired = FlexBox.extends({
  textAlign: 'center',
  justifyContent: 'center',
  fontWeight: 500,
  color: colors.white,
  padding: 12,
  backgroundColor: colors.green,
  cursor: 'pointer',
});

const TitleRow = FlexRow.extends({
  alignItems: 'center',
  marginBottom: 10,
  fontSize: '1.1em',
});

const Description = FlexRow.extends({
  marginBottom: 15,
  lineHeight: '130%',
});

const PluginGlyph = Glyph.extends({
  marginRight: 5,
});

const PluginLoading = LoadingIndicator.extends({
  marginLeft: 5,
  marginTop: 5,
});

const getLatestVersion = (name: string): Promise<NPMModule> => {
  return fetch(`http://registry.npmjs.org/${name}/latest`).then(res =>
    res.json(),
  );
};

const getPluginList = (): Promise<Array<NPMModule>> => {
  return fetch(
    'http://registry.npmjs.org/-/v1/search?text=keywords:sonar&size=250',
  )
    .then(res => res.json())
    .then(res => res.objects.map(o => o.package));
};

const sortByName = (a: PluginT, b: PluginT): 1 | -1 =>
  a.name > b.name ? 1 : -1;

const INSTALLED = ['installed', 'outdated', 'uptodate'];

class PluginItem extends PureComponent<
  {
    plugin: PluginT,
    onChangeState: (action: Status) => void,
  },
  {
    working: boolean,
  },
> {
  state = {
    working: false,
  };

  npmAction = (action: Status) => {
    const {name, status: initialStatus} = this.props.plugin;
    this.setState({working: true});
    const npm = spawn('npm', [action, name], {
      cwd: SONAR_PLUGIN_PATH,
    });

    npm.stderr.on('data', e => {
      console.error(e.toString());
    });

    npm.on('close', code => {
      this.setState({working: false});
      const newStatus = action === 'remove' ? 'uninstalled' : 'uptodate';
      this.props.onChangeState(code !== 0 ? initialStatus : newStatus);
    });
  };

  render() {
    const {
      entry,
      status,
      version,
      description,
      managed,
      name,
      rootDir,
    } = this.props.plugin;

    return (
      <Plugin>
        <TitleRow>
          <PluginGlyph
            name="apps"
            size={24}
            variant="outline"
            color={colors.light30}
          />
          <Title>{name}</Title>
          &nbsp;
          <Text code={true}>{version}</Text>
        </TitleRow>
        {description && <Description>{description}</Description>}
        <FlexRow>
          {managed ? (
            <Text size="0.9em" color={colors.light30}>
              This plugin is not managed by Sonar, but loaded from{' '}
              <Text size="1em" code={true}>
                {rootDir}
              </Text>
            </Text>
          ) : (
            <ButtonGroup>
              {status === 'outdated' && (
                <Button
                  disabled={this.state.working}
                  onClick={() => this.npmAction('update')}>
                  Update
                </Button>
              )}
              {INSTALLED.includes(status) ? (
                <Button
                  disabled={this.state.working}
                  title={
                    managed === true && entry != null
                      ? `This plugin is dynamically loaded from ${entry}`
                      : undefined
                  }
                  onClick={() => this.npmAction('remove')}>
                  Remove
                </Button>
              ) : (
                <Button
                  disabled={this.state.working}
                  onClick={() => this.npmAction('install')}>
                  Install
                </Button>
              )}
              <Button
                onClick={() =>
                  shell.openExternal(`https://www.npmjs.com/package/${name}`)
                }>
                Info
              </Button>
            </ButtonGroup>
          )}
          {this.state.working && <PluginLoading size={18} />}
        </FlexRow>
      </Plugin>
    );
  }
}

class PluginManager extends PureComponent<Props, State> {
  state = {
    plugins: DYNAMIC_PLUGINS.reduce((acc, plugin) => {
      acc[plugin.name] = {
        ...plugin,
        managed: !(plugin.entry, '').startsWith(SONAR_PLUGIN_PATH),
        status: 'installed',
      };
      return acc;
    }, {}),
    restartRequired: false,
    searchCompleted: false,
  };

  componentDidMount() {
    Promise.all(
      Object.keys(this.state.plugins)
        .filter(name => this.state.plugins[name].managed)
        .map(getLatestVersion),
    ).then((res: Array<NPMModule>) => {
      const updates = {};
      res.forEach(plugin => {
        if (
          plugin.error == null &&
          this.state.plugins[plugin.name].version !== plugin.version
        ) {
          updates[plugin.name] = {
            ...plugin,
            ...this.state.plugins[plugin.name],
            status: 'outdated',
          };
        }
      });
      this.setState({
        plugins: {
          ...this.state.plugins,
          ...updates,
        },
      });
    });

    getPluginList().then(pluginList => {
      const plugins = {...this.state.plugins};
      pluginList.forEach(plugin => {
        if (plugins[plugin.name] != null) {
          plugins[plugin.name] = {
            ...plugin,
            ...plugins[plugin.name],
            status:
              plugin.version === plugins[plugin.name].version
                ? 'uptodate'
                : 'outdated',
          };
        } else {
          plugins[plugin.name] = {
            ...plugin,
            status: 'uninstalled',
          };
        }
      });
      this.setState({
        plugins,
        searchCompleted: true,
      });
    });
  }

  onChangePluginState = (name: string, status: Status) => {
    this.setState({
      plugins: {
        ...this.state.plugins,
        [name]: {
          ...this.state.plugins[name],
          status,
        },
      },
      restartRequired: true,
    });
  };

  relaunch() {
    app.relaunch();
    app.exit(0);
  }

  render() {
    // $FlowFixMe
    const plugins: Array<PluginT> = Object.values(this.state.plugins);
    const availablePlugins = plugins.filter(
      ({status}) => !INSTALLED.includes(status),
    );
    return (
      <Container>
        <FlexColumn fill={true}>
          {this.state.restartRequired && (
            <RestartRequired onClick={this.relaunch}>
              <Glyph name="arrows-circle" size={12} color={colors.white} />
              &nbsp; Restart Required: Click to Restart
            </RestartRequired>
          )}
          <SectionTitle>Installed Plugins</SectionTitle>
          {plugins
            .filter(
              ({status, name}) =>
                INSTALLED.includes(status) &&
                name.indexOf(this.props.searchTerm) > -1,
            )
            .sort(sortByName)
            .map((plugin: PluginT) => (
              <PluginItem
                plugin={plugin}
                key={plugin.name}
                onChangeState={action =>
                  this.onChangePluginState(plugin.name, action)
                }
              />
            ))}
          <SectionTitle>Available Plugins</SectionTitle>
          {availablePlugins
            .filter(({name}) => name.indexOf(this.props.searchTerm) > -1)
            .sort(sortByName)
            .map((plugin: PluginT) => (
              <PluginItem
                plugin={plugin}
                key={plugin.name}
                onChangeState={action =>
                  this.onChangePluginState(plugin.name, action)
                }
              />
            ))}
          {!this.state.searchCompleted && (
            <Loading>
              <LoadingIndicator size={32} />
            </Loading>
          )}
        </FlexColumn>
      </Container>
    );
  }
}

const SearchablePluginManager = Searchable(PluginManager);

export default class extends PureComponent<{}> {
  render() {
    return (
      <FlexColumn fill={true}>
        <SearchablePluginManager />
      </FlexColumn>
    );
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import {
  PureComponent,
  FlexColumn,
  FlexRow,
  FlexBox,
  Text,
  Button,
  styled,
  colors,
} from 'sonar';

const Anchor = styled.image({
  zIndex: 6,
  position: 'absolute',
  bottom: 0,
  left: '50%',
  transform: 'translate(-50%, calc(100% + 2px))',
});

const PopoverContainer = FlexColumn.extends({
  backgroundColor: colors.white,
  borderRadius: 7,
  border: '1px solid rgba(0,0,0,0.3)',
  boxShadow: '0 2px 10px 0 rgba(0,0,0,0.3)',
  position: 'absolute',
  zIndex: 5,
  minWidth: 240,
  bottom: 0,
  marginTop: 15,
  left: '50%',
  transform: 'translate(-50%, calc(100% + 15px))',
  overflow: 'hidden',
  '&::before': {
    content: '""',
    display: 'block',
    position: 'absolute',
    left: '50%',
    transform: 'translateX(-50%)',
    height: 13,
    top: -13,
    width: 26,
    backgroundColor: colors.white,
  },
});

const Heading = Text.extends({
  display: 'block',
  backgroundColor: colors.white,
  color: colors.light30,
  fontSize: 11,
  fontWeight: 600,
  lineHeight: '21px',
  padding: '4px 8px 0',
});

const PopoverItem = FlexRow.extends({
  alignItems: 'center',
  borderBottom: `1px solid ${colors.light05}`,
  height: 50,
  '&:last-child': {
    borderBottom: 'none',
  },
});

const ItemTitle = Text.extends({
  display: 'block',
  fontSize: 14,
  fontWeight: 400,
  lineHeight: '120%',
  textOverflow: 'ellipsis',
  overflow: 'hidden',
  whiteSpace: 'nowrap',
  marginBottom: 1,
});

const ItemSubtitle = Text.extends({
  display: 'block',
  fontWeight: 400,
  fontSize: 11,
  color: colors.light30,
  lineHeight: '14px',
  textOverflow: 'ellipsis',
  overflow: 'hidden',
  whiteSpace: 'nowrap',
});

const ItemImage = FlexBox.extends({
  alignItems: 'center',
  justifyContent: 'center',
  width: 40,
  flexShrink: 0,
});

const ItemContent = styled.view({
  minWidth: 0,
  paddingRight: 5,
  flexGrow: 1,
});

const Section = styled.view({
  borderBottom: `1px solid ${colors.light05}`,
  '&:last-child': {
    borderBottom: 'none',
  },
});

const Action = Button.extends({
  border: `1px solid ${colors.macOSTitleBarButtonBorder}`,
  background: 'transparent',
  color: colors.macOSTitleBarIconSelected,
  marginRight: 8,
  lineHeight: '22px',
  '&:hover': {
    background: 'transparent',
  },
  '&:active': {
    background: 'transparent',
    border: `1px solid ${colors.macOSTitleBarButtonBorder}`,
  },
});

type Props = {|
  sections: Array<{
    title: string,
    items: Array<{
      title: string,
      subtitle: string,
      onClick?: Function,
      icon?: React.Element<*>,
    }>,
  }>,
  onDismiss: Function,
|};

export default class Popover extends PureComponent<Props> {
  _ref: ?Element;

  componentDidMount() {
    window.document.addEventListener('click', this.handleClick);
  }

  componentWillUnmount() {
    window.document.addEventListener('click', this.handleClick);
  }

  handleClick = (e: SyntheticMouseEvent<>) => {
    // $FlowFixMe
    if (this._ref && !this._ref.contains(e.target)) {
      this.props.onDismiss();
    }
  };

  _setRef = (ref: ?Element) => {
    this._ref = ref;
  };

  render() {
    return [
      <Anchor src="./anchor.svg" key="anchor" />,
      <PopoverContainer innerRef={this._setRef} key="popup">
        {this.props.sections.map(section => {
          if (section.items.length > 0) {
            return (
              <Section key={section.title}>
                <Heading>{section.title}</Heading>
                {section.items.map(item => (
                  <PopoverItem key={item.title}>
                    <ItemImage>{item.icon}</ItemImage>
                    <ItemContent>
                      <ItemTitle>{item.title}</ItemTitle>
                      <ItemSubtitle>{item.subtitle}</ItemSubtitle>
                    </ItemContent>
                    {item.onClick && (
                      <Action onClick={item.onClick} compact={true}>
                        Run
                      </Action>
                    )}
                  </PopoverItem>
                ))}
              </Section>
            );
          } else {
            return null;
          }
        })}
      </PopoverContainer>,
    ];
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import {
  colors,
  Button,
  ButtonGroup,
  FlexRow,
  FlexBox,
  Component,
  Spacer,
  Glyph,
  GK,
} from 'sonar';
import {
  loadsDynamicPlugins,
  dynamicPluginPath,
} from '../utils/dynamicPluginLoading.js';
import {connect} from 'react-redux';
import {
  toggleBugDialogVisible,
  toggleLeftSidebarVisible,
  toggleRightSidebarVisible,
  togglePluginManagerVisible,
} from '../reducers/application.js';
import DevicesButton from './DevicesButton.js';
import Version from './Version.js';
import AutoUpdateVersion from './AutoUpdateVersion.js';
import config from '../fb-stubs/config.js';

const TitleBar = FlexRow.extends(
  {
    background: props =>
      props.focused
        ? `linear-gradient(to bottom, ${
            colors.macOSTitleBarBackgroundTop
          } 0%, ${colors.macOSTitleBarBackgroundBottom} 100%)`
        : colors.macOSTitleBarBackgroundBlur,
    borderBottom: props =>
      `1px solid ${
        props.focused
          ? colors.macOSTitleBarBorder
          : colors.macOSTitleBarBorderBlur
      }`,
    height: 38,
    flexShrink: 0,
    width: '100%',
    alignItems: 'center',
    paddingLeft: 80,
    paddingRight: 10,
    justifyContent: 'space-between',
    // $FlowFixMe
    WebkitAppRegion: 'drag',
  },
  {
    ignoreAttributes: ['focused'],
  },
);

const Icon = FlexBox.extends({
  marginRight: 3,
});

type Props = {|
  windowIsFocused: boolean,
  leftSidebarVisible: boolean,
  rightSidebarVisible: boolean,
  rightSidebarAvailable: boolean,
  pluginManagerVisible: boolean,
  toggleBugDialogVisible: (visible?: boolean) => void,
  toggleLeftSidebarVisible: (visible?: boolean) => void,
  toggleRightSidebarVisible: (visible?: boolean) => void,
  togglePluginManagerVisible: (visible?: boolean) => void,
|};

class SonarTitleBar extends Component<Props> {
  render() {
    return (
      <TitleBar focused={this.props.windowIsFocused} className="toolbar">
        <DevicesButton />
        <Spacer />
        {loadsDynamicPlugins() && (
          <Icon
            title={`Plugins are loaded dynamically from ${dynamicPluginPath() ||
              ''}`}>
            <Glyph color={colors.light30} name="flash-default" size={16} />
          </Icon>
        )}
        {process.platform === 'darwin' ? <AutoUpdateVersion /> : <Version />}
        {config.bugReportButtonVisible && (
          <Button
            compact={true}
            onClick={() => this.props.toggleBugDialogVisible()}
            title="Report Bug"
            icon="bug"
          />
        )}
        {GK.get('sonar_dynamic_plugins') && (
          <Button
            compact={true}
            onClick={() => this.props.toggleBugDialogVisible()}
            selected={this.props.pluginManagerVisible}
            title="Plugin Manager"
            icon="apps"
          />
        )}
        <ButtonGroup>
          <Button
            compact={true}
            selected={this.props.leftSidebarVisible}
            onClick={() => this.props.toggleLeftSidebarVisible()}
            icon="icons/sidebar_left.svg"
            iconSize={20}
            title="Toggle Plugins"
          />
          <Button
            compact={true}
            selected={this.props.rightSidebarVisible}
            onClick={() => this.props.toggleRightSidebarVisible()}
            icon="icons/sidebar_right.svg"
            iconSize={20}
            title="Toggle Details"
            disabled={!this.props.rightSidebarAvailable}
          />
        </ButtonGroup>
      </TitleBar>
    );
  }
}

export default connect(
  ({
    application: {
      windowIsFocused,
      leftSidebarVisible,
      rightSidebarVisible,
      rightSidebarAvailable,
      pluginManagerVisible,
    },
  }) => ({
    windowIsFocused,
    leftSidebarVisible,
    rightSidebarVisible,
    rightSidebarAvailable,
    pluginManagerVisible,
  }),
  {
    toggleBugDialogVisible,
    toggleLeftSidebarVisible,
    toggleRightSidebarVisible,
    togglePluginManagerVisible,
  },
)(SonarTitleBar);
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import {Component, FlexRow, colors, LoadingIndicator} from 'sonar';
import {version} from '../../package.json';
import {remote} from 'electron';
import * as path from 'path';
import {userInfo} from 'os';
import * as fs from 'fs';

const VERSION_URL =
  'https://interngraph.intern.facebook.com/sonar/version?app=543626909362475&token=AeNRaexWgPooanyxG0';

type VersionState = {
  status: 'unknown' | 'outdated' | 'latest' | 'updated' | 'errored',
};

export default class Version extends Component<{}, VersionState> {
  state = {
    status: 'unknown',
  };

  static Container = FlexRow.extends({
    alignItems: 'center',
    marginRight: 7,
    marginLeft: 7,
    marginTop: -1,
    color: colors.light50,
  });

  static UpdatedContainer = FlexRow.extends({
    backgroundColor: colors.blackAlpha10,
    borderRadius: '999em',
    padding: '2px 6px',
    marginLeft: 7,
    color: colors.light80,
    '&:hover': {
      backgroundColor: colors.blackAlpha15,
    },
  });

  componentDidMount() {
    this.watchUpdates();

    this.checkVersion().catch(() => {
      this.setState({status: 'errored'});
    });
  }

  async watchUpdates() {
    fs.watch(path.join(userInfo().homedir, '.sonar-desktop'), () =>
      this.setState({status: 'updated'}),
    );
  }

  async checkVersion() {
    const req = await fetch(VERSION_URL);
    const json = await req.json();
    this.setState({status: json.version === version ? 'latest' : 'outdated'});
  }

  onClick = () => {
    // mark the app to relaunch once killed
    remote.app.relaunch();
    // close the current window
    remote.getCurrentWindow().destroy();
  };

  render() {
    const {status} = this.state;
    return (
      <Version.Container>
        {version}
        {status === 'outdated' && [
          <Version.Container key="loading">
            <LoadingIndicator size={16} />
          </Version.Container>,
          'Updating...',
        ]}
        {status === 'updated' && (
          <Version.UpdatedContainer onClick={this.onClick}>
            Restart Sonar
          </Version.UpdatedContainer>
        )}
      </Version.Container>
    );
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import {
  styled,
  PureComponent,
  FlexColumn,
  FlexRow,
  Text,
  Glyph,
  colors,
  brandColors,
} from 'sonar';
import {isProduction} from '../utils/dynamicPluginLoading';
import {shell, remote} from 'electron';

const Container = FlexColumn.extends({
  height: '100%',
  width: '100%',
  justifyContent: 'center',
  alignItems: 'center',
  backgroundImage: 'url(./pattern.gif)',
});

const Welcome = FlexColumn.extends(
  {
    width: 460,
    background: colors.white,
    borderRadius: 10,
    boxShadow: '0 1px 3px rgba(0,0,0,0.25)',
    overflow: 'hidden',
    opacity: props => (props.isMounted ? 1 : 0),
    transform: props => `translateY(${props.isMounted ? 0 : 20}px)`,
    transition: '0.6s all ease-out',
  },
  {
    ignoreAttributes: ['isMounted'],
  },
);

const Title = Text.extends({
  fontSize: 24,
  fontWeight: 300,
  textAlign: 'center',
  color: colors.light50,
  marginBottom: 16,
});

const Version = Text.extends({
  textAlign: 'center',
  fontSize: 11,
  fontWeight: 300,
  color: colors.light30,
  marginBottom: 60,
});

const Item = FlexRow.extends({
  padding: 10,
  cursor: 'pointer',
  alignItems: 'center',
  borderTop: `1px solid ${colors.light10}`,
  '&:hover, &:focus, &:active': {
    backgroundColor: colors.light02,
    textDecoration: 'none',
  },
});

const ItemTitle = Text.extends({
  color: colors.light50,
  fontSize: 15,
});

const ItemSubTitle = Text.extends({
  color: colors.light30,
  fontSize: 11,
  marginTop: 2,
});

const Icon = Glyph.extends({
  marginRight: 11,
  marginLeft: 6,
});

const Logo = styled.image({
  width: 128,
  height: 128,
  alignSelf: 'center',
  marginTop: 50,
  marginBottom: 20,
});

type Props = {};
type State = {
  isMounted: boolean,
};

export default class WelcomeScreen extends PureComponent<Props, State> {
  state = {
    isMounted: false,
  };

  componentDidMount() {
    setTimeout(
      () =>
        this.setState({
          isMounted: true,
        }),
      100,
    );
  }

  render() {
    return (
      <Container>
        <Welcome isMounted={this.state.isMounted}>
          <Logo src="./icon.png" />
          <Title>Welcome to Sonar</Title>
          <Version>
            {isProduction()
              ? `Version ${remote.app.getVersion()}`
              : 'Development Mode'}
          </Version>
          <Item
            onClick={() =>
              shell.openExternal('https://fbsonar.com/docs/understand.html')
            }>
            <Icon size={20} name="rocket" color={brandColors.Sonar} />
            <FlexColumn>
              <ItemTitle>Using Sonar</ItemTitle>
              <ItemSubTitle>
                Learn how Sonar can help you debugging your App
              </ItemSubTitle>
            </FlexColumn>
          </Item>
          <Item
            onClick={() =>
              shell.openExternal('https://fbsonar.com/docs/create-plugin.html')
            }>
            <Icon size={20} name="magic-wand" color={brandColors.Sonar} />
            <FlexColumn>
              <ItemTitle>Create your own plugin</ItemTitle>
              <ItemSubTitle>Get started with these pointers</ItemSubTitle>
            </FlexColumn>
          </Item>
          <Item
            onClick={() =>
              shell.openExternal(
                'https://fbsonar.com/docs/getting-started.html',
              )
            }>
            <Icon size={20} name="tools" color={brandColors.Sonar} />
            <FlexColumn>
              <ItemTitle>Add Sonar support to your app</ItemTitle>
              <ItemSubTitle>Get started with these pointers</ItemSubTitle>
            </FlexColumn>
          </Item>
          <Item
            onClick={() =>
              shell.openExternal('https://github.com/facebook/Sonar/issues')
            }>
            <Icon size={20} name="posts" color={brandColors.Sonar} />
            <FlexColumn>
              <ItemTitle>Contributing and Feedback</ItemTitle>
              <ItemSubTitle>
                Report issues and help us improving Sonar
              </ItemSubTitle>
            </FlexColumn>
          </Item>
        </Welcome>
      </Container>
    );
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */
import {GK} from 'sonar';
import logs from './logs/index.js';
import cpu from './cpu/index.js';
import screen from './screen/index.js';

const plugins = [logs];

if (GK.get('sonar_uiperf')) {
  plugins.push(cpu);
}

if (GK.get('sonar_screen_plugin')) {
  plugins.push(screen);
}

export const devicePlugins = plugins;
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import {SonarDevicePlugin} from 'sonar';
var adb = require('adbkit-fb');

import {
  FlexColumn,
  FlexRow,
  Button,
  Toolbar,
  Text,
  ManagedTable,
  colors,
} from 'sonar';

type ADBClient = any;
type AndroidDevice = any;
type TableRows = any;

// we keep vairable name with underline for to physical path mappings on device
type CPUFrequency = {|
  cpu_id: number,
  scaling_cur_freq: number,
  scaling_min_freq: number,
  scaling_max_freq: number,
  cpuinfo_max_freq: number,
  cpuinfo_min_freq: number,
|};

type CPUState = {|
  cpuFreq: Array<CPUFrequency>,
  cpuCount: number,
  monitoring: boolean,
|};

type ShellCallBack = (output: string) => void;

const ColumnSizes = {
  cpu_id: '10%',
  scaling_cur_freq: 'flex',
  scaling_min_freq: 'flex',
  scaling_max_freq: 'flex',
  cpuinfo_min_freq: 'flex',
  cpuinfo_max_freq: 'flex',
};

const Columns = {
  cpu_id: {
    value: 'CPU ID',
    resizable: true,
  },
  scaling_cur_freq: {
    value: 'Scaling Current',
    resizable: true,
  },
  scaling_min_freq: {
    value: 'Scaling MIN',
    resizable: true,
  },
  scaling_max_freq: {
    value: 'Scaling MAX',
    resizable: true,
  },
  cpuinfo_min_freq: {
    value: 'MIN Frequency',
    resizable: true,
  },
  cpuinfo_max_freq: {
    value: 'MAX Frequency',
    resizable: true,
  },
};

// check if str is a number
function isNormalInteger(str) {
  let n = Math.floor(Number(str));
  return String(n) === str && n >= 0;
}

// format frequency to MHz, GHz
function formatFrequency(freq) {
  if (freq == -1) {
    return 'N/A';
  } else if (freq == -2) {
    return 'off';
  } else if (freq > 1000 * 1000) {
    return (freq / 1000 / 1000).toFixed(2) + ' GHz';
  } else {
    return freq / 1000 + ' MHz';
  }
}

export default class CPUFrequencyTable extends SonarDevicePlugin<CPUState> {
  static id = 'DeviceCPU';
  static title = 'CPU';
  static icon = 'underline';

  adbClient: ADBClient;
  intervalID: ?IntervalID;
  device: AndroidDevice;

  init() {
    this.setState({
      cpuFreq: [],
      cpuCount: 0,
      monitoring: false,
    });

    this.adbClient = this.device.adb;

    // check how many cores we have on this device
    this.executeShell((output: string) => {
      let idx = output.indexOf('-');
      let cpuFreq = [];
      let count = parseInt(output.substring(idx + 1), 10) + 1;
      for (let i = 0; i < count; ++i) {
        cpuFreq[i] = {
          cpu_id: i,
          scaling_cur_freq: -1,
          scaling_min_freq: -1,
          scaling_max_freq: -1,
          cpuinfo_min_freq: -1,
          cpuinfo_max_freq: -1,
        };
      }
      this.setState({
        cpuCount: count,
        cpuFreq: cpuFreq,
      });
    }, 'cat /sys/devices/system/cpu/possible');
  }

  executeShell = (callback: ShellCallBack, command: string) => {
    this.adbClient
      .shell(this.device.serial, command)
      .then(adb.util.readAll)
      .then(function(output) {
        return callback(output.toString().trim());
      });
  };

  updateCoreFrequency = (core: number, type: string) => {
    this.executeShell((output: string) => {
      let cpuFreq = this.state.cpuFreq;
      let newFreq = isNormalInteger(output) ? parseInt(output, 10) : -1;

      // update table only if frequency changed
      if (cpuFreq[core][type] != newFreq) {
        cpuFreq[core][type] = newFreq;
        if (type == 'scaling_cur_freq' && cpuFreq[core][type] < 0) {
          // cannot find current freq means offline
          cpuFreq[core][type] = -2;
        }

        this.setState({
          cpuFreq: cpuFreq,
        });
      }
    }, 'cat /sys/devices/system/cpu/cpu' + core + '/cpufreq/' + type);
  };

  readCoreFrequency = (core: number) => {
    let freq = this.state.cpuFreq[core];
    if (freq.cpuinfo_max_freq < 0) {
      this.updateCoreFrequency(core, 'cpuinfo_max_freq');
    }
    if (freq.cpuinfo_min_freq < 0) {
      this.updateCoreFrequency(core, 'cpuinfo_min_freq');
    }
    this.updateCoreFrequency(core, 'scaling_cur_freq');
    this.updateCoreFrequency(core, 'scaling_min_freq');
    this.updateCoreFrequency(core, 'scaling_max_freq');
  };

  onStartMonitor = () => {
    if (this.intervalID) {
      return;
    }

    this.intervalID = setInterval(() => {
      for (let i = 0; i < this.state.cpuCount; ++i) {
        this.readCoreFrequency(i);
      }
    }, 500);

    this.setState({
      monitoring: true,
    });
  };

  onStopMonitor = () => {
    if (!this.intervalID) {
      return;
    } else {
      clearInterval(this.intervalID);
      this.intervalID = null;
      this.setState({
        monitoring: false,
      });
      this.cleanup();
    }
  };

  cleanup = () => {
    let cpuFreq = this.state.cpuFreq;
    for (let i = 0; i < this.state.cpuCount; ++i) {
      cpuFreq[i].scaling_cur_freq = -1;
      cpuFreq[i].scaling_min_freq = -1;
      cpuFreq[i].scaling_max_freq = -1;
      // we don't cleanup cpuinfo_min_freq, cpuinfo_max_freq
      // because usually they are fixed (hardware)
    }
    this.setState({
      cpuFreq: cpuFreq,
    });
  };

  teardown = () => {
    this.cleanup();
  };

  buildRow = (freq: CPUFrequency) => {
    let style = {};
    if (freq.scaling_cur_freq == -2) {
      style = {
        style: {
          backgroundColor: colors.blueTint30,
          color: colors.white,
          fontWeight: 700,
        },
      };
    } else if (
      freq.scaling_min_freq != freq.cpuinfo_min_freq &&
      freq.scaling_min_freq > 0 &&
      freq.cpuinfo_min_freq > 0
    ) {
      style = {
        style: {
          backgroundColor: colors.redTint,
          color: colors.red,
          fontWeight: 700,
        },
      };
    } else if (
      freq.scaling_max_freq != freq.cpuinfo_max_freq &&
      freq.scaling_max_freq > 0 &&
      freq.cpuinfo_max_freq > 0
    ) {
      style = {
        style: {
          backgroundColor: colors.yellowTint,
          color: colors.yellow,
          fontWeight: 700,
        },
      };
    }

    return {
      columns: {
        cpu_id: {value: <Text>CPU_{freq.cpu_id}</Text>},
        scaling_cur_freq: {
          value: <Text>{formatFrequency(freq.scaling_cur_freq)}</Text>,
        },
        scaling_min_freq: {
          value: <Text>{formatFrequency(freq.scaling_min_freq)}</Text>,
        },
        scaling_max_freq: {
          value: <Text>{formatFrequency(freq.scaling_max_freq)}</Text>,
        },
        cpuinfo_min_freq: {
          value: <Text>{formatFrequency(freq.cpuinfo_min_freq)}</Text>,
        },
        cpuinfo_max_freq: {
          value: <Text>{formatFrequency(freq.cpuinfo_max_freq)}</Text>,
        },
      },
      key: freq.cpu_id,
      style,
    };
  };

  frequencyRows = (cpuFreqs: Array<CPUFrequency>): TableRows => {
    let rows = [];
    for (const cpuFreq of cpuFreqs) {
      rows.push(this.buildRow(cpuFreq));
    }
    return rows;
  };

  render() {
    return (
      <FlexRow>
        <FlexColumn fill={true}>
          <Toolbar position="top">
            {this.state.monitoring ? (
              <Button onClick={this.onStopMonitor} icon="pause">
                Pause
              </Button>
            ) : (
              <Button onClick={this.onStartMonitor} icon="play">
                Start
              </Button>
            )}
          </Toolbar>
          <ManagedTable
            multiline={true}
            columnSizes={ColumnSizes}
            columns={Columns}
            autoHeight={true}
            floating={false}
            zebra={true}
            rows={this.frequencyRows(this.state.cpuFreq)}
          />
        </FlexColumn>
      </FlexRow>
    );
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */
import LogTable from './LogTable.js';
export default LogTable;
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type {
  TableBodyRow,
  TableColumnOrder,
  TableColumnSizes,
  TableColumns,
} from 'sonar';
import type {Counter} from './LogWatcher.js';
import type {DeviceLogEntry} from '../../devices/BaseDevice.js';

import {
  Text,
  ManagedTable,
  Button,
  colors,
  FlexCenter,
  LoadingIndicator,
  ContextMenu,
  FlexColumn,
  Glyph,
} from 'sonar';
import {SonarDevicePlugin, SearchableTable} from 'sonar';
import textContent from '../../utils/textContent.js';
import createPaste from '../../utils/createPaste.js';
import LogWatcher from './LogWatcher';

const LOG_WATCHER_LOCAL_STORAGE_KEY = 'LOG_WATCHER_LOCAL_STORAGE_KEY';

type Entries = Array<{
  row: TableBodyRow,
  entry: DeviceLogEntry,
}>;

type LogsState = {|
  initialising: boolean,
  rows: Array<TableBodyRow>,
  entries: Entries,
  key2entry: {[key: string]: DeviceLogEntry},
  highlightedRows: Array<string>,
  counters: Array<Counter>,
|};

const Icon = Glyph.extends({
  marginTop: 5,
});

function getLineCount(str: string): number {
  let count = 1;
  for (let i = 0; i < str.length; i++) {
    if (str[i] === '\n') {
      count++;
    }
  }
  return count;
}

function keepKeys(obj, keys) {
  const result = {};
  for (const key in obj) {
    if (keys.includes(key)) {
      result[key] = obj[key];
    }
  }
  return result;
}

const COLUMN_SIZE = {
  type: 32,
  time: 120,
  pid: 60,
  tid: 60,
  tag: 120,
  app: 200,
  message: 'flex',
};

const COLUMNS = {
  type: {
    value: '',
  },
  time: {
    value: 'Time',
  },
  pid: {
    value: 'PID',
  },
  tid: {
    value: 'TID',
  },
  tag: {
    value: 'Tag',
  },
  app: {
    value: 'App',
  },
  message: {
    value: 'Message',
  },
};

const INITIAL_COLUMN_ORDER = [
  {
    key: 'type',
    visible: true,
  },
  {
    key: 'time',
    visible: false,
  },
  {
    key: 'pid',
    visible: false,
  },
  {
    key: 'tid',
    visible: false,
  },
  {
    key: 'tag',
    visible: true,
  },
  {
    key: 'app',
    visible: true,
  },
  {
    key: 'message',
    visible: true,
  },
];

const LOG_TYPES: {
  [level: string]: {
    label: string,
    color: string,
    icon?: React.Node,
    style?: Object,
  },
} = {
  verbose: {
    label: 'Verbose',
    color: colors.purple,
  },
  debug: {
    label: 'Debug',
    color: colors.grey,
  },
  info: {
    label: 'Info',
    icon: <Icon name="info-circle" color={colors.cyan} />,
    color: colors.cyan,
  },
  warn: {
    label: 'Warn',
    style: {
      backgroundColor: colors.yellowTint,
      color: colors.yellow,
      fontWeight: 500,
    },
    icon: <Icon name="caution-triangle" color={colors.yellow} />,
    color: colors.yellow,
  },
  error: {
    label: 'Error',
    style: {
      backgroundColor: colors.redTint,
      color: colors.red,
      fontWeight: 500,
    },
    icon: <Icon name="caution-octagon" color={colors.red} />,
    color: colors.red,
  },
  fatal: {
    label: 'Fatal',
    style: {
      backgroundColor: colors.redTint,
      color: colors.red,
      fontWeight: 700,
    },
    icon: <Icon name="stop" color={colors.red} />,
    color: colors.red,
  },
};

const DEFAULT_FILTERS = [
  {
    type: 'enum',
    enum: Object.keys(LOG_TYPES).map(value => ({
      label: LOG_TYPES[value].label,
      value,
    })),
    key: 'type',
    value: [],
    persistent: true,
  },
];

const NonSelectableText = Text.extends({
  alignSelf: 'baseline',
  userSelect: 'none',
  lineHeight: '130%',
  marginTop: 6,
});

const LogCount = NonSelectableText.extends(
  {
    backgroundColor: props => props.color,
    borderRadius: '999em',
    fontSize: 11,
    display: 'flex',
    justifyContent: 'center',
    alignItems: 'center',
    marginTop: 4,
    width: 16,
    height: 16,
    color: colors.white,
  },
  {
    ignoreAttributes: ['color'],
  },
);

const HiddenScrollText = NonSelectableText.extends({
  '&::-webkit-scrollbar': {
    display: 'none',
  },
});

function pad(chunk: mixed, len: number): string {
  let str = String(chunk);
  while (str.length < len) {
    str = `0${str}`;
  }
  return str;
}

export default class LogTable extends SonarDevicePlugin<LogsState> {
  static id = 'DeviceLogs';
  static title = 'Logs';
  static icon = 'arrow-right';
  static keyboardActions = ['clear', 'goToBottom', 'createPaste'];

  onKeyboardAction = (action: string) => {
    if (action === 'clear') {
      this.clearLogs();
    } else if (action === 'goToBottom') {
      this.goToBottom();
    } else if (action === 'createPaste') {
      this.createPaste();
    }
  };

  restoreSavedCounters = (): Array<Counter> => {
    const savedCounters =
      window.localStorage.getItem(LOG_WATCHER_LOCAL_STORAGE_KEY) || '[]';
    return JSON.parse(savedCounters).map((counter: Counter) => ({
      ...counter,
      expression: new RegExp(counter.label, 'gi'),
      count: 0,
    }));
  };

  state = {
    rows: [],
    entries: [],
    key2entry: {},
    initialising: true,
    highlightedRows: [],
    counters: this.restoreSavedCounters(),
  };

  tableRef: ?ManagedTable;
  columns: TableColumns;
  columnSizes: TableColumnSizes;
  columnOrder: TableColumnOrder;

  init() {
    let batch: Entries = [];
    let queued = false;
    let counter = 0;

    const supportedColumns = this.device.supportedColumns();
    this.columns = keepKeys(COLUMNS, supportedColumns);
    this.columnSizes = keepKeys(COLUMN_SIZE, supportedColumns);
    this.columnOrder = INITIAL_COLUMN_ORDER.filter(obj =>
      supportedColumns.includes(obj.key),
    );

    this.device.addLogListener((entry: DeviceLogEntry) => {
      const {icon, style} =
        LOG_TYPES[(entry.type: string)] || LOG_TYPES.verbose;

      // clean message
      const message = entry.message.trim();
      entry.type === 'error';

      let counterUpdated = false;
      const counters = this.state.counters.map(counter => {
        if (message.match(counter.expression)) {
          counterUpdated = true;
          if (counter.notify) {
            new window.Notification(`${counter.label}`, {
              body: 'The watched log message appeared',
            });
          }
          return {
            ...counter,
            count: counter.count + 1,
          };
        } else {
          return counter;
        }
      });
      if (counterUpdated) {
        this.setState({counters});
      }

      // build the item, it will either be batched or added straight away
      const item = {
        entry,
        row: {
          columns: {
            type: {
              value: icon,
            },
            time: {
              value: (
                <HiddenScrollText code={true}>
                  {entry.date.toTimeString().split(' ')[0] +
                    '.' +
                    pad(entry.date.getMilliseconds(), 3)}
                </HiddenScrollText>
              ),
            },
            message: {
              value: <HiddenScrollText code={true}>{message}</HiddenScrollText>,
            },
            tag: {
              value: (
                <NonSelectableText code={true}>{entry.tag}</NonSelectableText>
              ),
              isFilterable: true,
            },
            pid: {
              value: (
                <NonSelectableText code={true}>
                  {String(entry.pid)}
                </NonSelectableText>
              ),
              isFilterable: true,
            },
            tid: {
              value: (
                <NonSelectableText code={true}>
                  {String(entry.tid)}
                </NonSelectableText>
              ),
              isFilterable: true,
            },
            app: {
              value: (
                <NonSelectableText code={true}>{entry.app}</NonSelectableText>
              ),
              isFilterable: true,
            },
          },
          height: getLineCount(message) * 15 + 10, // 15px per line height + 8px padding
          style,
          type: entry.type,
          filterValue: entry.message,
          key: String(counter++),
        },
      };

      // batch up logs to be processed every 250ms, if we have lots of log
      // messages coming in, then calling an setState 200+ times is actually
      // pretty expensive
      batch.push(item);

      if (!queued) {
        queued = true;

        setTimeout(() => {
          const thisBatch = batch;
          batch = [];
          queued = false;

          // update rows/entries
          this.setState(state => {
            const rows = [...state.rows];
            const entries = [...state.entries];
            const key2entry = {...state.key2entry};

            for (let i = 0; i < thisBatch.length; i++) {
              const {entry, row} = thisBatch[i];
              entries.push({row, entry});
              key2entry[row.key] = entry;

              let previousEntry: ?DeviceLogEntry = null;

              if (i > 0) {
                previousEntry = thisBatch[i - 1].entry;
              } else if (state.rows.length > 0 && state.entries.length > 0) {
                previousEntry = state.entries[state.entries.length - 1].entry;
              }

              this.addRowIfNeeded(rows, row, entry, previousEntry);
            }

            return {
              entries,
              rows,
              key2entry,
            };
          });
        }, 100);
      }
    });

    setTimeout(() => {
      this.setState({
        initialising: false,
      });
    }, 2000);
  }

  addRowIfNeeded(
    rows: Array<TableBodyRow>,
    row: TableBodyRow,
    entry: DeviceLogEntry,
    previousEntry: ?DeviceLogEntry,
  ) {
    const previousRow = rows.length > 0 ? rows[rows.length - 1] : null;
    if (
      previousRow &&
      previousEntry &&
      entry.message === previousEntry.message &&
      entry.tag === previousEntry.tag &&
      previousRow.type != null
    ) {
      const count = (previousRow.columns.time.value.props.count || 1) + 1;
      previousRow.columns.type.value = (
        <LogCount color={LOG_TYPES[previousRow.type].color}>{count}</LogCount>
      );
    } else {
      rows.push(row);
    }
  }

  clearLogs = () => {
    this.setState({
      entries: [],
      rows: [],
      highlightedRows: [],
      key2entry: {},
      counters: this.state.counters.map(counter => ({
        ...counter,
        count: 0,
      })),
    });
  };

  createPaste = () => {
    let paste = '';
    const mapFn = row =>
      Object.keys(COLUMNS)
        .map(key => textContent(row.columns[key].value))
        .join('\t');

    if (this.state.highlightedRows.length > 0) {
      // create paste from selection
      paste = this.state.rows
        .filter(row => this.state.highlightedRows.indexOf(row.key) > -1)
        .map(mapFn)
        .join('\n');
    } else {
      // create paste with all rows
      paste = this.state.rows.map(mapFn).join('\n');
    }
    createPaste(paste);
  };

  setTableRef = (ref: React.ElementRef<*>) => {
    this.tableRef = ref;
  };

  goToBottom = () => {
    if (this.tableRef != null) {
      this.tableRef.scrollToBottom();
    }
  };

  onRowHighlighted = (highlightedRows: Array<string>) => {
    this.setState({
      ...this.state,
      highlightedRows,
    });
  };

  renderSidebar = () => {
    return (
      <LogWatcher
        counters={this.state.counters}
        onChange={counters =>
          this.setState({counters}, () =>
            window.localStorage.setItem(
              LOG_WATCHER_LOCAL_STORAGE_KEY,
              JSON.stringify(this.state.counters),
            ),
          )
        }
      />
    );
  };

  static ContextMenu = ContextMenu.extends({
    flex: 1,
  });

  render() {
    const {initialising, highlightedRows, rows} = this.state;

    const contextMenuItems = [
      {
        type: 'separator',
      },
      {
        label: 'Clear all',
        click: this.clearLogs,
      },
    ];
    return initialising ? (
      <FlexCenter fill={true}>
        <LoadingIndicator />
      </FlexCenter>
    ) : (
      <LogTable.ContextMenu items={contextMenuItems} component={FlexColumn}>
        <SearchableTable
          innerRef={this.setTableRef}
          floating={false}
          multiline={true}
          columnSizes={this.columnSizes}
          columnOrder={this.columnOrder}
          columns={this.columns}
          stickyBottom={highlightedRows.length === 0}
          rows={rows}
          onRowHighlighted={this.onRowHighlighted}
          multiHighlight={true}
          defaultFilters={DEFAULT_FILTERS}
          zebra={false}
          actions={<Button onClick={this.clearLogs}>Clear Logs</Button>}
        />
      </LogTable.ContextMenu>
    );
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import {
  PureComponent,
  FlexColumn,
  Panel,
  Input,
  Toolbar,
  Text,
  ManagedTable,
  Button,
  colors,
} from 'sonar';

export type Counter = {
  expression: RegExp,
  count: number,
  notify: boolean,
  label: string,
};

type Props = {|
  onChange: (counters: Array<Counter>) => void,
  counters: Array<Counter>,
|};

type State = {
  input: string,
  highlightedRow: ?string,
};

const ColumnSizes = {
  expression: '70%',
  count: '15%',
  notify: 'flex',
};

const Columns = {
  expression: {
    value: 'Expression',
    resizable: false,
  },
  count: {
    value: 'Count',
    resizable: false,
  },
  notify: {
    value: 'Notify',
    resizable: false,
  },
};

const Count = Text.extends({
  alignSelf: 'center',
  background: colors.macOSHighlightActive,
  color: colors.white,
  fontSize: 12,
  fontWeight: 500,
  textAlign: 'center',
  borderRadius: '999em',
  padding: '4px 9px 3px',
  lineHeight: '100%',
  marginLeft: 'auto',
});

const Checkbox = Input.extends({
  lineHeight: '100%',
  padding: 0,
  margin: 0,
  height: 'auto',
  alignSelf: 'center',
});

const ExpressionInput = Input.extends({
  flexGrow: 1,
});

const WatcherPanel = Panel.extends({
  minHeight: 200,
});

export default class LogWatcher extends PureComponent<Props, State> {
  state = {
    input: '',
    highlightedRow: null,
  };

  _inputRef: ?HTMLInputElement;

  onAdd = () => {
    if (
      this.props.counters.findIndex(({label}) => label === this.state.input) >
      -1
    ) {
      // prevent duplicates
      return;
    }
    this.props.onChange([
      ...this.props.counters,
      {
        label: this.state.input,
        expression: new RegExp(this.state.input, 'gi'),
        notify: false,
        count: 0,
      },
    ]);
    this.setState({input: ''});
  };

  onChange = (e: SyntheticInputEvent<HTMLInputElement>) => {
    this.setState({
      input: e.target.value,
    });
  };

  resetCount = (index: number) => {
    const newCounters = [...this.props.counters];
    newCounters[index] = {
      ...newCounters[index],
      count: 0,
    };
    this.props.onChange(newCounters);
  };

  buildRows = () => {
    return this.props.counters.map(({label, count, notify}, i) => ({
      columns: {
        expression: {
          value: <Text code={true}>{label}</Text>,
        },
        count: {
          value: <Count onClick={() => this.resetCount(i)}>{count}</Count>,
        },
        notify: {
          value: (
            <Checkbox
              type="checkbox"
              checked={notify}
              onChange={() => this.setNotification(i, !notify)}
            />
          ),
        },
      },
      key: label,
    }));
  };

  setNotification = (index: number, notify: boolean) => {
    const newCounters: Array<Counter> = [...this.props.counters];
    newCounters[index] = {
      ...newCounters[index],
      notify,
    };
    this.props.onChange(newCounters);
  };

  onRowHighlighted = (rows: Array<string>) => {
    this.setState({
      highlightedRow: rows.length === 1 ? rows[0] : null,
    });
  };

  onKeyDown = (e: SyntheticKeyboardEvent<>) => {
    if (
      (e.key === 'Delete' || e.key === 'Backspace') &&
      this.state.highlightedRow != null
    ) {
      this.props.onChange(
        this.props.counters.filter(
          ({label}) => label !== this.state.highlightedRow,
        ),
      );
    }
  };

  onSubmit = (e: SyntheticKeyboardEvent<>) => {
    if (e.key === 'Enter') {
      this.onAdd();
    }
  };

  render() {
    return (
      <FlexColumn fill={true} tabIndex={-1} onKeyDown={this.onKeyDown}>
        <WatcherPanel
          heading="Expression Watcher"
          floating={false}
          padded={false}>
          <Toolbar>
            <ExpressionInput
              value={this.state.input}
              placeholder="Expression..."
              onChange={this.onChange}
              onKeyDown={this.onSubmit}
            />
            <Button onClick={this.onAdd}>Add counter</Button>
          </Toolbar>
          <ManagedTable
            onRowHighlighted={this.onRowHighlighted}
            columnSizes={ColumnSizes}
            columns={Columns}
            rows={this.buildRows()}
            autoHeight={true}
            floating={false}
            zebra={false}
          />
        </WatcherPanel>
      </FlexColumn>
    );
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import {SonarDevicePlugin} from 'sonar';

import {
  Button,
  FlexColumn,
  FlexRow,
  LoadingIndicator,
  styled,
  colors,
  Component,
} from 'sonar';

const os = require('os');
const fs = require('fs');
const adb = require('adbkit-fb');
const path = require('path');
const exec = require('child_process').exec;
const SCREENSHOT_FILE_NAME = 'screen.png';
const VIDEO_FILE_NAME = 'video.mp4';
const SCREENSHOT_PATH = path.join(
  os.homedir(),
  '/.sonar/',
  SCREENSHOT_FILE_NAME,
);
const VIDEO_PATH = path.join(os.homedir(), '.sonar', VIDEO_FILE_NAME);

type AndroidDevice = any;
type AdbClient = any;
type PullTransfer = any;

type State = {|
  pullingData: boolean,
  recording: boolean,
  recordingEnabled: boolean,
  capturingScreenshot: boolean,
|};

const BigButton = Button.extends({
  height: 200,
  width: 200,
  flexGrow: 1,
  fontSize: 24,
});

const ButtonContainer = FlexRow.extends({
  alignItems: 'center',
  justifyContent: 'space-around',
  padding: 20,
});

const LoadingSpinnerContainer = FlexRow.extends({
  flexGrow: 1,
  padding: 24,
  justifyContent: 'center',
  alignItems: 'center',
});

const LoadingSpinnerText = styled.text({
  fontSize: 24,
  marginLeft: 12,
  color: colors.grey,
});

class LoadingSpinner extends Component<{}, {}> {
  render() {
    return (
      <LoadingSpinnerContainer>
        <LoadingIndicator />
        <LoadingSpinnerText>Pulling files from device...</LoadingSpinnerText>
      </LoadingSpinnerContainer>
    );
  }
}

function openFile(path: string): Promise<*> {
  return new Promise((resolve, reject) => {
    exec(`${getOpenCommand()} ${path}`, (error, stdout, stderr) => {
      if (error) {
        reject(error);
      } else {
        resolve(path);
      }
    });
  });
}

function getOpenCommand(): string {
  //TODO: TESTED ONLY ON MAC!
  switch (os.platform()) {
    case 'win32':
      return 'start';
    case 'linux':
      return 'xdg-open';
    default:
      return 'open';
  }
}

function writePngStreamToFile(stream: PullTransfer): Promise<string> {
  return new Promise((resolve, reject) => {
    stream.on('end', () => {
      resolve(SCREENSHOT_PATH);
    });
    stream.on('error', reject);
    stream.pipe(fs.createWriteStream(SCREENSHOT_PATH));
  });
}

export default class ScreenPlugin extends SonarDevicePlugin<State> {
  static id = 'DeviceScreen';
  static title = 'Screen';
  static icon = 'mobile';

  device: AndroidDevice;
  adbClient: AdbClient;

  init() {
    this.adbClient = this.device.adb;

    this.executeShell(
      `[ ! -f /system/bin/screenrecord ] && echo "File does not exist"`,
    ).then(output => {
      if (output) {
        console.error(
          'screenrecord util does not exist. Most likely it is an emulator which does not support screen recording via adb',
        );
        this.setState({
          recordingEnabled: false,
        });
      } else {
        this.setState({
          recordingEnabled: true,
        });
      }
    });
  }

  captureScreenshot = () => {
    return this.adbClient
      .screencap(this.device.serial)
      .then(writePngStreamToFile)
      .then(openFile)
      .catch(error => {
        //TODO: proper logging?
        console.error(error);
      });
  };

  pullFromDevice = (src: string, dst: string): Promise<string> => {
    return new Promise((resolve, reject) => {
      return this.adbClient.pull(this.device.serial, src).then(stream => {
        stream.on('end', () => {
          resolve(dst);
        });
        stream.on('error', reject);
        stream.pipe(fs.createWriteStream(dst));
      });
    });
  };

  onRecordingClicked = () => {
    if (this.state.recording) {
      this.stopRecording();
    } else {
      this.startRecording();
    }
  };

  onScreenshotClicked = () => {
    var self = this;
    this.setState({
      capturingScreenshot: true,
    });
    this.captureScreenshot().then(() => {
      self.setState({
        capturingScreenshot: false,
      });
    });
  };

  startRecording = () => {
    const self = this;
    this.setState({
      recording: true,
    });
    this.executeShell(`screenrecord --bugreport /sdcard/${VIDEO_FILE_NAME}`)
      .then(output => {
        if (output) {
          throw output;
        }
      })
      .then(() => {
        self.setState({
          recording: false,
          pullingData: true,
        });
      })
      .then(
        (): Promise<string> => {
          return self.pullFromDevice(`/sdcard/${VIDEO_FILE_NAME}`, VIDEO_PATH);
        },
      )
      .then(openFile)
      .then(() => {
        self.executeShell(`rm /sdcard/${VIDEO_FILE_NAME}`);
      })
      .then(() => {
        self.setState({
          pullingData: false,
        });
      })
      .catch(error => {
        console.error(`unable to capture video: ${error}`);
        self.setState({
          recording: false,
          pullingData: false,
        });
      });
  };

  stopRecording = () => {
    this.executeShell(`pgrep 'screenrecord' -L 2`);
  };

  executeShell = (command: string): Promise<string> => {
    return this.adbClient
      .shell(this.device.serial, command)
      .then(adb.util.readAll)
      .then(output => {
        return new Promise((resolve, reject) => {
          resolve(output.toString().trim());
        });
      });
  };

  getLoadingSpinner = () => {
    return this.state.pullingData ? <LoadingSpinner /> : null;
  };

  render() {
    const recordingEnabled =
      this.state.recordingEnabled &&
      !this.state.capturingScreenshot &&
      !this.state.pullingData;
    const screenshotEnabled =
      !this.state.recording &&
      !this.state.capturingScreenshot &&
      !this.state.pullingData;
    return (
      <FlexColumn>
        <ButtonContainer>
          <BigButton
            key="video_btn"
            onClick={!recordingEnabled ? null : this.onRecordingClicked}
            icon={this.state.recording ? 'stop' : 'camcorder'}
            disabled={!recordingEnabled}
            selected={true}
            pulse={this.state.recording}
            iconSize={24}>
            {!this.state.recording ? 'Record screen' : 'Stop recording'}
          </BigButton>
          <BigButton
            key="screenshot_btn"
            icon="camera"
            selected={true}
            onClick={!screenshotEnabled ? null : this.onScreenshotClicked}
            iconSize={24}
            pulse={this.state.capturingScreenshot}
            disabled={!screenshotEnabled}>
            Take screenshot
          </BigButton>
        </ButtonContainer>
        {this.getLoadingSpinner()}
      </FlexColumn>
    );
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type {DeviceType, DeviceShell, DeviceLogListener} from './BaseDevice.js';

import {Priority} from 'adbkit-logcat-fb';
import child_process from 'child_process';

// TODO
import BaseDevice from './BaseDevice.js';

type ADBClient = any;

export default class AndroidDevice extends BaseDevice {
  constructor(
    serial: string,
    deviceType: DeviceType,
    title: string,
    adb: ADBClient,
  ) {
    super(serial, deviceType, title);
    this.adb = adb;
    if (deviceType == 'physical') {
      this.supportedPlugins.push('DeviceCPU');
    }
  }

  supportedPlugins = [
    'DeviceLogs',
    'DeviceShell',
    'DeviceFiles',
    'DeviceScreen',
  ];
  icon = 'icons/android.svg';
  os = 'Android';
  adb: ADBClient;
  pidAppMapping: {[key: number]: string} = {};

  supportedColumns(): Array<string> {
    return ['date', 'pid', 'tid', 'tag', 'message', 'type', 'time'];
  }

  addLogListener(callback: DeviceLogListener) {
    this.adb.openLogcat(this.serial).then(reader => {
      reader.on('entry', async entry => {
        let type = 'unknown';
        if (entry.priority === Priority.VERBOSE) {
          type = 'verbose';
        }
        if (entry.priority === Priority.DEBUG) {
          type = 'debug';
        }
        if (entry.priority === Priority.INFO) {
          type = 'info';
        }
        if (entry.priority === Priority.WARN) {
          type = 'warn';
        }
        if (entry.priority === Priority.ERROR) {
          type = 'error';
        }
        if (entry.priority === Priority.FATAL) {
          type = 'fatal';
        }

        callback({
          tag: entry.tag,
          pid: entry.pid,
          tid: entry.tid,
          message: entry.message,
          date: entry.date,
          type,
        });
      });
    });
  }

  reverse(): Promise<void> {
    if (this.deviceType === 'physical') {
      return this.adb
        .reverse(this.serial, 'tcp:8088', 'tcp:8088')
        .then(_ => this.adb.reverse(this.serial, 'tcp:8089', 'tcp:8089'));
    } else {
      return Promise.resolve();
    }
  }

  spawnShell(): DeviceShell {
    return child_process.spawn('adb', ['-s', this.serial, 'shell', '-t', '-t']);
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type stream from 'stream';
import {SonarDevicePlugin} from 'sonar';

export type DeviceLogEntry = {
  date: Date,
  pid: number,
  tid: number,
  app?: string,
  type: 'unknown' | 'verbose' | 'debug' | 'info' | 'warn' | 'error' | 'fatal',
  tag: string,
  message: string,
};

export type DeviceShell = {
  stdout: stream.Readable,
  stderr: stream.Readable,
  stdin: stream.Writable,
};

export type DeviceLogListener = (entry: DeviceLogEntry) => void;

export type DeviceType = 'emulator' | 'physical';

export default class BaseDevice {
  constructor(serial: string, deviceType: DeviceType, title: string) {
    this.serial = serial;
    this.title = title;
    this.deviceType = deviceType;
  }

  // operating system of this device
  os: string;

  // human readable name for this device
  title: string;

  // type of this device
  deviceType: DeviceType;

  // serial number for this device
  serial: string;

  // supported device plugins for this platform
  supportedPlugins: Array<string> = [];

  // possible src of icon to display next to the device title
  icon: ?string;

  supportsPlugin(DevicePlugin: Class<SonarDevicePlugin<>>) {
    return this.supportedPlugins.includes(DevicePlugin.id);
  }

  // ensure that we don't serialise devices
  toJSON() {
    return null;
  }

  teardown() {}

  supportedColumns(): Array<string> {
    throw new Error('unimplemented');
  }

  addLogListener(listener: DeviceLogListener) {
    throw new Error('unimplemented');
  }

  spawnShell(): DeviceShell {
    throw new Error('unimplemented');
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type {
  DeviceType,
  DeviceLogEntry,
  DeviceLogListener,
} from './BaseDevice.js';
import child_process from 'child_process';
import BaseDevice from './BaseDevice.js';
import JSONStream from 'JSONStream';
import {Transform} from 'stream';

type RawLogEntry = {
  activityID: string, // Number in string format
  eventMessage: string,
  eventType: string,
  machTimestamp: number,
  processID: number,
  processImagePath: string,
  processImageUUID: string,
  processUniqueID: number,
  senderImagePath: string,
  senderImageUUID: string,
  senderProgramCounter: number,
  threadID: number,
  timestamp: string, // "2017-09-27 16:21:15.771213-0400"
  timezoneName: string,
  traceID: string,
};

export default class IOSDevice extends BaseDevice {
  supportedPlugins = ['DeviceLogs'];
  icon = 'icons/ios.svg';
  os = 'iOS';

  log: any;
  buffer: string;

  constructor(serial: string, deviceType: DeviceType, title: string) {
    super(serial, deviceType, title);

    this.buffer = '';
    this.log = null;
  }

  teardown() {
    if (this.log) {
      this.log.kill();
    }
  }

  supportedColumns(): Array<string> {
    return ['date', 'pid', 'tid', 'tag', 'message', 'type', 'time'];
  }

  addLogListener(callback: DeviceLogListener) {
    if (!this.log) {
      this.log = child_process.spawn(
        'xcrun',
        [
          'simctl',
          'spawn',
          'booted',
          'log',
          'stream',
          '--style',
          'json',
          '--predicate',
          'senderImagePath contains "Containers"',
          '--info',
          '--debug',
        ],
        {},
      );

      this.log.on('error', err => {
        console.error(err);
      });

      this.log.stderr.on('data', data => {
        console.error(data.toString());
      });

      this.log.on('exit', () => {
        this.log = null;
      });
    }

    this.log.stdout
      .pipe(new StripLogPrefix())
      .pipe(JSONStream.parse('*'))
      .on('data', (data: RawLogEntry) => {
        callback(IOSDevice.parseLogEntry(data));
      });
  }

  static parseLogEntry(entry: RawLogEntry): DeviceLogEntry {
    let type = 'unknown';
    if (entry.eventMessage.indexOf('[debug]') !== -1) {
      type = 'debug';
    } else if (entry.eventMessage.indexOf('[info]') !== -1) {
      type = 'info';
    } else if (entry.eventMessage.indexOf('[warn]') !== -1) {
      type = 'warn';
    } else if (entry.eventMessage.indexOf('[error]') !== -1) {
      type = 'error';
    }

    // remove timestamp in front of message
    entry.eventMessage = entry.eventMessage.replace(
      /^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}\.\d{3} /,
      '',
    );

    // remove type from mesage
    entry.eventMessage = entry.eventMessage.replace(
      /^\[(debug|info|warn|error)\]/,
      '',
    );

    const tags = entry.processImagePath.split('/');
    const tag = tags[tags.length - 1];

    return {
      date: new Date(entry.timestamp),
      pid: entry.processID,
      tid: entry.threadID,
      tag,
      message: entry.eventMessage,
      type,
    };
  }
}

// Used to strip the initial output of the logging utility where it prints out settings.
// We know the log stream is json so it starts with an open brace.
class StripLogPrefix extends Transform {
  passedPrefix = false;

  _transform(
    data: any,
    encoding: string,
    callback: (err?: Error, data?: any) => void,
  ) {
    if (this.passedPrefix) {
      this.push(data);
    } else {
      const dataString = data.toString();
      const index = dataString.indexOf('[');
      if (index >= 0) {
        this.push(dataString.substring(index));
        this.passedPrefix = true;
      }
    }
    callback();
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type {
  DeviceType,
  DeviceLogEntry,
  DeviceLogListener,
} from './BaseDevice.js';

import fs from 'fs-extra';
import os from 'os';
import path from 'path';

import BaseDevice from './BaseDevice.js';

function getLogsPath(fileName: ?string): string {
  const dir = '/AppData/Local/Oculus/';
  if (fileName) {
    return path.join(os.homedir(), dir, fileName);
  }
  return path.join(os.homedir(), dir);
}

export default class OculusDevice extends BaseDevice {
  supportedPlugins = ['DeviceLogs'];
  icon = 'icons/oculus.png';
  os = 'Oculus';

  watcher: any;
  processedFileMap: {};
  watchedFile: ?string;
  timer: TimeoutID;

  constructor(serial: string, deviceType: DeviceType, title: string) {
    super(serial, deviceType, title);

    this.watcher = null;
    this.processedFileMap = {};
  }

  teardown() {
    clearTimeout(this.timer);
    const file = this.watchedFile;
    if (file) {
      fs.unwatchFile(path.join(getLogsPath(), file));
    }
  }

  supportedColumns(): Array<string> {
    return ['date', 'tag', 'message', 'type', 'time'];
  }

  mapLogLevel(type: string): $PropertyType<DeviceLogEntry, 'type'> {
    switch (type) {
      case 'WARNING':
        return 'warn';
      case '!ERROR!':
        return 'error';
      case 'DEBUG':
        return 'debug';
      case 'INFO':
        return 'info';
      default:
        return 'verbose';
    }
  }

  processText(text: Buffer, callback: DeviceLogListener) {
    text
      .toString()
      .split('\r\n')
      .forEach(line => {
        const regex = /(.*){(\S+)}\s*\[([\w :.\\]+)\](.*)/;
        const match = regex.exec(line);
        if (match && match.length === 5) {
          callback({
            tid: 0,
            pid: 0,
            date: new Date(Date.parse(match[1])),
            type: this.mapLogLevel(match[2]),
            tag: match[3],
            message: match[4],
          });
        } else if (line.trim() === '') {
          // skip
        } else {
          callback({
            tid: 0,
            pid: 0,
            date: new Date(),
            type: 'verbose',
            tag: 'failed-parse',
            message: line,
          });
        }
      });
  }

  addLogListener = (callback: DeviceLogListener) => {
    this.setupListener(callback);
  };

  async setupListener(callback: DeviceLogListener) {
    const files = await fs.readdir(getLogsPath());
    this.watchedFile = files
      .filter(file => file.startsWith('Service_'))
      .sort()
      .pop();
    this.watch(callback);
    this.timer = setTimeout(() => this.checkForNewLog(callback), 5000);
  }

  watch(callback: DeviceLogListener) {
    const filePath = getLogsPath(this.watchedFile);
    fs.watchFile(filePath, async (current, previous) => {
      const readLen = current.size - previous.size;
      const buffer = new Buffer(readLen);
      const fd = await fs.open(filePath, 'r');
      await fs.read(fd, buffer, 0, readLen, previous.size);
      this.processText(buffer, callback);
    });
  }

  async checkForNewLog(callback: DeviceLogListener) {
    const files = await fs.readdir(getLogsPath());
    const latestLog = files
      .filter(file => file.startsWith('Service_'))
      .sort()
      .pop();
    if (this.watchedFile !== latestLog) {
      const oldFilePath = getLogsPath(this.watchedFile);
      fs.unwatchFile(oldFilePath);
      this.watchedFile = latestLog;
      this.watch(callback);
    }
    this.timer = setTimeout(() => this.checkForNewLog(callback), 5000);
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import AndroidDevice from '../devices/AndroidDevice';
import type {Store} from '../reducers/index.js';
import type BaseDevice from '../devices/BaseDevice';
const adb = require('adbkit-fb');

function createDecive(client, device): Promise<AndroidDevice> {
  return new Promise((resolve, reject) => {
    const type =
      device.type !== 'device' || device.id.startsWith('emulator')
        ? 'emulator'
        : 'physical';
    client.getProperties(device.id).then(props => {
      const androidDevice = new AndroidDevice(
        device.id,
        type,
        props['ro.product.model'],
        client,
      );
      androidDevice.reverse();
      resolve(androidDevice);
    });
  });
}

export default (store: Store) => {
  const client = adb.createClient();

  client
    .trackDevices()
    .then(tracker => {
      tracker.on('error', err => {
        if (err.message === 'Connection closed') {
          // adb server has shutdown, remove all android devices
          const {devices} = store.getState();
          const deviceIDsToRemove: Array<string> = devices
            .filter((device: BaseDevice) => device instanceof AndroidDevice)
            .map((device: BaseDevice) => device.serial);

          store.dispatch({
            type: 'UNREGISTER_DEVICES',
            payload: new Set(deviceIDsToRemove),
          });
          console.error(
            'adb server shutdown. Run `adb start-server` and restart Sonar.',
          );
        } else {
          throw err;
        }
      });

      tracker.on('add', async device => {
        const androidDevice = await createDecive(client, device);
        if (device.type !== 'offline') {
          store.dispatch({
            type: 'REGISTER_DEVICE',
            payload: androidDevice,
          });
        }
      });

      tracker.on('change', async device => {
        if (device.type === 'offline') {
          store.dispatch({
            type: 'UNREGISTER_DEVICES',
            payload: new Set([device.id]),
          });
        } else {
          const androidDevice = await createDecive(client, device);
          store.dispatch({
            type: 'REGISTER_DEVICE',
            payload: androidDevice,
          });
        }
      });

      tracker.on('remove', device => {
        store.dispatch({
          type: 'UNREGISTER_DEVICES',
          payload: new Set([device.id]),
        });
      });
    })
    .catch(err => {
      if (err.code === 'ECONNREFUSED') {
        // adb server isn't running
      } else {
        throw err;
      }
    });
};
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import {remote} from 'electron';
import type {Store} from '../reducers/index.js';

export default (store: Store) => {
  const currentWindow = remote.getCurrentWindow();
  currentWindow.on('focus', () =>
    store.dispatch({
      type: 'windowIsFocused',
      payload: true,
    }),
  );
  currentWindow.on('blur', () =>
    store.dispatch({
      type: 'windowIsFocused',
      payload: false,
    }),
  );
};
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import androidDevice from './androidDevice';
import iOSDevice from './iOSDevice';
import application from './application';
import type {Store} from '../reducers/index.js';

export default (store: Store) =>
  [application, androidDevice, iOSDevice].forEach(fn => fn(store));
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type {ChildProcess} from 'child_process';
import type {Store} from '../reducers/index.js';
import child_process from 'child_process';
import IOSDevice from '../devices/IOSDevice';

type iOSSimulatorDevice = {|
  state: 'Booted' | 'Shutdown' | 'Shutting Down',
  availability: string,
  name: string,
  udid: string,
|};

type IOSDeviceMap = {[id: string]: Array<iOSSimulatorDevice>};

// start port forwarding server for real device connections
const portForwarder: ChildProcess = child_process.exec(
  'PortForwardingMacApp.app/Contents/MacOS/PortForwardingMacApp -portForward=8088 -multiplexChannelPort=8078',
);
window.addEventListener('beforeunload', () => {
  portForwarder.kill();
});

function querySimulatorDevices(): Promise<IOSDeviceMap> {
  return new Promise((resolve, reject) => {
    child_process.execFile(
      'xcrun',
      ['simctl', 'list', 'devices', '--json'],
      {encoding: 'utf8'},
      (err, stdout) => {
        if (err) {
          console.error('Failed to load iOS devices', err);
          return resolve({});
        }

        try {
          const {devices} = JSON.parse(stdout.toString());
          resolve(devices);
        } catch (err) {
          console.error('Failed to parse iOS device list', err);
          resolve({});
        }
      },
    );
  });
}

export default (store: Store) => {
  // monitoring iOS devices only available on MacOS.
  if (process.platform !== 'darwin') {
    return;
  }
  setInterval(() => {
    const {devices} = store.getState();
    querySimulatorDevices().then((simulatorDevices: IOSDeviceMap) => {
      const simulators: Array<iOSSimulatorDevice> = Object.values(
        simulatorDevices,
        // $FlowFixMe
      ).reduce((acc, cv) => acc.concat(cv), []);

      const currentDeviceIDs: Set<string> = new Set(
        devices
          .filter(device => device instanceof IOSDevice)
          .map(device => device.serial),
      );

      const deviceIDsToRemove = new Set();
      simulators.forEach((simulator: iOSSimulatorDevice) => {
        const isRunning =
          simulator.state === 'Booted' &&
          simulator.availability === '(available)';

        if (isRunning && !currentDeviceIDs.has(simulator.udid)) {
          // create device
          store.dispatch({
            type: 'REGISTER_DEVICE',
            payload: new IOSDevice(simulator.udid, 'emulator', simulator.name),
          });
        } else if (!isRunning && currentDeviceIDs.has(simulator.udid)) {
          deviceIDsToRemove.add(simulator.udid);
          // delete device
        }
      });

      if (deviceIDsToRemove.size > 0) {
        store.dispatch({
          type: 'UNREGISTER_DEVICES',
          payload: deviceIDsToRemove,
        });
      }
    });
  }, 3000);
};
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import LogManager from './Logger';

export default class BugReporter {
  constructor(logManager: LogManager) {}
  async report(title: string, body: string): Promise<number> {
    return Promise.resolve(-1);
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

export default {
  updateServer: 'https://www.facebook.com/sonar/public/latest.json',
  bugReportButtonVisible: false,
};
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

export const GRAPH_APP_ID = '';
export const GRAPH_CLIENT_TOKEN = '';
export const GRAPH_ACCESS_TOKEN = '';

// this provides elevated access to scribe. we really shouldn't be exposing this.
// need to investigate how to abstract the scribe logging so it's safe.
export const GRAPH_SECRET = '';
export const GRAPH_SECRET_ACCESS_TOKEN = '';

// Provides access to Insights Validation ednpoint on interngraph
export const INSIGHT_INTERN_APP_ID = '';
export const INSIGHT_INTERN_APP_TOKEN = '';
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

export function cleanStack(stack: string, loc: ?string) {}
import type ScribeLogger from './ScribeLogger';

export type ObjectError =
  | Error
  | {
      message: string,
      stack?: string,
    };

export default class ErrorReporter {
  constructor(scribeLogger: ScribeLogger) {}
  report(err: ObjectError) {}
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

export type GKID = string;

export default class GK {
  static init() {}

  static get(id: GKID): boolean {
    return false;
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

export type LogTypes = 'error' | 'warn' | 'info' | 'debug';
export type TrackType = 'duration' | 'usage' | 'performance';
import ScribeLogger from './ScribeLogger';

export default class LogManager {
  constructor() {
    this.scribeLogger = new ScribeLogger(this);
  }

  scribeLogger: ScribeLogger;

  track(type: TrackType, event: string, data: ?any) {}

  trackTimeSince(mark: string, eventName: ?string) {}

  info(data: any, category: string) {
    // eslint-disable-next-line
    console.info(data, category);
  }

  warn(data: any, category: string) {
    console.warn(data, category);
  }

  error(data: any, category: string) {
    console.error(data, category);
  }

  debug(data: any, category: string) {
    // eslint-disable-next-line
    console.debug(data, category);
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

export type ScribeMessage = {|
  category: string,
  message: string,
|};

import type Logger from './Logger.js';

export default class ScribeLogger {
  constructor(logger: Logger) {}
  send(message: ScribeMessage) {}
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import {GK} from 'sonar';
import React from 'react';
import ReactDOM from 'react-dom';
import * as Sonar from 'sonar';
import {SonarBasePlugin} from '../plugin.js';

const plugins = new Map();

// expose Sonar and exact globally for dynamically loaded plugins
window.React = React;
window.ReactDOM = ReactDOM;
window.Sonar = Sonar;

const addIfNotAdded = plugin => {
  if (!plugins.has(plugin.name)) {
    plugins.set(plugin.name, plugin);
  }
};

let disabledPlugins = [];
try {
  disabledPlugins =
    JSON.parse(window.process.env.CONFIG || '{}').disabledPlugins || [];
} catch (e) {
  console.error(e);
}

// Load dynamic plugins
try {
  JSON.parse(window.process.env.PLUGINS || '[]').forEach(addIfNotAdded);
} catch (e) {
  console.error(e);
}

// DefaultPlugins that are included in the bundle.
// List of defaultPlugins is written at build time
let bundledPlugins = [];
try {
  bundledPlugins = window.electronRequire('./defaultPlugins/index.json');
} catch (e) {}
bundledPlugins
  .map(plugin => ({
    ...plugin,
    out: './' + plugin.out,
  }))
  .forEach(addIfNotAdded);

export default Array.from(plugins.values())
  .map(plugin => {
    if (
      (plugin.gatekeeper && !GK.get(plugin.gatekeeper)) ||
      disabledPlugins.indexOf(plugin.name) > -1
    ) {
      return null;
    } else {
      try {
        return window.electronRequire(plugin.out);
      } catch (e) {
        console.error(plugin, e);
        return null;
      }
    }
  })
  .filter(Boolean)
  .filter(plugin => plugin.prototype instanceof SonarBasePlugin);
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type {ElementID, Element, ElementSearchResultSet} from 'sonar';
import {
  colors,
  Glyph,
  FlexRow,
  FlexColumn,
  Toolbar,
  SonarPlugin,
  ElementsInspector,
  InspectorSidebar,
  LoadingIndicator,
  styled,
  Component,
  SearchBox,
  SearchInput,
  SearchIcon,
} from 'sonar';

// $FlowFixMe
import debounce from 'lodash.debounce';

export type InspectorState = {|
  initialised: boolean,
  selected: ?ElementID,
  root: ?ElementID,
  elements: {[key: ElementID]: Element},
  isSearchActive: boolean,
  searchResults: ?ElementSearchResultSet,
  outstandingSearchQuery: ?string,
|};

type SelectElementArgs = {|
  key: ElementID,
|};

type ExpandElementArgs = {|
  key: ElementID,
  expand: boolean,
|};

type ExpandElementsArgs = {|
  elements: Array<ElementID>,
|};

type UpdateElementsArgs = {|
  elements: Array<$Shape<Element>>,
|};

type SetRootArgs = {|
  root: ElementID,
|};

type GetNodesResult = {|
  elements: Array<Element>,
|};

type SearchResultTree = {|
  id: string,
  isMatch: Boolean,
  children: ?Array<SearchResultTree>,
  element: Element,
|};

const LoadingSpinner = LoadingIndicator.extends({
  marginRight: 4,
  marginLeft: 3,
  marginTop: -1,
});

const Center = FlexRow.extends({
  alignItems: 'center',
  justifyContent: 'center',
});

const SearchIconContainer = styled.view({
  marginRight: 9,
  marginTop: -3,
  marginLeft: 4,
});

class LayoutSearchInput extends Component<
  {
    onSubmit: string => void,
  },
  {
    value: string,
  },
> {
  static TextInput = styled.textInput({
    width: '100%',
    marginLeft: 6,
  });

  state = {
    value: '',
  };

  timer: TimeoutID;

  onChange = (e: SyntheticInputEvent<>) => {
    clearTimeout(this.timer);
    this.setState({
      value: e.target.value,
    });
    this.timer = setTimeout(() => this.props.onSubmit(this.state.value), 200);
  };

  onKeyDown = (e: SyntheticKeyboardEvent<>) => {
    if (e.key === 'Enter') {
      this.props.onSubmit(this.state.value);
    }
  };

  render() {
    return (
      <SearchInput
        placeholder={'Search'}
        onChange={this.onChange}
        onKeyDown={this.onKeyDown}
        value={this.state.value}
      />
    );
  }
}

export default class Layout extends SonarPlugin<InspectorState> {
  static title = 'Layout';
  static id = 'Inspector';
  static icon = 'target';

  state = {
    elements: {},
    initialised: false,
    isSearchActive: false,
    root: null,
    selected: null,
    searchResults: null,
    outstandingSearchQuery: null,
  };

  reducers = {
    SelectElement(state: InspectorState, {key}: SelectElementArgs) {
      return {
        selected: key,
      };
    },

    ExpandElement(state: InspectorState, {expand, key}: ExpandElementArgs) {
      return {
        elements: {
          ...state.elements,
          [key]: {
            ...state.elements[key],
            expanded: expand,
          },
        },
      };
    },

    ExpandElements(state: InspectorState, {elements}: ExpandElementsArgs) {
      const expandedSet = new Set(elements);
      const newState = {
        elements: {
          ...state.elements,
        },
      };
      for (const key of Object.keys(state.elements)) {
        newState.elements[key] = {
          ...newState.elements[key],
          expanded: expandedSet.has(key),
        };
      }
      return newState;
    },

    UpdateElements(state: InspectorState, {elements}: UpdateElementsArgs) {
      const updatedElements = state.elements;

      for (const element of elements) {
        const current = updatedElements[element.id] || {};
        // $FlowFixMe
        updatedElements[element.id] = {
          ...current,
          ...element,
        };
      }

      return {elements: updatedElements};
    },

    SetRoot(state: InspectorState, {root}: SetRootArgs) {
      return {root};
    },

    SetSearchActive(
      state: InspectorState,
      {isSearchActive}: {isSearchActive: boolean},
    ) {
      return {isSearchActive};
    },
  };

  search(query: string) {
    if (!query) {
      return;
    }
    this.setState({
      outstandingSearchQuery: query,
    });
    this.client
      .call('getSearchResults', {query: query})
      .then(response => this.displaySearchResults(response));
  }

  executeCommand(command: string) {
    return this.client.call('executeCommand', {
      command: command,
      context: this.state.selected,
    });
  }

  /**
   * When opening the inspector for the first time, expand all elements that contain only 1 child
   * recursively.
   */
  async performInitialExpand(element: Element): Promise<void> {
    if (!element.children.length) {
      // element has no children so we're as deep as we can be
      return;
    }

    this.dispatchAction({expand: true, key: element.id, type: 'ExpandElement'});

    return this.getChildren(element.id).then((elements: Array<Element>) => {
      this.dispatchAction({elements, type: 'UpdateElements'});

      if (element.children.length >= 2) {
        // element has two or more children so we can stop expanding
        return;
      }

      return this.performInitialExpand(
        this.state.elements[element.children[0]],
      );
    });
  }

  displaySearchResults({
    results,
    query,
  }: {
    results: SearchResultTree,
    query: string,
  }) {
    const elements = this.getElementsFromSearchResultTree(results);
    const idsToExpand = elements
      .filter(x => x.hasChildren)
      .map(x => x.element.id);

    const finishedSearching = query === this.state.outstandingSearchQuery;

    this.dispatchAction({
      elements: elements.map(x => x.element),
      type: 'UpdateElements',
    });
    this.dispatchAction({
      elements: idsToExpand,
      type: 'ExpandElements',
    });
    this.setState({
      searchResults: {
        matches: new Set(
          elements.filter(x => x.isMatch).map(x => x.element.id),
        ),
        query: query,
      },
      outstandingSearchQuery: finishedSearching
        ? null
        : this.state.outstandingSearchQuery,
    });
  }

  getElementsFromSearchResultTree(tree: SearchResultTree) {
    if (!tree) {
      return [];
    }
    var elements = [
      {
        id: tree.id,
        isMatch: tree.isMatch,
        hasChildren: Boolean(tree.children),
        element: tree.element,
      },
    ];
    if (tree.children) {
      for (const child of tree.children) {
        elements = elements.concat(this.getElementsFromSearchResultTree(child));
      }
    }
    return elements;
  }

  init() {
    performance.mark('LayoutInspectorInitialize');
    this.client.call('getRoot').then((element: Element) => {
      this.dispatchAction({elements: [element], type: 'UpdateElements'});
      this.dispatchAction({root: element.id, type: 'SetRoot'});
      this.performInitialExpand(element).then(() => {
        this.app.logger.trackTimeSince('LayoutInspectorInitialize');
        this.setState({initialised: true});
      });
    });

    this.client.subscribe(
      'invalidate',
      ({nodes}: {nodes: Array<{id: ElementID}>}) => {
        this.invalidate(nodes.map(node => node.id)).then(
          (elements: Array<Element>) => {
            this.dispatchAction({elements, type: 'UpdateElements'});
          },
        );
      },
    );

    this.client.subscribe('select', ({path}: {path: Array<ElementID>}) => {
      this.getNodesAndDirectChildren(path).then((elements: Array<Element>) => {
        const selected = path[path.length - 1];

        this.dispatchAction({elements, type: 'UpdateElements'});
        this.dispatchAction({key: selected, type: 'SelectElement'});
        this.dispatchAction({isSearchActive: false, type: 'SetSearchActive'});

        for (const key of path) {
          this.dispatchAction({expand: true, key, type: 'ExpandElement'});
        }

        this.client.send('setHighlighted', {id: selected});
        this.client.send('setSearchActive', {active: false});
      });
    });
  }

  invalidate(ids: Array<ElementID>): Promise<Array<Element>> {
    if (ids.length === 0) {
      return Promise.resolve([]);
    }

    return this.getNodes(ids, true).then((elements: Array<Element>) => {
      const children = elements
        .filter(element => {
          const prev = this.state.elements[element.id];
          return prev && prev.expanded;
        })
        .map(element => element.children)
        .reduce((acc, val) => acc.concat(val), []);

      return Promise.all([elements, this.invalidate(children)]).then(arr => {
        return arr.reduce((acc, val) => acc.concat(val), []);
      });
    });
  }

  getNodesAndDirectChildren(ids: Array<ElementID>): Promise<Array<Element>> {
    return this.getNodes(ids, false).then((elements: Array<Element>) => {
      const children = elements
        .map(element => element.children)
        .reduce((acc, val) => acc.concat(val), []);

      return Promise.all([elements, this.getNodes(children, false)]).then(
        arr => {
          return arr.reduce((acc, val) => acc.concat(val), []);
        },
      );
    });
  }

  getChildren(key: ElementID): Promise<Array<Element>> {
    return this.getNodes(this.state.elements[key].children, false);
  }

  getNodes(
    ids: Array<ElementID> = [],
    force: boolean,
  ): Promise<Array<Element>> {
    if (!force) {
      ids = ids.filter(id => {
        return this.state.elements[id] === undefined;
      });
    }

    if (ids.length > 0) {
      performance.mark('LayoutInspectorGetNodes');
      return this.client
        .call('getNodes', {ids})
        .then(({elements}: GetNodesResult) => {
          this.app.logger.trackTimeSince('LayoutInspectorGetNodes');
          return Promise.resolve(elements);
        });
    } else {
      return Promise.resolve([]);
    }
  }

  isExpanded(key: ElementID): boolean {
    return this.state.elements[key].expanded;
  }

  expandElement = (key: ElementID): Promise<Array<Element>> => {
    const expand = !this.isExpanded(key);
    return this.setElementExpanded(key, expand);
  };

  setElementExpanded = (
    key: ElementID,
    expand: boolean,
  ): Promise<Array<Element>> => {
    this.dispatchAction({expand, key, type: 'ExpandElement'});
    performance.mark('LayoutInspectorExpandElement');
    if (expand) {
      return this.getChildren(key).then((elements: Array<Element>) => {
        this.app.logger.trackTimeSince('LayoutInspectorExpandElement');
        this.dispatchAction({elements, type: 'UpdateElements'});
        return Promise.resolve(elements);
      });
    } else {
      return Promise.resolve([]);
    }
  };

  deepExpandElement = async (key: ElementID) => {
    const expand = !this.isExpanded(key);
    if (!expand) {
      // we never deep unexpand
      return this.setElementExpanded(key, false);
    }

    // queue of keys to open
    const keys = [key];

    // amount of elements we've expanded, we stop at 100 just to be safe
    let count = 0;

    while (keys.length && count < 100) {
      const key = keys.shift();

      // expand current element
      const children = await this.setElementExpanded(key, true);

      // and add it's children to the queue
      for (const child of children) {
        keys.push(child.id);
      }

      count++;
    }
  };

  onElementExpanded = (key: ElementID, deep: boolean) => {
    if (deep) {
      this.deepExpandElement(key);
    } else {
      this.expandElement(key);
    }
    this.app.logger.track('usage', 'layout:element-expanded', {
      id: key,
      deep: deep,
    });
  };

  onFindClick = () => {
    const isSearchActive = !this.state.isSearchActive;
    this.dispatchAction({isSearchActive, type: 'SetSearchActive'});
    this.client.send('setSearchActive', {active: isSearchActive});
  };

  onElementSelected = debounce((key: ElementID) => {
    this.dispatchAction({key, type: 'SelectElement'});
    this.client.send('setHighlighted', {id: key});
    this.getNodes([key], true).then((elements: Array<Element>) => {
      this.dispatchAction({elements, type: 'UpdateElements'});
    });
  });

  onElementHovered = debounce((key: ?ElementID) => {
    this.client.send('setHighlighted', {id: key});
  });

  onDataValueChanged = (path: Array<string>, value: any) => {
    this.client.send('setData', {id: this.state.selected, path, value});
    this.app.logger.track('usage', 'layout:value-changed', {
      id: this.state.selected,
      value: value,
      path: path,
    });
  };

  renderSidebar = () => {
    return this.state.selected != null ? (
      <InspectorSidebar
        element={this.state.elements[this.state.selected]}
        onValueChanged={this.onDataValueChanged}
        client={this.client}
      />
    ) : null;
  };

  render() {
    const {
      initialised,
      selected,
      root,
      elements,
      isSearchActive,
      outstandingSearchQuery,
    } = this.state;

    return (
      <FlexColumn fill={true}>
        <Toolbar>
          <SearchIconContainer
            onClick={this.onFindClick}
            role="button"
            tabIndex={-1}
            title="Select an element on the device to inspect it">
            <Glyph
              name="target"
              size={16}
              color={
                isSearchActive
                  ? colors.macOSTitleBarIconSelected
                  : colors.macOSTitleBarIconActive
              }
            />
          </SearchIconContainer>
          <SearchBox tabIndex={-1}>
            <SearchIcon
              name="magnifying-glass"
              color={colors.macOSTitleBarIcon}
              size={16}
            />
            <LayoutSearchInput onSubmit={this.search.bind(this)} />
            {outstandingSearchQuery && <LoadingSpinner size={16} />}
          </SearchBox>
        </Toolbar>
        <FlexRow fill={true}>
          {initialised ? (
            <ElementsInspector
              onElementSelected={this.onElementSelected}
              onElementHovered={this.onElementHovered}
              onElementExpanded={this.onElementExpanded}
              onValueChanged={this.onDataValueChanged}
              selected={selected}
              searchResults={this.state.searchResults}
              root={root}
              elements={elements}
            />
          ) : (
            <Center fill={true}>
              <LoadingIndicator />
            </Center>
          )}
        </FlexRow>
      </FlexColumn>
    );
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type {TableHighlightedRows, TableRows} from 'sonar';

import {
  ContextMenu,
  FlexColumn,
  Button,
  Text,
  Glyph,
  colors,
  PureComponent,
} from 'sonar';

import {SonarPlugin, SearchableTable} from 'sonar';
import RequestDetails from './RequestDetails.js';

import {URL} from 'url';
// $FlowFixMe
import sortBy from 'lodash.sortby';

type RequestId = string;

type State = {|
  requests: {[id: RequestId]: Request},
  responses: {[id: RequestId]: Response},
  selectedIds: Array<RequestId>,
|};

export type Request = {|
  id: RequestId,
  timestamp: number,
  method: string,
  url: string,
  headers: Array<Header>,
  data: ?string,
|};

export type Response = {|
  id: RequestId,
  timestamp: number,
  status: number,
  reason: string,
  headers: Array<Header>,
  data: ?string,
|};

export type Header = {|
  key: string,
  value: string,
|};

const COLUMN_SIZE = {
  domain: 'flex',
  method: 100,
  status: 70,
  size: 100,
  duration: 100,
};

const COLUMNS = {
  domain: {
    value: 'Domain',
  },
  method: {
    value: 'Method',
  },
  status: {
    value: 'Status',
  },
  size: {
    value: 'Size',
  },
  duration: {
    value: 'Duration',
  },
};

export function getHeaderValue(headers: Array<Header>, key: string) {
  for (const header of headers) {
    if (header.key.toLowerCase() === key.toLowerCase()) {
      return header.value;
    }
  }
  return '';
}

export function formatBytes(count: number): string {
  if (count > 1024 * 1024) {
    return (count / (1024.0 * 1024)).toFixed(1) + ' MB';
  }
  if (count > 1024) {
    return (count / 1024.0).toFixed(1) + ' kB';
  }
  return count + ' B';
}

const TextEllipsis = Text.extends({
  overflowX: 'hidden',
  textOverflow: 'ellipsis',
  maxWidth: '100%',
  lineHeight: '18px',
  paddingTop: 4,
});

export default class extends SonarPlugin<State> {
  static title = 'Network';
  static id = 'Network';
  static icon = 'internet';
  static keyboardActions = ['clear'];

  onKeyboardAction = (action: string) => {
    if (action === 'clear') {
      this.clearLogs();
    }
  };

  state = {
    requests: {},
    responses: {},
    selectedIds: [],
  };

  init() {
    this.client.subscribe('newRequest', (request: Request) => {
      this.dispatchAction({request, type: 'NewRequest'});
    });
    this.client.subscribe('newResponse', (response: Response) => {
      this.dispatchAction({response, type: 'NewResponse'});
    });
  }

  reducers = {
    NewRequest(state: State, {request}: {request: Request}) {
      return {
        requests: {...state.requests, [request.id]: request},
        responses: state.responses,
      };
    },

    NewResponse(state: State, {response}: {response: Response}) {
      return {
        requests: state.requests,
        responses: {...state.responses, [response.id]: response},
      };
    },

    Clear(state: State) {
      return {
        requests: {},
        responses: {},
      };
    },
  };

  onRowHighlighted = (selectedIds: Array<RequestId>) =>
    this.setState({selectedIds});

  clearLogs = () => {
    this.setState({selectedIds: []});
    this.dispatchAction({type: 'Clear'});
  };

  renderSidebar = () => {
    const {selectedIds, requests, responses} = this.state;
    const selectedId = selectedIds.length === 1 ? selectedIds[0] : null;

    return selectedId != null ? (
      <RequestDetails
        key={selectedId}
        request={requests[selectedId]}
        response={responses[selectedId]}
      />
    ) : null;
  };

  render() {
    return (
      <FlexColumn fill={true}>
        <NetworkTable
          requests={this.state.requests}
          responses={this.state.responses}
          clear={this.clearLogs}
          onRowHighlighted={this.onRowHighlighted}
        />
      </FlexColumn>
    );
  }
}

type NetworkTableProps = {|
  requests: {[id: RequestId]: Request},
  responses: {[id: RequestId]: Response},
  clear: () => void,
  onRowHighlighted: (keys: TableHighlightedRows) => void,
|};

type NetworkTableState = {|
  sortedRows: TableRows,
|};

class NetworkTable extends PureComponent<NetworkTableProps, NetworkTableState> {
  static ContextMenu = ContextMenu.extends({
    flex: 1,
  });

  state = {
    sortedRows: [],
  };

  componentWillReceiveProps(nextProps: NetworkTableProps) {
    if (Object.keys(nextProps.requests).length === 0) {
      // cleared
      this.setState({sortedRows: []});
    } else if (this.props.requests !== nextProps.requests) {
      // new request
      for (const requestId in nextProps.requests) {
        if (this.props.requests[requestId] == null) {
          this.buildRow(nextProps.requests[requestId], null);
          break;
        }
      }
    } else if (this.props.responses !== nextProps.responses) {
      // new response
      for (const responseId in nextProps.responses) {
        if (this.props.responses[responseId] == null) {
          this.buildRow(
            nextProps.requests[responseId],
            nextProps.responses[responseId],
          );
          break;
        }
      }
    }
  }

  buildRow(request: Request, response: ?Response) {
    if (request == null) {
      return;
    }
    const url = new URL(request.url);
    const domain = url.host + url.pathname;
    const friendlyName = getHeaderValue(request.headers, 'X-FB-Friendly-Name');

    const newRow = {
      columns: {
        domain: {
          value: (
            <TextEllipsis>{friendlyName ? friendlyName : domain}</TextEllipsis>
          ),
          isFilterable: true,
        },
        method: {
          value: <TextEllipsis>{request.method}</TextEllipsis>,
          isFilterable: true,
        },
        status: {
          value: (
            <StatusColumn>
              {response ? response.status : undefined}
            </StatusColumn>
          ),
          isFilterable: true,
        },
        size: {
          value: <SizeColumn response={response ? response : undefined} />,
        },
        duration: {
          value: <DurationColumn request={request} response={response} />,
        },
      },
      key: request.id,
      filterValue: `${request.method} ${request.url}`,
      sortKey: request.timestamp,
      copyText: request.url,
      highlightOnHover: true,
    };

    let rows;
    if (response == null) {
      rows = [...this.state.sortedRows, newRow];
    } else {
      const index = this.state.sortedRows.findIndex(r => r.key === request.id);
      if (index > -1) {
        rows = [...this.state.sortedRows];
        rows[index] = newRow;
      }
    }

    this.setState({
      sortedRows: sortBy(rows, x => x.sortKey),
    });
  }

  contextMenuItems = [
    {
      type: 'separator',
    },
    {
      label: 'Clear all',
      click: this.props.clear,
    },
  ];

  render() {
    return (
      <NetworkTable.ContextMenu items={this.contextMenuItems}>
        <SearchableTable
          virtual={true}
          multiline={false}
          multiHighlight={true}
          stickyBottom={true}
          floating={false}
          columnSizes={COLUMN_SIZE}
          columns={COLUMNS}
          rows={this.state.sortedRows}
          onRowHighlighted={this.props.onRowHighlighted}
          rowLineHeight={26}
          zebra={false}
          actions={<Button onClick={this.props.clear}>Clear Table</Button>}
        />
      </NetworkTable.ContextMenu>
    );
  }
}

const Icon = Glyph.extends({
  marginTop: -3,
  marginRight: 3,
});

class StatusColumn extends PureComponent<{
  children?: number,
}> {
  render() {
    const {children} = this.props;
    let glyph;

    if (children != null && children >= 400 && children < 600) {
      glyph = <Icon name="stop-solid" color={colors.red} />;
    }

    return (
      <TextEllipsis>
        {glyph}
        {children}
      </TextEllipsis>
    );
  }
}

class DurationColumn extends PureComponent<{
  request: Request,
  response: ?Response,
}> {
  static Text = Text.extends({
    flex: 1,
    textAlign: 'right',
    paddingRight: 10,
  });

  render() {
    const {request, response} = this.props;
    const duration = response
      ? response.timestamp - request.timestamp
      : undefined;
    return (
      <DurationColumn.Text selectable={false}>
        {duration != null ? duration.toLocaleString() + 'ms' : ''}
      </DurationColumn.Text>
    );
  }
}

class SizeColumn extends PureComponent<{
  response: ?Response,
}> {
  static Text = Text.extends({
    flex: 1,
    textAlign: 'right',
    paddingRight: 10,
  });

  render() {
    const {response} = this.props;
    if (response) {
      const text = formatBytes(this.getResponseLength(response));
      return <SizeColumn.Text>{text}</SizeColumn.Text>;
    } else {
      return null;
    }
  }

  getResponseLength(response) {
    let length = 0;
    const lengthString = response.headers
      ? getHeaderValue(response.headers, 'content-length')
      : undefined;
    if (lengthString != null && lengthString != '') {
      length = parseInt(lengthString, 10);
    } else if (response.data) {
      length = atob(response.data).length;
    }
    return length;
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

// $FlowFixMe
import pako from 'pako';
import type {Request, Response, Header} from './index.js';

import {
  Component,
  FlexColumn,
  ManagedTable,
  ManagedDataInspector,
  Text,
  Panel,
  styled,
  colors,
} from 'sonar';
import {getHeaderValue} from './index.js';

import querystring from 'querystring';

const WrappingText = Text.extends({
  wordWrap: 'break-word',
  width: '100%',
  lineHeight: '125%',
  padding: '3px 0',
});

const KeyValueColumnSizes = {
  key: '30%',
  value: 'flex',
};

const KeyValueColumns = {
  key: {
    value: 'Key',
    resizable: false,
  },
  value: {
    value: 'Value',
    resizable: false,
  },
};

type RequestDetailsProps = {
  request: Request,
  response: ?Response,
};

function decodeBody(container: Request | Response): string {
  if (!container.data) {
    return '';
  }
  const b64Decoded = atob(container.data);
  const encodingHeader = container.headers.find(
    header => header.key === 'Content-Encoding',
  );

  return encodingHeader && encodingHeader.value === 'gzip'
    ? decompress(b64Decoded)
    : b64Decoded;
}

function decompress(body: string): string {
  const charArray = body.split('').map(x => x.charCodeAt(0));

  const byteArray = new Uint8Array(charArray);

  let data;
  try {
    if (body) {
      data = pako.inflate(byteArray);
    } else {
      return body;
    }
  } catch (e) {
    // Sometimes Content-Encoding is 'gzip' but the body is already decompressed.
    // Assume this is the case when decompression fails.
    return body;
  }

  return String.fromCharCode.apply(null, new Uint8Array(data));
}

export default class RequestDetails extends Component<RequestDetailsProps> {
  static Container = FlexColumn.extends({
    height: '100%',
    overflow: 'auto',
  });

  urlColumns = (url: URL) => {
    return [
      {
        columns: {
          key: {value: <WrappingText>Full URL</WrappingText>},
          value: {
            value: <WrappingText>{url.href}</WrappingText>,
          },
        },
        copyText: url.href,
        key: 'url',
      },
      {
        columns: {
          key: {value: <WrappingText>Host</WrappingText>},
          value: {
            value: <WrappingText>{url.host}</WrappingText>,
          },
        },
        copyText: url.host,
        key: 'host',
      },
      {
        columns: {
          key: {value: <WrappingText>Path</WrappingText>},
          value: {
            value: <WrappingText>{url.pathname}</WrappingText>,
          },
        },
        copyText: url.pathname,
        key: 'path',
      },
      {
        columns: {
          key: {value: <WrappingText>Query String</WrappingText>},
          value: {
            value: <WrappingText>{url.search}</WrappingText>,
          },
        },
        copyText: url.search,
        key: 'query',
      },
    ];
  };

  render() {
    const {request, response} = this.props;
    const url = new URL(request.url);

    return (
      <RequestDetails.Container>
        <Panel heading={'Request'} floating={false} padded={false}>
          <ManagedTable
            multiline={true}
            columnSizes={KeyValueColumnSizes}
            columns={KeyValueColumns}
            rows={this.urlColumns(url)}
            autoHeight={true}
            floating={false}
            zebra={false}
          />
        </Panel>

        {url.search ? (
          <Panel
            heading={'Request Query Parameters'}
            floating={false}
            padded={false}>
            <QueryInspector queryParams={url.searchParams} />
          </Panel>
        ) : null}

        {request.headers.length > 0 ? (
          <Panel heading={'Request Headers'} floating={false} padded={false}>
            <HeaderInspector headers={request.headers} />
          </Panel>
        ) : null}

        {request.data != null ? (
          <Panel heading={'Request Body'} floating={false}>
            <RequestBodyInspector request={request} />
          </Panel>
        ) : null}

        {response
          ? [
              response.headers.length > 0 ? (
                <Panel
                  heading={'Response Headers'}
                  floating={false}
                  padded={false}>
                  <HeaderInspector headers={response.headers} />
                </Panel>
              ) : null,
              <Panel heading={'Response Body'} floating={false}>
                <ResponseBodyInspector request={request} response={response} />
              </Panel>,
            ]
          : null}
      </RequestDetails.Container>
    );
  }
}

class QueryInspector extends Component<{queryParams: URLSearchParams}> {
  render() {
    const {queryParams} = this.props;

    const rows = [];
    for (const kv of queryParams.entries()) {
      rows.push({
        columns: {
          key: {
            value: <WrappingText>{kv[0]}</WrappingText>,
          },
          value: {
            value: <WrappingText>{kv[1]}</WrappingText>,
          },
        },
        copyText: kv[1],
        key: kv[0],
      });
    }

    return rows.length > 0 ? (
      <ManagedTable
        multiline={true}
        columnSizes={KeyValueColumnSizes}
        columns={KeyValueColumns}
        rows={rows}
        autoHeight={true}
        floating={false}
        zebra={false}
      />
    ) : null;
  }
}

type HeaderInspectorProps = {
  headers: Array<Header>,
};

type HeaderInspectorState = {
  computedHeaders: Object,
};

class HeaderInspector extends Component<
  HeaderInspectorProps,
  HeaderInspectorState,
> {
  render() {
    const computedHeaders = this.props.headers.reduce((sum, header) => {
      return {...sum, [header.key]: header.value};
    }, {});

    const rows = [];
    for (const key in computedHeaders) {
      rows.push({
        columns: {
          key: {
            value: <WrappingText>{key}</WrappingText>,
          },
          value: {
            value: <WrappingText>{computedHeaders[key]}</WrappingText>,
          },
        },
        copyText: computedHeaders[key],
        key,
      });
    }

    return rows.length > 0 ? (
      <ManagedTable
        multiline={true}
        columnSizes={KeyValueColumnSizes}
        columns={KeyValueColumns}
        rows={rows}
        autoHeight={true}
        floating={false}
        zebra={false}
      />
    ) : null;
  }
}

const BodyContainer = styled.view({
  paddingTop: 10,
  paddingBottom: 20,
});

type BodyFormatter = {
  formatRequest?: (request: Request) => any,
  formatResponse?: (request: Request, response: Response) => any,
};

class RequestBodyInspector extends Component<{
  request: Request,
}> {
  render() {
    const {request} = this.props;
    let component;
    try {
      for (const formatter of BodyFormatters) {
        if (formatter.formatRequest) {
          component = formatter.formatRequest(request);
          if (component) {
            break;
          }
        }
      }
    } catch (e) {}

    if (component == null && request.data != null) {
      component = <Text>{decodeBody(request)}</Text>;
    }

    if (component == null) {
      return null;
    }

    return <BodyContainer>{component}</BodyContainer>;
  }
}

class ResponseBodyInspector extends Component<{
  response: Response,
  request: Request,
}> {
  render() {
    const {request, response} = this.props;

    let component;
    try {
      for (const formatter of BodyFormatters) {
        if (formatter.formatResponse) {
          component = formatter.formatResponse(request, response);
          if (component) {
            break;
          }
        }
      }
    } catch (e) {}

    component = component || <Text>{decodeBody(response)}</Text>;

    return <BodyContainer>{component}</BodyContainer>;
  }
}

const MediaContainer = FlexColumn.extends({
  alignItems: 'center',
  justifyContent: 'center',
  width: '100%',
});

type ImageWithSizeProps = {
  src: string,
};

type ImageWithSizeState = {
  width: number,
  height: number,
};

class ImageWithSize extends Component<ImageWithSizeProps, ImageWithSizeState> {
  static Image = styled.image({
    objectFit: 'scale-down',
    maxWidth: 500,
    maxHeight: 500,
    marginBottom: 10,
  });

  static Text = Text.extends({
    color: colors.dark70,
    fontSize: 14,
  });

  constructor(props, context) {
    super(props, context);
    this.state = {
      width: 0,
      height: 0,
    };
  }

  componentDidMount() {
    const image = new Image();
    image.src = this.props.src;
    image.onload = () => {
      image.width;
      image.height;
      this.setState({
        width: image.width,
        height: image.height,
      });
    };
  }

  render() {
    return (
      <MediaContainer>
        <ImageWithSize.Image src={this.props.src} />
        <ImageWithSize.Text>
          {this.state.width} x {this.state.height}
        </ImageWithSize.Text>
      </MediaContainer>
    );
  }
}

class ImageFormatter {
  formatResponse = (request: Request, response: Response) => {
    if (getHeaderValue(response.headers, 'content-type').startsWith('image')) {
      return <ImageWithSize src={request.url} />;
    }
  };
}

class VideoFormatter {
  static Video = styled.customHTMLTag('video', {
    maxWidth: 500,
    maxHeight: 500,
  });

  formatResponse = (request: Request, response: Response) => {
    const contentType = getHeaderValue(response.headers, 'content-type');
    if (contentType.startsWith('video')) {
      return (
        <MediaContainer>
          <VideoFormatter.Video controls={true}>
            <source src={request.url} type={contentType} />
          </VideoFormatter.Video>
        </MediaContainer>
      );
    }
  };
}

class JSONFormatter {
  formatRequest = (request: Request) => {
    return this.format(
      decodeBody(request),
      getHeaderValue(request.headers, 'content-type'),
    );
  };

  formatResponse = (request: Request, response: Response) => {
    return this.format(
      decodeBody(response),
      getHeaderValue(response.headers, 'content-type'),
    );
  };

  format = (body: string, contentType: string) => {
    if (
      contentType.startsWith('application/json') ||
      contentType.startsWith('text/javascript') ||
      contentType.startsWith('application/x-fb-flatbuffer')
    ) {
      try {
        const data = JSON.parse(body);
        return (
          <ManagedDataInspector
            collapsed={true}
            expandRoot={true}
            data={data}
          />
        );
      } catch (SyntaxError) {
        // Multiple top level JSON roots, map them one by one
        const roots = body.split('\n');
        return (
          <ManagedDataInspector
            collapsed={true}
            expandRoot={true}
            data={roots.map(json => JSON.parse(json))}
          />
        );
      }
    }
  };
}

class LogEventFormatter {
  formatRequest = (request: Request) => {
    if (request.url.indexOf('logging_client_event') > 0) {
      const data = querystring.parse(decodeBody(request));
      if (data.message) {
        data.message = JSON.parse(data.message);
      }
      return <ManagedDataInspector expandRoot={true} data={data} />;
    }
  };
}

class GraphQLBatchFormatter {
  formatRequest = (request: Request) => {
    if (request.url.indexOf('graphqlbatch') > 0) {
      const data = querystring.parse(decodeBody(request));
      if (data.queries) {
        data.queries = JSON.parse(data.queries);
      }
      return <ManagedDataInspector expandRoot={true} data={data} />;
    }
  };
}

class GraphQLFormatter {
  formatRequest = (request: Request) => {
    if (request.url.indexOf('graphql') > 0) {
      const data = querystring.parse(decodeBody(request));
      if (data.variables) {
        data.variables = JSON.parse(data.variables);
      }
      if (data.query_params) {
        data.query_params = JSON.parse(data.query_params);
      }
      return <ManagedDataInspector expandRoot={true} data={data} />;
    }
  };
}

class FormUrlencodedFormatter {
  formatRequest = (request: Request) => {
    const contentType = getHeaderValue(request.headers, 'content-type');
    if (contentType.startsWith('application/x-www-form-urlencoded')) {
      return (
        <ManagedDataInspector
          expandRoot={true}
          data={querystring.parse(decodeBody(request))}
        />
      );
    }
  };
}

const BodyFormatters: Array<BodyFormatter> = [
  new ImageFormatter(),
  new VideoFormatter(),
  new LogEventFormatter(),
  new GraphQLBatchFormatter(),
  new GraphQLFormatter(),
  new JSONFormatter(),
  new FormUrlencodedFormatter(),
];
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import {remote} from 'electron';

export type State = {
  leftSidebarVisible: boolean,
  rightSidebarVisible: boolean,
  rightSidebarAvailable: boolean,
  bugDialogVisible: boolean,
  windowIsFocused: boolean,
  pluginManagerVisible: boolean,
};

type ActionType =
  | 'leftSidebarVisible'
  | 'rightSidebarVisible'
  | 'rightSidebarAvailable'
  | 'bugDialogVisible'
  | 'windowIsFocused'
  | 'pluginManagerVisible';

export type Action = {
  type: ActionType,
  payload?: boolean,
};

const INITIAL_STATE: State = {
  leftSidebarVisible: true,
  rightSidebarVisible: true,
  rightSidebarAvailable: false,
  bugDialogVisible: false,
  windowIsFocused: remote.getCurrentWindow().isFocused(),
  pluginManagerVisible: false,
};

export default function reducer(
  state: State = INITIAL_STATE,
  action: Action,
): State {
  const newValue =
    typeof action.payload === 'undefined'
      ? !state[action.type]
      : action.payload;
  if (state[action.type] === newValue) {
    // value hasn't changed, do nothing
    return state;
  } else {
    return {
      ...state,
      [action.type]: newValue,
    };
  }
}

export const toggleAction = (type: ActionType, payload?: boolean): Action => ({
  type,
  payload,
});

export const toggleBugDialogVisible = (payload?: boolean): Action => ({
  type: 'bugDialogVisible',
  payload,
});

export const toggleLeftSidebarVisible = (payload?: boolean): Action => ({
  type: 'leftSidebarVisible',
  payload,
});

export const toggleRightSidebarVisible = (payload?: boolean): Action => ({
  type: 'rightSidebarVisible',
  payload,
});

export const toggleRightSidebarAvailable = (payload?: boolean): Action => ({
  type: 'rightSidebarAvailable',
  payload,
});

export const togglePluginManagerVisible = (payload?: boolean): Action => ({
  type: 'pluginManagerVisible',
  payload,
});
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type BaseDevice from '../devices/BaseDevice';
export type State = Array<BaseDevice>;

export type Action =
  | {
      type: 'UNREGISTER_DEVICES',
      payload: Set<string>,
    }
  | {
      type: 'REGISTER_DEVICE',
      payload: BaseDevice,
    };

const INITIAL_STATE: State = [];

export default function reducer(
  state: State = INITIAL_STATE,
  action: Action,
): State {
  switch (action.type) {
    case 'REGISTER_DEVICE': {
      const {payload} = action;
      return state.concat(payload);
    }
    case 'UNREGISTER_DEVICES': {
      const {payload} = action;
      return state.filter((device: BaseDevice) => !payload.has(device.serial));
    }
    default:
      return state;
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import {combineReducers} from 'redux';
import application from './application.js';
import devices from './devices.js';
import type {
  State as ApplicationState,
  Action as ApplicationAction,
} from './application.js';
import type {
  State as DevicesState,
  Action as DevicesAction,
} from './devices.js';
import type {Store as ReduxStore} from 'redux';

export type Store = ReduxStore<
  {
    application: ApplicationState,
    devices: DevicesState,
  },
  ApplicationAction | DevicesAction,
>;

export default combineReducers({application, devices});
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */
export type {StyledComponent} from './styled/index.js';

//
export {default as Button} from './components/Button.js';
export {default as ToggleButton} from './components/ToggleSwitch.js';
export {
  default as ButtonNavigationGroup,
} from './components/ButtonNavigationGroup.js';
export {default as ButtonGroup} from './components/ButtonGroup.js';

//
export {colors, darkColors, brandColors} from './components/colors.js';

//
export {default as Glyph, ColoredIcon} from './components/Glyph.js';

//
export {default as LoadingIndicator} from './components/LoadingIndicator.js';

//
export {default as Popover} from './components/Popover.js';

//
export {default as ClickableList} from './components/ClickableList.js';
export {default as ClickableListItem} from './components/ClickableListItem.js';

//
export type {
  TableColumns,
  TableRows,
  TableBodyColumn,
  TableBodyRow,
  TableHighlightedRows,
  TableRowSortOrder,
  TableColumnOrder,
  TableColumnSizes,
} from './components/table/types.js';
export {default as Table} from './components/table/Table.js';
export {default as ManagedTable} from './components/table/ManagedTable.js';
export type {ManagedTableProps} from './components/table/ManagedTable.js';

//
export type {
  DataValueExtractor,
  DataInspectorExpanded,
} from './components/data-inspector/DataInspector.js';
export {
  default as DataInspector,
} from './components/data-inspector/DataInspector.js';
export {
  default as ManagedDataInspector,
} from './components/data-inspector/ManagedDataInspector.js';

// tabs
export {default as Tabs} from './components/Tabs.js';
export {default as Tab} from './components/Tab.js';

// inputs
export {default as Input} from './components/Input.js';
export {default as Textarea} from './components/Textarea.js';
export {default as Select} from './components/Select.js';
export {default as Checkbox} from './components/Checkbox.js';

// code
export {default as CodeBlock} from './components/CodeBlock.js';

// error
export {default as ErrorBlock} from './components/ErrorBlock.js';
export {default as ErrorBoundary} from './components/ErrorBoundary.js';

// interactive components
export type {OrderableOrder} from './components/Orderable.js';
export {default as Interactive} from './components/Interactive.js';
export {default as Orderable} from './components/Orderable.js';
export {default as VirtualList} from './components/VirtualList.js';

// base components
export {Component, PureComponent} from 'react';

// context menus and dropdowns
export {
  default as ContextMenuProvider,
} from './components/ContextMenuProvider.js';
export {default as ContextMenu} from './components/ContextMenu.js';
export {default as InlineContextMenu} from './components/InlineContextMenu.js';
export {default as Dropdown} from './components/Dropdown.js';

// file
export type {FileListFile, FileListFiles} from './components/FileList.js';
export {default as FileList} from './components/FileList.js';
export {default as File} from './components/File.js';

// context menu items
export {
  DesktopDropdownItem,
  DesktopDropdownSelectedItem,
  DesktopDropdown,
} from './components/desktop-toolbar.js';

// utility elements
export {default as View} from './components/View.js';
export {default as ViewWithSize} from './components/ViewWithSize.js';
export {default as Block} from './components/Block.js';
export {default as FocusableBox} from './components/FocusableBox.js';
export {default as Sidebar} from './components/Sidebar.js';
export {default as SidebarLabel} from './components/SidebarLabel.js';
export {default as Box} from './components/Box.js';
export {default as FlexBox} from './components/FlexBox.js';
export {default as FlexRow} from './components/FlexRow.js';
export {default as FlexColumn} from './components/FlexColumn.js';
export {default as FlexCenter} from './components/FlexCenter.js';
export {default as Toolbar, Spacer} from './components/Toolbar.js';
export {default as Panel} from './components/Panel.js';
export {default as Text} from './components/Text.js';
export {default as TextParagraph} from './components/TextParagraph.js';
export {default as Link} from './components/Link.js';
export {default as PathBreadcrumbs} from './components/PathBreadcrumbs.js';
export {default as ModalOverlay} from './components/ModalOverlay.js';
export {default as Tooltip} from './components/Tooltip.js';
export {default as TooltipProvider} from './components/TooltipProvider.js';
export {default as ResizeSensor} from './components/ResizeSensor.js';

// typhography
export {default as HorizontalRule} from './components/HorizontalRule.js';
export {default as Label} from './components/Label.js';
export {default as Heading} from './components/Heading.js';

// filters
export type {Filter} from './components/filter/types.js';

//
export {
  SearchBox,
  SearchInput,
  SearchIcon,
  default as Searchable,
} from './components/searchable/Searchable.js';
export {
  default as SearchableTable,
} from './components/searchable/SearchableTable.js';
export type {SearchableProps} from './components/searchable/Searchable.js';

//
export type {
  ElementID,
  ElementData,
  ElementAttribute,
  Element,
  ElementSearchResultSet,
} from './components/elements-inspector/ElementsInspector.js';
export {
  default as ElementsInspector,
} from './components/elements-inspector/ElementsInspector.js';
export {InspectorSidebar} from './components/elements-inspector/sidebar.js';

export {Console} from './components/console.js';
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import styled from '../styled/index.js';

export default styled.view({
  display: 'block',
});
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import FlexBox from './FlexBox.js';

export default FlexBox.extends({
  height: '100%',
  overflow: 'auto',
  position: 'relative',
  width: '100%',
});
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import Glyph from './Glyph.js';
import styled from '../styled/index.js';
import type {StyledComponent} from '../styled/index.js';
import {findDOMNode} from 'react-dom';
import PropTypes from 'prop-types';
import {colors} from './colors.js';
import {connect} from 'react-redux';
import electron from 'electron';

const borderColor = props => {
  if (!props.windowIsFocused) {
    return colors.macOSTitleBarButtonBorderBlur;
  } else if (props.type === 'danger') {
    return colors.red;
  } else {
    return colors.macOSTitleBarButtonBorder;
  }
};
const borderBottomColor = props => {
  if (!props.windowIsFocused) {
    return colors.macOSTitleBarButtonBorderBlur;
  } else if (props.type === 'danger') {
    return colors.red;
  } else {
    return colors.macOSTitleBarButtonBorderBottom;
  }
};

const StyledButton = styled.view(
  {
    backgroundColor: props => {
      if (!props.windowIsFocused) {
        return colors.macOSTitleBarButtonBackgroundBlur;
      } else {
        return colors.white;
      }
    },
    backgroundImage: props =>
      props.windowIsFocused
        ? `linear-gradient(to bottom, transparent 0%,${
            colors.macOSTitleBarButtonBackground
          } 100%)`
        : 'none',
    borderStyle: 'solid',
    borderWidth: 1,
    borderColor,
    borderBottomColor,
    fontSize: props => (props.compact === true ? 11 : '1em'),
    color: props => {
      if (props.type === 'danger' && props.windowIsFocused) {
        return colors.red;
      } else if (props.disabled) {
        return colors.macOSTitleBarIconBlur;
      } else {
        return colors.light50;
      }
    },
    borderRadius: 4,
    position: 'relative',
    padding: '0 6px',
    height: props => (props.compact === true ? 24 : 28),
    margin: 0,
    marginLeft: props => (props.inButtonGroup === true ? 0 : 10),
    minWidth: 34,
    display: 'inline-flex',
    alignItems: 'center',
    justifyContent: 'center',
    flexShrink: 0,

    boxShadow: props =>
      props.pulse && props.windowIsFocused
        ? `0 0 0 ${colors.macOSTitleBarIconSelected}`
        : '',
    animation: props =>
      props.pulse && props.windowIsFocused ? 'pulse 1s infinite' : '',

    '&:not(:first-child)': {
      borderTopLeftRadius: props => (props.inButtonGroup === true ? 0 : 4),
      borderBottomLeftRadius: props => (props.inButtonGroup === true ? 0 : 4),
    },

    '&:not(:last-child)': {
      borderTopRightRadius: props => (props.inButtonGroup === true ? 0 : 4),
      borderBottomRightRadius: props => (props.inButtonGroup === true ? 0 : 4),
      borderRight: props => (props.inButtonGroup === true ? 0 : ''),
    },

    '&:first-of-type': {
      marginLeft: 0,
    },

    '&:active': {
      borderColor: colors.macOSTitleBarButtonBorder,
      borderBottomColor: colors.macOSTitleBarButtonBorderBottom,
      background: `linear-gradient(to bottom, ${
        colors.macOSTitleBarButtonBackgroundActiveHighlight
      } 1px, ${colors.macOSTitleBarButtonBackgroundActive} 0%, ${
        colors.macOSTitleBarButtonBorderBlur
      } 100%)`,
    },

    '&:disabled': {
      borderColor,
      borderBottomColor,
      pointerEvents: 'none',
    },

    '&:hover::before': {
      content: props => (props.dropdown ? "''" : ''),
      position: 'absolute',
      bottom: 1,
      right: 2,
      borderStyle: 'solid',
      borderWidth: '4px 3px 0 3px',
      borderColor: props =>
        `${colors.macOSTitleBarIcon} transparent transparent transparent`,
    },
  },
  {
    ignoreAttributes: [
      'dispatch',
      'compact',
      'large',
      'windowIsFocused',
      'inButtonGroup',
      'danger',
      'pulse',
    ],
  },
);

const Icon = Glyph.extends(
  {
    marginRight: props => (props.hasText ? 3 : 0),
  },
  {
    ignoreAttributes: ['hasText', 'type'],
  },
);

type Props = {
  /**
   * onClick handler.
   */
  onClick?: (event: SyntheticMouseEvent<>) => void,
  /**
   * Whether this button is disabled.
   */
  disabled?: boolean,
  /**
   * Whether this button is large. Increases padding and line-height.
   */
  large?: boolean,
  /**
   * Whether this button is compact. Decreases padding and line-height.
   */
  compact?: boolean,
  /**
   * Type of button.
   */
  type?: 'primary' | 'success' | 'warning' | 'danger',
  /**
   * Children.
   */
  children?: React$Node,
  /**
   * Dropdown menu template shown on click.
   */
  dropdown?: Array<Electron$MenuItemOptions>,
  /**
   * Name of the icon dispalyed next to the text
   */
  icon?: string,
  iconSize?: number,
  /**
   * For toggle buttons, if the button is selected
   */
  selected?: boolean,
  /**
   * Button is pulsing
   */
  pulse?: boolean,
  /**
   * URL to open in the browser on click
   */
  href?: string,
};

type State = {
  active: boolean,
};

/**
 * Simple button.
 *
 * **Usage**
 *
 * ```jsx
 * import {Button} from 'sonar';
 * <Button onClick={handler}>Click me</Button>
 * ```
 *
 * @example Default button
 *   <Button>Click me</Button>
 * @example Primary button
 *   <Button type="primary">Click me</Button>
 * @example Success button
 *   <Button type="success">Click me</Button>
 * @example Warning button
 *   <Button type="warning">Click me</Button>
 * @example Danger button
 *   <Button type="danger">Click me</Button>
 * @example Default solid button
 *   <Button solid={true}>Click me</Button>
 * @example Primary solid button
 *   <Button type="primary" solid={true}>Click me</Button>
 * @example Success solid button
 *   <Button type="success" solid={true}>Click me</Button>
 * @example Warning solid button
 *   <Button type="warning" solid={true}>Click me</Button>
 * @example Danger solid button
 *   <Button type="danger" solid={true}>Click me</Button>
 * @example Compact button
 *   <Button compact={true}>Click me</Button>
 * @example Large button
 *   <Button large={true}>Click me</Button>
 * @example Disabled button
 *   <Button disabled={true}>Click me</Button>
 */
class Button extends styled.StylableComponent<
  Props & {windowIsFocused: boolean},
  State,
> {
  static contextTypes = {
    inButtonGroup: PropTypes.bool,
  };

  state = {
    active: false,
  };

  _ref: ?Element | ?Text;

  onMouseDown = () => this.setState({active: true});
  onMouseUp = () => this.setState({active: false});

  onClick = (e: SyntheticMouseEvent<>) => {
    if (this.props.disabled === true) {
      return;
    }
    if (this.props.dropdown) {
      const menu = electron.remote.Menu.buildFromTemplate(this.props.dropdown);
      const position = {};
      if (this._ref != null && this._ref instanceof Element) {
        const {left, bottom} = this._ref.getBoundingClientRect();
        position.x = parseInt(left, 10);
        position.y = parseInt(bottom + 6, 10);
      }
      menu.popup(electron.remote.getCurrentWindow(), {
        async: true,
        ...position,
      });
    }
    if (this.props.onClick) {
      this.props.onClick(e);
    }
    if (this.props.href != null) {
      electron.shell.openExternal(this.props.href);
    }
  };

  setRef = (ref: ?React.ElementRef<any>) => {
    this._ref = findDOMNode(ref);
  };

  render() {
    const {
      icon,
      children,
      selected,
      iconSize,
      windowIsFocused,
      ...props
    } = this.props;
    const {active} = this.state;

    let color = colors.macOSTitleBarIcon;
    if (props.disabled === true) {
      color = colors.macOSTitleBarIconBlur;
    } else if (windowIsFocused && selected === true) {
      color = colors.macOSTitleBarIconSelected;
    } else if (!windowIsFocused && (selected == null || selected === false)) {
      color = colors.macOSTitleBarIconBlur;
    } else if (!windowIsFocused && selected === true) {
      color = colors.macOSTitleBarIconSelectedBlur;
    } else if (selected == null && active) {
      color = colors.macOSTitleBarIconActive;
    } else if (props.type === 'danger') {
      color = colors.red;
    }

    let iconComponent;
    if (icon != null) {
      iconComponent = (
        <Icon
          name={icon}
          size={
            iconSize != null ? iconSize : this.props.compact === true ? 12 : 16
          }
          color={color}
          hasText={Boolean(children)}
        />
      );
    }

    return (
      <StyledButton
        {...props}
        ref={this.setRef}
        windowIsFocused={windowIsFocused}
        onClick={this.onClick}
        onMouseDown={this.onMouseDown}
        onMouseUp={this.onMouseUp}
        inButtonGroup={this.context.inButtonGroup}>
        {iconComponent}
        {children}
        {this.props.pulse === true && (
          <style
            dangerouslySetInnerHTML={{
              __html: `
        @keyframes pulse {
          0% {
            box-shadow: 0 0 4px 0 ${colors.macOSTitleBarIconSelected};
          }
          70% {
            box-shadow: 0 0 4px 6px transparent;
          }
          100% {
            box-shadow: 0 0 4px 0 transparent;
          }
        }
      `,
            }}
          />
        )}
      </StyledButton>
    );
  }
}

const ConnectedButton = connect(({application: {windowIsFocused}}) => ({
  windowIsFocused,
}))(Button);

// $FlowFixMe
export default (ConnectedButton: StyledComponent<Props>);
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import styled from '../styled/index.js';
import {Component} from 'react';

const PropTypes = require('prop-types');

const ButtonGroupContainer = styled.view({
  display: 'inline-flex',
  marginLeft: 10,
  '&:first-child': {
    marginLeft: 0,
  },
});

/**
 * Group a series of buttons together.
 *
 * @example List of buttons
 *   <ButtonGroup>
 *     <Button>One</Button>
 *     <Button>Two</Button>
 *     <Button>Three</Button>
 *   </ButtonGroup>
 */
export default class ButtonGroup extends Component<{
  children: React$Node,
}> {
  getChildContext() {
    return {inButtonGroup: true};
  }

  render() {
    return <ButtonGroupContainer>{this.props.children}</ButtonGroupContainer>;
  }
}

ButtonGroup.childContextTypes = {
  inButtonGroup: PropTypes.bool,
};
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import ButtonGroup from './ButtonGroup.js';
import Button from './Button.js';

export default function ButtonNavigationGroup(props: {|
  canGoBack: boolean,
  canGoForward: boolean,
  onBack: () => void,
  onForward: () => void,
|}) {
  return (
    <ButtonGroup>
      <Button disabled={!props.canGoBack} onClick={props.onBack}>
        {'<'}
      </Button>

      <Button disabled={!props.canGoForward} onClick={props.onForward}>
        {'<'}
      </Button>
    </ButtonGroup>
  );
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import {PureComponent} from 'react';
import styled from '../styled/index.js';

type CheckboxProps = {
  checked: boolean,
  onChange: (checked: boolean) => void,
};

const CheckboxContainer = styled.textInput({
  display: 'inline-block',
  marginRight: 5,
  verticalAlign: 'middle',
});

export default class Checkbox extends PureComponent<CheckboxProps> {
  onChange = (e: SyntheticInputEvent<HTMLInputElement>) => {
    this.props.onChange(e.target.checked);
  };

  render() {
    return (
      <CheckboxContainer
        type="checkbox"
        checked={this.props.checked}
        onChange={this.onChange}
      />
    );
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import styled from '../styled/index.js';

export default styled.view({
  marginBottom: 10,
});
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import styled from '../styled/index.js';
import {colors} from './colors.js';

export default styled.view(
  {
    backgroundColor: ({active, windowFocused}) => {
      if (active && windowFocused) {
        return colors.macOSTitleBarIconSelected;
      } else if (active && !windowFocused) {
        return colors.macOSTitleBarBorderBlur;
      } else {
        return 'none';
      }
    },
    color: ({active, windowFocused}) =>
      active && windowFocused ? colors.white : colors.macOSSidebarSectionItem,
    lineHeight: '25px',
    padding: '0 10px',
    '&[disabled]': {
      color: 'rgba(0, 0, 0, 0.5)',
    },
  },
  {
    ignoreAttributes: ['active', 'windowFocused'],
  },
);
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import styled from '../styled/index.js';

export default styled.view({
  fontFamily: 'monospace',
});
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

// Last updated: Jan 30 2016

export const colors = {
  // FIG UI Core
  blue: '#4267b2', // Blue - Active-state nav glyphs, nav bars, links, buttons
  blueDark3: '#162643', // Blue - Dark 3 (illustrations only)
  blueDark2: '#20375f', // Blue - Dark 2 (illustrations only)
  blueDark1: '#29487d', // Blue - Dark 1 (illustrations only)
  blueDark: '#365899', // Blue - Dark 0 (blue links, blue button hover states)
  blueTint15: '#577fbc', // Blue - Tint 15 (illustrations only)
  blueTint30: '#7596c8', // Blue - Tint 30 (illustrations only)
  blueTint50: '#9cb4d8', // Blue - Tint 50 (illustrations only)
  blueTint70: '#c4d2e7', // Blue - Tint 70 (illustrations only)
  blueTint90: '#ecf0f7', // Blue - Tint 90 (illustrations only)
  highlight: '#4080ff', // Highlight - Unread, badging notifications, NUX *Use sparingly.*
  highlightDark3: '#1c4f8c', // Highlight - Dark 3 (illustrations only)
  highlightDark2: '#1d5fbf', // Highlight - Dark 2 (illustrations only)
  highlightDark1: '#3578e5', // Highlight - Dark 1 (illustrations only)
  highlightTint15: '#5d93ff', // Highlight - Tint 15 (illustrations only)
  highlightTint30: '#79a6ff', // Highlight - Tint 30 (illustrations only)
  highlightTint50: '#9fbfff', // Highlight - Tint 50 (illustrations only)
  highlightTint70: '#c6d9ff', // Highlight - Tint 70 (illustrations only)
  highlightTint90: '#ecf2ff', // Highlight - Tint 90 (illustrations only)
  highlightBackground: '#edf2fa', // Highlight Background - Background fill for unread or highlighted states. Not intended for hover / pressed states
  green: '#42b72a', // Green - Confirmation, success, commerce and status
  red: '#FC3A4B', // Red - Badges, error states
  redTint: '#FEF2F1',
  white: '#ffffff', // White - Text and glyphs in Dark UI and media views
  black: '#000000', // Black - Media backgrounds
  yellow: '#D79651', // Yellow - Warnings
  yellowTint: '#FEFBF2',
  purple: '#8C73C8', // Purple - Verbose
  purpleTint: '#E8E3F4',
  grey: '#88A2AB', // Grey - Debug
  greyTint: '#E7ECEE',
  cyan: '#4FC9EA', // Cyan - Info
  cyanTint: '#DCF4FB', // Cyan - Info
  // FIG UI Light
  light02: '#f6f7f9', // Light 02 – Modal Headers & Nav - Modal headers and navigation elements that sit above primary UI
  light05: '#e9ebee', // Light 05 – Mobile & Desktop Wash - Background wash color for desktop and mobile
  light10: '#dddfe2', // Light 10 – Desktop Dividers, Strokes, Borders - Desktop dividers, strokes, borders
  light15: '#ced0d4', // Light 15 – Mobile Dividers, Strokes, Borders - Mobile dividers, strokes, borders
  light20: '#bec2c9', // Light 20 – Inactive Nav Glyphs - Inactive-state nav glyphs, tertiary glyphs
  light30: '#90949c', // Light 30 – Secondary Text & Glyphs - Secondary text and glyphs, meta text and glyphs
  light50: '#4b4f56', // Light 50 – Medium Text & Primary Glyphs - Medium text and primary glyphs
  light80: '#1d2129', // Light 80 – Primary Text - Primary text
  // FIG UI Alpha
  whiteAlpha10: 'rgba(255, 255, 255, 0.10)', // Alpha 10 - Inset strokes and borders on photos
  whiteAlpha15: 'rgba(255, 255, 255, 0.15)', // Alpha 15 - Dividers, strokes, borders
  whiteAlpha30: 'rgba(255, 255, 255, 0.3)', // Alpha 30 - Secondary text and glyphs, meta text and glyphs
  whiteAlpha40: 'rgba(255, 255, 255, 0.4)', // Alpha 40 - Overlays
  whiteAlpha50: 'rgba(255, 255, 255, 0.5)', // Alpha 50 - Medium text and primary glyphs
  whiteAlpha80: 'rgba(255, 255, 255, 0.8)', // Alpha 80 - Primary Text
  blackAlpha10: 'rgba(0, 0, 0, 0.1)', // Alpha 10 - Inset strokes and borders on photos
  blackAlpha15: 'rgba(0, 0, 0, 0.15)', // Alpha 15 - Dividers, strokes, borders
  blackAlpha30: 'rgba(0, 0, 0, 0.3)', // Alpha 30 - Secondary text and glyphs, meta text and glyphs
  blackAlpha40: 'rgba(0, 0, 0, 0.4)', // Alpha 40 - Overlays
  blackAlpha50: 'rgba(0, 0, 0, 0.5)', // Alpha 50 - Medium text and primary glyphs
  blackAlpha80: 'rgba(0, 0, 0, 0.8)', // Alpha 80 - Primary Text
  light80Alpha4: 'rgba(29, 33, 41, 0.04)', // Light 80 Alpha 4 - Hover state background fill for list views on WWW
  light80Alpha8: 'rgba(29, 33, 41, 0.08)', // Light 80 Alpha 8 - Pressed state background fill for list views on WWW and Mobile
  // FIG UI Dark
  dark20: '#cccccc', // Dark 20 – Primary Text - Primary text
  dark50: '#7f7f7f', // Dark 50 – Medium Text & Primary Glyphs - Medium text and primary glyphs
  dark70: '#4c4c4c', // Dark 70 – Secondary Text & Glyphs - Secondary text and glyphs, meta text and glyphs
  dark80: '#333333', // Dark 80 – Inactive Nav Glyphs - Inactive-state nav glyphs, tertiary glyphs
  dark85: '#262626', // Dark 85 – Dividers, Strokes, Borders - Dividers, strokes, borders
  dark90: '#191919', // Dark 90 – Nav Bar, Tab Bar, Cards - Nav bar, tab bar, cards
  dark95: '#0d0d0d', // Dark 95 – Background Wash - Background Wash
  // FIG Spectrum
  blueGrey: '#5f6673', // Blue Grey
  blueGreyDark3: '#23272f', // Blue Grey - Dark 3
  blueGreyDark2: '#303846', // Blue Grey - Dark 2
  blueGreyDark1: '#4f5766', // Blue Grey - Dark 1
  blueGreyTint15: '#777d88', // Blue Grey - Tint 15
  blueGreyTint30: '#8f949d', // Blue Grey - Tint 30
  blueGreyTint50: '#afb3b9', // Blue Grey - Tint 50
  blueGreyTint70: '#cfd1d5', // Blue Grey - Tint 70
  blueGreyTint90: '#eff0f1', // Blue Grey - Tint 90
  slate: '#b9cad2', // Slate
  slateDark3: '#688694', // Slate - Dark 3
  slateDark2: '#89a1ac', // Slate - Dark 2
  slateDark1: '#a8bbc3', // Slate - Dark 1
  slateTint15: '#c4d2d9', // Slate - Tint 15
  slateTint30: '#cedae0', // Slate - Tint 30
  slateTint50: '#dce5e9', // Slate - Tint 50
  slateTint70: '#eaeff2', // Slate - Tint 70
  slateTint90: '#f8fafb', // Slate - Tint 90
  aluminum: '#a3cedf', // Aluminum
  aluminumDark3: '#4b8096', // Aluminum - Dark 3
  aluminumDark2: '#6ca0b6', // Aluminum - Dark 2
  aluminumDark1: '#8ebfd4', // Aluminum - Dark 1
  aluminumTint15: '#b0d5e5', // Aluminum - Tint 15
  aluminumTint30: '#bfdde9', // Aluminum - Tint 30
  aluminumTint50: '#d1e7f0', // Aluminum - Tint 50
  aluminumTint70: '#e4f0f6', // Aluminum - Tint 70
  aluminumTint90: '#f6fafc', // Aluminum - Tint 90
  seaFoam: '#54c7ec', // Sea Foam
  seaFoamDark3: '#186d90', // Sea Foam - Dark 3
  seaFoamDark2: '#2088af', // Sea Foam - Dark 2
  seaFoamDark1: '#39afd5', // Sea Foam - Dark 1
  seaFoamTint15: '#6bcfef', // Sea Foam - Tint 15
  seaFoamTint30: '#84d8f2', // Sea Foam - Tint 30
  seaFoamTint50: '#a7e3f6', // Sea Foam - Tint 50
  seaFoamTint70: '#caeef9', // Sea Foam - Tint 70
  seaFoamTint90: '#eefafd', // Sea Foam - Tint 90
  teal: '#6bcebb', // Teal
  tealDark3: '#24917d', // Teal - Dark 3
  tealDark2: '#31a38d', // Teal - Dark 2
  tealDark1: '#4dbba6', // Teal - Dark 1
  tealTint15: '#80d4c4', // Teal - Tint 15
  tealTint30: '#97dccf', // Teal - Tint 30
  tealTint50: '#b4e6dd', // Teal - Tint 50
  tealTint70: '#d2f0ea', // Teal - Tint 70
  tealTint90: '#f0faf8', // Teal - Tint 90
  lime: '#a3ce71', // Lime
  limeDark3: '#629824', // Lime - Dark 3
  limeDark2: '#71a830', // Lime - Dark 2
  limeDark1: '#89be4c', // Lime - Dark 1
  limeTint15: '#b1d587', // Lime - Tint 15
  limeTint30: '#bedd9c', // Lime - Tint 30
  limeTint50: '#d1e6b9', // Lime - Tint 50
  limeTint70: '#e4f0d5', // Lime - Tint 70
  limeTint90: '#f6faf1', // Lime - Tint 90
  lemon: '#fcd872', // Lemon
  lemonDark3: '#d18f41', // Lemon - Dark 3
  lemonDark2: '#e1a43b', // Lemon - Dark 2
  lemonDark1: '#f5c33b', // Lemon - Dark 1
  lemonTint15: '#ffe18f', // Lemon - Tint 15
  lemonTint30: '#ffe8a8', // Lemon - Tint 30
  lemonTint50: '#ffecb5', // Lemon - Tint 50
  lemonTint70: '#fef2d1', // Lemon - Tint 70
  lemonTint90: '#fffbf0', // Lemon - Tint 90
  orange: '#f7923b', // Orange
  orangeDark3: '#ac4615', // Orange - Dark 3
  orangeDark2: '#cc5d22', // Orange - Dark 2
  orangeDark1: '#e07a2e', // Orange - Dark 1
  orangeTint15: '#f9a159', // Orange - Tint 15
  orangeTint30: '#f9b278', // Orange - Tint 30
  orangeTint50: '#fbc89f', // Orange - Tint 50
  orangeTint70: '#fcdec5', // Orange - Tint 70
  orangeTint90: '#fef4ec', // Orange - Tint 90
  tomato: '#fb724b', // Tomato - Tometo? Tomato.
  tomatoDark3: '#c32d0e', // Tomato - Dark 3
  tomatoDark2: '#db4123', // Tomato - Dark 2
  tomatoDark1: '#ef6632', // Tomato - Dark 1
  tomatoTint15: '#f1765e', // Tomato - Tint 15
  tomatoTint30: '#f38e7b', // Tomato - Tint 30
  tomatoTint50: '#f7afa0', // Tomato - Tint 50
  tomatoTint70: '#f9cfc7', // Tomato - Tint 70
  tomatoTint90: '#fdefed', // Tomato - Tint 90
  cherry: '#f35369', // Cherry
  cherryDark3: '#9b2b3a', // Cherry - Dark 3
  cherryDark2: '#b73749', // Cherry - Dark 2
  cherryDark1: '#e04c60', // Cherry - Dark 1
  cherryTint15: '#f36b7f', // Cherry - Tint 15
  cherryTint30: '#f58796', // Cherry - Tint 30
  cherryTint50: '#f8a9b4', // Cherry - Tint 50
  cherryTint70: '#fbccd2', // Cherry - Tint 70
  cherryTint90: '#feeef0', // Cherry - Tint 90
  pink: '#ec7ebd', // Pink
  pinkDark3: '#b0377b', // Pink - Dark 3
  pinkDark2: '#d4539b', // Pink - Dark 2
  pinkDark1: '#ec6fb5', // Pink - Dark 1
  pinkTint15: '#ef92c7', // Pink - Tint 15
  pinkTint30: '#f2a5d1', // Pink - Tint 30
  pinkTint50: '#f6bfdf', // Pink - Tint 50
  pinkTint70: '#f9d9eb', // Pink - Tint 70
  pinkTint90: '#fdf3f8', // Pink - Tint 90
  grape: '#8c72cb', // Grape
  grapeDark3: '#58409b', // Grape - Dark 3
  grapeDark2: '#6a51b2', // Grape - Dark 2
  grapeDark1: '#7b64c0', // Grape - Dark 1
  grapeTint15: '#9d87d2', // Grape - Tint 15
  grapeTint30: '#af9cda', // Grape - Tint 30
  grapeTint50: '#c6b8e5', // Grape - Tint 50
  grapeTint70: '#ddd5f0', // Grape - Tint 70
  grapeTint90: '#f4f1fa', // Grape - Tint 90
  // FIG Spectrum (Skin)
  skin1: '#f1d2b6', // Skin 1
  skin1Dark3: '#d9a170', // Skin 1 - Dark 3
  skin1Dark2: '#ddac82', // Skin 1 - Dark 2
  skin1Dark1: '#e2ba96', // Skin 1 - Dark 1
  skin1Tint15: '#f3d9c1', // Skin 1 - Tint 15
  skin1Tint30: '#f6e0cc', // Skin 1 - Tint 30
  skin1Tint50: '#f8e9db', // Skin 1 - Tint 50
  skin1Tint70: '#faf2ea', // Skin 1 - Tint 70
  skin1Tint90: '#fefbf8', // Skin 1 - Tint 90
  skin2: '#d7b195', // Skin 2
  skin2Dark3: '#af866a', // Skin 2 - Dark 3
  skin2Dark2: '#c2977a', // Skin 2 - Dark 2
  skin2Dark1: '#cfa588', // Skin 2 - Dark 1
  skin2Tint15: '#debda5', // Skin 2 - Tint 15
  skin2Tint30: '#e5c9b5', // Skin 2 - Tint 30
  skin2Tint50: '#ecd8cb', // Skin 2 - Tint 50
  skin2Tint70: '#f3e8e0', // Skin 2 - Tint 70
  skin2Tint90: '#fbf7f5', // Skin 2 - Tint 90
  skin3: '#d8a873', // Skin 3
  skin3Dark3: '#a77a4e', // Skin 3 - Dark 3
  skin3Dark2: '#ba8653', // Skin 3 - Dark 2
  skin3Dark1: '#cd9862', // Skin 3 - Dark 1
  skin3Tint15: '#e0b588', // Skin 3 - Tint 15
  skin3Tint30: '#e5c29e', // Skin 3 - Tint 30
  skin3Tint50: '#ecd4b9', // Skin 3 - Tint 50
  skin3Tint70: '#f4e5d6', // Skin 3 - Tint 70
  skin3Tint90: '#fcf6f1', // Skin 3 - Tint 90
  skin4: '#a67b4f', // Skin 4
  skin4Dark3: '#815830', // Skin 4 - Dark 3
  skin4Dark2: '#94683d', // Skin 4 - Dark 2
  skin4Dark1: '#a07243', // Skin 4 - Dark 1
  skin4Tint15: '#ae8761', // Skin 4 - Tint 15
  skin4Tint30: '#bc9d7d', // Skin 4 - Tint 30
  skin4Tint50: '#d0b9a2', // Skin 4 - Tint 50
  skin4Tint70: '#e2d5c8', // Skin 4 - Tint 70
  skin4Tint90: '#f6f1ed', // Skin 4 - Tint 90
  skin5: '#6a4f3b', // Skin 5
  skin5Dark3: '#453223', // Skin 5 - Dark 3
  skin5Dark2: '#503b2c', // Skin 5 - Dark 2
  skin5Dark1: '#624733', // Skin 5 - Dark 1
  skin5Tint15: '#8a715b', // Skin 5 - Tint 15
  skin5Tint30: '#9f8a79', // Skin 5 - Tint 30
  skin5Tint50: '#baaca0', // Skin 5 - Tint 50
  skin5Tint70: '#d5cdc6', // Skin 5 - Tint 70
  skin5Tint90: '#f2efec', // Skin 5 - Tint 90
  // macOS system colors
  macOSHighlight: '#dbe7fa', // used for text selection, tokens, etc.
  macOSHighlightActive: '#85afee', // active tokens
  macOSTitleBarBackgroundTop: '#eae9eb',
  macOSTitleBarBackgroundBottom: '#dcdbdc',
  macOSTitleBarBackgroundBlur: '#f6f6f6',
  macOSTitleBarBorder: '#c1c0c2',
  macOSTitleBarBorderBlur: '#cecece',
  macOSTitleBarIcon: '#6f6f6f',
  macOSTitleBarIconBlur: '#acacac',
  macOSTitleBarIconSelected: '#4d84f5',
  macOSTitleBarIconSelectedBlur: '#80a6f5',
  macOSTitleBarIconActive: '#4c4c4c',
  macOSTitleBarButtonBorder: '#d3d2d3',
  macOSTitleBarButtonBorderBottom: '#b0afb0',
  macOSTitleBarButtonBorderBlur: '#dbdbdb',
  macOSTitleBarButtonBackground: 'rgba(0,0,0,0.05)',
  macOSTitleBarButtonBackgroundBlur: '#f6f6f6',
  macOSTitleBarButtonBackgroundActiveHighlight: '#ededed',
  macOSTitleBarButtonBackgroundActive: '#e5e5e5',
  macOSSidebarSectionTitle: '#777',
  macOSSidebarSectionItem: '#434343',
  macOSSidebarPanelSeperator: '#b3b3b3',
  sectionHeaderBorder: '#DDDFE2',
  placeholder: '#A7AAB1',
  info: '#5ACFEC',
};

export const darkColors = {
  activeBackground: colors.dark80,
  backgroundWash: colors.dark95,
  barBackground: colors.dark90,
  barText: colors.dark20,
  dividers: colors.whiteAlpha10,
};

export const brandColors = {
  Facebook: '#4267B2',
  Messenger: '#0088FA',
  Instagram: '#E61E68',
  Sonar: '#8155cb',
};
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */
import {Component} from 'react';
import {
  CodeBlock,
  colors,
  ManagedTable,
  FlexColumn,
  Text,
  ManagedDataInspector,
  Input,
  View,
} from '../index';
import type {TableBodyRow, TableRows} from 'sonar';
import type {PluginClient} from '../../plugin';

type ValueWithType = {|
  type: string,
  value: any,
|};
type SuccessResult = {|
  isSuccess: true,
  value: ValueWithType,
|};
type FailedResult = {|
  isSuccess: false,
  error: string,
|};

type CommandResult = SuccessResult | FailedResult;

type Props = {
  client: PluginClient,
  getContext: () => string,
};
type State = {
  isConsoleEnabled: boolean,
  script: string,
  previousExecutions: Array<{
    command: string,
    result: CommandResult,
  }>,
};

class ConsoleError extends Component<{
  error: Error | string | void,
  className?: string,
}> {
  static Container = CodeBlock.extends({
    backgroundColor: colors.redTint,
    color: colors.red,
    overflow: 'auto',
    flexGrow: 1,
    margin: '0 -8px',
    padding: '0 8px',
  });

  render() {
    const {className, error} = this.props;

    return (
      <ConsoleError.Container className={className}>
        {error}
      </ConsoleError.Container>
    );
  }
}

export class Console extends Component<Props, State> {
  static title = 'Console';
  static id = 'Console';
  static icon = 'chevron-right';

  static TableColumns = {
    command: {
      value: 'Commands',
    },
  };

  static CommandsTable = ManagedTable.extends({
    flexGrow: 1,
  });
  static Window = FlexColumn.extends({
    padding: '15px',
    flexGrow: 1,
  });
  static Input = Input.extends({
    width: '100%',
  });

  constructor(props: Props) {
    super(props);
    this.state = {
      isConsoleEnabled: false,
      script: '',
      previousExecutions: [],
    };
  }

  executeScriptOnDevice = () => {
    this.props.client
      .call('executeCommand', {
        command: this.state.script,
        context: this.props.getContext(),
      })
      .then((result: ValueWithType) => {
        this.setState({
          script: '',
          previousExecutions: [
            ...this.state.previousExecutions,
            {
              command: this.state.script,
              result: {isSuccess: true, value: result},
            },
          ],
        });
      })
      .catch((onReject?) => {
        this.setState({
          previousExecutions: [
            ...this.state.previousExecutions,
            {
              command: this.state.script,
              result: {
                isSuccess: false,
                error: (onReject && onReject.message) || '',
              },
            },
          ],
        });
      });
  };

  onInputChange = (event: SyntheticInputEvent<>) => {
    this.setState({script: event.target.value});
  };

  onSubmit = (event: SyntheticEvent<>) => {
    if (this.state.script != '') {
      this.executeScriptOnDevice();
    }
    event.preventDefault();
  };

  buildCommandResultRowPair(
    command: string,
    result: CommandResult,
    index: number,
  ): TableRows {
    const key = index * 2;
    const commandRow: TableBodyRow = {
      columns: {
        command: {value: <Text>{command}</Text>},
      },
      key: key.toString(),
    };
    const resultRow: TableBodyRow = {
      columns: {
        command: {
          value: result.isSuccess ? (
            <ManagedDataInspector
              data={result.value}
              expandRoot={true}
              collapsed={true}
            />
          ) : (
            <ConsoleError error={result.error} />
          ),
        },
      },
      key: (key + 1).toString(),
    };
    return [commandRow, resultRow];
  }

  renderPreviousCommands() {
    const rows: TableRows = this.state.previousExecutions
      .map(({command, result}, index) =>
        this.buildCommandResultRowPair(command, result, index),
      )
      .reduce((x, y) => x.concat(y), []);
    return rows.length ? (
      <Console.CommandsTable
        columns={Console.TableColumns}
        rows={rows}
        multiline={true}
        stickyBottom={true}
        highlightableRows={false}
        hideHeader={true}
        autoHeight={true}
      />
    ) : null;
  }

  render() {
    return (
      <Console.Window>
        <View fill>{this.renderPreviousCommands()}</View>
        <form onSubmit={this.onSubmit}>
          <Console.Input
            onChange={this.onInputChange}
            placeholder="Command"
            value={this.state.script}
          />
        </form>
      </Console.Window>
    );
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import FlexColumn from './FlexColumn.js';
import styled from '../styled/index.js';
import PropTypes from 'prop-types';

type MenuTemplate = Array<Electron$MenuItemOptions>;

type Props = {
  items?: MenuTemplate,
  buildItems?: () => MenuTemplate,
  children: React$Node,
  component: React.ComponentType<any> | string,
};

export default class ContextMenu extends styled.StylablePureComponent<Props> {
  static defaultProps = {
    component: FlexColumn,
  };

  static contextTypes = {
    appendToContextMenu: PropTypes.func,
  };

  onContextMenu = (e: SyntheticMouseEvent<>) => {
    if (typeof this.context.appendToContextMenu === 'function') {
      if (this.props.items != null) {
        this.context.appendToContextMenu(this.props.items);
      } else if (this.props.buildItems != null) {
        this.context.appendToContextMenu(this.props.buildItems());
      }
    }
  };

  render() {
    const {
      items: _itesm,
      buildItems: _buildItems,
      component,
      ...props
    } = this.props;
    return React.createElement(
      component,
      {
        onContextMenu: this.onContextMenu,
        ...props,
      },
      this.props.children,
    );
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import {Component} from 'react';
import styled from '../styled/index.js';
import electron from 'electron';

const PropTypes = require('prop-types');

type MenuTemplate = Array<Electron$MenuItemOptions>;

const Container = styled.view({
  display: 'contents',
});

export default class ContextMenuProvider extends Component<{|
  children: React$Node,
|}> {
  static childContextTypes = {
    appendToContextMenu: PropTypes.func,
  };

  getChildContext() {
    return {appendToContextMenu: this.appendToContextMenu};
  }

  _menuTemplate: MenuTemplate = [];

  appendToContextMenu = (items: MenuTemplate) => {
    this._menuTemplate = this._menuTemplate.concat(items);
  };

  onContextMenu = () => {
    const menu = electron.remote.Menu.buildFromTemplate(this._menuTemplate);
    this._menuTemplate = [];
    menu.popup(electron.remote.getCurrentWindow(), {async: true});
  };

  render() {
    return (
      <Container onContextMenu={this.onContextMenu}>
        {this.props.children}
      </Container>
    );
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import styled from '../styled/index.js';
import {colors, darkColors} from './colors.js';

const React = require('react');

const DesktopDropdownContainer = styled.view({
  borderBottom: `1px solid ${darkColors.dividers}`,
  lineHeight: '25px',
  marginTop: 5,
  maxHeight: 600,
  minWidth: 180,
  overflow: 'auto',
  padding: 0,
  paddingBottom: 5,
  textAlign: 'left',
  width: 'auto',

  '&:last-child': {
    borderBottom: 'none',
  },
});

export function DesktopDropdown(props: {|
  deactivate?: () => void,
  children?: any,
|}) {
  return (
    <DesktopDropdownContainer>
      {React.Children.map(props.children, child => {
        return (
          child &&
          React.cloneElement(child, {
            deactivate: props.deactivate,
          })
        );
      })}
    </DesktopDropdownContainer>
  );
}

const DesktopDropdownItemContainer = styled.view(
  {
    listStyle: 'none',
    opacity: props => (props.onClick || props.onHover ? 1 : 0.5),
    padding: '0 20px',

    '&:hover': {
      backgroundColor: props =>
        props.onClick || props.onHover ? colors.highlight : '',
      color: props => (props.onClick || props.onHover ? '#fff' : 'inherit'),
    },
  },
  {
    ignoreAttributes: [],
  },
);

type DesktopDropdownItemState = {|hovered: boolean|};

type DesktopDropdownItemProps = {
  onClick?: false | ?((event: SyntheticMouseEvent<>) => void),
  onHover?: false | ?(() => React$Node),
  children?: React$Node,
  deactivate?: () => void,
};

export class DesktopDropdownItem extends styled.StylableComponent<
  DesktopDropdownItemProps,
  DesktopDropdownItemState,
> {
  constructor(props: DesktopDropdownItemProps, context: Object) {
    super(props, context);
    this.state = {hovered: false};
  }

  onMouseEnter = () => {
    this.setState({hovered: true});
  };

  onMouseLeave = () => {
    this.setState({hovered: false});
  };

  onClick = (event: SyntheticMouseEvent<>) => {
    const {deactivate, onClick} = this.props;
    if (typeof onClick === 'function') {
      if (deactivate) {
        deactivate();
      }
      onClick(event);
    }
  };

  render() {
    const {hovered} = this.state;
    const {
      children,
      deactivate: _deactivate,
      onClick,
      onHover,
      ...props
    } = this.props;

    return (
      <DesktopDropdownItemContainer
        {...props}
        onMouseEnter={this.onMouseEnter}
        onMouseLeave={this.onMouseLeave}
        onClick={typeof onClick === 'function' && this.onClick}>
        {children}
        {hovered && typeof onHover === 'function' && onHover()}
      </DesktopDropdownItemContainer>
    );
  }
}

export const DesktopDropdownSelectedItem = DesktopDropdownItem.extends({
  position: 'relative',

  '&::before': {
    content: "'✔'",
    marginLeft: '-15px',
    position: 'absolute',
  },
});
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import ContextMenu from './ContextMenu.js';

const invariant = require('invariant');

export default class Dropdown extends ContextMenu {
  trigger: string = 'onClick';

  ref: ?HTMLElement;

  getCoordinates(): {top: number, left: number} {
    const {ref} = this;
    invariant(ref, 'expected ref');

    const rect = ref.getBoundingClientRect();
    return {
      left: rect.left,
      top: rect.top,
    };
  }

  setRef = (ref: ?HTMLElement) => {
    this.ref = ref;
  };

  render() {
    return <span ref={this.setRef}>{this.props.children}</span>;
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import styled from '../styled/index.js';
import CodeBlock from './CodeBlock.js';

const ErrorBlockContainer = CodeBlock.extends({
  backgroundColor: '#f2dede',
  border: '1px solid #ebccd1',
  borderRadius: 4,
  color: '#a94442',
  overflow: 'auto',
  padding: 10,
});

export default class ErrorBlock extends styled.StylableComponent<{
  error: Error | string | void,
  className?: string,
}> {
  render() {
    const {className, error} = this.props;

    let stack = 'Unknown Error';
    if (typeof error === 'string') {
      stack = error;
    } else if (error && typeof error === 'object') {
      stack = error.stack || error.message || stack;
    }

    return (
      <ErrorBlockContainer className={className}>{stack}</ErrorBlockContainer>
    );
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import ErrorBlock from './ErrorBlock.js';
import {Component} from 'react';
import Heading from './Heading.js';
import Button from './Button.js';
import View from './View.js';
import LogManager from '../../fb-stubs/Logger.js';

const ErrorBoundaryContainer = View.extends({
  overflow: 'auto',
  padding: 10,
});

const ErrorBoundaryStack = ErrorBlock.extends({
  marginBottom: 10,
});

type ErrorBoundaryProps = {
  buildHeading?: (err: Error) => string,
  heading?: string,
  logger?: LogManager,
  showStack?: boolean,
  children?: React$Node,
};

type ErrorBoundaryState = {|
  error: ?Error,
|};

export default class ErrorBoundary extends Component<
  ErrorBoundaryProps,
  ErrorBoundaryState,
> {
  constructor(props: ErrorBoundaryProps, context: Object) {
    super(props, context);
    this.state = {error: null};
  }

  componentDidCatch(err: Error) {
    this.props.logger &&
      this.props.logger.error(err.toString(), 'ErrorBoundary');
    this.setState({error: err});
  }

  clearError = () => {
    this.setState({error: null});
  };

  render() {
    const {error} = this.state;
    if (error) {
      const {buildHeading} = this.props;
      let {heading} = this.props;
      if (buildHeading) {
        heading = buildHeading(error);
      }
      if (heading == null) {
        heading = 'An error has occured';
      }

      return (
        <ErrorBoundaryContainer fill={true}>
          <Heading>{heading}</Heading>
          {this.props.showStack !== false && (
            <ErrorBoundaryStack error={error} />
          )}
          <Button onClick={this.clearError}>Clear error and try again</Button>
        </ErrorBoundaryContainer>
      );
    } else {
      return this.props.children;
    }
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import {Component} from 'react';

const React = require('react');
const fs = require('fs');

type FileProps = {|
  src: string,
  buffer?: ?string,
  encoding: string,
  onError?: (err: Error) => React.Element<*>,
  onLoading?: () => React.Element<*>,
  onData?: (content: string) => void,
  onLoad: (content: string) => React.Element<*>,
|};

type FileState = {|
  error: ?Error,
  loaded: boolean,
  content: string,
|};

export default class File extends Component<FileProps, FileState> {
  constructor(props: FileProps, context: Object) {
    super(props, context);
    this.state = {
      content: props.buffer || '',
      error: null,
      loaded: props.buffer != null,
    };
  }

  static defaultProps = {
    encoding: 'utf8',
  };

  componentWillReceiveProps(nextProps: FileProps) {
    if (nextProps.buffer != null) {
      this.setState({content: nextProps.buffer, loaded: true});
    }
  }

  componentDidMount() {
    if (this.state.loaded) {
      return;
    }

    fs.readFile(this.props.src, this.props.encoding, (err, content) => {
      if (err) {
        this.setState({error: err});
        return;
      }

      this.setState({content, loaded: true});

      if (this.props.onData) {
        this.props.onData(content);
      }
    });
  }

  render() {
    const {onError, onLoad, onLoading} = this.props;
    const {content, error, loaded} = this.state;

    if (error && onError) {
      return onError(error);
    } else if (loaded) {
      return onLoad(content);
    } else if (onLoading) {
      return onLoading();
    } else {
      return null;
    }
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import {Component} from 'react';

const path = require('path');
const fs = require('fs');

const EMPTY_MAP = new Map();
const EMPTY_FILE_LIST_STATE = {error: null, files: EMPTY_MAP};

export type FileListFileType = 'file' | 'folder';

export type FileListFile = {|
  name: string,
  src: string,
  type: FileListFileType,
  size: number,
  mtime: number,
  atime: number,
  ctime: number,
  birthtime: number,
|};

export type FileListFiles = Array<FileListFile>;

type FileListProps = {
  src: string,
  onError?: ?(err: Error) => React$Node,
  onLoad?: () => void,
  onFiles: (files: FileListFiles) => React$Node,
};

type FileListState = {|
  files: Map<string, FileListFile>,
  error: ?Error,
|};

export default class FileList extends Component<FileListProps, FileListState> {
  constructor(props: FileListProps, context: Object) {
    super(props, context);
    this.state = EMPTY_FILE_LIST_STATE;
  }

  watcher: ?fs.FSWatcher;

  fetchFile(name: string): Promise<FileListFile> {
    return new Promise((resolve, reject) => {
      const loc = path.join(this.props.src, name);

      fs.lstat(loc, (err, stat) => {
        if (err) {
          reject(err);
        } else {
          const details: FileListFile = {
            atime: Number(stat.atime),
            birthtime:
              typeof stat.birthtime === 'object' ? Number(stat.birthtime) : 0,
            ctime: Number(stat.ctime),
            mtime: Number(stat.mtime),
            name,
            size: stat.size,
            src: loc,
            type: stat.isDirectory() ? 'folder' : 'file',
          };
          resolve(details);
        }
      });
    });
  }

  fetchFiles(callback?: Function) {
    const {src} = this.props;

    const setState = data => {
      if (!hasChangedDir()) {
        this.setState(data);
      }
    };

    const hasChangedDir = () => this.props.src !== src;

    fs.readdir(src, (err, files) => {
      if (err) {
        setState({error: err, files: EMPTY_MAP});
        return;
      }

      const filesSet: Map<string, FileListFile> = new Map();
      const next = () => {
        if (hasChangedDir()) {
          return;
        }

        if (!files.length) {
          setState({error: null, files: filesSet});
          if (callback) {
            callback();
          }
          return;
        }

        const name = files.shift();
        this.fetchFile(name)
          .then(data => {
            filesSet.set(name, data);
            next();
          })
          .catch(err => {
            setState({error: err, files: EMPTY_MAP});
          });
      };

      next();
    });
  }

  componentWillReceiveProps(nextProps: FileListProps) {
    if (nextProps.src !== this.props.src) {
      this.initialFetch(nextProps);
    }
  }

  componentDidMount() {
    this.initialFetch(this.props);
  }

  componentWillUnmount() {
    this.removeWatcher();
  }

  initialFetch(props: FileListProps) {
    this.removeWatcher();

    fs.access(props.src, fs.constants.R_OK, err => {
      if (err) {
        this.setState({error: err, files: EMPTY_MAP});
        return;
      }

      this.fetchFiles(props.onLoad);

      this.watcher = fs.watch(props.src, () => {
        this.fetchFiles();
      });

      this.watcher.on('error', err => {
        this.setState({error: err, files: EMPTY_MAP});
        this.removeWatcher();
      });
    });
  }

  removeWatcher() {
    if (this.watcher) {
      this.watcher.close();
    }
  }

  render() {
    const {error, files} = this.state;
    const {onError, onFiles} = this.props;
    if (error && onError) {
      return onError(error);
    } else {
      return onFiles(Array.from(files.values()));
    }
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import View from './View.js';

export default View.extends(
  {
    display: 'flex',
    flexShrink: props => (props.shrink == null || props.shrink ? 1 : 0),
  },
  {
    ignoreAttributes: ['shrink'],
  },
);
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import View from './View.js';

export default View.extends({
  display: 'flex',
  alignItems: 'center',
  justifyContent: 'center',
});
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import FlexBox from './FlexBox.js';

export default FlexBox.extends({
  flexDirection: 'column',
});
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import FlexBox from './FlexBox.js';

export default FlexBox.extends({
  flexDirection: 'row',
});
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import {Component} from 'react';
import Box from './Box.js';
import {colors} from './colors';

const FocusableBoxBorder = Box.extends(
  {
    border: `1px solid ${colors.highlight}`,
    bottom: '0',
    left: '0',
    pointerEvents: 'none',
    position: 'absolute',
    right: '0',
    top: '0',
  },
  {
    ignoreAttributes: [],
  },
);

export default class FocusableBox extends Component<
  Object,
  {|
    focused: boolean,
  |},
> {
  constructor(props: Object, context: Object) {
    super(props, context);
    this.state = {focused: false};
  }

  static defaultProps = {
    focusable: true,
  };

  onBlur = (e: SyntheticFocusEvent<>) => {
    const {onBlur} = this.props;
    if (onBlur) {
      onBlur(e);
    }
    if (this.state.focused) {
      this.setState({focused: false});
    }
  };

  onFocus = (e: SyntheticFocusEvent<>) => {
    const {onFocus} = this.props;
    if (onFocus) {
      onFocus(e);
    }
    if (this.props.focusable) {
      this.setState({focused: true});
    }
  };

  render() {
    const {props} = this;

    return (
      <Box {...props} onFocus={this.onFocus} onBlur={this.onBlur} tabIndex="0">
        {props.children}
        {this.state.focused && <FocusableBoxBorder />}
      </Box>
    );
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import styled from '../styled/index.js';
const PropTypes = require('prop-types');
import {getIconUrl} from '../../utils/icons.js';

const ColoredIconBlack = styled.image(
  {
    height: props => props.size,
    verticalAlign: 'middle',
    width: props => props.size,
  },
  {
    ignoreAttributes: ['size'],
  },
);

const ColoredIconCustom = styled.view(
  {
    height: props => props.size,
    verticalAlign: 'middle',
    width: props => props.size,
    backgroundColor: props => props.color,
    display: 'inline-block',
    maskImage: props => `url('${props.src}')`,
    maskSize: '100% 100%',
    // $FlowFixMe: prefixed property
    WebkitMaskImage: props => `url('${props.src}')`,
    // $FlowFixMe: prefixed property
    WebkitMaskSize: '100% 100%',
  },
  {
    ignoreAttributes: ['color', 'size', 'src'],
  },
);

export function ColoredIcon(
  props: {|
    name: string,
    src: string,
    size?: number,
    className?: string,
    color?: string,
  |},
  context: {|
    glyphColor?: string,
  |},
) {
  const {color = context.glyphColor, name, size = 16, src} = props;

  const isBlack =
    color == null ||
    color === '#000' ||
    color === 'black' ||
    color === '#000000';

  if (isBlack) {
    return (
      <ColoredIconBlack
        alt={name}
        src={src}
        size={size}
        className={props.className}
      />
    );
  } else {
    return (
      <ColoredIconCustom
        color={color}
        size={size}
        src={src}
        className={props.className}
      />
    );
  }
}

ColoredIcon.contextTypes = {
  glyphColor: PropTypes.string,
};

export default class Glyph extends styled.StylablePureComponent<{
  name: string,
  size?: 8 | 10 | 12 | 16 | 18 | 20 | 24 | 32,
  variant?: 'filled' | 'outline',
  className?: string,
  color?: string,
}> {
  render() {
    const {name, size, variant, color, className} = this.props;

    return (
      <ColoredIcon
        name={name}
        className={className}
        color={color}
        size={size}
        src={getIconUrl(name, size, variant)}
      />
    );
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import styled from '../styled/index.js';

const LargeHeading = styled.view({
  fontSize: 18,
  fontWeight: 'bold',
  lineHeight: '20px',
  borderBottom: '1px solid #ddd',
  marginBottom: 10,
});

const SmallHeading = styled.view({
  fontSize: 12,
  color: '#90949c',
  fontWeight: 'bold',
  marginBottom: 10,
  textTransform: 'uppercase',
});

/**
 * A heading component.
 *
 * @example Heading 1
 *   <Heading level={1}>I'm a heading</Heading>
 * @example Heading 2
 *   <Heading level={2}>I'm a heading</Heading>
 * @example Heading 3
 *   <Heading level={3}>I'm a heading</Heading>
 * @example Heading 4
 *   <Heading level={4}>I'm a heading</Heading>
 * @example Heading 5
 *   <Heading level={5}>I'm a heading</Heading>
 * @example Heading 6
 *   <Heading level={6}>I'm a heading</Heading>
 */
export default function Heading(props: {
  /**
   * Level of the heading. A number from 1-6. Where 1 is the largest heading.
   */
  level?: number,
  /**
   * Children.
   */
  children?: React$Node,
}) {
  if (props.level === 1) {
    return <LargeHeading>{props.children}</LargeHeading>;
  } else {
    return <SmallHeading>{props.children}</SmallHeading>;
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import styled from '../styled/index.js';

export default styled.view({
  backgroundColor: '#c9ced4',
  height: 1,
  margin: '5px 0',
});
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import ContextMenu from './ContextMenu.js';

export default class InlineContextMenu extends ContextMenu {
  render() {
    return <span>{this.props.children}</span>;
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import styled from '../styled/index.js';
import {colors} from './colors.js';

export const inputStyle = {
  border: `1px solid ${colors.light15}`,
  borderRadius: 4,
  font: 'inherit',
  fontSize: '1em',
  height: (props: Object) => (props.compact ? '17px' : '28px'),
  lineHeight: (props: Object) => (props.compact ? '17px' : '28px'),
  marginRight: 5,

  '&:disabled': {
    backgroundColor: '#ddd',
    borderColor: '#ccc',
    cursor: 'not-allowed',
  },
};

const Input = styled.textInput(
  {
    ...inputStyle,
    padding: props => (props.compact ? '0 5px' : '0 10px'),
  },
  {
    ignoreAttributes: ['compact'],
  },
);

Input.defaultProps = {
  type: 'text',
};

export default Input;
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type {Rect} from '../../utils/geometry.js';
import LowPassFilter from '../../utils/LowPassFilter.js';
import {
  getDistanceTo,
  maybeSnapLeft,
  maybeSnapTop,
  SNAP_SIZE,
} from '../../utils/snap.js';
import {styled} from 'sonar';

const invariant = require('invariant');
const React = require('react');

const WINDOW_CURSOR_BOUNDARY = 5;

type CursorState = {|
  top: number,
  left: number,
|};

type ResizingSides = ?{|
  left?: boolean,
  top?: boolean,
  bottom?: boolean,
  right?: boolean,
|};

const ALL_RESIZABLE: ResizingSides = {
  bottom: true,
  left: true,
  right: true,
  top: true,
};

type InteractiveProps = {|
  isMovableAnchor?: (event: SyntheticMouseEvent<>) => boolean,
  onMoveStart?: () => void,
  onMoveEnd?: () => void,
  onMove?: (top: number, left: number, event: SyntheticMouseEvent<>) => void,
  id?: string,
  movable?: boolean,
  hidden?: boolean,
  moving?: boolean,
  fill?: boolean,
  siblings?: $Shape<{[key: string]: $Shape<Rect>}>,
  updateCursor?: (cursor: ?string) => void,
  zIndex?: number,
  top?: number,
  left?: number,
  minTop: number,
  minLeft: number,
  width?: number | string,
  height?: number | string,
  minWidth: number,
  minHeight: number,
  maxWidth?: number,
  maxHeight?: number,
  onCanResize?: (sides: ResizingSides) => void,
  onResizeStart?: () => void,
  onResizeEnd?: () => void,
  onResize?: (width: number, height: number) => void,
  resizing?: boolean,
  resizable?: boolean | ResizingSides,
  innerRef?: (elem: HTMLElement) => void,
  style?: Object,
  className?: string,
  children?: React.Element<*>,
|};

type InteractiveState = {|
  moving: boolean,
  movingInitialProps: ?InteractiveProps,
  movingInitialCursor: ?CursorState,
  cursor: ?string,
  resizingSides: ResizingSides,
  couldResize: boolean,
  resizing: boolean,
  resizingInitialRect: ?Rect,
  resizingInitialCursor: ?CursorState,
|};

const InteractiveContainer = styled.view({
  willChange: 'transform, height, width, z-index',
});

export default class Interactive extends styled.StylableComponent<
  InteractiveProps,
  InteractiveState,
> {
  constructor(props: InteractiveProps, context: Object) {
    super(props, context);

    this.state = {
      couldResize: false,
      cursor: null,
      moving: false,
      movingInitialCursor: null,
      movingInitialProps: null,
      resizing: false,
      resizingInitialCursor: null,
      resizingInitialRect: null,
      resizingSides: null,
    };

    this.globalMouse = false;
  }

  globalMouse: boolean;
  ref: HTMLElement;

  nextTop: ?number;
  nextLeft: ?number;
  nextEvent: ?SyntheticMouseEvent<>;

  static defaultProps = {
    minHeight: 0,
    minLeft: 0,
    minTop: 0,
    minWidth: 0,
  };

  onMouseMove = (event: SyntheticMouseEvent<>) => {
    if (this.state.moving) {
      this.calculateMove(event);
    } else if (this.state.resizing) {
      this.calculateResize(event);
    } else {
      this.calculateResizable(event);
    }
  };

  startAction = (event: SyntheticMouseEvent<>) => {
    this.globalMouse = true;
    window.addEventListener('pointerup', this.endAction, {passive: true});
    window.addEventListener('pointermove', this.onMouseMove, {passive: true});

    const {isMovableAnchor} = this.props;
    if (isMovableAnchor && isMovableAnchor(event)) {
      this.startTitleAction(event);
    } else {
      this.startWindowAction(event);
    }
  };

  startTitleAction(event: SyntheticMouseEvent<>) {
    if (this.state.couldResize) {
      this.startResizeAction(event);
    } else if (this.props.movable === true) {
      this.startMoving(event);
    }
  }

  startMoving(event: SyntheticMouseEvent<>) {
    const {onMoveStart} = this.props;
    if (onMoveStart) {
      onMoveStart();
    }

    if (this.context.os) {
      // pause OS timers to avoid lag when dragging
      this.context.os.timers.pause();
    }

    const topLpf = new LowPassFilter();
    const leftLpf = new LowPassFilter();

    this.nextTop = null;
    this.nextLeft = null;
    this.nextEvent = null;

    const onFrame = () => {
      if (!this.state.moving) {
        return;
      }

      const {nextEvent, nextTop, nextLeft} = this;
      if (nextEvent && nextTop != null && nextLeft != null) {
        if (topLpf.hasFullBuffer()) {
          const newTop = topLpf.next(nextTop);
          const newLeft = leftLpf.next(nextLeft);
          this.move(newTop, newLeft, nextEvent);
        } else {
          this.move(nextTop, nextLeft, nextEvent);
        }
      }

      requestAnimationFrame(onFrame);
    };

    this.setState(
      {
        cursor: 'move',
        moving: true,
        movingInitialCursor: {
          left: event.clientX,
          top: event.clientY,
        },
        movingInitialProps: this.props,
      },
      onFrame,
    );
  }

  getPossibleTargetWindows(rect: Rect) {
    const closeWindows = [];

    const {siblings} = this.props;
    if (siblings) {
      for (const key in siblings) {
        if (key === this.props.id) {
          // don't target ourselves
          continue;
        }

        const win = siblings[key];
        const distance = getDistanceTo(rect, win);
        if (distance <= SNAP_SIZE) {
          closeWindows.push(win);
        }
      }
    }

    return closeWindows;
  }

  startWindowAction(event: SyntheticMouseEvent<>) {
    if (this.state.couldResize) {
      this.startResizeAction(event);
    }
  }

  startResizeAction(event: SyntheticMouseEvent<>) {
    event.stopPropagation();
    event.preventDefault();

    const {onResizeStart} = this.props;
    if (onResizeStart) {
      onResizeStart();
    }

    this.setState({
      resizing: true,
      resizingInitialCursor: {
        left: event.clientX,
        top: event.clientY,
      },
      resizingInitialRect: this.getRect(),
    });
  }

  componentDidUpdate(prevProps: InteractiveProps, prevState: InteractiveState) {
    if (prevState.cursor !== this.state.cursor) {
      const {updateCursor} = this.props;
      if (updateCursor) {
        updateCursor(this.state.cursor);
      }
    }
  }

  resetMoving() {
    const {onMoveEnd} = this.props;
    if (onMoveEnd) {
      onMoveEnd();
    }

    if (this.context.os) {
      // resume os timers
      this.context.os.timers.resume();
    }

    this.setState({
      cursor: undefined,
      moving: false,
      movingInitialProps: undefined,
      resizingInitialCursor: undefined,
    });
  }

  resetResizing() {
    const {onResizeEnd} = this.props;
    if (onResizeEnd) {
      onResizeEnd();
    }

    this.setState({
      resizing: false,
      resizingInitialCursor: undefined,
      resizingInitialRect: undefined,
      resizingSides: undefined,
    });
  }

  componentWillUnmount() {
    this.endAction();
  }

  endAction = () => {
    this.globalMouse = false;

    window.removeEventListener('pointermove', this.onMouseMove);
    window.removeEventListener('pointerup', this.endAction);

    if (this.state.moving) {
      this.resetMoving();
    }

    if (this.state.resizing) {
      this.resetResizing();
    }
  };

  onMouseLeave = () => {
    if (!this.state.resizing && !this.state.moving) {
      this.setState({
        cursor: undefined,
      });
    }
  };

  calculateMove(event: SyntheticMouseEvent<>) {
    const {movingInitialCursor, movingInitialProps} = this.state;

    invariant(movingInitialProps, 'TODO');
    invariant(movingInitialCursor, 'TODO');

    const {clientX: cursorLeft, clientY: cursorTop} = event;

    const movedLeft = movingInitialCursor.left - cursorLeft;
    const movedTop = movingInitialCursor.top - cursorTop;

    let newLeft = (movingInitialProps.left || 0) - movedLeft;
    let newTop = (movingInitialProps.top || 0) - movedTop;

    if (event.altKey) {
      const snapProps = this.getRect();
      const windows = this.getPossibleTargetWindows(snapProps);
      newLeft = maybeSnapLeft(snapProps, windows, newLeft);
      newTop = maybeSnapTop(snapProps, windows, newTop);
    }

    this.nextTop = newTop;
    this.nextLeft = newLeft;
    this.nextEvent = event;
  }

  resize(width: number, height: number) {
    if (width === this.props.width && height === this.props.height) {
      // noop
      return;
    }

    const {onResize} = this.props;
    if (!onResize) {
      return;
    }

    width = Math.max(this.props.minWidth, width);
    height = Math.max(this.props.minHeight, height);

    const {maxHeight, maxWidth} = this.props;
    if (maxWidth != null) {
      width = Math.min(maxWidth, width);
    }
    if (maxHeight != null) {
      height = Math.min(maxHeight, height);
    }

    onResize(width, height);
  }

  move(top: number, left: number, event: SyntheticMouseEvent<>) {
    top = Math.max(this.props.minTop, top);
    left = Math.max(this.props.minLeft, left);

    if (top === this.props.top && left === this.props.left) {
      // noop
      return;
    }

    const {onMove} = this.props;
    if (onMove) {
      onMove(top, left, event);
    }
  }

  calculateResize(event: SyntheticMouseEvent<>) {
    const {
      resizingInitialCursor,
      resizingInitialRect,
      resizingSides,
    } = this.state;

    invariant(resizingInitialRect, 'TODO');
    invariant(resizingInitialCursor, 'TODO');
    invariant(resizingSides, 'TODO');

    const deltaLeft = resizingInitialCursor.left - event.clientX;
    const deltaTop = resizingInitialCursor.top - event.clientY;

    let newLeft = resizingInitialRect.left;
    let newTop = resizingInitialRect.top;

    let newWidth = resizingInitialRect.width;
    let newHeight = resizingInitialRect.height;

    // right
    if (resizingSides.right === true) {
      newWidth -= deltaLeft;
    }

    // bottom
    if (resizingSides.bottom === true) {
      newHeight -= deltaTop;
    }

    const rect = this.getRect();

    // left
    if (resizingSides.left === true) {
      newLeft -= deltaLeft;
      newWidth += deltaLeft;

      if (this.props.movable === true) {
        // prevent from being shrunk past the minimum width
        const right = rect.left + rect.width;
        const maxLeft = right - this.props.minWidth;

        let cleanLeft = Math.max(0, newLeft);
        cleanLeft = Math.min(cleanLeft, maxLeft);
        newWidth -= Math.abs(newLeft - cleanLeft);
        newLeft = cleanLeft;
      }
    }

    // top
    if (resizingSides.top === true) {
      newTop -= deltaTop;
      newHeight += deltaTop;

      if (this.props.movable === true) {
        // prevent from being shrunk past the minimum height
        const bottom = rect.top + rect.height;
        const maxTop = bottom - this.props.minHeight;

        let cleanTop = Math.max(0, newTop);
        cleanTop = Math.min(cleanTop, maxTop);
        newHeight += newTop - cleanTop;
        newTop = cleanTop;
      }
    }

    if (event.altKey) {
      const windows = this.getPossibleTargetWindows(rect);

      if (resizingSides.left === true) {
        const newLeft2 = maybeSnapLeft(rect, windows, newLeft);
        newWidth += newLeft - newLeft2;
        newLeft = newLeft2;
      }

      if (resizingSides.top === true) {
        const newTop2 = maybeSnapTop(rect, windows, newTop);
        newHeight += newTop - newTop2;
        newTop = newTop2;
      }

      if (resizingSides.bottom === true) {
        newHeight = maybeSnapTop(rect, windows, newTop + newHeight) - newTop;
      }

      if (resizingSides.right === true) {
        newWidth = maybeSnapLeft(rect, windows, newLeft + newWidth) - newLeft;
      }
    }

    this.move(newTop, newLeft, event);
    this.resize(newWidth, newHeight);
  }

  getRect(): Rect {
    const {props, ref} = this;
    invariant(ref, 'expected ref');

    return {
      height: ref.offsetHeight || 0,
      left: props.left || 0,
      top: props.top || 0,
      width: ref.offsetWidth || 0,
    };
  }

  getResizable(): ResizingSides {
    const {resizable} = this.props;

    if (resizable === true) {
      return ALL_RESIZABLE;
    } else if (resizable == null || resizable === false) {
      return;
    } else {
      return resizable;
    }
  }

  checkIfResizable(
    event: SyntheticMouseEvent<>,
  ): ?{|
    left: boolean,
    right: boolean,
    top: boolean,
    bottom: boolean,
  |} {
    const canResize = this.getResizable();
    if (!canResize) {
      return;
    }

    const {left: offsetLeft, top: offsetTop} = this.ref.getBoundingClientRect();
    const {height, width} = this.getRect();

    const x = event.clientX - offsetLeft;
    const y = event.clientY - offsetTop;

    const atTop: boolean = y <= WINDOW_CURSOR_BOUNDARY;
    const atBottom: boolean = y >= height - WINDOW_CURSOR_BOUNDARY;

    const atLeft: boolean = x <= WINDOW_CURSOR_BOUNDARY;
    const atRight: boolean = x >= width - WINDOW_CURSOR_BOUNDARY;

    return {
      bottom: canResize.bottom === true && atBottom,
      left: canResize.left === true && atLeft,
      right: canResize.right === true && atRight,
      top: canResize.top === true && atTop,
    };
  }

  calculateResizable(event: SyntheticMouseEvent<>) {
    const resizing = this.checkIfResizable(event);
    if (!resizing) {
      return;
    }

    const canResize = this.getResizable();
    if (!canResize) {
      return;
    }

    const {bottom, left, right, top} = resizing;
    let newCursor;

    const movingHorizontal = left || right;
    const movingVertical = top || left;

    // left
    if (left) {
      newCursor = 'ew-resize';
    }

    // right
    if (right) {
      newCursor = 'ew-resize';
    }

    // if resizing vertically and one side can't be resized then use different cursor
    if (
      movingHorizontal &&
      (canResize.left !== true || canResize.right !== true)
    ) {
      newCursor = 'col-resize';
    }

    // top
    if (top) {
      newCursor = 'ns-resize';

      // top left
      if (left) {
        newCursor = 'nwse-resize';
      }

      // top right
      if (right) {
        newCursor = 'nesw-resize';
      }
    }

    // bottom
    if (bottom) {
      newCursor = 'ns-resize';

      // bottom left
      if (left) {
        newCursor = 'nesw-resize';
      }

      // bottom right
      if (right) {
        newCursor = 'nwse-resize';
      }
    }

    // if resizing horziontally and one side can't be resized then use different cursor
    if (
      movingVertical &&
      !movingHorizontal &&
      (canResize.top !== true || canResize.bottom !== true)
    ) {
      newCursor = 'row-resize';
    }

    const resizingSides = {
      bottom,
      left,
      right,
      top,
    };

    const {onCanResize} = this.props;
    if (onCanResize) {
      onCanResize();
    }

    this.setState({
      couldResize: Boolean(newCursor),
      cursor: newCursor,
      resizingSides,
    });
  }

  setRef = (ref: HTMLElement) => {
    this.ref = ref;

    const {innerRef} = this.props;
    if (innerRef) {
      innerRef(ref);
    }
  };

  onLocalMouseMove = (event: SyntheticMouseEvent<>) => {
    if (!this.globalMouse) {
      this.onMouseMove(event);
    }
  };

  render() {
    const {fill, height, left, movable, top, width, zIndex} = this.props;

    const style: Object = {
      cursor: this.state.cursor,
      zIndex: zIndex == null ? 'auto' : zIndex,
    };

    if (movable === true || top != null || left != null) {
      if (fill === true) {
        style.left = left || 0;
        style.top = top || 0;
      } else {
        style.transform = `translate3d(${left || 0}px, ${top || 0}px, 0)`;
      }
    }

    if (fill === true) {
      style.right = 0;
      style.bottom = 0;
      style.width = '100%';
      style.height = '100%';
    } else {
      style.width = width == null ? 'auto' : width;
      style.height = height == null ? 'auto' : height;
    }

    if (this.props.style) {
      Object.assign(style, this.props.style);
    }

    return (
      <InteractiveContainer
        className={this.props.className}
        hidden={this.props.hidden}
        innerRef={this.setRef}
        onMouseDown={this.startAction}
        onMouseMove={this.onLocalMouseMove}
        onMouseLeave={this.onMouseLeave} // eslint-disable-next-line
        style={style}>
        {this.props.children}
      </InteractiveContainer>
    );
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import styled from '../styled/index.js';

export default styled.view({
  fontSize: 12,
  fontWeight: 'bold',
});
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import styled from '../styled/index.js';
import {colors} from './colors.js';
import {Component} from 'react';
import {shell} from 'electron';

const StyledLink = styled.text(
  {
    color: colors.highlight,
    '&:hover': {
      cursor: 'pointer',
      textDecoration: 'underline',
    },
  },
  {
    ignoreAttributes: [],
  },
);

export default class Link extends Component<{
  href: string,
  children?: React$Node,
}> {
  onClick = () => {
    shell.openExternal(this.props.href);
  };

  render() {
    return (
      <StyledLink onClick={this.onClick}>{this.props.children}</StyledLink>
    );
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type {StyledComponent} from '../styled/index.js';
import styled from '../styled/index.js';

const animation = styled.keyframes({
  '0%': {
    transform: 'rotate(0deg)',
  },
  '100%': {
    transform: 'rotate(360deg)',
  },
});

const LoadingIndicator: StyledComponent<{
  size?: number,
}> = styled.view(
  {
    animation: `${animation} 1s infinite linear`,
    width: props => props.size,
    height: props => props.size,
    minWidth: props => props.size,
    minHeight: props => props.size,
    borderRadius: '50%',
    border: props => `${props.size / 6}px solid rgba(0, 0, 0, 0.2)`,
    borderLeftColor: 'rgba(0, 0, 0, 0.4)',
  },
  {
    ignoreAttributes: ['size'],
  },
);

LoadingIndicator.defaultProps = {
  size: 50,
};

export default LoadingIndicator;
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import styled from '../styled/index.js';
import {Component} from 'react';

const Overlay = styled.view({
  alignItems: 'center',
  backgroundColor: 'rgba(0, 0, 0, 0.6)',
  bottom: 0,
  display: 'flex',
  justifyContent: 'center',
  left: 0,
  position: 'absolute',
  right: 0,
  top: 0,
  zIndex: 99999,
});

export default class ModalOverlay extends Component<{
  onClose: () => void,
  children?: React$Node,
}> {
  ref: HTMLElement;

  setRef = (ref: HTMLElement) => {
    this.ref = ref;
  };

  onClick = (e: SyntheticMouseEvent<>) => {
    if (e.target === this.ref) {
      this.props.onClose();
    }
  };

  render() {
    const {props} = this;

    return (
      <Overlay innerRef={this.setRef} onClick={this.onClick}>
        {props.children}
      </Overlay>
    );
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type {Rect} from '../../utils/geometry.js';
import styled from '../styled/index.js';
import {Component} from 'react';

const React = require('react');

export type OrderableOrder = Array<string>;

type OrderableOrientation = 'horizontal' | 'vertical';

type OrderableProps = {
  items: {[key: string]: React.Element<*>},
  orientation: OrderableOrientation,
  onChange?: (order: OrderableOrder, key: string) => void,
  order?: ?OrderableOrder,
  className?: string,
  reverse?: boolean,
  altKey?: boolean,
  moveDelay?: number,
  dragOpacity?: number,
  ignoreChildEvents?: boolean,
};

type OrderableState = {|
  order?: ?OrderableOrder,
  movingOrder?: ?OrderableOrder,
|};

type TabSizes = {
  [key: string]: Rect,
};

const OrderableContainer = styled.view({
  position: 'relative',
});

const OrderableItemContainer = styled.view(
  {
    display: props =>
      props.orientation === 'vertical' ? 'block' : 'inline-block',
  },
  {
    ignoreAttributes: ['orientation'],
  },
);

class OrderableItem extends Component<{
  orientation: OrderableOrientation,
  id: string,
  children?: React$Node,
  addRef: (key: string, ref: HTMLElement) => void,
  startMove: (KEY: string, event: SyntheticMouseEvent<>) => void,
}> {
  addRef = (ref: HTMLElement) => {
    this.props.addRef(this.props.id, ref);
  };

  startMove = (event: SyntheticMouseEvent<>) => {
    this.props.startMove(this.props.id, event);
  };

  render() {
    return (
      <OrderableItemContainer
        orientation={this.props.orientation}
        key={this.props.id}
        innerRef={this.addRef}
        onMouseDown={this.startMove}>
        {this.props.children}
      </OrderableItemContainer>
    );
  }
}

export default class Orderable extends styled.StylableComponent<
  OrderableProps,
  OrderableState,
> {
  constructor(props: OrderableProps, context: Object) {
    super(props, context);
    this.tabRefs = {};
    this.state = {order: props.order};
    this.setProps(props);
  }

  _mousemove: ?Function;
  _mouseup: ?Function;
  timer: any;

  sizeKey: 'width' | 'height';
  offsetKey: 'left' | 'top';
  mouseKey: 'offsetX' | 'offsetY';
  screenKey: 'screenX' | 'screenY';

  containerRef: ?HTMLElement;
  tabRefs: {
    [key: string]: ?HTMLElement,
  };

  static defaultProps = {
    dragOpacity: 1,
    moveDelay: 50,
  };

  setProps(props: OrderableProps) {
    const {orientation} = props;
    this.sizeKey = orientation === 'horizontal' ? 'width' : 'height';
    this.offsetKey = orientation === 'horizontal' ? 'left' : 'top';
    this.mouseKey = orientation === 'horizontal' ? 'offsetX' : 'offsetY';
    this.screenKey = orientation === 'horizontal' ? 'screenX' : 'screenY';
  }

  shouldComponentUpdate() {
    return !this.state.movingOrder;
  }

  componentWillReceiveProps(nextProps: OrderableProps) {
    this.setState({
      order: nextProps.order,
    });
    this.setProps(nextProps);
  }

  startMove = (key: string, event: SyntheticMouseEvent<*>) => {
    if (this.props.altKey === true && event.altKey === false) {
      return;
    }

    if (this.props.ignoreChildEvents === true) {
      const tabRef = this.tabRefs[key];
      // $FlowFixMe parentNode not implemented
      if (event.target !== tabRef && event.target.parentNode !== tabRef) {
        return;
      }
    }

    this.reset();
    event.persist();

    const {moveDelay} = this.props;
    if (moveDelay == null) {
      this._startMove(key, event);
    } else {
      const cancel = () => {
        clearTimeout(this.timer);
        document.removeEventListener('mouseup', cancel);
      };
      document.addEventListener('mouseup', cancel);

      this.timer = setTimeout(() => {
        cancel();
        this._startMove(key, event);
      }, moveDelay);
    }
  };

  _startMove(activeKey: string, event: SyntheticMouseEvent<>) {
    // $FlowFixMe
    const clickOffset = event.nativeEvent[this.mouseKey];

    // calculate offsets before we start moving element
    const sizes: TabSizes = {};
    for (const key in this.tabRefs) {
      const elem = this.tabRefs[key];
      if (elem) {
        const rect: Rect = elem.getBoundingClientRect();
        sizes[key] = {
          height: rect.height,
          left: elem.offsetLeft,
          top: elem.offsetTop,
          width: rect.width,
        };
      }
    }

    const {containerRef} = this;
    if (containerRef) {
      containerRef.style.height = `${containerRef.offsetHeight}px`;
      containerRef.style.width = `${containerRef.offsetWidth}px`;
    }

    for (const key in this.tabRefs) {
      const elem = this.tabRefs[key];
      if (elem) {
        const size = sizes[key];
        elem.style.position = 'absolute';
        elem.style.top = `${size.top}px`;
        elem.style.left = `${size.left}px`;
        elem.style.height = `${size.height}px`;
        elem.style.width = `${size.width}px`;
      }
    }

    document.addEventListener(
      'mouseup',
      (this._mouseup = () => {
        this.stopMove(activeKey, sizes);
      }),
      {passive: true},
    );

    // $FlowFixMe
    const screenClickPos = event.nativeEvent[this.screenKey];

    document.addEventListener(
      'mousemove',
      (this._mousemove = (event: MouseEvent) => {
        // $FlowFixMe
        const goingOpposite = event[this.screenKey] < screenClickPos;
        this.possibleMove(activeKey, goingOpposite, event, clickOffset, sizes);
      }),
      {passive: true},
    );
  }

  possibleMove(
    activeKey: string,
    goingOpposite: boolean,
    event: MouseEvent,
    cursorOffset: number,
    sizes: TabSizes,
  ) {
    // update moving tab position
    const {containerRef} = this;
    const movingSize = sizes[activeKey];
    const activeTab = this.tabRefs[activeKey];
    if (containerRef) {
      const containerRect: Rect = containerRef.getBoundingClientRect();

      let newActivePos = // $FlowFixMe
        event[this.screenKey] - containerRect[this.offsetKey] - cursorOffset;
      newActivePos = Math.max(-1, newActivePos);
      newActivePos = Math.min(
        newActivePos,
        containerRect[this.sizeKey] - movingSize[this.sizeKey],
      );

      movingSize[this.offsetKey] = newActivePos;

      if (activeTab) {
        activeTab.style.setProperty(this.offsetKey, `${newActivePos}px`);

        const {dragOpacity} = this.props;
        if (dragOpacity != null && dragOpacity !== 1) {
          activeTab.style.opacity = `${dragOpacity}`;
        }
      }
    }

    // figure out new order
    const zipped: Array<[string, number]> = [];
    for (const key in sizes) {
      const rect = sizes[key];
      let offset = rect[this.offsetKey];
      let size = rect[this.sizeKey];

      if (goingOpposite) {
        // when dragging opposite add the size to the offset
        if (key === activeKey) {
          // calculate the active tab to be a quarter of the actual size so when dragging in the opposite
          // direction, you need to cover 75% of the previous tab to trigger a movement
          size *= 0.25;
        }
        offset += size;
      } else if (key === activeKey) {
        // if not dragging in the opposite direction and we're the active tab, require covering 25% of the
        // next tab in roder to trigger a movement
        offset += size * 0.75;
      }

      zipped.push([key, offset]);
    }

    // calculate ordering
    const order = zipped
      .sort(([, a], [, b]) => {
        return Number(a > b);
      })
      .map(([key]) => key);

    this.moveTabs(order, activeKey, sizes);
    this.setState({movingOrder: order});
  }

  moveTabs(order: OrderableOrder, activeKey: ?string, sizes: TabSizes) {
    let offset = 0;
    for (const key of order) {
      const size = sizes[key];
      const tab = this.tabRefs[key];
      if (tab) {
        let newZIndex = key === activeKey ? 2 : 1;
        const prevZIndex = tab.style.zIndex;
        if (prevZIndex) {
          newZIndex += Number(prevZIndex);
        }
        tab.style.zIndex = String(newZIndex);

        if (key === activeKey) {
          tab.style.transition = 'opacity 100ms ease-in-out';
        } else {
          tab.style.transition = `${this.offsetKey} 300ms ease-in-out`;
          tab.style.setProperty(this.offsetKey, `${offset}px`);
        }
        offset += size[this.sizeKey];
      }
    }
  }

  getMidpoint(rect: Rect) {
    return rect[this.offsetKey] + rect[this.sizeKey] / 2;
  }

  stopMove(activeKey: string, sizes: TabSizes) {
    const {movingOrder} = this.state;

    const {onChange} = this.props;
    if (onChange && movingOrder) {
      const activeTab = this.tabRefs[activeKey];
      if (activeTab) {
        activeTab.style.opacity = '';

        const transitionend = () => {
          activeTab.removeEventListener('transitionend', transitionend);
          this.reset();
        };
        activeTab.addEventListener('transitionend', transitionend);
      }

      this.resetListeners();
      this.moveTabs(movingOrder, null, sizes);
      onChange(movingOrder, activeKey);
    } else {
      this.reset();
    }

    this.setState({movingOrder: null});
  }

  resetListeners() {
    clearTimeout(this.timer);

    const {_mousemove, _mouseup} = this;
    if (_mouseup) {
      document.removeEventListener('mouseup', _mouseup);
    }
    if (_mousemove) {
      document.removeEventListener('mousemove', _mousemove);
    }
  }

  reset() {
    this.resetListeners();

    const {containerRef} = this;
    if (containerRef) {
      containerRef.removeAttribute('style');
    }

    for (const key in this.tabRefs) {
      const elem = this.tabRefs[key];
      if (elem) {
        elem.removeAttribute('style');
      }
    }
  }

  componentWillUnmount() {
    this.reset();
  }

  addRef = (key: string, elem: ?HTMLElement) => {
    this.tabRefs[key] = elem;
  };

  setContainerRef = (ref: HTMLElement) => {
    this.containerRef = ref;
  };

  render() {
    const {items} = this.props;

    // calculate order of elements
    let {order} = this.state;
    if (!order) {
      order = Object.keys(items);
    }
    for (const key in items) {
      if (order.indexOf(key) < 0) {
        if (this.props.reverse === true) {
          order.unshift(key);
        } else {
          order.push(key);
        }
      }
    }

    return (
      <OrderableContainer
        className={this.props.className}
        innerRef={this.setContainerRef}>
        {order.map(key => {
          const item = items[key];
          if (item) {
            return (
              <OrderableItem
                orientation={this.props.orientation}
                key={key}
                id={key}
                addRef={this.addRef}
                startMove={this.startMove}>
                {item}
              </OrderableItem>
            );
          } else {
            return null;
          }
        })}
      </OrderableContainer>
    );
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import FlexColumn from './FlexColumn.js';

import styled from '../styled/index.js';
import FlexBox from './FlexBox.js';

import {colors} from './colors.js';
import Glyph from './Glyph.js';

const BORDER = '1px solid #dddfe2';
const ignoreAttributes = ['floating', 'padded'];

const Chevron = Glyph.extends({
  marginRight: 4,
  marginLeft: -2,
  marginBottom: 1,
});

/**
 * A Panel component.
 */
export default class Panel extends styled.StylableComponent<
  {|
    /**
     * Class name to customise styling.
     */
    className?: string,
    /**
     * Whether this panel is floating from the rest of the UI. ie. if it has
     * margin and a border.
     */
    floating?: boolean,
    /**
     * Whether the panel takes up all the space it can. Equivalent to the following CSS:
     *
     *  height: 100%;
     *  width: 100%;
     */
    fill?: boolean,
    /**
     * Heading for this panel. If this is anything other than a string then no
     * padding is applied to the heading.
     */
    heading: React$Node,
    /**
     * Contents of the panel.
     */
    children?: React$Node,
    /**
     * Whether the panel header and body have padding.
     */
    padded?: boolean,
    /**
     * Whether the panel can be collapsed. Defaults to true
     */
    collapsable: boolean,
    /**
     * Initial state for panel if it is collapsable
     */
    collapsed?: boolean,
    /**
     * Heading for this panel. If this is anything other than a string then no
     * padding is applied to the heading.
     */
    accessory?: React$Node,
  |},
  {
    collapsed: boolean,
  },
> {
  static defaultProps: {|
    floating: boolean,
    fill: boolean,
    collapsable: boolean,
  |} = {
    fill: false,
    floating: true,
    collapsable: true,
  };

  static PanelContainer = FlexColumn.extends(
    {
      flexShrink: 0,
      padding: props => (props.floating ? 10 : 0),
      borderBottom: props => (props.collapsed ? 'none' : BORDER),
    },
    {ignoreAttributes: ['collapsed', ...ignoreAttributes]},
  );

  static PanelHeader = FlexBox.extends(
    {
      backgroundColor: '#f6f7f9',
      border: props => (props.floating ? BORDER : 'none'),
      borderBottom: BORDER,
      borderTopLeftRadius: 2,
      borderTopRightRadius: 2,
      justifyContent: 'space-between',
      lineHeight: '27px',
      fontWeight: 500,
      flexShrink: 0,
      padding: props => (props.padded ? '0 10px' : 0),
      '&:not(:first-child)': {
        borderTop: BORDER,
      },
    },
    {ignoreAttributes},
  );

  static PanelBody = FlexColumn.extends(
    {
      backgroundColor: '#fff',
      border: props => (props.floating ? BORDER : 'none'),
      borderBottomLeftRadius: 2,
      borderBottomRightRadius: 2,
      borderTop: 'none',
      flexGrow: 1,
      padding: props => (props.padded ? 10 : 0),
    },
    {ignoreAttributes},
  );
  state = {
    collapsed: this.props.collapsed == null ? false : this.props.collapsed,
  };

  onClick = () => this.setState({collapsed: !this.state.collapsed});

  render() {
    const {
      padded,
      children,
      className,
      fill,
      floating,
      heading,
      collapsable,
      accessory,
    } = this.props;
    const {collapsed} = this.state;
    return (
      <Panel.PanelContainer
        className={className}
        floating={floating}
        fill={fill}
        collapsed={collapsed}>
        <Panel.PanelHeader
          floating={floating}
          padded={typeof heading === 'string'}
          onClick={this.onClick}>
          <span>
            {collapsable && (
              <Chevron
                color={colors.macOSTitleBarIcon}
                name={collapsed ? 'triangle-right' : 'triangle-down'}
                size={12}
              />
            )}
            {heading}
          </span>
          {accessory}
        </Panel.PanelHeader>

        {children == null || (collapsable && collapsed) ? null : (
          <Panel.PanelBody
            fill={fill}
            padded={padded == null ? true : padded}
            floating={floating}>
            {children}
          </Panel.PanelBody>
        )}
      </Panel.PanelContainer>
    );
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import ButtonGroup from './ButtonGroup.js';
import {Component} from 'react';
import Button from './Button.js';

const path = require('path');

class PathBreadcrumbsItem extends Component<{
  name: string,
  path: string,
  isFolder: boolean,
  onClick: (path: string) => void,
}> {
  onClick = () => {
    this.props.onClick(this.props.path);
  };

  render() {
    return <Button onClick={this.onClick}>{this.props.name}</Button>;
  }
}

export default function PathBreadcrumbs(props: {|
  path: string,
  isFile?: boolean,
  onClick: (path: string) => void,
|}) {
  const parts = props.path === path.sep ? [''] : props.path.split(path.sep);
  const {onClick} = props;

  return (
    <ButtonGroup>
      {parts.map((part, i) => {
        const fullPath = parts.slice(0, i + 1).join(path.sep) || path.sep;
        return (
          <PathBreadcrumbsItem
            key={`${i}:${part}`}
            name={part || fullPath}
            path={fullPath}
            isFolder={!(props.isFile === true && i === parts.length - 1)}
            onClick={onClick}
          />
        );
      })}
    </ButtonGroup>
  );
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import {PureComponent} from 'react';
import FlexColumn from './FlexColumn.js';
import styled from '../styled/index.js';
import {colors} from './colors.js';

const Anchor = styled.image({
  zIndex: 6,
  position: 'absolute',
  bottom: 0,
  left: '50%',
  transform: 'translate(-50%, calc(100% + 2px))',
});

const PopoverContainer = FlexColumn.extends({
  backgroundColor: colors.white,
  borderRadius: 7,
  border: '1px solid rgba(0,0,0,0.3)',
  boxShadow: '0 2px 10px 0 rgba(0,0,0,0.3)',
  position: 'absolute',
  zIndex: 5,
  bottom: 0,
  marginTop: 15,
  left: '50%',
  transform: 'translate(-50%, calc(100% + 15px))',
  overflow: 'hidden',
  '&::before': {
    content: '""',
    display: 'block',
    position: 'absolute',
    left: '50%',
    transform: 'translateX(-50%)',
    height: 13,
    top: -13,
    width: 26,
    backgroundColor: colors.white,
  },
});

type Props = {|
  children: React.Node,
  onDismiss: Function,
|};

export default class Popover extends PureComponent<Props> {
  _ref: ?Element;

  componentDidMount() {
    window.document.addEventListener('click', this.handleClick);
    window.document.addEventListener('keydown', this.handleKeydown);
  }

  componentWillUnmount() {
    window.document.addEventListener('click', this.handleClick);
    window.document.addEventListener('keydown', this.handleKeydown);
  }

  handleClick = (e: SyntheticMouseEvent<>) => {
    // $FlowFixMe
    if (this._ref && !this._ref.contains(e.target)) {
      this.props.onDismiss();
    }
  };

  handleKeydown = (e: SyntheticKeyboardEvent<>) => {
    if (e.key === 'Escape') {
      this.props.onDismiss();
    }
  };

  _setRef = (ref: ?Element) => {
    this._ref = ref;
  };

  render() {
    return [
      <Anchor src="./anchor.svg" key="anchor" />,
      <PopoverContainer innerRef={this._setRef} key="popup">
        {this.props.children}
      </PopoverContainer>,
    ];
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import styled from '../styled/index.js';
import {Component} from 'react';

const IFrame = styled.customHTMLTag('iframe', {
  height: '100%',
  width: '100%',
  border: 'none',
  background: 'transparent',
  position: 'absolute',
  zIndex: -1,
  top: 0,
  left: 0,
});

export default class ResizeSensor extends Component<{
  onResize: (e: UIEvent) => void,
}> {
  iframe: ?HTMLIFrameElement;

  setRef = (ref: ?HTMLIFrameElement) => {
    this.iframe = ref;
  };

  render() {
    return <IFrame innerRef={this.setRef} />;
  }

  componentDidMount() {
    const {iframe} = this;
    if (iframe != null) {
      iframe.contentWindow.addEventListener('resize', this.handleResize);
    }
  }

  componentWillUnmount() {
    const {iframe} = this;
    if (iframe != null) {
      iframe.contentWindow.removeEventListener('resize', this.handleResize);
    }
  }

  handleResize = () => {
    window.requestAnimationFrame(this.props.onResize);
  };
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import {Component} from 'react';

export default class Select extends Component<{
  className?: string,
  options: {
    [key: string]: string,
  },
  onChange: (key: string) => void,
  selected?: ?string,
}> {
  render() {
    const {className, options, selected} = this.props;

    return (
      <select onChange={this.props.onChange} className={className}>
        {Object.keys(options).map(key => (
          <option selected={key === selected}>{options[key]}</option>
        ))}
      </select>
    );
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type {StyledComponent} from '../styled/index.js';
import Interactive from './Interactive.js';
import FlexColumn from './FlexColumn.js';
import {Component} from 'react';

const SidebarInteractiveContainer = Interactive.extends({
  flex: 'none',
});

type SidebarPosition = 'left' | 'top' | 'right' | 'bottom';

const SidebarContainer: StyledComponent<{
  position: SidebarPosition,
  overflow?: boolean,
}> = FlexColumn.extends(
  {
    backgroundColor: props => props.backgroundColor || '#f7f7f7',
    borderLeft: props =>
      props.position === 'right' ? '1px solid #b3b3b3' : 'none',
    borderTop: props =>
      props.position === 'bottom' ? '1px solid #b3b3b3' : 'none',
    borderRight: props =>
      props.position === 'left' ? '1px solid #b3b3b3' : 'none',
    borderBottom: props =>
      props.position === 'top' ? '1px solid #b3b3b3' : 'none',
    height: '100%',
    overflowX: 'hidden',
    overflowY: 'auto',
    textOverflow: props => (props.overflow ? 'ellipsis' : 'auto'),
    whiteSpace: props => (props.overflow ? 'nowrap' : 'normal'),
  },
  {
    ignoreAttributes: ['backgroundColor', 'position'],
  },
);

type SidebarProps = {
  /**
   * Position of the sidebar.
   */
  position: SidebarPosition,

  /**
   * Default width of the sidebar.  Only used for left/right sidebars.
   */
  width?: number,
  /**
   * Minimum sidebar width. Only used for left/right sidebars.
   */
  minWidth?: number,
  /**
   * Maximum sidebar width. Only used for left/right sidebars.
   */
  maxWidth?: number,

  /**
   * Default height of the sidebar.
   */
  height?: number,
  /**
   * Minimum sidebar height. Only used for top/bottom sidebars.
   */
  minHeight?: number,
  /**
   * Maximum sidebar height. Only used for top/bottom sidebars.
   */
  maxHeight?: number,

  /**
   * Background color.
   */
  backgroundColor?: string,
  /**
   * Callback when the sidebar size ahs changed.
   */
  onResize?: (width: number, height: number) => void,
  /**
   * Contents of the sidebar.
   */
  children?: React$Node,
  /**
   * Class name to customise styling.
   */
  className?: string,
};

type SidebarState = {|
  width?: number,
  height?: number,
  userChange: boolean,
|};

/**
 * A resizable sidebar.
 */
export default class Sidebar extends Component<SidebarProps, SidebarState> {
  constructor(props: SidebarProps, context: Object) {
    super(props, context);
    this.state = {userChange: false, width: props.width, height: props.height};
  }

  static defaultProps = {
    position: 'left',
  };

  componentWillReceiveProps(nextProps: SidebarProps) {
    if (!this.state.userChange) {
      this.setState({width: nextProps.width, height: nextProps.height});
    }
  }

  onResize = (width: number, height: number) => {
    const {onResize} = this.props;
    if (onResize) {
      onResize(width, height);
    } else {
      this.setState({userChange: true, width, height});
    }
  };

  render() {
    const {backgroundColor, onResize, position, children} = this.props;
    let height, minHeight, maxHeight, width, minWidth, maxWidth;

    const resizable: {[key: string]: boolean} = {};
    if (position === 'left') {
      resizable.right = true;
      ({width, minWidth, maxWidth} = this.props);
    } else if (position === 'top') {
      resizable.bottom = true;
      ({height, minHeight, maxHeight} = this.props);
    } else if (position === 'right') {
      resizable.left = true;
      ({width, minWidth, maxWidth} = this.props);
    } else if (position === 'bottom') {
      resizable.top = true;
      ({height, minHeight, maxHeight} = this.props);
    }

    const horizontal = position === 'left' || position === 'right';

    if (horizontal) {
      width = width == null ? 200 : width;
      minWidth = minWidth == null ? 100 : minWidth;
      maxWidth = maxWidth == null ? 600 : maxWidth;
    } else {
      height = height == null ? 200 : height;
      minHeight = minHeight == null ? 100 : minHeight;
      maxHeight = maxHeight == null ? 600 : maxHeight;
    }

    return (
      <SidebarInteractiveContainer
        className={this.props.className}
        minWidth={minWidth}
        maxWidth={maxWidth}
        width={horizontal ? (onResize ? width : this.state.width) : undefined}
        minHeight={minHeight}
        maxHeight={maxHeight}
        height={
          !horizontal ? (onResize ? height : this.state.height) : undefined
        }
        resizable={resizable}
        onResize={this.onResize}>
        <SidebarContainer position={position} backgroundColor={backgroundColor}>
          {children}
        </SidebarContainer>
      </SidebarInteractiveContainer>
    );
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import {colors} from './colors.js';
import Label from './Label.js';

export default Label.extends({
  color: colors.blackAlpha30,
  fontSize: 12,
  padding: 10,
});
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */
export default function Tab(props: {|
  /**
   * Label of this tab to show in the tab list.
   */
  label: React$Node,
  /**
   * Whether this tab is closable.
   */
  closable?: boolean,
  /**
   * Whether this tab is hidden. Useful for when you want a tab to be
   * inaccessible via the user but you want to manually set the `active` props
   * yourself.
   */
  hidden?: boolean,
  /**
   * Whether this tab should always be included in the DOM and have it's
   * visibility toggled.
   */
  persist?: boolean,
  /**
   * Callback for when tab is closed.
   */
  onClose?: () => void,
  /**
   * Contents of this tab.
   */
  children?: React$Node,
|}) {
  throw new Error("don't render me");
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import FlexColumn from './FlexColumn.js';
import styled from '../styled/index.js';
import Orderable from './Orderable.js';
import FlexRow from './FlexRow.js';
import {colors} from './colors.js';
import Tab from './Tab.js';

const TabList = FlexRow.extends({
  alignItems: 'stretch',
});

const TabListItem = styled.view(
  {
    backgroundColor: props => (props.active ? colors.light15 : colors.light02),
    borderBottom: '1px solid #dddfe2',
    boxShadow: props =>
      props.active ? 'inset 0px 0px 3px rgba(0,0,0,0.25)' : 'none',
    color: colors.dark80,
    flex: 1,
    fontSize: 13,
    lineHeight: '28px',
    overflow: 'hidden',
    padding: '0 10px',
    position: 'relative',
    textAlign: 'center',
    textOverflow: 'ellipsis',
    whiteSpace: 'nowrap',

    '&:hover': {
      backgroundColor: props =>
        props.active ? colors.light15 : colors.light05,
    },
  },
  {
    ignoreAttributes: ['active'],
  },
);

const TabListAddItem = TabListItem.extends({
  borderRight: 'none',
  flex: 0,
  flexGrow: 0,
  fontWeight: 'bold',
});

const CloseButton = styled.view({
  color: '#000',
  float: 'right',
  fontSize: 10,
  fontWeight: 'bold',
  textAlign: 'center',
  marginLeft: 6,
  marginTop: 6,
  width: 16,
  height: 16,
  lineHeight: '16px',
  borderRadius: '50%',

  '&:hover': {
    backgroundColor: colors.cherry,
    color: '#fff',
  },
});

const OrderableContainer = styled.view({
  display: 'inline-block',
});

const TabContent = styled.view({
  height: '100%',
  overflow: 'auto',
  width: '100%',
});

/**
 * A Tabs component.
 */
export default function Tabs(props: {|
  /**
   * Callback for when the active tab has changed.
   */
  onActive?: (key: ?string) => void,
  /**
   * The key of the default active tab.
   */
  defaultActive?: string,
  /**
   * The key of the currently active tab.
   */
  active?: ?string,
  /**
   * Tab elements.
   */
  children?: Array<React$Element<any>>,
  /**
   * Whether the tabs can be reordered by the user.
   */
  orderable?: boolean,
  /**
   * Callback when the tab order changes.
   */
  onOrder?: (order: Array<string>) => void,
  /**
   * Order of tabs.
   */
  order?: Array<string>,
  /**
   * Whether to include the contents of every tab in the DOM and just toggle
   * it's visibility.
   */
  persist?: boolean,
  /**
   * Whether to include a button to create additional items.
   */
  newable?: boolean,
  /**
   * Callback for when the new button is clicked.
   */
  onNew?: () => void,
  /**
   * Elements to insert before all tabs in the tab list.
   */
  before?: Array<React$Node>,
  /**
   * Elements to insert after all tabs in the tab list.
   */
  after?: Array<React$Node>,
|}) {
  const {onActive} = props;
  const active: ?string =
    props.active == null ? props.defaultActive : props.active;

  // array of other components that aren't tabs
  const before = props.before || [];
  const after = props.after || [];

  //
  const tabs = {};

  // a list of keys
  const keys = props.order ? props.order.slice() : [];

  const tabContents = [];
  const tabSiblings = [];

  function add(comps) {
    for (const comp of [].concat(comps || [])) {
      if (Array.isArray(comp)) {
        add(comp);
        continue;
      }

      if (!comp) {
        continue;
      }

      if (comp.type !== Tab) {
        // if element isn't a tab then just push it into the tab list
        tabSiblings.push(comp);
        continue;
      }

      const {children, closable, label, onClose, width} = comp.props;

      const key = comp.key == null ? label : comp.key;
      if (typeof key !== 'string') {
        throw new Error('tab needs a string key or a label');
      }
      if (!keys.includes(key)) {
        keys.push(key);
      }

      const isActive: boolean = active === key;
      if (isActive || props.persist === true || comp.props.persist === true) {
        tabContents.push(
          <TabContent key={key} hidden={!isActive}>
            {children}
          </TabContent>,
        );
      }

      // this tab has been hidden from the tab bar but can still be selected if it's key is active
      if (comp.props.hidden) {
        continue;
      }

      let closeButton;

      tabs[key] = (
        <TabListItem
          key={key}
          width={width}
          active={isActive}
          onMouseDown={
            !isActive &&
            onActive &&
            ((event: SyntheticMouseEvent<>) => {
              if (event.target !== closeButton) {
                onActive(key);
              }
            })
          }>
          {comp.props.label}
          {closable && (
            <CloseButton // eslint-disable-next-line react/jsx-no-bind
              innerRef={ref => (closeButton = ref)} // eslint-disable-next-line react/jsx-no-bind
              onMouseDown={() => {
                if (isActive && onActive) {
                  const index = keys.indexOf(key);
                  const newActive = keys[index + 1] || keys[index - 1] || null;
                  onActive(newActive);
                }

                onClose();
              }}>
              X
            </CloseButton>
          )}
        </TabListItem>
      );
    }
  }

  add(props.children);

  let tabList;
  if (props.orderable === true) {
    tabList = (
      <OrderableContainer key="orderable-list">
        <Orderable
          orientation="horizontal"
          items={tabs}
          onChange={props.onOrder}
          order={keys}
        />
      </OrderableContainer>
    );
  } else {
    tabList = [];
    for (const key in tabs) {
      tabList.push(tabs[key]);
    }
  }

  if (props.newable === true) {
    after.push(
      <TabListAddItem key={keys.length} onMouseDown={props.onNew}>
        +
      </TabListAddItem>,
    );
  }

  return (
    <FlexColumn fill={true}>
      <TabList>
        {before}
        {tabList}
        {after}
      </TabList>
      {tabContents}
      {tabSiblings}
    </FlexColumn>
  );
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type {StyledComponent} from '../styled/index.js';
import styled from '../styled/index.js';

/**
 * A Text component.
 */
const Text: StyledComponent<{
  /**
   * Color of text.
   */
  color?: string,
  /**
   * Whether this text is bold. Equivalent to the following CSS:
   *
   *  font-weight: bold;
   */
  bold?: boolean,
  /**
   * Whether this text is italic. Equivalent to the following CSS:
   *
   *  font-style: italic;
   */
  italic?: boolean,
  /**
   * Whether to format the text as code. Equivalent to the following CSS:
   *
   *  font-size: Andale Mono, monospace;
   *  overflow: auto;
   *  user-select: text;
   *  white-space: pre-wrap;
   *  word-wrap: break-word;
   */
  code?: boolean,
  /**
   * Whether this text is underlined. Equivalent to the following CSS:
   *
   *  text-decoration: underline;
   */
  underline?: boolean,
  /**
   * Whether this text is striked. Equivalent to the following CSS:
   *
   *  text-decoration: line-through;
   */
  strike?: boolean,
  /**
   * Whether this text is selectable by the cursor. Equivalent to the following CSS:
   *
   *  user-select: text;
   */
  selectable?: boolean,
  /**
   * Alignment of the text. Equivalent to the `text-align` CSS rule.
   */
  align?: 'left' | 'center' | 'right',
  /**
   * Font size to use. Equivalent to the `font-size` CSS rule.
   */
  size?: string | number,
  /**
   * Font family to use. Equivalent to the `font-family` CSS rule.
   */
  family?: string,
  /**
   * Word wrap to use. Equivalent to the `word-wrap` CSS rule.
   */
  wordWrap?: string,
  /**
   * White space to use. Equivalent to the `white-space` CSS rule.
   */
  whiteSpace?: string,
}> = styled.text(
  {
    color: props => (props.color ? props.color : 'inherit'),
    display: 'inline',
    fontWeight: props => (props.bold ? 'bold' : 'inherit'),
    fontStyle: props => (props.italic ? 'italic' : 'normal'),
    textAlign: props => props.align || 'left',
    fontSize: props => {
      if (props.size == null && props.code) {
        return 12;
      } else {
        return props.size;
      }
    },
    fontFamily: props => {
      if (props.code) {
        return 'SF Mono, Monaco, Andale Mono, monospace';
      } else {
        return props.family;
      }
    },
    overflow: props => {
      if (props.code) {
        return 'auto';
      } else {
        return 'visible';
      }
    },
    textDecoration: props => {
      if (props.underline) {
        return 'underline';
      } else if (props.strike) {
        return 'line-through';
      } else {
        return 'none';
      }
    },
    userSelect: props => {
      if (
        props.selectable ||
        (props.code && typeof props.selectable === 'undefined')
      ) {
        return 'text';
      } else {
        return 'none';
      }
    },
    wordWrap: props => {
      if (props.code) {
        return 'break-word';
      } else {
        return props.wordWrap;
      }
    },
    whiteSpace: props => {
      if (props.code && typeof props.whiteSpace === 'undefined') {
        return 'pre';
      } else {
        return props.whiteSpace;
      }
    },
  },
  {
    ignoreAttributes: [
      'selectable',
      'whiteSpace',
      'wordWrap',
      'align',
      'code',
      'family',
      'size',
      'bold',
      'italic',
      'strike',
      'underline',
      'color',
    ],
  },
);

export default Text;
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import styled from '../styled/index.js';
import {inputStyle} from './Input.js';

export default styled.customHTMLTag(
  'textarea',
  {
    ...inputStyle,
    lineHeight: 'normal',
    padding: props => (props.compact ? '5px' : '8px'),
    resize: 'none',
  },
  {
    ignoreAttributes: ['compact'],
  },
);
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import styled from '../styled/index.js';

/**
 * A TextParagraph component.
 */
const TextParagraph = styled.view({
  marginBottom: 10,

  '&:last-child': {
    marginBottom: 0,
  },
});

export default TextParagraph;
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import React from 'react';
import styled from '../styled/index.js';
import {colors} from './colors.js';

export const StyledButton = styled.view({
  cursor: 'pointer',
  width: '30px',
  height: '16px',
  background: props => (props.toggled ? colors.green : colors.grey),
  display: 'block',
  borderRadius: '100px',
  position: 'relative',
  marginLeft: '15px',
  '&::after': {
    content: `''`,
    position: 'absolute',
    top: '3px',
    left: props => (props.toggled ? '18px' : '3px'),
    width: '10px',
    height: '10px',
    background: 'white',
    borderRadius: '100px',
    transition: 'all cubic-bezier(0.3, 1.5, 0.7, 1) 0.3s',
  },
});

type Props = {
  /**
   * onClick handler.
   */
  onClick?: (event: SyntheticMouseEvent<>) => void,
  /**
   * whether the button is toggled
   */
  toggled?: boolean,
};

/**
 * Toggle Button.
 *
 * **Usage**
 *
 * ```jsx
 * import {ToggleButton} from 'sonar';
 * <ToggleButton onClick={handler} toggled={boolean}/>
 * ```
 */
export default class ToggleButton extends styled.StylableComponent<Props> {
  render() {
    return (
      <StyledButton toggled={this.props.toggled} onClick={this.props.onClick} />
    );
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type {StyledComponent} from '../styled/index.js';
import {colors} from './colors.js';
import FlexRow from './FlexRow.js';
import FlexBox from './FlexBox.js';

/**
 * A toolbar.
 */
const Toolbar: StyledComponent<{
  /**
   * Position of the toolbar. Dictates the location of the border.
   */
  position?: 'top' | 'bottom',
  compact?: boolean,
}> = FlexRow.extends(
  {
    backgroundColor: colors.light02,
    borderBottom: props =>
      props.position === 'bottom'
        ? 'none'
        : `1px solid ${colors.sectionHeaderBorder}`,
    borderTop: props =>
      props.position === 'bottom'
        ? `1px solid ${colors.sectionHeaderBorder}`
        : 'none',
    flexShrink: 0,
    height: props => (props.compact ? 28 : 42),
    lineHeight: '32px',
    alignItems: 'center',
    padding: 6,
    width: '100%',
  },
  {
    ignoreAttributes: ['position'],
  },
);

export const Spacer = FlexBox.extends({
  flexGrow: 1,
});

export default Toolbar;
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type TooltipProvider from './TooltipProvider.js';

import styled from '../styled/index.js';
import {Component} from 'react';

const PropTypes = require('prop-types');

const TooltipContainer = styled.view({
  display: 'contents',
});

type TooltipProps = {
  title: React$Node,
  children: React$Node,
};

type TooltipState = {
  open: boolean,
};

export default class Tooltip extends Component<TooltipProps, TooltipState> {
  static contextTypes = {
    TOOLTIP_PROVIDER: PropTypes.object,
  };

  context: {
    TOOLTIP_PROVIDER: TooltipProvider,
  };

  ref: ?HTMLDivElement;

  state = {
    open: false,
  };

  componentWillUnmount() {
    if (this.state.open === true) {
      this.context.TOOLTIP_PROVIDER.close();
    }
  }

  onMouseEnter = () => {
    if (this.ref != null) {
      this.context.TOOLTIP_PROVIDER.open(this.ref, this.props.title);
      this.setState({open: true});
    }
  };

  onMouseLeave = () => {
    this.context.TOOLTIP_PROVIDER.close();
    this.setState({open: false});
  };

  setRef = (ref: ?HTMLDivElement) => {
    this.ref = ref;
  };

  render() {
    return (
      <TooltipContainer
        innerRef={this.setRef}
        onMouseEnter={this.onMouseEnter}
        onMouseLeave={this.onMouseLeave}>
        {this.props.children}
      </TooltipContainer>
    );
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import styled from '../styled/index.js';
import {Component} from 'react';

const PropTypes = require('prop-types');

const TooltipBubble = styled.view(
  {
    backgroundColor: '#000',
    lineHeight: '25px',
    padding: '0 6px',
    borderRadius: 4,
    position: 'absolute',
    width: 'auto',
    top: props => props.top,
    left: props => props.left,
    zIndex: 99999999999,
    pointerEvents: 'none',
    color: '#fff',
    marginTop: '-30px',
  },
  {
    ignoreAttributes: ['top', 'left'],
  },
);

type TooltipProps = {
  children: React$Node,
};

type TooltipState = {
  tooltip: ?{
    rect: ClientRect,
    title: React$Node,
  },
};

export default class TooltipProvider extends Component<
  TooltipProps,
  TooltipState,
> {
  static childContextTypes = {
    TOOLTIP_PROVIDER: PropTypes.object,
  };

  state = {
    tooltip: null,
  };

  getChildContext() {
    return {TOOLTIP_PROVIDER: this};
  }

  open(container: HTMLDivElement, title: React$Node) {
    const node = container.childNodes[0];
    if (node == null || !(node instanceof HTMLElement)) {
      return;
    }

    this.setState({
      tooltip: {
        rect: node.getBoundingClientRect(),
        title,
      },
    });
  }

  close() {
    this.setState({tooltip: null});
  }

  render() {
    const {tooltip} = this.state;

    let tooltipElem = null;
    if (tooltip != null) {
      tooltipElem = (
        <TooltipBubble top={tooltip.rect.top} left={tooltip.rect.left}>
          {tooltip.title}
        </TooltipBubble>
      );
    }

    return [tooltipElem, this.props.children];
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import styled from '../styled/index.js';

const View = styled.view(
  {
    height: props => (props.fill ? '100%' : 'auto'),
    overflow: props => (props.scrollable ? 'auto' : 'visible'),
    position: 'relative',
    width: props => (props.fill ? '100%' : 'auto'),
  },
  {
    ignoreAttributes: ['fill', 'scrollable'],
  },
);

export default View;
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import {Component} from 'react';

type ViewWithSizeProps = {
  onSize: (width: number, height: number) => any,
};

type ViewWithSizeState = {|
  width: number,
  height: number,
|};

export default class ViewWithSize extends Component<
  ViewWithSizeProps,
  ViewWithSizeState,
> {
  constructor(props: ViewWithSizeProps, context: Object) {
    super(props, context);
    this.state = {height: window.innerHeight, width: window.innerWidth};
  }

  _onResize: Function;

  componentDidMount() {
    this._onResize = () => {
      this.setState({height: window.innerHeight, width: window.innerWidth});
    };
    window.addEventListener('resize', this._onResize);
  }

  componentWillUnmount() {
    window.removeEventListener('resize', this._onResize);
  }

  render() {
    return this.props.onSize(this.state.width, this.state.height);
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import FlexColumn from './FlexColumn.js';
import {Component} from 'react';
import View from './View.js';

const Inner = FlexColumn.extends(
  {
    alignItems: 'flex-start',
    height: props => props.height,
    minHeight: '100%',
    minWidth: '100%',
    overflow: 'visible',
    width: '100%',
  },
  {
    ignoreAttributes: ['height'],
  },
);

const Content = FlexColumn.extends(
  {
    alignItems: 'flex-start',
    height: '100%',
    marginTop: props => props.top,
    minWidth: '100%',
    overflow: 'visible',
  },
  {
    ignoreAttributes: ['top'],
  },
);

type VirtualListProps = {|
  data: Array<any>,
  renderRow: (data: any, i: number) => any,
  rowHeight: number,
  overscanCount: number,
  sync?: number,
  wrapInner?: (data: any) => any,
|};

type VirtualListState = {|
  offset: number,
  height: number,
|};

export default class VirtualList extends Component<
  VirtualListProps,
  VirtualListState,
> {
  constructor(props: VirtualListProps, context: Object) {
    super(props, context);
    this.state = {
      height: 0,
      offset: 0,
    };
  }

  static defaultProps = {
    overscanCount: 10,
  };

  ref: HTMLElement;

  setRef = (ref: HTMLElement) => {
    this.ref = ref;
  };

  resize = () => {
    if (this.ref && this.state.height !== this.ref.offsetHeight) {
      this.setState({height: this.ref.offsetHeight});
    }
  };

  handleScroll = () => {
    this.setState({offset: this.ref.scrollTop});
    if (this.props.sync === true) {
      this.forceUpdate();
    }
  };

  componentDidUpdate() {
    this.resize();
  }

  componentDidMount() {
    this.resize();
    window.addEventListener('resize', this.resize);
  }

  componentWillUnmount() {
    window.removeEventListener('resize', this.resize);
  }

  render() {
    const {data, overscanCount, renderRow, rowHeight, wrapInner} = this.props;
    const {height, offset} = this.state;

    // first visible row index
    // eslint-disable-next-line no-bitwise
    let start = (offset / rowHeight) | 0;

    // actual number of visible rows (without overscan)
    // eslint-disable-next-line no-bitwise
    let visibleRowCount = (height / rowHeight) | 0;

    // Overscan: render blocks of rows modulo an overscan row count
    // This dramatically reduces DOM writes during scrolling
    if (overscanCount) {
      start = Math.max(0, start - (start % overscanCount));
      visibleRowCount += overscanCount;
    }

    // last visible + overscan row index
    const end = start + 1 + visibleRowCount;

    // data slice currently in viewport plus overscan items
    const selection = data.slice(start, end);

    let inner = (
      <Inner height={data.length * rowHeight}>
        <Content top={start * rowHeight}>{selection.map(renderRow)}</Content>
      </Inner>
    );

    if (wrapInner) {
      inner = wrapInner(inner);
    }

    return (
      <View
        fill={true}
        onScroll={this.handleScroll}
        innerRef={this.setRef}
        scrollable={true}>
        {inner}
      </View>
    );
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type {DataInspectorSetValue} from './DataInspector.js';
import {PureComponent} from 'react';
import styled from '../../styled/index.js';
import {SketchPicker} from 'react-color';
import {Component} from 'react';
import Popover from '../Popover.js';
import {colors} from '../colors.js';
import Input from '../Input.js';

const NullValue = styled.text({
  color: 'rgb(128, 128, 128)',
});

const UndefinedValue = styled.text({
  color: 'rgb(128, 128, 128)',
});

const StringValue = styled.text({
  color: colors.cherryDark1,
});

const ColorValue = styled.text({
  color: colors.blueGrey,
});

const SymbolValue = styled.text({
  color: 'rgb(196, 26, 22)',
});

const NumberValue = styled.text({
  color: colors.tealDark1,
});

const ColorBox = styled.text(
  {
    backgroundColor: props => props.color,
    boxShadow: 'inset 0 0 1px rgba(0, 0, 0, 1)',
    display: 'inline-block',
    height: 12,
    marginRight: 5,
    verticalAlign: 'middle',
    width: 12,
  },
  {
    ignoreAttributes: ['color'],
  },
);

const FunctionKeyword = styled.text({
  color: 'rgb(170, 13, 145)',
  fontStyle: 'italic',
});

const FunctionName = styled.text({
  fontStyle: 'italic',
});

const ColorPickerDescription = styled.view({
  display: 'inline',
  position: 'relative',
});

type DataDescriptionProps = {|
  path?: Array<string>,
  type: string,
  value: any,
  setValue: ?DataInspectorSetValue,
|};

type DescriptionCommitOptions = {|
  value: any,
  keep: boolean,
  clear: boolean,
|};

class NumberTextEditor extends PureComponent<{
  commit: (opts: DescriptionCommitOptions) => void,
  type: string,
  value: any,
  origValue: any,
}> {
  onNumberTextInputChange = (e: SyntheticInputEvent<HTMLInputElement>) => {
    const val =
      this.props.type === 'number'
        ? parseFloat(e.target.value)
        : e.target.value;
    this.props.commit({
      clear: false,
      keep: true,
      value: val,
    });
  };

  onNumberTextInputKeyDown = (e: SyntheticKeyboardEvent<*>) => {
    if (e.key === 'Enter') {
      const val =
        this.props.type === 'number'
          ? parseFloat(this.props.value)
          : this.props.value;
      this.props.commit({clear: true, keep: true, value: val});
    } else if (e.key === 'Escape') {
      this.props.commit({
        clear: true,
        keep: false,
        value: this.props.origValue,
      });
    }
  };

  onNumberTextRef = (ref: ?HTMLElement) => {
    if (ref) {
      ref.focus();
    }
  };

  onNumberTextBlur = () => {
    this.props.commit({clear: true, keep: true, value: this.props.value});
  };

  render() {
    const extraProps: Object = {};
    if (this.props.type === 'number') {
      // render as a HTML number input
      extraProps.type = 'number';

      // step="any" allows any sort of float to be input, otherwise we're limited
      // to decimal
      extraProps.step = 'any';
    }

    return (
      <Input
        key="input"
        {...extraProps}
        compact={true}
        onChange={this.onNumberTextInputChange}
        onKeyDown={this.onNumberTextInputKeyDown}
        innerRef={this.onNumberTextRef}
        onBlur={this.onNumberTextBlur}
        value={this.props.value}
      />
    );
  }
}

type DataDescriptionState = {|
  editing: boolean,
  origValue: any,
  value: any,
|};

export default class DataDescription extends PureComponent<
  DataDescriptionProps,
  DataDescriptionState,
> {
  constructor(props: DataDescriptionProps, context: Object) {
    super(props, context);

    this.state = {
      editing: false,
      origValue: '',
      value: '',
    };
  }

  commit = (opts: DescriptionCommitOptions) => {
    const {path, setValue} = this.props;
    if (opts.keep && setValue && path) {
      const val = opts.value;
      this.setState({value: val});
      setValue(path, val);
    }

    if (opts.clear) {
      this.setState({
        editing: false,
        origValue: '',
        value: '',
      });
    }
  };

  _renderEditing() {
    const {type} = this.props;
    const {origValue, value} = this.state;

    if (
      type === 'string' ||
      type === 'text' ||
      type === 'number' ||
      type === 'enum'
    ) {
      return (
        <NumberTextEditor
          type={type}
          value={value}
          origValue={origValue}
          commit={this.commit}
        />
      );
    }

    if (type === 'color') {
      return <ColorEditor value={value} commit={this.commit} />;
    }

    return null;
  }

  _hasEditUI() {
    const {type} = this.props;
    return (
      type === 'string' ||
      type === 'text' ||
      type === 'number' ||
      type === 'enum' ||
      type === 'color'
    );
  }

  onEditStart = () => {
    this.setState({
      editing: this._hasEditUI(),
      origValue: this.props.value,
      value: this.props.value,
    });
  };

  render(): any {
    if (this.state.editing) {
      return this._renderEditing();
    } else {
      return (
        <DataDescriptionPreview
          type={this.props.type}
          value={this.props.value}
          editable={Boolean(this.props.setValue)}
          commit={this.commit}
          onEdit={this.onEditStart}
        />
      );
    }
  }
}

class ColorEditor extends Component<{
  value: any,
  commit: (opts: DescriptionCommitOptions) => void,
}> {
  onBlur = () => {
    this.props.commit({clear: true, keep: false, value: this.props.value});
  };

  onChange = ({
    hex,
    rgb: {a, b, g, r},
  }: {
    hex: string,
    rgb: {a: number, b: number, g: number, r: number},
  }) => {
    const prev = this.props.value;

    let val;
    if (typeof prev === 'string') {
      if (a === 1) {
        // hex is fine and has an implicit 100% alpha
        val = hex;
      } else {
        // turn into a css rgba value
        val = `rgba(${r}, ${g}, ${b}, ${a})`;
      }
    } else if (typeof prev === 'number') {
      // compute RRGGBBAA value
      val = (Math.round(a * 255) & 0xff) << 24;
      val |= (r & 0xff) << 16;
      val |= (g & 0xff) << 8;
      val |= b & 0xff;

      const prevClear = ((prev >> 24) & 0xff) === 0;
      const onlyAlphaChanged = (prev & 0x00ffffff) === (val & 0x00ffffff);

      if (!onlyAlphaChanged && prevClear) {
        val = 0xff000000 | (val & 0x00ffffff);
      }
    } else {
      return;
    }

    this.props.commit({clear: false, keep: true, value: val});
  };

  render() {
    const colorInfo = parseColor(this.props.value);
    if (!colorInfo) {
      return;
    }

    return (
      <ColorPickerDescription>
        <DataDescriptionPreview
          type="color"
          value={this.props.value}
          editable={false}
          commit={this.props.commit}
        />
        <Popover onDismiss={this.onBlur}>
          <SketchPicker
            color={colorInfo}
            presetColors={[
              colors.blue,
              colors.green,
              colors.red,
              colors.blueGrey,
              colors.slate,
              colors.aluminum,
              colors.seaFoam,
              colors.teal,
              colors.lime,
              colors.lemon,
              colors.orange,
              colors.tomato,
              colors.cherry,
              colors.pink,
              colors.grape,
            ]}
            onChange={this.onChange}
          />
        </Popover>
      </ColorPickerDescription>
    );
  }
}

class DataDescriptionPreview extends Component<{
  type: string,
  value: any,
  editable: boolean,
  commit: (opts: DescriptionCommitOptions) => void,
  onEdit?: () => void,
}> {
  onClick = () => {
    const {onEdit} = this.props;
    if (this.props.editable && onEdit) {
      onEdit();
    }
  };

  render() {
    const {type, value} = this.props;

    const description = (
      <DataDescriptionContainer
        type={type}
        value={value}
        editable={this.props.editable}
        commit={this.props.commit}
      />
    );

    // booleans are always editable so don't require the onEditStart handler
    if (type === 'boolean') {
      return description;
    }

    return (
      <span onClick={this.onClick} role="button" tabIndex={-1}>
        {description}
      </span>
    );
  }
}

function parseColor(
  val: string | number,
): ?{|
  r: number,
  g: number,
  b: number,
  a: number,
|} {
  if (typeof val === 'number') {
    const a = ((val >> 24) & 0xff) / 255;
    const r = (val >> 16) & 0xff;
    const g = (val >> 8) & 0xff;
    const b = val & 0xff;
    return {a, b, g, r};
  }
  if (typeof val !== 'string') {
    return;
  }
  if (val[0] !== '#') {
    return;
  }

  // remove leading hash
  val = val.slice(1);

  // only allow RGB and ARGB hex values
  if (val.length !== 3 && val.length !== 6 && val.length !== 8) {
    return;
  }

  // split every 2 characters
  const parts = val.match(/.{1,2}/g);
  if (!parts) {
    return;
  }

  // get the alpha value
  let a = 1;

  // extract alpha if passed AARRGGBB
  if (val.length === 8) {
    a = parseInt(parts.shift(), 16) / 255;
  }

  const size = val.length;
  const [r, g, b] = parts.map(num => {
    if (size === 3) {
      return parseInt(num + num, 16);
    } else {
      return parseInt(num, 16);
    }
  });

  return {a, b, g, r};
}

class DataDescriptionContainer extends Component<{
  type: string,
  value: any,
  editable: boolean,
  commit: (opts: DescriptionCommitOptions) => void,
}> {
  onChangeCheckbox = (e: SyntheticInputEvent<HTMLInputElement>) => {
    this.props.commit({clear: true, keep: true, value: e.target.checked});
  };

  render(): any {
    const {type, editable, value: val} = this.props;

    switch (type) {
      case 'number':
        return <NumberValue>{Number(val)}</NumberValue>;

      case 'color': {
        const colorInfo = parseColor(val);
        if (colorInfo) {
          const {a, b, g, r} = colorInfo;
          return [
            <ColorBox key="color-box" color={`rgba(${r}, ${g}, ${b}, ${a})`} />,
            <ColorValue key="value">
              rgba({r}, {g}, {b}, {a === 1 ? '1' : a.toFixed(2)})
            </ColorValue>,
          ];
        } else {
          return <span>Malformed color</span>;
        }
      }

      case 'text':
      case 'string':
        return <StringValue>"{String(val || '')}"</StringValue>;

      case 'enum':
        return <StringValue>{String(val)}</StringValue>;

      case 'boolean':
        return editable ? (
          <input
            type="checkbox"
            checked={Boolean(val)}
            disabled={!editable}
            onChange={this.onChangeCheckbox}
          />
        ) : (
          <StringValue>{String(val)}</StringValue>
        );

      case 'undefined':
        return <UndefinedValue>undefined</UndefinedValue>;

      case 'date':
        if (Object.prototype.toString.call(val) === '[object Date]') {
          return <span>{val.toString()}</span>;
        } else {
          return <span>{val}</span>;
        }

      case 'null':
        return <NullValue>null</NullValue>;

      case 'array':
      case 'object':
        // no description necessary as we'll typically wrap it in [] or {} which already denotes the
        // type
        return null;

      case 'function':
        return (
          <span>
            <FunctionKeyword>function</FunctionKeyword>
            <FunctionName>&nbsp;{val.name}()</FunctionName>
          </span>
        );

      case 'symbol':
        return <SymbolValue>Symbol()</SymbolValue>;

      default:
        return <span>Unknown type "{type}"</span>;
    }
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import DataDescription from './DataDescription.js';
import {Component} from 'react';
import ContextMenu from '../ContextMenu.js';
import styled from '../../styled/index.js';
import DataPreview from './DataPreview.js';
import createPaste from '../../../utils/createPaste.js';
import {reportInteraction} from '../../../utils/InteractionTracker.js';
import {getSortedKeys} from './utils.js';
import {colors} from '../colors.js';
import {clipboard} from 'electron';

const deepEqual = require('deep-equal');

const BaseContainer = styled.view(
  {
    fontFamily: 'Menlo, monospace',
    fontSize: 11,
    lineHeight: '17px',
    filter: props => (props.disabled ? 'grayscale(100%)' : ''),
    margin: props => (props.depth === 0 ? '7.5px 0' : '0'),
    paddingLeft: 10,
    userSelect: 'text',
  },
  {
    ignoreAttributes: ['depth', 'disabled'],
  },
);

const RecursiveBaseWrapper = styled.text({
  color: colors.red,
});

const Wrapper = styled.text({
  color: '#555',
});

const PropertyContainer = styled.text({
  paddingTop: '2px',
});

const ExpandControl = styled.text({
  color: '#6e6e6e',
  fontSize: 10,
  marginLeft: -11,
  marginRight: 5,
  whiteSpace: 'pre',
});

export const InspectorName = styled.text({
  color: colors.grapeDark1,
});

export type DataValueExtractor = (
  value: any,
  depth: number,
) => ?{|
  mutable: boolean,
  type: string,
  value: any,
|};

export type DataInspectorSetValue = (path: Array<string>, val: any) => void;

export type DataInspectorExpanded = {
  [key: string]: boolean,
};

export type DiffMetadataExtractor = (
  data: any,
  diff: any,
  key: string,
) => Array<{|
  data: any,
  diff?: any,
  status?: 'added' | 'removed',
|}>;

type DataInspectorProps = {
  /**
   * Object to inspect.
   */
  data: any,
  /**
   * Object to compare with the provided `data` property.
   * Differences will be styled accordingly in the UI.
   */
  diff?: any,
  /**
   * Current name of this value.
   */
  name?: string,
  /**
   * Current depth.
   */
  depth: number,
  /**
   * An array containing the current location of the data relative to it's root.
   */
  path: Array<string>,
  /**
   * Whether to expand the root by default.
   */
  expandRoot?: boolean,
  /**
   * An array of paths that are currently expanded.
   */
  expanded: DataInspectorExpanded,
  /**
   * An optional callback that will explode a value into it's type and value.
   * Useful for inspecting serialised data.
   */
  extractValue?: DataValueExtractor,
  /**
   * Callback whenever the current expanded paths is changed.
   */
  onExpanded?: ?(expanded: DataInspectorExpanded) => void,
  /**
   * Callback when a value is edited.
   */
  setValue?: ?DataInspectorSetValue,
  /**
   * Whether all objects and arrays should be collapsed by default.
   */
  collapsed?: boolean,
  /**
   * Ancestry of parent objects, used to avoid recursive objects.
   */
  ancestry: Array<Object>,
};

const defaultValueExtractor: DataValueExtractor = (value: any) => {
  const type = typeof value;

  if (type === 'number') {
    return {mutable: true, type: 'number', value};
  }

  if (type === 'string') {
    return {mutable: true, type: 'string', value};
  }

  if (type === 'boolean') {
    return {mutable: true, type: 'boolean', value};
  }

  if (type === 'undefined') {
    return {mutable: true, type: 'undefined', value};
  }

  if (value === null) {
    return {mutable: true, type: 'null', value};
  }

  if (Array.isArray(value)) {
    return {mutable: true, type: 'array', value};
  }

  if (Object.prototype.toString.call(value) === '[object Date]') {
    return {mutable: true, type: 'date', value};
  }

  if (type === 'object') {
    return {mutable: true, type: 'object', value};
  }
};

const rootContextMenuCache: WeakMap<
  Object,
  Array<Electron$MenuItemOptions>,
> = new WeakMap();

function getRootContextMenu(data: Object): Array<Electron$MenuItemOptions> {
  const cached = rootContextMenuCache.get(data);
  if (cached != null) {
    return cached;
  }

  const stringValue = JSON.stringify(data, null, 2);
  const menu: Array<Electron$MenuItemOptions> = [
    {
      label: 'Copy entire tree',
      click: () => clipboard.writeText(stringValue),
    },
    {
      type: 'separator',
    },
    {
      label: 'Create paste',
      click: () => {
        createPaste(stringValue);
      },
    },
  ];
  rootContextMenuCache.set(data, menu);
  return menu;
}

function isPureObject(obj: Object) {
  return (
    Object.prototype.toString.call(obj) !== '[object Date]' &&
    typeof obj === 'object'
  );
}

const diffMetadataExtractor: DiffMetadataExtractor = (
  data: any,
  diff?: any,
  key: string,
) => {
  if (diff == null) {
    return [{data: data[key]}];
  }

  const val = data[key];
  const diffVal = diff[key];
  if (!data.hasOwnProperty(key)) {
    return [{data: diffVal, status: 'added'}];
  }
  if (!diff.hasOwnProperty(key)) {
    return [{data: val, status: 'removed'}];
  }

  if (isPureObject(diffVal) && isPureObject(val)) {
    return [{data: val, diff: diffVal}];
  }

  if (diffVal !== val) {
    // Check if there's a difference between the original value and
    // the value from the diff prop
    // The property name still exists, but the values may be different.
    return [{data: diffVal, status: 'added'}, {data: val, status: 'removed'}];
  }

  return Object.prototype.hasOwnProperty.call(data, key) ? [{data: val}] : [];
};

function isComponentExpanded(
  data: any,
  diffType: string,
  diffValue: any,
  isExpanded: boolean,
) {
  if (isExpanded) {
    return true;
  }

  if (diffValue == null) {
    return false;
  }

  if (diffType === 'object') {
    const sortedDataValues = Object.keys(data)
      .sort()
      .map(key => data[key]);
    const sortedDiffValues = Object.keys(diffValue)
      .sort()
      .map(key => diffValue[key]);
    if (JSON.stringify(sortedDataValues) !== JSON.stringify(sortedDiffValues)) {
      return true;
    }
  } else {
    if (data !== diffValue) {
      return true;
    }
  }
  return false;
}

/**
 * An expandable data inspector.
 *
 * This component is fairly low level. It's likely you're looking for
 * [`<ManagedDataInspector>`]().
 */
export default class DataInspector extends Component<DataInspectorProps> {
  static defaultProps: {|
    expanded: DataInspectorExpanded,
    depth: number,
    path: Array<string>,
    ancestry: Array<Object>,
  |} = {
    expanded: {},
    depth: 0,
    path: [],
    ancestry: [],
  };

  interaction: (name: string) => void;

  constructor(props: DataInspectorProps) {
    super();
    this.interaction = reportInteraction('DataInspector', props.path.join(':'));
  }

  static isExpandable(data: any) {
    return (
      typeof data === 'object' && data !== null && Object.keys(data).length > 0
    );
  }

  shouldComponentUpdate(nextProps: DataInspectorProps) {
    const {props} = this;

    // check if any expanded paths effect this subtree
    if (nextProps.expanded !== props.expanded) {
      const path = nextProps.path.join('.');

      for (const key in nextProps.expanded) {
        if (key.startsWith(path) === false) {
          // this key doesn't effect us
          continue;
        }

        if (nextProps.expanded[key] !== props.expanded[key]) {
          return true;
        }
      }
    }

    // basic equality checks for the rest
    return (
      nextProps.data !== props.data ||
      nextProps.diff !== props.diff ||
      nextProps.name !== props.name ||
      nextProps.depth !== props.depth ||
      !deepEqual(nextProps.path, props.path) ||
      nextProps.onExpanded !== props.onExpanded ||
      nextProps.setValue !== props.setValue
    );
  }

  isExpanded(pathParts: Array<string>) {
    const {expanded} = this.props;

    // if we no expanded object then expand everything
    if (expanded == null) {
      return true;
    }

    const path = pathParts.join('.');

    // check if there's a setting for this path
    if (Object.prototype.hasOwnProperty.call(expanded, path)) {
      return expanded[path];
    }

    // check if all paths are collapsed
    if (this.props.collapsed === true) {
      return false;
    }

    // by default all items are expanded
    return true;
  }

  setExpanded(pathParts: Array<string>, isExpanded: boolean) {
    const {expanded, onExpanded} = this.props;
    if (!onExpanded || !expanded) {
      return;
    }

    const path = pathParts.join('.');

    onExpanded({
      ...expanded,
      [path]: isExpanded,
    });
  }

  handleClick = () => {
    const isExpanded = this.isExpanded(this.props.path);
    this.interaction(isExpanded ? 'collapsed' : 'expanded');
    this.setExpanded(this.props.path, !isExpanded);
  };

  extractValue = (data: any, depth: number) => {
    let res;

    const {extractValue} = this.props;
    if (extractValue) {
      res = extractValue(data, depth);
    }

    if (!res) {
      res = defaultValueExtractor(data, depth);
    }

    return res;
  };

  render(): any {
    const {
      data,
      diff,
      depth,
      expanded: expandedPaths,
      expandRoot,
      extractValue,
      name,
      onExpanded,
      path,
      ancestry,
      collapsed,
    } = this.props;

    // the data inspector makes values read only when setValue isn't set so we just need to set it
    // to null and the readOnly status will be propagated to all children
    let {setValue} = this.props;

    const res = this.extractValue(data, depth);
    const resDiff = this.extractValue(diff, depth);

    let type;
    let value;
    if (res) {
      if (!res.mutable) {
        setValue = null;
      }

      ({type, value} = res);
    } else {
      return null;
    }

    if (ancestry.includes(value)) {
      return <RecursiveBaseWrapper>Recursive</RecursiveBaseWrapper>;
    }

    const isExpandable = DataInspector.isExpandable(value);
    const isExpanded =
      isExpandable &&
      (resDiff != null
        ? isComponentExpanded(
            value,
            resDiff.type,
            resDiff.value,
            expandRoot === true || this.isExpanded(path),
          )
        : expandRoot === true || this.isExpanded(path));

    let expandGlyph = '';
    if (isExpandable) {
      if (isExpanded) {
        expandGlyph = '▼';
      } else {
        expandGlyph = '▶';
      }
    } else {
      if (depth !== 0) {
        expandGlyph = ' ';
      }
    }

    let propertyNodesContainer;
    if (isExpandable && isExpanded) {
      const propertyNodes = [];

      // ancestry of children, including it's owner object
      const childAncestry = ancestry.concat([value]);

      const diffValue = diff && resDiff ? resDiff.value : null;

      const keys = getSortedKeys({...value, ...diffValue});

      const Added = styled.view({
        backgroundColor: colors.tealTint70,
      });
      const Removed = styled.view({
        backgroundColor: colors.cherryTint70,
      });

      for (const key of keys) {
        const diffMetadataArr = diffMetadataExtractor(value, diffValue, key);
        for (const metadata of diffMetadataArr) {
          const dataInspectorNode = (
            <DataInspector
              ancestry={childAncestry}
              extractValue={extractValue}
              setValue={setValue}
              expanded={expandedPaths}
              collapsed={collapsed}
              onExpanded={onExpanded}
              path={path.concat(key)}
              depth={depth + 1}
              key={key}
              name={key}
              data={metadata.data}
              diff={metadata.diff}
            />
          );

          switch (metadata.status) {
            case 'added':
              propertyNodes.push(<Added>{dataInspectorNode}</Added>);
              break;
            case 'removed':
              propertyNodes.push(<Removed>{dataInspectorNode}</Removed>);
              break;
            default:
              propertyNodes.push(dataInspectorNode);
          }
        }
      }

      propertyNodesContainer = propertyNodes;
    }

    if (expandRoot === true) {
      return (
        <ContextMenu component="span" items={getRootContextMenu(data)}>
          {propertyNodesContainer}
        </ContextMenu>
      );
    }

    // create name components
    const nameElems = [];
    if (typeof name !== 'undefined') {
      nameElems.push(<InspectorName key="name">{name}</InspectorName>);
      nameElems.push(<span key="sep">: </span>);
    }

    // create description or preview
    let descriptionOrPreview;
    if (isExpanded || !isExpandable) {
      descriptionOrPreview = (
        <DataDescription
          path={path}
          setValue={setValue}
          type={type}
          value={value}
        />
      );
    } else {
      descriptionOrPreview = (
        <DataPreview
          type={type}
          value={value}
          setValue={setValue}
          extractValue={this.extractValue}
          depth={depth}
        />
      );
    }
    descriptionOrPreview = (
      <span>
        {nameElems}
        {descriptionOrPreview}
      </span>
    );

    let wrapperStart;
    let wrapperEnd;
    if (isExpanded) {
      if (type === 'object') {
        wrapperStart = <Wrapper>{'{'}</Wrapper>;
        wrapperEnd = <Wrapper>{'}'}</Wrapper>;
      }

      if (type === 'array') {
        wrapperStart = <Wrapper>{'['}</Wrapper>;
        wrapperEnd = <Wrapper>{']'}</Wrapper>;
      }
    }

    const contextMenuItems = [];

    if (isExpandable) {
      contextMenuItems.push(
        {
          label: isExpanded ? 'Collapse' : 'Expand',
          click: this.handleClick,
        },
        {
          type: 'separator',
        },
      );
    }

    contextMenuItems.push(
      {
        label: 'Copy',
        click: () => clipboard.writeText(window.getSelection().toString()),
      },
      {
        label: 'Copy value',
        click: () => clipboard.writeText(JSON.stringify(data, null, 2)),
      },
    );

    return (
      <BaseContainer
        depth={depth}
        disabled={
          Boolean(this.props.setValue) === true && Boolean(setValue) === false
        }>
        <ContextMenu component="span" items={contextMenuItems}>
          <PropertyContainer onClick={isExpandable ? this.handleClick : null}>
            {expandedPaths && <ExpandControl>{expandGlyph}</ExpandControl>}
            {descriptionOrPreview}
            {wrapperStart}
          </PropertyContainer>
        </ContextMenu>
        {propertyNodesContainer}
        {wrapperEnd}
      </BaseContainer>
    );
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type {DataValueExtractor} from './DataInspector.js';
import DataDescription from './DataDescription.js';
import {InspectorName} from './DataInspector.js';
import styled from '../../styled/index.js';
import {getSortedKeys} from './utils.js';
import {PureComponent} from 'react';

const PreviewContainer = styled.text({
  fontStyle: 'italic',
});

function intersperse(arr, sep) {
  if (arr.length === 0) {
    return [];
  }

  return arr.slice(1).reduce(
    (xs, x, i) => {
      return xs.concat([sep, x]);
    },
    [arr[0]],
  );
}

export default class DataPreview extends PureComponent<{
  type: string,
  value: any,
  depth: number,
  extractValue: DataValueExtractor,
  maxProperties: number,
}> {
  static defaultProps = {
    maxProperties: 5,
  };

  render() {
    const {depth, extractValue, type, value} = this.props;

    if (type === 'array') {
      return (
        <PreviewContainer>
          {'['}
          {intersperse(
            value.map((element, index) => {
              const res = extractValue(element, depth + 1);
              if (!res) {
                return null;
              }

              const {type, value} = res;
              return (
                <DataDescription
                  key={index}
                  type={type}
                  value={value}
                  setValue={null}
                />
              );
            }),
            ', ',
          )}
          {']'}
        </PreviewContainer>
      );
    } else if (type === 'date') {
      return <span>{value.toString()}</span>;
    } else if (type === 'object') {
      const propertyNodes = [];

      const keys = getSortedKeys(value);
      let i = 0;
      for (const key of keys) {
        let ellipsis;
        i++;
        if (i >= this.props.maxProperties) {
          ellipsis = <span key={'ellipsis'}>…</span>;
        }

        propertyNodes.push(
          <span key={key}>
            <InspectorName>{key}</InspectorName>
            {ellipsis}
          </span>,
        );

        if (ellipsis) {
          break;
        }
      }

      return (
        <PreviewContainer>
          {'{'}
          {intersperse(propertyNodes, ', ')}
          {'}'}
        </PreviewContainer>
      );
    } else {
      return null;
    }
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type {
  DataValueExtractor,
  DataInspectorExpanded,
} from './DataInspector.js';
import {PureComponent} from 'react';
import DataInspector from './DataInspector.js';

type ManagedDataInspectorProps = {|
  /**
   * Object to inspect.
   */
  data: any,
  /**
   * Object to compare with the provided `data` property.
   * Differences will be styled accordingly in the UI.
   */
  diff?: any,
  /**
   * Whether to expand the root by default.
   */
  expandRoot?: boolean,
  /**
   * An optional callback that will explode a value into it's type and value.
   * Useful for inspecting serialised data.
   */
  extractValue?: DataValueExtractor,
  /**
   * Callback when a value is edited.
   */
  setValue?: (path: Array<string>, val: any) => void,
  /**
   * Whether all objects and arrays should be collapsed by default.
   */
  collapsed?: boolean,
|};

type ManagedDataInspectorState = {|
  expanded: DataInspectorExpanded,
|};

/**
 * Wrapper around `DataInspector` that handles expanded state.
 *
 * If you require lower level access to the state then use `DataInspector`
 * directly.
 *
 * @example Plain object
 *   <ManagedDataInspector data={{
 *     a: '',
 *     b: [1, 2, 3, 4],
 *     c: {foo: 'bar'},
 *     d: 4,
 *   }} />
 * @example Expanded root
 *   <ManagedDataInspector expandRoot={true} data={{
 *     a: '',
 *     b: [1, 2, 3, 4],
 *     c: {foo: 'bar'},
 *     d: 4,
 *   }} />
 * @example Editable
 *   <ManagedDataInspector setValue={() => {}} data={{
 *     a: '',
 *     b: [1, 2, 3, 4],
 *     c: {foo: 'bar'},
 *     d: 4,
 *   }} />
 */
export default class ManagedDataInspector extends PureComponent<
  ManagedDataInspectorProps,
  ManagedDataInspectorState,
> {
  constructor(props: ManagedDataInspectorProps, context: Object) {
    super(props, context);
    this.state = {
      expanded: {},
    };
  }

  onExpanded = (expanded: DataInspectorExpanded) => {
    this.setState({expanded});
  };

  render() {
    return (
      <DataInspector
        data={this.props.data}
        diff={this.props.diff}
        extractValue={this.props.extractValue}
        setValue={this.props.setValue}
        expanded={this.state.expanded}
        onExpanded={this.onExpanded}
        expandRoot={this.props.expandRoot}
        collapsed={this.props.collapsed}
      />
    );
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

const naturalCompare = require('string-natural-compare');

export function getSortedKeys(obj: Object): Array<string> {
  return Object.keys(obj).sort(naturalCompare);
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type {
  ElementID,
  Element,
  ElementSearchResultSet,
} from './ElementsInspector.js';
import {reportInteraction} from '../../../utils/InteractionTracker';
import ContextMenu from '../ContextMenu.js';
import {PureComponent} from 'react';
import FlexRow from '../FlexRow.js';
import FlexColumn from '../FlexColumn.js';
import Glyph from '../Glyph.js';
import {colors} from '../colors.js';
import Text from '../Text.js';
import styled from '../../styled/index.js';
import {FixedList} from '../../virtualized/index.js';
import {clipboard} from 'electron';

const ROW_HEIGHT = 23;

const ElementsRowContainer = ContextMenu.extends(
  {
    flexDirection: 'row',
    alignItems: 'center',
    backgroundColor: props => {
      if (props.selected) {
        return colors.macOSTitleBarIconSelected;
      } else if (props.even) {
        return colors.light02;
      } else {
        return '';
      }
    },
    color: props => (props.selected ? colors.white : colors.grapeDark3),
    flexShrink: 0,
    flexWrap: 'nowrap',
    height: ROW_HEIGHT,
    minWidth: '100%',
    paddingLeft: props => (props.level - 1) * 12,
    paddingRight: 20,
    position: 'relative',

    '& *': {
      color: props => (props.selected ? `${colors.white} !important` : ''),
    },

    '&:hover': {
      backgroundColor: props =>
        props.selected ? colors.macOSTitleBarIconSelected : '#EBF1FB',
    },
  },
  {
    ignoreAttributes: ['level', 'selected', 'even'],
  },
);

const ElementsRowDecoration = FlexRow.extends({
  flexShrink: 0,
  justifyContent: 'flex-end',
  alignItems: 'center',
  marginRight: 4,
  position: 'relative',
  width: 16,
  top: -1,
});

const ElementsLine = styled.view(
  {
    backgroundColor: colors.light20,
    height: props => props.childrenCount * ROW_HEIGHT - 4,
    position: 'absolute',
    right: 3,
    top: ROW_HEIGHT - 3,
    zIndex: 2,
    width: 2,
    borderRadius: '999em',
  },
  {
    ignoreAttributes: ['childrenCount'],
  },
);

const DecorationImage = styled.image({
  height: 12,
  marginRight: 5,
  width: 12,
});

const NoShrinkText = Text.extends({
  flexShrink: 0,
  flexWrap: 'nowrap',
  overflow: 'hidden',
  userSelect: 'none',
  fontWeight: 400,
});

const ElementsRowAttributeContainer = NoShrinkText.extends({
  color: colors.dark80,
  fontWeight: 300,
  marginLeft: 5,
});

const ElementsRowAttributeKey = styled.text({
  color: colors.tomato,
});

const ElementsRowAttributeValue = styled.text({
  color: colors.slateDark3,
});

class PartialHighlight extends PureComponent<{
  selected: boolean,
  highlighted: ?string,
  content: string,
}> {
  static HighlightedText = styled.text({
    backgroundColor: '#ffff33',
    color: props =>
      props.selected ? `${colors.grapeDark3} !important` : 'auto',
  });

  render() {
    const {highlighted, content, selected} = this.props;
    let renderedValue;
    if (
      content &&
      highlighted != null &&
      highlighted != '' &&
      content.toLowerCase().includes(highlighted.toLowerCase())
    ) {
      const highlightStart = content
        .toLowerCase()
        .indexOf(highlighted.toLowerCase());
      const highlightEnd = highlightStart + highlighted.length;
      const before = content.substring(0, highlightStart);
      const match = content.substring(highlightStart, highlightEnd);
      const after = content.substring(highlightEnd);
      renderedValue = [
        <span>
          {before}
          <PartialHighlight.HighlightedText selected={selected}>
            {match}
          </PartialHighlight.HighlightedText>
          {after}
        </span>,
      ];
    } else {
      renderedValue = <span>{content}</span>;
    }
    return renderedValue;
  }
}

class ElementsRowAttribute extends PureComponent<{
  name: string,
  value: string,
  matchingSearchQuery: ?string,
  selected: boolean,
}> {
  render() {
    const {name, value, matchingSearchQuery, selected} = this.props;
    return (
      <ElementsRowAttributeContainer code={true}>
        <ElementsRowAttributeKey>{name}</ElementsRowAttributeKey>
        =
        <ElementsRowAttributeValue>
          <PartialHighlight
            content={value}
            highlighted={
              name === 'id' || name === 'addr' ? matchingSearchQuery : ''
            }
            selected={selected}
          />
        </ElementsRowAttributeValue>
      </ElementsRowAttributeContainer>
    );
  }
}

type FlatElement = {|
  key: ElementID,
  element: Element,
  level: number,
|};

type FlatElements = Array<FlatElement>;

type ElementsRowProps = {
  id: ElementID,
  level: number,
  selected: boolean,
  matchingSearchQuery: ?string,
  element: Element,
  even: boolean,
  onElementSelected: (key: ElementID) => void,
  onElementExpanded: (key: ElementID, deep: boolean) => void,
  childrenCount: number,
  onElementHovered: ?(key: ?ElementID) => void,
  style: ?Object,
};

type ElementsRowState = {|
  hovered: boolean,
|};

class ElementsRow extends PureComponent<ElementsRowProps, ElementsRowState> {
  constructor(props: ElementsRowProps, context: Object) {
    super(props, context);
    this.state = {hovered: false};
    this.interaction = reportInteraction('ElementsRow', props.element.name);
  }

  interaction: (name: string, data: any) => void;

  getContextMenu = (): Array<Electron$MenuItemOptions> => {
    const {props} = this;
    return [
      {
        type: 'separator',
      },
      {
        label: 'Copy',
        click: () => {
          clipboard.writeText(props.element.name);
        },
      },
      {
        label: props.element.expanded ? 'Collapse' : 'Expand',
        click: () => {
          this.props.onElementExpanded(this.props.id, false);
        },
      },
    ];
  };

  onClick = () => {
    this.props.onElementSelected(this.props.id);
    this.interaction('selected', {level: this.props.level});
  };

  onDoubleClick = (event: SyntheticMouseEvent<*>) => {
    this.props.onElementExpanded(this.props.id, event.altKey);
  };

  onMouseEnter = () => {
    this.setState({hovered: true});
    if (this.props.onElementHovered) {
      this.props.onElementHovered(this.props.id);
    }
  };

  onMouseLeave = () => {
    this.setState({hovered: false});
    if (this.props.onElementHovered) {
      this.props.onElementHovered(null);
    }
  };

  render() {
    const {
      element,
      id,
      level,
      selected,
      style,
      even,
      matchingSearchQuery,
    } = this.props;
    const hasChildren = element.children && element.children.length > 0;

    let arrow;
    if (hasChildren) {
      arrow = (
        <span onClick={this.onDoubleClick} role="button" tabIndex={-1}>
          <Glyph
            size={8}
            name={element.expanded ? 'chevron-down' : 'chevron-right'}
            color={selected ? 'white' : colors.light80}
          />
        </span>
      );
    }

    const attributes = element.attributes
      ? element.attributes.map(attr => (
          <ElementsRowAttribute
            key={attr.name}
            name={attr.name}
            value={attr.value}
            matchingSearchQuery={matchingSearchQuery}
            selected={selected}
          />
        ))
      : [];

    const decoration = (() => {
      switch (element.decoration) {
        case 'litho':
          return <DecorationImage src="icons/litho-logo.png" />;
        case 'componentkit':
          return <DecorationImage src="icons/componentkit-logo.png" />;
        case 'componentscript':
          return <DecorationImage src="icons/componentscript-logo.png" />;
        default:
          return null;
      }
    })();

    // when we hover over or select an expanded element with children, we show a line from the
    // bottom of the element to the next sibling
    let line;
    const shouldShowLine =
      (selected || this.state.hovered) && hasChildren && element.expanded;
    if (shouldShowLine) {
      line = <ElementsLine childrenCount={this.props.childrenCount} />;
    }

    return (
      <ElementsRowContainer
        buildItems={this.getContextMenu}
        key={id}
        level={level}
        selected={selected}
        matchingSearchQuery={matchingSearchQuery}
        even={even}
        onClick={this.onClick}
        onDoubleClick={this.onDoubleClick}
        onMouseEnter={this.onMouseEnter}
        onMouseLeave={this.onMouseLeave}
        style={style}>
        <ElementsRowDecoration>
          {line}
          {arrow}
        </ElementsRowDecoration>
        <NoShrinkText code={true}>
          {decoration}
          <PartialHighlight
            content={element.name}
            highlighted={matchingSearchQuery}
            selected={selected}
          />
        </NoShrinkText>
        {attributes}
      </ElementsRowContainer>
    );
  }
}

const ElementsContainer = FlexColumn.extends({
  backgroundColor: colors.white,
  minHeight: '100%',
  minWidth: '100%',
  overflow: 'auto',
});

const ElementsBox = FlexColumn.extends({
  alignItems: 'flex-start',
  flex: 1,
  overflow: 'auto',
});

type ElementsProps = {|
  root: ?ElementID,
  selected: ?ElementID,
  searchResults: ?ElementSearchResultSet,
  elements: {[key: ElementID]: Element},
  onElementSelected: (key: ElementID) => void,
  onElementExpanded: (key: ElementID, deep: boolean) => void,
  onElementHovered: ?(key: ?ElementID) => void,
|};

type ElementsState = {|
  flatKeys: Array<ElementID>,
  flatElements: FlatElements,
  maxDepth: number,
|};

export class Elements extends PureComponent<ElementsProps, ElementsState> {
  constructor(props: ElementsProps, context: Object) {
    super(props, context);
    this.state = {
      flatElements: [],
      flatKeys: [],
      maxDepth: 0,
    };
  }

  componentDidMount() {
    this.setProps(this.props, true);
  }

  componentWillReceiveProps(nextProps: ElementsProps) {
    this.setProps(nextProps);
  }

  setProps(props: ElementsProps, force?: boolean) {
    const flatElements: FlatElements = [];
    const flatKeys = [];

    let maxDepth = 0;

    function seed(key: ElementID, level: number) {
      const element = props.elements[key];
      if (!element) {
        return;
      }

      maxDepth = Math.max(maxDepth, level);

      flatElements.push({
        element,
        key,
        level,
      });

      flatKeys.push(key);

      if (
        element.children != null &&
        element.children.length > 0 &&
        element.expanded
      ) {
        for (const key of element.children) {
          seed(key, level + 1);
        }
      }
    }

    if (props.root != null) {
      seed(props.root, 1);
    }

    this.setState({flatElements, flatKeys, maxDepth});
  }

  selectElement = (key: ElementID) => {
    this.props.onElementSelected(key);
  };

  onKeyDown = (e: SyntheticKeyboardEvent<*>) => {
    const {selected} = this.props;
    if (selected == null) {
      return;
    }

    const {props} = this;
    const {flatElements, flatKeys} = this.state;

    const selectedIndex = flatKeys.indexOf(selected);
    if (selectedIndex < 0) {
      return;
    }

    const selectedElement = props.elements[selected];
    if (!selectedElement) {
      return;
    }

    if (
      e.key === 'c' &&
      ((e.metaKey && process.platform === 'darwin') ||
        (e.ctrlKey && process.platform !== 'darwin'))
    ) {
      e.preventDefault();
      clipboard.writeText(selectedElement.name);
      return;
    }

    if (e.key === 'ArrowUp') {
      if (selectedIndex === 0 || flatKeys.length === 1) {
        return;
      }

      e.preventDefault();
      this.selectElement(flatKeys[selectedIndex - 1]);
    }

    if (e.key === 'ArrowDown') {
      if (selectedIndex === flatKeys.length - 1) {
        return;
      }

      e.preventDefault();
      this.selectElement(flatKeys[selectedIndex + 1]);
    }

    if (e.key === 'ArrowLeft') {
      e.preventDefault();
      if (selectedElement.expanded) {
        // unexpand
        props.onElementExpanded(selected, false);
      } else {
        // jump to parent
        let parentKey;
        const targetLevel = flatElements[selectedIndex].level - 1;
        for (let i = selectedIndex; i >= 0; i--) {
          const {level} = flatElements[i];
          if (level === targetLevel) {
            parentKey = flatKeys[i];
            break;
          }
        }

        if (parentKey) {
          this.selectElement(parentKey);
        }
      }
    }

    if (e.key === 'ArrowRight' && selectedElement.children.length > 0) {
      e.preventDefault();
      if (selectedElement.expanded) {
        // go to first child
        this.selectElement(selectedElement.children[0]);
      } else {
        // expand
        props.onElementExpanded(selected, false);
      }
    }
  };

  buildRow = ({index, style}: {index: number, style: Object}) => {
    const {
      elements,
      onElementExpanded,
      onElementHovered,
      onElementSelected,
      selected,
      searchResults,
    } = this.props;
    const {flatElements} = this.state;
    const row = flatElements[index];

    let childrenCount = 0;
    for (let i = index + 1; i < flatElements.length; i++) {
      const child = flatElements[i];
      if (child.level <= row.level) {
        break;
      } else {
        childrenCount++;
      }
    }

    return (
      <ElementsRow
        level={row.level}
        id={row.key}
        key={row.key}
        even={index % 2 === 0}
        onElementExpanded={onElementExpanded}
        onElementHovered={onElementHovered}
        onElementSelected={onElementSelected}
        selected={selected === row.key}
        matchingSearchQuery={
          searchResults && searchResults.matches.has(row.key)
            ? searchResults.query
            : null
        }
        element={row.element}
        elements={elements}
        childrenCount={childrenCount}
        style={style}
      />
    );
  };

  keyMapper = (index: number): string => {
    return this.state.flatElements[index].key;
  };

  render() {
    const items = this.state.flatElements;

    return (
      <ElementsBox>
        <ElementsContainer tabIndex="0" onKeyDown={this.onKeyDown}>
          <FixedList
            pureData={items}
            keyMapper={this.keyMapper}
            rowCount={items.length}
            rowHeight={ROW_HEIGHT}
            rowRenderer={this.buildRow}
            sideScrollable={true}
          />
        </ElementsContainer>
      </ElementsBox>
    );
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import {Component} from 'react';
import FlexRow from '../FlexRow.js';
import {Elements} from './elements.js';

export type ElementID = string;

export type ElementSearchResultSet = {|
  query: string,
  matches: Set<ElementID>,
|};

export type ElementData = {
  [name: ElementID]: {
    [key: string]:
      | string
      | number
      | boolean
      | {|
          __type__: string,
          value: any,
        |},
  },
};

export type ElementAttribute = {|
  name: string,
  value: string,
|};

export type Element = {|
  id: ElementID,
  name: string,
  expanded: boolean,
  children: Array<ElementID>,
  attributes: Array<ElementAttribute>,
  data: ElementData,
  decoration: string,
|};

export default class ElementsInspector extends Component<{
  onElementExpanded: (key: ElementID, deep: boolean) => void,
  onElementSelected: (key: ElementID) => void,
  onElementHovered: ?(key: ?ElementID) => void,
  onValueChanged: ?(path: Array<string>, val: any) => void,
  selected: ?ElementID,
  searchResults?: ?ElementSearchResultSet,
  root: ?ElementID,
  elements: {[key: ElementID]: Element},
  useAppSidebar?: boolean,
}> {
  render() {
    const {
      selected,
      elements,
      root,
      onElementExpanded,
      onElementSelected,
      onElementHovered,
      searchResults,
    } = this.props;

    return (
      <FlexRow fill={true}>
        <Elements
          onElementExpanded={onElementExpanded}
          onElementSelected={onElementSelected}
          onElementHovered={onElementHovered}
          selected={selected}
          searchResults={searchResults}
          root={root}
          elements={elements}
        />
      </FlexRow>
    );
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type {Element} from './ElementsInspector.js';
import type {PluginClient} from '../../../plugin';
import Panel from '../Panel.js';
import ManagedDataInspector from '../data-inspector/ManagedDataInspector.js';
import {Component} from 'react';
import {Console} from '../console';
import {GK} from 'sonar';

const deepEqual = require('deep-equal');

type OnValueChanged = (path: Array<string>, val: any) => void;

type InspectorSidebarSectionProps = {
  data: any,
  id: string,
  onValueChanged: ?OnValueChanged,
};

class InspectorSidebarSection extends Component<InspectorSidebarSectionProps> {
  setValue = (path: Array<string>, value: any) => {
    if (this.props.onValueChanged) {
      this.props.onValueChanged([this.props.id, ...path], value);
    }
  };

  shouldComponentUpdate(nextProps: InspectorSidebarSectionProps) {
    return (
      !deepEqual(nextProps, this.props) ||
      this.props.id !== nextProps.id ||
      this.props.onValueChanged !== nextProps.onValueChanged
    );
  }

  extractValue = (val: any, depth: number) => {
    if (val && val.__type__) {
      return {
        mutable: Boolean(val.__mutable__),
        type: val.__type__ === 'auto' ? typeof val.value : val.__type__,
        value: val.value,
      };
    } else {
      return {
        mutable: typeof val === 'object',
        type: typeof val,
        value: val,
      };
    }
  };

  render() {
    const {id} = this.props;
    return (
      <Panel heading={id} floating={false} fill={false}>
        <ManagedDataInspector
          data={this.props.data}
          setValue={this.props.onValueChanged ? this.setValue : undefined}
          extractValue={this.extractValue}
          expandRoot={true}
          collapsed={true}
        />
      </Panel>
    );
  }
}

type Props = {|
  element: ?Element,
  onValueChanged: ?OnValueChanged,
  client: PluginClient,
|};
type State = {|
  isConsoleEnabled: boolean,
|};

export class InspectorSidebar extends Component<Props, State> {
  state = {
    isConsoleEnabled: false,
  };

  constructor(props: Props) {
    super(props);
    this.checkIfConsoleIsEnabled();
  }

  componentDidUpdate(prevProps: Props, prevState: State) {
    if (prevProps.client !== this.props.client) {
      this.checkIfConsoleIsEnabled();
    }
  }

  checkIfConsoleIsEnabled() {
    this.props.client
      .call('isConsoleEnabled')
      .then((result: {isEnabled: boolean}) => {
        this.setState({isConsoleEnabled: result.isEnabled});
      });
  }

  render() {
    const {element} = this.props;
    if (!element || !element.data) {
      return null;
    }

    const sections = [];
    for (const key in element.data) {
      sections.push(
        <InspectorSidebarSection
          key={key}
          id={key}
          data={element.data[key]}
          onValueChanged={this.props.onValueChanged}
        />,
      );
    }

    if (GK.get('sonar_show_console_plugin') && this.state.isConsoleEnabled) {
      sections.push(
        <Panel heading="JS Console" floating={false} fill={false}>
          <Console client={this.props.client} getContext={() => element.id} />
        </Panel>,
      );
    }

    return sections;
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type {Filter} from './types.js';
import {PureComponent} from 'react';
import ContextMenu from '../ContextMenu.js';
import textContent from '../../../utils/textContent.js';
import styled from '../../styled/index.js';
import {colors} from '../colors.js';

const FilterText = styled.view(
  {
    display: 'flex',
    alignSelf: 'baseline',
    userSelect: 'none',
    cursor: 'pointer',
    position: 'relative',
    maxWidth: '100%',
    '&:hover': {
      color: colors.white,
    },
    '&:hover::after': {
      content: '""',
      position: 'absolute',
      top: 3,
      bottom: -2,
      left: -6,
      right: -6,
      borderRadius: '999em',
      backgroundColor: 'rgba(0, 0, 0, 0.3)',
    },
    '&:hover *': {
      color: `${colors.white} !important`,
      zIndex: 2,
    },
  },
  {
    ignoreAttributes: ['filterKey', 'addFilter'],
  },
);

type Props = {
  children: React.Node,
  addFilter: (filter: Filter) => void,
  filterKey: string,
};

export default class FilterRow extends PureComponent<Props> {
  onClick = (e: SyntheticMouseEvent<>) => {
    if (e.button === 0) {
      this.props.addFilter({
        type: e.metaKey || e.altKey ? 'exclude' : 'include',
        key: this.props.filterKey,
        value: textContent(this.props.children),
      });
    }
  };

  menuItems = [
    {
      label: 'Filter this value',
      click: () =>
        this.props.addFilter({
          type: 'include',
          key: this.props.filterKey,
          value: textContent(this.props.children),
        }),
    },
  ];

  render() {
    const {children, ...props} = this.props;

    return (
      <ContextMenu
        items={this.menuItems}
        component={FilterText}
        onClick={this.onClick}
        {...props}>
        {children}
      </ContextMenu>
    );
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

export type Filter =
  | {
      key: string,
      value: string,
      type: 'include' | 'exclude',
    }
  | {
      key: string,
      value: Array<string>,
      type: 'enum',
      enum: Array<{
        label: string,
        color: string,
        value: string,
      }>,
      persistent?: boolean,
    };
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import {
  FlexBox,
  FlexColumn,
  FlexRow,
  Text,
  View,
  styled,
  Glyph,
  colors,
  brandColors,
  PureComponent,
} from 'sonar';

const Containter = FlexColumn.extends({
  fontSize: 17,
  justifyContent: 'center',
  marginLeft: 60,
  marginRight: 60,
  width: 'auto',
  fontWeight: 300,
  lineHeight: '140%',
  maxWidth: 700,
  minWidth: 450,
});

const TitleRow = FlexRow.extends({
  alignItems: 'center',
  marginBottom: 40,
});

const Icon = FlexBox.extends({
  justifyContent: 'center',
  alignItems: 'center',
  backgroundColor: brandColors.Sonar,
  width: 32,
  height: 32,
  flexShrink: 0,
  borderRadius: 6,
});

const Title = Text.extends({
  fontSize: 30,
  fontWeight: 300,
  paddingLeft: 10,
});

const Button = View.extends({
  marginTop: 40,
  marginBottom: 30,
  borderRadius: 6,
  color: colors.white,
  border: 'none',
  background: brandColors.Sonar,
  padding: '10px 30px',
  fontWeight: 500,
  fontSize: '1em',
  alignSelf: 'flex-start',
});

const Screenshot = styled.customHTMLTag('img', {
  alignSelf: 'center',
  boxShadow: '0 5px 35px rgba(0,0,0,0.3)',
  borderRadius: 5,
  border: `1px solid ${colors.macOSTitleBarBorder}`,
  transform: 'translateX(5px)',
  overflow: 'hidden',
  maxHeight: '80%',
  flexShrink: 0,
});

type Props = {
  title: string,
  icon?: string,
  screenshot?: ?string,
  children: React.Node,
  onDismiss: () => void,
};

export default class Intro extends PureComponent<Props> {
  render() {
    const {icon, children, title, onDismiss, screenshot} = this.props;
    return (
      <FlexRow fill={true}>
        <Containter>
          <TitleRow>
            {icon != null && (
              <Icon>
                <Glyph name={icon} size={24} color={colors.white} />
              </Icon>
            )}
            <Title>{title}</Title>
          </TitleRow>
          {children}
          <Button onClick={onDismiss}>Let's go</Button>
        </Containter>
        {screenshot != null && <Screenshot src={screenshot} />}
      </FlexRow>
    );
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type {Filter} from 'sonar';
import {PureComponent} from 'react';
import Text from '../Text.js';
import styled from '../../styled/index.js';
import {findDOMNode} from 'react-dom';
import {colors} from '../colors.js';
import electron from 'electron';

const Token = Text.extends(
  {
    display: 'inline-flex',
    alignItems: 'center',
    backgroundColor: props =>
      props.focused
        ? colors.macOSHighlightActive
        : props.color || colors.macOSHighlight,
    borderRadius: 4,
    marginRight: 4,
    padding: 4,
    paddingLeft: 6,
    height: 21,
    color: props => (props.focused ? 'white' : 'inherit'),
    '&:active': {
      backgroundColor: colors.macOSHighlightActive,
      color: colors.white,
    },
    '&:first-of-type': {
      marginLeft: 3,
    },
  },
  {
    ignoreAttributes: ['focused', 'color'],
  },
);

const Key = Text.extends(
  {
    position: 'relative',
    fontWeight: 500,
    paddingRight: 12,
    textTransform: 'capitalize',
    lineHeight: '21px',
    '&:after': {
      content: props => (props.type === 'exclude' ? '"≠"' : '"="'),
      paddingLeft: 5,
      position: 'absolute',
      top: -1,
      right: 0,
      fontSize: 14,
    },
    '&:active:after': {
      backgroundColor: colors.macOSHighlightActive,
    },
  },
  {
    ignoreAttributes: ['type', 'focused'],
  },
);

const Value = Text.extends({
  whiteSpace: 'nowrap',
  maxWidth: 160,
  overflow: 'hidden',
  textOverflow: 'ellipsis',
  lineHeight: '21px',
  paddingLeft: 3,
});

const Chevron = styled.view(
  {
    border: 0,
    paddingLeft: 3,
    paddingRight: 1,
    marginRight: 0,
    fontSize: 16,
    backgroundColor: 'transparent',
    position: 'relative',
    top: -2,
    height: 'auto',
    lineHeight: 'initial',
    color: props => (props.focused ? colors.white : 'inherit'),
    '&:hover, &:active, &:focus': {
      color: 'inherit',
      border: 0,
      backgroundColor: 'transparent',
    },
  },
  {
    ignoreAttributes: ['focused'],
  },
);

type Props = {|
  filter: Filter,
  focused: boolean,
  index: number,
  onFocus: (focusedToken: number) => void,
  onBlur: () => void,
  onDelete: (deletedToken: number) => void,
  onReplace: (index: number, filter: Filter) => void,
|};

export default class FilterToken extends PureComponent<Props> {
  _ref: ?Element;

  onMouseDown = () => {
    if (
      this.props.filter.persistent == null ||
      this.props.filter.persistent === false
    ) {
      this.props.onFocus(this.props.index);
    }
    this.showDetails();
  };

  showDetails = () => {
    const menuTemplate = [];

    if (this.props.filter.type === 'enum') {
      menuTemplate.push(
        ...this.props.filter.enum.map(({value, label}) => ({
          label,
          click: () => this.changeEnum(value),
          type: 'checkbox',
          checked: this.props.filter.value.indexOf(value) > -1,
        })),
      );
    } else {
      if (this.props.filter.value.length > 23) {
        menuTemplate.push(
          {
            label: this.props.filter.value,
            enabled: false,
          },
          {
            type: 'separator',
          },
        );
      }

      menuTemplate.push(
        {
          label:
            this.props.filter.type === 'include'
              ? `Entries excluding "${this.props.filter.value}"`
              : `Entries including "${this.props.filter.value}"`,
          click: this.toggleFilter,
        },
        {
          label: 'Remove this filter',
          click: () => this.props.onDelete(this.props.index),
        },
      );
    }
    const menu = electron.remote.Menu.buildFromTemplate(menuTemplate);
    const {bottom, left} = this._ref ? this._ref.getBoundingClientRect() : {};
    menu.popup(electron.remote.getCurrentWindow(), {
      async: true,
      x: parseInt(left, 10),
      y: parseInt(bottom, 10) + 8,
    });
  };

  toggleFilter = () => {
    const {filter, index} = this.props;
    if (filter.type !== 'enum') {
      const newFilter: Filter = {
        ...filter,
        type: filter.type === 'include' ? 'exclude' : 'include',
      };
      this.props.onReplace(index, newFilter);
    }
  };

  changeEnum = (newValue: string) => {
    const {filter, index} = this.props;
    if (filter.type === 'enum') {
      let {value} = filter;
      if (value.indexOf(newValue) > -1) {
        value = value.filter(v => v !== newValue);
      } else {
        value = value.concat([newValue]);
      }
      if (value.length === filter.enum.length) {
        value = [];
      }
      const newFilter: Filter = {
        type: 'enum',
        ...filter,
        value,
      };
      this.props.onReplace(index, newFilter);
    }
  };

  setRef = (ref: React.ElementRef<*>) => {
    const element = findDOMNode(ref);
    if (element instanceof HTMLElement) {
      this._ref = element;
    }
  };

  render() {
    const {filter} = this.props;
    let color;
    let value = '';

    if (filter.type === 'enum') {
      const getEnum = value => filter.enum.find(e => e.value === value);
      const firstValue = getEnum(filter.value[0]);
      const secondValue = getEnum(filter.value[1]);
      if (filter.value.length === 0) {
        value = 'All';
      } else if (filter.value.length === 2 && firstValue && secondValue) {
        value = `${firstValue.label} or ${secondValue.label}`;
      } else if (filter.value.length === 1 && firstValue) {
        value = firstValue.label;
        color = firstValue.color;
      } else if (firstValue) {
        value = `${firstValue.label} or ${filter.value.length - 1} others`;
      }
    } else {
      value = filter.value;
    }

    return (
      <Token
        key={`${filter.key}:${value}=${filter.type}`}
        tabIndex={-1}
        onMouseDown={this.onMouseDown}
        focused={this.props.focused}
        color={color}
        innerRef={this.setRef}>
        <Key type={this.props.filter.type} focused={this.props.focused}>
          {filter.key}
        </Key>
        <Value>{value}</Value>
        <Chevron tabIndex={-1} focused={this.props.focused}>
          &#8964;
        </Chevron>
      </Token>
    );
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type {Filter} from 'sonar';
import {PureComponent} from 'react';
import Toolbar from '../Toolbar.js';
import FlexRow from '../FlexRow.js';
import Input from '../Input.js';
import {colors} from '../colors.js';
import Text from '../Text.js';
import FlexBox from '../FlexBox.js';
import Glyph from '../Glyph.js';
import FilterToken from './FilterToken.js';
import PropTypes from 'prop-types';

const SEARCHABLE_STORAGE_KEY = (key: string) => `SEARCHABLE_STORAGE_KEY_${key}`;

const SearchBar = Toolbar.extends({
  height: 42,
  padding: 6,
});

export const SearchBox = FlexBox.extends({
  backgroundColor: colors.white,
  borderRadius: '999em',
  border: `1px solid ${colors.light15}`,
  height: '100%',
  width: '100%',
  alignItems: 'center',
  paddingLeft: 4,
});

export const SearchInput = Input.extends({
  border: props => (props.focus ? '1px solid black' : 0),
  padding: 0,
  fontSize: '1em',
  flexGrow: 1,
  height: 'auto',
  lineHeight: '100%',
  marginLeft: 2,
  width: '100%',
  '&::-webkit-input-placeholder': {
    color: colors.placeholder,
    fontWeight: 300,
  },
});

const Clear = Text.extends({
  position: 'absolute',
  right: 6,
  top: '50%',
  marginTop: -9,
  fontSize: 16,
  width: 17,
  height: 17,
  borderRadius: 999,
  lineHeight: '15.5px',
  textAlign: 'center',
  backgroundColor: 'rgba(0,0,0,0.1)',
  color: colors.white,
  display: 'block',
  '&:hover': {
    backgroundColor: 'rgba(0,0,0,0.15)',
  },
});

export const SearchIcon = Glyph.extends({
  marginRight: 3,
  marginLeft: 3,
  marginTop: -1,
  minWidth: 16,
});

const Actions = FlexRow.extends({
  marginLeft: 8,
  flexShrink: 0,
});

export type SearchableProps = {|
  addFilter: (filter: Filter) => void,
  searchTerm: string,
  filters: Array<Filter>,
|};

type Props = {|
  placeholder?: string,
  actions: React.Node,
  tableKey: string,
  onFilterChange: (filters: Array<Filter>) => void,
  defaultFilters: Array<Filter>,
|};

type State = {
  filters: Array<Filter>,
  focusedToken: number,
  searchTerm: string,
  hasFocus: boolean,
};

const Searchable = (
  Component: React.ComponentType<any>,
): React.ComponentType<any> =>
  class extends PureComponent<Props, State> {
    static defaultProps = {
      placeholder: 'Search...',
    };

    static contextTypes = {
      plugin: PropTypes.string,
    };

    state = {
      filters: [],
      focusedToken: -1,
      searchTerm: '',
      hasFocus: false,
    };

    _inputRef: ?HTMLInputElement;

    componentDidMount() {
      window.document.addEventListener('keydown', this.onKeyDown);
      const {defaultFilters} = this.props;
      let savedState;
      let key = this.context.plugin + this.props.tableKey;
      try {
        savedState = JSON.parse(
          window.localStorage.getItem(SEARCHABLE_STORAGE_KEY(key)) || 'null',
        );
      } catch (e) {
        window.localStorage.removeItem(SEARCHABLE_STORAGE_KEY(key));
      }
      if (savedState) {
        if (this.props.onFilterChange != null) {
          this.props.onFilterChange(savedState.filters);
        }
        if (defaultFilters != null) {
          const savedStateFilters = savedState.filters;
          defaultFilters.forEach(defaultFilter => {
            const filterIndex = savedStateFilters.findIndex(
              f => f.key === defaultFilter.key,
            );
            if (filterIndex > -1) {
              const defaultFilter: Filter = defaultFilters[filterIndex];
              if (defaultFilter.type === 'enum') {
                savedStateFilters[filterIndex].enum = defaultFilter.enum;
              }
              const filters = new Set(
                savedStateFilters[filterIndex].enum.map(filter => filter.value),
              );
              savedStateFilters[filterIndex].value = savedStateFilters[
                filterIndex
              ].value.filter(value => filters.has(value));
            }
          });
        }
        this.setState({
          searchTerm: savedState.searchTerm || '',
          filters: savedState.filters || [],
        });
      }
    }

    componentDidUpdate(prevProps: Props, prevState: State) {
      if (
        this.context.plugin &&
        (prevState.searchTerm !== this.state.searchTerm ||
          prevState.filters !== this.state.filters)
      ) {
        let key = this.context.plugin + this.props.tableKey;
        window.localStorage.setItem(
          SEARCHABLE_STORAGE_KEY(key),
          JSON.stringify({
            searchTerm: this.state.searchTerm,
            filters: this.state.filters,
          }),
        );
        if (this.props.onFilterChange != null) {
          this.props.onFilterChange(this.state.filters);
        }
      }
    }

    componentWillUnmount() {
      window.document.removeEventListener('keydown', this.onKeyDown);
    }

    onKeyDown = (e: SyntheticKeyboardEvent<>) => {
      const ctrlOrCmd = e =>
        (e.metaKey && process.platform === 'darwin') ||
        (e.ctrlKey && process.platform !== 'darwin');

      if (e.key === 'f' && ctrlOrCmd(e) && this._inputRef) {
        e.preventDefault();
        if (this._inputRef) {
          this._inputRef.focus();
        }
      } else if (e.key === 'Escape' && this._inputRef) {
        this._inputRef.blur();
        this.setState({searchTerm: ''});
      } else if (e.key === 'Backspace' && this.hasFocus()) {
        if (
          this.state.focusedToken === -1 &&
          this.state.searchTerm === '' &&
          this._inputRef &&
          !this.state.filters[this.state.filters.length - 1].persistent
        ) {
          this._inputRef.blur();
          this.setState({focusedToken: this.state.filters.length - 1});
        } else {
          this.removeFilter(this.state.focusedToken);
        }
      } else if (
        e.key === 'Delete' &&
        this.hasFocus() &&
        this.state.focusedToken > -1
      ) {
        this.removeFilter(this.state.focusedToken);
      } else if (e.key === 'Enter' && this.hasFocus() && this._inputRef) {
        this.matchTags(this._inputRef.value, true);
      }
    };

    onChangeSearchTerm = (e: SyntheticInputEvent<HTMLInputElement>) =>
      this.matchTags(e.target.value, false);

    matchTags = (searchTerm: string, matchEnd: boolean) => {
      const filterPattern = matchEnd
        ? /([a-z][a-z0-9]*[!]?[:=][^\s]+)($|\s)/gi
        : /([a-z][a-z0-9]*[!]?[:=][^\s]+)\s/gi;
      const match = searchTerm.match(filterPattern);
      if (match && match.length > 0) {
        match.forEach((filter: string) => {
          const separator =
            filter.indexOf(':') > filter.indexOf('=') ? ':' : '=';
          let [key, ...value] = filter.split(separator);
          value = value.join(separator).trim();
          let type = 'include';
          // if value starts with !, it's an exclude filter
          if (value.indexOf('!') === 0) {
            type = 'exclude';
            value = value.substring(1);
          }
          // if key ends with !, it's an exclude filter
          if (key.indexOf('!') === key.length - 1) {
            type = 'exclude';
            key = key.slice(0, -1);
          }
          this.addFilter({
            type,
            key,
            value,
          });
        });

        searchTerm = searchTerm.replace(filterPattern, '');
      }
      this.setState({searchTerm});
    };

    setInputRef = (ref: ?HTMLInputElement) => {
      this._inputRef = ref;
    };

    addFilter = (filter: Filter) => {
      const filterIndex = this.state.filters.findIndex(
        f => f.key === filter.key,
      );
      if (filterIndex > -1) {
        const filters = [...this.state.filters];
        const defaultFilter: Filter = this.props.defaultFilters[filterIndex];
        if (
          defaultFilter != null &&
          defaultFilter.type === 'enum' &&
          filters[filterIndex].type === 'enum'
        ) {
          filters[filterIndex].enum = defaultFilter.enum;
        }
        this.setState({filters});
        // filter for this key already exists
        return;
      }
      // persistent filters are always at the front
      const filters =
        filter.persistent === true
          ? [filter, ...this.state.filters]
          : this.state.filters.concat(filter);
      this.setState({
        filters,
        focusedToken: -1,
      });
    };

    removeFilter = (index: number) => {
      const filters = this.state.filters.filter((_, i) => i !== index);
      const focusedToken = -1;
      this.setState({filters, focusedToken}, () => {
        if (this._inputRef) {
          this._inputRef.focus();
        }
      });
    };

    replaceFilter = (index: number, filter: Filter) => {
      const filters = [...this.state.filters];
      filters.splice(index, 1, filter);
      this.setState({filters});
    };

    onInputFocus = () =>
      this.setState({
        focusedToken: -1,
        hasFocus: true,
      });

    onInputBlur = () =>
      setTimeout(
        () =>
          this.setState({
            hasFocus: false,
          }),
        100,
      );

    onTokenFocus = (focusedToken: number) => this.setState({focusedToken});

    onTokenBlur = () => this.setState({focusedToken: -1});

    hasFocus = (): boolean => {
      return this.state.focusedToken !== -1 || this.state.hasFocus;
    };

    clear = () =>
      this.setState({
        filters: this.state.filters.filter(
          f => f.persistent != null && f.persistent === true,
        ),
        searchTerm: '',
      });

    render(): React.Node {
      const {placeholder, actions, ...props} = this.props;
      return [
        <SearchBar position="top" key="searchbar">
          <SearchBox tabIndex={-1}>
            <SearchIcon
              name="magnifying-glass"
              color={colors.macOSTitleBarIcon}
              size={16}
            />
            {this.state.filters.map((filter, i) => (
              <FilterToken
                key={`${filter.key}:${filter.type}`}
                index={i}
                filter={filter}
                focused={i === this.state.focusedToken}
                onFocus={this.onTokenFocus}
                onDelete={this.removeFilter}
                onReplace={this.replaceFilter}
                onBlur={this.onTokenBlur}
              />
            ))}
            <SearchInput
              placeholder={placeholder}
              onChange={this.onChangeSearchTerm}
              value={this.state.searchTerm}
              innerRef={this.setInputRef}
              onFocus={this.onInputFocus}
              onBlur={this.onInputBlur}
            />
            {(this.state.searchTerm || this.state.filters.length > 0) && (
              <Clear onClick={this.clear}>&times;</Clear>
            )}
          </SearchBox>
          {actions != null && <Actions>{actions}</Actions>}
        </SearchBar>,
        <Component
          {...props}
          key="table"
          addFilter={this.addFilter}
          searchTerm={this.state.searchTerm}
          filters={this.state.filters}
        />,
      ];
    }
  };

export default Searchable;
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type {ManagedTableProps, TableBodyRow, Filter} from 'sonar';
import type {SearchableProps} from './Searchable.js';
import {PureComponent} from 'react';
import ManagedTable from '../table/ManagedTable.js';

import textContent from '../../../utils/textContent.js';
import Searchable from './Searchable.js';
import deepEqual from 'deep-equal';

type Props = {|
  ...ManagedTableProps,
  ...SearchableProps,
  innerRef?: (ref: React.ElementRef<*>) => void,
  defaultFilters: Array<Filter>,
  filter: empty,
  filterValue: empty,
|};

type State = {
  filterRows: (row: TableBodyRow) => boolean,
};

const filterRowsFactory = (filters: Array<Filter>, searchTerm: string) => (
  row: TableBodyRow,
): boolean =>
  filters
    .map((filter: Filter) => {
      if (filter.type === 'enum' && row.type != null) {
        return filter.value.length === 0 || filter.value.indexOf(row.type) > -1;
      } else if (filter.type === 'include') {
        return (
          textContent(row.columns[filter.key].value).toLowerCase() ===
          filter.value.toLowerCase()
        );
      } else if (filter.type === 'exclude') {
        return (
          textContent(row.columns[filter.key].value).toLowerCase() !==
          filter.value.toLowerCase()
        );
      } else {
        return true;
      }
    })
    .reduce((acc, cv) => acc && cv, true) &&
  (searchTerm != null && searchTerm.length > 0
    ? Object.keys(row.columns)
        .map(key => textContent(row.columns[key].value))
        .join('~~') // prevent from matching text spanning multiple columns
        .toLowerCase()
        .includes(searchTerm.toLowerCase())
    : true);

class SearchableManagedTable extends PureComponent<Props, State> {
  static defaultProps = {
    defaultFilters: [],
  };

  state = {
    filterRows: filterRowsFactory(this.props.filters, this.props.searchTerm),
  };

  componentDidMount() {
    this.props.defaultFilters.map(this.props.addFilter);
  }

  componentWillReceiveProps(nextProps: Props) {
    // ManagedTable is a PureComponent and does not update when this.filterRows
    // would return a different value. This is why we update the funtion reference
    // once the results of the function changed.
    if (
      nextProps.searchTerm !== this.props.searchTerm ||
      !deepEqual(this.props.filters, nextProps.filters)
    ) {
      this.setState({
        filterRows: filterRowsFactory(nextProps.filters, nextProps.searchTerm),
      });
    }
  }

  render() {
    const {
      addFilter,
      searchTerm: _searchTerm,
      filters: _filters,
      innerRef,
      ...props
    } = this.props;
    return (
      // $FlowFixMe
      <ManagedTable
        {...props}
        filter={this.state.filterRows}
        onAddFilter={addFilter}
        ref={innerRef}
      />
    );
  }
}

export default Searchable(SearchableManagedTable);
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type {
  TableColumnRawOrder,
  TableColumnOrder,
  TableColumnSizes,
  TableColumns,
  TableHighlightedRows,
  TableRowSortOrder,
  TableRows,
  TableBodyRow,
  TableOnAddFilter,
} from './types.js';
import styled from '../../styled/index.js';
import Table from './Table.js';

export type ManagedTableProps = {|
  /**
   * Column definitions.
   */
  columns: TableColumns,
  /**
   * Row definitions.
   */
  rows: TableRows,
  /**
   * Whether to use a virtual list. Items visible in the viewport are the only
   * included in the DOM. This can have a noticable performance improvement.
   */
  virtual?: boolean,
  /**
   * Whether the table has a border.
   */
  floating?: boolean,
  /**
   * Whether a row can span over multiple lines. Otherwise lines cannot wrap and
   * are truncated.
   */
  multiline?: boolean,
  /**
   * Whether the body is scrollable. When this is set to `true` then the table
   * is not scrollable.
   */
  autoHeight?: boolean,
  /**
   * Order of columns.
   */
  columnOrder?: ?TableColumnRawOrder,
  /**
   * Size of the columns.
   */
  columnSizes?: TableColumnSizes,
  /**
   * Value to filter rows on. Alternative to the `filter` prop.
   */
  filterValue?: string,
  /**
   * Callback to filter rows.
   */
  filter?: (row: TableBodyRow) => boolean,
  /**
   * Callback when the highlighted rows change.
   */
  onRowHighlighted?: (keys: TableHighlightedRows) => void,
  /**
   * Whether rows can be highlighted or not.
   */
  highlightableRows?: boolean,
  /**
   * Whether multiple rows can be highlighted or not.
   */
  multiHighlight?: boolean,
  /**
   * Height of each row.
   */
  rowLineHeight?: number,
  /**
   * This makes it so the scroll position sticks to the bottom of the window.
   * Useful for streaming data like requests, logs etc.
   */
  stickyBottom?: boolean,
  /**
   * Used by SearchableTable to add filters for rows
   */
  onAddFilter?: TableOnAddFilter,
  /**
   * Enable or disable zebra striping
   */
  zebra?: boolean,
  /**
   * Whether to hide the column names at the top of the table.
   */
  hideHeader?: boolean,
|};

type ManagedTableState = {|
  highlightedRows: TableHighlightedRows,
  sortOrder: ?TableRowSortOrder,
  columnOrder: ?TableColumnRawOrder,
  columnSizes: ?TableColumnSizes,
|};

/**
 * Wrapper around `Table` that handles row state.
 *
 * If you require lower level access to the state then use [`<Table>`]()
 * directly.
 */
export default class ManagedTable extends styled.StylablePureComponent<
  ManagedTableProps,
  ManagedTableState,
> {
  getTableKey = (): string => {
    return (
      'TABLE_COLUMNS_' +
      Object.keys(this.props.columns)
        .join('_')
        .toUpperCase()
    );
  };

  state = {
    columnOrder:
      JSON.parse(window.localStorage.getItem(this.getTableKey()) || 'null') ||
      this.props.columnOrder,
    columnSizes: this.props.columnSizes,
    highlightedRows: [],
    sortOrder: null,
  };

  tableRef: ?Table;

  componentWillReceiveProps(nextProps: ManagedTableProps) {
    // if columnSizes has changed
    if (nextProps.columnSizes !== this.props.columnSizes) {
      this.setState({
        columnSizes: {
          ...(this.state.columnSizes || {}),
          ...nextProps.columnSizes,
        },
      });
    }

    // if columnOrder has changed
    if (nextProps.columnOrder !== this.props.columnOrder) {
      this.setState({
        columnOrder: nextProps.columnOrder,
      });
    }
  }

  onHighlight = (highlightedRows: TableHighlightedRows) => {
    if (this.props.highlightableRows === false) {
      return;
    }
    if (this.props.multiHighlight !== true) {
      highlightedRows = highlightedRows.slice(0, 1);
    }

    this.setState({highlightedRows});

    if (this.props.onRowHighlighted) {
      this.props.onRowHighlighted(highlightedRows);
    }
  };

  onSort = (sortOrder: TableRowSortOrder) => {
    this.setState({sortOrder});
  };

  onColumnOrder = (columnOrder: TableColumnOrder) => {
    // $FlowFixMe
    this.setState({columnOrder});
    // persist column order
    window.localStorage.setItem(
      this.getTableKey(),
      JSON.stringify(columnOrder),
    );
  };

  onColumnResize = (columnSizes: TableColumnSizes) => {
    this.setState({columnSizes});
  };

  setRef = (table: ?Table) => {
    this.tableRef = table;
  };

  scrollToBottom() {
    const {tableRef} = this;
    if (tableRef) {
      tableRef.scrollToBottom();
    }
  }

  render() {
    const {props, state} = this;

    return (
      <Table
        ref={this.setRef}
        virtual={props.virtual}
        floating={props.floating}
        multiline={props.multiline}
        columns={props.columns}
        rows={props.rows}
        rowLineHeight={props.rowLineHeight}
        autoHeight={props.autoHeight}
        filter={props.filter}
        filterValue={props.filterValue}
        highlightedRows={state.highlightedRows}
        onHighlight={this.onHighlight}
        sortOrder={state.sortOrder}
        onSort={this.onSort}
        columnOrder={state.columnOrder}
        onColumnOrder={this.onColumnOrder}
        columnSizes={state.columnSizes}
        onColumnResize={this.onColumnResize}
        stickyBottom={props.stickyBottom}
        onAddFilter={props.onAddFilter}
        zebra={props.zebra}
        hideHeader={props.hideHeader}
      />
    );
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type {
  TableColumnRawOrder,
  TableColumnKeys,
  TableColumnOrder,
  TableColumnSizes,
  TableColumns,
  TableHighlightedRows,
  TableOnColumnOrder,
  TableOnColumnResize,
  TableOnHighlight,
  TableOnSort,
  TableRowSortOrder,
  TableBodyRow,
  TableRows,
  TableOnAddFilter,
} from './types.js';
import {PureComponent} from 'react';
import FlexColumn from '../FlexColumn.js';
import TableHead from './TableHead.js';
import TableBody from './TableBody.js';
import FlexBox from '../FlexBox.js';
import createPaste from '../../../utils/createPaste.js';
import textContent from '../../../utils/textContent.js';
import {clipboard} from 'electron';

const TableInner = FlexColumn.extends(
  {
    minWidth: props => props.minWidth || '0',
    position: 'relative',
    width: '100%',
  },
  {
    ignoreAttributes: ['minWidth'],
  },
);

const TableOuter = FlexBox.extends(
  {
    width: '100%',
    backgroundColor: '#fff',
    border: props => (props.floating ? '1px solid #c9ced4' : 'none'),
    borderRadius: props => (props.floating ? 2 : 'none'),
    height: props => (props.autoHeight ? 'auto' : '100%'),
    overflow: props => (props.autoHeight ? 'visible' : 'auto'),
  },
  {
    ignoreAttributes: ['floating', 'autoHeight'],
  },
);

function getColumnOrder(
  colOrder: ?TableColumnRawOrder,
  cols: TableColumns,
): TableColumnOrder {
  // we have a specific column order, let's validate it
  if (colOrder) {
    const computedOrder = [];
    for (const obj of colOrder) {
      if (typeof obj === 'string') {
        computedOrder.push({key: obj, visible: true});
      } else {
        computedOrder.push(obj);
      }
    }
    return computedOrder;
  }

  // produce a column order
  const keys = Object.keys(cols);
  const computedOrder = [];
  for (const key of keys) {
    computedOrder.push({key, visible: true});
  }
  return computedOrder;
}

const sortedBodyCache: WeakMap<
  TableRows,
  {
    sortOrder: TableRowSortOrder,
    rows: TableRows,
  },
> = new WeakMap();
function getSortedRows(
  maybeSortOrder: ?TableRowSortOrder,
  rows: TableRows,
): TableRows {
  if (!maybeSortOrder) {
    return rows;
  }

  const sortOrder: TableRowSortOrder = maybeSortOrder;

  const cached = sortedBodyCache.get(rows);
  if (cached && cached.sortOrder === sortOrder) {
    return cached.rows;
  }

  let sortedRows = rows.sort((a, b) => {
    const aVal = a.columns[sortOrder.key].sortValue;
    const bVal = b.columns[sortOrder.key].sortValue;

    if (typeof aVal === 'string' && typeof bVal === 'string') {
      return aVal.localeCompare(bVal);
    } else if (typeof aVal === 'number' && typeof bVal === 'number') {
      return aVal - bVal;
    } else {
      throw new Error('Unsure how to sort this');
    }
  });

  if (sortOrder.direction === 'up') {
    sortedRows = sortedRows.reverse();
  }

  sortedBodyCache.set(rows, {
    rows: sortedRows,
    sortOrder,
  });

  return sortedRows;
}

const getRowsInRange = (
  from: string,
  to: string,
  rows: TableRows,
): TableHighlightedRows => {
  let fromFound = false;
  let toFound = false;
  const range = [];
  if (from === to) {
    return [from];
  }
  for (const {key} of rows) {
    if (key === from) {
      fromFound = true;
    } else if (key === to) {
      toFound = true;
    }

    if (fromFound && !toFound) {
      // range going downwards
      range.push(key);
    } else if (toFound && !fromFound) {
      // range going upwards
      range.unshift(key);
    } else if (fromFound && toFound) {
      // add last item
      if (key === from) {
        range.unshift(key);
      } else {
        range.push(key);
      }
      // we're done
      break;
    }
  }
  return range;
};

const filterRows = (
  rows: TableRows,
  filterValue: ?string,
  filter: ?(row: TableBodyRow) => boolean,
): TableRows => {
  // check that we don't have a filter
  const hasFilterValue = filterValue !== '' && filterValue != null;
  const hasFilter = hasFilterValue || typeof filter === 'function';
  if (!hasFilter) {
    return rows;
  }

  let filteredRows = [];

  if (hasFilter) {
    for (const row of rows) {
      let keep = false;

      // check if this row's filterValue contains the current filter
      if (filterValue != null && row.filterValue != null) {
        keep = row.filterValue.includes(filterValue);
      }

      // call filter() prop
      if (keep === false && typeof filter === 'function') {
        keep = filter(row);
      }

      if (keep) {
        filteredRows.push(row);
      }
    }
  } else {
    filteredRows = rows;
  }

  return filteredRows;
};

type TableProps = {|
  /**
   * Column definitions.
   */
  columns: TableColumns,
  /**
   * Row definitions.
   */
  rows: TableRows,

  /**
   * Minimum width of the table. If the table is sized smaller than this then
   * it's scrollable.
   */
  minWidth?: number,

  /**
   * Whether to use a virtual list. Items visible in the viewport are the only
   * included in the DOM. This can have a noticable performance improvement.
   */
  virtual?: boolean,
  /**
   * Whether the table has a border.
   */
  floating?: boolean,
  /**
   * Whether a row can span over multiple lines. Otherwise lines cannot wrap and
   * are truncated.
   */
  multiline?: boolean,
  /**
   * Height of each row.
   */
  rowLineHeight?: number,
  /**
   * Whether the body is scrollable. When this is set to `true` then the table
   * is not scrollable.
   */
  autoHeight?: boolean,
  /**
   * Highlighted rows.
   */
  highlightedRows?: ?TableHighlightedRows,
  /**
   * Callback when the highlighted rows change.
   */
  onHighlight?: ?TableOnHighlight,
  /**
   * Enable or disable zebra striping
   */
  zebra?: boolean,
  /**
   * Value to filter rows on. Alternative to the `filter` prop.
   */
  filterValue?: string,
  /**
   * Callback to filter rows.
   */
  filter?: (row: TableBodyRow) => boolean,

  /**
   * Sort order.
   */
  sortOrder?: ?TableRowSortOrder,
  /**
   * Callback when the sort order changes.
   */
  onSort?: ?TableOnSort,

  /**
   * Order of columns.
   */
  columnOrder?: ?TableColumnRawOrder,
  /**
   * Callback when a column is reordered or visibility changed.
   */
  onColumnOrder?: ?TableOnColumnOrder,

  /**
   * Size of the columns.
   */
  columnSizes?: ?TableColumnSizes,
  /**
   * Callback for when a column size changes.
   */
  onColumnResize?: ?TableOnColumnResize,
  /**
   * This makes it so the scroll position sticks to the bottom of the window.
   * Useful for streaming data like requests, logs etc.
   */
  stickyBottom?: ?boolean,
  /**
   * Used by SearchableTable to add filters for rows.
   */
  onAddFilter?: TableOnAddFilter,
  /**
   * Whether to hide the column names at the top of the table.
   */
  hideHeader?: boolean,
|};

type TableState = {
  columnOrder: TableColumnOrder,
  columnSizes: TableColumnSizes,
  columnKeys: TableColumnKeys,
  sortedRows: TableRows,
  dragStartingKey?: ?string,
};

const NO_COLUMN_SIZE: TableColumnSizes = {};

/**
 * A table component with all the native features you would expect.
 *
 *  - Row sorting
 *  - Row filtering
 *  - Row highlight
 *  - Row keyboard navigation
 *  - Column reordering
 *  - Column visibility
 *
 * This component is fairly low level. It's likely you're looking for
 * [`<ManagedTable>`]().
 */
export default class Table extends PureComponent<TableProps, TableState> {
  constructor(props: TableProps, context: Object) {
    super(props, context);
    this.state = this.deriveState(props);
  }

  static defaultProps = {
    floating: true,
    virtual: true,
  };

  componentDidMount() {
    // listning to mouseUp event on document to catch events even when
    // the cursor moved outside the table while dragging
    document.addEventListener('mouseup', this.onMouseUp);
  }

  componentWillUnmount() {
    document.removeEventListener('mouseup', this.onMouseUp);
  }

  deriveState(props: TableProps): TableState {
    const columnSizes: TableColumnSizes = props.columnSizes || NO_COLUMN_SIZE;
    const columnOrder: TableColumnOrder = getColumnOrder(
      props.columnOrder,
      props.columns,
    );

    let columnKeys;
    if (this.state && this.state.columnOrder === columnOrder) {
      columnKeys = this.state.columnKeys;
    } else {
      columnKeys = [];
      for (const {key, visible} of columnOrder) {
        if (visible) {
          columnKeys.push(key);
        }
      }
    }

    let sortedRows = [];
    if (
      !this.state ||
      this.props.filter !== props.filter ||
      this.props.filterValue !== props.filterValue ||
      this.props.sortOrder !== props.sortOrder ||
      this.props.rows !== props.rows
    ) {
      // need to reorder or refilter the rows
      sortedRows = getSortedRows(
        props.sortOrder,
        filterRows(props.rows, props.filterValue, props.filter),
      );
    } else {
      sortedRows = this.state.sortedRows;
    }

    return {
      columnKeys,
      columnOrder,
      columnSizes,
      sortedRows,
    };
  }

  componentWillReceiveProps(nextProps: TableProps) {
    this.setState(this.deriveState(nextProps));
  }

  onMouseUp = () => this.setState({dragStartingKey: null});

  onKeyDown = (e: SyntheticKeyboardEvent<HTMLElement>) => {
    const {onHighlight, highlightedRows} = this.props;
    const {sortedRows} = this.state;
    const currentlyHighlightedRows = highlightedRows || [];
    let selectedRow: ?string;

    if (e.key === 'ArrowUp' || e.key === 'ArrowDown') {
      e.preventDefault();
      if (currentlyHighlightedRows.length === 0) {
        // no selection yet
        const index = e.key === 'ArrowUp' ? sortedRows.length - 1 : 0;
        selectedRow = sortedRows[index].key;
      } else {
        // determine sibling row to select
        const prevRowFinder = (row, index) =>
          index < sortedRows.length - 1
            ? sortedRows[index + 1].key ===
              currentlyHighlightedRows[currentlyHighlightedRows.length - 1]
            : false;

        const nextRowFinder = (row, index) =>
          index > 0
            ? sortedRows[index - 1].key ===
              currentlyHighlightedRows[currentlyHighlightedRows.length - 1]
            : false;

        const siblingRow = sortedRows.find(
          e.key === 'ArrowUp' ? prevRowFinder : nextRowFinder,
        );
        if (siblingRow) {
          selectedRow = siblingRow.key;
        }
      }

      if (onHighlight && selectedRow != null) {
        // scroll into view
        const index = sortedRows.findIndex(row => row.key === selectedRow);
        if (this.tableBodyRef && index) {
          this.tableBodyRef.scrollRowIntoView(index);
        }

        if (e.shiftKey) {
          onHighlight(
            currentlyHighlightedRows
              .filter(row => selectedRow !== row)
              .concat([selectedRow]),
            e,
          );
        } else {
          onHighlight([selectedRow], e);
        }
      }
    } else if (
      highlightedRows &&
      e.key === 'c' &&
      ((e.metaKey && process.platform === 'darwin') ||
        (e.ctrlKey && process.platform !== 'darwin'))
    ) {
      e.preventDefault();
      this.onCopyRows();
    }
  };

  getRowText = (): string => {
    const {highlightedRows} = this.props;
    const {sortedRows} = this.state;
    const visibleColums = this.state.columnOrder
      .filter(({visible}) => visible)
      .map(({key}) => key);

    const rows =
      !highlightedRows || highlightedRows.length === 0
        ? sortedRows
        : sortedRows.filter(row => highlightedRows.indexOf(row.key) > -1);

    return rows
      .map(
        row =>
          row.copyText != null
            ? row.copyText
            : visibleColums
                .map(col => textContent(row.columns[col].value))
                .filter(Boolean)
                .join('\t'),
      )
      .join('\n');
  };

  onCopyRows = () => {
    clipboard.writeText(this.getRowText());
  };

  onCreatePaste = () => {
    createPaste(this.getRowText());
  };

  onHighlight = (
    newHighlightedRows: TableHighlightedRows,
    e: SyntheticKeyboardEvent<*>,
  ) => {
    const {onHighlight, highlightedRows} = this.props;
    if (!onHighlight) {
      return;
    }
    if (e.shiftKey === true && highlightedRows && highlightedRows.length > 0) {
      const from = highlightedRows[highlightedRows.length - 1];
      const to = newHighlightedRows[0];
      const range = getRowsInRange(from, to, this.state.sortedRows);
      newHighlightedRows = highlightedRows
        .filter(key => range.indexOf(key) === -1)
        .concat(range);
    } else {
      this.setState({dragStartingKey: newHighlightedRows[0]});
    }

    onHighlight(newHighlightedRows, e);
  };

  onDragSelect = (e: SyntheticMouseEvent<>, key: string, index: number) => {
    const {dragStartingKey, sortedRows} = this.state;
    const {onHighlight} = this.props;
    if (dragStartingKey != null && onHighlight != null) {
      const range = getRowsInRange(dragStartingKey, key, this.state.sortedRows);
      if (this.tableBodyRef) {
        const startIndex = sortedRows.findIndex(
          row => row.key === dragStartingKey,
        );
        const nextIndex = startIndex < index ? index + 1 : index - 1;
        // only scroll one row every 100ms to not scroll to the end of the table immediatelly
        setTimeout(
          () =>
            this.tableBodyRef && this.tableBodyRef.scrollRowIntoView(nextIndex),
          100,
        );
      }
      onHighlight(range, e);
    }
  };

  scrollToBottom() {
    const {tableBodyRef} = this;
    if (tableBodyRef) {
      tableBodyRef.scrollToBottom();
    }
  }

  tableBodyRef: ?TableBody;

  setTableBodyRef = (ref: ?TableBody) => {
    this.tableBodyRef = ref;
  };

  render() {
    const {props, state} = this;

    const tableHead =
      props.hideHeader === true ? null : (
        <TableHead
          columnOrder={state.columnOrder}
          onColumnOrder={props.onColumnOrder}
          columnKeys={state.columnKeys}
          columns={props.columns}
          sortOrder={props.sortOrder}
          onSort={props.onSort}
          columnSizes={state.columnSizes}
          onColumnResize={props.onColumnResize}
        />
      );

    return (
      <TableOuter
        floating={props.floating}
        autoHeight={props.autoHeight}
        onKeyDown={this.onKeyDown}
        tabIndex={0}>
        <TableInner minWidth={props.minWidth}>
          {tableHead}

          <TableBody
            ref={this.setTableBodyRef}
            virtual={props.virtual}
            filter={props.filter}
            filterValue={props.filterValue}
            autoHeight={props.autoHeight}
            rowLineHeight={props.rowLineHeight}
            multiline={props.multiline}
            onHighlight={this.onHighlight}
            highlightedRows={props.highlightedRows}
            columnKeys={state.columnKeys}
            rows={state.sortedRows}
            columnSizes={state.columnSizes}
            stickyBottom={props.stickyBottom}
            isDragging={Boolean(state.dragStartingKey)}
            zebra={props.zebra}
            onDragSelect={this.onDragSelect}
            onCopyRows={this.onCopyRows}
            onCreatePaste={this.onCreatePaste}
            onAddFilter={props.onAddFilter}
          />
        </TableInner>
      </TableOuter>
    );
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type {
  TableBodyRow,
  TableColumnKeys,
  TableColumnSizes,
  TableHighlightedRows,
  TableOnDragSelect,
  TableOnHighlight,
  TableRows,
  TableOnAddFilter,
} from './types.js';
import {FixedList, DynamicList} from '../../../ui/virtualized/index.js';
import {normaliseColumnWidth} from './utils.js';
import {PureComponent} from 'react';

import FilterRow from '../filter/FilterRow.js';
import {DEFAULT_ROW_HEIGHT} from './types.js';
import styled from '../../styled/index.js';
import FlexColumn from '../FlexColumn.js';
import {ContextMenu} from 'sonar';

import FlexRow from '../FlexRow.js';
import {colors} from '../colors.js';

const TableBodyContainer = FlexColumn.extends(
  {
    backgroundColor: colors.white,
    zIndex: 1,
    flexGrow: props => (props.autoHeight ? 0 : 1),
    flexShrink: props => (props.autoHeight ? 0 : 1),
    flexBasis: props => (props.autoHeight ? 'content' : 0),
    overflow: props => (props.autoHeight ? 'hidden' : 'auto'),
    maxWidth: '100%',
  },
  {
    ignoreAttributes: ['autoHeight'],
  },
);

const TableBodyRowContainer = FlexRow.extends(
  {
    backgroundColor: props => {
      if (props.highlighted) {
        if (props.highlightedBackgroundColor) {
          return props.highlightedBackgroundColor;
        } else {
          return colors.macOSTitleBarIconSelected;
        }
      } else {
        if (props.backgroundColor) {
          return props.backgroundColor;
        } else if (props.even && props.zebra) {
          return colors.light02;
        } else {
          return 'transparent';
        }
      }
    },
    boxShadow: props => {
      if (props.backgroundColor || props.zebra === false) {
        return 'inset 0 -1px #E9EBEE';
      } else {
        return 'none';
      }
    },
    color: props =>
      props.highlighted ? colors.white : props.color || 'inherit',
    '& *': {
      color: props => (props.highlighted ? `${colors.white} !important` : null),
    },
    '& img': {
      backgroundColor: props =>
        props.highlighted ? `${colors.white} !important` : 'none',
    },
    height: props => (props.multiline ? 'auto' : props.rowLineHeight),
    lineHeight: props => `${String(props.rowLineHeight)}px`,
    fontWeight: props => props.fontWeight || 'inherit',
    overflow: 'hidden',
    width: '100%',
    userSelect: 'none',
    flexShrink: 0,
    '&:hover': {
      backgroundColor: props =>
        !props.highlighted && props.highlightOnHover ? colors.light02 : 'none',
    },
  },
  {
    ignoreAttributes: [
      'highlightedBackgroundColor',
      'highlightOnHover',
      'backgroundColor',
      'rowLineHeight',
      'highlighted',
      'multiline',
      'hasHover',
      'zebra',
      'even',
    ],
  },
);

const TableBodyColumnContainer = styled.view(
  {
    display: 'flex',
    flexShrink: props => (props.width === 'flex' ? 1 : 0),
    overflow: 'hidden',
    padding: '0 8px',
    userSelect: 'none',
    textOverflow: 'ellipsis',
    verticalAlign: 'top',
    whiteSpace: props => (props.multiline ? 'normal' : 'nowrap'),
    wordWrap: props => (props.multiline ? 'break-word' : 'normal'),
    width: props => (props.width === 'flex' ? '100%' : props.width),
    maxWidth: '100%',
  },
  {
    ignoreAttributes: ['multiline', 'width'],
  },
);

type TableBodyRowElementProps = {
  columnSizes: TableColumnSizes,
  columnKeys: TableColumnKeys,
  onHighlight: ?TableOnHighlight,
  onMouseEnter?: (e: SyntheticMouseEvent<>) => void,
  multiline: ?boolean,
  rowLineHeight: number,
  highlightedRows: ?TableHighlightedRows,
  row: TableBodyRow,
  columnNo: number,
  style: ?Object,
  onCopyRows: () => void,
  onCreatePaste: () => void,
  onAddFilter?: TableOnAddFilter,
  zebra: ?boolean,
};

type TableBodyRowElementState = {
  contextMenu: any,
};

class TableBodyRowElement extends PureComponent<
  TableBodyRowElementProps,
  TableBodyRowElementState,
> {
  static defaultProps = {
    zebra: true,
  };

  onMouseDown = (e: SyntheticMouseEvent<>) => {
    if (e.button !== 0) {
      // Only highlight rows when using primary mouse button,
      // otherwise do nothing, to not interfere context menus.
      return;
    }
    if (e.shiftKey) {
      // prevents text selection
      e.preventDefault();
    }

    const {highlightedRows, onHighlight, row} = this.props;
    if (!onHighlight) {
      return;
    }

    let newHighlightedRows = highlightedRows ? highlightedRows.slice() : [];
    const alreadyHighlighted = newHighlightedRows.includes(row.key);
    if (
      (e.metaKey && process.platform === 'darwin') ||
      (e.ctrlKey && process.platform !== 'darwin')
    ) {
      if (alreadyHighlighted) {
        newHighlightedRows.splice(newHighlightedRows.indexOf(row.key), 1);
      } else {
        newHighlightedRows.push(row.key);
      }
    } else {
      newHighlightedRows = [row.key];
    }
    onHighlight(newHighlightedRows, e);
  };

  getContextMenu = () => {
    const {highlightedRows, onCopyRows, onCreatePaste} = this.props;
    return [
      {
        label:
          highlightedRows && highlightedRows.length > 1
            ? `Copy ${highlightedRows.length} items`
            : 'Copy all',
        click: onCopyRows,
      },
      {
        label:
          highlightedRows && highlightedRows.length > 1
            ? `Create paste from selection`
            : 'Create paste',
        click: onCreatePaste,
      },
    ];
  };

  render() {
    const {
      columnNo,
      highlightedRows,
      rowLineHeight,
      row,
      style,
      multiline,
      columnKeys,
      columnSizes,
      onMouseEnter,
      zebra,
    } = this.props;

    return (
      <ContextMenu buildItems={this.getContextMenu}>
        <TableBodyRowContainer
          rowLineHeight={rowLineHeight}
          highlightedBackgroundColor={row.highlightedBackgroundColor}
          backgroundColor={row.backgroundColor}
          highlighted={highlightedRows && highlightedRows.includes(row.key)}
          onDoubleClick={row.onDoubleClick}
          multiline={multiline}
          even={columnNo % 2 === 0}
          zebra={zebra}
          onMouseDown={this.onMouseDown}
          onMouseEnter={onMouseEnter}
          style={style}
          highlightOnHover={row.highlightOnHover}
          data-key={row.key}
          {...row.style}>
          {columnKeys.map(key => {
            const col = row.columns[key];
            if (col == null) {
              throw new Error(
                `Trying to access column "${key}" which does not exist on row. Make sure buildRow is returning a valid row.`,
              );
            }
            const isFilterable = col.isFilterable || false;
            const value = col ? col.value : '';
            const title = col ? col.title : '';
            return (
              <TableBodyColumnContainer
                key={key}
                title={title}
                multiline={multiline}
                width={normaliseColumnWidth(columnSizes[key])}>
                {isFilterable && this.props.onAddFilter != null ? (
                  <FilterRow addFilter={this.props.onAddFilter} filterKey={key}>
                    {value}
                  </FilterRow>
                ) : (
                  value
                )}
              </TableBodyColumnContainer>
            );
          })}
        </TableBodyRowContainer>
      </ContextMenu>
    );
  }
}

type TableBodyProps = {
  virtual: ?boolean,
  autoHeight: ?boolean,
  multiline: ?boolean,
  rowLineHeight: number,
  stickyBottom: ?boolean,
  zebra?: boolean,

  onHighlight: ?TableOnHighlight,
  highlightedRows: ?TableHighlightedRows,

  columnKeys: TableColumnKeys,
  columnSizes: TableColumnSizes,

  rows: TableRows,

  filterValue?: string,
  filter?: (row: TableBodyRow) => boolean,

  isDragging: boolean,
  onDragSelect: TableOnDragSelect,
  onCopyRows: () => void,
  onCreatePaste: () => void,
  onAddFilter?: TableOnAddFilter,
};

type TableBodyState = {
  atScrollBottom: boolean,
  pureBodyData: Array<any>,
};

export default class TableBody extends PureComponent<
  TableBodyProps,
  TableBodyState,
> {
  static defaultProps = {
    rowLineHeight: DEFAULT_ROW_HEIGHT,
  };

  state = {
    atScrollBottom: true,
    pureBodyData: [
      this.props.columnSizes,
      this.props.rows,
      this.props.highlightedRows,
    ],
  };

  listRef: ?DynamicList;
  scrollRef: ?any;
  keepSelectedRowInView: ?[number, number];

  buildElement = (
    key: string,
    row: TableBodyRow,
    index: number,
    style?: Object,
  ) => {
    let onMouseEnter;
    if (this.props.isDragging) {
      onMouseEnter = (e: SyntheticMouseEvent<>) =>
        this.props.onDragSelect(e, key, index);
    }
    return (
      <TableBodyRowElement
        key={key}
        columnNo={index}
        rowLineHeight={this.props.rowLineHeight}
        row={row}
        style={style}
        columnSizes={this.props.columnSizes}
        multiline={this.props.multiline}
        columnKeys={this.props.columnKeys}
        highlightedRows={this.props.highlightedRows}
        zebra={this.props.zebra}
        onHighlight={this.props.onHighlight}
        onMouseEnter={onMouseEnter}
        onCopyRows={this.props.onCopyRows}
        onCreatePaste={this.props.onCreatePaste}
        onAddFilter={this.props.onAddFilter}
      />
    );
  };

  buildVirtualElement = ({index, style}: {index: number, style: Object}) => {
    const row = this.props.rows[index];
    return this.buildElement(row.key, row, index, style);
  };

  buildAutoElement = (row: TableBodyRow, index: number) => {
    return this.buildElement(row.key, row, index);
  };

  componentDidMount() {
    this.maybeScrollToBottom();
  }

  componentWillUpdate(nextProps: TableBodyProps) {
    if (
      nextProps.highlightedRows != null &&
      nextProps.highlightedRows.length === 1 &&
      nextProps.filter !== this.props.filter &&
      nextProps.rows.length !== this.props.rows.length &&
      this.listRef != null
    ) {
      // We want to keep the selected row in the view once the filter changes.
      // Here we get the current position, in componentDidUpdate it is scrolled into view
      const {highlightedRows} = nextProps;
      const selectedIndex = nextProps.rows.findIndex(
        row => row.key === highlightedRows[0],
      );
      if (
        nextProps.rows[selectedIndex] != null &&
        nextProps.rows[selectedIndex].key != null
      ) {
        const rowDOMNode = document.querySelector(
          `[data-key="${nextProps.rows[selectedIndex].key}"]`,
        );
        let offset = 0;
        if (
          rowDOMNode != null &&
          rowDOMNode.parentElement instanceof HTMLElement
        ) {
          offset = rowDOMNode.parentElement.offsetTop;
        }
        this.keepSelectedRowInView = [selectedIndex, offset];
      }
    } else {
      this.keepSelectedRowInView = null;
    }
  }

  componentDidUpdate(prevProps: TableBodyProps) {
    if (this.listRef != null && this.keepSelectedRowInView != null) {
      this.listRef.scrollToIndex(...this.keepSelectedRowInView);
    } else {
      this.maybeScrollToBottom();
    }
  }

  maybeScrollToBottom = () => {
    // we only care if we have the stickyBottom prop
    if (this.props.stickyBottom !== true) {
      return;
    }

    // we only want to scroll to the bottom if we're actually at the bottom
    if (this.state.atScrollBottom === false) {
      return;
    }

    this.scrollToBottom();
  };

  scrollToBottom() {
    // only handle non-virtualised scrolling, virtualised scrolling is handled
    // by the getScrollToIndex method
    if (this.isVirtualisedDisabled()) {
      const {scrollRef} = this;
      if (scrollRef != null) {
        scrollRef.scrollTop = scrollRef.scrollHeight;
      }
    } else {
      const {listRef} = this;
      if (listRef != null) {
        listRef.scrollToIndex(this.props.rows.length - 1);
      }
    }
  }

  scrollRowIntoView(index: number) {
    if (
      this.isVirtualisedDisabled() &&
      this.scrollRef &&
      index < this.scrollRef.children.length
    ) {
      this.scrollRef.children[index].scrollIntoViewIfNeeded();
    }
  }

  componentWillReceiveProps(nextProps: TableBodyProps) {
    if (
      nextProps.columnSizes !== this.props.columnSizes ||
      nextProps.rows !== this.props.rows ||
      nextProps.highlightedRows !== this.props.highlightedRows
    ) {
      this.setState({
        pureBodyData: [
          nextProps.columnSizes,
          nextProps.rows,
          nextProps.highlightedRows,
        ],
      });
    }
  }

  setListRef = (ref: ?DynamicList) => {
    this.listRef = ref;
  };

  setNonVirtualScrollRef = (ref: any) => {
    this.scrollRef = ref;
    this.scrollToBottom();
  };

  onScroll = ({
    clientHeight,
    scrollHeight,
    scrollTop,
  }: {
    clientHeight: number,
    scrollHeight: number,
    scrollTop: number,
  }) => {
    // check if the user has scrolled within 20px of the bottom
    const bottom = scrollTop + clientHeight;
    const atScrollBottom = Math.abs(bottom - scrollHeight) < 20;

    if (atScrollBottom !== this.state.atScrollBottom) {
      this.setState({atScrollBottom});
    }
  };

  isVirtualisedDisabled() {
    return this.props.virtual === false || this.props.autoHeight === true;
  }

  keyMapper = (index: number): string => {
    return this.props.rows[index].key;
  };

  getPrecalculatedDimensions = (index: number) => {
    const row = this.props.rows[index];
    if (row != null && row.height != null) {
      return {
        height: row.height,
        width: '100%',
      };
    }
  };

  render() {
    if (this.isVirtualisedDisabled()) {
      return (
        <TableBodyContainer
          innerRef={this.setNonVirtualScrollRef}
          onScroll={this.onScroll}
          autoHeight={true}>
          {this.props.rows.map(this.buildAutoElement)}
        </TableBodyContainer>
      );
    }

    let children;

    if (this.props.multiline === true) {
      // multiline has a virtual list with dynamic heights
      children = (
        <DynamicList
          ref={this.setListRef}
          pureData={this.state.pureBodyData}
          keyMapper={this.keyMapper}
          rowCount={this.props.rows.length}
          rowRenderer={this.buildVirtualElement}
          onScroll={this.onScroll}
          getPrecalculatedDimensions={this.getPrecalculatedDimensions}
          onMount={this.maybeScrollToBottom}
        />
      );
    } else {
      // virtual list with a fixed row height
      children = (
        <FixedList
          pureData={this.state.pureBodyData}
          keyMapper={this.keyMapper}
          rowCount={this.props.rows.length}
          rowHeight={this.props.rowLineHeight}
          rowRenderer={this.buildVirtualElement}
          onScroll={this.onScroll}
          innerRef={this.setListRef}
          onMount={this.maybeScrollToBottom}
        />
      );
    }

    return <TableBodyContainer>{children}</TableBodyContainer>;
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type {
  TableColumnKeys,
  TableColumnOrder,
  TableColumnSizes,
  TableColumns,
  TableOnColumnResize,
  TableOnSort,
  TableRowSortOrder,
} from './types.js';

import {normaliseColumnWidth, isPercentage} from './utils.js';
import {PureComponent} from 'react';
import ContextMenu from '../ContextMenu.js';
import Interactive from '../Interactive.js';
import styled from '../../styled/index.js';
import {colors} from '../colors.js';

import FlexRow from '../FlexRow.js';

const invariant = require('invariant');

const TableHeaderArrow = styled.text({
  float: 'right',
});

const TableHeaderColumnInteractive = Interactive.extends({
  display: 'inline-block',
  overflow: 'hidden',
  textOverflow: 'ellipsis',
  whiteSpace: 'nowrap',
  width: '100%',
});

const TableHeaderColumnContainer = styled.view({
  padding: '0 8px',
});

const TableHeadContainer = FlexRow.extends({
  borderBottom: `1px solid ${colors.sectionHeaderBorder}`,
  color: colors.light50,
  flexShrink: 0,
  left: 0,
  overflow: 'hidden',
  position: 'sticky',
  right: 0,
  textAlign: 'left',
  top: 0,
  zIndex: 2,
});

const TableHeadColumnContainer = styled.view(
  {
    position: 'relative',
    backgroundColor: colors.white,
    flexShrink: props => (props.width === 'flex' ? 1 : 0),
    height: 23,
    lineHeight: '23px',
    fontSize: '0.85em',
    fontWeight: 500,
    width: props => (props.width === 'flex' ? '100%' : props.width),
    '&::after': {
      position: 'absolute',
      content: '""',
      right: 0,
      top: 5,
      height: 13,
      width: 1,
      background: colors.light15,
    },
    '&:last-child::after': {
      display: 'none',
    },
  },
  {
    ignoreAttributes: ['width'],
  },
);

const RIGHT_RESIZABLE = {right: true};

function calculatePercentage(parentWidth: number, selfWidth: number): string {
  return `${(100 / parentWidth) * selfWidth}%`;
}

class TableHeadColumn extends PureComponent<{
  id: string,
  width: string | number,
  sortable: ?boolean,
  isResizable: boolean,
  leftHasResizer: boolean,
  hasFlex: boolean,
  sortOrder: ?TableRowSortOrder,
  onSort: ?TableOnSort,
  columnSizes: TableColumnSizes,
  onColumnResize: ?TableOnColumnResize,
  children?: React$Node,
  title?: string,
}> {
  ref: HTMLElement;

  onClick = () => {
    const {id, onSort, sortOrder} = this.props;

    const direction =
      sortOrder && sortOrder.key === id && sortOrder.direction === 'down'
        ? 'up'
        : 'down';

    if (onSort) {
      onSort({
        direction,
        key: id,
      });
    }
  };

  onResize = (newWidth: number) => {
    const {id, columnSizes, onColumnResize, width} = this.props;
    if (!onColumnResize) {
      return;
    }

    let normalizedWidth = newWidth;

    // normalise number to a percentage if we were originally passed a percentage
    if (isPercentage(width)) {
      const {parentElement} = this.ref;
      invariant(parentElement, 'expected there to be parentElement');

      const parentWidth = parentElement.clientWidth;
      const {childNodes} = parentElement;

      const lastElem = childNodes[childNodes.length - 1];
      const right =
        lastElem instanceof HTMLElement
          ? lastElem.offsetLeft + lastElem.clientWidth + 1
          : 0;

      if (right < parentWidth) {
        normalizedWidth = calculatePercentage(parentWidth, newWidth);
      }
    }

    onColumnResize({
      ...columnSizes,
      [id]: normalizedWidth,
    });
  };

  setRef = (ref: HTMLElement) => {
    this.ref = ref;
  };

  render() {
    const {isResizable, sortable, width, title} = this.props;
    let {children} = this.props;
    children = (
      <TableHeaderColumnContainer>{children}</TableHeaderColumnContainer>
    );

    if (isResizable) {
      children = (
        <TableHeaderColumnInteractive
          fill={true}
          resizable={RIGHT_RESIZABLE}
          onResize={this.onResize}>
          {children}
        </TableHeaderColumnInteractive>
      );
    }

    return (
      <TableHeadColumnContainer
        width={width}
        title={title}
        onClick={sortable === true ? this.onClick : undefined}
        innerRef={this.setRef}>
        {children}
      </TableHeadColumnContainer>
    );
  }
}

export default class TableHead extends PureComponent<{
  columnOrder: TableColumnOrder,
  onColumnOrder: ?(order: TableColumnOrder) => void,
  columnKeys: TableColumnKeys,
  columns: TableColumns,
  sortOrder: ?TableRowSortOrder,
  onSort: ?TableOnSort,
  columnSizes: TableColumnSizes,
  onColumnResize: ?TableOnColumnResize,
}> {
  buildContextMenu = () => {
    return Object.keys(this.props.columns).map(key => {
      const visible = this.props.columnKeys.includes(key);
      return {
        label: this.props.columns[key].value,
        click: () => {
          const {onColumnOrder, columnOrder} = this.props;
          if (onColumnOrder) {
            const newOrder = columnOrder.slice();
            let hasVisibleItem = false;
            for (let i = 0; i < newOrder.length; i++) {
              const info = newOrder[i];
              if (info.key === key) {
                newOrder[i] = {key, visible: !visible};
              }
              hasVisibleItem = hasVisibleItem || newOrder[i].visible;
            }

            // Dont allow hiding all columns
            if (hasVisibleItem) {
              onColumnOrder(newOrder);
            }
          }
        },
        type: 'checkbox',
        checked: visible,
      };
    });
  };

  render() {
    const {
      columnOrder,
      columns,
      columnSizes,
      onColumnResize,
      onSort,
      sortOrder,
    } = this.props;
    const elems = [];

    let hasFlex = false;
    for (const column of columnOrder) {
      if (column.visible && columnSizes[column.key] === 'flex') {
        hasFlex = true;
        break;
      }
    }

    let lastResizable = true;

    const colElems = {};
    for (const column of columnOrder) {
      if (!column.visible) {
        continue;
      }

      const key = column.key;
      const col = columns[key];

      let arrow;
      if (col.sortable === true && sortOrder && sortOrder.key === key) {
        arrow = (
          <TableHeaderArrow>
            {sortOrder.direction === 'up' ? '▲' : '▼'}
          </TableHeaderArrow>
        );
      }

      const width = normaliseColumnWidth(columnSizes[key]);
      const isResizable = col.resizable !== false;

      const elem = (
        <TableHeadColumn
          key={key}
          id={key}
          hasFlex={hasFlex}
          isResizable={isResizable}
          leftHasResizer={lastResizable}
          width={width}
          sortable={col.sortable}
          sortOrder={sortOrder}
          onSort={onSort}
          columnSizes={columnSizes}
          onColumnResize={onColumnResize}
          title={key}>
          {col.value}
          {arrow}
        </TableHeadColumn>
      );

      elems.push(elem);

      colElems[key] = elem;

      lastResizable = isResizable;
    }

    return (
      <ContextMenu buildItems={this.buildContextMenu}>
        <TableHeadContainer>{elems}</TableHeadContainer>
      </ContextMenu>
    );
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type {Filter} from '../filter/types.js';

export const MINIMUM_COLUMN_WIDTH = 100;
export const DEFAULT_COLUMN_WIDTH = 200;
export const DEFAULT_ROW_HEIGHT = 23;

type TableColumnOrderVal = {
  key: string,
  visible: boolean,
};

export type TableColumnRawOrder = Array<string | TableColumnOrderVal>;

export type TableColumnOrder = Array<TableColumnOrderVal>;

export type TableColumnSizes = {
  [key: string]: string | number,
};

export type TableHighlightedRows = Array<string>;

export type TableColumnKeys = Array<string>;

export type TableOnColumnResize = (sizes: TableColumnSizes) => void;
export type TableOnColumnOrder = (order: TableColumnOrder) => void;
export type TableOnSort = (order: TableRowSortOrder) => void;
export type TableOnHighlight = (
  highlightedRows: TableHighlightedRows,
  e: SyntheticUIEvent<>,
) => void;

export type TableHeaderColumn = {|
  value: string,
  sortable?: boolean,
  resizable?: boolean,
|};

export type TableBodyRow = {|
  key: string,
  height?: ?number,
  filterValue?: ?string,
  backgroundColor?: ?string,
  sortKey?: string | number,
  style?: Object,
  type?: ?string,
  highlightedBackgroundColor?: ?string,
  onDoubleClick?: (e: SyntheticMouseEvent<>) => void,
  copyText?: string,
  highlightOnHover?: boolean,
  columns: {
    [key: string]: TableBodyColumn,
  },
|};

export type TableBodyColumn = {|
  sortValue?: string | number,
  isFilterable?: boolean,
  value: any,
  title?: string,
|};

export type TableColumns = {
  [key: string]: TableHeaderColumn,
};

export type TableRows = Array<TableBodyRow>;

export type TableRowSortOrder = {|
  key: string,
  direction: 'up' | 'down',
|};

export type TableOnDragSelect = (
  e: SyntheticMouseEvent<>,
  key: string,
  index: number,
) => void;

export type TableOnAddFilter = (filter: Filter) => void;
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

export function normaliseColumnWidth(
  width: void | string | number,
): number | string {
  if (width == null || width === 'flex') {
    // default
    return 'flex';
  }

  if (isPercentage(width)) {
    // percentage eg. 50%
    return width;
  }

  if (typeof width === 'number') {
    // pixel width
    return width;
  }

  throw new TypeError(`Unknown value ${width} for table column width`);
}

export function isPercentage(width: mixed): boolean {
  return typeof width === 'string' && width[width.length - 1] === '%';
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type {Tracker, RulesToClass} from './index.js';
import type {StyleSheet} from './sheet.js';

const invariant = require('invariant');

export class GarbageCollector {
  constructor(sheet: StyleSheet, tracker: Tracker, rulesToClass: RulesToClass) {
    this.sheet = sheet;
    this.tracker = tracker;

    // used to keep track of what classes are actively in use
    this.usedClasses = new Map();

    // classes to be removed, we put this in a queue and perform it in bulk rather than straight away
    // since by the time the next tick happens this style could have been reinserted
    this.classRemovalQueue = new Set();

    this.rulesToClass = rulesToClass;
  }

  tracker: Tracker;
  sheet: StyleSheet;
  usedClasses: Map<string, number>;
  garbageTimer: ?TimeoutID;
  classRemovalQueue: Set<string>;
  rulesToClass: RulesToClass;

  hasQueuedCollection(): boolean {
    return Boolean(this.garbageTimer);
  }

  getReferenceCount(key: string): number {
    return this.usedClasses.get(key) || 0;
  }

  // component has been mounted so make sure it's being depended on
  registerClassUse(name: string) {
    const count = this.usedClasses.get(name) || 0;
    this.usedClasses.set(name, count + 1);
    if (this.classRemovalQueue.has(name)) {
      this.classRemovalQueue.delete(name);

      if (this.classRemovalQueue.size === 0) {
        this.haltGarbage();
      }
    }
  }

  // component has been unmounted so remove it's dependencies
  deregisterClassUse(name: string) {
    let count = this.usedClasses.get(name);
    if (count == null) {
      return;
    }

    count--;
    this.usedClasses.set(name, count);

    if (count === 0) {
      this.classRemovalQueue.add(name);
      this.scheduleGarbage();
    }
  }

  scheduleGarbage() {
    if (this.garbageTimer != null) {
      return;
    }

    this.garbageTimer = setTimeout(() => {
      this.collectGarbage();
    }, 2000);
  }

  haltGarbage() {
    if (this.garbageTimer) {
      clearTimeout(this.garbageTimer);
      this.garbageTimer = null;
    }
  }

  getCollectionQueue() {
    return Array.from(this.classRemovalQueue);
  }

  collectGarbage() {
    this.haltGarbage();
    for (const name of this.classRemovalQueue) {
      const trackerInfo = this.tracker.get(name);
      invariant(trackerInfo != null, 'trying to remove unknown class');

      const {rules} = trackerInfo;
      this.rulesToClass.delete(rules);

      this.sheet.delete(name);
      this.tracker.delete(name);
      this.usedClasses.delete(name);
    }
    this.classRemovalQueue.clear();
  }

  flush() {
    this.haltGarbage();
    this.classRemovalQueue.clear();
    this.usedClasses.clear();
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

export default function hash(str: string): string {
  const m = 0x5bd1e995;
  const r = 24;
  let h = str.length;
  let length = str.length;
  let currentIndex = 0;

  while (length >= 4) {
    let k = UInt32(str, currentIndex);

    k = Umul32(k, m);
    k ^= k >>> r;
    k = Umul32(k, m);

    h = Umul32(h, m);
    h ^= k;

    currentIndex += 4;
    length -= 4;
  }

  switch (length) {
    case 3:
      h ^= UInt16(str, currentIndex);
      h ^= str.charCodeAt(currentIndex + 2) << 16;
      h = Umul32(h, m);
      break;

    case 2:
      h ^= UInt16(str, currentIndex);
      h = Umul32(h, m);
      break;

    case 1:
      h ^= str.charCodeAt(currentIndex);
      h = Umul32(h, m);
      break;
  }

  h ^= h >>> 13;
  h = Umul32(h, m);
  h ^= h >>> 15;

  return (h >>> 0).toString(36);
}

function UInt32(str: string, pos: number): number {
  return (
    str.charCodeAt(pos++) +
    (str.charCodeAt(pos++) << 8) +
    (str.charCodeAt(pos++) << 16) +
    (str.charCodeAt(pos) << 24)
  );
}

function UInt16(str: string, pos: number): number {
  return str.charCodeAt(pos++) + (str.charCodeAt(pos++) << 8);
}

function Umul32(n: number, m: number): number {
  n |= 0;
  m |= 0;
  const nlo = n & 0xffff;
  const nhi = n >>> 16;
  const res = (nlo * m + (((nhi * m) & 0xffff) << 16)) | 0;
  return res;
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type {BaseRules, KeyframeRules, RawRules} from './rules.js';
import {buildKeyframeRules, buildRules, normaliseRules} from './rules.js';
import assignDeep from '../../utils/assignDeep.js';
import * as performance from '../../utils/performance.js';
import {GarbageCollector} from './gc.js';
import {StyleSheet} from './sheet.js';
import hash from './hash.js';

const React = require('react');

export type Tracker = Map<
  string,
  {
    displayName: ?string,
    namespace: string,
    rules: BaseRules,
    selector: string,
    style: Object,
  },
>;

export type RulesToClass = WeakMap<BaseRules, string>;

// map of inserted classes and metadata about them
export const tracker: Tracker = new Map();

// map of rules to their class
const rulesToClass: RulesToClass = new WeakMap();

export const sheet = new StyleSheet(process.env.NODE_ENV === 'production');
export const gc = new GarbageCollector(sheet, tracker, rulesToClass);

function addRules(
  displayName: string,
  rules: BaseRules,
  namespace,
  props: Object,
  context: Object,
) {
  // if these rules have been cached to a className then retrieve it
  const cachedClass = rulesToClass.get(rules);
  if (cachedClass != null) {
    return cachedClass;
  }

  //
  const declarations = [];
  const style = buildRules(rules, props, context);

  // generate css declarations based on the style object
  for (const key in style) {
    const val = style[key];
    declarations.push(`  ${key}: ${val};`);
  }
  const css = declarations.join('\n');

  // build the class name with the display name of the styled component and a unique id based on the css and namespace
  const className = displayName + '__' + hash(namespace + css);

  // this is the first time we've found this className
  if (!tracker.has(className)) {
    // build up the correct selector, explode on commas to allow multiple selectors
    const selector = namespace
      .split(', ')
      .map(part => {
        if (part[0] === '&') {
          return '.' + className + part.slice(1);
        } else {
          return '.' + className + ' ' + part;
        }
      })
      .join(', ');

    // insert the new style text
    tracker.set(className, {displayName, namespace, rules, selector, style});
    sheet.insert(className, `${selector} {\n${css}\n}`);

    // if there's no dynamic rules then cache this
    if (hasDynamicRules(rules) === false) {
      rulesToClass.set(rules, className);
    }
  }

  return className;
}

// remove all styhles
export function flush() {
  gc.flush();
  tracker.clear();
  sheet.flush();
}

export type TagName = string | Function;

type StyledComponentState = {|
  extraClassNames: Array<string>,
  classNames: Array<string>,
  lastBuiltRules: ?Object,
  lastBuiltRulesIsDynamic: boolean,
|};

export class StylableComponent<
  Props = void,
  State = void,
> extends React.Component<Props, State> {
  static extends(
    rules: RawRules,
    opts?: StyledComponentOpts,
  ): StyledComponent<any> {
    return createStyledComponent(this, rules, opts);
  }
}

class StylablePureComponent<
  Props = void,
  State = void,
> extends React.PureComponent<Props, State> {
  static extends(
    rules: RawRules,
    opts?: StyledComponentOpts,
  ): StyledComponent<any> {
    return createStyledComponent(this, rules, opts);
  }
}

class StyledComponentBase<Props> extends React.PureComponent<
  Props,
  StyledComponentState,
> {
  constructor(props: Props, context: Object): void {
    super(props, context);
    this.state = {
      classNames: [],
      extraClassNames: [],
      lastBuiltRulesIsDynamic: false,
      lastBuiltRules: null,
    };
  }

  static defaultProps: ?$Shape<Props>;

  static STYLED_CONFIG: {|
    tagName: TagName,
    ignoreAttributes: ?Array<string>,
    builtRules: any,
  |};

  static extends(
    rules: RawRules,
    opts?: StyledComponentOpts,
  ): StyledComponent<any> {
    return createStyledComponent(this, rules, opts);
  }

  componentWillMount(): void {
    this.generateClassnames(this.props, null);
  }

  componentWillReceiveProps(nextProps: Props): void {
    this.generateClassnames(nextProps, this.props);
  }

  componentWillUnmount(): void {
    for (const name of this.state.classNames) {
      gc.deregisterClassUse(name);
    }
  }

  generateClassnames(props: Props, prevProps: ?Props): void {
    throw new Error('unimplemented');
  }
}

function hasDynamicRules(rules: Object): boolean {
  for (const key in rules) {
    const val = rules[key];

    if (typeof val === 'function') {
      return true;
    } else if (typeof val === 'object' && hasDynamicRules(val)) {
      return true;
    }
  }
  return false;
}

function hasEquivProps(props: Object, nextProps: Object): boolean {
  // check if the props are equivalent
  for (const key in props) {
    // ignore `children` since we do that check later
    if (key === 'children') {
      continue;
    }

    // check strict equality of prop value
    if (nextProps[key] !== props[key]) {
      return false;
    }
  }

  // check if nextProps has any values that props doesn't
  for (const key in nextProps) {
    if (!(key in props)) {
      return false;
    }
  }

  // check if the boolean equality of children is equivalent
  if (Boolean(props.children) !== Boolean(nextProps.children)) {
    return false;
  }

  return true;
}

export type StyledComponent<Props> = Class<StyledComponentBase<Props>>;

type StyledComponentOpts = {
  displayName?: string,
  contextTypes?: Object,
  ignoreAttributes?: Array<string>,
};

function createStyledComponent(
  tagName: TagName,
  rules: RawRules,
  opts?: StyledComponentOpts = {},
): StyledComponent<any> {
  let {contextTypes = {}, ignoreAttributes} = opts;

  // build up rules
  let builtRules = normaliseRules(rules);

  // if inheriting from another styled component then take all of it's properties
  if (typeof tagName === 'function' && tagName.STYLED_CONFIG) {
    // inherit context types
    if (tagName.contextTypes) {
      contextTypes = {...contextTypes, ...tagName.contextTypes};
    }

    const parentConfig = tagName.STYLED_CONFIG;

    // inherit tagname
    tagName = parentConfig.tagName;

    // inherit ignoreAttributes
    if (parentConfig.ignoreAttributes) {
      if (ignoreAttributes) {
        ignoreAttributes = ignoreAttributes.concat(
          parentConfig.ignoreAttributes,
        );
      } else {
        ignoreAttributes = parentConfig.ignoreAttributes;
      }
    }

    // inherit rules
    builtRules = assignDeep({}, parentConfig.builtRules, builtRules);
  }

  const displayName: string =
    opts.displayName == null ? 'StyledComponent' : opts.displayName;
  const isDOM = typeof tagName === 'string';

  class Constructor<Props: Object> extends StyledComponentBase<Props> {
    generateClassnames(props: Props, prevProps: ?Props) {
      // if this is a secondary render then check if the props are essentially equivalent
      // NOTE: hasEquivProps is not a standard shallow equality test
      if (prevProps != null && hasEquivProps(props, prevProps)) {
        return;
      }

      const debugId = performance.mark();
      const extraClassNames = [];

      let myBuiltRules = builtRules;

      // if passed any classes from another styled component, ignore that class and merge in their
      // resolved styles
      if (props.className) {
        const propClassNames = props.className.trim().split(/[\s]+/g);
        for (const className of propClassNames) {
          const classInfo = tracker.get(className);
          if (classInfo) {
            const {namespace, style} = classInfo;
            myBuiltRules = assignDeep({}, myBuiltRules, {[namespace]: style});
          } else {
            extraClassNames.push(className);
          }
        }
      }

      // if we had the exact same rules as last time and they weren't dynamic then we can bail out here
      if (
        myBuiltRules !== this.state.lastBuiltRules ||
        this.state.lastBuiltRulesIsDynamic !== false
      ) {
        const prevClasses = this.state.classNames;
        const classNames = [];

        // add rules
        for (const namespace in myBuiltRules) {
          const className = addRules(
            displayName,
            myBuiltRules[namespace],
            namespace,
            props,
            this.context,
          );
          classNames.push(className);

          // if this is the first mount render or we didn't previously have this class then add it as new
          if (prevProps == null || !prevClasses.includes(className)) {
            gc.registerClassUse(className);
          }
        }

        // check what classNames have been removed if this is a secondary render
        if (prevProps != null) {
          for (const className of prevClasses) {
            // if this previous class isn't in the current classes then deregister it
            if (!classNames.includes(className)) {
              gc.deregisterClassUse(className);
            }
          }
        }

        this.setState({
          classNames,
          lastBuiltRules: myBuiltRules,
          lastBuiltRulesIsDynamic: hasDynamicRules(myBuiltRules),
          extraClassNames,
        });
      }

      performance.measure(
        debugId,
        `🚀 ${this.constructor.name} [style calculate]`,
      );
    }
    render() {
      const {children, innerRef, ...props} = this.props;

      if (ignoreAttributes) {
        for (const key of ignoreAttributes) {
          delete props[key];
        }
      }
      // build class names
      const className = this.state.classNames
        .concat(this.state.extraClassNames)
        .join(' ');
      if (props.is) {
        props.class = className;
      } else {
        props.className = className;
      }
      //
      if (innerRef) {
        if (isDOM) {
          // dom ref
          props.ref = innerRef;
        } else {
          // probably another styled component so pass it down
          props.innerRef = innerRef;
        }
      }
      return React.createElement(tagName, props, children);
    }
  }
  Constructor.STYLED_CONFIG = {
    builtRules,
    ignoreAttributes,
    tagName,
  };

  Constructor.contextTypes = {
    ...contextTypes,
  };

  Object.defineProperty(Constructor, 'name', {
    value: displayName,
  });

  return Constructor;
}
export function buildKeyframes(spec: KeyframeRules) {
  let css = [];

  const builtRules = buildKeyframeRules(spec);
  for (const key in builtRules) {
    const declarations = [];
    const rules = builtRules[key];

    for (const key in rules) {
      declarations.push(`    ${key}: ${String(rules[key])};`);
    }
    css.push(`  ${key} {`);
    css = css.concat(declarations);
    css.push('  }');
  }
  css = css.join('\n');
  return css;
}
function createKeyframes(spec: KeyframeRules): string {
  const body = buildKeyframes(spec);
  const className = `animation-${hash(body)}`;

  const css = `@keyframes ${className} {\n${body}\n}`;
  sheet.insert(className, css);
  return className;
}
type StyledComponentFactory = (
  rules: RawRules,
  opts?: StyledComponentOpts,
) => StyledComponent<any>;

function createStyledComponentFactory(tagName: string): StyledComponentFactory {
  return (rules: RawRules, opts?: StyledComponentOpts) => {
    return createStyledComponent(tagName, rules, opts);
  };
}
export default {
  image: createStyledComponentFactory('img'),
  view: createStyledComponentFactory('div'),
  text: createStyledComponentFactory('span'),
  textInput: createStyledComponentFactory('input'),
  customHTMLTag: createStyledComponent,
  keyframes: createKeyframes,
  StylableComponent,
  StylablePureComponent,
};
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type {CSSPropertySet, CSSPropertyValue} from './types.js';

const dashify = require('dashify');

export type NormalisedRules = {
  [namespace: string]: BaseRules,
};

export type BaseRules = {
  [key: string]: CSSPropertyValue<string | number>,
};

export type PlainRules = {
  [key: string]: string,
};

export type NormalisedKeyframeRules = {
  [key: string]: PlainRules,
};

export type KeyframeRules = {
  [key: string]: CSSPropertySet,
};

export type RawRules = {
  ...CSSPropertySet,
  [key: string]: CSSPropertySet,
};

const unitlessNumberProperties = new Set([
  'animation-iteration-count',
  'border-image-outset',
  'border-image-slice',
  'border-image-width',
  'column-count',
  'flex',
  'flex-grow',
  'flex-positive',
  'flex-shrink',
  'flex-order',
  'grid-row',
  'grid-column',
  'font-weight',
  'line-clamp',
  'line-height',
  'opacity',
  'order',
  'orphans',
  'tab-size',
  'widows',
  'z-index',
  'zoom',
  'fill-opacity',
  'flood-opacity',
  'stop-opacity',
  'stroke-dasharray',
  'stroke-dashoffset',
  'stroke-miterlimit',
  'stroke-opacity',
  'stroke-width',
]);

// put top level styles into an '&' object
function expandRules(rules: RawRules): NormalisedRules {
  const expandedRules = {};
  const rootRules = {};

  for (const key in rules) {
    const val = rules[key];

    if (typeof val === 'object') {
      expandedRules[key] = val;
    } else {
      rootRules[key] = val;
    }
  }

  if (Object.keys(rootRules).length) {
    expandedRules['&'] = rootRules;
  }

  return expandedRules;
}

function shouldAppendPixel(key: string, val: mixed): boolean {
  return (
    typeof val === 'number' && !unitlessNumberProperties.has(key) && !isNaN(val)
  );
}

export function normaliseRules(rules: RawRules): NormalisedRules {
  const expandedRules = expandRules(rules);

  const builtRules = {};

  for (const key in expandedRules) {
    const rules = expandedRules[key];
    const myRules = {};

    for (const key in rules) {
      const val = rules[key];

      let dashedKey = dashify(key);
      if (/[A-Z]/.test(key[0])) {
        dashedKey = `-${dashedKey}`;
      }

      myRules[dashedKey] = val;
    }

    if (Object.keys(myRules).length) {
      builtRules[key] = myRules;
    }
  }

  return builtRules;
}

export function buildKeyframeRules(
  rules: KeyframeRules,
): NormalisedKeyframeRules {
  const spec = {};

  for (const selector in rules) {
    const newRules = {};

    const rules2 = rules[selector];
    if (!rules2 || typeof rules2 !== 'object') {
      throw new Error('Keyframe spec must only have objects');
    }

    for (const key in rules2) {
      let val = rules2[key];

      if (shouldAppendPixel(key, val)) {
        val += 'px';
      } else if (typeof val === 'number') {
        val = String(val);
      }

      if (typeof val !== 'string') {
        throw new Error('Keyframe objects must only have strings values');
      }

      newRules[key] = val;
    }

    spec[selector] = newRules;
  }

  return spec;
}

export function buildRules(
  rules: BaseRules,
  props: NormalisedRules,
  context: Object,
): PlainRules {
  const style = {};
  for (const key in rules) {
    let val = rules[key];
    if (typeof val === 'function') {
      val = val(props, context);
    }
    if (val != null && shouldAppendPixel(key, val)) {
      val += 'px';
    }
    if (val != null) {
      style[key] = String(val);
    }
  }
  return style;
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

const invariant = require('invariant');

function makeStyleTag(): HTMLStyleElement {
  const tag = document.createElement('style');
  tag.type = 'text/css';
  tag.appendChild(document.createTextNode(''));

  const {head} = document;
  invariant(head, 'expected head');
  head.appendChild(tag);

  return tag;
}

export class StyleSheet {
  constructor(isSpeedy?: boolean) {
    this.injected = false;
    this.isSpeedy = Boolean(isSpeedy);

    this.flush();
    this.inject();
  }

  ruleIndexes: Array<string>;
  injected: boolean;
  isSpeedy: boolean;
  tag: HTMLStyleElement;

  getRuleCount(): number {
    return this.ruleIndexes.length;
  }

  flush() {
    this.ruleIndexes = [];
    if (this.tag) {
      this.tag.innerHTML = '';
    }
  }

  inject() {
    if (this.injected) {
      throw new Error('already injected stylesheet!');
    }

    this.tag = makeStyleTag();
    this.injected = true;
  }

  delete(key: string) {
    const index = this.ruleIndexes.indexOf(key);
    if (index < 0) {
      // TODO maybe error
      return;
    }

    this.ruleIndexes.splice(index, 1);

    const tag = this.tag;
    if (this.isSpeedy) {
      const sheet = tag.sheet;
      invariant(sheet, 'expected sheet');

      // $FlowFixMe: sheet is actually CSSStylesheet
      sheet.deleteRule(index);
    } else {
      tag.removeChild(tag.childNodes[index + 1]);
    }
  }

  insert(key: string, rule: string) {
    const tag = this.tag;

    if (this.isSpeedy) {
      const sheet = tag.sheet;
      invariant(sheet, 'expected sheet');

      // $FlowFixMe: sheet is actually CSSStylesheet
      sheet.insertRule(rule, sheet.cssRules.length);
    } else {
      tag.appendChild(document.createTextNode(rule));
    }

    this.ruleIndexes.push(key);
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

export type alignContent =
  | 'flex-start'
  | 'flex-end'
  | 'center'
  | 'space-between'
  | 'space-around'
  | 'stretch';
export type alignItems =
  | 'flex-start'
  | 'flex-end'
  | 'center'
  | 'baseline'
  | 'stretch';
export type alignSelf =
  | 'auto'
  | 'flex-start'
  | 'flex-end'
  | 'center'
  | 'baseline'
  | 'stretch';
export type all = 'initial' | 'inherit' | 'unset';
export type animation = singleAnimation;
export type animationDelay = number;
export type animationDirection = singleAnimationDirection;
export type animationDuration = string | number;
export type animationFillMode = singleAnimationFillMode;
export type animationIterationCount = singleAnimationIterationCount;
export type animationName = singleAnimationName;
export type animationPlayState = singleAnimationPlayState;
export type animationTimingFunction = singleTimingFunction;
export type appearance = 'auto' | 'none';
export type azimuth = number | string | 'leftwards' | 'rightwards';
export type backdropFilter = 'none' | string;
export type backfaceVisibility = 'visible' | 'hidden';
type backgroundSyntax = {|
  attachment?: attachment,
  color?: color,
  image?: bgImage,
  position?: string,
  repeat?: repeatStyle,
|};
export type background = string | finalBgLayer | backgroundSyntax;
export type backgroundAttachment = attachment;
export type backgroundBlendMode = blendMode;
export type backgroundClip = box;
export type backgroundColor = color;
export type backgroundImage = bgImage;
export type backgroundOrigin = box;
export type backgroundPosition = string;
export type backgroundPositionX = string;
export type backgroundPositionY = string;
export type backgroundRepeat = repeatStyle;
export type backgroundSize = bgSize;
export type blockSize = width;
type borderSyntax = {|
  width?: borderWidth,
  style?: brStyle,
  color?: color,
|};
export type border = borderWidth | brStyle | color | borderSyntax;
export type borderBlockEnd = borderWidth | borderStyle | color;
export type borderBlockEndColor = color;
export type borderBlockEndStyle = borderStyle;
export type borderBlockEndWidth = borderWidth;
export type borderBlockStart = borderWidth | borderStyle | color;
export type borderBlockStartColor = color;
export type borderBlockStartStyle = borderStyle;
export type borderBlockStartWidth = borderWidth;
export type borderBottomLeftRadius = lengthPercentage;
export type borderBottomRightRadius = lengthPercentage;
export type borderBottomStyle = brStyle;
export type borderBottomWidth = borderWidth;
export type borderCollapse = 'collapse' | 'separate';
export type borderColor = color;
export type borderImage =
  | borderImageSource
  | borderImageSlice
  | string
  | borderImageRepeat;
export type borderImageOutset = string;
export type borderImageRepeat = string;
export type borderImageSlice = string | number | 'fill';
export type borderImageSource = 'none' | string;
export type borderImageWidth = string;
export type borderInlineEnd = borderWidth | borderStyle | color;
export type borderInlineEndColor = color;
export type borderInlineEndStyle = borderStyle;
export type borderInlineEndWidth = borderWidth;
export type borderInlineStart = borderWidth | borderStyle | color;
export type borderInlineStartColor = color;
export type borderInlineStartStyle = borderStyle;
export type borderInlineStartWidth = borderWidth;
export type borderLeftColor = color;
export type borderLeftStyle = brStyle;
export type borderLeftWidth = borderWidth;
export type borderRightColor = color;
export type borderRightStyle = brStyle;
export type borderRightWidth = borderWidth;
export type borderRadius = lengthPercentage;
export type borderSpacing = number;
export type borderStyle = brStyle;
export type borderTopLeftRadius = lengthPercentage;
export type borderTopRightRadius = lengthPercentage;
export type borderTopStyle = brStyle;
export type borderTopWidth = borderWidth;
export type boxAlign = 'start' | 'center' | 'end' | 'baseline' | 'stretch';
export type boxDecorationBreak = 'slice' | 'clone';
export type boxDirection = 'normal' | 'reverse' | 'inherit';
export type boxFlex = number;
export type boxFlexGroup = number;
export type boxLines = 'single' | 'multiple';
export type boxOrdinalGroup = number;
export type boxOrient =
  | 'horizontal'
  | 'vertical'
  | 'inline-axis'
  | 'block-axis'
  | 'inherit';
export type boxPack = 'start' | 'center' | 'end' | 'justify';
type boxShadowSyntax = {|
  x?: number,
  y?: number,
  blur?: number,
  spread?: number,
  color?: string,
  inset?: boolean,
|};
export type boxShadow =
  | 'none'
  | string
  | boxShadowSyntax
  | Array<string | boxShadowSyntax>;
export type boxSizing = 'content-box' | 'border-box';
export type boxSuppress = 'show' | 'discard' | 'hide';
export type breakAfter =
  | 'auto'
  | 'avoid'
  | 'avoid-page'
  | 'page'
  | 'left'
  | 'right'
  | 'recto'
  | 'verso'
  | 'avoid-column'
  | 'column'
  | 'avoid-region'
  | 'region';
export type breakBefore =
  | 'auto'
  | 'avoid'
  | 'avoid-page'
  | 'page'
  | 'left'
  | 'right'
  | 'recto'
  | 'verso'
  | 'avoid-column'
  | 'column'
  | 'avoid-region'
  | 'region';
export type breakInside =
  | 'auto'
  | 'avoid'
  | 'avoid-page'
  | 'avoid-column'
  | 'avoid-region';
export type captionSide =
  | 'top'
  | 'bottom'
  | 'block-start'
  | 'block-end'
  | 'inline-start'
  | 'inline-end';
export type clear =
  | 'none'
  | 'left'
  | 'right'
  | 'both'
  | 'inline-start'
  | 'inline-end';
export type clip = string | 'auto';
export type clipPath = string | 'none';
export type columnCount = number | 'auto';
export type columnFill = 'auto' | 'balance';
export type columnGap = number | 'normal';
export type columnRule = columnRuleWidth | columnRuleStyle | columnRuleColor;
export type columnRuleColor = color;
export type columnRuleStyle = brStyle;
export type columnRuleWidth = borderWidth;
export type columnSpan = 'none' | 'all';
export type columnWidth = number | 'auto';
export type columns = columnWidth | columnCount;
export type contain = 'none' | 'strict' | 'content' | string;
export type content = string;
export type counterIncrement = string | 'none';
export type counterReset = string | 'none';
export type cursor =
  | 'auto'
  | 'default'
  | 'none'
  | 'context-menu'
  | 'help'
  | 'pointer'
  | 'progress'
  | 'wait'
  | 'cell'
  | 'crosshair'
  | 'text'
  | 'vertical-text'
  | 'alias'
  | 'copy'
  | 'move'
  | 'no-drop'
  | 'not-allowed'
  | 'e-resize'
  | 'n-resize'
  | 'ne-resize'
  | 'nw-resize'
  | 's-resize'
  | 'se-resize'
  | 'sw-resize'
  | 'w-resize'
  | 'ew-resize'
  | 'ns-resize'
  | 'nesw-resize'
  | 'nwse-resize'
  | 'col-resize'
  | 'row-resize'
  | 'all-scroll'
  | 'zoom-in'
  | 'zoom-out'
  | 'grab'
  | 'grabbing'
  | '-webkit-grab'
  | '-webkit-grabbing';
export type direction = 'ltr' | 'rtl';
export type display =
  | 'none'
  | 'inline'
  | 'block'
  | 'list-item'
  | 'inline-list-item'
  | 'inline-block'
  | 'inline-table'
  | 'table'
  | 'table-cell'
  | 'table-column'
  | 'table-column-group'
  | 'table-footer-group'
  | 'table-header-group'
  | 'table-row'
  | 'table-row-group'
  | 'flex'
  | 'inline-flex'
  | 'grid'
  | 'inline-grid'
  | 'run-in'
  | 'ruby'
  | 'ruby-base'
  | 'ruby-text'
  | 'ruby-base-container'
  | 'ruby-text-container'
  | 'contents';
export type displayInside =
  | 'auto'
  | 'block'
  | 'table'
  | 'flex'
  | 'grid'
  | 'ruby';
export type displayList = 'none' | 'list-item';
export type displayOutside =
  | 'block-level'
  | 'inline-level'
  | 'run-in'
  | 'contents'
  | 'none'
  | 'table-row-group'
  | 'table-header-group'
  | 'table-footer-group'
  | 'table-row'
  | 'table-cell'
  | 'table-column-group'
  | 'table-column'
  | 'table-caption'
  | 'ruby-base'
  | 'ruby-text'
  | 'ruby-base-container'
  | 'ruby-text-container';
export type emptyCells = 'show' | 'hide';
export type filter = 'none' | string;
export type flex = 'none' | string | number;
export type flexBasis = 'content' | number | string;
export type flexDirection = 'row' | 'row-reverse' | 'column' | 'column-reverse';
export type flexFlow = flexDirection | flexWrap;
export type flexGrow = number;
export type flexShrink = number;
export type flexWrap = 'nowrap' | 'wrap' | 'wrap-reverse';
export type float = 'left' | 'right' | 'none' | 'inline-start' | 'inline-end';
export type font =
  | string
  | 'caption'
  | 'icon'
  | 'menu'
  | 'message-box'
  | 'small-caption'
  | 'status-bar';
export type fontFamily = string;
export type fontFeatureSettings = 'normal' | string;
export type fontKerning = 'auto' | 'normal' | 'none';
export type fontLanguageOverride = 'normal' | string;
export type fontSize = absoluteSize | relativeSize | lengthPercentage;
export type fontSizeAdjust = 'none' | number;
export type fontStretch =
  | 'normal'
  | 'ultra-condensed'
  | 'extra-condensed'
  | 'condensed'
  | 'semi-condensed'
  | 'semi-expanded'
  | 'expanded'
  | 'extra-expanded'
  | 'ultra-expanded';
export type fontStyle = 'normal' | 'italic' | 'oblique';
export type fontSynthesis = 'none' | string;
export type fontVariant = 'normal' | 'none' | string;
export type fontVariantAlternates = 'normal' | string;
export type fontVariantCaps =
  | 'normal'
  | 'small-caps'
  | 'all-small-caps'
  | 'petite-caps'
  | 'all-petite-caps'
  | 'unicase'
  | 'titling-caps';
export type fontVariantEastAsian = 'normal' | string;
export type fontVariantLigatures = 'normal' | 'none' | string;
export type fontVariantNumeric = 'normal' | string;
export type fontVariantPosition = 'normal' | 'sub' | 'super';
export type fontWeight =
  | 'inherit'
  | 'normal'
  | 'bold'
  | 'bolder'
  | 'lighter'
  | 100
  | 200
  | 300
  | 400
  | 500
  | 600
  | 700
  | 800
  | 900;
export type grid = gridTemplate | string;
export type gridArea = gridLine | string;
export type gridAutoColumns = trackSize;
export type gridAutoFlow = string | 'dense';
export type gridAutoRows = trackSize;
export type gridColumn = gridLine | string;
export type gridColumnEnd = gridLine;
export type gridColumnGap = lengthPercentage;
export type gridColumnStart = gridLine;
export type gridGap = gridRowGap | gridColumnGap;
export type gridRow = gridLine | string;
export type gridRowEnd = gridLine;
export type gridRowGap = lengthPercentage;
export type gridRowStart = gridLine;
export type gridTemplate = 'none' | 'subgrid' | string;
export type gridTemplateAreas = 'none' | string;
export type gridTemplateColumns = 'none' | 'subgrid' | string;
export type gridTemplateRows = 'none' | 'subgrid' | string;
export type hyphens = 'none' | 'manual' | 'auto';
export type imageOrientation = 'from-image' | number | string;
export type imageRendering =
  | 'auto'
  | 'crisp-edges'
  | 'pixelated'
  | 'optimizeSpeed'
  | 'optimizeQuality'
  | string;
export type imageResolution = string | 'snap';
export type imeMode = 'auto' | 'normal' | 'active' | 'inactive' | 'disabled';
export type initialLetter = 'normal' | string;
export type initialLetterAlign = string;
export type inlineSize = width;
export type isolation = 'auto' | 'isolate';
export type justifyContent =
  | 'flex-start'
  | 'flex-end'
  | 'center'
  | 'space-between'
  | 'space-around';
export type letterSpacing = 'normal' | lengthPercentage;
export type lineBreak = 'auto' | 'loose' | 'normal' | 'strict';
export type lineHeight = 'normal' | number | string;
export type listStyle = listStyleType | listStylePosition | listStyleImage;
export type listStyleImage = string | 'none';
export type listStylePosition = 'inside' | 'outside';
export type listStyleType = string | 'none';
type marginSyntax = {|
  vertical?: number | string,
  horizontal?: number | string,
  top?: number | string,
  left?: number | string,
  right?: number | string,
  bottom?: number | string,
|};
export type margin = number | string | marginSyntax;
export type marginBlockEnd = marginLeft;
export type marginBlockStart = marginLeft;
export type marginBottom = number | string | 'auto';
export type marginInlineEnd = marginLeft;
export type marginInlineStart = marginLeft;
export type marginLeft = number | string | 'auto';
export type marginRight = number | string | 'auto';
export type marginTop = number | string | 'auto';
export type markerOffset = number | 'auto';
export type mask = maskLayer;
export type maskClip = string;
export type maskComposite = compositeOperator;
export type maskMode = maskingMode;
export type maskOrigin = geometryBox;
export type maskPosition = string;
export type maskRepeat = repeatStyle;
export type maskSize = bgSize;
export type maskType = 'luminance' | 'alpha';
export type maxBlockSize = maxWidth;
export type maxHeight =
  | number
  | string
  | 'none'
  | 'max-content'
  | 'min-content'
  | 'fit-content'
  | 'fill-available';
export type maxInlineSize = maxWidth;
export type maxWidth =
  | number
  | string
  | 'none'
  | 'max-content'
  | 'min-content'
  | 'fit-content'
  | 'fill-available';
export type minBlockSize = minWidth;
export type minHeight =
  | number
  | string
  | 'auto'
  | 'max-content'
  | 'min-content'
  | 'fit-content'
  | 'fill-available';
export type minInlineSize = minWidth;
export type minWidth =
  | number
  | string
  | 'auto'
  | 'max-content'
  | 'min-content'
  | 'fit-content'
  | 'fill-available';
export type mixBlendMode = blendMode;
export type motion = motionPath | motionOffset | motionRotation;
export type motionOffset = lengthPercentage;
export type motionPath = string | geometryBox | 'none';
export type motionRotation = string | number;
export type objectFit = 'fill' | 'contain' | 'cover' | 'none' | 'scale-down';
export type objectPosition = string;
export type offsetBlockEnd = string;
export type offsetBlockStart = string;
export type offsetInlineEnd = string;
export type offsetInlineStart = string;
export type opacity = number;
export type order = number;
export type orphans = number;
type outlineSyntax = {|
  width?: borderWidth,
  style?: brStyle,
  color?: color,
|};
export type outline = string | outlineSyntax;
export type outlineColor = color | 'invert';
export type outlineOffset = number;
export type outlineStyle = 'auto' | brStyle;
export type outlineWidth = borderWidth;
export type overflow = 'visible' | 'hidden' | 'scroll' | 'auto';
export type overflowClipBox = 'padding-box' | 'content-box';
export type overflowWrap = 'normal' | 'break-word';
export type overflowX = 'visible' | 'hidden' | 'scroll' | 'auto';
export type overflowY = 'visible' | 'hidden' | 'scroll' | 'auto';
type paddingSyntax = {|
  vertical?: number | string,
  horizontal?: number | string,
  top?: number | string,
  left?: number | string,
  right?: number | string,
  bottom?: number | string,
|};
export type padding = number | string | paddingSyntax;
export type paddingBlockEnd = paddingLeft;
export type paddingBlockStart = paddingLeft;
export type paddingBottom = number | string;
export type paddingInlineEnd = paddingLeft;
export type paddingInlineStart = paddingLeft;
export type paddingLeft = number | string;
export type paddingRight = number | string;
export type paddingTop = number | string;
export type pageBreakAfter = 'auto' | 'always' | 'avoid' | 'left' | 'right';
export type pageBreakBefore = 'auto' | 'always' | 'avoid' | 'left' | 'right';
export type pageBreakInside = 'auto' | 'avoid';
export type perspective = 'none' | number;
export type perspectiveOrigin = string;
export type pointerEvents =
  | 'auto'
  | 'none'
  | 'visiblePainted'
  | 'visibleFill'
  | 'visibleStroke'
  | 'visible'
  | 'painted'
  | 'fill'
  | 'stroke'
  | 'all'
  | 'inherit';
export type position = 'static' | 'relative' | 'absolute' | 'sticky' | 'fixed';
export type quotes = string | 'none';
export type resize = 'none' | 'both' | 'horizontal' | 'vertical';
export type rubyAlign = 'start' | 'center' | 'space-between' | 'space-around';
export type rubyMerge = 'separate' | 'collapse' | 'auto';
export type rubyPosition = 'over' | 'under' | 'inter-character';
export type scrollBehavior = 'auto' | 'smooth';
export type scrollSnapCoordinate = 'none' | string;
export type scrollSnapDestination = string;
export type scrollSnapPointsX = 'none' | string;
export type scrollSnapPointsY = 'none' | string;
export type scrollSnapType = 'none' | 'mandatory' | 'proximity';
export type scrollSnapTypeX = 'none' | 'mandatory' | 'proximity';
export type scrollSnapTypeY = 'none' | 'mandatory' | 'proximity';
export type shapeImageThreshold = number;
export type shapeMargin = lengthPercentage;
export type shapeOutside = 'none' | shapeBox | string;
export type tabSize = number;
export type tableLayout = 'auto' | 'fixed';
export type textAlign =
  | 'start'
  | 'end'
  | 'left'
  | 'right'
  | 'center'
  | 'justify'
  | 'match-parent';
export type textAlignLast =
  | 'auto'
  | 'start'
  | 'end'
  | 'left'
  | 'right'
  | 'center'
  | 'justify';
export type textCombineUpright = 'none' | 'all' | string;
export type textDecoration =
  | textDecorationLine
  | textDecorationStyle
  | textDecorationColor;
export type textDecorationColor = color;
export type textDecorationLine = 'none' | string;
export type textDecorationSkip = 'none' | string;
export type textDecorationStyle =
  | 'solid'
  | 'double'
  | 'dotted'
  | 'dashed'
  | 'wavy';
export type textEmphasis = textEmphasisStyle | textEmphasisColor;
export type textEmphasisColor = color;
export type textEmphasisPosition = string;
export type textEmphasisStyle = 'none' | string;
export type textIndent = string | 'hanging' | 'each-line';
export type textOrientation = 'mixed' | 'upright' | 'sideways';
export type textOverflow = string;
export type textRendering =
  | 'auto'
  | 'optimizeSpeed'
  | 'optimizeLegibility'
  | 'geometricPrecision';
type textShadowSyntax = {|
  x?: number,
  y?: number,
  blur?: number,
  color?: string,
|};
export type textShadow = 'none' | string | textShadowSyntax;
export type textSizeAdjust = 'none' | 'auto' | string;
export type textTransform =
  | 'none'
  | 'capitalize'
  | 'uppercase'
  | 'lowercase'
  | 'full-width';
export type textUnderlinePosition = 'auto' | string;
export type touchAction = 'auto' | 'none' | string | 'manipulation';
export type transform = 'none' | string;
export type transformBox = 'border-box' | 'fill-box' | 'view-box';
export type transformOrigin = string | number;
export type transformStyle = 'flat' | 'preserve-3d';
type transitionSyntax = {|
  property?: 'none' | singleTransitionProperty,
  duration?: number,
  timingFunction?: singleTransitionTimingFunction,
  delay?: number,
|};
export type transition =
  | singleTransition
  | transitionSyntax
  | Array<singleTransition | transitionSyntax>;
export type transitionDelay = number;
export type transitionDuration = number;
export type transitionProperty = 'none' | singleTransitionProperty;
export type transitionTimingFunction = singleTransitionTimingFunction;
export type unicodeBidi =
  | 'normal'
  | 'embed'
  | 'isolate'
  | 'bidi-override'
  | 'isolate-override'
  | 'plaintext';
export type userSelect = 'auto' | 'text' | 'none' | 'contain' | 'all';
export type verticalAlign =
  | 'baseline'
  | 'sub'
  | 'super'
  | 'text-top'
  | 'text-bottom'
  | 'middle'
  | 'top'
  | 'bottom'
  | string
  | number;
export type visibility = 'visible' | 'hidden' | 'collapse';
export type whiteSpace = 'normal' | 'pre' | 'nowrap' | 'pre-wrap' | 'pre-line';
export type widows = number;
export type width =
  | string
  | 'available'
  | 'min-content'
  | 'max-content'
  | 'fit-content'
  | 'auto';
export type willChange = 'auto' | animatableFeature;
export type wordBreak =
  | 'normal'
  | 'break-all'
  | 'keep-all'
  | nonStandardWordBreak;
export type wordSpacing = 'normal' | lengthPercentage;
export type wordWrap = 'normal' | 'break-word';
export type writingMode =
  | 'horizontal-tb'
  | 'vertical-rl'
  | 'vertical-lr'
  | 'sideways-rl'
  | 'sideways-lr'
  | svgWritingMode;
export type zIndex = 'auto' | number;
export type alignmentBaseline =
  | 'auto'
  | 'baseline'
  | 'before-edge'
  | 'text-before-edge'
  | 'middle'
  | 'central'
  | 'after-edge'
  | 'text-after-edge'
  | 'ideographic'
  | 'alphabetic'
  | 'hanging'
  | 'mathematical';
export type baselineShift = 'baseline' | 'sub' | 'super' | svgLength;
export type behavior = string;
export type clipRule = 'nonzero' | 'evenodd';
export type cue = cueBefore | cueAfter;
export type cueAfter = string | number | 'none';
export type cueBefore = string | number | 'none';
export type dominantBaseline =
  | 'auto'
  | 'use-script'
  | 'no-change'
  | 'reset-size'
  | 'ideographic'
  | 'alphabetic'
  | 'hanging'
  | 'mathematical'
  | 'central'
  | 'middle'
  | 'text-after-edge'
  | 'text-before-edge';
export type fill = paint;
export type fillOpacity = number;
export type fillRule = 'nonzero' | 'evenodd';
export type glyphOrientationHorizontal = number;
export type glyphOrientationVertical = number;
export type kerning = 'auto' | svgLength;
export type marker = 'none' | string;
export type markerEnd = 'none' | string;
export type markerMid = 'none' | string;
export type markerStart = 'none' | string;
export type pause = pauseBefore | pauseAfter;
export type pauseAfter =
  | number
  | 'none'
  | 'x-weak'
  | 'weak'
  | 'medium'
  | 'strong'
  | 'x-strong';
export type pauseBefore =
  | number
  | 'none'
  | 'x-weak'
  | 'weak'
  | 'medium'
  | 'strong'
  | 'x-strong';
export type rest = restBefore | restAfter;
export type restAfter =
  | number
  | 'none'
  | 'x-weak'
  | 'weak'
  | 'medium'
  | 'strong'
  | 'x-strong';
export type restBefore =
  | number
  | 'none'
  | 'x-weak'
  | 'weak'
  | 'medium'
  | 'strong'
  | 'x-strong';
export type shapeRendering =
  | 'auto'
  | 'optimizeSpeed'
  | 'crispEdges'
  | 'geometricPrecision';
export type src = string;
export type speak = 'auto' | 'none' | 'normal';
export type speakAs = 'normal' | 'spell-out' | 'digits' | string;
export type stroke = paint;
export type strokeDasharray = 'none' | string;
export type strokeDashoffset = svgLength;
export type strokeLinecap = 'butt' | 'round' | 'square';
export type strokeLinejoin = 'miter' | 'round' | 'bevel';
export type strokeMiterlimit = number;
export type strokeOpacity = number;
export type strokeWidth = svgLength;
export type textAnchor = 'start' | 'middle' | 'end';
export type unicodeRange = string;
export type voiceBalance =
  | number
  | 'left'
  | 'center'
  | 'right'
  | 'leftwards'
  | 'rightwards';
export type voiceDuration = 'auto' | number;
export type voiceFamily = string | 'preserve';
export type voicePitch = number | 'absolute' | string;
export type voiceRange = number | 'absolute' | string;
export type voiceRate = string;
export type voiceStress = 'normal' | 'strong' | 'moderate' | 'none' | 'reduced';
export type voiceVolume = 'silent' | string;
export type zoom = 'normal' | 'reset' | number | string;
export type absoluteSize =
  | 'xx-small'
  | 'x-small'
  | 'small'
  | 'medium'
  | 'large'
  | 'x-large'
  | 'xx-large';
export type animatableFeature = 'scroll-position' | 'contents' | string;
export type attachment = 'scroll' | 'fixed' | 'local';
export type bgImage = 'none' | string;
export type bgSize = string | 'cover' | 'contain';
export type box = 'border-box' | 'padding-box' | 'content-box';
export type brStyle =
  | 'none'
  | 'hidden'
  | 'dotted'
  | 'dashed'
  | 'solid'
  | 'double'
  | 'groove'
  | 'ridge'
  | 'inset'
  | 'outset';
export type borderWidth = number | 'thin' | 'medium' | 'thick' | string;
export type color = string;
export type compositeStyle =
  | 'clear'
  | 'copy'
  | 'source-over'
  | 'source-in'
  | 'source-out'
  | 'source-atop'
  | 'destination-over'
  | 'destination-in'
  | 'destination-out'
  | 'destination-atop'
  | 'xor';
export type compositeOperator = 'add' | 'subtract' | 'intersect' | 'exclude';
export type finalBgLayer =
  | bgImage
  | string
  | repeatStyle
  | attachment
  | box
  | backgroundColor;
export type geometryBox = shapeBox | 'fill-box' | 'stroke-box' | 'view-box';
export type gridLine = 'auto' | string;
export type lengthPercentage = number | string;
export type maskLayer =
  | maskReference
  | maskingMode
  | string
  | repeatStyle
  | geometryBox
  | compositeOperator;
export type maskReference = 'none' | string;
export type maskingMode = 'alpha' | 'luminance' | 'match-source';
export type relativeSize = 'larger' | 'smaller';
export type repeatStyle = 'repeat-x' | 'repeat-y' | string;
export type shapeBox = box | 'margin-box';
export type singleAnimation =
  | number
  | singleTimingFunction
  | singleAnimationIterationCount
  | singleAnimationDirection
  | singleAnimationFillMode
  | singleAnimationPlayState
  | singleAnimationName;
export type singleAnimationDirection =
  | 'normal'
  | 'reverse'
  | 'alternate'
  | 'alternate-reverse';
export type singleAnimationFillMode =
  | 'none'
  | 'forwards'
  | 'backwards'
  | 'both';
export type singleAnimationIterationCount = number;
export type singleAnimationName = 'none' | string;
export type singleAnimationPlayState = 'running' | 'paused';
export type singleTimingFunction = singleTransitionTimingFunction;
export type singleTransition = singleTransitionTimingFunction | string | number;
export type singleTransitionTimingFunction =
  | 'ease'
  | 'linear'
  | 'ease-in'
  | 'ease-out'
  | 'ease-in-out'
  | 'step-start'
  | 'step-end'
  | string;
export type singleTransitionProperty = 'all' | string;
export type trackBreadth =
  | lengthPercentage
  | string
  | 'min-content'
  | 'max-content'
  | 'auto';
export type trackSize = trackBreadth | string;
export type nonStandardWordBreak = 'break-word';
export type blendMode =
  | 'normal'
  | 'multiply'
  | 'screen'
  | 'overlay'
  | 'darken'
  | 'lighten'
  | 'color-dodge'
  | 'color-burn'
  | 'hard-light'
  | 'soft-light'
  | 'difference'
  | 'exclusion'
  | 'hue'
  | 'saturation'
  | 'color'
  | 'luminosity';
export type maskImage = maskReference;
export type outlineRadius = borderRadius;
export type paint = 'none' | 'currentColor' | color | string;
export type svgLength = string | number;
export type svgWritingMode = 'lr-tb' | 'rl-tb' | 'tb-rl' | 'lr' | 'rl' | 'tb';

export type CSSPropertyValue<Value> =
  | Value
  | ((props: Object, context: Object) => ?Value);

export type CSSPropertySet = {|
  alignContent?: CSSPropertyValue<alignContent>,
  alignItems?: CSSPropertyValue<alignItems>,
  alignSelf?: CSSPropertyValue<alignSelf>,
  all?: CSSPropertyValue<all>,
  animation?: CSSPropertyValue<animation>,
  animationDelay?: CSSPropertyValue<animationDelay>,
  animationDirection?: CSSPropertyValue<animationDirection>,
  animationDuration?: CSSPropertyValue<animationDuration>,
  animationFillMode?: CSSPropertyValue<animationFillMode>,
  animationIterationCount?: CSSPropertyValue<animationIterationCount>,
  animationName?: CSSPropertyValue<animationName>,
  animationPlayState?: CSSPropertyValue<animationPlayState>,
  animationTimingFunction?: CSSPropertyValue<animationTimingFunction>,
  appearance?: CSSPropertyValue<appearance>,
  azimuth?: CSSPropertyValue<azimuth>,
  backdropFilter?: CSSPropertyValue<backdropFilter>,
  backfaceVisibility?: CSSPropertyValue<backfaceVisibility>,
  background?: CSSPropertyValue<background>,
  backgroundAttachment?: CSSPropertyValue<backgroundAttachment>,
  backgroundBlendMode?: CSSPropertyValue<backgroundBlendMode>,
  backgroundClip?: CSSPropertyValue<backgroundClip>,
  backgroundColor?: CSSPropertyValue<backgroundColor>,
  backgroundImage?: CSSPropertyValue<backgroundImage>,
  backgroundOrigin?: CSSPropertyValue<backgroundOrigin>,
  backgroundPosition?: CSSPropertyValue<backgroundPosition>,
  backgroundPositionX?: CSSPropertyValue<backgroundPositionX>,
  backgroundPositionY?: CSSPropertyValue<backgroundPositionY>,
  backgroundRepeat?: CSSPropertyValue<backgroundRepeat>,
  backgroundSize?: CSSPropertyValue<backgroundSize>,
  blockSize?: CSSPropertyValue<blockSize>,
  border?: CSSPropertyValue<border>,
  borderBlockEnd?: CSSPropertyValue<borderBlockEnd>,
  borderBlockEndColor?: CSSPropertyValue<borderBlockEndColor>,
  borderBlockEndStyle?: CSSPropertyValue<borderBlockEndStyle>,
  borderBlockEndWidth?: CSSPropertyValue<borderBlockEndWidth>,
  borderBlockStart?: CSSPropertyValue<borderBlockStart>,
  borderBlockStartColor?: CSSPropertyValue<borderBlockStartColor>,
  borderBlockStartStyle?: CSSPropertyValue<borderBlockStartStyle>,
  borderBlockStartWidth?: CSSPropertyValue<borderBlockStartWidth>,
  borderBottom?: CSSPropertyValue<border>,
  borderBottomColor?: CSSPropertyValue<color>,
  borderBottomLeftRadius?: CSSPropertyValue<borderBottomLeftRadius>,
  borderBottomRightRadius?: CSSPropertyValue<borderBottomRightRadius>,
  borderBottomStyle?: CSSPropertyValue<borderBottomStyle>,
  borderBottomWidth?: CSSPropertyValue<borderBottomWidth>,
  borderCollapse?: CSSPropertyValue<borderCollapse>,
  borderColor?: CSSPropertyValue<borderColor>,
  borderImage?: CSSPropertyValue<borderImage>,
  borderImageOutset?: CSSPropertyValue<borderImageOutset>,
  borderImageRepeat?: CSSPropertyValue<borderImageRepeat>,
  borderImageSlice?: CSSPropertyValue<borderImageSlice>,
  borderImageSource?: CSSPropertyValue<borderImageSource>,
  borderImageWidth?: CSSPropertyValue<borderImageWidth>,
  borderInlineEnd?: CSSPropertyValue<borderInlineEnd>,
  borderInlineEndColor?: CSSPropertyValue<borderInlineEndColor>,
  borderInlineEndStyle?: CSSPropertyValue<borderInlineEndStyle>,
  borderInlineEndWidth?: CSSPropertyValue<borderInlineEndWidth>,
  borderInlineStart?: CSSPropertyValue<borderInlineStart>,
  borderInlineStartColor?: CSSPropertyValue<borderInlineStartColor>,
  borderInlineStartStyle?: CSSPropertyValue<borderInlineStartStyle>,
  borderInlineStartWidth?: CSSPropertyValue<borderInlineStartWidth>,
  borderLeft?: CSSPropertyValue<border>,
  borderLeftColor?: CSSPropertyValue<borderLeftColor>,
  borderLeftStyle?: CSSPropertyValue<borderLeftStyle>,
  borderLeftWidth?: CSSPropertyValue<borderLeftWidth>,
  borderRadius?: CSSPropertyValue<borderRadius>,
  borderRight?: CSSPropertyValue<border>,
  borderRightColor?: CSSPropertyValue<borderRightColor>,
  borderRightStyle?: CSSPropertyValue<borderRightStyle>,
  borderRightWidth?: CSSPropertyValue<borderRightWidth>,
  borderSpacing?: CSSPropertyValue<borderSpacing>,
  borderStyle?: CSSPropertyValue<borderStyle>,
  borderTop?: CSSPropertyValue<border>,
  borderTopColor?: CSSPropertyValue<color>,
  borderTopLeftRadius?: CSSPropertyValue<borderTopLeftRadius>,
  borderTopRightRadius?: CSSPropertyValue<borderTopRightRadius>,
  borderTopStyle?: CSSPropertyValue<borderTopStyle>,
  borderTopWidth?: CSSPropertyValue<borderTopWidth>,
  borderWidth?: CSSPropertyValue<borderWidth>,
  bottom?: CSSPropertyValue<number | string>,
  boxAlign?: CSSPropertyValue<boxAlign>,
  boxDecorationBreak?: CSSPropertyValue<boxDecorationBreak>,
  boxDirection?: CSSPropertyValue<boxDirection>,
  boxFlex?: CSSPropertyValue<boxFlex>,
  boxFlexGroup?: CSSPropertyValue<boxFlexGroup>,
  boxLines?: CSSPropertyValue<boxLines>,
  boxOrdinalGroup?: CSSPropertyValue<boxOrdinalGroup>,
  boxOrient?: CSSPropertyValue<boxOrient>,
  boxPack?: CSSPropertyValue<boxPack>,
  boxShadow?: CSSPropertyValue<boxShadow>,
  boxSizing?: CSSPropertyValue<boxSizing>,
  boxSuppress?: CSSPropertyValue<boxSuppress>,
  breakAfter?: CSSPropertyValue<breakAfter>,
  breakBefore?: CSSPropertyValue<breakBefore>,
  breakInside?: CSSPropertyValue<breakInside>,
  captionSide?: CSSPropertyValue<captionSide>,
  clear?: CSSPropertyValue<clear>,
  clip?: CSSPropertyValue<clip>,
  clipPath?: CSSPropertyValue<clipPath>,
  color?: CSSPropertyValue<color>,
  columnCount?: CSSPropertyValue<columnCount>,
  columnFill?: CSSPropertyValue<columnFill>,
  columnGap?: CSSPropertyValue<columnGap>,
  columnRule?: CSSPropertyValue<columnRule>,
  columnRuleColor?: CSSPropertyValue<columnRuleColor>,
  columnRuleStyle?: CSSPropertyValue<columnRuleStyle>,
  columnRuleWidth?: CSSPropertyValue<columnRuleWidth>,
  columnSpan?: CSSPropertyValue<columnSpan>,
  columnWidth?: CSSPropertyValue<columnWidth>,
  columns?: CSSPropertyValue<columns>,
  contain?: CSSPropertyValue<contain>,
  content?: CSSPropertyValue<content>,
  counterIncrement?: CSSPropertyValue<counterIncrement>,
  counterReset?: CSSPropertyValue<counterReset>,
  cursor?: CSSPropertyValue<cursor>,
  direction?: CSSPropertyValue<direction>,
  display?: CSSPropertyValue<display>,
  displayInside?: CSSPropertyValue<displayInside>,
  displayList?: CSSPropertyValue<displayList>,
  displayOutside?: CSSPropertyValue<displayOutside>,
  emptyCells?: CSSPropertyValue<emptyCells>,
  filter?: CSSPropertyValue<filter>,
  flex?: CSSPropertyValue<flex>,
  flexBasis?: CSSPropertyValue<flexBasis>,
  flexDirection?: CSSPropertyValue<flexDirection>,
  flexFlow?: CSSPropertyValue<flexFlow>,
  flexGrow?: CSSPropertyValue<flexGrow>,
  flexShrink?: CSSPropertyValue<flexShrink>,
  flexWrap?: CSSPropertyValue<flexWrap>,
  float?: CSSPropertyValue<float>,
  font?: CSSPropertyValue<font>,
  fontFamily?: CSSPropertyValue<fontFamily>,
  fontFeatureSettings?: CSSPropertyValue<fontFeatureSettings>,
  fontKerning?: CSSPropertyValue<fontKerning>,
  fontLanguageOverride?: CSSPropertyValue<fontLanguageOverride>,
  fontSize?: CSSPropertyValue<fontSize>,
  fontSizeAdjust?: CSSPropertyValue<fontSizeAdjust>,
  fontStretch?: CSSPropertyValue<fontStretch>,
  fontStyle?: CSSPropertyValue<fontStyle>,
  fontSynthesis?: CSSPropertyValue<fontSynthesis>,
  fontVariant?: CSSPropertyValue<fontVariant>,
  fontVariantAlternates?: CSSPropertyValue<fontVariantAlternates>,
  fontVariantCaps?: CSSPropertyValue<fontVariantCaps>,
  fontVariantEastAsian?: CSSPropertyValue<fontVariantEastAsian>,
  fontVariantLigatures?: CSSPropertyValue<fontVariantLigatures>,
  fontVariantNumeric?: CSSPropertyValue<fontVariantNumeric>,
  fontVariantPosition?: CSSPropertyValue<fontVariantPosition>,
  fontWeight?: CSSPropertyValue<fontWeight>,
  grid?: CSSPropertyValue<grid>,
  gridArea?: CSSPropertyValue<gridArea>,
  gridAutoColumns?: CSSPropertyValue<gridAutoColumns>,
  gridAutoFlow?: CSSPropertyValue<gridAutoFlow>,
  gridAutoRows?: CSSPropertyValue<gridAutoRows>,
  gridColumn?: CSSPropertyValue<gridColumn>,
  gridColumnEnd?: CSSPropertyValue<gridColumnEnd>,
  gridColumnGap?: CSSPropertyValue<gridColumnGap>,
  gridColumnStart?: CSSPropertyValue<gridColumnStart>,
  gridGap?: CSSPropertyValue<gridGap>,
  gridRow?: CSSPropertyValue<gridRow>,
  gridRowEnd?: CSSPropertyValue<gridRowEnd>,
  gridRowGap?: CSSPropertyValue<gridRowGap>,
  gridRowStart?: CSSPropertyValue<gridRowStart>,
  gridTemplate?: CSSPropertyValue<gridTemplate>,
  gridTemplateAreas?: CSSPropertyValue<gridTemplateAreas>,
  gridTemplateColumns?: CSSPropertyValue<gridTemplateColumns>,
  gridTemplateRows?: CSSPropertyValue<gridTemplateRows>,
  height?: CSSPropertyValue<number | string>,
  hyphens?: CSSPropertyValue<hyphens>,
  imageOrientation?: CSSPropertyValue<imageOrientation>,
  imageRendering?: CSSPropertyValue<imageRendering>,
  imageResolution?: CSSPropertyValue<imageResolution>,
  imeMode?: CSSPropertyValue<imeMode>,
  initialLetter?: CSSPropertyValue<initialLetter>,
  initialLetterAlign?: CSSPropertyValue<initialLetterAlign>,
  inlineSize?: CSSPropertyValue<inlineSize>,
  isolation?: CSSPropertyValue<isolation>,
  justifyContent?: CSSPropertyValue<justifyContent>,
  left?: CSSPropertyValue<number | string>,
  letterSpacing?: CSSPropertyValue<letterSpacing>,
  lineBreak?: CSSPropertyValue<lineBreak>,
  lineHeight?: CSSPropertyValue<lineHeight>,
  listStyle?: CSSPropertyValue<listStyle>,
  listStyleImage?: CSSPropertyValue<listStyleImage>,
  listStylePosition?: CSSPropertyValue<listStylePosition>,
  listStyleType?: CSSPropertyValue<listStyleType>,
  margin?: CSSPropertyValue<margin>,
  marginBlockEnd?: CSSPropertyValue<marginBlockEnd>,
  marginBlockStart?: CSSPropertyValue<marginBlockStart>,
  marginBottom?: CSSPropertyValue<marginBottom>,
  marginInlineEnd?: CSSPropertyValue<marginInlineEnd>,
  marginInlineStart?: CSSPropertyValue<marginInlineStart>,
  marginLeft?: CSSPropertyValue<marginLeft>,
  marginRight?: CSSPropertyValue<marginRight>,
  marginTop?: CSSPropertyValue<marginTop>,
  markerOffset?: CSSPropertyValue<markerOffset>,
  mask?: CSSPropertyValue<mask>,
  maskClip?: CSSPropertyValue<maskClip>,
  maskComposite?: CSSPropertyValue<maskComposite>,
  maskImage?: CSSPropertyValue<maskImage>,
  maskMode?: CSSPropertyValue<maskMode>,
  maskOrigin?: CSSPropertyValue<maskOrigin>,
  maskPosition?: CSSPropertyValue<maskPosition>,
  maskRepeat?: CSSPropertyValue<maskRepeat>,
  maskSize?: CSSPropertyValue<maskSize>,
  maskType?: CSSPropertyValue<maskType>,
  maxBlockSize?: CSSPropertyValue<maxBlockSize>,
  maxHeight?: CSSPropertyValue<maxHeight>,
  maxInlineSize?: CSSPropertyValue<maxInlineSize>,
  maxWidth?: CSSPropertyValue<maxWidth>,
  minBlockSize?: CSSPropertyValue<minBlockSize>,
  minHeight?: CSSPropertyValue<minHeight>,
  minInlineSize?: CSSPropertyValue<minInlineSize>,
  minWidth?: CSSPropertyValue<minWidth>,
  mixBlendMode?: CSSPropertyValue<mixBlendMode>,
  motion?: CSSPropertyValue<motion>,
  motionOffset?: CSSPropertyValue<motionOffset>,
  motionPath?: CSSPropertyValue<motionPath>,
  motionRotation?: CSSPropertyValue<motionRotation>,
  objectFit?: CSSPropertyValue<objectFit>,
  objectPosition?: CSSPropertyValue<objectPosition>,
  offsetBlockEnd?: CSSPropertyValue<offsetBlockEnd>,
  offsetBlockStart?: CSSPropertyValue<offsetBlockStart>,
  offsetInlineEnd?: CSSPropertyValue<offsetInlineEnd>,
  offsetInlineStart?: CSSPropertyValue<offsetInlineStart>,
  opacity?: CSSPropertyValue<opacity>,
  order?: CSSPropertyValue<order>,
  orphans?: CSSPropertyValue<orphans>,
  outline?: CSSPropertyValue<outline>,
  outlineColor?: CSSPropertyValue<outlineColor>,
  outlineOffset?: CSSPropertyValue<outlineOffset>,
  outlineStyle?: CSSPropertyValue<outlineStyle>,
  outlineWidth?: CSSPropertyValue<outlineWidth>,
  overflow?: CSSPropertyValue<overflow>,
  overflowClipBox?: CSSPropertyValue<overflowClipBox>,
  overflowWrap?: CSSPropertyValue<overflowWrap>,
  overflowX?: CSSPropertyValue<overflowX>,
  overflowY?: CSSPropertyValue<overflowY>,
  padding?: CSSPropertyValue<padding>,
  paddingBlockEnd?: CSSPropertyValue<paddingBlockEnd>,
  paddingBlockStart?: CSSPropertyValue<paddingBlockStart>,
  paddingBottom?: CSSPropertyValue<paddingBottom>,
  paddingInlineEnd?: CSSPropertyValue<paddingInlineEnd>,
  paddingInlineStart?: CSSPropertyValue<paddingInlineStart>,
  paddingLeft?: CSSPropertyValue<paddingLeft>,
  paddingRight?: CSSPropertyValue<paddingRight>,
  paddingTop?: CSSPropertyValue<paddingTop>,
  paddingH?: CSSPropertyValue<number | string>,
  paddingV?: CSSPropertyValue<number | string>,
  marginH?: CSSPropertyValue<number | string>,
  marginV?: CSSPropertyValue<number | string>,
  pageBreakAfter?: CSSPropertyValue<pageBreakAfter>,
  pageBreakBefore?: CSSPropertyValue<pageBreakBefore>,
  pageBreakInside?: CSSPropertyValue<pageBreakInside>,
  perspective?: CSSPropertyValue<perspective>,
  perspectiveOrigin?: CSSPropertyValue<perspectiveOrigin>,
  pointerEvents?: CSSPropertyValue<pointerEvents>,
  position?: CSSPropertyValue<position>,
  quotes?: CSSPropertyValue<quotes>,
  resize?: CSSPropertyValue<resize>,
  right?: CSSPropertyValue<number | string>,
  rubyAlign?: CSSPropertyValue<rubyAlign>,
  rubyMerge?: CSSPropertyValue<rubyMerge>,
  rubyPosition?: CSSPropertyValue<rubyPosition>,
  scrollBehavior?: CSSPropertyValue<scrollBehavior>,
  scrollSnapCoordinate?: CSSPropertyValue<scrollSnapCoordinate>,
  scrollSnapDestination?: CSSPropertyValue<scrollSnapDestination>,
  scrollSnapPointsX?: CSSPropertyValue<scrollSnapPointsX>,
  scrollSnapPointsY?: CSSPropertyValue<scrollSnapPointsY>,
  scrollSnapType?: CSSPropertyValue<scrollSnapType>,
  scrollSnapTypeX?: CSSPropertyValue<scrollSnapTypeX>,
  scrollSnapTypeY?: CSSPropertyValue<scrollSnapTypeY>,
  shapeImageThreshold?: CSSPropertyValue<shapeImageThreshold>,
  shapeMargin?: CSSPropertyValue<shapeMargin>,
  shapeOutside?: CSSPropertyValue<shapeOutside>,
  tabSize?: CSSPropertyValue<tabSize>,
  tableLayout?: CSSPropertyValue<tableLayout>,
  textAlign?: CSSPropertyValue<textAlign>,
  textAlignLast?: CSSPropertyValue<textAlignLast>,
  textCombineUpright?: CSSPropertyValue<textCombineUpright>,
  textDecoration?: CSSPropertyValue<textDecoration>,
  textDecorationColor?: CSSPropertyValue<textDecorationColor>,
  textDecorationLine?: CSSPropertyValue<textDecorationLine>,
  textDecorationSkip?: CSSPropertyValue<textDecorationSkip>,
  textDecorationStyle?: CSSPropertyValue<textDecorationStyle>,
  textEmphasis?: CSSPropertyValue<textEmphasis>,
  textEmphasisColor?: CSSPropertyValue<textEmphasisColor>,
  textEmphasisPosition?: CSSPropertyValue<textEmphasisPosition>,
  textEmphasisStyle?: CSSPropertyValue<textEmphasisStyle>,
  textIndent?: CSSPropertyValue<textIndent>,
  textOrientation?: CSSPropertyValue<textOrientation>,
  textOverflow?: CSSPropertyValue<textOverflow>,
  textRendering?: CSSPropertyValue<textRendering>,
  textShadow?: CSSPropertyValue<textShadow>,
  textSizeAdjust?: CSSPropertyValue<textSizeAdjust>,
  textTransform?: CSSPropertyValue<textTransform>,
  textUnderlinePosition?: CSSPropertyValue<textUnderlinePosition>,
  top?: CSSPropertyValue<number | string>,
  touchAction?: CSSPropertyValue<touchAction>,
  transform?: CSSPropertyValue<transform>,
  transformBox?: CSSPropertyValue<transformBox>,
  transformOrigin?: CSSPropertyValue<transformOrigin>,
  transformStyle?: CSSPropertyValue<transformStyle>,
  transition?: CSSPropertyValue<transition>,
  transitionDelay?: CSSPropertyValue<transitionDelay>,
  transitionDuration?: CSSPropertyValue<transitionDuration>,
  transitionProperty?: CSSPropertyValue<transitionProperty>,
  transitionTimingFunction?: CSSPropertyValue<transitionTimingFunction>,
  unicodeBidi?: CSSPropertyValue<unicodeBidi>,
  userSelect?: CSSPropertyValue<userSelect>,
  verticalAlign?: CSSPropertyValue<verticalAlign>,
  visibility?: CSSPropertyValue<visibility>,
  whiteSpace?: CSSPropertyValue<whiteSpace>,
  widows?: CSSPropertyValue<widows>,
  width?: CSSPropertyValue<number | string>,
  willChange?: CSSPropertyValue<willChange>,
  wordBreak?: CSSPropertyValue<wordBreak>,
  wordSpacing?: CSSPropertyValue<wordSpacing>,
  wordWrap?: CSSPropertyValue<wordWrap>,
  writingMode?: CSSPropertyValue<writingMode>,
  zIndex?: CSSPropertyValue<zIndex>,
  alignmentBaseline?: CSSPropertyValue<alignmentBaseline>,
  baselineShift?: CSSPropertyValue<baselineShift>,
  behavior?: CSSPropertyValue<behavior>,
  clipRule?: CSSPropertyValue<clipRule>,
  cue?: CSSPropertyValue<cue>,
  cueAfter?: CSSPropertyValue<cueAfter>,
  cueBefore?: CSSPropertyValue<cueBefore>,
  dominantBaseline?: CSSPropertyValue<dominantBaseline>,
  fill?: CSSPropertyValue<fill>,
  fillOpacity?: CSSPropertyValue<fillOpacity>,
  fillRule?: CSSPropertyValue<fillRule>,
  glyphOrientationHorizontal?: CSSPropertyValue<glyphOrientationHorizontal>,
  glyphOrientationVertical?: CSSPropertyValue<glyphOrientationVertical>,
  kerning?: CSSPropertyValue<kerning>,
  marker?: CSSPropertyValue<marker>,
  markerEnd?: CSSPropertyValue<markerEnd>,
  markerMid?: CSSPropertyValue<markerMid>,
  markerStart?: CSSPropertyValue<markerStart>,
  pause?: CSSPropertyValue<pause>,
  pauseAfter?: CSSPropertyValue<pauseAfter>,
  pauseBefore?: CSSPropertyValue<pauseBefore>,
  rest?: CSSPropertyValue<rest>,
  restAfter?: CSSPropertyValue<restAfter>,
  restBefore?: CSSPropertyValue<restBefore>,
  shapeRendering?: CSSPropertyValue<shapeRendering>,
  src?: CSSPropertyValue<src>,
  speak?: CSSPropertyValue<speak>,
  speakAs?: CSSPropertyValue<speakAs>,
  stroke?: CSSPropertyValue<stroke>,
  strokeDasharray?: CSSPropertyValue<strokeDasharray>,
  strokeDashoffset?: CSSPropertyValue<strokeDashoffset>,
  strokeLinecap?: CSSPropertyValue<strokeLinecap>,
  strokeLinejoin?: CSSPropertyValue<strokeLinejoin>,
  strokeMiterlimit?: CSSPropertyValue<strokeMiterlimit>,
  strokeOpacity?: CSSPropertyValue<strokeOpacity>,
  strokeWidth?: CSSPropertyValue<strokeWidth>,
  textAnchor?: CSSPropertyValue<textAnchor>,
  unicodeRange?: CSSPropertyValue<unicodeRange>,
  voiceBalance?: CSSPropertyValue<voiceBalance>,
  voiceDuration?: CSSPropertyValue<voiceDuration>,
  voiceFamily?: CSSPropertyValue<voiceFamily>,
  voicePitch?: CSSPropertyValue<voicePitch>,
  voiceRange?: CSSPropertyValue<voiceRange>,
  voiceRate?: CSSPropertyValue<voiceRate>,
  voiceStress?: CSSPropertyValue<voiceStress>,
  voiceVolume?: CSSPropertyValue<voiceVolume>,
  zoom?: CSSPropertyValue<zoom>,
|};
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type {Tracker} from '../index.js';
import {GarbageCollector} from '../gc.js';
import {StyleSheet} from '../sheet.js';

function createGC(): {|
  gc: GarbageCollector,
  tracker: Tracker,
|} {
  const sheet = new StyleSheet();
  const tracker = new Map();
  const rulesToClass = new WeakMap();

  const gc = new GarbageCollector(sheet, tracker, rulesToClass);
  return {gc, tracker};
}

test('register classes to be garbage collected when no references exist', () => {
  const {gc} = createGC();

  gc.registerClassUse('foo');
  expect(gc.getCollectionQueue()).toEqual([]);

  gc.deregisterClassUse('foo');
  expect(gc.getCollectionQueue()).toEqual(['foo']);
});

test('cancel garbage collection for classes used before actual collection happens', () => {
  const {gc} = createGC();

  gc.registerClassUse('foo');
  expect(gc.getCollectionQueue()).toEqual([]);

  gc.deregisterClassUse('foo');
  expect(gc.getCollectionQueue()).toEqual(['foo']);

  gc.registerClassUse('foo');
  expect(gc.getCollectionQueue()).toEqual([]);
});

test('garbage collector removes unreferenced classes', () => {
  const {gc, tracker} = createGC();

  tracker.set('foo', {
    displayName: 'foo',
    namespace: '',
    selector: '',
    style: {},
    rules: {},
  });

  gc.registerClassUse('foo');
  expect(gc.getCollectionQueue()).toEqual([]);

  gc.deregisterClassUse('foo');
  expect(gc.getCollectionQueue()).toEqual(['foo']);
  expect(gc.hasQueuedCollection()).toBe(true);
  expect(tracker.has('foo')).toBe(true);

  gc.collectGarbage();
  expect(gc.hasQueuedCollection()).toBe(false);
  expect(gc.getCollectionQueue()).toEqual([]);
  expect(tracker.has('foo')).toBe(false);
});

test('properly tracks reference counts', () => {
  const {gc} = createGC();

  gc.registerClassUse('foo');
  gc.registerClassUse('foo');
  gc.registerClassUse('bar');
  expect(gc.getReferenceCount('foo')).toBe(2);
  expect(gc.getReferenceCount('bar')).toBe(1);

  gc.deregisterClassUse('bar');
  expect(gc.getReferenceCount('bar')).toBe(0);

  gc.deregisterClassUse('foo');
  expect(gc.getReferenceCount('foo')).toBe(1);

  gc.deregisterClassUse('foo');
  expect(gc.getReferenceCount('foo')).toBe(0);
});

test("gracefully handle deregistering classes we don't have a count for", () => {
  const {gc} = createGC();
  gc.deregisterClassUse('not-tracking');
});

test('only halt garbage collection if there is nothing left in the queue', () => {
  const {gc} = createGC();

  gc.registerClassUse('foo');
  expect(gc.hasQueuedCollection()).toBe(false);

  gc.deregisterClassUse('foo');
  expect(gc.hasQueuedCollection()).toBe(true);

  gc.registerClassUse('bar');
  expect(gc.hasQueuedCollection()).toBe(true);

  gc.deregisterClassUse('bar');
  expect(gc.hasQueuedCollection()).toBe(true);

  gc.registerClassUse('bar');
  expect(gc.hasQueuedCollection()).toBe(true);

  gc.registerClassUse('foo');
  expect(gc.hasQueuedCollection()).toBe(false);
});

test('ensure garbage collection happens', () => {
  const {gc} = createGC();

  gc.registerClassUse('foo');
  gc.deregisterClassUse('foo');
  expect(gc.hasQueuedCollection()).toBe(true);
  expect(gc.getCollectionQueue()).toEqual(['foo']);

  jest.runAllTimers();
  expect(gc.hasQueuedCollection()).toBe(false);
  expect(gc.getCollectionQueue()).toEqual([]);
});

test('flush', () => {
  const {gc} = createGC();

  gc.registerClassUse('bar');
  gc.deregisterClassUse('bar');
  expect(gc.getCollectionQueue()).toEqual(['bar']);
  expect(gc.getReferenceCount('bar')).toBe(0);

  gc.registerClassUse('foo');
  expect(gc.getReferenceCount('foo')).toBe(1);

  gc.flush();
  expect(gc.getCollectionQueue()).toEqual([]);
  expect(gc.getReferenceCount('foo')).toBe(0);
});
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import hash from '../hash.js';

test('hash', () => {
  expect(hash('f')).toBe('1xwd1rk');
  expect(hash('foobar')).toBe('slolri');
  expect(hash('foobar2')).toBe('34u6r4');
});
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import styled, {buildKeyframes, flush, gc, tracker} from '../index.js';

const ReactTestRenderer = require('react-test-renderer');
const invariant = require('invariant');
const React = require('react'); // eslint-disable-line

const BasicComponent = styled.view({
  color: 'red',
});

const DynamicComponent = styled.view({
  color: props => props.color,
});

test('can create a basic component without any errors', () => {
  let component;

  try {
    component = ReactTestRenderer.create(<BasicComponent />);
    component.toJSON();
    component.unmount();
    gc.flush();
  } finally {
    if (component) {
      component.unmount();
    }
    gc.flush();
  }
});

test('can create a basic component and garbage collect', () => {
  let component;

  try {
    component = ReactTestRenderer.create(<BasicComponent />);
    const tree = component.toJSON();

    expect(tree.type).toBe('div');

    const className = tree.props.className;
    expect(gc.hasQueuedCollection()).toBe(false);
    expect(gc.getReferenceCount(className)).toBe(1);

    component.unmount();
    expect(gc.getReferenceCount(className)).toBe(0);
    expect(gc.hasQueuedCollection()).toBe(true);
  } finally {
    if (component) {
      component.unmount();
    }
    gc.flush();
  }
});

test('remove outdated classes when updating component', () => {
  let component;

  try {
    component = ReactTestRenderer.create(<DynamicComponent color="red" />);
    const tree = component.toJSON();

    const className = tree.props.className;
    expect(gc.hasQueuedCollection()).toBe(false);
    expect(gc.getReferenceCount(className)).toBe(1);

    // updating with the same props should generate the same style and not trigger a collection
    component.update(<DynamicComponent color="red" />);
    expect(gc.hasQueuedCollection()).toBe(false);
    expect(gc.getReferenceCount(className)).toBe(1);

    // change style
    component.update(<DynamicComponent color="blue" />);
    expect(gc.hasQueuedCollection()).toBe(true);
    expect(gc.getReferenceCount(className)).toBe(0);
  } finally {
    if (component) {
      component.unmount();
    }
    gc.flush();
  }
});

test('extra class names should be preserved', () => {
  let component;

  try {
    component = ReactTestRenderer.create(<BasicComponent className="foo" />);
    const tree = component.toJSON();
    expect(tree.props.className.split(' ').includes('foo')).toBe(true);
  } finally {
    if (component) {
      component.unmount();
    }
    gc.flush();
  }
});

test('should inherit component when passed as first arg to styled', () => {
  let component;

  try {
    const InheritComponent = BasicComponent.extends({
      backgroundColor: 'black',
    });

    component = ReactTestRenderer.create(<InheritComponent />);
    const tree = component.toJSON();

    const rules = tracker.get(tree.props.className);
    invariant(rules, 'expected rules');
    expect(rules.style).toEqual({
      'background-color': 'black',
      color: 'red',
    });
  } finally {
    if (component) {
      component.unmount();
    }
    gc.flush();
  }
});

test("when passed class name of another styled component it's rules should be inherited", () => {
  let component;

  try {
    class BaseComponent extends styled.StylableComponent<{
      className: string,
    }> {
      render() {
        return <BasicComponent className={this.props.className} />;
      }
    }

    const InheritComponent = BaseComponent.extends({
      backgroundColor: 'black',
    });

    component = ReactTestRenderer.create(<InheritComponent />);
    const tree = component.toJSON();

    const rules = tracker.get(tree.props.className);
    invariant(rules, 'expected rules');
    expect(rules.style).toEqual({
      'background-color': 'black',
      color: 'red',
    });
  } finally {
    if (component) {
      component.unmount();
    }
    gc.flush();
  }
});

test('supports pseudo selectors', () => {
  let component;

  try {
    const Component = styled.view({
      '&:hover': {
        color: 'red',
      },
    });

    component = ReactTestRenderer.create(<Component />);
    const tree = component.toJSON();

    const rules = tracker.get(tree.props.className);
    invariant(rules, 'expected rules');
    expect(rules.style).toEqual({
      color: 'red',
    });
  } finally {
    if (component) {
      component.unmount();
    }
    gc.flush();
  }
});

test('supports multiple pseudo selectors', () => {
  let component;

  try {
    const Component = styled.view({
      '&:active': {
        color: 'blue',
      },

      '&:hover': {
        color: 'red',
      },
    });

    component = ReactTestRenderer.create(<Component />);
    const tree = component.toJSON();

    const classes = tree.props.className.split(' ');
    expect(classes.length).toBe(2);

    const hoverRules = tracker.get(classes[1]);
    invariant(hoverRules, 'expected hoverRules');
    expect(hoverRules.style).toEqual({
      color: 'red',
    });
    expect(hoverRules.namespace).toBe('&:hover');
    expect(hoverRules.selector.endsWith(':hover')).toBe(true);

    const activeRules = tracker.get(classes[0]);
    invariant(activeRules, 'expected activeRules');
    expect(activeRules.style).toEqual({
      color: 'blue',
    });
    expect(activeRules.namespace).toBe('&:active');
    expect(activeRules.selector.endsWith(':active')).toBe(true);
  } finally {
    if (component) {
      component.unmount();
    }
    gc.flush();
  }
});

test('supports child selectors', () => {
  let component;

  try {
    const Component = styled.view({
      '> li': {
        color: 'red',
      },
    });

    component = ReactTestRenderer.create(<Component />);
    const tree = component.toJSON();

    const classes = tree.props.className.split(' ');
    expect(classes.length).toBe(1);

    const rules = tracker.get(classes[0]);
    invariant(rules, 'expected rules');

    expect(rules.style).toEqual({
      color: 'red',
    });
    expect(rules.namespace).toBe('> li');
    expect(rules.selector.endsWith(' > li')).toBe(true);
  } finally {
    if (component) {
      component.unmount();
    }
    gc.flush();
  }
});

test('flush', () => {
  flush();
});

test('innerRef works on styled components', () => {
  let component;

  try {
    const Component = styled.view({});

    let called = false;
    const innerRef = ref => {
      called = true;
    };
    ReactTestRenderer.create(<Component innerRef={innerRef} />);
    expect(called).toBe(true);
  } finally {
    if (component) {
      component.unmount();
    }
    gc.flush();
  }
});

test('ignoreAttributes', () => {
  let component;

  try {
    const Component = styled.view(
      {
        color: props => props.color,
      },
      {
        ignoreAttributes: ['color'],
      },
    );

    component = ReactTestRenderer.create(<Component color="red" />);
    const tree = component.toJSON();

    expect(tree.props.color).toBe(undefined);

    const rules = tracker.get(tree.props.className);
    invariant(rules, 'expected rules');
    expect(rules.style).toEqual({
      color: 'red',
    });
  } finally {
    if (component) {
      component.unmount();
    }
    gc.flush();
  }
});
test('buildKeyframes', () => {
  const css = buildKeyframes({
    '0%': {
      opacity: 0,
    },

    '50%': {
      height: 50,
      opacity: 0.8,
    },

    '100%': {
      opacity: 1,
    },
  });

  expect(css).toBe(
    [
      '  0% {',
      '    opacity: 0;',
      '  }',
      '  50% {',
      '    height: 50px;',
      '    opacity: 0.8;',
      '  }',
      '  100% {',
      '    opacity: 1;',
      '  }',
    ].join('\n'),
  );
});

test('keyframes', () => {
  const className = styled.keyframes({
    '0%': {
      opacity: 0,
    },

    '50%': {
      opacity: 0.8,
    },

    '100%': {
      opacity: 1,
    },
  });
  expect(typeof className).toBe('string');
});

test('buildKeyframes only accepts string property values', () => {
  expect(() => {
    buildKeyframes({
      // $FlowFixMe: ignore
      '0%': {
        fn: () => {},
      },
    });
  }).toThrow('Keyframe objects must only have strings values');
});

test('buildKeyframes only accepts object specs', () => {
  expect(() => {
    buildKeyframes({
      // $FlowFixMe: ignore
      '0%': () => {
        return '';
      },
    });
  }).toThrow('Keyframe spec must only have objects');
});
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import {buildRules, normaliseRules} from '../rules.js';

describe('normaliseRules', () => {
  test('ensure top level values are expanded', () => {
    const normalisedRules = normaliseRules({height: '4px'});
    expect(normalisedRules['&'].height).toBe('4px');
  });

  test('ensure keys are dashed', () => {
    const normalisedRules = normaliseRules({
      // $FlowFixMe: ignore
      '&:hover': {
        lineHeight: '4px',
        WebkitAppRegion: 'drag',
      },
    });
    const hoverRules = normalisedRules['&:hover'];
    expect(Object.keys(hoverRules).length).toBe(2);
    expect(hoverRules['line-height']).toBe('4px');
    expect(hoverRules['-webkit-app-region']).toBe('drag');
  });

  test('exclude empty objects', () => {
    const normalisedRules = normaliseRules({
      '&:hover': {},
    });

    expect(normalisedRules['&:hover']).toBe(undefined);
  });
});

describe('buildRules', () => {
  test('ensure null values are left out', () => {
    const builtRules = buildRules({height: (null: any)}, {}, {});
    expect('height' in builtRules).toBe(false);

    const builtRules2 = buildRules(
      {
        height() {
          return (null: any);
        },
      },
      {},
      {},
    );
    expect('height' in builtRules2).toBe(false);
  });

  test('ensure numbers are appended with px', () => {
    expect(buildRules({height: 40}, {}, {}).height).toBe('40px');
  });

  test("ensure unitless numbers aren't appended with px", () => {
    expect(buildRules({'z-index': 4}, {}, {})['z-index']).toBe('4');
  });

  test('ensure functions are called with props', () => {
    const thisProps = {};
    expect(
      buildRules(
        {
          border: props => (props === thisProps ? 'foo' : 'bar'),
        },
        thisProps,
        {},
      ).border,
    ).toBe('foo');
  });
});
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import {StyleSheet} from '../sheet.js';

describe('flush', () => {
  test('should remove all rules', () => {
    const sheet = new StyleSheet();
    expect(sheet.getRuleCount()).toBe(0);

    sheet.insert('foo', 'div {color: red;}');
    expect(sheet.getRuleCount()).toBe(1);

    sheet.flush();
    expect(sheet.getRuleCount()).toBe(0);
  });
});

describe('inject', () => {
  test("throw's an error when already injected", () => {
    const sheet = new StyleSheet();

    expect(() => {
      sheet.inject();
      sheet.inject();
    }).toThrow('already injected stylesheet!');
  });
});

describe('insert', () => {
  test('non-speedy', () => {
    const sheet = new StyleSheet();

    expect(sheet.getRuleCount()).toBe(0);
    sheet.insert('foo', 'div {color: red;}');
    expect(sheet.getRuleCount()).toBe(1);
  });

  test('speedy', () => {
    const sheet = new StyleSheet(true);

    expect(sheet.getRuleCount()).toBe(0);
    sheet.insert('foo', 'div {color: red;}');
    expect(sheet.getRuleCount()).toBe(1);
  });
});

describe('delete', () => {
  test('non-speedy', () => {
    const sheet = new StyleSheet();

    expect(sheet.getRuleCount()).toBe(0);
    sheet.insert('foo', 'div {color: red;}');
    expect(sheet.getRuleCount()).toBe(1);

    sheet.delete('foo');
    expect(sheet.getRuleCount()).toBe(0);
  });

  test('speedy', () => {
    const sheet = new StyleSheet(true);

    expect(sheet.getRuleCount()).toBe(0);
    sheet.insert('foo', 'div {color: red;}');
    expect(sheet.getRuleCount()).toBe(1);

    sheet.delete('foo');
    expect(sheet.getRuleCount()).toBe(0);
  });
});
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type {RowRenderer, OnScroll, KeyMapper} from './types.js';
import {PureComponent, Component} from 'react';
import {ResizeSensor} from '../index.js';
import {findDOMNode} from 'react-dom';

type RowMeasureProps = {
  id: string,
  onMount: (key: string, ref: ?Text | Element) => void,
  children: React$Node,
};

class RowMeasure extends PureComponent<RowMeasureProps> {
  componentDidMount() {
    this.props.onMount(this.props.id, findDOMNode(this));
  }

  render() {
    return this.props.children;
  }
}

const CONTAINER_STYLE = {
  position: 'relative',
  overflow: 'auto',
  width: '100%',
  height: '100%',
};

type DynamicListProps = {
  pureData: any,
  onMount?: () => void,
  getPrecalculatedDimensions: (
    index: number,
  ) => ?{
    width: number | string,
    height: number,
  },
  rowCount: number,
  rowRenderer: RowRenderer,
  keyMapper: KeyMapper,
  onScroll?: OnScroll,
  sideScrollable?: boolean,
};

type DynamicListState = {
  mounted: boolean,
  startIndex: number,
  endIndex: number,
  containerStyle: Object,
  innerStyle: Object,
  scrollHeight: number,
  scrollTop: number,
  height: number,
  width: number,
};

export default class DynamicList extends Component<
  DynamicListProps,
  DynamicListState,
> {
  constructor(props: DynamicListProps, context: Object) {
    super(props, context);

    this.topPositionToIndex = new Map();
    this.positions = new Map();
    this.dimensions = new Map();
    this.measureQueue = new Map();

    this.state = {
      mounted: false,
      startIndex: -1,
      endIndex: -1,
      containerStyle: {},
      innerStyle: {},
      scrollHeight: 0,
      scrollTop: 0,
      height: 0,
      width: 0,
    };
  }

  containerRef: ?HTMLDivElement;

  measureQueue: Map<string, React$Node>;

  topPositionToIndex: Map<number, number>;
  positions: Map<
    number,
    {
      top: number,
      style: Object,
    },
  >;

  dimensions: Map<
    string,
    {
      width: number | string,
      height: number,
    },
  >;

  scrollToIndex = (index: number, additionalOffset: number = 0) => {
    const pos = this.positions.get(index);
    const ref = this.getContainerRef();
    if (pos != null && ref != null) {
      ref.scrollTop = pos.top - additionalOffset;
    }
  };

  setContainerRef = (ref: ?HTMLDivElement) => {
    this.containerRef = ref;
  };

  getContainerRef(): ?HTMLDivElement {
    return this.containerRef;
  }

  componentWillReceiveProps(nextProps: DynamicListProps) {
    if (
      nextProps.rowCount !== this.props.rowCount ||
      nextProps.pureData !== this.props.pureData
    ) {
      this.queueMeasurements(nextProps);
    }
  }

  componentDidMount() {
    // perform initial measurements and container dimension calculation
    this.recalculateContainerDimensions();
    this.queueMeasurements(this.props);

    // if onMount we didn't add any measurements then we've successfully calculated all row sizes
    if (this.measureQueue.size === 0) {
      this.onMount();
    }
  }

  onMount() {
    this.setState(state => {
      if (state.mounted === false && this.props.onMount != null) {
        this.props.onMount();
      }
      return {mounted: true};
    });
  }

  // called when the window is resized, we recalculate the positions and visibility of rows
  onResize = (e: UIEvent) => {
    this.dimensions.clear();
    this.queueMeasurements(this.props);
    this.recalculateContainerDimensions();
    this.recalculateVisibleRows(this.props);
  };

  queueMeasurements(props: DynamicListProps) {
    // create measurements for new rows
    for (let i = 0; i < props.rowCount; i++) {
      const key = props.keyMapper(i);
      if (this.dimensions.has(key)) {
        continue;
      }

      const precalculated = props.getPrecalculatedDimensions(i);
      if (precalculated) {
        this.dimensions.set(key, precalculated);
        continue;
      }

      this.measureQueue.set(
        key,
        props.rowRenderer({
          index: i,
          style: {
            visibility: 'hidden',
          },
        }),
      );
    }

    // recalculate the visibility and positions of all rows
    this.recalculatePositions(props);
    this.recalculateVisibleRows(props);
  }

  recalculateContainerDimensions = () => {
    const container = this.getContainerRef();
    if (container != null) {
      this.setState({
        scrollTop: container.scrollTop,
        height: container.clientHeight,
        width: container.clientWidth,
      });
    }
  };

  recalculateVisibleRows = (props: DynamicListProps) => {
    this.setState(state => {
      let startTop = 0;

      // find the start index
      let startIndex = 0;
      let scrollTop = state.scrollTop;
      do {
        const index = this.topPositionToIndex.get(scrollTop);
        if (index != null) {
          const startPos = this.positions.get(index);
          if (startPos != null) {
            startTop = startPos.top;
            startIndex = index;
            break;
          }
        }

        scrollTop--;
      } while (scrollTop > 0);

      // find the end index
      let endIndex = startIndex;
      let scrollBottom = state.scrollTop + state.height;
      while (true) {
        // if the scrollBottom is equal to the height of the scrollable area then
        // we were unable to find the end index because we're at the bottom of the
        // list
        if (scrollBottom >= state.scrollHeight) {
          endIndex = props.rowCount - 1;
          break;
        }

        const index = this.topPositionToIndex.get(scrollBottom);
        if (index != null) {
          endIndex = index;
          break;
        }

        scrollBottom++;
      }

      if (
        startIndex === state.startIndex &&
        endIndex === state.endIndex &&
        startTop === state.containerStyle.top
      ) {
        // this is to ensure that we don't create a new containerStyle object and obey reference equality for purity checks
        return {};
      }

      const sideScrollable = props.sideScrollable || false;

      return {
        startIndex,
        endIndex,
        containerStyle: sideScrollable
          ? {
              position: 'absolute',
              top: startTop,
              left: 0,
              minWidth: '100%',
            }
          : {
              position: 'absolute',
              top: startTop,
              right: 0,
              left: 0,
            },
      };
    });
  };

  onRowMeasured = (key: string, elem: ?Text | Element) => {
    if (elem != null && elem instanceof HTMLElement) {
      const dim = {
        height: elem.clientHeight,
        width: elem.clientWidth,
      };
      this.dimensions.set(key, dim);
    }

    this.measureQueue.delete(key);

    if (this.measureQueue.size === 0) {
      this.recalculatePositions(this.props);

      if (this.state.mounted === false) {
        // we triggered measurements on componentDidMount and they're now complete!
        this.onMount();
      }
    }
  };

  handleScroll = () => {
    // recalcualte visible rows
    const ref = this.getContainerRef();
    if (ref != null) {
      this.setState({
        scrollTop: ref.scrollTop,
      });
      this.recalculateVisibleRows(this.props);

      this.props.onScroll &&
        this.props.onScroll({
          clientHeight: ref.clientHeight,
          scrollHeight: ref.scrollHeight,
          scrollTop: ref.scrollTop,
        });
    }
  };

  recalculatePositions(props: DynamicListProps) {
    this.positions.clear();
    this.topPositionToIndex.clear();

    let top = 0;

    for (let i = 0; i < props.rowCount; i++) {
      const key = props.keyMapper(i);
      const dim = this.dimensions.get(key);
      if (dim == null) {
        continue;
      }

      this.positions.set(i, {
        top,
        style: {
          width: dim.width,
          height: dim.height,
        },
      });

      this.topPositionToIndex.set(top, i);

      top += dim.height;
    }

    this.setState({
      scrollHeight: top,
      innerStyle: {
        height: top,
        overflow: 'visibile',
        position: 'relative',
      },
    });
  }

  render() {
    // add elements to be measured
    const measureChildren = [];
    for (const [key, value] of this.measureQueue) {
      measureChildren.push(
        <RowMeasure key={key} id={key} onMount={this.onRowMeasured}>
          {value}
        </RowMeasure>,
      );
    }

    // add visible rows
    const children = [];
    for (let i = this.state.startIndex; i <= this.state.endIndex; i++) {
      const pos = this.positions.get(i);
      if (pos == null) {
        continue;
      }

      children.push(
        this.props.rowRenderer({
          index: i,
          style: pos.style,
        }),
      );
    }

    return (
      <div
        ref={this.setContainerRef}
        onScroll={this.handleScroll}
        style={CONTAINER_STYLE}>
        <ResizeSensor onResize={this.onResize} />
        <div style={this.state.innerStyle}>
          <div style={this.state.containerStyle}>{children}</div>
        </div>
        {measureChildren}
      </div>
    );
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type {RowRenderer, OnScroll, KeyMapper} from './types.js';
import DynamicList from './DynamicList.js';
import {PureComponent} from 'react';

type FixedListProps = {
  pureData: any,
  rowCount: number,
  rowHeight: number,
  rowRenderer: RowRenderer,
  onScroll?: OnScroll,
  keyMapper: KeyMapper,
  innerRef?: (ref: DynamicList) => void,
  onMount?: () => void,
  sideScrollable?: boolean,
};

export default class FixedList extends PureComponent<FixedListProps> {
  getPrecalculatedDimensions = () => {
    return {
      height: this.props.rowHeight,
      width: '100%',
    };
  };

  render() {
    return (
      <DynamicList
        ref={(this.props.innerRef: any)}
        onMount={this.props.onMount}
        pureData={this.props.pureData}
        rowCount={this.props.rowCount}
        rowRenderer={this.props.rowRenderer}
        keyMapper={this.props.keyMapper}
        onScroll={this.props.onScroll}
        sideScrollable={this.props.sideScrollable}
        getPrecalculatedDimensions={this.getPrecalculatedDimensions}
      />
    );
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

export {default as FixedList} from './FixedList.js';
export {default as DynamicList} from './DynamicList.js';
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

export type OnScroll = (params: {
  scrollHeight: number,
  scrollTop: number,
  clientHeight: number,
}) => void;

export type KeyMapper = (index: number) => string;

export type RowRenderer = (params: {
  index: number,
  style: Object,
}) => React$Node;
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

function isObject(val: mixed): boolean {
  return (
    Boolean(val) &&
    typeof val === 'object' &&
    Object.prototype.toString.call(val) === '[object Object]'
  );
}

export default function assignDeep<T: Object>(
  base: T,
  ...reduces: Array<Object>
): T {
  base = Object.assign({}, base);

  for (const reduce of reduces) {
    for (const key in reduce) {
      const baseVal = base[key];
      const val = reduce[key];

      if (isObject(val) && isObject(baseVal)) {
        base[key] = assignDeep(baseVal, val);
      } else if (typeof val === 'undefined') {
        delete base[key];
      } else {
        base[key] = val;
      }
    }
  }

  return base;
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import LogManager from '../fb-stubs/Logger';
const fs = require('fs');
const adb = require('adbkit-fb');
import {
  openssl,
  isInstalled as opensslInstalled,
} from './openssl-wrapper-with-promises';
const path = require('path');

// Desktop file paths
const os = require('os');
const caKey = getFilePath('ca.key');
const caCert = getFilePath('ca.crt');
const serverKey = getFilePath('server.key');
const serverCsr = getFilePath('server.csr');
const serverCert = getFilePath('server.crt');

// Device file paths
const csrFileName = 'app.csr';
const deviceCAcertFile = 'sonarCA.crt';
const deviceClientCertFile = 'device.crt';

const caSubject = '/C=US/ST=CA/L=Menlo Park/O=Sonar/CN=SonarCA';
const serverSubject = '/C=US/ST=CA/L=Menlo Park/O=Sonar/CN=localhost';
const minCertExpiryWindowSeconds = 24 * 60 * 60;
const appNotDebuggableRegex = /debuggable/;
const allowedAppNameRegex = /^[a-zA-Z0-9.\-]+$/;
const allowedAppDirectoryRegex = /^\/[ a-zA-Z0-9.\-\/]+$/;

export type SecureServerConfig = {|
  key: Buffer,
  cert: Buffer,
  ca: Buffer,
  requestCert: boolean,
  rejectUnauthorized: boolean,
|};

/*
 * This class is responsible for generating and deploying server and client
 * certificates to allow for secure communication between sonar and apps.
 * It takes a Certificate Signing Request which was generated by the app,
 * using the app's public/private keypair.
 * With this CSR it uses the sonar CA to sign a client certificate which it
 * deploys securely to the app.
 * It also deploys the sonar CA cert to the app.
 * The app can trust a server if and only if it has a certificate signed by the
 * sonar CA.
*/
export default class CertificateProvider {
  logger: LogManager;
  adb: any;
  certificateSetup: Promise<void>;
  server: Server;

  constructor(server: Server, logger: LogManager) {
    this.logger = logger;
    this.adb = adb.createClient();
    this.certificateSetup = this.ensureServerCertExists();
    this.server = server;
  }

  processCertificateSigningRequest(
    csr: string,
    os: string,
    appDirectory: string,
  ): Promise<void> {
    this.ensureOpenSSLIsAvailable();
    if (!appDirectory.match(allowedAppDirectoryRegex)) {
      return Promise.reject(
        new Error(
          `Invalid appDirectory recieved from ${os} device: ${appDirectory}`,
        ),
      );
    }
    return this.certificateSetup
      .then(_ => this.getCACertificate())
      .then(caCert =>
        this.deployFileToMobileApp(
          appDirectory,
          deviceCAcertFile,
          caCert,
          csr,
          os,
        ),
      )
      .then(_ => this.generateClientCertificate(csr))
      .then(clientCert =>
        this.deployFileToMobileApp(
          appDirectory,
          deviceClientCertFile,
          clientCert,
          csr,
          os,
        ),
      );
  }

  ensureOpenSSLIsAvailable(): void {
    if (!opensslInstalled()) {
      const e = Error(
        "It looks like you don't have OpenSSL installed. Please install it to continue.",
      );
      this.server.emit('error', e);
    }
  }

  getCACertificate(): Promise<string> {
    return new Promise((resolve, reject) => {
      fs.readFile(caCert, (err, data) => {
        if (err) {
          reject(err);
        } else {
          resolve(data.toString());
        }
      });
    });
  }

  generateClientCertificate(csr: string): Promise<string> {
    this.logger.warn('Creating new client cert', 'CertificateProvider');
    const csrFile = this.writeToTempFile(csr);
    // Create a certificate for the client, using the details in the CSR.
    return openssl('x509', {
      req: true,
      in: csrFile,
      CA: caCert,
      CAkey: caKey,
      CAcreateserial: true,
    }).then(cert => {
      fs.unlinkSync(csrFile);
      return cert;
    });
  }

  deployFileToMobileApp(
    destination: string,
    filename: string,
    contents: string,
    csr: string,
    os: string,
  ) {
    if (os === 'Android') {
      this.extractAppNameFromCSR(csr).then(app => {
        const client = adb.createClient();
        client.listDevices().then((devices: Array<{id: string}>) => {
          devices.forEach(d =>
            // To find out which device requested the cert, search them
            // all for a matching csr file.
            // It's not important to keep these secret from other apps.
            // Just need to make sure each app can find it's own one.
            this.androidDeviceHasMatchingCSR(destination, d.id, app, csr)
              .catch(e =>
                this.logger.error(
                  `Unable to check for matching CSR in ${d.id}:${app}`,
                  'CertificateProvider',
                ),
              )
              .then(isMatch => {
                if (isMatch) {
                  this.pushFileToAndroidDevice(
                    d.id,
                    app,
                    destination + filename,
                    contents,
                  );
                }
              }),
          );
        });
      });
    }
    if (os === 'iOS') {
      fs.writeFileSync(destination + filename, contents);
    }
  }

  androidDeviceHasMatchingCSR(
    directory: string,
    deviceId: string,
    processName: string,
    csr: string,
  ): Promise<boolean> {
    return this.executeCommandOnAndroid(
      deviceId,
      processName,
      `cat ${directory + csrFileName}`,
    ).then(deviceCsr => {
      return (
        deviceCsr
          .toString()
          .replace(/\r/g, '')
          .trim() === csr.replace(/\r/g, '').trim()
      );
    });
  }

  pushFileToAndroidDevice(
    deviceId: string,
    app: string,
    filename: string,
    contents: string,
  ): Promise<void> {
    this.logger.warn(
      `Deploying sonar certificate to ${deviceId}:${app}`,
      'CertificateProvider',
    );
    return this.executeCommandOnAndroid(
      deviceId,
      app,
      `echo "${contents}" > ${filename} && chmod 600 ${filename}`,
    ).then(output => undefined);
  }

  executeCommandOnAndroid(
    deviceId: string,
    user: string,
    command: string,
  ): Promise<string> {
    if (!user.match(allowedAppNameRegex)) {
      return Promise.reject(new Error(`Disallowed run-as user: ${user}`));
    }
    if (command.match(/[']/)) {
      return Promise.reject(
        new Error(`Disallowed escaping command: ${command}`),
      );
    }
    return this.adb
      .shell(deviceId, `echo '${command}' | run-as '${user}'`)
      .then(adb.util.readAll)
      .then(buffer => buffer.toString())
      .then(output => {
        const matches = output.match(appNotDebuggableRegex);
        if (matches) {
          const e = new Error(
            `Android app ${user} is not debuggable. To use it with sonar, add android:debuggable="true" to the application section of AndroidManifest.xml`,
          );
          this.server.emit('error', e);
          throw e;
        }
        return output;
      });
  }

  extractAppNameFromCSR(csr: string): Promise<string> {
    const csrFile = this.writeToTempFile(csr);
    return openssl('req', {in: csrFile, noout: true, subject: true})
      .then(subject => {
        fs.unlink(csrFile);
        return subject;
      })
      .then(subject => {
        return subject
          .split('/')
          .filter(part => {
            return part.startsWith('CN=');
          })
          .map(part => {
            return part.split('=')[1].trim();
          })[0];
      })
      .then(appName => {
        if (!appName.match(allowedAppNameRegex)) {
          throw new Error(
            `Disallowed app name in CSR: ${appName}. Only alphanumeric characters and '.' allowed.`,
          );
        }
        return appName;
      });
  }

  loadSecureServerConfig(): Promise<SecureServerConfig> {
    return this.certificateSetup.then(() => {
      return {
        key: fs.readFileSync(serverKey),
        cert: fs.readFileSync(serverCert),
        ca: fs.readFileSync(caCert),
        requestCert: true,
        rejectUnauthorized: true, // can be false if necessary as we don't strictly need to verify the client
      };
    });
  }

  ensureCertificateAuthorityExists(): Promise<void> {
    if (!fs.existsSync(caKey)) {
      return this.generateCertificateAuthority();
    }
    return this.checkCertIsValid(caCert).catch(e =>
      this.generateCertificateAuthority(),
    );
  }

  checkCertIsValid(filename: string): Promise<void> {
    if (!fs.existsSync(filename)) {
      return Promise.reject();
    }
    return openssl('x509', {
      checkend: minCertExpiryWindowSeconds,
      in: filename,
    })
      .then(output => undefined)
      .catch(e => {
        this.logger.warn(
          `Certificate will expire soon: ${filename}`,
          'CertificateProvider',
        );
        throw e;
      });
  }

  verifyServerCertWasIssuedByCA() {
    const options = {CAfile: caCert};
    options[serverCert] = false;
    return openssl('verify', options).then(output => {
      const verified = output.match(/[^:]+: OK/);
      if (!verified) {
        // This should never happen, but if it does, we need to notice so we can
        // generate a valid one, or no clients will trust our server.
        throw new Error('Current server cert was not issued by current CA');
      }
    });
  }

  generateCertificateAuthority(): Promise<void> {
    if (!fs.existsSync(getFilePath(''))) {
      fs.mkdirSync(getFilePath(''));
    }
    this.logger.info('Generating new CA', 'CertificateProvider');
    return openssl('genrsa', {out: caKey, '2048': false})
      .then(_ =>
        openssl('req', {
          new: true,
          x509: true,
          subj: caSubject,
          key: caKey,
          out: caCert,
        }),
      )
      .then(_ => undefined);
  }

  ensureServerCertExists(): Promise<void> {
    if (
      !(
        fs.existsSync(serverKey) &&
        fs.existsSync(serverCert) &&
        fs.existsSync(caCert)
      )
    ) {
      return this.generateServerCertificate();
    }

    return this.checkCertIsValid(serverCert)
      .then(_ => this.verifyServerCertWasIssuedByCA())
      .catch(e => this.generateServerCertificate());
  }

  generateServerCertificate(): Promise<void> {
    return this.ensureCertificateAuthorityExists()
      .then(_ => {
        this.logger.warn('Creating new server cert', 'CertificateProvider');
      })
      .then(_ => openssl('genrsa', {out: serverKey, '2048': false}))
      .then(_ =>
        openssl('req', {
          new: true,
          key: serverKey,
          out: serverCsr,
          subj: serverSubject,
        }),
      )
      .then(_ =>
        openssl('x509', {
          req: true,
          in: serverCsr,
          CA: caCert,
          CAkey: caKey,
          CAcreateserial: true,
          out: serverCert,
        }),
      )
      .then(_ => undefined);
  }

  writeToTempFile(content: string): string {
    const fileName = getFilePath(`deviceCSR-${Math.random() * 1000000}`);
    fs.writeFileSync(fileName, content);
    return fileName;
  }
}

function getFilePath(fileName: string): string {
  return path.resolve(os.homedir(), '.sonar', 'certs', fileName);
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import child_process from 'child_process';
import {clipboard, shell} from 'electron';

type PasteResponse =
  | {
      id: number,
      objectName: string,
      phid: string,
      authorPHID: string,
      filePHID: string,
      title: string,
      dateCreated: number,
      language: string,
      uri: string,
      parentPHID: ?number,
      content: string,
    }
  | {
      type: 'error',
      message: string,
    };

export default function createPaste(input: string): Promise<?string> {
  return new Promise((resolve, reject) => {
    const arc = '/opt/facebook/bin/arc';
    const child = child_process.spawn(arc, [
      '--conduit-uri=https://phabricator.intern.facebook.com/api/',
      'paste',
      '--json',
    ]);

    child.stdin.write(input);
    child.stdin.end();
    let response = '';
    child.stdout.on('data', (data: Buffer) => {
      response += data.toString();
    });
    child.stdout.on('end', (data: Buffer) => {
      const result: PasteResponse = JSON.parse(response || 'null');

      if (!result) {
        new window.Notification('Failed to create paste', {
          body: `Does ${arc} exist and is executable?`,
        });
      } else if (result.type === 'error') {
        new window.Notification('Failed to create paste', {
          body: result.message != null ? result.message : '',
        });
        reject(result);
      } else {
        clipboard.writeText(result.uri);
        const notification = new window.Notification(
          `Paste ${result.objectName} created`,
          {
            body: 'URL copied to clipboard',
          },
        );
        notification.onclick = () => shell.openExternal(result.uri);
        resolve(result.uri);
      }
    });
  });
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import electron from 'electron';

const DP_ARG = '--dynamicPlugins=';
/* Sometimes remote objects are missing intermittently. To reduce the chance of
 * this being a problem while in use. Only read it once at startup.
 * https://github.com/electron/electron/issues/8205 */
const _argv = electron.remote.process.argv;
const _loadsDynamicPlugins =
  _argv.findIndex(arg => arg.startsWith(DP_ARG)) > -1;
const _isProduction = !/node_modules[\\/]electron[\\/]/.test(
  electron.remote.process.execPath,
);

export function isProduction(): boolean {
  return _isProduction;
}

export function loadsDynamicPlugins(): boolean {
  return _loadsDynamicPlugins;
}

export function toggleDynamicPluginLoading() {
  const args = _argv.filter(arg => !arg.startsWith(DP_ARG));
  if (!loadsDynamicPlugins()) {
    args.push(DP_ARG + '~/fbsource/xplat/sonar/src/plugins');
  }
  const {app} = electron.remote;
  app.relaunch({args: args.slice(1).concat(['--relaunch'])});
  app.exit(0);
}

export function dynamicPluginPath(): ?string {
  const index = _argv.findIndex(arg => arg.startsWith(DP_ARG));

  if (index > -1) {
    return _argv[index].replace(DP_ARG, '');
  } else {
    null;
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

export type Rect = {
  top: number,
  left: number,
  height: number,
  width: number,
};

export function isOverlappedRect(a: Rect, b: Rect): boolean {
  const aRight = a.left + a.width;
  const bRight = b.left + b.width;
  const aBottom = a.top + a.height;
  const bBottom = b.top + b.height;
  return (
    a.left < bRight && b.left < aRight && a.top < bBottom && b.top < aBottom
  );
}

export function getDistanceRect(a: Rect, b: Rect): number {
  const mostLeft = a.left < b.left ? a : b;
  const mostRight = b.left < a.left ? a : b;

  let xDifference =
    mostLeft.left === mostRight.left
      ? 0
      : mostRight.left - (mostLeft.left + mostLeft.width);
  xDifference = Math.max(0, xDifference);

  const upper = a.top < b.top ? a : b;
  const lower = b.top < a.top ? a : b;

  let yDifference =
    upper.top === lower.top ? 0 : lower.top - (upper.top + upper.height);
  yDifference = Math.max(0, yDifference);

  return Math.min(xDifference, yDifference);
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

// list of icons that are prefetched in the service worker when launching the app
export const precachedIcons = [
  {
    name: 'arrow-right',
    size: 12,
  },
  {
    name: 'caution-octagon',
  },
  {
    name: 'caution-triangle',
  },
  {
    name: 'info-circle',
  },
  {
    name: 'magic-wand',
    size: 20,
  },
  {
    name: 'magnifying-glass',
  },
  {
    name: 'minus-circle',
    size: 12,
  },
  {
    name: 'mobile',
    size: 12,
  },
  {
    name: 'bug',
    size: 12,
  },
  {
    name: 'posts',
    size: 20,
  },
  {
    name: 'rocket',
    size: 20,
  },
  {
    name: 'tools',
    size: 20,
  },
  {
    name: 'triangle-down',
    size: 12,
  },
  {
    name: 'triangle-right',
    size: 12,
  },
  {
    name: 'chevron-right',
    size: 8,
  },
  {
    name: 'chevron-down',
    size: 8,
  },
].map(icon => getIconUrl(icon.name, icon.size || undefined));

export function getIconUrl(
  name: string,
  size?: number = 16,
  variant?: 'filled' | 'outline' = 'filled',
): string {
  if (name.indexOf('/') > -1) {
    return name;
  }

  const AVAILABLE_SIZES = [8, 10, 12, 16, 18, 20, 24, 32];
  const SCALE = [1, 1.5, 2, 3, 4];

  let requestedSize: number = size;
  if (!AVAILABLE_SIZES.includes(size)) {
    // find the next largest size
    const possibleSize: ?number = AVAILABLE_SIZES.find(size => {
      return size > requestedSize;
    });

    // set to largest size if the real size is larger than what we have
    if (possibleSize == null) {
      requestedSize = Math.max(...AVAILABLE_SIZES);
    } else {
      requestedSize = possibleSize;
    }
  }

  let requestedScale: number = window.devicePixelRatio;
  if (!SCALE.includes(requestedScale)) {
    // find the next largest size
    const possibleScale: ?number = SCALE.find(scale => {
      return scale > requestedScale;
    });

    // set to largest size if the real size is larger than what we have
    if (possibleScale == null) {
      requestedScale = Math.max(...SCALE);
    } else {
      requestedScale = possibleScale;
    }
  }

  return `https://external.xx.fbcdn.net/assets/?name=${name}&variant=filled&size=${requestedSize}&set=facebook_icons&density=${requestedScale}x${
    variant == 'outline' ? '&variant=outline' : ''
  }`;
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

export {default as textContent} from './textContent.js';
export {default as createPaste} from './createPaste.js';
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

const os = require('os');

export type Info = {
  arch: string,
  platform: string,
  unixname: string,
  versions: {
    [key: string]: ?string,
  },
};

/**
 * This method builds up some metadata about the users environment that we send
 * on bug reports, analytic events, errors etc.
 */
export function getInfo(): Info {
  return {
    arch: process.arch,
    platform: process.platform,
    unixname: os.userInfo().username,
    versions: {
      electron: process.versions['atom-shell'],
      node: process.versions.node,
    },
  };
}

export function stringifyInfo(): string {
  const info = getInfo();

  const lines = [
    `Platform: ${info.platform} ${info.arch}`,
    `Unixname: ${info.unixname}`,
    `Versions:`,
  ];

  for (const key in info.versions) {
    lines.push(`  ${key}: ${String(info.versions[key])}`);
  }

  return lines.join('\n');
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import Logger from '../fb-stubs/Logger.js';

export function reportInteraction(
  componentType: string,
  componentIdentifier: string,
) {
  const tracker = new InteractionTracker(componentType, componentIdentifier);
  return tracker.interaction.bind(tracker);
}

class InteractionTracker {
  static logger = new Logger();
  static numberOfInteractions = 0;

  type: string;
  id: string;
  interaction: (name: string, data: any) => void;

  constructor(componentType: string, componentIdentifier: string) {
    this.type = componentType;
    this.id = componentIdentifier;
  }

  interaction = (name: string, data: any) => {
    InteractionTracker.logger.track('usage', 'interaction', {
      interaction: InteractionTracker.numberOfInteractions++,
      type: this.type,
      id: this.id,
      name,
      data,
    });
  };
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

export default class LowPassFilter {
  constructor(smoothing?: number = 0.9) {
    this.smoothing = smoothing;
    this.buffer = [];
    this.bufferMaxSize = 5;
  }

  bufferMaxSize: number;
  smoothing: number;
  buffer: Array<number>;

  hasFullBuffer(): boolean {
    return this.buffer.length === this.bufferMaxSize;
  }

  push(value: number): number {
    let removed: number = 0;

    if (this.hasFullBuffer()) {
      removed = this.buffer.shift();
    }

    this.buffer.push(value);

    return removed;
  }

  next(nextValue: number): number {
    // push new value to the end, and remove oldest one
    const removed = this.push(nextValue);

    // smooth value using all values from buffer
    const result = this.buffer.reduce(this._nextReduce, removed);

    // replace smoothed value
    this.buffer[this.buffer.length - 1] = result;

    return result;
  }

  _nextReduce = (last: number, current: number): number => {
    return this.smoothing * current + (1 - this.smoothing) * last;
  };
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

class ListElement<K, V> {
  constructor(cache: LRUCache<K, V>, key: K, value: V) {
    this.cache = cache;
    this.before = undefined;
    this.next = undefined;
    this.set(key, value);
  }

  creationTime: number;
  cache: LRUCache<K, V>;
  before: ?ListElement<K, V>;
  next: ?ListElement<K, V>;
  key: K;
  value: V;

  set(key: K, value: V) {
    this.key = key;
    this.value = value;
    this.creationTime = Date.now();
  }

  hit() {
    this.detach();
    this.attach();
  }

  attach() {
    this.before = undefined;
    this.next = this.cache.head;
    this.cache.head = this;

    const {next} = this;
    if (next) {
      next.before = this;
    } else {
      this.cache.tail = this;
    }

    this.cache.size++;
  }

  detach() {
    const {before, next} = this;

    if (before) {
      before.next = next;
    } else {
      this.cache.head = next;
    }

    if (next) {
      next.before = before;
    } else {
      this.cache.tail = before;
    }

    this.cache.size--;
  }
}

type LRUCacheOptions = {|
  maxSize: number,
  maxAge?: number,
|};

export default class LRUCache<K, V> {
  constructor(options: LRUCacheOptions) {
    this.maxSize = options.maxSize;
    this.maxAge = options.maxAge;
    this.clear();
  }

  maxSize: number;
  maxAge: ?number;
  size: number;
  data: Map<K, ListElement<K, V>>;
  tail: ?ListElement<K, V>;
  head: ?ListElement<K, V>;

  clear() {
    this.size = 0;
    this.data = new Map();
    this.tail = undefined;
    this.head = undefined;
  }

  has(key: K): boolean {
    return this.data.has(key);
  }

  get(key: K, hit?: boolean = true): ?V {
    const cacheVal = this.data.get(key);
    if (!cacheVal) {
      return;
    }

    const {maxAge} = this;
    if (maxAge != null) {
      const timeNow = Date.now();
      const timeSinceCreation = timeNow - cacheVal.creationTime;
      if (timeSinceCreation > maxAge) {
        this.delete(key);
        return;
      }
    }

    if (hit) {
      cacheVal.hit();
    }

    return cacheVal.value;
  }

  pop(): ?ListElement<K, V> {
    const {tail} = this;
    if (!tail) {
      return;
    }

    this.delete(tail.key);

    tail.next = undefined;
    tail.before = undefined;

    return tail;
  }

  set(key: K, val: V, hit?: boolean = true) {
    const actual = this.data.get(key);

    if (actual) {
      actual.value = val;
      if (hit) {
        actual.hit();
      }
    } else {
      let cacheVal: ?ListElement<K, V>;

      if (this.size >= this.maxSize) {
        cacheVal = this.pop();

        if (cacheVal) {
          cacheVal.set(key, val);
        }
      }

      if (!cacheVal) {
        cacheVal = new ListElement(this, key, val);
      }

      this.data.set(key, cacheVal);
      cacheVal.attach();
    }
  }

  delete(key: K) {
    const val = this.data.get(key);
    if (!val) {
      return;
    }

    val.detach();
    this.data.delete(key);
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import {exec as opensslWithCallback} from 'openssl-wrapper';
const child_process = require('child_process');

export function openssl(action: string, options: {}): Promise<string> {
  return new Promise((resolve, reject) => {
    opensslWithCallback(action, options, (err, buffer) => {
      if (err) {
        reject(err);
      }
      resolve(buffer.toString());
    });
  });
}

export function isInstalled(): boolean {
  return !child_process.spawnSync('openssl', ['version']).error;
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

let debugId = 0;

export function mark(): string {
  const id = String(debugId++);
  if (typeof performance === 'object') {
    performance.mark(id);
  }
  return id;
}

export function measure(id: string, name: string) {
  if (typeof performance === 'object') {
    performance.measure(name, id);
    performance.clearMeasures(id);
    performance.clearMarks(id);
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type {Rect} from './geometry.js';

export const SNAP_SIZE = 16;

export function snapGrid(val: number): number {
  return val - (val % SNAP_SIZE);
}

export function getPossibleSnappedPosition(
  windows: Array<Rect>,
  {
    getGap,
    getNew,
  }: {
    getNew: (win: Rect) => number,
    getGap: (win: Rect) => number,
  },
): ?number {
  for (const win of windows) {
    const gap = Math.abs(getGap(win));
    if (gap >= 0 && gap < SNAP_SIZE) {
      return getNew(win);
    }
  }
}

export function getDistanceTo(props: Rect, win: Rect): number {
  const x1 = win.left;
  const y1 = win.top;
  const x1b = win.left + win.width;
  const y1b = win.top + win.height;

  const x2 = props.left;
  const y2 = props.top;
  const x2b = props.left + props.width;
  const y2b = props.top + props.height;

  const left = x2b < x1;
  const right = x1b < x2;
  const bottom = y2b < y1;
  const top = y1b < y2;

  if (top && left) {
    return distance(x1, y1b, x2b, y2);
  } else if (left && bottom) {
    return distance(x1, y1, x2b, y2b);
  } else if (bottom && right) {
    return distance(x1b, y1, x2, y2b);
  } else if (right && top) {
    return distance(x1b, y1b, x2, y2);
  } else if (left) {
    return x1 - x2b;
  } else if (right) {
    return x2 - x1b;
  } else if (bottom) {
    return y1 - y2b;
  } else if (top) {
    return y2 - y1b;
  } else {
    return 0;
  }
}

export function distance(
  x1: number,
  y1: number,
  x2: number,
  y2: number,
): number {
  return Math.abs(x1 - x2) + Math.abs(y1 - y2);
}

export function maybeSnapLeft(
  props: Rect,
  windows: Array<Rect>,
  left: number,
): number {
  // snap right side to left
  // ┌─┬─┐
  // │A│B│
  // └─┴─┘
  const snapRight = getPossibleSnappedPosition(windows, {
    debug: true,
    getGap: win => win.left - (props.width + left),
    getNew: win => win.left - props.width,
  });
  if (snapRight != null) {
    return snapRight;
  }

  // snap left side to right
  // ┌─┬─┐
  // │B│A│
  // └─┴─┘
  const snapLeft = getPossibleSnappedPosition(windows, {
    getGap: win => left - (win.left + win.width),
    getNew: win => win.left + win.width,
  });
  if (snapLeft != null) {
    return snapLeft;
  }

  return snapGrid(left);
}

export function maybeSnapTop(
  props: Rect,
  windows: Array<Rect>,
  top: number,
): number {
  // snap bottom to bottom
  // ┌─┐
  // │A├─┐
  // │ │B│
  // └─┴─┘
  const snapBottom2 = getPossibleSnappedPosition(windows, {
    getGap: win => top - win.top - win.height,
    getNew: win => win.top + win.height,
  });
  if (snapBottom2 != null) {
    return snapBottom2;
  }

  // snap top to bottom
  // ┌─┐
  // │B│
  // ├─┤
  // │A│
  // └─┘
  const snapBottom = getPossibleSnappedPosition(windows, {
    getGap: win => top - win.top - win.height,
    getNew: win => win.top + win.height,
  });
  if (snapBottom != null) {
    return snapBottom;
  }

  // snap top to top
  // ┌─┬─┐
  // │A│B│
  // │ ├─┘
  // └─┘
  const snapTop = getPossibleSnappedPosition(windows, {
    getGap: win => top - win.top,
    getNew: win => win.top,
  });
  if (snapTop != null) {
    return snapTop;
  }

  return snapGrid(top);
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

import type {Node} from 'react';

function isReactElement(object: any) {
  return (
    typeof object === 'object' &&
    object !== null &&
    object.$$typeof === Symbol.for('react.element')
  );
}

/**
 * Recursively walks through all children of a React element and returns
 * the string representation of the leafs concatenated.
 */
export default (node: Node): string => {
  let res = '';
  const traverse = (node: Node) => {
    if (typeof node === 'string' || typeof node === 'number') {
      // this is a leaf, add it to the result string
      res += node;
    } else if (Array.isArray(node)) {
      // traverse all array members and recursively stringify them
      node.forEach(traverse);
    } else if (isReactElement(node)) {
      // node is a react element access its children an recursively stringify them
      // $FlowFixMe
      const {children} = node.props;
      if (Array.isArray(children)) {
        children.forEach(traverse);
      } else {
        traverse(children);
      }
    }
  };

  traverse(node);

  return res;
};
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

const path = require('path');
const fs = require('fs');
const metro = require('metro');
const yargs = require('yargs');
const HOME_DIR = require('os').homedir();

module.exports = (reloadCallback, pluginPaths, pluginCache) => {
  const plugins = pluginEntryPoints(pluginPaths);
  if (!fs.existsSync(pluginCache)) {
    fs.mkdirSync(pluginCache);
  }
  if (yargs.argv.dynamicPlugins) {
    // watch for changes on plugins if we are loading plugins dynamically
    watchChanges(plugins, reloadCallback, pluginCache);
  }
  return Promise.all(
    Object.values(plugins).map(plugin =>
      compilePlugin(plugin, false, pluginCache),
    ),
  )
    .then(dynamicPlugins => {
      // eslint-disable-next-line no-console
      console.log('✅  Compiled all plugins.');
      return dynamicPlugins;
    })
    .catch(console.error);
};

function watchChanges(plugins, reloadCallback, pluginCache) {
  // eslint-disable-next-line no-console
  console.log('🕵️‍  Watching for plugin changes');

  Object.values(plugins).map(plugin =>
    fs.watch(plugin.rootDir, (eventType, filename) => {
      // eslint-disable-next-line no-console
      console.log(`🕵️‍  Detected changes in ${plugin.name}`);
      compilePlugin(plugin, true, pluginCache).then(reloadCallback);
    }),
  );
}
function hash(string) {
  let hash = 0;
  if (string.length === 0) {
    return hash;
  }
  let chr;
  for (let i = 0; i < string.length; i++) {
    chr = string.charCodeAt(i);
    hash = (hash << 5) - hash + chr;
    hash |= 0;
  }
  return hash;
}
const fileToIdMap = new Map();
const createModuleIdFactory = () => filePath => {
  if (filePath === '__prelude__') {
    return 0;
  }
  let id = fileToIdMap.get(filePath);
  if (typeof id !== 'number') {
    id = hash(filePath);
    fileToIdMap.set(filePath, id);
  }
  return id;
};
function pluginEntryPoints(additionalPaths = []) {
  const defaultPluginPath = path.join(HOME_DIR, '.sonar', 'node_modules');
  const entryPoints = entryPointForPluginFolder(defaultPluginPath);
  if (typeof additionalPaths === 'string') {
    additionalPaths = [additionalPaths];
  }
  additionalPaths.forEach(additionalPath => {
    const additionalPlugins = entryPointForPluginFolder(additionalPath);
    Object.keys(additionalPlugins).forEach(key => {
      entryPoints[key] = additionalPlugins[key];
    });
  });
  return entryPoints;
}
function entryPointForPluginFolder(pluginPath) {
  pluginPath = pluginPath.replace('~', HOME_DIR);
  if (!fs.existsSync(pluginPath)) {
    return {};
  }
  return fs
    .readdirSync(pluginPath)
    .filter(name =>
      /*name.startsWith('sonar-plugin') && */ fs
        .lstatSync(path.join(pluginPath, name))
        .isDirectory(),
    )
    .filter(Boolean)
    .map(name => {
      let packageJSON;
      try {
        packageJSON = fs
          .readFileSync(path.join(pluginPath, name, 'package.json'))
          .toString();
      } catch (e) {}
      if (packageJSON) {
        try {
          const pkg = JSON.parse(packageJSON);
          return {
            packageJSON: pkg,
            name: pkg.name,
            entry: path.join(pluginPath, name, pkg.main || 'index.js'),
            rootDir: path.join(pluginPath, name),
          };
        } catch (e) {
          console.error(
            `Could not load plugin "${pluginPath}", because package.json is invalid.`,
          );
          console.error(e);
          return null;
        }
      }
    })
    .filter(Boolean)
    .reduce((acc, cv) => {
      acc[cv.name] = cv;
      return acc;
    }, {});
}
function changeExport(path) {
  let file = fs.readFileSync(path);
  file = file
    .toString()
    .replace(
      /\nrequire\((-?[0-9]+)\);\n*$/,
      (_, moduleID) =>
        `\nmodule.exports = global.require(${moduleID}).default;`,
    );
  fs.writeFileSync(path, file);
}
function compilePlugin(
  {rootDir, name, entry, packageJSON},
  force,
  pluginCache,
) {
  return new Promise((resolve, reject) => {
    const fileName = `${name}@${packageJSON.version || '0.0.0'}.js`;
    const out = path.join(pluginCache, fileName);
    const result = Object.assign({}, packageJSON, {rootDir, name, entry, out});
    // check if plugin needs to be compiled
    if (
      !force &&
      fs.existsSync(out) &&
      fs.lstatSync(rootDir).atime < fs.lstatSync(out).ctime
    ) {
      // eslint-disable-next-line no-console
      console.log(`🥫  Using cached version of ${name}...`);
      resolve(result);
    } else {
      console.log(`⚙️  Compiling ${name}...`); // eslint-disable-line no-console
      metro
        .runBuild({
          config: {
            getProjectRoots: () => [rootDir, path.join(__dirname, '..')],
            getTransformModulePath: () =>
              path.join(__dirname, 'transforms', 'index.js'),
            // a custom hash function is required, because by default metro starts
            // numbering the modules by 1. This means all plugins would start at
            // ID 1, which causes a clash. This is why we have a custom IDFactory.
            createModuleIdFactory,
          },
          dev: false,
          entry,
          out,
        })
        .then(() => {
          changeExport(out);
          resolve(result);
        })
        .catch(console.error);
    }
  });
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */
const {app, BrowserWindow} = require('electron');
const path = require('path');
const url = require('url');
const fs = require('fs');
const yargs = require('yargs');
const compilePlugins = require('./compilePlugins.js');

// ensure .sonar folder and config exist
const sonarDir = path.join(require('os').homedir(), '.sonar');
if (!fs.existsSync(sonarDir)) {
  fs.mkdirSync(sonarDir);
}

const configPath = path.join(sonarDir, 'config.json');
let config = {pluginPaths: [], disabledPlugins: [], lastWindowPosition: {}};

try {
  config = {
    ...config,
    ...JSON.parse(fs.readFileSync(configPath)),
  };
} catch (e) {
  fs.writeFileSync(configPath, JSON.stringify(config));
}

const pluginPaths = config.pluginPaths.concat(
  (yargs.argv.dynamicPlugins || '').split(',').filter(Boolean),
);

process.env.CONFIG = JSON.stringify({
  ...config,
  pluginPaths,
});

// possible reference to main app window
let win;
let appReady = false;
let pluginsCompiled = false;

// tracking
setInterval(() => {
  if (win && win.isFocused()) {
    win.webContents.send('trackUsage');
  }
}, 60 * 1000);

compilePlugins(
  () => {
    if (win) {
      win.reload();
    }
  },
  pluginPaths,
  path.join(require('os').homedir(), '.sonar', 'plugins'),
).then(dynamicPlugins => {
  process.env.PLUGINS = JSON.stringify(dynamicPlugins);
  pluginsCompiled = true;
  tryCreateWindow();
});

// check if we already have an instance of this app open
const isSecondInstance = app.makeSingleInstance(
  (commandLine, workingDirectory) => {
    // someone tried to run a second instance, we should focus our window
    if (win) {
      if (win.isMinimized()) {
        win.restore();
      }

      win.focus();
    }
  },
);

// if this is a second instance then quit the app to prevent collisions
if (isSecondInstance) {
  app.quit();
}

// quit app once all windows are closed
app.on('window-all-closed', () => {
  appReady = false;
  app.quit();
});

app.on('ready', function() {
  appReady = true;
  app.commandLine.appendSwitch('scroll-bounce');
  tryCreateWindow();
  // if in development install the react devtools extension
  if (process.env.NODE_ENV === 'development') {
    const {
      default: installExtension,
      REACT_DEVELOPER_TOOLS,
      REDUX_DEVTOOLS,
    } = require('electron-devtools-installer');
    installExtension(REACT_DEVELOPER_TOOLS.id);
    installExtension(REDUX_DEVTOOLS.id);
  }
});
function tryCreateWindow() {
  if (appReady && pluginsCompiled) {
    win = new BrowserWindow({
      show: false,
      title: 'Sonar',
      width: config.lastWindowPosition.width || 1400,
      height: config.lastWindowPosition.height || 1000,
      minWidth: 800,
      minHeight: 600,
      center: true,
      fullscreenable: false,
      backgroundThrottling: false,
      titleBarStyle: 'hiddenInset',
      webPreferences: {
        webSecurity: false,
        scrollBounce: true,
        experimentalFeatures: true,
      },
    });
    win.once('ready-to-show', () => win.show());
    win.once('close', ({sender}) => {
      const [x, y] = sender.getPosition();
      const [width, height] = sender.getSize();
      // save window position and size
      fs.writeFileSync(
        configPath,
        JSON.stringify({
          ...config,
          lastWindowPosition: {
            x,
            y,
            width,
            height,
          },
        }),
      );
    });
    if (config.lastWindowPosition.x && config.lastWindowPosition.y) {
      win.setPosition(config.lastWindowPosition.x, config.lastWindowPosition.y);
    }
    const entryUrl =
      process.env.ELECTRON_URL ||
      url.format({
        pathname: path.join(__dirname, 'index.html'),
        protocol: 'file:',
        slashes: true,
      });
    win.loadURL(entryUrl);
  }
}
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

const CACHE_NAME = 'v1';

self.addEventListener('message', e => {
  if (e.data.precachedIcons) {
    caches.open(CACHE_NAME).then(cache => cache.addAll(e.data.precachedIcons));
  }
});

self.addEventListener('fetch', function(event) {
  if (event.request.url.startsWith('https://external.xx.fbcdn.net/assets/')) {
    event.respondWith(
      // Cache falling back to the network
      caches.match(event.request).then(cacheResponse => {
        return (
          cacheResponse ||
          fetch(event.request).then(response => {
            const clone = response.clone();
            // write to cache
            caches
              .open(CACHE_NAME)
              .then(cache => cache.put(event.request, clone));
            return response;
          })
        );
      }),
    );
  }
});
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */
function isDynamicRequire(node) {
  return (
    node.type === 'CallExpression' &&
    node.callee.type === 'Identifier' &&
    node.callee.name === 'require' &&
    (node.arguments.length !== 1 || node.arguments[0].type !== 'StringLiteral')
  );
}

module.exports = function(babel) {
  const t = babel.types;

  return {
    name: 'replace-dynamic-requires',
    visitor: {
      CallExpression(path) {
        if (!isDynamicRequire(path.node)) {
          return;
        }

        path.replaceWith(t.identifier('triggerDynamicRequireError'));
      },
    },
  };
};
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

const BUILTINS = [
  'electron',
  'buffer',
  'child_process',
  'crypto',
  'dgram',
  'dns',
  'fs',
  'http',
  'https',
  'net',
  'os',
  'readline',
  'stream',
  'string_decoder',
  'tls',
  'tty',
  'zlib',
  'constants',
  'events',
  'url',
  'assert',
  'util',
  'path',
  'punycode',
  'querystring',
  'cluster',
  'console',
  'module',
  'process',
  'vm',
  'domain',
  'v8',
  'repl',
  'timers',
];

const IGNORED_MODULES = [
  'bufferutil',
  'utf-8-validate',
  'spawn-sync',
  './src/logcat',
  './src/monkey',
  './src/adb',
];

function isRequire(node) {
  return (
    node.type === 'CallExpression' &&
    node.callee.type === 'Identifier' &&
    node.callee.name === 'require' &&
    node.arguments.length === 1 &&
    node.arguments[0].type === 'StringLiteral'
  );
}

module.exports = function(babel) {
  const t = babel.types;

  return {
    name: 'infinity-import-react',
    visitor: {
      CallExpression(path) {
        if (!isRequire(path.node)) {
          return;
        }

        const source = path.node.arguments[0].value;

        if (BUILTINS.includes(source)) {
          path.node.callee.name = 'electronRequire';
        }

        if (IGNORED_MODULES.includes(source)) {
          path.replaceWith(t.identifier('triggerReferenceError'));
        }
      },
    },
  };
};
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

const fs = require('fs');
const path = require('path');
const replaceFBStubs = fs.existsSync(
  path.join(__dirname, '..', '..', 'src', 'fb'),
);

const requireFromFolder = (folder, path) =>
  new RegExp(folder + '/[A-Za-z0-9.-_]+(.js)?$', 'g').test(path);

module.exports = function(babel) {
  return {
    name: 'replace-dynamic-requires',
    visitor: {
      CallExpression(path) {
        if (
          replaceFBStubs &&
          path.node.type === 'CallExpression' &&
          path.node.callee.type === 'Identifier' &&
          path.node.callee.name === 'require' &&
          path.node.arguments.length > 0
        ) {
          if (requireFromFolder('fb', path.node.arguments[0].value)) {
            throw new Error(
              'Do not requrie directly from fb/, but rather from fb-stubs/ to not break flow-typing and make sure stubs are uptodate.',
            );
          } else if (
            requireFromFolder('fb-stubs', path.node.arguments[0].value)
          ) {
            path.node.arguments[0].value = path.node.arguments[0].value.replace(
              '/fb-stubs/',
              '/fb/',
            );
          }
        }
      },
    },
  };
};
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

module.exports = function(babel) {
  const t = babel.types;

  return {
    name: 'infinity-import-react',
    visitor: {
      Program: {
        exit(path, state) {
          if (state.get('NEEDS_REACT')) {
            path.unshiftContainer('body', [
              t.variableDeclaration('var', [
                t.variableDeclarator(
                  t.identifier('React'),
                  t.callExpression(t.identifier('require'), [
                    t.stringLiteral('react'),
                  ]),
                ),
              ]),
            ]);
          }
        },
      },

      ReferencedIdentifier(path, state) {
        // mark react as needing to be imported
        if (path.node.name === 'React' && !path.scope.getBinding('React')) {
          state.set('NEEDS_REACT', true);
        }

        // replace Buffer with require('buffer')
        if (path.node.name === 'Buffer' && !path.scope.getBinding('Buffer')) {
          path.replaceWith(
            t.memberExpression(
              t.callExpression(t.identifier('require'), [
                t.stringLiteral('buffer'),
              ]),
              t.identifier('Buffer'),
            ),
          );
        }
      },
    },
  };
};
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

const generate = require('@babel/generator').default;
const babylon = require('babylon');
const babel = require('@babel/core');
const metro = require('metro');

exports.transform = function({filename, options, src}) {
  const presets = [require('../node_modules/babel-preset-react')];
  const isSonarPlugin = !__dirname.startsWith(options.projectRoot);

  let ast = babylon.parse(src, {
    filename,
    plugins: ['jsx', 'flow', 'classProperties', 'objectRestSpread'],
    sourceType: 'module',
  });

  // run babel
  const plugins = [
    require('../node_modules/babel-plugin-transform-object-rest-spread'),
    require('../node_modules/babel-plugin-transform-class-properties'),
    require('../node_modules/babel-plugin-transform-flow-strip-types'),
    require('./electron-requires.js'),
    require('./fb-stubs.js'),
    require('./dynamic-requires.js'),
  ];
  if (isSonarPlugin) {
    plugins.push(require('./sonar-requires.js'));
  } else {
    plugins.push(require('./import-react.js'));
  }
  plugins.unshift(require('babel-plugin-transform-es2015-modules-commonjs'));

  ast = babel.transformFromAst(ast, src, {
    babelrc: !filename.includes('node_modules'),
    code: false,
    comments: false,
    compact: false,
    filename,
    plugins,
    presets,
    sourceMaps: true,
  }).ast;
  const result = generate(
    ast,
    {
      filename,
      sourceFileName: filename,
      sourceMaps: true,
    },
    src,
  );
  return {
    ast,
    code: result.code,
    filename,
    map: result.rawMappings.map(metro.sourceMaps.compactMapping),
  };
};
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

// do not apply this transform for these paths
const EXCLUDE_PATHS = [
  '/node_modules/react-devtools-core/',
  'relay-devtools/DevtoolsUI',
];

function isExcludedPath(path) {
  for (const epath of EXCLUDE_PATHS) {
    if (path.indexOf(epath) > -1) {
      return true;
    }
  }
  return false;
} // $FlowFixMe
module.exports = ({types: t}) => ({
  visitor: {
    // $FlowFixMe
    CallExpression(path, state) {
      if (isExcludedPath(state.file.opts.filename)) {
        return;
      }
      const node = path.node;
      const args = node.arguments || [];
      if (
        node.callee.name === 'require' &&
        args.length === 1 &&
        t.isStringLiteral(args[0]) &&
        args[0].value === 'sonar'
      ) {
        path.replaceWith(t.identifier('window.Sonar'));
      } else if (
        node.callee.name === 'require' &&
        args.length > 0 &&
        t.isStringLiteral(args[0]) &&
        args[0].value === 'react'
      ) {
        path.replaceWith(t.identifier('window.React'));
      } else if (
        node.callee.name === 'require' &&
        args.length > 0 &&
        t.isStringLiteral(args[0]) &&
        args[0].value === 'react-dom'
      ) {
        path.replaceWith(t.identifier('window.ReactDOM'));
      }
    },
    Identifier(path, state) {
      if (
        path.node.name === 'React' &&
        path.parentPath.node.id !== path.node &&
        !isExcludedPath(state.file.opts.filename)
      ) {
        path.replaceWith(t.identifier('window.React'));
      }
    },
  },
});
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */
const repoUrl = 'https://github.com/facebook/sonar';

const siteConfig = {
  title: 'Sonar' /* title for your website */,
  tagline: 'Extensible mobile app debugging',
  url: 'https://fbsonar.com/' /* your website url */,
  baseUrl: '/' /* base url for your project */,
  projectName: 'sonar',
  headerLinks: [
    {doc: 'getting-started', label: 'Getting Started'},
    {doc: 'understand', label: 'Docs'},
    {href: repoUrl, label: 'GitHub'},
  ],
  /* path to images for header/footer */
  headerIcon: 'img/icon.png',
  footerIcon: 'img/mascot.png',
  favicon: 'img/icon.png',
  /* colors for website */
  colors: {
    primaryColor: '#121020',
    secondaryColor: '#121020',
    accentColor: '#785BA3',
    actionColor: '#008cf2',
  },
  copyright: 'Copyright © ' + new Date().getFullYear() + ' Facebook',
  highlight: {
    theme: 'default',
  },
  repoUrl,
  scripts: ['https://buttons.github.io/buttons.js'],
  stylesheets: [],
};

module.exports = siteConfig;
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

const React = require('react');

class Footer extends React.Component {
  docUrl(doc, language) {
    const baseUrl = this.props.config.baseUrl;
    return baseUrl + 'docs/' + (language ? language + '/' : '') + doc;
  }

  pageUrl(doc, language) {
    const baseUrl = this.props.config.baseUrl;
    return baseUrl + (language ? language + '/' : '') + doc;
  }

  render() {
    return (
      <footer className="nav-footer" id="footer">
        <section className="sitemap">
          <a href={this.props.config.baseUrl} className="nav-home">
            {this.props.config.footerIcon && (
              <img
                src={this.props.config.baseUrl + this.props.config.footerIcon}
                alt="Sonar mascot"
                title="I'm a whale not a dolphin!"
                width="66"
                height="58"
              />
            )}
          </a>
          <div>
            <h5>Docs</h5>
            <a href="/docs/getting-started.html">Getting Started</a>
            <a href="/docs/understand.html">Understanding Sonar</a>
            <a href="/docs/js-setup.html">Creating Plugins</a>
          </div>
          <div>
            <h5>Plugins</h5>
            <a href="/docs/logs-plugin.html">Log Viewer</a>
            <a href="/docs/layout-plugin.html">Layout Inspector</a>
            <a href="/docs/network-plugin.html">Network Inspector</a>
          </div>
          <div>
            <h5>More</h5>
            <a href="https://twitter.com/fb_sonar">Twitter</a>
            <a href={this.props.config.repoUrl}>GitHub</a>
            <a
              className="github-button"
              href={this.props.config.repoUrl}
              data-icon="octicon-star"
              data-count-href="/facebook/sonar/stargazers"
              data-show-count={true}
              data-count-aria-label="# stargazers on GitHub"
              aria-label="Star this project on GitHub">
              Star
            </a>
          </div>
        </section>

        <a
          href="https://code.facebook.com/projects/"
          target="_blank"
          className="fbOpenSource">
          <img
            src={this.props.config.baseUrl + 'img/oss_logo.png'}
            alt="Facebook Open Source"
            width="170"
            height="45"
          />
        </a>
        <section className="copyright">{this.props.config.copyright}</section>
      </footer>
    );
  }
}

module.exports = Footer;
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

const React = require('react');

class Docs extends React.Component {
  render() {
    return (
      <script
        dangerouslySetInnerHTML={{
          __html: "window.location.href = '/docs/getting-started.html'",
        }}
      />
    );
  }
}

module.exports = Docs;
/**
 * Copyright 2018-present Facebook.
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * @format
 */

const React = require('react');

class Index extends React.Component {
  render() {
    return (
      <div>
        <div className="splash">
          <div className="content">
            <h1>Extensible mobile app&nbsp;debugger</h1>
            <h2>
              Sonar is a platform for debugging mobile apps on iOS and Android.
              Visualize, inspect, and control your apps from a simple desktop
              interface. Use Sonar as is or extend it using the plugin API.
            </h2>
            <div className="row">
              <a
                className="btn primary"
                href="https://www.facebook.com/sonar/public/mac">
                Download
              </a>
              <a className="btn" href="/docs/understand.html">
                Learn more
              </a>
            </div>
            <img
              src="/img/splash.png"
              srcSet="/img/splash.png 1x, /img/splash@2x.png 2x"
              className="splashScreen"
            />
            <div className="shadow" />
          </div>
        </div>
        <div className="content row">
          <div className="col">
            <img
              src="/img/inspector.png"
              srcSet="/img/inspector.png 1x, /img/inspector@2x.png 2x"
            />
          </div>
          <div className="col">
            <h4>Tools</h4>
            <h3>Mobile development</h3>
            <p>
              Sonar aims to be your number one companion for mobile app
              development on iOS and Android. Therefore, we provide a bunch of
              useful tools including a log viewer, interactive layout inspector,
              and network inspector.
            </p>
            <a className="learnmore" href="/docs/getting-started.html">
              Learn more
            </a>
          </div>
        </div>
        <div className="content row">
          <div className="col">
            <h4>Plugins</h4>
            <h3>Extending Sonar</h3>
            <p>
              Sonar is built as a platform. In addition to using the tools
              already included, you can create your own plugins to visualize and
              debug data from your mobile apps. Sonar takes care of sending data
              back and forth, calling functions, and listening for events on the
              mobile app.
            </p>
            <a className="learnmore" href="/docs/understand.html">
              Learn more
            </a>
          </div>
          <div className="col center">
            <img
              src="/img/SonarKit.png"
              srcSet="/img/SonarKit.png 1x, /img/SonarKit@2x.png 2x"
            />
          </div>
        </div>
        <div className="content row">
          <div className="col">
            <img
              src="/img/plugins.png"
              srcSet="/img/plugins.png 1x, /img/plugins@2x.png 2x"
            />
          </div>
          <div className="col">
            <h4>Open Source</h4>
            <h3>Contributing to Sonar</h3>
            <p>
              Both Sonar's desktop app and native mobile SDKs are open-source
              and MIT licensed. This enables you to see and understand how we
              are building plugins, and of course join the community and help
              improve Sonar. We are excited to see what you will build on this
              platform.
            </p>
            <a className="learnmore" href="/docs/js-setup.html">
              Learn more
            </a>
          </div>
        </div>
      </div>
    );
  }
}

module.exports = Index;
/*
 *  Copyright (c) 2004-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#ifndef CertificateUtils_hpp
#define CertificateUtils_hpp

#include <openssl/pem.h>
#include <openssl/rsa.h>
#include <stdio.h>

bool generateCertSigningRequest(
    const char* appId,
    const char* csrFile,
    const char* privateKeyFile);

#endif /* CertificateUtils_hpp */
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

#pragma once

#include <Sonar/SonarConnectionImpl.h>
#include <Sonar/SonarInitConfig.h>
#include <Sonar/SonarPlugin.h>
#include <Sonar/SonarWebSocket.h>
#include <map>
#include <mutex>

namespace facebook {
namespace sonar {

class SonarClient : public SonarWebSocket::Callbacks {
 public:
  /**
   Call before accessing instance with SonarClient::instance(). This will set up
   all the state needed to establish a Sonar connection.
   */
  static void init(SonarInitConfig config);

  /**
   Standard accessor for the shared SonarClient instance. This returns a
   singleton instance to a shared SonarClient. First call to this function will
   create the shared SonarClient. Must call SonarClient::initDeviceData() before
   first call to SonarClient::instance().
   */
  static SonarClient* instance();

  /**
   Only public for testing
   */
  SonarClient(std::unique_ptr<SonarWebSocket> socket)
      : socket_(std::move(socket)) {
    socket_->setCallbacks(this);
  }

  void start() {
    socket_->start();
  }

  void stop() {
    socket_->stop();
  }

  void onConnected() override;

  void onDisconnected() override;

  void onMessageReceived(const folly::dynamic& message) override;

  void addPlugin(std::shared_ptr<SonarPlugin> plugin);

  void removePlugin(std::shared_ptr<SonarPlugin> plugin);

  void refreshPlugins();

  std::shared_ptr<SonarPlugin> getPlugin(const std::string& identifier);

  template <typename P>
  std::shared_ptr<P> getPlugin(const std::string& identifier) {
    return std::static_pointer_cast<P>(getPlugin(identifier));
  }

  bool hasPlugin(const std::string& identifier);

 private:
  static SonarClient* instance_;
  bool connected_ = false;
  std::unique_ptr<SonarWebSocket> socket_;
  std::map<std::string, std::shared_ptr<SonarPlugin>> plugins_;
  std::map<std::string, std::shared_ptr<SonarConnectionImpl>> connections_;
  std::mutex mutex_;

  void performAndReportError(const std::function<void()>& func);
  void disconnect(std::shared_ptr<SonarPlugin> plugin);
};

} // namespace sonar
} // namespace facebook
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

#pragma once

#include <Sonar/SonarResponder.h>
#include <folly/json.h>
#include <functional>
#include <string>

namespace facebook {
namespace sonar {

/**
Represents a connection between the Desktop and mobile plugins
with corresponding identifiers.
*/
class SonarConnection {
 public:
  using SonarReceiver = std::function<
      void(const folly::dynamic&, std::unique_ptr<SonarResponder>)>;

  virtual ~SonarConnection() {}

  /**
  Invoke a method on the Sonar desktop plugin with with a matching identifier.
  */
  virtual void send(
      const std::string& method,
      const folly::dynamic& params) = 0;

  /**
  Report an error to the Sonar desktop app
  */
  virtual void error(
      const std::string& message,
      const std::string& stacktrace) = 0;

  /**
  Register a receiver to be notified of incoming calls of the given
  method from the Sonar desktop plugin with a matching identifier.
  */
  virtual void receive(
      const std::string& method,
      const SonarReceiver& receiver) = 0;
};

} // namespace sonar
} // namespace facebook
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

#pragma once

#include <Sonar/SonarConnection.h>
#include <Sonar/SonarWebSocket.h>
#include <map>
#include <string>

namespace facebook {
namespace sonar {

class SonarConnectionImpl : public SonarConnection {
 public:
  SonarConnectionImpl(SonarWebSocket* socket, const std::string& name)
      : socket_(socket), name_(name) {}

  void call(
      const std::string& method,
      const folly::dynamic& params,
      std::unique_ptr<SonarResponder> responder) {
    if (receivers_.find(method) == receivers_.end()) {
      throw std::out_of_range("receiver " + method + " not found.");
    }
    receivers_.at(method)(params, std::move(responder));
  }

  void send(const std::string& method, const folly::dynamic& params) override {
    folly::dynamic message = folly::dynamic::object("method", "execute")(
        "params",
        folly::dynamic::object("api", name_)("method", method)(
            "params", params));
    socket_->sendMessage(message);
  }

  void error(const std::string& message, const std::string& stacktrace)
      override {
    socket_->sendMessage(folly::dynamic::object(
        "error",
        folly::dynamic::object("message", message)("stacktrace", stacktrace)));
  }

  void receive(const std::string& method, const SonarReceiver& receiver)
      override {
    receivers_[method] = receiver;
  }

 private:
  SonarWebSocket* socket_;
  std::string name_;
  std::map<std::string, SonarReceiver> receivers_;
};

} // namespace sonar
} // namespace facebook
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

#pragma once

#include <folly/io/async/EventBase.h>
#include <map>

namespace facebook {
namespace sonar {

struct DeviceData {
  std::string host;
  std::string os;
  std::string device;
  std::string deviceId;
  std::string app;
  std::string appId;
  std::string privateAppDirectory;
};

struct SonarInitConfig {
  /**
  Map of client specific configuration data such as app name, device name, etc.
  */
  DeviceData deviceData;

  /**
  EventBase on which client callbacks should be called.
  */
  folly::EventBase* worker;
};

} // namespace sonar
} // namespace facebook
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */
#pragma once

#include <Sonar/SonarConnection.h>
#include <string>

namespace facebook {
namespace sonar {

class SonarPlugin {
 public:
  virtual ~SonarPlugin() {}

  /**
  The plugin's identifier. This should map to a javascript plugin
  with the same identifier to ensure messages are sent correctly.
  */
  virtual std::string identifier() const = 0;

  /**
  Called when a connection has been established between this plugin
  and the corresponding plugin on the Sonar desktop app. The provided
  connection can be used to register method receivers as well as send
  messages back to the desktop app.
  */
  virtual void didConnect(std::shared_ptr<SonarConnection> conn) = 0;

  /**
  Called when a plugin has been disconnected and the SonarConnection
  provided in didConnect is no longer valid to use.
  */
  virtual void didDisconnect() = 0;
};

} // namespace sonar
} // namespace facebook
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

#pragma once

#include <folly/json.h>

namespace facebook {
namespace sonar {

/**
 * SonarResponder is used to asynchronously respond to messages
 * received from the Sonar desktop app.
 */
class SonarResponder {
 public:
  virtual ~SonarResponder(){};

  /**
   * Deliver a successful response to the Sonar desktop app.
   */
  virtual void success(const folly::dynamic& response) const = 0;

  /**
   * Inform the Sonar desktop app of an error in handling the request.
   */
  virtual void error(const folly::dynamic& response) const = 0;
};

} // namespace sonar
} // namespace facebook
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

#pragma once

#include <Sonar/SonarResponder.h>
#include <Sonar/SonarWebSocket.h>
#include <folly/json.h>

namespace facebook {
namespace sonar {

class SonarResponderImpl : public SonarResponder {
 public:
  SonarResponderImpl(SonarWebSocket* socket, int64_t responseID)
      : socket_(socket), responseID_(responseID) {}

  void success(const folly::dynamic& response) const override {
    const folly::dynamic message =
        folly::dynamic::object("id", responseID_)("success", response);
    socket_->sendMessage(message);
  }

  void error(const folly::dynamic& response) const override {
    const folly::dynamic message =
        folly::dynamic::object("id", responseID_)("error", response);
    socket_->sendMessage(message);
  }

 private:
  SonarWebSocket* socket_;
  int64_t responseID_;
};

} // namespace sonar
} // namespace facebook
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

#pragma once

#include <folly/json.h>

namespace facebook {
namespace sonar {

class SonarWebSocket {
 public:
  class Callbacks;

 public:
  virtual ~SonarWebSocket(){};

  /**
   Establishes a connection to the ws server.
   */
  virtual void start() = 0;

  /**
   Closes an open connection to the ws server.
   */
  virtual void stop() = 0;

  /**
   True if there's an open connection.
   This method may block if the connection is busy.
   */
  virtual bool isOpen() const = 0;

  /**
   Send message to the ws server.
   */
  virtual void sendMessage(const folly::dynamic& message) = 0;

  /**
   Handler for connection and message receipt from the ws server.
   The callbacks should be set before a connection is established.
   */
  virtual void setCallbacks(Callbacks* callbacks) = 0;
};

class SonarWebSocket::Callbacks {
 public:
  virtual ~Callbacks(){};

  virtual void onConnected() = 0;

  virtual void onDisconnected() = 0;

  virtual void onMessageReceived(const folly::dynamic& message) = 0;
};

} // namespace sonar
} // namespace facebook
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

#pragma once

#include <Sonar/SonarInitConfig.h>
#include <Sonar/SonarWebSocket.h>
#include <folly/Executor.h>
#include <folly/io/async/EventBase.h>
#include <rsocket/RSocket.h>
#include <mutex>

namespace facebook {
namespace sonar {

class ConnectionEvents;
class Responder;

class SonarWebSocketImpl : public SonarWebSocket {
  friend ConnectionEvents;
  friend Responder;

 public:
  SonarWebSocketImpl(SonarInitConfig config);

  ~SonarWebSocketImpl();

  void start() override;

  void stop() override;

  bool isOpen() const override;

  void setCallbacks(Callbacks* callbacks) override;

  void sendMessage(const folly::dynamic& message) override;

  void reconnect();

 private:
  bool isOpen_ = false;
  Callbacks* callbacks_;
  DeviceData deviceData_;

  folly::EventBase* worker_;
  std::unique_ptr<rsocket::RSocketClient> client_;
  bool connectionIsTrusted_;
  int failedConnectionAttempts_ = 0;

  void startSync();
  void doCertificateExchange();
  void connectSecurely();
  std::string loadCSRFromFile();
  std::string loadStringFromFile(std::string fileName);
  std::string absoluteFilePath(const char* relativeFilePath);
  bool isCertificateExchangeNeeded();
  void requestSignedCertFromSonar();
  bool ensureSonarDirExists();
};

} // namespace sonar
} // namespace facebook
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

#pragma once

#include <Sonar/SonarConnection.h>
#include <map>
#include <string>

namespace facebook {
namespace sonar {

class SonarConnectionMock : public SonarConnection {
 public:
  void send(const std::string& method, const folly::dynamic& params) override {
    sent_[method] = params;
  }

  void receive(const std::string& method, const SonarReceiver& receiver)
      override {
    receivers_[method] = receiver;
  }

  std::map<std::string, folly::dynamic> sent_;
  std::map<std::string, SonarReceiver> receivers_;
};

} // namespace sonar
} // namespace facebook
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

#pragma once

#include <Sonar/SonarPlugin.h>

namespace facebook {
namespace sonar {
namespace test {

class SonarPluginMock : public SonarPlugin {
  using ConnectionCallback =
      std::function<void(std::shared_ptr<SonarConnection>)>;
  using DisconnectionCallback = std::function<void()>;

 public:
  SonarPluginMock(const std::string& identifier) : identifier_(identifier) {}

  SonarPluginMock(
      const std::string& identifier,
      const ConnectionCallback& connectionCallback)
      : identifier_(identifier), connectionCallback_(connectionCallback) {}

  SonarPluginMock(
      const std::string& identifier,
      const ConnectionCallback& connectionCallback,
      const DisconnectionCallback& disconnectionCallback)
      : identifier_(identifier),
        connectionCallback_(connectionCallback),
        disconnectionCallback_(disconnectionCallback) {}

  std::string identifier() const override {
    return identifier_;
  }

  void didConnect(std::shared_ptr<SonarConnection> conn) override {
    if (connectionCallback_) {
      connectionCallback_(conn);
    }
  }

  void didDisconnect() override {
    if (disconnectionCallback_) {
      disconnectionCallback_();
    }
  }

 private:
  std::string identifier_;
  ConnectionCallback connectionCallback_;
  DisconnectionCallback disconnectionCallback_;
};

} // namespace test
} // namespace sonar
} // namespace facebook
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

#pragma once

#include <Sonar/SonarResponder.h>
#include <folly/json.h>
#include <vector>

namespace facebook {
namespace sonar {

class SonarResponderMock : public SonarResponder {
 public:
  SonarResponderMock(
      std::vector<folly::dynamic>* successes = nullptr,
      std::vector<folly::dynamic>* errors = nullptr)
      : successes_(successes), errors_(errors) {}

  void success(const folly::dynamic& response) const override {
    if (successes_) {
      successes_->push_back(response);
    }
  }

  void error(const folly::dynamic& response) const override {
    if (errors_) {
      errors_->push_back(response);
    }
  }

 private:
  std::vector<folly::dynamic>* successes_;
  std::vector<folly::dynamic>* errors_;
};

} // namespace sonar
} // namespace facebook
/*
 *  Copyright (c) 2018-present, Facebook, Inc.
 *
 *  This source code is licensed under the MIT license found in the LICENSE
 *  file in the root directory of this source tree.
 *
 */

#pragma once

#include <Sonar/SonarWebSocket.h>

namespace facebook {
namespace sonar {
namespace test {

class SonarWebSocketMock : public SonarWebSocket {
 public:
  SonarWebSocketMock() : callbacks(nullptr) {}

  void start() override {
    open = true;
    if (callbacks) {
      callbacks->onConnected();
    }
  }

  void stop() override {
    open = false;
    if (callbacks) {
      callbacks->onDisconnected();
    }
  }

  bool isOpen() const override {
    return open;
  }

  void sendMessage(const folly::dynamic& message) override {
    messages.push_back(message);
  }

  void setCallbacks(Callbacks* aCallbacks) override {
    callbacks = aCallbacks;
  }

 public:
  bool open = false;
  Callbacks* callbacks;
  std::vector<folly::dynamic> messages;
};

} // namespace test
} // namespace sonar
} // namespace facebook
